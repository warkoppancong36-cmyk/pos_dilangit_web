import{I as K}from"./ItemsApi-DalEvwS1.js";import{av as h,V as C,aw as T,r as o,a3 as N}from"./main-BDjA8ZE0.js";import{P as R}from"./ProductsApi-D2qWNXIV.js";const y={async getAll(e={}){var t;try{return(await h.get("/api/product-items",{params:e})).data}catch(a){throw console.error("ProductItemsApi.getAll error:",a),((t=a.response)==null?void 0:t.data)||a}},async getById(e){var t;try{return(await h.get(`/api/product-items/${e}`)).data}catch(a){throw console.error("ProductItemsApi.getById error:",a),((t=a.response)==null?void 0:t.data)||a}},async create(e){var t;try{return(await h.post("/api/product-items",e)).data}catch(a){throw console.error("ProductItemsApi.create error:",a),((t=a.response)==null?void 0:t.data)||a}},async update(e,t){var a;try{return(await h.put(`/api/product-items/${e}`,t)).data}catch(n){throw console.error("ProductItemsApi.update error:",n),((a=n.response)==null?void 0:a.data)||n}},async delete(e){var t;try{return(await h.delete(`/api/product-items/${e}`)).data}catch(a){throw console.error("ProductItemsApi.delete error:",a),((t=a.response)==null?void 0:t.data)||a}},async getProductionCapacity(e){var t;try{return(await h.get(`/api/product-items/production-capacity/${e}`)).data}catch(a){throw console.error("ProductItemsApi.getProductionCapacity error:",a),((t=a.response)==null?void 0:t.data)||a}}},s=o([]),i=o([]),r=o([]),v=o(!1),A=o(!1),D=o(!1),k=o(!1),E=o(!1),F=o(!1),_=o(!1),d=o(null),j=o(null),q=o(null),m=o(1),I=o(0),w=o(15),b=T({search:"",product_id:void 0,item_id:void 0,critical_only:!1,stock_status:null,sort_by:null}),l=o(""),$=o(""),u=o(""),c=T({product_id:0,item_id:0,quantity_needed:0,unit:"",is_critical:!1,notes:""}),U=C(()=>!0),V=C(()=>[{title:"Pilih Produk",value:0},...i.value.map(e=>({title:e.name,value:e.id_product||e.id}))]),z=C(()=>[{title:"Pilih Item",value:0},...r.value.map(e=>({title:`${e.name} (${e.unit})`,value:e.id_item||e.id}))]),P=async()=>{v.value=!0,l.value="";try{const e={page:m.value,per_page:w.value,...b};Object.keys(e).forEach(a=>{const p=e[a];(p===void 0||p===0||typeof p=="string"&&p==="")&&delete e[a]});const t=await y.getAll(e);t.success&&t.data&&(Array.isArray(t.data)?(s.value=t.data,I.value=t.data.length):(s.value=t.data.data||[],I.value=t.data.total||0,m.value=t.data.current_page||1),console.log("üîó ProductItems loaded:",s.value.length),s.value.length>0&&(console.log("üîó First ProductItem:",s.value[0]),console.log("üÜî ProductItem product_ids needed:",[...new Set(s.value.map(a=>a.product_id))]),console.log("üÜî ProductItem item_ids needed:",[...new Set(s.value.map(a=>a.item_id))])))}catch(e){console.error("Error fetching product items:",e),l.value=e.message||"Failed to fetch product items"}finally{v.value=!1}},M=async()=>{try{const e=await R.getAll({});console.log("üîç fetchProducts response:",e),e.success&&e.data?(i.value=Array.isArray(e.data)?e.data:[],console.log("üì¶ Products loaded:",i.value.length),console.log("üÜî Product IDs available:",i.value.map(t=>t.id_product||t.id))):i.value=[]}catch(e){console.error("‚ùå Error fetching products:",e),i.value=[]}},S=async()=>{var e;try{console.log("üîÑ Starting fetchItems..."),console.log("üîê Auth token exists:",!!N("accessToken").value);const t=await K.getAll({per_page:1e3});console.log("üîç fetchItems response:",t),console.log("üîç fetchItems response.success:",t.success),console.log("üîç fetchItems response.data:",t.data),console.log("üîç fetchItems response.data.data:",(e=t.data)==null?void 0:e.data),t.success&&t.data&&t.data.data?(r.value=Array.isArray(t.data.data)?t.data.data:[],console.log("‚úÖ Items set to:",r.value),console.log("‚úÖ Items count:",r.value.length),console.log("‚úÖ First item:",r.value[0]),console.log("üÜî Item IDs available:",r.value.map(a=>a.id_item||a.id))):(r.value=[],console.log("‚ùå Items set to empty array - response not successful or no data")),console.log("üì¶ Items loaded:",r.value.length)}catch(t){console.error("‚ùå Error fetching items:",t),console.error("‚ùå Error details:",JSON.stringify(t,null,2)),r.value=[]}},O=async()=>{if(W()){A.value=!0,u.value="";try{let e;_.value&&d.value?e=await y.update(d.value.id_product_item,c):e=await y.create(c),e.success?($.value=_.value?"Hubungan produk-item berhasil diperbarui!":"Hubungan produk-item berhasil ditambahkan!",x(),await P()):u.value=e.message||"Terjadi kesalahan saat menyimpan"}catch(e){console.error("Error saving product item:",e),u.value=e.message||"Terjadi kesalahan saat menyimpan"}finally{A.value=!1}}},Q=async()=>{if(d.value){D.value=!0;try{const e=await y.delete(d.value.id_product_item);e.success?($.value="Hubungan produk-item berhasil dihapus!",G(),await P()):l.value=e.message||"Gagal menghapus hubungan produk-item"}catch(e){console.error("Error deleting product item:",e),l.value=e.message||"Terjadi kesalahan saat menghapus"}finally{D.value=!1}}},L=async e=>{v.value=!0;try{const t=await y.getProductionCapacity(e);t.success?(q.value=t.data,F.value=!0):l.value=t.message||"Gagal menghitung kapasitas produksi"}catch(t){console.error("Error getting production capacity:",t),l.value=t.message||"Terjadi kesalahan saat menghitung kapasitas produksi"}finally{v.value=!1}},W=()=>c.product_id<=0?(u.value="Produk harus dipilih",!1):c.item_id<=0?(u.value="Item harus dipilih",!1):c.quantity_needed<=0?(u.value="Jumlah yang dibutuhkan harus lebih besar dari 0",!1):c.unit.trim()?!0:(u.value="Satuan harus diisi",!1),X=()=>{_.value=!1,d.value=null,H(),k.value=!0},Y=e=>{_.value=!0,d.value=e,ae(e),k.value=!0},Z=e=>{d.value=e,E.value=!0},ee=e=>{console.log("üîç openCapacityDialog called with:",e);let t,a;if(typeof e=="number"){if(t=e,a=i.value.find(n=>(n.id_product||n.id)===t),!a){console.error("‚ùå Product not found in products list for ID:",t),l.value="Product tidak ditemukan";return}}else if(e&&typeof e=="object")a=e,t=a.id_product||a.id;else{console.error("‚ùå Invalid parameter:",e),l.value="Parameter tidak valid";return}if(console.log("üÜî Product ID:",t),console.log("üì¶ Product:",a),!t){console.error("‚ùå Product ID is undefined"),l.value="Product ID tidak ditemukan";return}j.value=a,L(t)},x=()=>{k.value=!1,B(),H()},G=()=>{E.value=!1,d.value=null},te=()=>{F.value=!1,j.value=null,q.value=null},H=()=>{Object.assign(c,{product_id:0,item_id:0,quantity_needed:0,unit:"",is_critical:!1,notes:""})},ae=e=>{Object.assign(c,{product_id:e.product_id,item_id:e.item_id,quantity_needed:e.quantity_needed,unit:e.unit,is_critical:e.is_critical,notes:e.notes||""})},B=()=>{u.value=""},oe=e=>{const t=r.value.find(a=>(a.id_item||a.id)===e);t&&(c.unit=t.unit)},se=e=>{m.value=e,P()},re=e=>{w.value=e,m.value=1,P()},le=()=>{m.value=1,P()},ue=()=>({productItemsList:s,products:i,items:r,loading:v,saveLoading:A,deleteLoading:D,dialog:k,deleteDialog:E,capacityDialog:F,editMode:_,selectedProductItem:d,selectedProduct:j,productionCapacity:q,currentPage:m,totalItems:I,itemsPerPage:w,filters:b,errorMessage:l,successMessage:$,modalErrorMessage:u,formData:c,canCreateEdit:U,productOptions:V,itemOptions:z,fetchProductItemsList:P,fetchProductItemsForComposition:async e=>{var t,a,n,p;v.value=!0,l.value="";try{const f={page:(e==null?void 0:e.page)||1,per_page:(e==null?void 0:e.per_page)||15,critical_only:(e==null?void 0:e.critical_only)||!1};console.log("üîÑ Fetching product items for composition:",f);const g=await y.getAll(f);if(console.log("üì¶ API Response:",g),g.success){const J=((t=g.data)==null?void 0:t.data)||g.data||[];s.value=J,m.value=((a=g.data)==null?void 0:a.current_page)||1,I.value=((n=g.data)==null?void 0:n.total)||0,w.value=((p=g.data)==null?void 0:p.per_page)||15,b.critical_only=f.critical_only,console.log("‚úÖ Product items for composition loaded:",s.value.length),console.log("üìä First item:",s.value[0]),i.value.length===0&&await M(),r.value.length===0&&await S()}else console.error("‚ùå API returned success: false"),s.value=[]}catch(f){console.error("‚ùå Failed to fetch product items for composition:",f),l.value=f.message||"Gagal memuat data komposisi produk",s.value=[]}finally{v.value=!1}},fetchProducts:M,fetchItems:S,saveProductItem:O,deleteProductItem:Q,getProductionCapacity:L,openCreateDialog:X,openEditDialog:Y,openDeleteDialog:Z,openCapacityDialog:ee,closeDialog:x,closeDeleteDialog:G,closeCapacityDialog:te,clearModalError:B,onItemChange:oe,onPageChange:se,onItemsPerPageChange:re,handleFiltersUpdate:le});export{y as P,ue as u};
