import{D as Tt}from"./DeleteConfirmationDialog-B9XRt-Ue.js";import{f as Te}from"./formatters-BD6tdLx_.js";import{P as pt,u as Kt}from"./useProductItems-KyFNQv33.js";import{I as Bt}from"./ItemsApi-OQK9JBPr.js";import{u as wt,H as qt}from"./HPPBreakdownDialog-DqWBmyWt.js";import{V as Oe}from"./VDialog-G3D03YlS.js";import{V as ae,b as Pe,c as qe}from"./VCard-DfNuzbUl.js";import{a8 as Rt,a9 as Nt,af as Lt,r as A,aG as rt,ag as Ot,aM as $t,bi as jt,V as fe,W as Jt,w as we,bt as Dt,b8 as ht,aa as Gt,b as e,p as Ve,bd as Wt,cv as Qt,c8 as Ut,bg as Xt,F as ze,X as V,cm as Zt,c9 as Yt,aI as ea,s as d,d as Re,D as it,c as te,f as t,e as l,t as r,a0 as q,g as B,l as j,m as E,aw as gt,i as We,v as Qe,o as _,ax as xt,$ as Pt,j as Ht,cw as ta,aQ as aa,ay as Le,ap as la,aq as oa,a5 as kt}from"./main-DsI8-tAT.js";import{V as ie}from"./VCardText-BdNb160h.js";import{V as Ie}from"./VAvatar-D_V5TXlZ.js";import{V as me}from"./VChip-DD3ljoat.js";import{V as Ce,a as D}from"./VRow-fCQ8wiBl.js";import{V as Vt}from"./VAutocomplete-BK0Y5xOG.js";import{e as sa,t as ut,V as _t,a as Ge,b as ot,d as dt}from"./VList-D4g3QpSY.js";import{u as ia,V as he,m as na}from"./VTextField-Cv8efPHS.js";import{V as ct}from"./VSwitch-BM9CFwCp.js";import{a as ft,V as Ee}from"./VAlert-SlQRFUQF.js";import{V as je}from"./VSpacer-JdKOYPf9.js";import{V as st}from"./VSnackbar-CLv1TBah.js";import{_ as Je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as ra,m as ua,a as da,V as Ke}from"./VSelect-D2abIeT3.js";import{V as ca}from"./VCheckbox-C3thL1zE.js";import{V as Ae}from"./VDivider-DsRpduK3.js";import{V as ma}from"./VContainer-B6Vt8zgt.js";import{a as Mt,u as va,P as pa}from"./useProducts-D60cIDLy.js";import{V as Ct}from"./VForm-DM8h9QEp.js";import{V as zt}from"./VTextarea-DPzBJDSl.js";import{V as Fe}from"./VTooltip-B9p9lUWV.js";import{m as fa,V as ga}from"./VImg-E-aIalCp.js";import{V as _a,u as ka}from"./useCategories-Bwb4CMnk.js";import{u as ya,m as ba,h as ha}from"./filter-BLUS3hGG.js";import{f as xa}from"./forwardRefs-B931MWyl.js";import{V as wa}from"./VMenu-BZ8R7SqL.js";import{V as Pa}from"./VCheckboxBtn-BNncdEZi.js";import{V as Va}from"./VDataTableServer-CUwPETwP.js";import{V as Ca}from"./VSkeletonLoader-xXrW-p5K.js";import{V as Ia}from"./VDataTable-ltJvkWu0.js";import{V as Sa,a as $a,b as yt,c as bt}from"./VTabs-ChKB3ZGq.js";import"./ProductsApi-CkUZX-7N.js";import"./api-lq_cZUAT.js";import"./index-D-EbNoF1.js";import"./VOverlay-CIPOtgzQ.js";/* empty css              */import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-vMJe6lm6.js";import"./VTable-BA-Qiv8c.js";const Da=Nt({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...ba({filterKeys:["title"]}),...ua({hideNoData:!0,returnObject:!0}),...Wt(na({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...fa({transition:!1})},"VCombobox"),Ua=Rt()({name:"VCombobox",props:Da(),emits:{"update:focused":I=>!0,"update:modelValue":I=>!0,"update:search":I=>!0,"update:menu":I=>!0},setup(I,ke){var n;let{emit:H,slots:M}=ke;const{t:L}=Lt(),y=A(),J=rt(!1),$=rt(!0),c=rt(!1),b=A(),ee=A(),x=rt(-1);let Z=!1;const{items:pe,transformIn:re,transformOut:K}=sa(I),{textColorClasses:ce,textColorStyles:ve}=Ot(()=>{var a;return(a=y.value)==null?void 0:a.color}),O=$t(I,"modelValue",[],a=>re(jt(a)),a=>{const p=K(a);return I.multiple?p:p[0]??null}),W=ia(I),u=fe(()=>!!(I.chips||M.chip)),g=fe(()=>u.value||!!M.selection),T=rt(!I.multiple&&!g.value?((n=O.value[0])==null?void 0:n.title)??"":""),v=fe({get:()=>T.value,set:a=>{var p;if(T.value=a??"",!I.multiple&&!g.value&&(O.value=[ut(I,a)]),a&&I.multiple&&((p=I.delimiters)!=null&&p.length)){const z=a.split(new RegExp(`(?:${I.delimiters.join("|")})+`));z.length>1&&(z.forEach(F=>{F=F.trim(),F&&Se(ut(I,F))}),T.value="")}a||(x.value=-1),$.value=!a}}),k=fe(()=>typeof I.counterValue=="function"?I.counterValue(O.value):typeof I.counterValue=="number"?I.counterValue:I.multiple?O.value.length:v.value.length),{filteredItems:s,getMatches:f}=ya(I,pe,()=>$.value?"":v.value),U=fe(()=>I.hideSelected?s.value.filter(a=>!O.value.some(p=>p.value===a.value)):s.value),le=fe(()=>I.hideNoData&&!U.value.length||W.isReadonly.value||W.isDisabled.value),ne=$t(I,"menu"),ue=fe({get:()=>ne.value,set:a=>{var p;ne.value&&!a&&((p=b.value)!=null&&p.Î¨openChildren.size)||a&&le.value||(ne.value=a)}}),R=Jt(()=>ue.value?I.closeText:I.openText);we(T,a=>{Z?ht(()=>Z=!1):J.value&&!ue.value&&(ue.value=!0),H("update:search",a)}),we(O,a=>{var p;!I.multiple&&!g.value&&(T.value=((p=a[0])==null?void 0:p.title)??"")});const S=fe(()=>O.value.map(a=>a.value)),m=fe(()=>{var p;return(I.autoSelectFirst===!0||I.autoSelectFirst==="exact"&&v.value===((p=U.value[0])==null?void 0:p.title))&&U.value.length>0&&!$.value&&!c.value}),o=A(),i=ra(o,y);function C(a){Z=!0,I.openOnClear&&(ue.value=!0)}function ge(){le.value||(ue.value=!0)}function G(a){le.value||(J.value&&(a.preventDefault(),a.stopPropagation()),ue.value=!ue.value)}function _e(a){var p;a.key!==" "&&Ut(a)&&((p=y.value)==null||p.focus())}function De(a){var F,P,h,N;if(Qt(a)||W.isReadonly.value)return;const p=(F=y.value)==null?void 0:F.selectionStart,z=O.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(a.key)&&a.preventDefault(),["Enter","ArrowDown"].includes(a.key)&&(ue.value=!0),["Escape"].includes(a.key)&&(ue.value=!1),["Enter","Escape","Tab"].includes(a.key)&&(m.value&&["Enter","Tab"].includes(a.key)&&!O.value.some(w=>{let{value:se}=w;return se===U.value[0].value})&&Se(s.value[0]),$.value=!0),a.key==="ArrowDown"&&m.value&&((P=o.value)==null||P.focus("next")),a.key==="Enter"&&v.value&&(Se(ut(I,v.value)),g.value&&(T.value="")),["Backspace","Delete"].includes(a.key)){if(!I.multiple&&g.value&&O.value.length>0&&!v.value)return Se(O.value[0],!1);if(~x.value){a.preventDefault();const w=x.value;Se(O.value[x.value],!1),x.value=w>=z-1?z-2:w}else a.key==="Backspace"&&!v.value&&(x.value=z-1);return}if(I.multiple)if(a.key==="ArrowLeft"){if(x.value<0&&p&&p>0)return;const w=x.value>-1?x.value-1:z-1;O.value[w]?x.value=w:(x.value=-1,(h=y.value)==null||h.setSelectionRange(v.value.length,v.value.length))}else if(a.key==="ArrowRight"){if(x.value<0)return;const w=x.value+1;O.value[w]?x.value=w:(x.value=-1,(N=y.value)==null||N.setSelectionRange(0,0))}else~x.value&&Ut(a)&&(x.value=-1)}function oe(){var a;I.eager&&((a=ee.value)==null||a.calculateVisibleItems())}function Me(){var a;J.value&&($.value=!0,(a=y.value)==null||a.focus())}function Se(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!a||a.props.disabled))if(I.multiple){const z=O.value.findIndex(P=>(I.valueComparator||Dt)(P.value,a.value)),F=p??!~z;if(~z){const P=F?[...O.value,a]:[...O.value];P.splice(z,1),O.value=P}else F&&(O.value=[...O.value,a]);I.clearOnSelect&&(v.value="")}else{const z=p!==!1;O.value=z?[a]:[],T.value=z&&!g.value?a.title:"",ht(()=>{ue.value=!1,$.value=!0})}}function Xe(a){J.value=!0,setTimeout(()=>{c.value=!0})}function Ze(a){c.value=!1}function Be(a){(a==null||a===""&&!I.multiple&&!g.value)&&(O.value=[])}return we(J,(a,p)=>{if(!(a||a===p)&&(x.value=-1,ue.value=!1,v.value)){if(I.multiple){Se(ut(I,v.value));return}if(!g.value)return;O.value.some(z=>{let{title:F}=z;return F===v.value})?T.value="":Se(ut(I,v.value))}}),we(ue,()=>{if(!I.hideSelected&&ue.value&&O.value.length){const a=U.value.findIndex(p=>O.value.some(z=>(I.valueComparator||Dt)(z.value,p.value)));Xt&&window.requestAnimationFrame(()=>{var p;a>=0&&((p=ee.value)==null||p.scrollToIndex(a))})}}),we(()=>I.items,(a,p)=>{ue.value||J.value&&!p.length&&a.length&&(ue.value=!0)}),Gt(()=>{const a=!!(!I.hideNoData||U.value.length||M["prepend-item"]||M["append-item"]||M["no-data"]),p=O.value.length>0,z=he.filterProps(I);return e(he,Ve({ref:y},z,{modelValue:v.value,"onUpdate:modelValue":[F=>v.value=F,Be],focused:J.value,"onUpdate:focused":F=>J.value=F,validationValue:O.externalValue,counterValue:k.value,dirty:p,class:["v-combobox",{"v-combobox--active-menu":ue.value,"v-combobox--chips":!!I.chips,"v-combobox--selection-slot":!!g.value,"v-combobox--selecting-index":x.value>-1,[`v-combobox--${I.multiple?"multiple":"single"}`]:!0},I.class],style:I.style,readonly:W.isReadonly.value,placeholder:p?void 0:I.placeholder,"onClick:clear":C,"onMousedown:control":ge,onKeydown:De}),{...M,default:()=>e(ze,null,[e(wa,Ve({ref:b,modelValue:ue.value,"onUpdate:modelValue":F=>ue.value=F,activator:"parent",contentClass:"v-combobox__content",disabled:le.value,eager:I.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:I.transition,onAfterEnter:oe,onAfterLeave:Me},I.menuProps),{default:()=>[a&&e(_t,Ve({ref:o,selected:S.value,selectStrategy:I.multiple?"independent":"single-independent",onMousedown:F=>F.preventDefault(),onKeydown:_e,onFocusin:Xe,onFocusout:Ze,tabindex:"-1","aria-live":"polite",color:I.itemColor??I.color},i,I.listProps),{default:()=>{var F,P,h;return[(F=M["prepend-item"])==null?void 0:F.call(M),!U.value.length&&!I.hideNoData&&(((P=M["no-data"])==null?void 0:P.call(M))??e(Ge,{key:"no-data",title:L(I.noDataText)},null)),e(da,{ref:ee,renderless:!0,items:U.value,itemKey:"value"},{default:N=>{var xe;let{item:w,index:se,itemRef:de}=N;const be=Ve(w.props,{ref:de,key:w.value,active:m.value&&se===0?!0:void 0,onClick:()=>Se(w,null)});return((xe=M.item)==null?void 0:xe.call(M,{item:w,index:se,props:be}))??e(Ge,Ve(be,{role:"option"}),{prepend:$e=>{let{isSelected:He}=$e;return e(ze,null,[I.multiple&&!I.hideSelected?e(Pa,{key:w.value,modelValue:He,ripple:!1,tabindex:"-1"},null):void 0,w.props.prependAvatar&&e(Ie,{image:w.props.prependAvatar},null),w.props.prependIcon&&e(V,{icon:w.props.prependIcon},null)])},title:()=>{var $e;return $.value?w.title:ha("v-combobox",w.title,($e=f(w))==null?void 0:$e.title)}})}}),(h=M["append-item"])==null?void 0:h.call(M)]}})]}),O.value.map((F,P)=>{function h(de){de.stopPropagation(),de.preventDefault(),Se(F,!1)}const N={"onClick:close":h,onKeydown(de){de.key!=="Enter"&&de.key!==" "||(de.preventDefault(),de.stopPropagation(),h(de))},onMousedown(de){de.preventDefault(),de.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},w=u.value?!!M.chip:!!M.selection,se=w?Yt(u.value?M.chip({item:F,index:P,props:N}):M.selection({item:F,index:P})):void 0;if(!(w&&!se))return e("div",{key:F.value,class:["v-combobox__selection",P===x.value&&["v-combobox__selection--selected",ce.value]],style:P===x.value?ve.value:{}},[u.value?M.chip?e(ea,{key:"chip-defaults",defaults:{VChip:{closable:I.closableChips,size:"small",text:F.title}}},{default:()=>[se]}):e(me,Ve({key:"chip",closable:I.closableChips,size:"small",text:F.title,disabled:F.props.disabled},N),null):se??e("span",{class:"v-combobox__selection-text"},[F.title,I.multiple&&P<O.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[d(",")])])])})]),"append-inner":function(){var N,w;for(var F=arguments.length,P=new Array(F),h=0;h<F;h++)P[h]=arguments[h];return e(ze,null,[(N=M["append-inner"])==null?void 0:N.call(M,...P),(!I.hideNoData||I.items.length)&&I.menuIcon?e(V,{class:"v-combobox__menu-icon",color:(w=y.value)==null?void 0:w.fieldIconColor,icon:I.menuIcon,onMousedown:G,onClick:Zt,"aria-label":L(R.value),title:L(R.value),tabindex:"-1"},null):void 0])}})}),xa({isFocused:J,isPristine:$,menu:ue,search:v,selectionIndex:x,filteredItems:s,select:Se},y)}}),za={class:"d-flex align-center gap-3"},Aa={class:"text-body-2 ma-0 opacity-90"},Ta={class:"d-flex align-center gap-4"},Ha={class:"flex-grow-1"},Ma={class:"text-h6 font-weight-bold mb-1"},Fa={class:"text-body-2 text-medium-emphasis mb-1"},Ea={class:"d-flex align-center gap-4 mb-0"},Ka={class:"text-body-2 text-medium-emphasis mb-0"},Ba={class:"text-body-2 text-info mb-0 font-weight-medium"},qa={key:0,class:"text-body-2 text-success mb-0 font-weight-medium"},Ra={class:"text-body-1 font-weight-bold"},Na={class:"text-body-1 font-weight-bold"},La={class:"text-body-1 font-weight-bold"},Oa={class:"text-body-1 font-weight-bold"},ja={class:"d-flex align-center justify-space-between w-100"},Ja={class:"d-flex align-center"},Ga={key:0,class:"text-warning"},Wa={key:1},Qa={key:0,class:"text-center pa-8"},Xa={class:"d-flex align-center gap-4 mt-1"},Za={key:1,class:"text-primary"},Ya={class:"d-flex gap-2"},el=Re({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup(I,{emit:ke}){const H=I,M=ke,L=fe({get:()=>H.modelValue,set:n=>M("update:modelValue",n)}),y=A(!1),J=A([]),$=A(!1),c=A(!1),b=A(""),ee=A(""),x=A(!1),Z=A(-1),pe=A(!1),{loading:re,currentHPPBreakdown:K,getProductHPPBreakdown:ce}=wt(),ve=fe(()=>{var n,a,p;return((n=K.value)==null?void 0:n.total_hpp)||((a=H.product)==null?void 0:a.hpp)||((p=H.product)==null?void 0:p.cost)||0}),O=fe(()=>{var p;const n=((p=H.product)==null?void 0:p.price)||0,a=ve.value;return n-a}),W=fe(()=>{var p;const n=((p=H.product)==null?void 0:p.price)||0,a=ve.value;return n<=0?0:Math.round((n-a)/n*100)}),u=A({itemId:null,quantity:1,unit:"pcs",isCritical:!1}),g=A([]),T=A(!1),v=A([]),k=async()=>{var n;if(H.product)try{const a=H.product.id_product||H.product.id;console.log("ðŸ”„ Fetching composition for product ID:",a);const p=await pt.getAll({product_id:a,page:1,per_page:1e5});p.success&&((n=p.data)!=null&&n.data)&&(J.value=p.data.data,v.value=JSON.parse(JSON.stringify(p.data.data)),console.log("âœ… Initial composition loaded:",v.value.length,"items"))}catch(a){console.error("Error fetching product composition:",a)}},s=async()=>{var n;T.value=!0;try{const a=await Bt.getAll({page:1,per_page:1e5,active:!0});a.success&&((n=a.data)!=null&&n.data)&&(g.value=a.data.data.map(p=>{var z,F,P;return{id:((z=p.id_item)==null?void 0:z.toString())||((F=p.id)==null?void 0:F.toString()),name:p.name,current_stock:((P=p.inventory)==null?void 0:P.current_stock)||0,unit:p.unit||"pcs"}}))}catch(a){console.error("Error fetching available items:",a),g.value=[]}finally{T.value=!1}},f=fe(()=>u.value.itemId&&u.value.quantity>0&&u.value.unit.trim().length>0),U=fe(()=>{if(!u.value.itemId)return null;const n=g.value.find(a=>a.id===u.value.itemId);return(n==null?void 0:n.unit)||null}),le=fe(()=>{if(!u.value.itemId)return null;const n=g.value.find(a=>a.id===u.value.itemId);return n?R(n):null}),ne=fe(()=>le.value!==null&&le.value<=0),ue=fe(()=>Array.isArray(g.value)?g.value:[]),R=n=>n.current_stock||n.stock||0,S=()=>T.value?"Memuat items...":!g.value||g.value.length===0?"Tidak ada item tersedia":"Tidak ada item yang ditemukan",m=n=>{const a=R(n);return a>50?"success":a>20?"warning":a>0?"error":"grey"},o=n=>{const a=R(n);return a>50?"Aman":a>20?"Rendah":a>0?"Kritis":"Habis"};we(()=>u.value.itemId,n=>{if(n){const a=g.value.find(p=>p.id===n);a!=null&&a.unit&&(u.value.unit=a.unit)}}),we(()=>H.items,n=>{n&&n.length>0,J.value=[...n]},{immediate:!0}),we(()=>H.modelValue,async n=>{n&&H.product&&(k(),await i())});const i=async()=>{if(H.product&&(H.product.id_product||H.product.id))try{const n=parseInt(String(H.product.id_product||H.product.id));await ce(n,"latest")}catch(n){console.warn("Could not load HPP data:",n)}};it(()=>{s()});const C=()=>{pe.value=!0},ge=async()=>{await i(),M("refresh")},G=()=>J.value.some(a=>{var p;return((p=a.item)==null?void 0:p.inventory)&&a.item.inventory.current_stock<a.quantity_needed})?"error":"success",_e=()=>J.value.some(a=>{var p;return((p=a.item)==null?void 0:p.inventory)&&a.item.inventory.current_stock<a.quantity_needed})?"Stok Kritis":"Stok Aman",De=()=>{if(!f.value)return;const n=g.value.find(z=>z.id===u.value.itemId);if(!n)return;if(J.value.find(z=>{var F;return((F=z.item)==null?void 0:F.id)===n.id})){b.value=`Item "${n.name}" sudah ada dalam komposisi produk ini`,$.value=!0;return}const p={id_product_item:`temp_${Date.now()}`,item:{id:String(n.id),name:n.name,inventory:{current_stock:n.current_stock||0}},quantity_needed:u.value.quantity,unit:u.value.unit,is_critical:u.value.isCritical};J.value.push(p),Se()},oe=(n,a)=>{var F;if(console.log("ðŸ” EditItem called with:",n),console.log("ðŸ” Item structure:",JSON.stringify(n,null,2)),g.value.length===0){console.warn("âš ï¸ Available items not loaded yet, fetching..."),s().then(()=>{console.log("âœ… Available items loaded, retrying edit"),oe(n,a)});return}x.value=!0,Z.value=a;let p=((F=n.item)==null?void 0:F.id)||null;p!==null&&(p=p.toString()),console.log("ðŸŽ¯ Found itemId (converted to string):",p),console.log("ðŸ” Available items for reference:",g.value.map(P=>({id:P.id,name:P.name}))),u.value={itemId:p,quantity:parseFloat(n.quantity_needed.toString())||0,unit:n.unit,isCritical:n.is_critical},console.log("ðŸ“ Form data set for edit:",{original_quantity:n.quantity_needed,parsed_quantity:parseFloat(n.quantity_needed.toString()),form_data:u.value});const z=g.value.find(P=>P.id===p);if(z)console.log("âœ… Item found in available items:",z.name);else{console.warn("âš ï¸ Item ID not found in available items, trying alternative matching...");const P=g.value.find(h=>{var N;return h.name===((N=n.item)==null?void 0:N.name)});P?(console.log("âœ… Found item by name matching, using ID:",P.id),u.value.itemId=P.id):console.error("âŒ Could not find item in available items by ID or name")}},Me=()=>{if(!f.value||Z.value===-1)return;const n=g.value.find(a=>a.id===u.value.itemId);n&&(J.value[Z.value]={...J.value[Z.value],item:{id:String(n.id),name:n.name,inventory:{current_stock:n.current_stock||0}},quantity_needed:u.value.quantity,unit:u.value.unit,is_critical:u.value.isCritical},Se())},Se=()=>{x.value=!1,Z.value=-1,u.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},Xe=n=>{J.value.splice(n,1)},Ze=async()=>{var n,a,p,z,F,P,h,N,w,se,de,be,xe,$e,He,Ne,Ye,et,tt,nt,mt,vt;if(H.product){y.value=!0;try{console.log("ðŸ’¾ Saving composition for product:",H.product.name),console.log("ðŸ“¦ Items to save:",J.value);const lt=parseInt(String(((n=H.product)==null?void 0:n.id_product)||((a=H.product)==null?void 0:a.id)||"0")),ye=v.value||[],Q=J.value;console.log("ðŸ”„ Comparing items for save:",{existing_count:ye.length,current_count:Q.length,existing_items:ye.map(X=>{var Y,Ue;return{id:X.id_product_item,item_id:(Y=X.item)==null?void 0:Y.id,item_name:(Ue=X.item)==null?void 0:Ue.name}}),current_items:Q.map(X=>{var Y,Ue;return{id:X.id_product_item,item_id:(Y=X.item)==null?void 0:Y.id,item_name:(Ue=X.item)==null?void 0:Ue.name,quantity:X.quantity_needed,unit:X.unit}})}),console.log("ðŸ”„ Starting to process",Q.length,"items for save...");for(const X of Q){const Y=ye.find(at=>{var It,St;return!!(at.id_product_item===X.id_product_item||X.id_product_item&&!X.id_product_item.toString().startsWith("temp_")&&((It=at.item)==null?void 0:It.id)===((St=X.item)==null?void 0:St.id))});if(console.log("ðŸ” Processing item:",{item_name:(p=X.item)==null?void 0:p.name,item_id_product_item:X.id_product_item,existing_found:!!Y,existing_id:Y==null?void 0:Y.id_product_item,is_temp:(z=X.id_product_item)==null?void 0:z.toString().startsWith("temp_"),matching_strategy:Y?Y.id_product_item===X.id_product_item?"exact_id":"item_product_match":"no_match"}),!((F=X.item)!=null&&F.id)||parseInt(X.item.id)===0){console.warn("âš ï¸ Skipping item with invalid item_id:",{item_name:(P=X.item)==null?void 0:P.name,item_id:(h=X.item)==null?void 0:h.id,full_item:X});continue}const Ue={product_id:lt,item_id:parseInt(((N=X.item)==null?void 0:N.id)||"0"),quantity_needed:parseFloat(X.quantity_needed.toString()),unit:X.unit,is_critical:X.is_critical,notes:X.notes||""};console.log("ðŸ“¤ API Data for item:",(w=X.item)==null?void 0:w.name,{raw_item_id:(se=X.item)==null?void 0:se.id,parsed_item_id:parseInt(((de=X.item)==null?void 0:de.id)||"0"),api_data:Ue,full_item_data:{id_product_item:X.id_product_item,item_name:(be=X.item)==null?void 0:be.name,quantity:X.quantity_needed,unit:X.unit}});try{Y&&!((xe=X.id_product_item)!=null&&xe.toString().startsWith("temp_"))?(console.log("âœï¸ Updating existing item:",{id:Y.id_product_item,item_name:($e=X.item)==null?void 0:$e.name,current_stock:(Ne=(He=X.item)==null?void 0:He.inventory)==null?void 0:Ne.current_stock}),await pt.update(parseInt(Y.id_product_item||"0"),Ue)):(console.log("âž• Creating new item:",{item_name:(Ye=X.item)==null?void 0:Ye.name,current_stock:(tt=(et=X.item)==null?void 0:et.inventory)==null?void 0:tt.current_stock,id_product_item:X.id_product_item,is_temp:(nt=X.id_product_item)==null?void 0:nt.toString().startsWith("temp_"),existing_item_found:!!Y}),await pt.create(Ue))}catch(at){throw console.error("âŒ Error processing item:",at),(mt=at.message)!=null&&mt.includes("already assigned")?b.value=`Item "${(vt=X.item)==null?void 0:vt.name}" sudah ditambahkan ke produk ini`:b.value=at.message||"Terjadi kesalahan saat menyimpan item",$.value=!0,at}}for(const X of ye)if(!Q.find(Ue=>Ue.id_product_item===X.id_product_item)&&X.id_product_item)try{console.log("ðŸ—‘ï¸ Deleting item:",X.id_product_item),await pt.delete(parseInt(X.id_product_item))}catch(Ue){console.error("âŒ Error deleting item:",Ue),b.value=`Gagal menghapus item: ${Ue.message}`,$.value=!0}console.log("âœ… Composition saved successfully!"),ee.value="Komposisi produk berhasil disimpan!",c.value=!0,M("save",{product:H.product,items:J.value}),M("refresh"),Be()}catch(lt){console.error("âŒ Error saving composition:",lt),$.value||(b.value=lt.message||"Terjadi kesalahan saat menyimpan komposisi",$.value=!0)}finally{y.value=!1}}},Be=()=>{L.value=!1,setTimeout(()=>{J.value=[...H.items],Se()},300)};return(n,a)=>{var p,z,F,P;return _(),te(ze,null,[e(Oe,{modelValue:L.value,"onUpdate:modelValue":a[9]||(a[9]=h=>L.value=h),"max-width":"900",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var h;return[l("div",za,[e(V,{icon:"mdi-chef-hat",size:"24"}),l("div",null,[a[12]||(a[12]=l("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),l("p",Aa,r(((h=n.product)==null?void 0:h.name)||"Produk"),1)])]),e(q,{icon:"mdi-close",variant:"text",size:"small",onClick:Be})]}),_:1}),e(ie,{class:"pa-6"},{default:t(()=>[e(ae,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(ie,{class:"pa-4"},{default:t(()=>{var h,N,w,se,de,be;return[l("div",Ta,[e(Ie,{image:(h=n.product)==null?void 0:h.image_url,size:"64"},{default:t(()=>{var xe;return[(xe=n.product)!=null&&xe.image_url?j("",!0):(_(),B(V,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),l("div",Ha,[l("h4",Ma,r((N=n.product)==null?void 0:N.name),1),l("p",Fa," SKU: "+r(((w=n.product)==null?void 0:w.sku)||"SKU-"+((se=n.product)==null?void 0:se.id_product)),1),l("div",Ea,[l("p",Ka," Harga: "+r(E(Te)(((de=n.product)==null?void 0:de.price)||0)),1),l("p",Ba," HPP: "+r(E(Te)(ve.value)),1),(be=n.product)!=null&&be.price&&ve.value?(_(),te("p",qa," Margin: "+r(E(Te)(O.value)),1)):j("",!0)])]),e(me,{color:G(),variant:"tonal"},{default:t(()=>[d(r(_e()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e(Ce,{class:"mb-6"},{default:t(()=>[e(D,{cols:"12",md:"3"},{default:t(()=>[e(ae,{variant:"outlined",color:"info"},{default:t(()=>[e(ie,{class:"text-center pa-3"},{default:t(()=>[e(V,{icon:"mdi-calculator",size:"20",class:"mb-1"}),l("div",Ra,[d(r(E(Te)(ve.value))+" ",1),E(re)?(_(),B(gt,{key:0,indeterminate:"",size:"12",width:"2",class:"ml-1"})):j("",!0)]),a[13]||(a[13]=l("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[13]})]),_:1})]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(ae,{variant:"outlined",color:"primary"},{default:t(()=>[e(ie,{class:"text-center pa-3"},{default:t(()=>{var h;return[e(V,{icon:"mdi-currency-usd",size:"20",class:"mb-1"}),l("div",Na,r(E(Te)(((h=n.product)==null?void 0:h.price)||0)),1),a[14]||(a[14]=l("div",{class:"text-caption"},"Harga Jual",-1))]}),_:1,__:[14]})]),_:1})]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(ae,{variant:"outlined",color:"success"},{default:t(()=>[e(ie,{class:"text-center pa-3"},{default:t(()=>[e(V,{icon:"mdi-trending-up",size:"20",class:"mb-1"}),l("div",La,r(E(Te)(O.value)),1),a[15]||(a[15]=l("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[15]})]),_:1})]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(ae,{variant:"outlined",color:"warning"},{default:t(()=>[e(ie,{class:"text-center pa-3"},{default:t(()=>[e(V,{icon:"mdi-percent",size:"20",class:"mb-1"}),l("div",Oa,r(W.value)+"% ",1),a[16]||(a[16]=l("div",{class:"text-caption"},"Margin %",-1))]),_:1,__:[16]})]),_:1})]),_:1})]),_:1}),e(ae,{class:"mb-6",elevation:"2"},{default:t(()=>[e(Pe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[l("div",ja,[l("div",Ja,[e(V,{icon:x.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),d(" "+r(x.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(ie,{class:"pa-4"},{default:t(()=>[e(Ce,null,{default:t(()=>[e(D,{cols:"12",md:"4"},{default:t(()=>[e(Vt,{modelValue:u.value.itemId,"onUpdate:modelValue":a[0]||(a[0]=h=>u.value.itemId=h),items:ue.value,loading:T.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item (termasuk yang stok kosong)...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":S()},{item:t(({props:h,item:N})=>[e(Ge,Ve(h,{class:{"text-medium-emphasis":R(N.raw)<=0}}),{prepend:t(()=>[e(Ie,{size:"32",class:"me-3",color:R(N.raw)<=0?"warning":"primary",variant:"tonal"},{default:t(()=>[e(V,{icon:"mdi-package-variant",color:R(N.raw)<=0?"warning":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[R(N.raw)>0?(_(),B(me,{key:0,size:"x-small",color:m(N.raw),variant:"tonal"},{default:t(()=>[d(r(o(N.raw)),1)]),_:2},1032,["color"])):(_(),B(me,{key:1,size:"x-small",color:"warning",variant:"tonal","prepend-icon":"mdi-alert"},{default:t(()=>a[18]||(a[18]=[d(" Kosong ")])),_:1,__:[18]}))]),default:t(()=>[e(ot,null,{default:t(()=>[d(r(N.raw.name),1)]),_:2},1024),e(dt,{class:"text-medium-emphasis"},{default:t(()=>[R(N.raw)<=0?(_(),te("span",Ga,[e(V,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),a[17]||(a[17]=d(" Stok Kosong - Masih bisa digunakan "))])):(_(),te("span",Wa," Stok: "+r(R(N.raw))+" "+r(N.raw.unit),1))]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e(D,{cols:"12",md:"2"},{default:t(()=>[e(he,{modelValue:u.value.quantity,"onUpdate:modelValue":a[1]||(a[1]=h=>u.value.quantity=h),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"2"},{default:t(()=>[e(he,{modelValue:u.value.unit,"onUpdate:modelValue":a[2]||(a[2]=h=>u.value.unit=h),label:"Satuan",variant:"outlined",placeholder:"kg, pcs, ml",readonly:!!U.value,hint:U.value?`Satuan dari item: ${U.value}`:"","persistent-hint":""},null,8,["modelValue","readonly","hint"])]),_:1}),e(D,{cols:"12",md:"2"},{default:t(()=>[e(ct,{modelValue:u.value.isCritical,"onUpdate:modelValue":a[3]||(a[3]=h=>u.value.isCritical=h),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"2"},{default:t(()=>[e(q,{color:x.value?"success":"primary",block:"","prepend-icon":x.value?"mdi-check":"mdi-plus",onClick:a[4]||(a[4]=h=>x.value?Me():De()),disabled:!f.value},{default:t(()=>[d(r(x.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),x.value?(_(),B(q,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:Se},{default:t(()=>a[19]||(a[19]=[d(" Batal ")])),_:1,__:[19]})):j("",!0)]),_:1})]),_:1}),ne.value?(_(),B(Ee,{key:0,color:"warning",variant:"tonal",class:"mt-4","prepend-icon":"mdi-alert"},{default:t(()=>[e(ft,null,{default:t(()=>a[20]||(a[20]=[d("Item Stok Kosong")])),_:1,__:[20]}),a[21]||(a[21]=l("div",null,"Item yang dipilih sedang kosong stok, namun masih bisa ditambahkan ke komposisi. Pastikan untuk memperbarui stok sebelum produksi.",-1))]),_:1,__:[21]})):j("",!0)]),_:1})]),_:1}),e(ae,{elevation:"2"},{default:t(()=>[e(Pe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e(V,{icon:"mdi-format-list-bulleted",class:"me-2"}),d(" Daftar Item Komposisi ("+r(J.value.length)+") ",1)]),_:1}),e(ie,{class:"pa-0"},{default:t(()=>[J.value.length===0?(_(),te("div",Qa,[e(V,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),a[22]||(a[22]=l("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),a[23]||(a[23]=l("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(_(),B(_t,{key:1},{default:t(()=>[(_(!0),te(ze,null,We(J.value,(h,N)=>(_(),B(Ge,{key:h.id||N,class:"border-b"},{prepend:t(()=>[e(Ie,{size:"40",class:"me-3"},{default:t(()=>{var w,se;return[e(V,{icon:(w=h.item)!=null&&w.inventory&&h.item.inventory.current_stock>=h.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(se=h.item)!=null&&se.inventory&&h.item.inventory.current_stock>=h.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[l("div",Ya,[e(q,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:w=>oe(h,N)},null,8,["onClick"]),e(q,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:w=>Xe(N)},null,8,["onClick"])])]),default:t(()=>[e(ot,{class:"font-weight-medium"},{default:t(()=>{var w;return[d(r(((w=h.item)==null?void 0:w.name)||"Item tidak ditemukan")+" ",1),h.is_critical?(_(),B(me,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>a[24]||(a[24]=[d(" Kritis ")])),_:1,__:[24]})):j("",!0)]}),_:2},1024),e(dt,null,{default:t(()=>{var w;return[l("div",Xa,[l("span",null,"Dibutuhkan: "+r(parseFloat(h.quantity_needed))+" "+r(h.unit),1),(w=h.item)!=null&&w.inventory?(_(),te("span",{key:0,class:Qe(h.item.inventory.current_stock>=h.quantity_needed?"text-success":"text-error")}," Stok: "+r(h.item.inventory.current_stock)+" "+r(h.unit),3)):j("",!0),h.formatted_total_cost?(_(),te("span",Za,r(h.formatted_total_cost),1)):j("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(qe,{class:"pa-6 pt-0"},{default:t(()=>[e(q,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:C},{default:t(()=>a[25]||(a[25]=[d(" Setting HPP ")])),_:1,__:[25]}),e(je),e(q,{variant:"outlined",onClick:Be},{default:t(()=>a[26]||(a[26]=[d(" Batal ")])),_:1,__:[26]}),e(q,{color:"primary",onClick:Ze,loading:y.value},{default:t(()=>a[27]||(a[27]=[d(" Simpan Komposisi ")])),_:1,__:[27]},8,["loading"])]),_:1})]),_:1}),e(st,{modelValue:$.value,"onUpdate:modelValue":a[6]||(a[6]=h=>$.value=h),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(q,{color:"white",variant:"text",onClick:a[5]||(a[5]=h=>$.value=!1)},{default:t(()=>a[28]||(a[28]=[d(" Tutup ")])),_:1,__:[28]})]),default:t(()=>[d(r(b.value)+" ",1)]),_:1},8,["modelValue"]),e(st,{modelValue:c.value,"onUpdate:modelValue":a[8]||(a[8]=h=>c.value=h),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(q,{color:"white",variant:"text",onClick:a[7]||(a[7]=h=>c.value=!1)},{default:t(()=>a[29]||(a[29]=[d(" Tutup ")])),_:1,__:[29]})]),default:t(()=>[d(r(ee.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(qt,{modelValue:pe.value,"onUpdate:modelValue":a[10]||(a[10]=h=>pe.value=h),"product-id":parseInt(String(((p=n.product)==null?void 0:p.id_product)||((z=n.product)==null?void 0:z.id)||"0")),"product-name":((F=n.product)==null?void 0:F.product_name)||((P=n.product)==null?void 0:P.name),onHppUpdated:ge,onPriceUpdated:a[11]||(a[11]=h=>M("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),Ft=Je(el,[["__scopeId","data-v-9c392eac"]]),tl={class:"composition-cards"},al={key:1,class:"text-center pa-12"},ll={key:2,class:"text-center pa-12"},ol={class:"d-flex align-center gap-3"},sl={class:"flex-grow-1 min-width-0"},il={class:"text-h6 font-weight-bold text-truncate"},nl={class:"text-caption text-medium-emphasis mb-0"},rl={class:"d-flex align-center gap-2 mb-3"},ul={class:"text-body-2 font-weight-medium"},dl={class:"composition-items"},cl={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},ml={class:"text-body-2 text-truncate"},vl={class:"text-end flex-shrink-0"},pl={class:"text-body-2 font-weight-medium"},fl={key:0,class:"text-caption text-success"},gl={key:1,class:"text-caption text-primary"},_l={class:"d-flex justify-between align-center mb-3"},kl={class:"text-h6 font-weight-bold text-primary"},yl={class:"d-flex gap-2"},bl={class:"d-flex align-center"},hl={class:"d-flex align-center gap-4"},xl={class:"flex-grow-1"},wl={class:"text-h5 font-weight-bold mb-2"},Pl={class:"d-flex align-center gap-4 mb-2"},Vl={class:"text-body-2"},Cl={class:"d-flex align-center gap-4"},Il={class:"text-h6 text-primary font-weight-bold"},Sl={class:"text-body-2 text-info font-weight-medium"},$l={key:0,class:"text-body-2 text-success font-weight-medium"},Dl={class:"d-flex align-center mt-1 gap-4"},Ul={class:"d-flex align-center"},zl={class:"d-flex align-center"},Al={key:0,class:"d-flex align-center"},Tl={class:"text-primary font-weight-medium"},Hl={key:1,class:"text-center py-8"},Ml={class:"text-h6 font-weight-bold"},Fl={class:"text-h6 font-weight-bold"},El={class:"text-h6 font-weight-bold"},Kl={class:"text-h6 font-weight-bold"},Bl={class:"text-h6 font-weight-bold"},ql=Re({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup(I,{emit:ke}){const H=I,M=ke,L=A(!1),y=A(!1),J=A(null),$=A([]),c=A(null),b=A({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),ee=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],x=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],Z=k=>{J.value=k,$.value=k.items||[],L.value=!0},pe=k=>{c.value=k,y.value=!0},re=k=>{console.log("Composition saved:",k),M("refresh")},K=()=>{b.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},ce=fe(()=>!!(b.value.search||b.value.stockStatus||b.value.itemType||b.value.criticalOnly||b.value.sortBy!=="name_asc")),ve=fe(()=>{let k=0;return b.value.search&&k++,b.value.stockStatus&&k++,b.value.itemType&&k++,b.value.criticalOnly&&k++,b.value.sortBy!=="name_asc"&&k++,k}),O=fe(()=>{const k=new Map;H.productItems.forEach(f=>{if(!f.product)return;const U=f.product.id_product||f.product.id;k.has(U)||k.set(U,{...f.product,items:[],totalItems:0}),k.get(U).items.push(f),k.get(U).totalItems++});let s=Array.from(k.values());if(b.value.search){const f=b.value.search.toLowerCase();s=s.filter(U=>U.name.toLowerCase().includes(f)||U.sku&&U.sku.toLowerCase().includes(f)||U.items.some(le=>{var ne;return(ne=le.item)==null?void 0:ne.name.toLowerCase().includes(f)}))}return b.value.stockStatus&&(s=s.filter(f=>{const U=W(f);switch(b.value.stockStatus){case"safe":return U.color==="success";case"critical":return U.color==="warning";case"out":return U.color==="error";default:return!0}})),b.value.criticalOnly&&(s=s.filter(f=>f.items.some(U=>U.is_critical))),s.sort((f,U)=>{switch(b.value.sortBy){case"name_asc":return f.name.localeCompare(U.name);case"name_desc":return U.name.localeCompare(f.name);case"price_asc":return(f.price||0)-(U.price||0);case"price_desc":return(U.price||0)-(f.price||0);case"items_asc":return f.totalItems-U.totalItems;case"items_desc":return U.totalItems-f.totalItems;default:return f.name.localeCompare(U.name)}}),s}),W=k=>{let s=!1,f=!1;return k.items.forEach(U=>{var le;if((le=U.item)!=null&&le.inventory){const ne=U.item.inventory.current_stock||0,ue=U.quantity_needed||0;ne<=0?s=!0:(ne<ue||U.is_critical)&&(f=!0)}}),s?{text:"Stok Habis",color:"error"}:f?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},u=k=>{if(!(k!=null&&k.inventory))return"grey";const s=k.inventory.current_stock||0;return s<=0?"error":s<=10?"warning":"success"},g=k=>{if(!(k!=null&&k.inventory))return"Tidak ada data";const s=k.inventory.current_stock||0;return s<=0?"Habis":s<=10?"Rendah":"Aman"},T=k=>{const s=u(k);return{"text-error":s==="error","text-warning":s==="warning","text-success":s==="success","text-grey":s==="grey"}},v=k=>`Item Komposisi (${k})`;return(k,s)=>(_(),te("div",tl,[e(ae,{class:"mb-6"},{default:t(()=>[e(Pe,{class:"d-flex align-center justify-between"},{default:t(()=>[s[12]||(s[12]=l("div",null,[l("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),l("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),e(q,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:s[0]||(s[0]=f=>M("refresh")),loading:k.loading},{default:t(()=>s[11]||(s[11]=[d(" Refresh ")])),_:1,__:[11]},8,["loading"])]),_:1,__:[12]})]),_:1}),e(ae,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(D,{cols:"12",md:"3"},{default:t(()=>[e(he,{modelValue:b.value.search,"onUpdate:modelValue":s[1]||(s[1]=f=>b.value.search=f),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(Ke,{modelValue:b.value.stockStatus,"onUpdate:modelValue":s[2]||(s[2]=f=>b.value.stockStatus=f),items:ee,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(Ke,{modelValue:b.value.sortBy,"onUpdate:modelValue":s[3]||(s[3]=f=>b.value.sortBy=f),items:x,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(ca,{modelValue:b.value.criticalOnly,"onUpdate:modelValue":s[4]||(s[4]=f=>b.value.criticalOnly=f),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Ce,{class:"mt-3"},{default:t(()=>[e(D,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(q,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:K,disabled:!ce.value},{default:t(()=>s[13]||(s[13]=[d(" Reset Filter ")])),_:1,__:[13]},8,["disabled"]),ce.value?(_(),B(me,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[d(r(ve.value)+" filter aktif ",1)]),_:1})):j("",!0)]),_:1}),e(D,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(me,{color:O.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[d(r(O.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!k.loading&&O.value.length===0&&ce.value?(_(),B(Ee,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):j("",!0),k.loading?(_(),te("div",al,[e(gt,{color:"primary",indeterminate:"",size:"64"}),s[14]||(s[14]=l("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):O.value.length===0?(_(),te("div",ll,[e(V,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),s[16]||(s[16]=l("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),s[17]||(s[17]=l("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(q,{color:"primary",size:"large","prepend-icon":"mdi-plus"},{default:t(()=>s[15]||(s[15]=[d(" Buat Komposisi Pertama ")])),_:1,__:[15]})])):(_(),B(Ce,{key:3},{default:t(()=>[(_(!0),te(ze,null,We(O.value,f=>(_(),B(D,{key:f.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ae,{class:Qe(["composition-card h-100",{"border-error":W(f).color==="error"}]),elevation:"2"},{default:t(()=>[e(Pe,{class:"pa-4 pb-2"},{default:t(()=>[l("div",ol,[e(Ie,{image:f.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[f.image_url?j("",!0):(_(),B(V,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),l("div",sl,[l("h3",il,r(f.name),1),l("p",nl,r(f.sku||"SKU-"+f.id_product),1)])])]),_:2},1024),e(ie,{class:"py-2"},{default:t(()=>[e(me,{color:W(f).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[d(r(W(f).text),1)]),_:2},1032,["color"]),l("div",rl,[e(V,{icon:"mdi-format-list-bulleted",size:"16"}),l("span",ul,r(v(f.totalItems)),1)]),l("div",dl,[(_(!0),te(ze,null,We(f.items,U=>{var le,ne,ue,R;return _(),te("div",{key:U.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[l("div",cl,[e(V,{icon:(le=U.item)!=null&&le.inventory&&U.item.inventory.current_stock>=U.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(ne=U.item)!=null&&ne.inventory&&U.item.inventory.current_stock>=U.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),l("span",ml,r(((ue=U.item)==null?void 0:ue.name)||"Item tidak ditemukan"),1),U.is_critical?(_(),B(me,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>s[18]||(s[18]=[d(" Kritis ")])),_:1,__:[18]})):j("",!0)]),l("div",vl,[l("div",pl,r(parseFloat(U.quantity_needed))+" "+r(U.unit),1),(R=U.item)!=null&&R.inventory?(_(),te("div",fl," Stok: "+r(U.item.inventory.current_stock)+" "+r(U.unit),1)):j("",!0),U.formatted_total_cost?(_(),te("div",gl,r(U.formatted_total_cost),1)):j("",!0)])])}),128))])]),_:2},1024),e(ie,{class:"pt-0"},{default:t(()=>[e(Ae,{class:"mb-3"}),l("div",_l,[s[19]||(s[19]=l("span",{class:"text-body-2"},"Harga:",-1)),l("span",kl,r(E(Te)(f.price||0)),1)]),l("div",yl,[e(q,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:U=>pe(f)},{default:t(()=>s[20]||(s[20]=[d(" Detail ")])),_:2,__:[20]},1032,["onClick"]),e(q,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:U=>Z(f)},{default:t(()=>s[21]||(s[21]=[d(" Kelola ")])),_:2,__:[21]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(Ft,{modelValue:L.value,"onUpdate:modelValue":s[5]||(s[5]=f=>L.value=f),product:J.value,items:$.value,onSave:re,onRefresh:s[6]||(s[6]=f=>M("refresh"))},null,8,["modelValue","product","items"]),e(Oe,{modelValue:y.value,"onUpdate:modelValue":s[10]||(s[10]=f=>y.value=f),"max-width":"900",scrollable:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",bl,[e(V,{icon:"mdi-eye",class:"mr-2",color:"primary"}),s[22]||(s[22]=l("span",null,"Detail Komposisi Produk",-1))]),e(q,{icon:"",variant:"text",onClick:s[7]||(s[7]=f=>y.value=!1)},{default:t(()=>[e(V,{icon:"mdi-close"})]),_:1})]),_:1}),e(Ae),c.value?(_(),B(ie,{key:0},{default:t(()=>[e(ma,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(D,{cols:"12"},{default:t(()=>[e(ae,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(ie,null,{default:t(()=>[l("div",hl,[e(Ie,{image:c.value.image_url,size:"80"},{default:t(()=>[c.value.image_url?j("",!0):(_(),B(V,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),l("div",xl,[l("h2",wl,r(c.value.name),1),l("div",Pl,[e(me,{color:W(c.value).color,variant:"tonal",size:"small"},{default:t(()=>[d(r(W(c.value).text),1)]),_:1},8,["color"]),l("span",Vl,"SKU: "+r(c.value.sku||"-"),1)]),l("div",Cl,[l("div",Il,r(E(Te)(c.value.price||0)),1),l("div",Sl," HPP: "+r(E(Te)(c.value.hpp||c.value.cost||0)),1),c.value.price&&(c.value.hpp||c.value.cost)?(_(),te("div",$l," Margin: "+r(E(Te)((c.value.price||0)-(c.value.hpp||c.value.cost||0))),1)):j("",!0)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e(Ce,null,{default:t(()=>[e(D,{cols:"12"},{default:t(()=>[e(ae,{variant:"outlined"},{default:t(()=>[e(Pe,{class:"text-h6"},{default:t(()=>[e(V,{icon:"mdi-format-list-bulleted",class:"mr-2"}),d(" Komposisi Item ("+r(c.value.totalItems||0)+") ",1)]),_:1}),e(ie,null,{default:t(()=>[c.value.items&&c.value.items.length>0?(_(),B(_t,{key:0},{default:t(()=>[(_(!0),te(ze,null,We(c.value.items,(f,U)=>(_(),B(Ge,{key:f.id_product_item,class:"px-0"},{prepend:t(()=>[e(Ie,{size:"40",color:u(f.item),variant:"tonal"},{default:t(()=>{var le;return[e(V,{icon:(le=f.item)!=null&&le.inventory&&f.item.inventory.current_stock>=f.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(me,{color:u(f.item),variant:"tonal",size:"small"},{default:t(()=>[d(r(g(f.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(ot,{class:"font-weight-medium"},{default:t(()=>{var le;return[d(r(((le=f.item)==null?void 0:le.name)||"Unknown Item")+" ",1),f.is_critical?(_(),B(me,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>s[23]||(s[23]=[d(" Kritis ")])),_:1,__:[23]})):j("",!0)]}),_:2},1024),e(dt,null,{default:t(()=>{var le,ne;return[l("div",Dl,[l("div",Ul,[e(V,{icon:"mdi-scale",size:"14",class:"mr-1"}),l("span",null," Kebutuhan: "+r(Number(f.quantity_needed||0).toLocaleString("id-ID"))+" "+r(f.unit),1)]),l("div",zl,[e(V,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),l("span",{class:Qe(T(f.item))}," Stok: "+r(Number(((ne=(le=f.item)==null?void 0:le.inventory)==null?void 0:ne.current_stock)||0).toLocaleString("id-ID"))+" "+r(f.unit),3)]),f.formatted_total_cost?(_(),te("div",Al,[e(V,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),l("span",Tl,r(f.formatted_total_cost),1)])):j("",!0)])]}),_:2},1024),U<c.value.items.length-1?(_(),B(Ae,{key:0,class:"mt-3"})):j("",!0)]),_:2},1024))),128))]),_:1})):(_(),te("div",Hl,[e(V,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),s[24]||(s[24]=l("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(Ce,{class:"mt-4"},{default:t(()=>[e(D,{cols:"12",md:"2"},{default:t(()=>[e(ae,{variant:"outlined",color:"primary"},{default:t(()=>[e(ie,{class:"text-center"},{default:t(()=>[e(V,{icon:"mdi-format-list-bulleted",size:"24",class:"mb-2"}),l("div",Ml,r(c.value.totalItems||0),1),s[25]||(s[25]=l("div",{class:"text-caption"},"Total Item",-1))]),_:1,__:[25]})]),_:1})]),_:1}),e(D,{cols:"12",md:"2"},{default:t(()=>[e(ae,{variant:"outlined",color:"warning"},{default:t(()=>[e(ie,{class:"text-center"},{default:t(()=>{var f;return[e(V,{icon:"mdi-alert",size:"24",class:"mb-2"}),l("div",Fl,r(((f=c.value.items)==null?void 0:f.filter(U=>U.is_critical).length)||0),1),s[26]||(s[26]=l("div",{class:"text-caption"},"Item Kritis",-1))]}),_:1,__:[26]})]),_:1})]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(ae,{variant:"outlined",color:"info"},{default:t(()=>[e(ie,{class:"text-center"},{default:t(()=>[e(V,{icon:"mdi-calculator",size:"24",class:"mb-2"}),l("div",El,r(E(Te)(c.value.hpp||c.value.cost||0)),1),s[27]||(s[27]=l("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[27]})]),_:1})]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(ae,{variant:"outlined",color:"success"},{default:t(()=>[e(ie,{class:"text-center"},{default:t(()=>[e(V,{icon:"mdi-currency-usd",size:"24",class:"mb-2"}),l("div",Kl,r(E(Te)(c.value.price||0)),1),s[28]||(s[28]=l("div",{class:"text-caption"},"Harga Jual",-1))]),_:1,__:[28]})]),_:1})]),_:1}),e(D,{cols:"12",md:"2"},{default:t(()=>[e(ae,{variant:"outlined",color:"purple"},{default:t(()=>[e(ie,{class:"text-center"},{default:t(()=>[e(V,{icon:"mdi-trending-up",size:"24",class:"mb-2"}),l("div",Bl,r(E(Te)((c.value.price||0)-(c.value.hpp||c.value.cost||0))),1),s[29]||(s[29]=l("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[29]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0),e(Ae),e(qe,{class:"pa-4"},{default:t(()=>[e(je),e(q,{variant:"outlined",onClick:s[8]||(s[8]=f=>y.value=!1)},{default:t(()=>s[30]||(s[30]=[d(" Tutup ")])),_:1,__:[30]}),e(q,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:s[9]||(s[9]=()=>{y.value=!1,Z(c.value)})},{default:t(()=>s[31]||(s[31]=[d(" Kelola Komposisi ")])),_:1,__:[31]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),Rl=Je(ql,[["__scopeId","data-v-4b5ad2d5"]]),Nl={class:"d-flex align-center gap-2"},Ll={class:"text-white"},Ol={class:"text-h6 mb-4 d-flex align-center gap-2"},jl={class:"text-h6 mb-4 d-flex align-center gap-2"},Jl={class:"d-flex flex-column gap-2"},Gl={key:0,class:"d-flex align-center gap-2"},Wl={class:"d-flex align-center gap-2 mb-2"},Ql={class:"d-flex gap-2"},Xl={class:"d-flex gap-2"},Zl={class:"d-flex align-center justify-space-between"},Yl={class:"d-flex align-center gap-2"},eo={class:"text-end"},to={class:"text-h6 font-weight-bold"},ao={class:"text-caption"},lo={class:"text-h6 mb-4 d-flex align-center gap-2"},oo={class:"text-h6 mb-4 d-flex align-center gap-2"},so={class:"image-upload-container"},io={key:0,class:"mb-4"},no={class:"text-center mt-2"},ro={class:"text-h6 mb-4 d-flex align-center gap-2"},uo={class:"text-h6 mb-4 d-flex align-center gap-2"},co={class:"d-flex align-center"},mo={class:"text-subtitle-1"},vo={class:"text-body-1"},po={class:"d-flex align-center"},fo={class:"text-subtitle-1"},go=Re({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup(I,{emit:ke}){var R,S,m;const H=Ht(),{nameRules:M,categoryRules:L}=Mt(),{getProductHPPBreakdown:y}=wt(),J=A(!1),$=A(!1),c=async()=>{if(!(!x.editMode||!K.id))try{const o=await fetch(`/api/products/${K.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(o.ok){const i=await o.json();$.value=i.success&&i.data&&i.data.length>0}}catch(o){console.error("Error checking HPP status:",o)}},b=async()=>{if(K.id)try{J.value=!0;const o=await y(K.id,"latest");o&&(K.cost=o.total_hpp,pe("update-form","cost",o.total_hpp))}catch(o){console.error("Error refreshing HPP:",o)}finally{J.value=!1}},ee=()=>{console.log("Open items setup for product:",K.id)},x=I,Z=fe(()=>x.errorMessage),pe=ke,re=A(),K=xt({...x.formData});we(()=>x.formData,o=>{Object.assign(K,o)},{deep:!0}),we(K,o=>{Object.keys(o).forEach(i=>{pe("update-form",i,o[i])})},{deep:!0}),we(()=>x.modelValue,o=>{o&&x.editMode&&c()});const ce=xt({length:((R=x.formData.dimensions)==null?void 0:R.length)||null,width:((S=x.formData.dimensions)==null?void 0:S.width)||null,height:((m=x.formData.dimensions)==null?void 0:m.height)||null});we(ce,o=>{const i=o.length!==null||o.width!==null||o.height!==null;K.dimensions=i?{length:o.length!==null?o.length:void 0,width:o.width!==null?o.width:void 0,height:o.height!==null?o.height:void 0}:{}},{deep:!0});const ve=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],O=fe(()=>{if(!K.price||!K.cost||K.cost<=0)return 0;const o=(K.price-K.cost)/K.cost*100;return Math.ceil(o)}),W=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),u=o=>o<10?"error":o<25?"warning":o<50?"success":"info",g=o=>o<10?"tabler-trending-down":o<25?"tabler-trending-up":o<50?"tabler-trending-up-2":"tabler-trending-up-3",T=o=>!o||o===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),v=o=>{if(!o||o.trim()===""||o==="Rp 0")return 0;const C=o.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(C)||0},k=A(!1),s=o=>{const i=v(o);K.price=i},f=()=>{k.value=!0},U=()=>{k.value=!1},le=async()=>{var i;const{valid:o}=await((i=re.value)==null?void 0:i.validate());o&&pe("submit",K)},ne=o=>{pe("image-change",o)},ue=()=>{pe("remove-image")};return(o,i)=>(_(),B(Oe,{"model-value":o.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":i[25]||(i[25]=C=>o.$emit("update:modelValue",C))},{default:t(()=>[e(ae,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[l("div",Nl,[e(V,{icon:o.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),l("span",Ll,r(o.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(q,{icon:"tabler-x",variant:"text",color:"white",onClick:i[0]||(i[0]=C=>o.$emit("close"))})]),_:1}),e(Ae),e(ie,{class:"pa-6"},{default:t(()=>[e(Ct,{ref_key:"formRef",ref:re,onSubmit:Pt(le,["prevent"])},{default:t(()=>[e(Ce,null,{default:t(()=>[e(D,{cols:"12"},{default:t(()=>[l("h6",Ol,[e(V,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),i[26]||(i[26]=d(" Informasi Dasar "))])]),_:1}),e(D,{cols:"12",md:"8"},{default:t(()=>[e(he,{modelValue:K.name,"onUpdate:modelValue":i[1]||(i[1]=C=>K.name=C),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:E(M),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:K.sku,"onUpdate:modelValue":i[2]||(i[2]=C=>K.sku=C),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(D,{cols:"12"},{default:t(()=>[e(zt,{modelValue:K.description,"onUpdate:modelValue":i[3]||(i[3]=C=>K.description=C),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(Ke,{"model-value":K.category_id,"onUpdate:modelValue":i[4]||(i[4]=C=>K.category_id=C),items:o.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:E(L),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(he,{modelValue:K.brand,"onUpdate:modelValue":i[5]||(i[5]=C=>K.brand=C),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(D,{cols:"12"},{default:t(()=>[l("h6",jl,[e(V,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),i[27]||(i[27]=d(" Harga & Biaya "))])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(he,{"model-value":T(K.price),"onUpdate:modelValue":i[6]||(i[6]=C=>s(C)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:f,onBlur:U},null,8,["model-value"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[l("div",Jl,[e(he,{"model-value":T(K.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),o.editMode?(_(),te("div",Gl,[e(me,{color:$.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e(V,{icon:$.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),d(" "+r($.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),$.value?(_(),B(q,{key:0,size:"small",variant:"outlined",color:"primary",onClick:b,loading:J.value},{default:t(()=>[e(V,{icon:"tabler-refresh",size:"14",class:"me-1"}),i[28]||(i[28]=d(" Update HPP "))]),_:1,__:[28]},8,["loading"])):(_(),B(Fe,{key:1},{activator:t(({props:C})=>[e(me,Ve(C,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e(V,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),i[29]||(i[29]=d(" Belum Ada Resep "))]),_:2,__:[29]},1040)]),default:t(()=>[i[30]||(i[30]=l("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[30]}))])):j("",!0)])]),_:1}),o.editMode?(_(),B(D,{key:0,cols:"12"},{default:t(()=>[$.value?(_(),B(Ee,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ft,null,{default:t(()=>[e(V,{icon:"tabler-info-circle",class:"me-2"}),i[31]||(i[31]=d(" HPP Otomatis Aktif "))]),_:1,__:[31]}),i[32]||(i[32]=l("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[32]})):(_(),B(Ee,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ft,null,{default:t(()=>[e(V,{icon:"tabler-alert-triangle",class:"me-2"}),i[33]||(i[33]=d(" HPP Manual "))]),_:1,__:[33]}),i[34]||(i[34]=l("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[34]}))]),_:1})):j("",!0),e(D,{cols:"12"},{default:t(()=>[$.value&&o.editMode?(_(),B(Ee,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[l("div",Wl,[e(V,{icon:"tabler-check-circle"}),i[35]||(i[35]=l("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),i[38]||(i[38]=l("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),l("div",Ql,[e(q,{size:"small",color:"primary",variant:"outlined",onClick:ee},{default:t(()=>[e(V,{icon:"tabler-edit",size:"14",class:"me-1"}),i[36]||(i[36]=d(" Edit Resep "))]),_:1,__:[36]}),e(q,{size:"small",variant:"outlined",color:"info",onClick:b,loading:J.value},{default:t(()=>[e(V,{icon:"tabler-refresh",size:"14",class:"me-1"}),i[37]||(i[37]=d(" Refresh HPP "))]),_:1,__:[37]},8,["loading"])])]),_:1,__:[38]})):!$.value&&o.editMode?(_(),B(Ee,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[l("div",Xl,[e(q,{size:"small",variant:"outlined",color:"info",onClick:i[7]||(i[7]=C=>E(H).push("/hpp-management"))},{default:t(()=>[e(V,{icon:"tabler-calculator",size:"14",class:"me-1"}),i[39]||(i[39]=d(" Lihat HPP Management "))]),_:1,__:[39]})])]),_:1})):j("",!0)]),_:1}),e(D,{cols:"12"},{default:t(()=>[K.price&&K.cost&&K.cost>0?(_(),B(Ee,{key:0,color:u(O.value),variant:"tonal",class:"mb-0"},{default:t(()=>[l("div",Zl,[l("div",Yl,[e(V,{icon:g(O.value)},null,8,["icon"]),i[40]||(i[40]=l("span",{class:"font-weight-medium"},"Profit Margin",-1))]),l("div",eo,[l("div",to,r(Math.round(O.value))+"%",1),l("div",ao," Keuntungan: "+r(W(K.price-K.cost)),1)])])]),_:1},8,["color"])):j("",!0)]),_:1}),e(D,{cols:"12"},{default:t(()=>[l("h6",lo,[e(V,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),i[41]||(i[41]=d(" Dimensi (cm) "))])]),_:1}),e(D,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:ce.length,"onUpdate:modelValue":i[8]||(i[8]=C=>ce.length=C),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:ce.width,"onUpdate:modelValue":i[9]||(i[9]=C=>ce.width=C),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:ce.height,"onUpdate:modelValue":i[10]||(i[10]=C=>ce.height=C),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(D,{cols:"12"},{default:t(()=>[l("h6",oo,[e(V,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),i[42]||(i[42]=d(" Gambar Produk "))])]),_:1}),e(D,{cols:"12"},{default:t(()=>[l("div",so,[o.imagePreview?(_(),te("div",io,[e(ga,{src:o.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),l("div",no,[e(q,{size:"small",color:"error",variant:"outlined",onClick:ue},{default:t(()=>i[43]||(i[43]=[d(" Hapus Gambar ")])),_:1,__:[43]})])])):j("",!0),e(_a,{"model-value":o.selectedImage,"onUpdate:modelValue":i[11]||(i[11]=C=>ne(Array.isArray(C)?C:[C])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),i[44]||(i[44]=l("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e(D,{cols:"12"},{default:t(()=>[l("h6",ro,[e(V,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),i[45]||(i[45]=d(" Pengaturan "))])]),_:1}),e(D,{cols:"12",md:"4"},{default:t(()=>[e(Ke,{"model-value":K.status,"onUpdate:modelValue":i[12]||(i[12]=C=>K.status=C),items:ve,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e(D,{cols:"12",md:"4"},{default:t(()=>[e(ct,{"model-value":K.active,"onUpdate:modelValue":i[13]||(i[13]=C=>K.active=C??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(D,{cols:"12",md:"4"},{default:t(()=>[e(ct,{"model-value":K.featured,"onUpdate:modelValue":i[14]||(i[14]=C=>K.featured=C??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(D,{cols:"12"},{default:t(()=>[l("h6",uo,[e(V,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),i[46]||(i[46]=d(" SEO (Opsional) "))])]),_:1}),e(D,{cols:"12"},{default:t(()=>[e(he,{modelValue:K.meta_title,"onUpdate:modelValue":i[15]||(i[15]=C=>K.meta_title=C),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(D,{cols:"12"},{default:t(()=>[e(zt,{modelValue:K.meta_description,"onUpdate:modelValue":i[16]||(i[16]=C=>K.meta_description=C),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(D,{cols:"12"},{default:t(()=>[e(Ua,{"model-value":K.tags,"onUpdate:modelValue":i[17]||(i[17]=C=>K.tags=C),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Ae),e(qe,{class:"pa-6"},{default:t(()=>[e(je),e(q,{variant:"outlined",class:"coffee-secondary",onClick:i[18]||(i[18]=C=>o.$emit("close"))},{default:t(()=>i[47]||(i[47]=[d(" Batal ")])),_:1,__:[47]}),e(q,{color:"primary",class:"coffee-primary",loading:o.loading,onClick:le},{default:t(()=>[d(r(o.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),o.useDialogError?j("",!0):(_(),B(st,{key:0,"model-value":!!Z.value,"onUpdate:modelValue":i[20]||(i[20]=C=>!C&&o.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(q,{icon:"tabler-x",size:"small",variant:"text",onClick:i[19]||(i[19]=C=>o.$emit("clear-error"))})]),default:t(()=>[l("div",co,[e(V,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),l("div",null,[i[48]||(i[48]=l("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),l("div",mo,r(Z.value),1)])])]),_:1},8,["model-value"])),o.useDialogError?(_(),B(Oe,{key:1,"model-value":!!Z.value,"onUpdate:modelValue":i[22]||(i[22]=C=>!C&&o.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center text-error"},{default:t(()=>[e(V,{icon:"tabler-alert-circle",class:"me-2"}),i[49]||(i[49]=d(" Error Occurred "))]),_:1,__:[49]}),e(Ae),e(ie,{class:"py-4"},{default:t(()=>[l("div",vo,r(Z.value),1)]),_:1}),e(Ae),e(qe,{class:"justify-end pa-4"},{default:t(()=>[e(q,{color:"error",variant:"outlined",onClick:i[21]||(i[21]=C=>o.$emit("clear-error"))},{default:t(()=>i[50]||(i[50]=[d(" Close ")])),_:1,__:[50]})]),_:1})]),_:1})]),_:1},8,["model-value"])):j("",!0),e(st,{"model-value":!!o.successMessage,"onUpdate:modelValue":i[24]||(i[24]=C=>!C&&o.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(q,{icon:"tabler-x",size:"small",variant:"text",onClick:i[23]||(i[23]=C=>o.$emit("clear-success"))})]),default:t(()=>[l("div",po,[e(V,{icon:"tabler-check-circle",class:"me-3",size:"28"}),l("div",null,[i[51]||(i[51]=l("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),l("div",fo,r(o.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),_o=Je(go,[["__scopeId","data-v-66fc4b3b"]]),ko={key:0,class:"mt-4"},yo={class:"d-flex align-center gap-2 mb-2"},bo={class:"d-flex flex-wrap gap-2"},ho=Re({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup(I,{emit:ke}){const H=I,M=ke,{categories:L,loading:y,fetchAllCategories:J}=ka(),$=A(!1),c=A("");it(async()=>{console.log("ProductSearchFilters mounted, fetching categories..."),await J(),console.log("Categories loaded in ProductSearchFilters:",L.value.length),c.value=b.search||""});const b=xt({...H.filters});we(()=>H.filters,W=>{Object.assign(b,W),c.value=W.search||""},{deep:!0}),ta(c,W=>{console.log("ðŸ” Search query changed:",W),b.search=W,W.length>=3||W.length===0?(console.log("âœ… Triggering search with query:",W),$.value=!0,M("search",W),re(),setTimeout(()=>{$.value=!1},500)):console.log("â³ Query too short, waiting for more characters:",W.length)},{debounce:500,maxWait:1e3});const ee=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],x=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],Z=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],pe=fe(()=>!!(c.value||b.category_id||b.active||b.stock_status||b.featured!==null||b.min_price||b.max_price)),re=()=>{M("update:filters",{...b})},K=()=>{c.value="",Object.assign(b,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),re()},ce=W=>{const u=L.value.find(g=>g.id_category===W);return(u==null?void 0:u.name)||"Unknown"},ve=W=>{if(!W)return"Semua";const u=ee.find(g=>g.value===W);return(u==null?void 0:u.title)||String(W)},O=W=>{const u=x.find(g=>g.value===W);return(u==null?void 0:u.title)||W};return(W,u)=>(_(),B(ae,{class:"mb-6"},{default:t(()=>[e(Pe,{class:"d-flex align-center gap-2"},{default:t(()=>[e(V,{icon:"tabler-filter",class:"coffee-icon"}),u[11]||(u[11]=d(" Filter & Pencarian Produk "))]),_:1,__:[11]}),e(ie,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(D,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=g=>c.value=g),label:"Cari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:$.value,clearable:"",variant:"outlined",hint:c.value.length>0&&c.value.length<3?`Ketik ${3-c.value.length} karakter lagi untuk mencari`:"","persistent-hint":""},null,8,["modelValue","loading","hint"])]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(Ke,{modelValue:b.category_id,"onUpdate:modelValue":[u[1]||(u[1]=g=>b.category_id=g),re],items:E(L),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:E(y),clearable:"",variant:"outlined"},{"no-data":t(()=>[e(Ge,null,{default:t(()=>[e(ot,null,{default:t(()=>[d(r(E(y)?"Memuat kategori...":"Tidak ada kategori"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading"])]),_:1}),e(D,{cols:"12",md:"2"},{default:t(()=>[e(Ke,{modelValue:b.active,"onUpdate:modelValue":[u[2]||(u[2]=g=>b.active=g),re],items:ee,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"2"},{default:t(()=>[e(Ke,{modelValue:b.stock_status,"onUpdate:modelValue":[u[3]||(u[3]=g=>b.stock_status=g),re],items:x,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(q,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:K})]),_:1})]),_:1}),e(Ce,{class:"mt-3"},{default:t(()=>[e(D,{cols:"12",md:"3"},{default:t(()=>[e(he,{modelValue:b.min_price,"onUpdate:modelValue":u[4]||(u[4]=g=>b.min_price=g),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:re},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(he,{modelValue:b.max_price,"onUpdate:modelValue":u[5]||(u[5]=g=>b.max_price=g),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:re},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"2"},{default:t(()=>[e(Ke,{modelValue:b.sort_order,"onUpdate:modelValue":[u[6]||(u[6]=g=>b.sort_order=g),re],items:Z,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),pe.value?(_(),te("div",ko,[l("div",yo,[e(V,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),u[12]||(u[12]=l("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),l("div",bo,[c.value?(_(),B(me,{key:0,closable:"",size:"small",color:"coffee","onClick:close":u[7]||(u[7]=g=>{c.value="",b.search="",re()})},{default:t(()=>[d(" Pencarian: "+r(c.value),1)]),_:1})):j("",!0),b.category_id?(_(),B(me,{key:1,closable:"",size:"small",color:"coffee","onClick:close":u[8]||(u[8]=g=>{b.category_id=null,re()})},{default:t(()=>[d(" Kategori: "+r(ce(b.category_id)),1)]),_:1})):j("",!0),b.active?(_(),B(me,{key:2,closable:"",size:"small",color:"coffee","onClick:close":u[9]||(u[9]=g=>{b.active=null,re()})},{default:t(()=>[d(" Status: "+r(ve(b.active)),1)]),_:1})):j("",!0),b.stock_status?(_(),B(me,{key:3,closable:"",size:"small",color:"coffee","onClick:close":u[10]||(u[10]=g=>{b.stock_status=null,re()})},{default:t(()=>[d(" Stok: "+r(O(b.stock_status)),1)]),_:1})):j("",!0)])])):j("",!0)]),_:1})]),_:1}))}}),xo=Je(ho,[["__scopeId","data-v-6c3b1b11"]]),wo={class:"d-flex align-center gap-2"},Po={class:"text-h6"},Vo={class:"d-flex align-center gap-2"},Co={class:"text-h6"},Io={class:"d-flex align-center gap-2"},So={class:"text-h6"},$o={class:"d-flex align-center gap-2"},Do={class:"text-h6"},Uo={class:"d-flex align-center gap-2"},zo={class:"text-h6"},Ao={class:"d-flex align-center gap-2"},To={class:"text-h6"},Ho={class:"d-flex align-center gap-2"},Mo={class:"text-h6"},Fo={class:"d-flex align-center gap-2"},Eo={class:"text-h6"},Ko=Re({__name:"ProductStatsCards",props:{stats:{}},setup(I){const ke=M=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(M),H=M=>`${M.toFixed(1)}%`;return(M,L)=>(_(),B(Ce,{class:"mb-6"},{default:t(()=>[e(D,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(ie,{class:"d-flex align-center"},{default:t(()=>{var y;return[e(Ie,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-package"})]),_:1}),l("div",null,[L[0]||(L[0]=l("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),l("div",wo,[l("h6",Po,r(((y=M.stats)==null?void 0:y.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(D,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(ie,{class:"d-flex align-center"},{default:t(()=>{var y;return[e(Ie,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-check"})]),_:1}),l("div",null,[L[1]||(L[1]=l("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),l("div",Vo,[l("h6",Co,r(((y=M.stats)==null?void 0:y.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(D,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(ie,{class:"d-flex align-center"},{default:t(()=>{var y;return[e(Ie,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-star"})]),_:1}),l("div",null,[L[2]||(L[2]=l("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),l("div",Io,[l("h6",So,r(((y=M.stats)==null?void 0:y.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(D,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(ie,{class:"d-flex align-center"},{default:t(()=>{var y;return[e(Ie,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-alert-triangle"})]),_:1}),l("div",null,[L[3]||(L[3]=l("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),l("div",$o,[l("h6",Do,r(((y=M.stats)==null?void 0:y.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(D,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(ie,{class:"d-flex align-center"},{default:t(()=>{var y;return[e(Ie,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-currency-dollar"})]),_:1}),l("div",null,[L[4]||(L[4]=l("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),l("div",Uo,[l("h6",zo,r(ke(((y=M.stats)==null?void 0:y.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(D,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(ie,{class:"d-flex align-center"},{default:t(()=>{var y;return[e(Ie,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-chart-line"})]),_:1}),l("div",null,[L[5]||(L[5]=l("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),l("div",Ao,[l("h6",To,r(ke(((y=M.stats)==null?void 0:y.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(D,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(ie,{class:"d-flex align-center"},{default:t(()=>{var y;return[e(Ie,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-trending-up"})]),_:1}),l("div",null,[L[6]||(L[6]=l("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),l("div",Ho,[l("h6",Mo,r(H(((y=M.stats)==null?void 0:y.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(D,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(ie,{class:"d-flex align-center"},{default:t(()=>{var y;return[e(Ie,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-x-circle"})]),_:1}),l("div",null,[L[7]||(L[7]=l("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),l("div",Fo,[l("h6",Eo,r(((y=M.stats)==null?void 0:y.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),Bo=Je(Ko,[["__scopeId","data-v-124783ae"]]),qo={class:"d-flex align-center gap-2"},Ro={class:"d-flex align-center gap-2"},No={class:"text-center py-8"},Lo={class:"d-flex align-center gap-3 py-2"},Oo={class:"font-weight-medium"},jo={class:"text-caption text-medium-emphasis"},Jo={class:"text-end"},Go={class:"font-weight-medium"},Wo={class:"text-caption text-medium-emphasis d-flex align-center justify-end gap-1"},Qo={class:"text-center profit-margin-container"},Xo={class:"text-center"},Zo={key:0,class:"text-caption text-medium-emphasis mt-1"},Yo={class:"d-flex align-center gap-2"},es={class:"text-body-2"},ts={class:"text-caption text-medium-emphasis"},as={class:"d-flex align-center gap-1"},ls=300*1e3,os=1e3,ss=Re({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","bulk-delete","update:page","update:items-per-page","update:sort-by","update:selected-products"],setup(I,{expose:ke}){const H=I,{currentHPPBreakdown:M,getProductHPPBreakdown:L}=wt(),y=A({}),J=A({}),$=A({}),c=A(new Set),b=A(new Set);let ee=null;const x=v=>{const k=$.value[v];return k?Date.now()-k.timestamp<ls:!1},Z=async()=>{if(b.value.size===0)return;const v=Array.from(b.value);b.value.clear();const k=v.filter(f=>{const U=H.products.find(le=>(le.id_product||le.id)===f);return U&&(U.hpp===void 0||U.hpp===null)});if(k.length===0){console.log("All products have HPP from backend, skipping API calls");return}console.log(`Loading HPP for ${k.length}/${v.length} products (others have backend HPP)`);const s=3;for(let f=0;f<k.length;f+=s){const le=k.slice(f,f+s).map(async ne=>{var ue;if(!(J.value[ne]||x(ne))){J.value[ne]=!0,c.value.add(ne);try{if(await L(ne,"latest"),(ue=M.value)!=null&&ue.total_hpp){const R=M.value.total_hpp;y.value[ne]=R,$.value[ne]={data:R,timestamp:Date.now(),attempted:!0}}else $.value[ne]={data:0,timestamp:Date.now(),attempted:!0}}catch(R){console.warn(`Could not load HPP for product ${ne}:`,R),$.value[ne]={data:0,timestamp:Date.now(),attempted:!0}}finally{J.value[ne]=!1}}});await Promise.all(le),f+s<v.length&&await new Promise(ne=>setTimeout(ne,500))}},pe=v=>{if(x(v)){y.value[v]=$.value[v].data;return}c.value.has(v)||(b.value.add(v),ee&&clearTimeout(ee),ee=setTimeout(()=>{Z()},os))},re=()=>{for(const v of H.products){const k=v.id_product||v.id;k&&(x(k)?y.value[k]=$.value[k].data:!c.value.has(k)&&!J.value[k]&&pe(k))}},K=v=>{const k=v.id_product||v.id;return y.value[k]||v.cost||0},ce=v=>{const k=K(v),s=v.price||0;return s<=0||k<=0?0:Math.round((s-k)/s*100)};aa(()=>{H.products&&H.products.length>0&&re()}),it(()=>{H.products&&H.products.length>0&&re()}),ke({refreshHPPData:async v=>{v?(delete $.value[v],delete y.value[v],c.value.delete(v),H.products.find(s=>(s.id_product||s.id)===v)&&pe(v)):($.value={},y.value={},c.value.clear(),b.value.clear(),re())}});const O=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],W=v=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(v),u=v=>new Date(v).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),g=v=>new Date(v).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),T=v=>v<10?"error":v<25?"warning":v<50?"success":"info";return(v,k)=>(_(),B(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",qo,[e(V,{icon:"tabler-list",class:"coffee-icon"}),k[7]||(k[7]=d(" Data Produk ")),v.totalItems?(_(),B(me,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[d(r(v.totalItems)+" item ",1)]),_:1})):j("",!0)]),l("div",Ro,[v.selectedProducts.length>0?(_(),B(q,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:k[0]||(k[0]=s=>v.$emit("bulk-delete"))},{default:t(()=>[d(" Hapus Terpilih ("+r(v.selectedProducts.length)+") ",1)]),_:1})):j("",!0),e(q,{"prepend-icon":"tabler-plus",color:"coffee",onClick:k[1]||(k[1]=s=>v.$emit("add-product"))},{default:t(()=>k[8]||(k[8]=[d(" Tambah Produk ")])),_:1,__:[8]})])]),_:1}),e(Ae),e(Va,{"model-value":v.selectedProducts,"onUpdate:modelValue":k[3]||(k[3]=s=>v.$emit("update:selected-products",s)),headers:O,items:v.products,"items-length":v.totalItems,loading:v.loading,"items-per-page":v.itemsPerPage,page:v.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:page":k[4]||(k[4]=s=>v.$emit("update:page",s)),"onUpdate:itemsPerPage":k[5]||(k[5]=s=>v.$emit("update:items-per-page",s)),"onUpdate:sortBy":k[6]||(k[6]=s=>v.$emit("update:sort-by",s))},{loading:t(()=>[e(Ca,{type:"table-row@10"})]),"no-data":t(()=>[l("div",No,[e(V,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),k[10]||(k[10]=l("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),k[11]||(k[11]=l("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(q,{"prepend-icon":"tabler-plus",color:"coffee",onClick:k[2]||(k[2]=s=>v.$emit("add-product"))},{default:t(()=>k[9]||(k[9]=[d(" Tambah Produk Pertama ")])),_:1,__:[9]})])]),"item.name":t(({item:s})=>[l("div",Lo,[e(Ie,{image:s.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[s.image_url?j("",!0):(_(),B(V,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),l("div",null,[l("div",Oo,r(s.name),1),l("div",jo," SKU: "+r(s.sku||"-"),1)])])]),"item.category":t(({item:s})=>[e(me,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var f;return[d(r(((f=s.category)==null?void 0:f.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:s})=>[l("div",Jo,[l("div",Go,r(W(s.price)),1),l("div",Wo,[l("span",null,"HPP: "+r(W(K(s))),1),J.value[s.id_product||s.id]&&K(s)>0?(_(),B(gt,{key:0,indeterminate:"",size:"12",width:"2"})):j("",!0)])])]),"item.profit_margin":t(({item:s})=>[l("div",Qo,[e(me,{color:T(ce(s)),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[d(r(ce(s))+"% ",1)]),_:2},1032,["color"])])]),"item.stock":t(({item:s})=>[l("div",Xo,[e(me,{color:s.stock_status==="out_of_stock"?"error":s.stock_status==="low_stock"?"warning":"success",size:"small",variant:"tonal"},{default:t(()=>[d(r(s.stock_status==="out_of_stock"?"Habis":s.stock_status==="low_stock"?"Rendah":"Aman"),1)]),_:2},1032,["color"]),s.min_stock?(_(),te("div",Zo," Min: "+r(s.min_stock),1)):j("",!0)])]),"item.active":t(({item:s})=>[l("div",Yo,[e(me,{color:s.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[d(r(s.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),s.featured?(_(),B(Fe,{key:0,text:"Produk Unggulan"},{activator:t(({props:f})=>[e(V,Ve(f,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):j("",!0)])]),"item.created_at":t(({item:s})=>[l("div",es,r(u(s.created_at??"")),1),l("div",ts,r(g((s==null?void 0:s.created_at)??"")),1)]),"item.actions":t(({item:s})=>[l("div",as,[e(Fe,{text:"Kelola Komposisi"},{activator:t(({props:f})=>[e(q,Ve(f,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:U=>v.$emit("open-composition-dialog",s)}),null,16,["onClick"])]),_:2},1024),e(Fe,{text:"Kelola Variant"},{activator:t(({props:f})=>[e(q,Ve(f,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:U=>v.$emit("open-variant-dialog",s)}),null,16,["onClick"])]),_:2},1024),e(Fe,{text:"Edit Produk"},{activator:t(({props:f})=>[e(q,Ve(f,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:U=>v.$emit("edit-product",s)}),null,16,["onClick"])]),_:2},1024),e(Fe,{text:s.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:f})=>{var U;return[e(q,Ve(f,{icon:s.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:s.active?"success":"error",loading:((U=v.toggleLoading)==null?void 0:U[s.id_product])||!1,onClick:le=>v.$emit("toggle-active",s)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Fe,{text:s.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:f})=>[e(q,Ve(f,{icon:s.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:s.featured?"warning":"default",onClick:U=>v.$emit("toggle-featured",s)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Fe,{text:"Hapus Produk"},{activator:t(({props:f})=>[e(q,Ve(f,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:U=>v.$emit("delete-product",s)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),is=Je(ss,[["__scopeId","data-v-f1645e56"]]),ns={class:"d-flex align-center gap-3"},rs={class:"text-h5 font-weight-bold"},us={class:"text-h6"},ds={class:"text-body-1"},cs={class:"d-flex flex-column"},ms={class:"font-weight-medium"},vs={class:"text-caption text-grey-darken-1"},ps={class:"font-weight-medium"},fs={key:0,class:"text-caption"},gs={key:1,class:"text-grey-lighten-1 text-caption"},_s={class:"v-data-table__footer"},ks={class:"pa-4 d-flex justify-space-between align-center"},ys={class:"text-subtitle-1 font-weight-bold"},bs={class:"text-subtitle-2 text-uppercase"},hs={class:"text-h6 font-weight-bold my-2"},xs={class:"text-caption"},Et=Re({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup(I,{emit:ke}){const H=I,M=ke,L=A(!1),y=A(null),J=A(null),$=A(!1),c=A(!1),b=A("latest"),ee=A(0),x=A(0),Z=A(""),pe=A(0),re=A(!1),K=A(!1),ce=A(""),ve=A(""),O=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],W=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],u=R=>!R||R===0?"":new Intl.NumberFormat("id-ID").format(R),g=R=>{if(!R)return 0;const S=R.replace(/[^\d]/g,"");return parseInt(S)||0},T=R=>{var m;const S=g(R);if(x.value=S,Z.value=u(S),(m=y.value)!=null&&m.total_hpp&&S>0){const o=y.value.total_hpp;ee.value=o>0?Math.round((S-o)/o*100):0}else ee.value=0},v=R=>Te(R),k=async(R,S)=>{L.value=!0;try{await new Promise(m=>setTimeout(m,500)),y.value={total_hpp:15e4,method:S,calculated_at:new Date().toISOString(),items:[{item_name:"Tepung Terigu",item_code:"TPNG001",quantity_needed:.5,unit:"kg",cost_per_unit:15e3,total_cost:7500,is_critical:!1,notes:null},{item_name:"Gula Pasir",item_code:"GUL001",quantity_needed:.25,unit:"kg",cost_per_unit:12e3,total_cost:3e3,is_critical:!1,notes:null},{item_name:"Telur Ayam",item_code:"TLR001",quantity_needed:3,unit:"pcs",cost_per_unit:3e3,total_cost:9e3,is_critical:!0,notes:"Price volatile"}]},$.value=!0}catch(m){console.error("Error loading HPP breakdown:",m),$.value=!1}finally{L.value=!1}},s=async(R,S)=>{L.value=!0;try{if(await new Promise(m=>setTimeout(m,1e3)),y.value){switch(S){case"latest":y.value.total_hpp=Math.round(y.value.total_hpp*1.1);break;case"average":y.value.total_hpp=Math.round(y.value.total_hpp*1.05);break;default:y.value.total_hpp=Math.round(y.value.total_hpp*1.03)}y.value.calculated_at=new Date().toISOString()}}catch(m){throw m}finally{L.value=!1}},f=async(R,S,m,o,i)=>{L.value=!0;try{return await new Promise(C=>setTimeout(C,1e3)),{data:{new_price:m,markup_percentage:y.value?Math.round((m-y.value.total_hpp)/y.value.total_hpp*100):0}}}catch(C){throw C}finally{L.value=!1}},U=async()=>{var R,S,m;if(H.variantId)try{const o=localStorage.getItem("token"),i=await Le.get(`/api/variants/${H.variantId}`,{headers:{Authorization:`Bearer ${o}`,Accept:"application/json"}});if(i.data.success&&i.data.data){const C=i.data.data;if(C.price&&C.price>0)x.value=Number(C.price),Z.value=u(Number(C.price));else if((R=y.value)!=null&&R.total_hpp){const ge=Math.round(y.value.total_hpp*1.2);x.value=ge,Z.value=u(ge)}if((S=y.value)!=null&&S.total_hpp&&x.value>0){const ge=y.value.total_hpp;ee.value=ge>0?Math.round((x.value-ge)/ge*100):0}pe.value+=1}}catch(o){console.warn("Could not load target price, using default:",o),(m=y.value)!=null&&m.total_hpp&&(x.value=Math.round(y.value.total_hpp*1.2))}},le=async()=>{H.variantId&&(await k(H.variantId,b.value),await U())},ne=async()=>{var R,S;if(H.variantId)try{await s(H.variantId,b.value),ce.value=`HPP successfully updated using ${b.value} method!`,re.value=!0,M("hpp-updated"),await le()}catch(m){console.error("Error updating HPP:",m),ve.value=((S=(R=m==null?void 0:m.response)==null?void 0:R.data)==null?void 0:S.message)||"Failed to update HPP",K.value=!0}},ue=async()=>{var R,S,m,o,i,C,ge,G,_e,De;if(H.variantId&&((R=y.value)!=null&&R.total_hpp)&&x.value)try{const oe=await f(H.variantId,b.value,x.value,!0,!0);if((S=oe==null?void 0:oe.data)!=null&&S.new_price){if(x.value=oe.data.new_price,Z.value=u(oe.data.new_price),((m=oe==null?void 0:oe.data)==null?void 0:m.markup_percentage)!==void 0)ee.value=oe.data.markup_percentage;else{const Me=y.value.total_hpp;ee.value=Me>0?Math.round((oe.data.new_price-Me)/Me*100):0}pe.value+=1,await ht()}H.variantId&&await k(H.variantId,b.value),ce.value=`Price successfully updated to ${v(((o=oe==null?void 0:oe.data)==null?void 0:o.new_price)||x.value)}!`,re.value=!0,M("price-updated",{variantId:H.variantId,oldPrice:(i=oe==null?void 0:oe.data)==null?void 0:i.old_price,newPrice:(C=oe==null?void 0:oe.data)==null?void 0:C.new_price,hpp:(ge=oe==null?void 0:oe.data)==null?void 0:ge.hpp,markupPercentage:(G=oe==null?void 0:oe.data)==null?void 0:G.markup_percentage}),console.log("âœ… Price update successful - dialog remains open for user confirmation")}catch(oe){console.error("Error applying price suggestion:",oe),ve.value=((De=(_e=oe==null?void 0:oe.response)==null?void 0:_e.data)==null?void 0:De.message)||"Failed to update variant price",K.value=!0}};return we(()=>H.modelValue,R=>{R&&H.variantId&&le()}),we(()=>H.variantId,R=>{R&&H.modelValue&&le()}),we(b,async()=>{H.variantId&&await le()}),we([()=>{var R;return(R=y.value)==null?void 0:R.total_hpp},x],()=>{var R;if((R=y.value)!=null&&R.total_hpp&&x.value>0){const S=y.value.total_hpp;ee.value=S>0?Math.round((x.value-S)/S*100):0}else ee.value=0}),we(x,R=>{R!==g(Z.value)&&(Z.value=u(R))}),(R,S)=>(_(),te(ze,null,[e(Oe,{"model-value":R.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":S[6]||(S[6]=m=>R.$emit("update:modelValue",m))},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",ns,[e(V,{icon:"mdi-calculator-variant",size:"24"}),l("span",null,"HPP Breakdown - "+r(R.variantName||"Variant"),1)]),e(q,{icon:"mdi-close",size:"small",variant:"text",onClick:S[0]||(S[0]=m=>R.$emit("update:modelValue",!1))})]),_:1}),e(ie,null,{default:t(()=>[e(Ce,{class:"mb-4"},{default:t(()=>[e(D,{cols:"12",md:"6"},{default:t(()=>[e(Ke,{modelValue:b.value,"onUpdate:modelValue":[S[1]||(S[1]=m=>b.value=m),le],items:O,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(q,{color:"primary",variant:"elevated",loading:L.value,"prepend-icon":"mdi-update",block:"",onClick:ne},{default:t(()=>[d(" Update HPP with "+r(b.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),$.value?(_(),B(ae,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ce,{align:"center"},{default:t(()=>[e(D,{cols:"12",md:"4"},{default:t(()=>{var m;return[S[11]||(S[11]=l("div",{class:"text-subtitle-2"}," Total HPP ",-1)),l("div",rs,r(v(((m=y.value)==null?void 0:m.total_hpp)||0)),1)]}),_:1,__:[11]}),e(D,{cols:"12",md:"4"},{default:t(()=>{var m;return[S[12]||(S[12]=l("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),l("div",us,r((m=O.find(o=>{var i;return o.value===((i=y.value)==null?void 0:i.method)}))==null?void 0:m.title),1)]}),_:1,__:[12]}),e(D,{cols:"12",md:"4"},{default:t(()=>{var m;return[S[13]||(S[13]=l("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),l("div",ds,r((m=y.value)!=null&&m.calculated_at?new Date(y.value.calculated_at).toLocaleString():"-"),1)]}),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):j("",!0),$.value?(_(),B(ae,{key:1},{default:t(()=>{var m;return[e(Pe,null,{default:t(()=>{var o,i;return[e(V,{icon:"mdi-format-list-bulleted",class:"me-2"}),d(" Item Breakdown ("+r(((i=(o=y.value)==null?void 0:o.items)==null?void 0:i.length)||0)+" items) ",1)]}),_:1}),e(Ia,{headers:W,items:((m=y.value)==null?void 0:m.items)||[],"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:o})=>[l("div",cs,[l("span",ms,r(o.item_name),1),l("span",vs,r(o.item_code),1)])]),"item.quantity_needed":t(({item:o})=>[l("span",ps,r(o.quantity_needed)+" "+r(o.unit),1)]),"item.cost_per_unit":t(({item:o})=>[l("span",null,r(v(o.cost_per_unit)),1)]),"item.total_cost":t(({item:o})=>[e(me,{color:o.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[d(r(v(o.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:o})=>[e(me,{color:o.is_critical?"error":"success","prepend-icon":o.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[d(r(o.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:o})=>[o.notes?(_(),te("span",fs,r(o.notes),1)):(_(),te("span",gs,"â€”"))]),bottom:t(()=>{var o;return[l("div",_s,[e(Ae),l("div",ks,[l("div",ys," Total HPP: "+r(v(((o=y.value)==null?void 0:o.total_hpp)||0)),1),e(me,{color:"info",variant:"elevated"},{default:t(()=>{var i,C;return[d(r(((C=(i=y.value)==null?void 0:i.items)==null?void 0:C.length)||0)+" items ",1)]}),_:1})])])]}),_:1},8,["items"])]}),_:1})):j("",!0),$.value?(_(),B(ae,{key:2,class:"mt-4"},{default:t(()=>[e(Pe,null,{default:t(()=>[e(V,{icon:"mdi-cash-multiple",class:"me-2"}),S[14]||(S[14]=d(" Price Suggestion "))]),_:1,__:[14]}),e(ie,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(D,{cols:"12",md:"6"},{default:t(()=>{var m;return[(_(),B(he,{key:pe.value,modelValue:Z.value,"onUpdate:modelValue":[S[2]||(S[2]=o=>Z.value=o),T],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${v(((m=y.value)==null?void 0:m.total_hpp)||0)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>{var m;return[(_(),B(he,{key:pe.value,modelValue:ee.value,"onUpdate:modelValue":S[3]||(S[3]=o=>ee.value=o),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${v(x.value-(((m=y.value)==null?void 0:m.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e(Ce,{class:"mt-2"},{default:t(()=>[e(D,{cols:"12",md:"12"},{default:t(()=>[e(q,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:L.value,disabled:!x.value||x.value<=0,block:"",onClick:ue},{default:t(()=>S[15]||(S[15]=[d(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0),c.value?(_(),B(ae,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(Pe,null,{default:t(()=>[e(V,{icon:"mdi-lightbulb",class:"me-2"}),S[16]||(S[16]=d(" Price Suggestions "))]),_:1,__:[16]}),e(ie,null,{default:t(()=>[e(Ce,null,{default:t(()=>[(_(!0),te(ze,null,We(J.value.suggestions,(m,o)=>(_(),B(D,{key:o,cols:"12",md:"4"},{default:t(()=>[e(ae,{variant:"elevated"},{default:t(()=>[e(ie,{class:"text-center"},{default:t(()=>[l("div",bs,r(o)+" Method ",1),l("div",hs,r(v(m.suggested_price)),1),l("div",xs,[d(" HPP: "+r(v(m.hpp)),1),S[17]||(S[17]=l("br",null,null,-1)),d(" Markup: "+r(m.markup_percentage.toFixed(1))+"%",1),S[18]||(S[18]=l("br",null,null,-1)),d(" Margin: "+r(m.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):j("",!0),!$.value&&!L.value?(_(),B(ae,{key:4,variant:"outlined"},{default:t(()=>[e(ie,{class:"text-center py-8"},{default:t(()=>[e(V,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),S[20]||(S[20]=l("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),S[21]||(S[21]=l("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(q,{color:"primary","prepend-icon":"mdi-plus",onClick:S[4]||(S[4]=m=>R.$emit("update:modelValue",!1))},{default:t(()=>S[19]||(S[19]=[d(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):j("",!0)]),_:1}),e(qe,{class:"pa-4"},{default:t(()=>[e(je),e(q,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:S[5]||(S[5]=m=>R.$emit("update:modelValue",!1))},{default:t(()=>S[22]||(S[22]=[d(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(st,{modelValue:re.value,"onUpdate:modelValue":S[8]||(S[8]=m=>re.value=m),color:"success",location:"top"},{actions:t(()=>[e(q,{color:"white",variant:"text",onClick:S[7]||(S[7]=m=>re.value=!1)},{default:t(()=>S[23]||(S[23]=[d(" Close ")])),_:1,__:[23]})]),default:t(()=>[d(r(ce.value)+" ",1)]),_:1},8,["modelValue"]),e(st,{modelValue:K.value,"onUpdate:modelValue":S[10]||(S[10]=m=>K.value=m),color:"error",location:"top"},{actions:t(()=>[e(q,{color:"white",variant:"text",onClick:S[9]||(S[9]=m=>K.value=!1)},{default:t(()=>S[24]||(S[24]=[d(" Close ")])),_:1,__:[24]})]),default:t(()=>[d(r(ve.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),ws={class:"d-flex align-center gap-2"},Ps={class:"pa-4",style:{"background-color":"#2A2A2A"}},Vs={key:0,class:"d-flex align-center gap-3"},Cs={class:"text-h6 text-white font-weight-bold"},Is={class:"d-flex align-center gap-4 mt-1"},Ss={class:"text-caption text-grey-lighten-1"},$s={class:"text-caption text-grey-lighten-1"},Ds={class:"pa-4 add-item-form"},Us={class:"d-flex align-center justify-space-between mb-4"},zs={class:"d-flex align-center gap-2"},As={class:"text-h6"},Ts={key:0,class:"text-error"},Hs={key:1},Ms={class:"d-flex align-center"},Fs={class:"pa-4 text-center"},Es={class:"pa-4 pt-0"},Ks={class:"d-flex align-center justify-between mb-4"},Bs={class:"text-h6"},qs={key:0,class:"composition-list"},Rs={class:"d-flex align-center justify-between"},Ns={class:"d-flex align-center gap-3"},Ls={class:"font-weight-medium"},Os={class:"text-caption text-medium-emphasis"},js={class:"font-weight-medium text-primary"},Js={class:"d-flex align-center gap-2"},Gs={class:"text-center"},Ws={key:0,class:"text-body-2 text-medium-emphasis"},Qs={class:"text-center"},Xs={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},Zs=Re({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup(I,{emit:ke}){const H=I,M=ke,L=A(),y=A(!1),J=A(!1),$=A([]),c=A([]),b=A(!1),ee=A(null),x=A(!1),Z=A(null),pe=A(!1),re=A(!1),K=A(""),ce=A(""),ve=A("success"),O=A(!1),W=fe({get:()=>(console.log("ðŸ”µ [DEBUG] Dialog getter called, props.modelValue:",H.modelValue),H.modelValue),set:n=>{console.log("ðŸ”µ [DEBUG] Dialog setter called with value:",n),M("update:modelValue",n)}}),u=()=>({item_id:null,quantity:1,is_critical:!1}),g=A(u()),T=fe(()=>!g.value.item_id||!Array.isArray($.value)?null:$.value.find(n=>n.id_item===g.value.item_id)),v=fe(()=>!T.value||b.value&&ee.value!==null?null:c.value.find(n=>{var a,p;return n.name===((a=T.value)==null?void 0:a.name)||n.id&&((p=T.value)==null?void 0:p.id_item)&&n.id===T.value.id_item})),k=fe(()=>{if(!T.value)return"";if(b.value&&ee.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(v.value){const n=v.value;return`Item sudah ada dengan quantity ${n.quantity} ${n.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${f(T.value)} ${T.value.unit}`}),s=fe(()=>Array.isArray($.value)?$.value.filter(n=>f(n)>0):[]),f=n=>{var a,p;return((a=n.inventory)==null?void 0:a.current_stock)||((p=n.inventory)==null?void 0:p.available_stock)||n.current_stock||0},U=()=>J.value?"Memuat items...":!$.value||$.value.length===0?"Tidak ada item tersedia":s.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",le=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),ne=n=>{switch(n){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},ue=n=>{switch(n){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},R=(n,a,p)=>{var w,se,de,be,xe,$e,He,Ne;if(!a)return!0;const z=a.toLowerCase().trim(),F=((se=(w=p==null?void 0:p.raw)==null?void 0:w.name)==null?void 0:se.toLowerCase())||"",P=((be=(de=p==null?void 0:p.raw)==null?void 0:de.item_code)==null?void 0:be.toLowerCase())||"",h=(($e=(xe=p==null?void 0:p.raw)==null?void 0:xe.unit)==null?void 0:$e.toLowerCase())||"",N=((Ne=(He=p==null?void 0:p.raw)==null?void 0:He.description)==null?void 0:Ne.toLowerCase())||"";return F.includes(z)||P.includes(z)||h.includes(z)||N.includes(z)},S=async()=>{var n,a,p;J.value=!0,console.log("Loading available items...");try{const z=await Le.get("/api/items?per_page=all&include=inventory");console.log("Items API response:",z.data);const F=((a=(n=z.data)==null?void 0:n.data)==null?void 0:a.data)||((p=z.data)==null?void 0:p.data)||z.data||[];$.value=Array.isArray(F)?F:[],console.log("Available items loaded:",$.value.length,"items"),console.log("Sample items with inventory:",$.value.slice(0,3))}catch(z){console.error("Error loading items:",z),z!=null&&z.response&&(console.error("API Error Status:",z.response.status),console.error("API Error Data:",z.response.data)),$.value=[]}finally{J.value=!1}},m=async()=>{var n,a,p,z,F;if(!(!((n=H.variant)!=null&&n.id)&&!((a=H.variant)!=null&&a.id_variant)))try{const P=H.variant.id||H.variant.id_variant;console.log("Loading composition items for variant:",P);const h=await Le.get(`/api/variant-items/variant/${P}`);console.log("Composition API response:",h.data);const N=((z=(p=h.data)==null?void 0:p.data)==null?void 0:z.composition)||((F=h.data)==null?void 0:F.composition)||[];if(!Array.isArray(N)){console.warn("API response composition is not an array:",N),c.value=[];return}c.value=N.map(w=>{var se,de,be,xe,$e,He,Ne,Ye,et,tt;return{id:w.id_variant_item||w.id,name:((se=w.item)==null?void 0:se.name)||w.name,quantity:parseFloat(w.quantity_needed||w.quantity||w.qty||"1"),unit:w.unit||((de=w.item)==null?void 0:de.unit)||"pcs",stock:((xe=(be=w.item)==null?void 0:be.inventory)==null?void 0:xe.current_stock)||((He=($e=w.item)==null?void 0:$e.inventory)==null?void 0:He.available_stock)||((Ne=w.item)==null?void 0:Ne.current_stock)||w.stock||0,price:parseFloat(((Ye=w.item)==null?void 0:Ye.cost_per_unit)||((et=w.item)==null?void 0:et.price)||w.price||"0"),is_critical:w.is_critical||!1,inventory:(tt=w.item)!=null&&tt.inventory?{current_stock:w.item.inventory.current_stock||0,available_stock:w.item.inventory.available_stock||0,stock_status:w.item.inventory.stock_status||"unknown",reorder_level:w.item.inventory.reorder_level||0}:null}}),console.log("Composition items loaded:",c.value)}catch(P){console.error("Error loading composition items:",P),P!=null&&P.response&&(console.error("API Error Status:",P.response.status),console.error("API Error Data:",P.response.data)),c.value=[]}},o=async()=>{var F,P;const{valid:n}=await L.value.validate();if(!n||!T.value)return;const a=T.value.name,p=T.value.id_item,z=g.value.quantity;if(console.log("ðŸ” Handle save - Mode:",b.value?"EDIT":"ADD"),console.log("ðŸ” Item:",a,"ID:",p),console.log("ðŸ” Quantity:",z),b.value&&ee.value!==null){console.log("âœï¸ Edit mode: Updating existing item at index",ee.value);const N=c.value[ee.value].quantity;console.log(`ðŸ“ Updating item "${a}":`),console.log(`   - Old quantity: ${N}`),console.log(`   - New quantity: ${z}`),c.value[ee.value].quantity=z,c.value[ee.value].is_critical=g.value.is_critical,console.log("âœ… Item updated successfully in edit mode"),b.value=!1,ee.value=null}else{console.log("âž• Add mode: Checking for existing item");const h=c.value.findIndex(N=>N.name===a||N.id&&p&&N.id===p);if(h!==-1){const w=c.value[h].quantity,se=w+z;console.log("ðŸ“¦ Item already exists! Accumulating quantity:"),console.log(`   - Item: ${a}`),console.log(`   - Old quantity: ${w}`),console.log(`   - Adding: ${z}`),console.log(`   - New quantity: ${se}`),c.value[h].quantity=se}else{console.log("âž• Adding new item to composition:",a);const N={name:a,quantity:z,unit:T.value.unit,stock:((F=T.value.inventory)==null?void 0:F.current_stock)||((P=T.value.inventory)==null?void 0:P.available_stock)||T.value.current_stock||0,price:T.value.cost_per_unit||0,is_critical:g.value.is_critical,inventory:T.value.inventory?{current_stock:T.value.inventory.current_stock||0,available_stock:T.value.inventory.available_stock||0,stock_status:T.value.inventory.stock_status||"unknown",reorder_level:T.value.inventory.reorder_level||0}:null};c.value.push(N),console.log("âœ… New item added successfully")}}g.value=u(),console.log("ðŸ”„ Form reset")},i=(n,a)=>{console.log("ðŸ” Edit item called:",n,a);const p=$.value.find(z=>z.name===n.name||z.id_item===n.id);p?(console.log("âœ… Found item in available items:",p),b.value=!0,ee.value=a,g.value={item_id:p.id_item,quantity:n.quantity,is_critical:n.is_critical||!1},console.log("ðŸ“ Edit mode activated!"),console.log("ðŸ“ Form data set:",g.value),console.log("ðŸ“ Editing item at index:",a),setTimeout(()=>{const z=document.querySelector(".add-item-form");z&&z.scrollIntoView({behavior:"smooth",block:"start"})},100)):(console.error("âŒ Could not find item in available items"),console.log("Available items:",$.value.map(z=>({id:z.id_item,name:z.name}))),console.log("Looking for item:",{id:n.id,name:n.name}))},C=()=>{console.log("âŒ Edit mode cancelled"),b.value=!1,ee.value=null,g.value=u()},ge=(n,a)=>{Z.value={item:n,index:a},x.value=!0},G=async()=>{var F,P,h;if(!Z.value)return;const{item:n,index:a}=Z.value,p=n.name,z=n.id;pe.value=!0,console.log("ðŸš€ Starting delete process for:",p,"ID:",z,"Index:",a);try{z?(console.log("ðŸ—‘ï¸ Deleting item from database:",p,"with ID:",z),await Le.delete(`/api/variant-items/${z}`),console.log("âœ… Item deleted from database successfully")):console.log("ðŸ“ Item has no ID, removing from local list only"),x.value=!1,Z.value=null,console.log("âœ… Delete dialog closed"),console.log("ðŸ”„ Force refreshing composition list..."),await m(),console.log("âœ… Composition list refreshed from server. New count:",c.value.length),console.log("ðŸ“¡ Emitting save event to parent component..."),M("save"),console.log("âœ… Save event emitted to parent component"),console.log("ðŸŽ‰ Item successfully deleted:",p)}catch(N){console.error("âŒ Error deleting item:",N),console.error("âŒ Error details:",(F=N.response)==null?void 0:F.data),alert("Gagal menghapus item: "+(((h=(P=N.response)==null?void 0:P.data)==null?void 0:h.message)||N.message))}finally{pe.value=!1,console.log("ðŸ Delete process completed")}},_e=()=>{x.value=!1,Z.value=null},De=()=>{switch(ve.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},oe=()=>{switch(ve.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Me=()=>{switch(ve.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},Se=()=>{switch(ve.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Xe=async()=>{var n,a,p,z;if(!((n=H.variant)!=null&&n.id)&&!((a=H.variant)!=null&&a.id_variant)){console.error("No variant ID found");return}y.value=!0;try{const F=H.variant.id||H.variant.id_variant;console.log("ðŸ” [DEBUG] Composition items count:",c.value.length),console.log("ðŸ” [DEBUG] Raw composition items:",JSON.stringify(c.value,null,2));const P=c.value.some(h=>h.id);if(console.log("ðŸ” [DEBUG] Has existing items:",P),P){console.log("ï¿½ [EDIT MODE] Updating existing composition");const h={items:c.value.map(w=>{const se=$.value.find(de=>de.name===w.name);return console.log(`Mapping item "${w.name}":`),console.log("  - Found item:",se==null?void 0:se.id_item),console.log("  - Original ID (id_variant_item):",w.id),console.log("  - Quantity:",w.quantity),console.log("  - Unit:",w.unit),console.log("  - Is critical:",w.is_critical),{id_variant_item:w.id,quantity_needed:Number(w.quantity),unit:w.unit,is_critical:w.is_critical||!1}}).filter(w=>w.id_variant_item&&w.quantity_needed>0)};console.log("Edit payload:",JSON.stringify(h,null,2));const N=await Le.post("/api/variant-items/bulk-update",h);console.log("Composition updated successfully:",N.data)}else{console.log("âœ¨ [CREATE MODE] Creating new composition");const h={id_variant:F,items:c.value.map(w=>{const se=$.value.find(de=>de.name===w.name);return console.log(`Mapping item "${w.name}":`),console.log("  - Found item:",se==null?void 0:se.id_item),console.log("  - Quantity:",w.quantity),console.log("  - Unit:",w.unit),console.log("  - Is critical:",w.is_critical),{id_item:se==null?void 0:se.id_item,quantity_needed:Number(w.quantity),unit:w.unit,is_critical:w.is_critical||!1}}).filter(w=>w.id_item&&w.quantity_needed>0)};console.log("Create payload:",JSON.stringify(h,null,2));const N=await Le.post("/api/variant-items/bulk-store",h);console.log("Composition created successfully:",N.data)}M("save"),Be()}catch(F){console.error("Error saving composition:",F),alert("Gagal menyimpan komposisi: "+(((z=(p=F.response)==null?void 0:p.data)==null?void 0:z.message)||F.message))}finally{y.value=!1}},Ze=()=>{O.value=!0},Be=()=>{W.value=!1,g.value=u(),c.value=[],b.value=!1,ee.value=null};return we(()=>H.modelValue,n=>{n?(g.value=u(),S(),m()):(b.value=!1,ee.value=null)}),we(()=>g.value.item_id,n=>{n&&T.value&&console.log("Item selected:",T.value.name,"Unit:",T.value.unit)}),it(()=>{S()}),(n,a)=>{var p,z,F;return _(),te(ze,null,[e(Oe,{modelValue:W.value,"onUpdate:modelValue":a[3]||(a[3]=P=>W.value=P),"max-width":"1000px",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[l("div",ws,[e(V,{icon:"mdi-delete",color:"white"}),a[9]||(a[9]=l("span",null,"Kelola Komposisi Item",-1))]),e(q,{icon:"mdi-close",variant:"text",color:"white",onClick:Be,disabled:y.value},null,8,["disabled"])]),_:1}),e(ie,{class:"pa-0"},{default:t(()=>[l("div",Ps,[n.variant?(_(),te("div",Vs,[e(V,{icon:"mdi-coffee",size:"32",color:"white"}),l("div",null,[l("h3",Cs,r(n.variant.name),1),l("div",Is,[l("span",Ss,"SKU: "+r(n.variant.sku),1),l("span",$s,"Harga: "+r(le(n.variant.price||0)),1),e(me,{color:"success",size:"small",variant:"tonal"},{default:t(()=>a[10]||(a[10]=[d(" Stok Aman ")])),_:1,__:[10]})])])])):j("",!0)]),l("div",Ds,[l("div",Us,[l("div",zs,[e(V,{icon:"mdi-plus-circle",color:"success"}),l("h4",As,r(b.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(Ct,{ref_key:"form",ref:L,onSubmit:Pt(o,["prevent"])},{default:t(()=>[e(Ce,null,{default:t(()=>[e(D,{cols:"12",md:"4"},{default:t(()=>[e(Vt,{modelValue:g.value.item_id,"onUpdate:modelValue":a[0]||(a[0]=P=>g.value.item_id=P),items:s.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[P=>!!P||"Item wajib dipilih"],loading:J.value,disabled:J.value||$.value&&$.value.length===0,"no-data-text":U(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":R},{"prepend-inner":t(()=>[e(V,{icon:"mdi-package",size:"16"})]),item:t(({props:P,item:h})=>[e(Ge,Ve(P,{title:h.raw.name,disabled:f(h.raw)<=0,class:["pa-3",{"text-disabled":f(h.raw)<=0}]}),{prepend:t(()=>[e(V,{icon:"mdi-package-variant",color:f(h.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[l("div",{class:Qe(["text-caption",f(h.raw)<=0?"text-disabled":"text-medium-emphasis"])},[f(h.raw)<=0?(_(),te("span",Ts,[e(V,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),a[11]||(a[11]=d(" Stok Habis "))])):(_(),te("span",Hs," Stok: "+r(f(h.raw))+" "+r(h.raw.unit),1))],2)]),append:t(()=>{var N;return[f(h.raw)>0?(_(),B(me,{key:0,size:"x-small",color:ne(((N=h.raw.inventory)==null?void 0:N.stock_status)||h.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var w;return[d(r(ue(((w=h.raw.inventory)==null?void 0:w.stock_status)||h.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(_(),B(me,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>a[12]||(a[12]=[d(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:P})=>[l("div",Ms,[e(V,{icon:"mdi-package-variant",size:"16",class:"me-2"}),l("span",null,r(P.raw.name),1)])]),"no-data":t(()=>[l("div",Fs,[e(V,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),a[13]||(a[13]=l("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),a[14]||(a[14]=l("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e(D,{cols:"12",md:"2"},{default:t(()=>[e(he,{modelValue:g.value.quantity,"onUpdate:modelValue":a[1]||(a[1]=P=>g.value.quantity=P),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[P=>!!P||"Jumlah wajib diisi",P=>P>0||"Jumlah harus lebih dari 0"],hint:k.value,"persistent-hint":"",color:v.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e(D,{cols:"12",md:"2"},{default:t(()=>{var P;return[e(he,{"model-value":((P=T.value)==null?void 0:P.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!T.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e(V,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e(D,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(ct,{modelValue:g.value.is_critical,"onUpdate:modelValue":a[2]||(a[2]=P=>g.value.is_critical=P),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(q,{color:b.value?"primary":v.value?"warning":"#D4A574",onClick:o,loading:y.value,disabled:!g.value.item_id||!g.value.quantity,block:""},{default:t(()=>[e(V,{icon:b.value?"mdi-content-save":v.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),d(" "+r(b.value?"Update":v.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),b.value?(_(),B(q,{key:0,color:"grey",variant:"outlined",onClick:C,size:"small",block:""},{default:t(()=>[e(V,{icon:"mdi-close",class:"me-1"}),a[15]||(a[15]=d(" Batal "))]),_:1,__:[15]})):j("",!0)]),_:1})]),_:1})]),_:1},512)]),l("div",Es,[l("div",Ks,[l("h4",Bs,"Daftar Item Komposisi ("+r(c.value.length)+")",1)]),c.value.length>0?(_(),te("div",qs,[(_(!0),te(ze,null,We(c.value,(P,h)=>(_(),B(ae,{key:h,variant:"outlined",class:"mb-3"},{default:t(()=>[e(ie,{class:"pa-3"},{default:t(()=>{var N,w,se,de,be,xe,$e;return[l("div",Rs,[l("div",Ns,[e(V,{icon:"mdi-check-circle",color:"success"}),l("div",null,[l("div",Ls,r(P.name),1),l("div",Os,[l("span",js,"Dibutuhkan: "+r(P.quantity)+" "+r(P.unit),1),a[16]||(a[16]=d(" â€¢ ")),l("span",{class:Qe({"text-success":(((N=P.inventory)==null?void 0:N.current_stock)??0)>(((w=P.inventory)==null?void 0:w.reorder_level)??0),"text-warning":(((se=P.inventory)==null?void 0:se.current_stock)??0)<=(((de=P.inventory)==null?void 0:de.reorder_level)??0)&&(((be=P.inventory)==null?void 0:be.current_stock)??0)>0,"text-error":(((xe=P.inventory)==null?void 0:xe.current_stock)??0)<=0})}," Stok: "+r((($e=P.inventory)==null?void 0:$e.current_stock)||P.stock||0)+" "+r(P.unit),3),d(" â€¢ "+r(le(P.price)),1)])])]),l("div",Js,[e(q,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:He=>i(P,h)},null,8,["onClick"]),e(q,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:He=>ge(P,h)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(_(),B(ae,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e(V,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),a[17]||(a[17]=l("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(qe,{class:"px-6 pb-6"},{default:t(()=>[e(q,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:Ze},{default:t(()=>a[18]||(a[18]=[d(" Setting HPP ")])),_:1,__:[18]}),e(je),e(q,{variant:"outlined",onClick:Be,disabled:y.value},{default:t(()=>a[19]||(a[19]=[d(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(q,{color:"#D4A574",onClick:Xe,loading:y.value,disabled:c.value.length===0},{default:t(()=>a[20]||(a[20]=[d(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Et,{modelValue:O.value,"onUpdate:modelValue":a[4]||(a[4]=P=>O.value=P),"variant-id":((p=n.variant)==null?void 0:p.id)||((z=n.variant)==null?void 0:z.id_variant),"variant-name":(F=n.variant)==null?void 0:F.name,onHppUpdated:a[5]||(a[5]=P=>M("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Oe,{modelValue:x.value,"onUpdate:modelValue":a[6]||(a[6]=P=>x.value=P),"max-width":"400px",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e(V,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),a[21]||(a[21]=d(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(Ae),e(ie,{class:"pa-6"},{default:t(()=>[l("div",Gs,[e(V,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),a[24]||(a[24]=l("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),Z.value?(_(),te("div",Ws,[l("strong",null,r(Z.value.item.name),1),a[22]||(a[22]=l("br",null,null,-1)),d(" Dibutuhkan: "+r(Z.value.item.quantity)+" "+r(Z.value.item.unit),1)])):j("",!0),e(Ee,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>a[23]||(a[23]=[l("strong",null,"Perhatian:",-1),d(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(qe,{class:"px-6 pb-6"},{default:t(()=>[e(q,{variant:"outlined",onClick:_e,disabled:pe.value,class:"flex-grow-1"},{default:t(()=>a[25]||(a[25]=[d(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(q,{color:"error",onClick:G,loading:pe.value,class:"flex-grow-1"},{default:t(()=>a[26]||(a[26]=[d(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Oe,{modelValue:re.value,"onUpdate:modelValue":a[8]||(a[8]=P=>re.value=P),"max-width":"450px",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:Qe(["d-flex align-center justify-center text-h6",Me()])},{default:t(()=>[e(V,{icon:De(),color:oe(),class:"me-2",size:"24"},null,8,["icon","color"]),d(" "+r(ce.value),1)]),_:1},8,["class"]),e(Ae),e(ie,{class:"pa-6"},{default:t(()=>[l("div",Qs,[e(V,{icon:De(),color:oe(),size:"64",class:"mb-4"},null,8,["icon","color"]),l("div",Xs,r(K.value),1),e(Ee,{type:ve.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[ve.value==="success"?(_(),te(ze,{key:0},[a[27]||(a[27]=l("strong",null,"Berhasil!",-1)),a[28]||(a[28]=d(" Perubahan telah disimpan. "))],64)):ve.value==="info"?(_(),te(ze,{key:1},[a[29]||(a[29]=l("strong",null,"Informasi:",-1)),a[30]||(a[30]=d(" Item telah diperbarui sesuai permintaan. "))],64)):(_(),te(ze,{key:2},[a[31]||(a[31]=l("strong",null,"Perhatian:",-1)),a[32]||(a[32]=d(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(qe,{class:"px-6 pb-6"},{default:t(()=>[e(je),e(q,{color:Se(),onClick:a[7]||(a[7]=P=>re.value=!1),class:"px-6"},{default:t(()=>[e(V,{icon:"mdi-check",class:"me-1"}),a[33]||(a[33]=d(" OK "))]),_:1,__:[33]},8,["color"]),e(je)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Ys=Je(Zs,[["__scopeId","data-v-df449ced"]]),ei={class:"d-flex align-center gap-2"},ti={class:"mt-2"},ai={key:0,class:"mt-1 font-weight-medium"},li={key:1,class:"mt-1 text-warning"},oi=Re({__name:"CreateVariantDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save"],setup(I,{emit:ke}){const H=I,M=ke,L=A(),y=A(!1),J=A(!1),$=A([]),c=A({name:"",selectedProduct:null,selectedProductId:null,active:!0}),b=[u=>!!u||"Nama variant wajib diisi",u=>u.length>=3||"Nama variant minimal 3 karakter"],ee=[u=>!!u||"Produk wajib dipilih"],x=(u,g="success")=>{const T=document.createElement("div");T.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${g==="success"?"#4CAF50":"#f44336"};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 9999;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
  `;const v=document.createElement("span");if(v.innerHTML=g==="success"?"âœ“":"âœ•",v.style.cssText=`
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    font-weight: bold;
  `,T.appendChild(v),T.appendChild(document.createTextNode(u)),!document.querySelector("#snackbar-styles")){const k=document.createElement("style");k.id="snackbar-styles",k.textContent=`
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `,document.head.appendChild(k)}document.body.appendChild(T),setTimeout(()=>{T.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{T.parentNode&&T.parentNode.removeChild(T)},300)},3e3),console.log(`${g}: ${u}`)},Z=async()=>{J.value=!0;try{const u=await Le.get("/api/products");$.value=u.data.data||u.data||[],console.log("Fetched products:",$.value),console.log("First product structure:",$.value[0])}catch(u){console.error("Gagal mengambil data produk:",u),$.value=[]}finally{J.value=!1}},pe=u=>{!u&&$.value.length===0&&Z()},re=u=>{console.log("Product object changed:",u),c.value.selectedProduct=u,u?c.value.selectedProductId=u.id:c.value.selectedProductId=null},K=fe(()=>{if(console.log("Computing selected product info..."),console.log("form.selectedProduct:",c.value.selectedProduct),console.log("form.selectedProductId:",c.value.selectedProductId),c.value.selectedProduct)return console.log("Using selectedProduct object:",c.value.selectedProduct),c.value.selectedProduct;if(c.value.selectedProductId&&$.value.length>0){console.log("Searching for product with ID:",c.value.selectedProductId),console.log("Product IDs available:",$.value.map(g=>({id:g.id,name:g.name})));const u=$.value.find(g=>g.id===c.value.selectedProductId);return console.log("Found selected product by ID:",u),u}return console.log("No product selected or no products available"),null}),ce=()=>{console.log("Generating SKU...");const u=K.value;if(console.log("Product info for SKU:",u),console.log("Form name:",c.value.name),console.log("Form selectedProductId:",c.value.selectedProductId),!u||!c.value.name)return console.log("Missing productInfo or name, returning empty SKU"),"";const g=u.sku||"PROD",T=c.value.name.replace(/\s+/g,"").toUpperCase().substring(0,3),v=Date.now().toString().slice(-4),k=`${g}-${T}-${v}`;return console.log("Generated SKU:",k),k},ve=async()=>{var T,v;if(y.value)return;const{valid:u}=await L.value.validate();if(!u)return;const g=K.value;if(console.log("Product info in saveVariant:",g),!g){x("Produk tidak ditemukan","error");return}if(!g.id&&!g.id_product){x("ID Produk tidak valid","error"),console.error("Product missing ID:",g);return}y.value=!0;try{const k={id_product:g.id||g.id_product,name:c.value.name,sku:ce(),price:0,cost_price:null,barcode:null,variant_values:[],active:c.value.active};console.log("Payload being sent:",k),console.log("Payload JSON:",JSON.stringify(k));const s=await Le.post("/api/variants",k);if(console.log("API Response:",s.data),console.log("Response Status:",s.status),s.data.success!==!1&&(s.status===200||s.status===201))x("Variant berhasil dibuat!","success"),console.log("Created variant data:",s.data.data),M("save"),W();else throw new Error(s.data.message||"Gagal membuat variant")}catch(k){const s=((v=(T=k.response)==null?void 0:T.data)==null?void 0:v.message)||k.message||"Gagal membuat variant";x(s,"error"),console.error("Save variant error:",k)}finally{y.value=!1}},O=()=>{var u;c.value={name:"",selectedProduct:null,selectedProductId:null,active:!0},(u=L.value)==null||u.resetValidation()},W=()=>{M("update:modelValue",!1),O()};return we(()=>H.modelValue,u=>{u&&(O(),Z())}),(u,g)=>(_(),B(Oe,{"model-value":u.modelValue,"onUpdate:modelValue":g[3]||(g[3]=T=>u.$emit("update:modelValue",T)),"max-width":"600px",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"bg-primary text-white"},{default:t(()=>[e(V,{icon:"mdi-plus-circle",class:"me-2"}),g[4]||(g[4]=d(" Tambah Variant Baru ")),e(je),e(q,{icon:"mdi-close",variant:"text",color:"white",onClick:W})]),_:1,__:[4]}),e(Ct,{ref_key:"formRef",ref:L,onSubmit:Pt(ve,["prevent"])},{default:t(()=>[e(ie,{class:"pa-6"},{default:t(()=>[e(Ce,null,{default:t(()=>[e(D,{cols:"12"},{default:t(()=>[e(Vt,{modelValue:c.value.selectedProduct,"onUpdate:modelValue":[g[0]||(g[0]=T=>c.value.selectedProduct=T),re],items:$.value,loading:J.value,"item-title":"name","return-object":"",label:"Pilih Produk *",placeholder:"Cari produk...",variant:"outlined",rules:ee,required:"","no-data-text":"Tidak ada produk ditemukan","onUpdate:search":pe},{item:t(({props:T,item:v})=>[e(Ge,la(oa(T)),{prepend:t(()=>[e(Ie,{image:v.raw.image_url,size:"40"},{default:t(()=>[v.raw.image_url?j("",!0):(_(),B(V,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"])]),default:t(()=>[e(ot,null,{default:t(()=>[d(r(v.raw.name),1)]),_:2},1024),e(dt,null,{default:t(()=>[d("SKU: "+r(v.raw.sku||"-"),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:T})=>[l("div",ei,[e(Ie,{image:T.raw.image_url,size:"24"},{default:t(()=>[T.raw.image_url?j("",!0):(_(),B(V,{key:0,icon:"mdi-coffee",size:"16"}))]),_:2},1032,["image"]),l("span",null,r(T.raw.name),1)])]),_:1},8,["modelValue","items","loading"])]),_:1}),e(D,{cols:"12"},{default:t(()=>[e(he,{modelValue:c.value.name,"onUpdate:modelValue":g[1]||(g[1]=T=>c.value.name=T),label:"Nama Variant *",placeholder:"Contoh: Large Hot, Medium Cold, dll",variant:"outlined",rules:b,required:""},null,8,["modelValue"])]),_:1}),e(D,{cols:"12"},{default:t(()=>[e(Ee,{color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ft,null,{default:t(()=>[e(V,{icon:"mdi-information",class:"me-2"}),g[5]||(g[5]=d(" SKU Otomatis "))]),_:1,__:[5]}),l("div",ti,[g[6]||(g[6]=d(" SKU variant akan dibuat otomatis berdasarkan nama produk dan variant ")),c.value.name&&(c.value.selectedProduct||c.value.selectedProductId)?(_(),te("div",ai," Preview SKU: "+r(ce()),1)):c.value.name&&!c.value.selectedProduct&&!c.value.selectedProductId?(_(),te("div",li," Pilih produk terlebih dahulu untuk melihat preview SKU ")):j("",!0)])]),_:1})]),_:1}),e(D,{cols:"12"},{default:t(()=>[e(ct,{modelValue:c.value.active,"onUpdate:modelValue":g[2]||(g[2]=T=>c.value.active=T),label:"Variant Aktif",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Ae),e(qe,{class:"pa-6"},{default:t(()=>[e(je),e(q,{variant:"outlined",onClick:W,disabled:y.value},{default:t(()=>g[7]||(g[7]=[d(" Batal ")])),_:1,__:[7]},8,["disabled"]),e(q,{type:"submit",color:"primary",loading:y.value},{default:t(()=>g[8]||(g[8]=[d(" Simpan Variant ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),si=Je(oi,[["__scopeId","data-v-6f78bbf1"]]),ii={class:"product-variant-tab"},ni={class:"d-flex gap-2"},ri={key:0,class:"mt-4 d-flex align-center gap-2"},ui={key:1,class:"text-center pa-12"},di={key:2,class:"text-center pa-12"},ci={class:"d-flex align-center gap-3"},mi={class:"flex-grow-1 min-width-0"},vi={class:"text-h6 font-weight-bold text-truncate"},pi={class:"text-body-2 text-medium-emphasis mb-0"},fi={class:"d-flex flex-column gap-1"},gi={class:"text-xs"},_i={class:"d-flex align-center gap-2"},ki={class:"text-primary font-weight-medium"},yi={class:"d-flex gap-1"},bi={class:"d-flex align-center justify-space-between w-100"},hi={class:"d-flex gap-1"},xi=Re({__name:"ProductVariantTab",props:{loading:{type:Boolean}},emits:["refresh"],setup(I,{emit:ke}){const H=ke,M=A(!1),L=A([]),y=A(!1),J=A(!1),$=A(null),c=A(!1),b=A(!1),ee=A(!1),x=A({search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}),Z=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],pe=[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Variant Terbanyak",value:"variants_desc"},{title:"Variant Tersedikit",value:"variants_asc"}],re=fe(()=>!!(x.value.search||x.value.stockStatus||x.value.activeStatus!==null||x.value.sortBy!=="name_asc")),K=fe(()=>{const m={};return L.value.forEach(o=>{const i=o.id_product;m[i]||(m[i]={product:o.product||{id:o.id_product,id_product:o.id_product,name:`Product ${o.id_product}`,sku:""},variants:[]}),m[i].variants.push(o)}),Object.values(m)}),ce=fe(()=>{let m=[...K.value];if(x.value.search){const o=x.value.search.toLowerCase();m=m.filter(i=>{var C;return i.product.name.toLowerCase().includes(o)||((C=i.product.sku)==null?void 0:C.toLowerCase().includes(o))||i.variants.some(ge=>ge.name.toLowerCase().includes(o)||ge.sku.toLowerCase().includes(o))})}switch(x.value.stockStatus&&(m=m.filter(o=>o.variants.some(i=>{var ge;return(((ge=i.composition_summary)==null?void 0:ge.stock_status)||"safe")===x.value.stockStatus}))),x.value.activeStatus!==null&&(m=m.filter(o=>o.variants.some(i=>i.is_active===x.value.activeStatus))),x.value.sortBy){case"name_asc":m.sort((o,i)=>o.product.name.localeCompare(i.product.name));break;case"name_desc":m.sort((o,i)=>i.product.name.localeCompare(o.product.name));break;case"variants_desc":m.sort((o,i)=>i.variants.length-o.variants.length);break;case"variants_asc":m.sort((o,i)=>o.variants.length-i.variants.length);break}return m}),ve=(m,o="success")=>{},O=async m=>{try{console.log("ðŸ”„ Updating variant price from HPP dialog:",m);const o=L.value.findIndex(i=>i.id_variant===m.variantId);o!==-1&&(L.value[o]={...L.value[o],price:m.newPrice,cost:m.hpp},console.log("âœ… Variant price updated locally without reloading")),ve(`Price updated to ${new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(m.newPrice)}`,"success")}catch(o){console.error("Error handling price update:",o),await W()}},W=async()=>{var m,o,i;M.value=!0;try{const C=await Le.get("/api/variants",{params:{per_page:1e3,with_product:!0,with_composition:!0}});if(C.data.success===!1)throw new Error(C.data.message||"Failed to load variants");const ge=((m=C.data.data)==null?void 0:m.data)||C.data.data||[];L.value=ge.map(G=>({...G,is_active:G.active!==void 0?G.active:G.is_active,id:G.id_variant||G.id,id_product:G.id_product||G.product_id}))}catch(C){(i=(o=C.response)==null?void 0:o.data)!=null&&i.message||C.message,L.value=[]}finally{M.value=!1}},u=m=>{$.value=m,c.value=!0},g=m=>{m&&($.value=m,b.value=!0)},T=m=>{$.value=m,y.value=!0},v=()=>{ee.value=!0},k=async()=>{var m,o;if($.value)try{J.value=!0,await Le.delete(`/api/variants/${$.value.id_variant}`),ve("Variant berhasil dihapus","success"),await W(),y.value=!1}catch(i){(o=(m=i.response)==null?void 0:m.data)!=null&&o.message}finally{J.value=!1}},s=m=>{switch(m){case"critical":return"error";case"out":return"error";case"safe":return"success";default:return"primary"}},f=m=>{switch(m){case"critical":return"Kritis";case"out":return"Habis";case"safe":return"Aman";default:return"Normal"}},U=m=>{const o=m.filter(i=>i.is_active).length;return o===0?"error":o===m.length?"success":"warning"},le=m=>m.some(o=>{var C;const i=(C=o.composition_summary)==null?void 0:C.stock_status;return i==="critical"||i==="out"}),ne=m=>{const o=m.filter(C=>C.is_active).length,i=m.filter(C=>{var G;const ge=(G=C.composition_summary)==null?void 0:G.stock_status;return ge==="critical"||ge==="out"}).length;return i>0?{text:`${i} Stok Kritis`,color:"error",icon:"mdi-alert-circle"}:o===m.length?{text:"Semua Aktif",color:"success",icon:"mdi-check-circle"}:o===0?{text:"Semua Nonaktif",color:"error",icon:"mdi-close-circle"}:{text:`${o}/${m.length} Aktif`,color:"warning",icon:"mdi-minus-circle"}},ue=()=>{x.value={search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}},R=()=>{W(),H("refresh")},S=()=>{console.log("Variant created, refreshing data..."),W(),H("refresh")};return it(()=>{W()}),(m,o)=>{var i,C,ge;return _(),te("div",ii,[e(ae,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o[14]||(o[14]=l("div",null,[l("h2",{class:"text-h5 font-weight-bold"},"Variant Produk"),l("p",{class:"text-body-2 text-medium-emphasis"}," Kelola variant dan komposisi untuk produk Anda ")],-1)),l("div",ni,[e(q,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:W,loading:M.value},{default:t(()=>o[12]||(o[12]=[d(" Refresh ")])),_:1,__:[12]},8,["loading"]),e(q,{color:"primary","prepend-icon":"mdi-plus",onClick:v},{default:t(()=>o[13]||(o[13]=[d(" Tambah Variant ")])),_:1,__:[13]})])]),_:1,__:[14]})]),_:1}),e(ae,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(D,{cols:"12",md:"3"},{default:t(()=>[e(he,{modelValue:x.value.search,"onUpdate:modelValue":o[0]||(o[0]=G=>x.value.search=G),label:"Cari Variant",placeholder:"Nama variant, SKU, atau produk...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(Ke,{modelValue:x.value.stockStatus,"onUpdate:modelValue":o[1]||(o[1]=G=>x.value.stockStatus=G),items:Z,label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(Ke,{modelValue:x.value.activeStatus,"onUpdate:modelValue":o[2]||(o[2]=G=>x.value.activeStatus=G),items:[{title:"Semua Status",value:null},{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Status Aktif",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(Ke,{modelValue:x.value.sortBy,"onUpdate:modelValue":o[3]||(o[3]=G=>x.value.sortBy=G),items:pe,label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),re.value?(_(),te("div",ri,[o[16]||(o[16]=l("span",{class:"text-body-2"},"Filter aktif:",-1)),x.value.search?(_(),B(me,{key:0,size:"small",closable:"","onClick:close":o[4]||(o[4]=G=>x.value.search="")},{default:t(()=>[d(" Pencarian: "+r(x.value.search),1)]),_:1})):j("",!0),x.value.stockStatus?(_(),B(me,{key:1,size:"small",closable:"","onClick:close":o[5]||(o[5]=G=>x.value.stockStatus="")},{default:t(()=>{var G;return[d(" Stok: "+r((G=Z.find(_e=>_e.value===x.value.stockStatus))==null?void 0:G.title),1)]}),_:1})):j("",!0),x.value.activeStatus!==null?(_(),B(me,{key:2,size:"small",closable:"","onClick:close":o[6]||(o[6]=G=>x.value.activeStatus=null)},{default:t(()=>[d(" Status: "+r(x.value.activeStatus?"Aktif":"Nonaktif"),1)]),_:1})):j("",!0),e(q,{variant:"text",size:"small",color:"error",onClick:ue},{default:t(()=>o[15]||(o[15]=[d(" Hapus Semua Filter ")])),_:1,__:[15]})])):j("",!0)]),_:1})]),_:1}),!M.value&&ce.value.length===0&&re.value?(_(),B(Ee,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada variant yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):j("",!0),M.value?(_(),te("div",ui,[e(gt,{color:"primary",indeterminate:"",size:"64"}),o[17]||(o[17]=l("div",{class:"mt-4 text-h6"},"Memuat variant...",-1))])):K.value.length===0?(_(),te("div",di,[e(V,{icon:"mdi-tune-variant",size:"96",class:"text-disabled mb-6"}),o[19]||(o[19]=l("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Variant Produk",-1)),o[20]||(o[20]=l("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat variant untuk produk Anda agar dapat menawarkan pilihan yang beragam ",-1)),e(q,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:v},{default:t(()=>o[18]||(o[18]=[d(" Buat Variant Pertama ")])),_:1,__:[18]})])):(_(),B(Ce,{key:3},{default:t(()=>[(_(!0),te(ze,null,We(ce.value,G=>(_(),B(D,{key:G.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ae,{class:Qe(["variant-group-card h-100",{"border-error":le(G.variants)}]),elevation:"2"},{default:t(()=>[e(Pe,{class:"pa-4 pb-2"},{default:t(()=>[l("div",ci,[e(Ie,{image:G.product.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[G.product.image_url?j("",!0):(_(),B(V,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),l("div",mi,[l("h3",vi,r(G.product.name),1),l("p",pi," SKU: "+r(G.product.sku||"-"),1)]),e(me,{color:U(G.variants),size:"small",variant:"tonal"},{default:t(()=>[d(r(G.variants.length)+" Variant ",1)]),_:2},1032,["color"])])]),_:2},1024),e(Ae),e(ie,{class:"pa-4"},{default:t(()=>[e(_t,{class:"pa-0"},{default:t(()=>[(_(!0),te(ze,null,We(G.variants,(_e,De)=>(_(),B(Ge,{key:_e.id_variant,class:Qe(["pa-2 rounded-lg variant-item",{"mb-2":De<G.variants.length-1}])},{prepend:t(()=>[e(Ie,{size:"32",color:_e.is_active?"success":"error",variant:"tonal"},{default:t(()=>[e(V,{icon:_e.is_active?"mdi-check":"mdi-close",size:"16"},null,8,["icon"])]),_:2},1032,["color"])]),append:t(()=>[l("div",yi,[e(Fe,{text:"Kelola Komposisi"},{activator:t(({props:oe})=>[e(q,Ve({ref_for:!0},oe,{icon:"mdi-chef-hat",size:"small",variant:"text",color:"primary",onClick:Me=>u(_e)}),null,16,["onClick"])]),_:2},1024),e(Fe,{text:"Hapus Variant"},{activator:t(({props:oe})=>[e(q,Ve({ref_for:!0},oe,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Me=>T(_e)}),null,16,["onClick"])]),_:2},1024)])]),default:t(()=>[e(ot,{class:"text-sm font-weight-medium"},{default:t(()=>[d(r(_e.name),1)]),_:2},1024),e(dt,null,{default:t(()=>[l("div",fi,[l("span",gi,"SKU: "+r(_e.sku),1),l("div",_i,[l("span",ki,r(E(Te)(_e.price||0)),1),_e.composition_summary?(_(),B(me,{key:0,color:s(_e.composition_summary.stock_status),size:"x-small",variant:"tonal"},{default:t(()=>[d(r(f(_e.composition_summary.stock_status)),1)]),_:2},1032,["color"])):j("",!0)])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:2},1024)]),_:2},1024),e(Ae),e(qe,{class:"pa-4"},{default:t(()=>[l("div",bi,[l("div",null,[e(me,{color:ne(G.variants).color,size:"small",variant:"tonal"},{default:t(()=>[e(V,{icon:ne(G.variants).icon,size:"14",class:"me-1"},null,8,["icon"]),d(" "+r(ne(G.variants).text),1)]),_:2},1032,["color"])]),l("div",hi,[e(Fe,{text:"Setting HPP Produk"},{activator:t(({props:_e})=>[e(q,Ve({ref_for:!0},_e,{icon:"mdi-calculator-variant",size:"small",variant:"text",color:"warning",onClick:De=>g(G.variants[0])}),null,16,["onClick"])]),_:2},1024),e(Fe,{text:"Tambah Variant"},{activator:t(({props:_e})=>[e(q,Ve({ref_for:!0},_e,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:v}),null,16)]),_:1}),e(Fe,{text:"Pengaturan Produk (Coming Soon)"},{activator:t(({props:_e})=>[e(q,Ve({ref_for:!0},_e,{icon:"mdi-cog",size:"small",variant:"text",color:"secondary",disabled:""}),null,16)]),_:1})])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(Ys,{modelValue:c.value,"onUpdate:modelValue":o[7]||(o[7]=G=>c.value=G),variant:$.value,onSave:R},null,8,["modelValue","variant"]),e(Et,{modelValue:b.value,"onUpdate:modelValue":o[8]||(o[8]=G=>b.value=G),"variant-id":(i=$.value)==null?void 0:i.id_variant,"variant-name":(C=$.value)==null?void 0:C.name,onHppUpdated:W,onPriceUpdated:O},null,8,["modelValue","variant-id","variant-name"]),e(si,{modelValue:ee.value,"onUpdate:modelValue":o[9]||(o[9]=G=>ee.value=G),onSave:S},null,8,["modelValue"]),e(Tt,{modelValue:y.value,"onUpdate:modelValue":o[10]||(o[10]=G=>y.value=G),title:"Konfirmasi Hapus Variant","item-name":(ge=$.value)==null?void 0:ge.name,loading:J.value,"confirm-text":"Hapus Variant",onConfirm:k,onCancel:o[11]||(o[11]=G=>y.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),At=Je(xi,[["__scopeId","data-v-edd5278d"]]),wi={class:"product-management"},Pi={class:"d-flex justify-space-between align-center mb-6"},Vi={class:"d-flex gap-3 align-center"},Ci={key:0,class:"d-flex gap-2"},Ii={class:"d-flex align-center"},Si=Re({__name:"products-management",setup(I){Ht();const{productsList:ke,categories:H,loading:M,saveLoading:L,deleteLoading:y,toggleLoading:J,stats:$,dialog:c,deleteDialog:b,editMode:ee,selectedProduct:x,selectedProducts:Z,currentPage:pe,totalItems:re,itemsPerPage:K,filters:ce,errorMessage:ve,successMessage:O,modalErrorMessage:W,formData:u,selectedImage:g,imagePreview:T,canCreateEdit:v,hasSelectedProducts:k,fetchProductsList:s,fetchCategories:f,fetchStats:U,saveProduct:le,deleteProduct:ne,bulkDeleteProducts:ue,toggleActiveStatus:R,toggleFeaturedStatus:S,openCreateDialog:m,openEditDialog:o,openDeleteDialog:i,closeDialog:C,handleImageUpload:ge,clearModalError:G,onPageChange:_e}=Mt(),{dialog:De,editMode:oe,formData:Me,availableItems:Se,saveLoading:Xe,modalErrorMessage:Ze,openCreateDialog:Be,closeDialog:n,saveRecipe:a,clearModalError:p,fetchAvailableItems:z}=va(),{productItemsList:F,loading:P,fetchProductItemsForComposition:h}=Kt(),N=A("products"),w=A(),se=A(!1),de=A(null),be=A(!1),xe=A(null),$e=async()=>{await ne()},He=async()=>{await ue()},Ne=ye=>{const Q=ye.id_product||ye.id;Be(Q)},Ye=async ye=>{de.value=ye;try{await h({page:1,per_page:50,critical_only:!1})}catch{}se.value=!0},et=ye=>{xe.value=ye,be.value=!0},tt=ye=>{if(!ye)return[];const Q=ye.id_product||ye.id;return F.value.filter(X=>{var Y;return((Y=X.product)==null?void 0:Y.id_product)===Q||X.product_id===Q})||[]},nt=async()=>{if(await h({page:1,per_page:50,critical_only:!1}),await s(),de.value&&w.value){const ye=de.value.id_product||de.value.id;await w.value.refreshHPPData(ye)}},mt=ye=>{Object.assign(ce,ye),s()},vt=ye=>{ce.search=ye,s()},lt=()=>{g.value=null,T.value&&(T.value="")};return we(N,async ye=>{ye==="compositions"&&await h({page:1,per_page:15,critical_only:!1})},{immediate:!1}),it(()=>{s(),f(),U(),z()}),(ye,Q)=>{var X;return _(),te("div",wi,[l("div",Pi,[Q[18]||(Q[18]=l("div",null,[l("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),l("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),l("div",Vi,[E(k)&&N.value==="products"?(_(),te("div",Ci,[e(me,{color:"primary",size:"small"},{default:t(()=>[d(r(E(Z).length)+" dipilih ",1)]),_:1}),e(q,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:He},{default:t(()=>Q[16]||(Q[16]=[d(" Hapus Terpilih ")])),_:1,__:[16]})])):j("",!0),E(v)&&N.value==="products"?(_(),B(q,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:E(m)},{default:t(()=>Q[17]||(Q[17]=[d(" Tambah Produk ")])),_:1,__:[17]},8,["onClick"])):j("",!0)])]),e(Sa,{modelValue:N.value,"onUpdate:modelValue":Q[0]||(Q[0]=Y=>N.value=Y),class:"mb-6"},{default:t(()=>[e(yt,{value:"products"},{default:t(()=>[e(V,{icon:"mdi-coffee",class:"me-2"}),Q[19]||(Q[19]=d(" Produk "))]),_:1,__:[19]}),e(yt,{value:"compositions"},{default:t(()=>[e(V,{icon:"mdi-chef-hat",class:"me-2"}),Q[20]||(Q[20]=d(" Komposisi Produk "))]),_:1,__:[20]}),e(yt,{value:"variants"},{default:t(()=>[e(V,{icon:"mdi-tune-variant",class:"me-2"}),Q[21]||(Q[21]=d(" Variant Produk "))]),_:1,__:[21]})]),_:1},8,["modelValue"]),E(ve)?(_(),B(Ee,{key:0,type:"error",variant:"outlined",class:"mb-4",text:E(ve),closable:"","onClick:close":Q[1]||(Q[1]=Y=>ve.value="")},null,8,["text"])):j("",!0),E(O)?(_(),B(Ee,{key:1,type:"success",variant:"outlined",class:"mb-4",text:E(O),closable:"","onClick:close":Q[2]||(Q[2]=Y=>O.value="")},null,8,["text"])):j("",!0),e($a,{modelValue:N.value,"onUpdate:modelValue":Q[4]||(Q[4]=Y=>N.value=Y)},{default:t(()=>[e(bt,{value:"products"},{default:t(()=>[e(Bo,{stats:E($)},null,8,["stats"]),e(xo,{filters:E(ce),"onUpdate:filters":mt,onSearch:vt},null,8,["filters"]),e(is,{ref_key:"productTableRef",ref:w,products:E(ke),loading:E(M),"current-page":E(pe),"total-items":E(re),"items-per-page":E(K),"selected-products":E(Z),"toggle-loading":E(J),"onUpdate:page":E(_e),onAddProduct:E(m),onEditProduct:E(o),onOpenRecipeDialog:Ne,onOpenCompositionDialog:Ye,onOpenVariantDialog:et,onDeleteProduct:E(i),onToggleActive:E(R),onToggleFeatured:E(S),"onUpdate:selectedProducts":Q[3]||(Q[3]=Y=>Z.value=Y)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:page","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured"])]),_:1}),e(bt,{value:"compositions"},{default:t(()=>[e(Rl,{"product-items":E(F),loading:E(P),onRefresh:E(h)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(bt,{value:"variants"},{default:t(()=>[e(At,{loading:E(M),onRefresh:E(s)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(_o,{modelValue:E(c),"onUpdate:modelValue":[Q[5]||(Q[5]=Y=>kt(c)?c.value=Y:null),Q[6]||(Q[6]=Y=>c.value=Y)],"edit-mode":E(ee),"form-data":E(u),categories:E(H),loading:E(L),"error-message":E(W),"selected-image":E(g)?[E(g)]:[],"image-preview":E(T),onClose:E(C),onSubmit:E(le),onImageChange:E(ge),onRemoveImage:lt,onClearError:E(G),onUpdateForm:Q[7]||(Q[7]=(Y,Ue)=>E(u)[Y]=Ue)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(pa,{modelValue:E(De),"onUpdate:modelValue":[Q[8]||(Q[8]=Y=>kt(De)?De.value=Y:null),Q[9]||(Q[9]=Y=>De.value=Y)],"edit-mode":E(oe),"form-data":E(Me),"available-items":E(Se),loading:E(Xe),"error-message":E(Ze),onClose:E(n),onSave:E(a),onClearError:E(p)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(Tt,{modelValue:E(b),"onUpdate:modelValue":Q[10]||(Q[10]=Y=>kt(b)?b.value=Y:null),title:"Konfirmasi Hapus Produk","item-name":(X=E(x))==null?void 0:X.name,loading:E(y),"confirm-text":"Hapus Produk",onConfirm:$e,onCancel:Q[11]||(Q[11]=Y=>b.value=!1)},null,8,["modelValue","item-name","loading"]),e(Ft,{modelValue:se.value,"onUpdate:modelValue":Q[12]||(Q[12]=Y=>se.value=Y),product:de.value,items:tt(de.value),onSave:nt,onRefresh:nt},null,8,["modelValue","product","items"]),e(Oe,{modelValue:be.value,"onUpdate:modelValue":Q[15]||(Q[15]=Y=>be.value=Y),"max-width":"1400px",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex justify-between align-center"},{default:t(()=>{var Y;return[l("div",Ii,[e(V,{icon:"tabler-versions",class:"me-2"}),d(" Kelola Variant - "+r((Y=xe.value)==null?void 0:Y.name),1)]),e(q,{icon:"tabler-x",variant:"text",onClick:Q[13]||(Q[13]=Ue=>be.value=!1)})]}),_:1}),e(Ae),e(ie,{class:"pa-0"},{default:t(()=>[xe.value?(_(),B(At,{key:0,product:xe.value},null,8,["product"])):j("",!0)]),_:1}),e(Ae),e(qe,null,{default:t(()=>[e(je),e(q,{color:"grey-darken-1",variant:"outlined",onClick:Q[14]||(Q[14]=Y=>be.value=!1)},{default:t(()=>[e(V,{icon:"mdi-close",class:"me-1"}),Q[22]||(Q[22]=d(" Tutup "))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),xn=Je(Si,[["__scopeId","data-v-9db14e64"]]);export{xn as default};
