import{D as nt}from"./DeleteConfirmationDialog-DdO-7d3n.js";import{d as me,r as C,V as z,w as rt,g as $,f as o,b as e,e as d,t as _,a0 as U,l as L,s as v,$ as dt,p as ut,o as f,a as ct,c as D,F as oe,i as se,X as B,v as Ae,aE as mt,aI as Y,aD as Fe,a3 as pt,D as gt,m as c,a5 as ft,j as vt}from"./main-D0MmhKIS.js";import{V as Ue}from"./VDialog-DQ9epeAB.js";import{b as le,c as be,V as J}from"./VCard-BJhGDgmR.js";import{V as X}from"./VDivider-DKnwMEqz.js";import{V as Z}from"./VCardText-Cigzlmt1.js";import{V as F,a as H}from"./VAlert-BtYpKAev.js";import{V as _t}from"./VForm-Csxnnzyz.js";import{V as ue,a as T}from"./VRow-oPf8NyDJ.js";import{V as ce}from"./VSelect-Bso9j8Vk.js";import{a as yt}from"./VList-B_4B6dZA.js";import{V as Q,a as kt}from"./VChip-D_U9LKjK.js";import{V as Ee}from"./VTextField-Byrjwsdy.js";import{V as Le}from"./VCheckbox-CAQ6EcRo.js";import{V as bt}from"./VTextarea-VOuhYtQK.js";import{V as Ce}from"./VSpacer-CzkSGOQK.js";import{V as fe}from"./VTooltip-CSLbUiNF.js";import{a as Ct,V as ht}from"./VDataTable-kI07tSx-.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{I as wt}from"./ItemsApi-Cbn8a4H4.js";import{P as Pt}from"./ProductsApi-DfQEuEu2.js";import"./VOverlay-BrX423JY.js";import"./forwardRefs-B931MWyl.js";import"./VImg-Bx7Fzmg2.js";import"./VAvatar-94E7WQVg.js";/* empty css              */import"./VMenu-Z2BJb_lx.js";import"./VCheckboxBtn-B5dX3uqm.js";import"./VTable-Xo_nJwVD.js";import"./filter-DJwgkMKs.js";const Dt={class:"text-h5"},Vt={class:"text-body-2"},xt={class:"d-flex align-center justify-space-between"},It=me({__name:"ProductItemDialog",props:{dialog:{type:Boolean},editMode:{type:Boolean},formData:{},loading:{type:Boolean},products:{},items:{},errorMessage:{}},emits:["update:dialog","update:errorMessage","update:formData","save","itemChange"],setup(t,{emit:l}){const i=t,k=l,P=C(),A=C(!1),I=z({get:()=>i.dialog,set:a=>k("update:dialog",a)}),S=z({get:()=>i.formData,set:a=>k("update:formData",a)}),x={required:a=>!!a||"This field is required",positiveNumber:a=>a>0||"Must be greater than 0",stockValidation:a=>{if(!a||a<=0)return"Jumlah harus lebih dari 0";const s=h();if(!s)return!0;const u=p(s);return a<=u||`Jumlah tidak boleh melebihi stok tersedia (${u})`}},h=()=>i.items.find(a=>a.id_item===i.formData.item_id),p=a=>a?a.inventory?a.inventory.available_stock||a.inventory.current_stock||0:a.current_stock||a.available_stock||0:0,r=()=>{const a=h();return!a||!i.formData.quantity_needed?!1:i.formData.quantity_needed>p(a)},g=()=>{const a=h();if(!a||!i.formData.quantity_needed)return"primary";const s=p(a),u=i.formData.quantity_needed,b=u/s*100;return u>s?"error":b>80?"warning":"primary"},te=()=>{const a=h();if(!a)return"";const s=p(a),u=i.formData.quantity_needed||0,b=s>0?(u/s*100).toFixed(1):"0";return`Stok tersedia: ${s} | Akan menggunakan: ${b}%`},ae=z(()=>i.items.map(a=>{const s=p(a),u=s<=0?"OUT_OF_STOCK":s<=10?"LOW_STOCK":"IN_STOCK",b=u==="OUT_OF_STOCK"?"error":u==="LOW_STOCK"?"warning":"success",j=u==="OUT_OF_STOCK"?"Habis":u==="LOW_STOCK"?`${s} (Rendah)`:`${s}`,W=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a.cost_per_unit||0);return{...a,displayName:`${a.name} (${s} ${a.unit})`,stockStatus:u,stockChipColor:b,stockText:j,formattedCost:W}})),n=(a,s)=>{const u={...i.formData,[a]:s};k("update:formData",u)},m=a=>{n("item_id",a),k("itemChange",a)},V=async()=>{var s;const{valid:a}=await((s=P.value)==null?void 0:s.validate());a&&k("save")};return rt(I,a=>{a||k("update:errorMessage","")}),(a,s)=>(f(),$(Ue,{modelValue:I.value,"onUpdate:modelValue":s[9]||(s[9]=u=>I.value=u),persistent:"","max-width":"600px",scrollable:""},{default:o(()=>[e(J,null,{default:o(()=>[e(le,{class:"d-flex justify-space-between align-center"},{default:o(()=>[d("span",Dt,_(a.editMode?"Edit Komposisi Produk":"Tambah Komposisi Produk"),1),e(U,{icon:"tabler-x",size:"small",variant:"text",onClick:s[0]||(s[0]=u=>I.value=!1)})]),_:1}),e(X),e(Z,null,{default:o(()=>[a.errorMessage?(f(),$(F,{key:0,type:"error",variant:"outlined",class:"mb-4",text:a.errorMessage,closable:"","onClick:close":s[1]||(s[1]=()=>k("update:errorMessage",""))},null,8,["text"])):L("",!0),r()?(f(),$(F,{key:1,type:"warning",variant:"tonal",density:"compact",class:"mb-4"},{default:o(()=>[e(H,{class:"mb-2"},{default:o(()=>s[10]||(s[10]=[v("Peringatan Stok")])),_:1,__:[10]}),d("div",Vt,[v(" Jumlah yang dibutuhkan ("+_(a.formData.quantity_needed)+") melebihi stok tersedia ("+_(h()?p(h()):0)+"). ",1),s[11]||(s[11]=d("br",null,null,-1)),s[12]||(s[12]=v(" Silakan kurangi jumlah yang dibutuhkan atau pastikan stok mencukupi. "))])]),_:1})):L("",!0),e(_t,{ref_key:"formRef",ref:P,modelValue:A.value,"onUpdate:modelValue":s[7]||(s[7]=u=>A.value=u),onSubmit:dt(V,["prevent"])},{default:o(()=>[e(ue,null,{default:o(()=>[e(T,{cols:"12"},{default:o(()=>[e(ce,{"model-value":S.value.product_id,items:a.products,"item-title":"name","item-value":"id_product",label:"Produk *",rules:[x.required],variant:"outlined",clearable:"",disabled:a.editMode,"no-data-text":"Tidak ada produk tersedia","onUpdate:modelValue":s[2]||(s[2]=u=>n("product_id",u))},null,8,["model-value","items","rules","disabled"])]),_:1}),e(T,{cols:"12"},{default:o(()=>[e(ce,{"model-value":S.value.item_id,items:ae.value,"item-title":"displayName","item-value":"id_item",label:"Item *",rules:[x.required],variant:"outlined",clearable:"",disabled:a.editMode,"no-data-text":"Tidak ada item tersedia","onUpdate:modelValue":m},{item:o(({props:u,item:b})=>[e(yt,ut(u,{disabled:b.raw.stockStatus==="OUT_OF_STOCK"}),{title:o(()=>[v(_(b.raw.name),1)]),subtitle:o(()=>[d("div",xt,[d("span",null,_(b.raw.unit)+" â€¢ "+_(b.raw.formattedCost),1),e(Q,{color:b.raw.stockChipColor,size:"x-small",variant:"tonal"},{default:o(()=>[v(_(b.raw.stockText),1)]),_:2},1032,["color"])])]),_:2},1040,["disabled"])]),_:1},8,["model-value","items","rules","disabled"])]),_:1}),e(T,{cols:"6"},{default:o(()=>[e(Ee,{"model-value":S.value.quantity_needed,type:"number",label:"Jumlah Dibutuhkan *",rules:[x.required,x.positiveNumber,x.stockValidation],variant:"outlined",min:"1",step:"1",max:h()?p(h()):void 0,color:g(),error:r(),"error-messages":r()?`Stok tidak cukup (${h()?p(h()):0} tersedia)`:[],hint:te(),"persistent-hint":"","onUpdate:modelValue":s[3]||(s[3]=u=>n("quantity_needed",u?parseInt(u):0))},null,8,["model-value","rules","max","color","error","error-messages","hint"])]),_:1}),e(T,{cols:"6"},{default:o(()=>[e(Ee,{"model-value":S.value.unit,label:"Satuan *",rules:[x.required],variant:"outlined",placeholder:"e.g., kg, liter, pcs","onUpdate:modelValue":s[4]||(s[4]=u=>n("unit",u))},null,8,["model-value","rules"])]),_:1}),e(T,{cols:"12"},{default:o(()=>[e(Le,{"model-value":S.value.is_critical,label:"Item Kritis",hint:"Tandai jika item ini sangat penting untuk produksi","onUpdate:modelValue":s[5]||(s[5]=u=>n("is_critical",u))},null,8,["model-value"])]),_:1}),e(T,{cols:"12"},{default:o(()=>[e(bt,{"model-value":S.value.notes,label:"Catatan",variant:"outlined",rows:"3",placeholder:"Catatan tambahan tentang hubungan produk-item ini...","onUpdate:modelValue":s[6]||(s[6]=u=>n("notes",u))},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(X),e(be,{class:"px-6 py-4"},{default:o(()=>[e(Ce),e(U,{variant:"text",onClick:s[8]||(s[8]=u=>I.value=!1)},{default:o(()=>s[13]||(s[13]=[v(" Batal ")])),_:1,__:[13]}),e(U,{color:"primary",loading:a.loading,disabled:!A.value||r(),onClick:V},{default:o(()=>[v(_(a.editMode?"Perbarui":"Simpan"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),$t={class:"product-item-group-view pa-4"},St={class:"d-flex justify-space-between align-start mb-3"},Tt={class:"flex-grow-1"},At={class:"text-h6 font-weight-bold mb-1"},Et={class:"text-body-2 text-grey mb-0"},Ft={class:"items-list"},Ut={class:"text-subtitle-2 font-weight-bold mb-3 text-grey-darken-1"},Lt={class:"d-flex justify-space-between align-center"},Ot={class:"flex-grow-1"},Mt={class:"d-flex align-center mb-1"},Kt={class:"text-body-1 font-weight-medium"},Nt={class:"d-flex align-center text-body-2 text-grey"},qt={class:"d-flex align-center"},zt={class:"text-caption text-grey"},jt={key:3,class:"d-flex justify-center mt-4"},Bt=me({__name:"ProductItemGroupView",props:{productItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},totalItems:{},products:{},items:{}},emits:["edit","delete","check-capacity","view-hpp","update:page"],setup(t,{emit:l}){const i=t,k=l,P=n=>{var m;console.log("ðŸ”§ EDIT CLICKED!",n),console.log(`EDIT CLICKED: ${(m=n.item)==null?void 0:m.name}`),k("edit",n)},A=n=>{var m;console.log("ðŸ—‘ï¸ DELETE CLICKED!",n),console.log(`DELETE CLICKED: ${(m=n.item)==null?void 0:m.name}`),k("delete",n)},I=n=>{console.log("ðŸ“Š CAPACITY CLICKED!",n),console.log(`CAPACITY CLICKED: ${n.name}`),k("check-capacity",n)},S=z(()=>{console.log("ðŸ” Grouping product items..."),console.log("ðŸ“¦ Available products:",i.products.length),console.log("ðŸ§° Available items:",i.items.length),console.log("ðŸ”— Product items to group:",i.productItems.length);const n={};i.productItems.forEach(V=>{const a=V.product_id,s=i.products.find(b=>b.id_product===a);console.log(`Looking for product ID ${a}:`,s?`Found: ${s.name}`:"NOT FOUND"),n[a]||(n[a]={product:s||{id_product:a,name:"Unknown Product",sku:"N/A"},items:[]});const u=i.items.find(b=>b.id_item===V.item_id);console.log(`Looking for item ID ${V.item_id}:`,u?`Found: ${u.name}`:"NOT FOUND"),n[a].items.push({...V,item:u})});const m=Object.values(n);return console.log("âœ… Final grouped result:",m),m}),x=n=>{if(n==null||n==="")return"0";const m=typeof n=="string"?Number.parseFloat(n):n;return isNaN(m)?"0":new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:3}).format(m)},h=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),p=n=>n.some(m=>{var V;return(V=m.item)==null?void 0:V.is_low_stock}),r=n=>p(n)?"warning":"success",g=n=>p(n)?"Stok Rendah":"Stok Aman",te=n=>{var m;return(m=n.inventory)!=null&&m.is_low_stock||n.is_low_stock?"text-warning":"text-success"},ae=n=>{var m;return(m=n.inventory)!=null&&m.is_low_stock||n.is_low_stock?"mdi-alert-circle":"mdi-check-circle"};return(n,m)=>{const V=ct("VSkeleton");return f(),D("div",$t,[n.loading?(f(),$(ue,{key:0},{default:o(()=>[(f(),D(oe,null,se(3,a=>e(T,{key:a,cols:"12",md:"6",lg:"4"},{default:o(()=>[e(J,{elevation:"0",variant:"outlined",class:"mb-4"},{default:o(()=>[e(Z,null,{default:o(()=>[e(V,{type:"text",width:"60%",class:"mb-2"}),e(V,{type:"text",width:"40%",class:"mb-4"}),(f(),D(oe,null,se(3,s=>e(V,{key:s,type:"text",width:"100%",class:"mb-1"})),64))]),_:1})]),_:1})]),_:2},1024)),64))]),_:1})):S.value.length===0?(f(),$(J,{key:1,elevation:"0",variant:"outlined",class:"text-center pa-8"},{default:o(()=>[e(B,{icon:"mdi-package-variant-closed",size:"64",color:"grey-lighten-1",class:"mb-4"}),m[1]||(m[1]=d("h3",{class:"text-h6 text-grey-darken-1 mb-2"}," Belum Ada Komposisi Produk ",-1)),m[2]||(m[2]=d("p",{class:"text-body-2 text-grey"}," Mulai tambahkan komposisi produk untuk mengelola item yang dibutuhkan ",-1))]),_:1,__:[1,2]})):(f(),$(ue,{key:2},{default:o(()=>[(f(!0),D(oe,null,se(S.value,a=>(f(),$(T,{key:a.product.id_product,cols:"12",md:"6",lg:"4"},{default:o(()=>[e(J,{elevation:"1",variant:"flat",class:Ae(["mb-4 product-card",{"border-warning":p(a.items)}])},{default:o(()=>[e(Z,{class:"pb-2"},{default:o(()=>[d("div",St,[d("div",Tt,[d("h3",At,_(a.product.name),1),d("p",Et,_(a.product.sku),1)]),e(Q,{color:r(a.items),variant:"tonal",size:"small"},{default:o(()=>[v(_(g(a.items)),1)]),_:2},1032,["color"])]),e(X,{class:"my-3"}),d("div",Ft,[d("h4",Ut," Item Komposisi ("+_(a.items.length)+") ",1),(f(!0),D(oe,null,se(a.items,s=>{var u,b,j,W;return f(),D("div",{key:s.id_product_item,class:"item-row mb-3"},[d("div",Lt,[d("div",Ot,[d("div",Mt,[d("h5",Kt,_(((u=s.item)==null?void 0:u.name)||"Unknown Item"),1),s.is_critical?(f(),$(Q,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:o(()=>m[3]||(m[3]=[v(" Kritis ")])),_:1,__:[3]})):L("",!0)]),d("div",Nt,[e(B,{icon:"mdi-scale",size:"16",class:"mr-1"}),d("span",null,_(x(s.quantity_needed))+" "+_((b=s.item)==null?void 0:b.unit),1)]),s.item?(f(),D("div",{key:0,class:Ae(["d-flex align-center text-caption mt-1",te(s.item)])},[e(B,{icon:ae(s.item),size:"12",class:"mr-1"},null,8,["icon"]),d("span",null," Stok: "+_(x((j=s.item.inventory)==null?void 0:j.current_stock))+" "+_(s.item.unit),1)],2)):L("",!0)]),d("div",qt,[e(U,{icon:"",variant:"text",size:"small",color:"primary",onClick:de=>P(s)},{default:o(()=>[e(B,{icon:"mdi-pencil",size:"16"}),e(fe,{activator:"parent",location:"top"},{default:o(()=>m[4]||(m[4]=[v(" Edit ")])),_:1,__:[4]})]),_:2},1032,["onClick"]),e(U,{icon:"",variant:"text",size:"small",color:"info",disabled:!((W=s.item)!=null&&W.id_item),onClick:de=>I(a.product)},{default:o(()=>[e(B,{icon:"mdi-calculator",size:"16"}),e(fe,{activator:"parent",location:"top"},{default:o(()=>m[5]||(m[5]=[v(" Cek Kapasitas ")])),_:1,__:[5]})]),_:2},1032,["disabled","onClick"]),e(U,{icon:"",variant:"text",size:"small",color:"error",onClick:de=>A(s)},{default:o(()=>[e(B,{icon:"mdi-delete",size:"16"}),e(fe,{activator:"parent",location:"top"},{default:o(()=>m[6]||(m[6]=[v(" Hapus ")])),_:1,__:[6]})]),_:2},1032,["onClick"])])]),a.items.indexOf(s)<a.items.length-1?(f(),$(X,{key:0,class:"mt-2"})):L("",!0)])}),128))])]),_:2},1024),e(be,{class:"pt-0 px-4 pb-3"},{default:o(()=>[e(U,{variant:"tonal",color:"orange",size:"small","prepend-icon":"mdi-calculator-variant",onClick:s=>n.$emit("view-hpp",a.product)},{default:o(()=>m[7]||(m[7]=[v(" Setting HPP ")])),_:2,__:[7]},1032,["onClick"]),e(Ce),d("div",zt," Harga: "+_(h(a.product.price||0)),1)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),n.totalItems>n.itemsPerPage?(f(),D("div",jt,[e(Ct,{"model-value":n.currentPage,length:Math.ceil(n.totalItems/n.itemsPerPage),"onUpdate:modelValue":m[0]||(m[0]=a=>n.$emit("update:page",a))},null,8,["model-value","length"])])):L("",!0)])}}}),Ht=Oe(Bt,[["__scopeId","data-v-a03365bf"]]),Rt={key:0,class:"text-center py-8"},Jt={key:1},Wt={class:"mt-2"},Yt={class:"text-h4 font-weight-bold"},Qt={key:0,class:"mb-6"},Xt={class:"d-flex align-center gap-2"},Zt={class:"font-weight-medium"},Gt={class:"text-caption text-medium-emphasis"},ea={class:"text-end"},ta={class:"font-weight-medium"},aa={class:"text-end"},oa={class:"font-weight-medium"},sa={class:"text-end"},la={class:"mt-6"},ia={key:0},na={key:1},ra={key:2},da={key:2},ua=me({__name:"ProductionCapacityDialog",props:{dialog:{type:Boolean},loading:{type:Boolean},productionCapacity:{},selectedProduct:{}},emits:["update:dialog"],setup(t,{emit:l}){const i=t,k=l,P=z({get:()=>i.dialog,set:p=>k("update:dialog",p)}),A=[{title:"Item",value:"item_name",sortable:!1},{title:"Available",value:"available_stock",align:"end"},{title:"Needed/Unit",value:"needed_per_product",align:"end"},{title:"Can Produce",value:"can_produce",align:"end"},{title:"Status",value:"status",align:"center"}],I=p=>new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2}).format(p),S=p=>p.can_produce===0?"tabler-alert-triangle":p.can_produce<5?"tabler-alert-circle":"tabler-check-circle",x=p=>p.can_produce===0?"error":p.can_produce<5?"warning":"success",h=p=>p.can_produce===0?"Out of Stock":p.can_produce<5?"Low Stock":"Sufficient";return(p,r)=>(f(),$(Ue,{modelValue:P.value,"onUpdate:modelValue":r[2]||(r[2]=g=>P.value=g),persistent:"","max-width":"800px",scrollable:""},{default:o(()=>[e(J,null,{default:o(()=>[e(le,{class:"d-flex justify-space-between align-center"},{default:o(()=>[r[3]||(r[3]=d("span",{class:"text-h5"},"Production Capacity Analysis",-1)),e(U,{icon:"tabler-x",size:"small",variant:"text",onClick:r[0]||(r[0]=g=>P.value=!1)})]),_:1,__:[3]}),e(X),e(Z,null,{default:o(()=>[p.loading?(f(),D("div",Rt,[e(mt,{indeterminate:"",color:"primary",size:"64"}),r[4]||(r[4]=d("div",{class:"mt-4"},"Calculating production capacity...",-1))])):p.productionCapacity?(f(),D("div",Jt,[e(F,{color:p.productionCapacity.can_produce>0?"success":"error",variant:"tonal",class:"mb-6"},{default:o(()=>[e(H,null,{default:o(()=>{var g;return[v(_(((g=p.selectedProduct)==null?void 0:g.name)||"Product")+" - Production Capacity ",1)]}),_:1}),d("div",Wt,[d("div",Yt,_(I(p.productionCapacity.can_produce))+" units ",1),r[5]||(r[5]=d("div",{class:"text-body-2"}," Maximum production with current inventory ",-1))])]),_:1},8,["color"]),p.productionCapacity.limiting_items.length>0?(f(),D("div",Qt,[e(le,{class:"px-0"},{default:o(()=>r[6]||(r[6]=[v("Limiting Factors")])),_:1,__:[6]}),e(F,{color:"warning",variant:"tonal",class:"mb-4"},{default:o(()=>[e(H,null,{default:o(()=>r[7]||(r[7]=[v("Production Limited By:")])),_:1,__:[7]}),e(kt,{class:"mt-2"},{default:o(()=>[(f(!0),D(oe,null,se(p.productionCapacity.limiting_items,g=>(f(),$(Q,{key:g,color:"warning",size:"small",variant:"tonal"},{default:o(()=>[v(_(g),1)]),_:2},1024))),128))]),_:1})]),_:1})])):L("",!0),e(le,{class:"px-0 mb-4"},{default:o(()=>r[8]||(r[8]=[v("Item Requirements Analysis")])),_:1,__:[8]}),e(ht,{headers:A,items:p.productionCapacity.details,"items-per-page":10,class:"elevation-1"},{"item.item_name":o(({item:g})=>[d("div",Xt,[e(B,{icon:S(g),color:x(g),size:"20"},null,8,["icon","color"]),d("div",null,[d("div",Zt,_(g.item_name),1),d("div",Gt," ID: "+_(g.item_id),1)])])]),"item.available_stock":o(({item:g})=>[d("div",ea,[d("div",ta,_(I(g.available_stock)),1),r[9]||(r[9]=d("div",{class:"text-caption text-medium-emphasis"},"Available",-1))])]),"item.needed_per_product":o(({item:g})=>[d("div",aa,[d("div",oa,_(I(g.needed_per_product)),1),r[10]||(r[10]=d("div",{class:"text-caption text-medium-emphasis"},"Per unit",-1))])]),"item.can_produce":o(({item:g})=>[d("div",sa,[e(Q,{color:g.can_produce>=p.productionCapacity.can_produce?"success":"error",size:"small",variant:"tonal"},{default:o(()=>[v(_(I(g.can_produce)),1)]),_:2},1032,["color"])])]),"item.status":o(({item:g})=>[e(Q,{color:x(g),size:"small",variant:"tonal"},{default:o(()=>[v(_(h(g)),1)]),_:2},1032,["color"])]),_:1},8,["items"]),d("div",la,[e(le,{class:"px-0"},{default:o(()=>r[11]||(r[11]=[v("Recommendations")])),_:1,__:[11]}),p.productionCapacity.can_produce===0?(f(),D("div",ia,[e(F,{color:"error",variant:"tonal"},{default:o(()=>[e(H,null,{default:o(()=>r[12]||(r[12]=[v("Cannot Produce")])),_:1,__:[12]}),r[13]||(r[13]=d("div",null,"One or more critical items are out of stock. Please restock the limiting items listed above.",-1))]),_:1,__:[13]})])):p.productionCapacity.can_produce<10?(f(),D("div",na,[e(F,{color:"warning",variant:"tonal"},{default:o(()=>[e(H,null,{default:o(()=>r[14]||(r[14]=[v("Low Production Capacity")])),_:1,__:[14]}),r[15]||(r[15]=d("div",null,"Consider restocking items to increase production capacity.",-1))]),_:1,__:[15]})])):(f(),D("div",ra,[e(F,{color:"success",variant:"tonal"},{default:o(()=>[e(H,null,{default:o(()=>r[16]||(r[16]=[v("Good Production Capacity")])),_:1,__:[16]}),r[17]||(r[17]=d("div",null,"Sufficient inventory for production. Consider planning production batches.",-1))]),_:1,__:[17]})]))])])):(f(),D("div",da,[e(F,{color:"info",variant:"tonal"},{default:o(()=>[e(H,null,{default:o(()=>r[18]||(r[18]=[v("No Data Available")])),_:1,__:[18]}),r[19]||(r[19]=d("div",null,"Unable to calculate production capacity. Please ensure the product has items configured.",-1))]),_:1,__:[19]})]))]),_:1}),e(X),e(be,{class:"pa-4"},{default:o(()=>[e(Ce),e(U,{color:"primary",variant:"outlined",onClick:r[1]||(r[1]=g=>P.value=!1)},{default:o(()=>r[20]||(r[20]=[v(" Close ")])),_:1,__:[20]})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ie={async getAll(t={}){var l;try{return(await Y.get("/api/product-items",{params:t})).data}catch(i){throw console.error("ProductItemsApi.getAll error:",i),((l=i.response)==null?void 0:l.data)||i}},async getById(t){var l;try{return(await Y.get(`/api/product-items/${t}`)).data}catch(i){throw console.error("ProductItemsApi.getById error:",i),((l=i.response)==null?void 0:l.data)||i}},async create(t){var l;try{return(await Y.post("/api/product-items",t)).data}catch(i){throw console.error("ProductItemsApi.create error:",i),((l=i.response)==null?void 0:l.data)||i}},async update(t,l){var i;try{return(await Y.put(`/api/product-items/${t}`,l)).data}catch(k){throw console.error("ProductItemsApi.update error:",k),((i=k.response)==null?void 0:i.data)||k}},async delete(t){var l;try{return(await Y.delete(`/api/product-items/${t}`)).data}catch(i){throw console.error("ProductItemsApi.delete error:",i),((l=i.response)==null?void 0:l.data)||i}},async getProductionCapacity(t){var l;try{return(await Y.get(`/api/product-items/production-capacity/${t}`)).data}catch(i){throw console.error("ProductItemsApi.getProductionCapacity error:",i),((l=i.response)==null?void 0:l.data)||i}}},ve=C([]),R=C([]),E=C([]),ne=C(!1),_e=C(!1),ye=C(!1),pe=C(!1),he=C(!1),we=C(!1),re=C(!1),N=C(null),Pe=C(null),De=C(null),G=C(1),ke=C(0),Ve=C(15),Me=Fe({product_id:void 0,item_id:void 0,critical_only:!1}),M=C(""),xe=C(""),K=C(""),O=Fe({product_id:0,item_id:0,quantity_needed:0,unit:"",is_critical:!1,notes:""}),ca=z(()=>!0),ma=z(()=>[{title:"Pilih Produk",value:0},...R.value.map(t=>({title:t.name,value:t.id_product||t.id}))]),pa=z(()=>[{title:"Pilih Item",value:0},...E.value.map(t=>({title:`${t.name} (${t.unit})`,value:t.id_item||t.id}))]),ee=async()=>{ne.value=!0,M.value="";try{const t={page:G.value,per_page:Ve.value,...Me};Object.keys(t).forEach(i=>{const P=t[i];(P===void 0||P===0||typeof P=="string"&&P==="")&&delete t[i]});const l=await ie.getAll(t);l.success&&l.data&&(Array.isArray(l.data)?(ve.value=l.data,ke.value=l.data.length):(ve.value=l.data.data||[],ke.value=l.data.total||0,G.value=l.data.current_page||1))}catch(t){console.error("Error fetching product items:",t),M.value=t.message||"Failed to fetch product items"}finally{ne.value=!1}},ga=async()=>{try{const t=await Pt.getAll({active:!0});console.log("ðŸ” fetchProducts response:",t),t.success&&t.data?R.value=Array.isArray(t.data)?t.data:[]:R.value=[],console.log("ðŸ“¦ Products loaded:",R.value.length)}catch(t){console.error("âŒ Error fetching products:",t),R.value=[]}},fa=async()=>{var t;try{console.log("ðŸ”„ Starting fetchItems..."),console.log("ðŸ” Auth token exists:",!!pt("accessToken").value);const l=await wt.getAll({active:!0});console.log("ðŸ” fetchItems response:",l),console.log("ðŸ” fetchItems response.success:",l.success),console.log("ðŸ” fetchItems response.data:",l.data),console.log("ðŸ” fetchItems response.data.data:",(t=l.data)==null?void 0:t.data),l.success&&l.data&&l.data.data?(E.value=Array.isArray(l.data.data)?l.data.data:[],console.log("âœ… Items set to:",E.value),console.log("âœ… Items count:",E.value.length),console.log("âœ… First item:",E.value[0])):(E.value=[],console.log("âŒ Items set to empty array - response not successful or no data")),console.log("ðŸ“¦ Items loaded:",E.value.length)}catch(l){console.error("âŒ Error fetching items:",l),console.error("âŒ Error details:",JSON.stringify(l,null,2)),E.value=[]}},va=async()=>{if(ya()){_e.value=!0,K.value="";try{let t;re.value&&N.value?t=await ie.update(N.value.id_product_item,O):t=await ie.create(O),t.success?(xe.value=re.value?"Hubungan produk-item berhasil diperbarui!":"Hubungan produk-item berhasil ditambahkan!",Ne(),await ee()):K.value=t.message||"Terjadi kesalahan saat menyimpan"}catch(t){console.error("Error saving product item:",t),K.value=t.message||"Terjadi kesalahan saat menyimpan"}finally{_e.value=!1}}},_a=async()=>{if(N.value){ye.value=!0;try{const t=await ie.delete(N.value.id_product_item);t.success?(xe.value="Hubungan produk-item berhasil dihapus!",qe(),await ee()):M.value=t.message||"Gagal menghapus hubungan produk-item"}catch(t){console.error("Error deleting product item:",t),M.value=t.message||"Terjadi kesalahan saat menghapus"}finally{ye.value=!1}}},Ke=async t=>{ne.value=!0;try{const l=await ie.getProductionCapacity(t);l.success?(De.value=l.data,we.value=!0):M.value=l.message||"Gagal menghitung kapasitas produksi"}catch(l){console.error("Error getting production capacity:",l),M.value=l.message||"Terjadi kesalahan saat menghitung kapasitas produksi"}finally{ne.value=!1}},ya=()=>O.product_id<=0?(K.value="Produk harus dipilih",!1):O.item_id<=0?(K.value="Item harus dipilih",!1):O.quantity_needed<=0?(K.value="Jumlah yang dibutuhkan harus lebih besar dari 0",!1):O.unit.trim()?!0:(K.value="Satuan harus diisi",!1),ka=()=>{re.value=!1,N.value=null,ze(),pe.value=!0},ba=t=>{re.value=!0,N.value=t,Pa(t),pe.value=!0},Ca=t=>{N.value=t,he.value=!0},ha=t=>{console.log("ðŸ” openCapacityDialog called with:",t);let l,i;if(typeof t=="number"){if(l=t,i=R.value.find(k=>(k.id_product||k.id)===l),!i){console.error("âŒ Product not found in products list for ID:",l),M.value="Product tidak ditemukan";return}}else if(t&&typeof t=="object")i=t,l=i.id_product||i.id;else{console.error("âŒ Invalid parameter:",t),M.value="Parameter tidak valid";return}if(console.log("ðŸ†” Product ID:",l),console.log("ðŸ“¦ Product:",i),!l){console.error("âŒ Product ID is undefined"),M.value="Product ID tidak ditemukan";return}Pe.value=i,Ke(l)},Ne=()=>{pe.value=!1,je(),ze()},qe=()=>{he.value=!1,N.value=null},wa=()=>{we.value=!1,Pe.value=null,De.value=null},ze=()=>{Object.assign(O,{product_id:0,item_id:0,quantity_needed:0,unit:"",is_critical:!1,notes:""})},Pa=t=>{Object.assign(O,{product_id:t.product_id,item_id:t.item_id,quantity_needed:t.quantity_needed,unit:t.unit,is_critical:t.is_critical,notes:t.notes||""})},je=()=>{K.value=""},Da=t=>{const l=E.value.find(i=>(i.id_item||i.id)===t);l&&(O.unit=l.unit)},Va=t=>{G.value=t,ee()},xa=t=>{Ve.value=t,G.value=1,ee()},Ia=()=>{G.value=1,ee()},$a=()=>({productItemsList:ve,products:R,items:E,loading:ne,saveLoading:_e,deleteLoading:ye,dialog:pe,deleteDialog:he,capacityDialog:we,editMode:re,selectedProductItem:N,selectedProduct:Pe,productionCapacity:De,currentPage:G,totalItems:ke,itemsPerPage:Ve,filters:Me,errorMessage:M,successMessage:xe,modalErrorMessage:K,formData:O,canCreateEdit:ca,productOptions:ma,itemOptions:pa,fetchProductItemsList:ee,fetchProducts:ga,fetchItems:fa,saveProductItem:va,deleteProductItem:_a,getProductionCapacity:Ke,openCreateDialog:ka,openEditDialog:ba,openDeleteDialog:Ca,openCapacityDialog:ha,closeDialog:Ne,closeDeleteDialog:qe,closeCapacityDialog:wa,clearModalError:je,onItemChange:Da,onPageChange:Va,onItemsPerPageChange:xa,handleFiltersUpdate:Ia}),Sa={class:"product-item-management"},Ta={class:"d-flex justify-space-between align-center mb-6"},Aa={class:"d-flex gap-3 align-center"},Ea=me({__name:"product-items-management",setup(t){const l=vt(),{productItemsList:i,products:k,items:P,loading:A,saveLoading:I,deleteLoading:S,dialog:x,deleteDialog:h,capacityDialog:p,editMode:r,selectedProductItem:g,selectedProduct:te,productionCapacity:ae,currentPage:n,totalItems:m,itemsPerPage:V,filters:a,errorMessage:s,successMessage:u,modalErrorMessage:b,formData:j,canCreateEdit:W,productOptions:de,itemOptions:Be,fetchProductItemsList:He,fetchProducts:Re,fetchItems:Je,saveProductItem:We,deleteProductItem:Ye,openCreateDialog:Qe,openEditDialog:Xe,openDeleteDialog:Ze,openCapacityDialog:Ge,onItemChange:et,onPageChange:tt,handleFiltersUpdate:ge}=$a(),at=async()=>{await Ye()},ot=q=>{Xe(q)},st=q=>{Ze(q)},lt=q=>{Ge(q)},it=q=>{console.log("ðŸƒâ€â™‚ï¸ Navigating to HPP management for product:",q.name),l.push("/hpp-management")};return gt(async()=>{await Promise.all([Re(),Je()]),await He()}),(q,y)=>{var Ie,$e,Se,Te;return f(),D("div",Sa,[d("div",Ta,[y[12]||(y[12]=d("div",null,[d("h1",{class:"text-h4 font-weight-bold coffee-title"}," Komposisi Produk "),d("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"}," Kelola hubungan antara produk dan item yang dibutuhkan untuk produksi ")],-1)),d("div",Aa,[c(W)?(f(),$(U,{key:0,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:c(Qe)},{default:o(()=>y[11]||(y[11]=[v(" Tambah Komposisi ")])),_:1,__:[11]},8,["onClick"])):L("",!0)])]),c(s)?(f(),$(F,{key:0,type:"error",variant:"outlined",class:"mb-4",text:c(s),closable:"","onClick:close":y[0]||(y[0]=w=>s.value="")},null,8,["text"])):L("",!0),c(u)?(f(),$(F,{key:1,type:"success",variant:"outlined",class:"mb-4",text:c(u),closable:"","onClick:close":y[1]||(y[1]=w=>u.value="")},null,8,["text"])):L("",!0),e(J,{class:"mb-6",elevation:"0",variant:"outlined"},{default:o(()=>[e(Z,null,{default:o(()=>[e(ue,null,{default:o(()=>[e(T,{cols:"12",md:"4"},{default:o(()=>[e(ce,{modelValue:c(a).product_id,"onUpdate:modelValue":[y[2]||(y[2]=w=>c(a).product_id=w),c(ge)],items:c(de),label:"Filter Produk",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),e(T,{cols:"12",md:"4"},{default:o(()=>[e(ce,{modelValue:c(a).item_id,"onUpdate:modelValue":[y[3]||(y[3]=w=>c(a).item_id=w),c(ge)],items:c(Be),label:"Filter Item",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),e(T,{cols:"12",md:"4",class:"d-flex align-center"},{default:o(()=>[e(Le,{modelValue:c(a).critical_only,"onUpdate:modelValue":[y[4]||(y[4]=w=>c(a).critical_only=w),c(ge)],label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(J,{elevation:"0",variant:"outlined"},{default:o(()=>[e(Z,{class:"pa-0"},{default:o(()=>[e(Ht,{"product-items":c(i),loading:c(A),"current-page":c(n),"items-per-page":c(V),"total-items":c(m),products:c(k),items:c(P),onEdit:ot,onDelete:st,onCheckCapacity:lt,onViewHpp:it,"onUpdate:page":c(tt)},null,8,["product-items","loading","current-page","items-per-page","total-items","products","items","onUpdate:page"])]),_:1})]),_:1}),e(It,{dialog:c(x),"edit-mode":c(r),loading:c(I),"form-data":c(j),products:c(k),items:c(P),"error-message":c(b),onSave:c(We),"onUpdate:dialog":y[5]||(y[5]=w=>x.value=w),"onUpdate:errorMessage":y[6]||(y[6]=w=>b.value=w),"onUpdate:formData":y[7]||(y[7]=w=>Object.assign(c(j),w)),onItemChange:c(et)},null,8,["dialog","edit-mode","loading","form-data","products","items","error-message","onSave","onItemChange"]),e(nt,{modelValue:c(h),"onUpdate:modelValue":y[8]||(y[8]=w=>ft(h)?h.value=w:null),loading:c(S),"item-name":`${($e=(Ie=c(g))==null?void 0:Ie.product)==null?void 0:$e.name} - ${(Te=(Se=c(g))==null?void 0:Se.item)==null?void 0:Te.name}`||"","item-type":"komposisi",onConfirm:at,onCancel:y[9]||(y[9]=w=>h.value=!1)},null,8,["modelValue","loading","item-name"]),e(ua,{dialog:c(p),"selected-product":c(te),"production-capacity":c(ae),loading:c(A),"onUpdate:dialog":y[10]||(y[10]=w=>p.value=w)},null,8,["dialog","selected-product","production-capacity","loading"])])}}}),co=Oe(Ea,[["__scopeId","data-v-e5b16884"]]);export{co as default};
