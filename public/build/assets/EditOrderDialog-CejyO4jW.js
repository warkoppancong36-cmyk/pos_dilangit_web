import{au as h,d as te,r as v,V as j,D as ae,w as R,g as M,f as o,o as f,b as t,c as C,l as z,e as d,X as le,t as y,a1 as g,a0 as oe,s as w,F as se,i as re,at as L,_ as ue}from"./main-Ck8C79PT.js";import{P as Z}from"./PosApi-CLskjq1O.js";import{V as ne}from"./VDialog-BSUdv00L.js";import{V as U,b as de,c as ie}from"./VCard-DmMufESZ.js";import{V as D}from"./VCardText-BNTi3UNn.js";import{V as me}from"./VForm-GCePGqu-.js";import{V as B,a as n}from"./VRow-RYZ_APj3.js";import{V as T}from"./VSelect-D5yoLOVO.js";import{V as _}from"./VTextField-DIzZ6UMa.js";import{V as ce}from"./VTextarea-GAd0e_B8.js";import{V as pe}from"./VDivider-SDZJsEUw.js";import{V as ve}from"./VSpacer-C8nWjSks.js";import"./VOverlay-DN5CqJQx.js";import"./forwardRefs-B931MWyl.js";import"./VImg-D_-r9UKr.js";import"./VAvatar-BrKXcFqe.js";/* empty css              */import"./VList--ImGxPeg.js";import"./VMenu-Cn31-nAO.js";import"./VCheckboxBtn-D5ufpB3T.js";import"./VChip-CN8v6baz.js";const H="/api/customers";class fe{static async getCustomers(c){var r;try{return(await h.get(`${H}`,{params:c})).data}catch(m){throw((r=m.response)==null?void 0:r.data)||this.handleError(m)}}static async getCustomer(c){var r;try{return(await h.get(`${H}/${c}`)).data}catch(m){throw((r=m.response)==null?void 0:r.data)||this.handleError(m)}}static handleError(c){var r,m;return c.response?{success:!1,message:((r=c.response.data)==null?void 0:r.message)||"Server error occurred",errors:(m=c.response.data)==null?void 0:m.errors}:c.request?{success:!1,message:"Network error occurred"}:{success:!1,message:c.message||"An unexpected error occurred"}}}const _e={class:"d-flex align-items-center gap-2"},Ve={class:"coffee-subtitle"},be={key:0,class:"space-y-4"},ye={class:"d-flex justify-space-between mb-2"},ge={class:"font-weight-medium"},we={key:0,class:"d-flex justify-space-between mb-2"},ke={class:"font-weight-medium text-error"},xe={class:"d-flex justify-space-between"},Ce={class:"font-weight-bold text-h6"},Ue={key:0,class:"px-6 pb-2"},De=te({__name:"EditOrderDialog",props:{modelValue:{type:Boolean},order:{}},emits:["update:modelValue","order-updated"],setup(N,{emit:c}){const r=N,m=c,S=v(),I=v(!1),P=v(!1),p=v(""),A=v([]),q=v([]),s=v({order_type:"",table_number:"",guest_count:1,id_customer:null,notes:"",discount_type:"",discount_value:0,items:[]}),J=[{title:"Makan di Tempat",value:"dine_in"},{title:"Bawa Pulang",value:"takeaway"},{title:"Antar",value:"delivery"}],Q=[{title:"Persentase",value:"percentage"},{title:"Nominal",value:"fixed"}],V={required:l=>!!l||"Field ini wajib diisi",minOne:l=>l>=1||"Minimal 1",minZero:l=>l>=0||"Minimal 0"},b=j({get:()=>r.modelValue,set:l=>m("update:modelValue",l)}),k=j(()=>{const l=s.value.items.reduce((a,u)=>a+u.quantity*u.unit_price,0);let e=0;return s.value.discount_type&&s.value.discount_value>0&&(s.value.discount_type==="percentage"?e=l*s.value.discount_value/100:e=s.value.discount_value),{subtotal:l,discount:e,total:l-e}}),X=async()=>{try{const l=await fe.getCustomers();l.success&&(A.value=l.data)}catch(l){console.error("Error loading customers:",l)}},G=async()=>{try{const l=await Z.getProducts();l.success&&(q.value=l.data)}catch(l){console.error("Error loading products:",l)}},F=()=>{if(r.order){const l=r.order.orderItems||r.order.order_items||[];s.value={order_type:r.order.order_type||"",table_number:r.order.table_number||"",guest_count:r.order.guest_count||1,id_customer:r.order.id_customer||null,notes:r.order.notes||"",discount_type:r.order.discount_type||"",discount_value:r.order.discount_amount||0,items:l.map(e=>({id_product:e.id_product,quantity:e.quantity,unit_price:e.unit_price,notes:e.notes||""}))}}},K=()=>{s.value.items.push({id_product:null,quantity:1,unit_price:0,notes:""})},W=l=>{s.value.items.splice(l,1)},Y=l=>{const e=s.value.items[l],a=q.value.find(u=>u.id_product===e.id_product);a&&e.unit_price===0&&(e.unit_price=a.price||0)},O=l=>{},$=async()=>{var l,e,a;if((l=S.value)!=null&&l.validate())try{P.value=!0,p.value="";const u={order_type:s.value.order_type,table_number:s.value.table_number,guest_count:s.value.guest_count,id_customer:s.value.id_customer,notes:s.value.notes,discount_type:s.value.discount_type,discount_value:s.value.discount_value,items:s.value.items.filter(ee=>ee.id_product)},i=await Z.editOrder(r.order.id_order,u);i.success&&(m("order-updated",i.data),E())}catch(u){console.error("Error updating order:",u),u.message?p.value=u.message:(a=(e=u.response)==null?void 0:e.data)!=null&&a.message?p.value=u.response.data.message:p.value="Terjadi kesalahan saat memperbarui pesanan"}finally{P.value=!1}},E=()=>{p.value="",b.value=!1},x=l=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(l||0);return ae(()=>{X(),G()}),R(b,l=>{l&&r.order&&F()}),R(()=>r.order,l=>{l&&b.value&&F()}),(l,e)=>(f(),M(ne,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=a=>b.value=a),"max-width":"900",scrollable:"",persistent:""},{default:o(()=>[t(U,{class:"coffee-dialog"},{default:o(()=>[t(de,{class:"d-flex align-center justify-space-between coffee-header"},{default:o(()=>{var a;return[d("div",_e,[t(le,{icon:"tabler-edit",class:"text-white"}),d("div",null,[e[10]||(e[10]=d("div",{class:"coffee-title"},"Edit Transaksi",-1)),d("div",Ve,y((a=l.order)==null?void 0:a.order_number),1)])]),t(g,{icon:"tabler-x",variant:"text",color:"white",onClick:E})]}),_:1}),t(D,{class:"pa-6"},{default:o(()=>[t(me,{ref_key:"formRef",ref:S,modelValue:I.value,"onUpdate:modelValue":e[7]||(e[7]=a=>I.value=a),onSubmit:oe($,["prevent"])},{default:o(()=>[t(B,null,{default:o(()=>[t(n,{cols:"12"},{default:o(()=>e[11]||(e[11]=[d("h4",{class:"text-h6 mb-4"},"Informasi Pesanan",-1)])),_:1,__:[11]}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(T,{modelValue:s.value.order_type,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.order_type=a),label:"Tipe Pesanan",items:J,variant:"outlined",rules:[V.required]},null,8,["modelValue","rules"])]),_:1}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(_,{modelValue:s.value.table_number,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.table_number=a),label:"Nomor Meja",variant:"outlined",clearable:""},null,8,["modelValue"])]),_:1}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(_,{modelValue:s.value.guest_count,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.guest_count=a),modelModifiers:{number:!0},label:"Jumlah Tamu",type:"number",variant:"outlined",min:"1"},null,8,["modelValue"])]),_:1}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(T,{modelValue:s.value.id_customer,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.id_customer=a),label:"Pelanggan",items:A.value,"item-title":"name","item-value":"id_customer",variant:"outlined",clearable:"","prepend-inner-icon":"tabler-user"},null,8,["modelValue","items"])]),_:1}),t(n,{cols:"12"},{default:o(()=>e[12]||(e[12]=[d("h4",{class:"text-h6 mb-4 mt-4"},"Item Pesanan",-1)])),_:1,__:[12]}),t(n,{cols:"12"},{default:o(()=>[t(U,{variant:"outlined"},{default:o(()=>[t(D,null,{default:o(()=>[t(g,{color:"primary",variant:"outlined","prepend-icon":"tabler-plus",class:"mb-4",onClick:K},{default:o(()=>e[13]||(e[13]=[w(" Tambah Item ")])),_:1,__:[13]}),s.value.items.length>0?(f(),C("div",be,[(f(!0),C(se,null,re(s.value.items,(a,u)=>(f(),M(U,{key:u,variant:"outlined",class:"mb-3"},{default:o(()=>[t(D,null,{default:o(()=>[t(B,{align:"center"},{default:o(()=>[t(n,{cols:"12",md:"4"},{default:o(()=>[t(T,{modelValue:a.id_product,"onUpdate:modelValue":[i=>a.id_product=i,i=>Y(u)],label:"Produk",items:q.value,"item-title":"name","item-value":"id_product",variant:"outlined",density:"compact",rules:[V.required]},null,8,["modelValue","onUpdate:modelValue","items","rules"])]),_:2},1024),t(n,{cols:"12",md:"2"},{default:o(()=>[t(_,{modelValue:a.quantity,"onUpdate:modelValue":[i=>a.quantity=i,i=>O(u)],modelModifiers:{number:!0},label:"Qty",type:"number",variant:"outlined",density:"compact",min:"1",rules:[V.required,V.minOne]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(n,{cols:"12",md:"2"},{default:o(()=>[t(_,{modelValue:a.unit_price,"onUpdate:modelValue":[i=>a.unit_price=i,i=>O(u)],modelModifiers:{number:!0},label:"Harga",type:"number",variant:"outlined",density:"compact",min:"0",rules:[V.required,V.minZero]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(n,{cols:"12",md:"2"},{default:o(()=>[t(_,{"model-value":x(a.quantity*a.unit_price),label:"Total",variant:"outlined",density:"compact",readonly:""},null,8,["model-value"])]),_:2},1024),t(n,{cols:"12",md:"2"},{default:o(()=>[t(g,{icon:"tabler-trash",variant:"text",color:"error",size:"small",onClick:i=>W(u)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),t(B,null,{default:o(()=>[t(n,{cols:"12"},{default:o(()=>[t(_,{modelValue:a.notes,"onUpdate:modelValue":i=>a.notes=i,label:"Catatan Item",variant:"outlined",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])):(f(),M(L,{key:1,type:"info",variant:"tonal",class:"mb-0"},{default:o(()=>e[14]||(e[14]=[w(" Belum ada item dalam pesanan ")])),_:1,__:[14]}))]),_:1})]),_:1})]),_:1}),t(n,{cols:"12"},{default:o(()=>e[15]||(e[15]=[d("h4",{class:"text-h6 mb-4 mt-4"},"Diskon",-1)])),_:1,__:[15]}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(T,{modelValue:s.value.discount_type,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.discount_type=a),label:"Tipe Diskon",items:Q,variant:"outlined",clearable:""},null,8,["modelValue"])]),_:1}),t(n,{cols:"12",md:"6"},{default:o(()=>[t(_,{modelValue:s.value.discount_value,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.discount_value=a),modelModifiers:{number:!0},label:"Nilai Diskon",type:"number",variant:"outlined",min:"0",suffix:s.value.discount_type==="percentage"?"%":"Rp"},null,8,["modelValue","suffix"])]),_:1}),t(n,{cols:"12"},{default:o(()=>[t(ce,{modelValue:s.value.notes,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.notes=a),label:"Catatan Pesanan",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1}),t(n,{cols:"12"},{default:o(()=>[t(U,{variant:"tonal",color:"primary"},{default:o(()=>[t(D,null,{default:o(()=>[e[19]||(e[19]=d("h4",{class:"text-h6 mb-3"},"Ringkasan Pesanan",-1)),d("div",ye,[e[16]||(e[16]=d("span",null,"Subtotal:",-1)),d("span",ge,y(x(k.value.subtotal)),1)]),k.value.discount>0?(f(),C("div",we,[e[17]||(e[17]=d("span",null,"Diskon:",-1)),d("span",ke,"-"+y(x(k.value.discount)),1)])):z("",!0),t(pe,{class:"my-2"}),d("div",xe,[e[18]||(e[18]=d("span",{class:"font-weight-bold"},"Total:",-1)),d("span",Ce,y(x(k.value.total)),1)])]),_:1,__:[19]})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),p.value?(f(),C("div",Ue,[t(L,{type:"error",variant:"tonal",closable:"","onClick:close":e[8]||(e[8]=a=>p.value="")},{default:o(()=>[w(y(p.value),1)]),_:1})])):z("",!0),t(ie,{class:"pa-6 pt-0"},{default:o(()=>[t(ve),t(g,{variant:"outlined",onClick:E},{default:o(()=>e[20]||(e[20]=[w(" Batal ")])),_:1,__:[20]}),t(g,{color:"primary",loading:P.value,disabled:!I.value||s.value.items.length===0,onClick:$},{default:o(()=>e[21]||(e[21]=[w(" Simpan Perubahan ")])),_:1,__:[21]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Qe=ue(De,[["__scopeId","data-v-6833e049"]]);export{Qe as default};
