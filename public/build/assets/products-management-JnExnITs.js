import{D as At}from"./DeleteConfirmationDialog-CuE2qJLd.js";import{f as tt}from"./formatters-BD6tdLx_.js";import{P as vt,u as ta}from"./useProductItems-DW9_xk28.js";import{I as aa}from"./ItemsApi-DNeyVOR5.js";import{H as la,u as oa}from"./HPPBreakdownDialog-C-KhYshO.js";import{V as Oe}from"./VDialog-nEhLnis9.js";import{V as ue,b as Ce,c as Ke}from"./VCard-B0cJyfKw.js";import{cq as Mt,a8 as Qe,a9 as Ze,as as sa,aF as na,af as Et,bT as ia,r as B,V as de,aG as We,w as Pe,W as je,b as e,a0 as R,aa as et,ak as ra,ab as Ht,ac as Bt,H as Ft,ba as ua,L as da,N as Kt,bZ as ca,b_ as ma,b9 as pt,aJ as bt,I as va,ag as Rt,aM as gt,bj as fa,bt as $t,p as he,be as wt,cr as pa,c8 as Dt,bh as ga,F as De,X as I,cp as _a,c9 as ka,aI as ya,s as f,cs as ba,a$ as ha,ad as xa,aH as wa,b3 as Va,b5 as Pa,d as Re,D as ut,c as ne,f as t,e as a,t as c,g as N,l as ee,m as X,i as Ge,v as Xe,o as b,aw as qt,ax as ht,$ as Vt,j as Ot,ct as Ca,aA as qe,ap as Ia,aq as Sa,a5 as yt}from"./main-B8xmOoRw.js";import{V as me}from"./VCardText-Ci1pijYx.js";import{V as Se}from"./VAvatar-B-2lmg4J.js";import{V as ve,m as $a,b as Tt}from"./VChip-CemFsuTr.js";import{V as $e,a as H}from"./VRow-0SCQng2M.js";import{V as Pt}from"./VAutocomplete-CHymndRR.js";import{u as Da,e as Ta,t as ot,V as kt,a as Je,b as nt,d as it}from"./VList-BPmVdEmT.js";import{u as Ua,V as Ve,m as za}from"./VTextField-DBSFv7YI.js";import{V as rt}from"./VSwitch-D--vK4iI.js";import{a as _t,V as He}from"./VAlert-B5JNrMh0.js";import{V as Le}from"./VSpacer-B6OY_4sk.js";import{V as at}from"./VSnackbar-CYJPoEUe.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Aa,m as Ma,a as Ea,V as Be}from"./VSelect-Ddtiq0F-.js";import{V as Ha}from"./VCheckbox-D2eq51L8.js";import{V as Ue}from"./VDivider-DFcezMQU.js";import{V as Ba}from"./VContainer-Dx_GWVCo.js";import{a as Lt,u as Fa,P as Ka}from"./useProducts-CFofzs-J.js";import{V as Ct}from"./VForm-acJaO8Nu.js";import{V as Ut}from"./VTextarea--uc0Do1J.js";import{V as Ee}from"./VTooltip-UgTMqQk2.js";import{M as Ra,m as qa,V as Oa}from"./VImg-BFtDGTsy.js";import{V as La,u as Na}from"./useCategories-D142GfRT.js";import{u as ja,m as Wa,h as Ga}from"./filter-CYc_Fa0H.js";import{f as Nt,a as Xa,s as Ja}from"./forwardRefs-B931MWyl.js";import{V as Ya}from"./VMenu-CI0rcxVt.js";import{V as Qa}from"./VCheckboxBtn-CKfJLfdr.js";import{V as Za}from"./VDataTableServer-CvpF1ZDl.js";import{V as el}from"./VSkeletonLoader-Dz1Rz32S.js";import{V as tl}from"./VDataTable-HEzfURbQ.js";import{c as al,d as ll,u as ol}from"./VOverlay-BhapGp56.js";import"./ProductsApi-BVQJ43gb.js";import"./api-BGJL3_ex.js";import"./index-D-EbNoF1.js";/* empty css              */import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-CkSdlWal.js";import"./VTable-CJ0Mw9rm.js";const sl=l=>{const{touchstartX:K,touchendX:y,touchstartY:d,touchendY:U}=l,p=.5,P=16;l.offsetX=y-K,l.offsetY=U-d,Math.abs(l.offsetY)<p*Math.abs(l.offsetX)&&(l.left&&y<K-P&&l.left(l),l.right&&y>K+P&&l.right(l)),Math.abs(l.offsetX)<p*Math.abs(l.offsetY)&&(l.up&&U<d-P&&l.up(l),l.down&&U>d+P&&l.down(l))};function nl(l,K){var d;const y=l.changedTouches[0];K.touchstartX=y.clientX,K.touchstartY=y.clientY,(d=K.start)==null||d.call(K,{originalEvent:l,...K})}function il(l,K){var d;const y=l.changedTouches[0];K.touchendX=y.clientX,K.touchendY=y.clientY,(d=K.end)==null||d.call(K,{originalEvent:l,...K}),sl(K)}function rl(l,K){var d;const y=l.changedTouches[0];K.touchmoveX=y.clientX,K.touchmoveY=y.clientY,(d=K.move)==null||d.call(K,{originalEvent:l,...K})}function ul(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const K={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:l.left,right:l.right,up:l.up,down:l.down,start:l.start,move:l.move,end:l.end};return{touchstart:y=>nl(y,K),touchend:y=>il(y,K),touchmove:y=>rl(y,K)}}function dl(l,K){var m;const y=K.value,d=y!=null&&y.parent?l.parentElement:l,U=(y==null?void 0:y.options)??{passive:!0},p=(m=K.instance)==null?void 0:m.$.uid;if(!d||!p)return;const P=ul(K.value);d._touchHandlers=d._touchHandlers??Object.create(null),d._touchHandlers[p]=P,Mt(P).forEach(r=>{d.addEventListener(r,P[r],U)})}function cl(l,K){var p,P;const y=(p=K.value)!=null&&p.parent?l.parentElement:l,d=(P=K.instance)==null?void 0:P.$.uid;if(!(y!=null&&y._touchHandlers)||!d)return;const U=y._touchHandlers[d];Mt(U).forEach(m=>{y.removeEventListener(m,U[m])}),delete y._touchHandlers[d]}const jt={mounted:dl,unmounted:cl},Wt=Symbol.for("vuetify:v-window"),Gt=Symbol.for("vuetify:v-window-group"),Xt=Ze({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:l=>typeof l=="boolean"||l==="hover"},touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},...Bt(),...Ht(),...ra()},"VWindow"),xt=Qe()({name:"VWindow",directives:{Touch:jt},props:Xt(),emits:{"update:modelValue":l=>!0},setup(l,K){let{slots:y}=K;const{themeClasses:d}=sa(l),{isRtl:U}=na(),{t:p}=Et(),P=ia(l,Gt),m=B(),r=de(()=>U.value?!l.reverse:l.reverse),s=We(!1),W=de(()=>{const g=l.direction==="vertical"?"y":"x",D=(r.value?!s.value:s.value)?"-reverse":"";return`v-window-${g}${D}-transition`}),_=We(0),j=B(void 0),le=de(()=>P.items.value.findIndex(g=>P.selected.value.includes(g.id)));Pe(le,(g,k)=>{const D=P.items.value.length,G=D-1;D<=2?s.value=g<k:g===G&&k===0?s.value=!0:g===0&&k===G?s.value=!1:s.value=g<k}),da(Wt,{transition:W,isReversed:s,transitionCount:_,transitionHeight:j,rootRef:m});const T=je(()=>l.continuous||le.value!==0),C=je(()=>l.continuous||le.value!==P.items.value.length-1);function ie(){T.value&&P.prev()}function pe(){C.value&&P.next()}const O=de(()=>{const g=[],k={icon:U.value?l.nextIcon:l.prevIcon,class:`v-window__${r.value?"right":"left"}`,onClick:P.prev,"aria-label":p("$vuetify.carousel.prev")};g.push(T.value?y.prev?y.prev({props:k}):e(R,k,null):e("div",null,null));const D={icon:U.value?l.prevIcon:l.nextIcon,class:`v-window__${r.value?"left":"right"}`,onClick:P.next,"aria-label":p("$vuetify.carousel.next")};return g.push(C.value?y.next?y.next({props:D}):e(R,D,null):e("div",null,null)),g}),Y=de(()=>l.touch===!1?l.touch:{...{left:()=>{r.value?ie():pe()},right:()=>{r.value?pe():ie()},start:k=>{let{originalEvent:D}=k;D.stopPropagation()}},...l.touch===!0?{}:l.touch});return et(()=>Ft(e(l.tag,{ref:m,class:["v-window",{"v-window--show-arrows-on-hover":l.showArrows==="hover"},d.value,l.class],style:l.style},{default:()=>{var g,k;return[e("div",{class:"v-window__container",style:{height:j.value}},[(g=y.default)==null?void 0:g.call(y,{group:P}),l.showArrows!==!1&&e("div",{class:"v-window__controls"},[O.value])]),(k=y.additional)==null?void 0:k.call(y,{group:P})]}}),[[ua("touch"),Y.value]])),{group:P}}}),Jt=Ze({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...Bt(),...ma(),...ll()},"VWindowItem"),st=Qe()({name:"VWindowItem",directives:{Touch:jt},props:Jt(),emits:{"group:selected":l=>!0},setup(l,K){let{slots:y}=K;const d=Kt(Wt),U=ca(l,Gt),{isBooted:p}=Da();if(!d||!U)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const P=We(!1),m=de(()=>p.value&&(d.isReversed.value?l.reverseTransition!==!1:l.transition!==!1));function r(){!P.value||!d||(P.value=!1,d.transitionCount.value>0&&(d.transitionCount.value-=1,d.transitionCount.value===0&&(d.transitionHeight.value=void 0)))}function s(){var T;P.value||!d||(P.value=!0,d.transitionCount.value===0&&(d.transitionHeight.value=bt((T=d.rootRef.value)==null?void 0:T.clientHeight)),d.transitionCount.value+=1)}function W(){r()}function _(T){P.value&&pt(()=>{!m.value||!P.value||!d||(d.transitionHeight.value=bt(T.clientHeight))})}const j=de(()=>{const T=d.isReversed.value?l.reverseTransition:l.transition;return m.value?{name:typeof T!="string"?d.transition.value:T,onBeforeEnter:s,onAfterEnter:r,onEnterCancelled:W,onBeforeLeave:s,onAfterLeave:r,onLeaveCancelled:W,onEnter:_}:!1}),{hasContent:le}=al(l,U.isSelected);return et(()=>e(Ra,{transition:j.value,disabled:!p.value},{default:()=>{var T;return[Ft(e("div",{class:["v-window-item",U.selectedClass.value,l.class],style:l.style},[le.value&&((T=y.default)==null?void 0:T.call(y))]),[[va,U.isSelected.value]])]}})),{groupItem:U}}}),ml=Ze({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Wa({filterKeys:["title"]}),...Ma({hideNoData:!0,returnObject:!0}),...wt(za({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...qa({transition:!1})},"VCombobox"),vl=Qe()({name:"VCombobox",props:ml(),emits:{"update:focused":l=>!0,"update:modelValue":l=>!0,"update:search":l=>!0,"update:menu":l=>!0},setup(l,K){var E;let{emit:y,slots:d}=K;const{t:U}=Et(),p=B(),P=We(!1),m=We(!0),r=We(!1),s=B(),W=B(),_=We(-1);let j=!1;const{items:le,transformIn:T,transformOut:C}=Ta(l),{textColorClasses:ie,textColorStyles:pe}=Rt(()=>{var o;return(o=p.value)==null?void 0:o.color}),O=gt(l,"modelValue",[],o=>T(fa(o)),o=>{const S=C(o);return l.multiple?S:S[0]??null}),Y=Ua(l),g=de(()=>!!(l.chips||d.chip)),k=de(()=>g.value||!!d.selection),D=We(!l.multiple&&!k.value?((E=O.value[0])==null?void 0:E.title)??"":""),G=de({get:()=>D.value,set:o=>{var S;if(D.value=o??"",!l.multiple&&!k.value&&(O.value=[ot(l,o)]),o&&l.multiple&&((S=l.delimiters)!=null&&S.length)){const q=o.split(new RegExp(`(?:${l.delimiters.join("|")})+`));q.length>1&&(q.forEach(Z=>{Z=Z.trim(),Z&&ge(ot(l,Z))}),D.value="")}o||(_.value=-1),m.value=!o}}),F=de(()=>typeof l.counterValue=="function"?l.counterValue(O.value):typeof l.counterValue=="number"?l.counterValue:l.multiple?O.value.length:G.value.length),{filteredItems:h,getMatches:w}=ja(l,le,()=>m.value?"":G.value),L=de(()=>l.hideSelected?h.value.filter(o=>!O.value.some(S=>S.value===o.value)):h.value),re=de(()=>l.hideNoData&&!L.value.length||Y.isReadonly.value||Y.isDisabled.value),ye=gt(l,"menu"),ce=de({get:()=>ye.value,set:o=>{var S;ye.value&&!o&&((S=s.value)!=null&&S.ΨopenChildren.size)||o&&re.value||(ye.value=o)}}),J=je(()=>ce.value?l.closeText:l.openText);Pe(D,o=>{j?pt(()=>j=!1):P.value&&!ce.value&&(ce.value=!0),y("update:search",o)}),Pe(O,o=>{var S;!l.multiple&&!k.value&&(D.value=((S=o[0])==null?void 0:S.title)??"")});const v=de(()=>O.value.map(o=>o.value)),u=de(()=>{var S;return(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&G.value===((S=L.value[0])==null?void 0:S.title))&&L.value.length>0&&!m.value&&!r.value}),n=B(),i=Aa(n,p);function z(o){j=!0,l.openOnClear&&(ce.value=!0)}function M(){re.value||(ce.value=!0)}function V(o){re.value||(P.value&&(o.preventDefault(),o.stopPropagation()),ce.value=!ce.value)}function x(o){var S;o.key!==" "&&Dt(o)&&((S=p.value)==null||S.focus())}function oe(o){var Z,A,te,se;if(pa(o)||Y.isReadonly.value)return;const S=(Z=p.value)==null?void 0:Z.selectionStart,q=O.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(o.key)&&o.preventDefault(),["Enter","ArrowDown"].includes(o.key)&&(ce.value=!0),["Escape"].includes(o.key)&&(ce.value=!1),["Enter","Escape","Tab"].includes(o.key)&&(u.value&&["Enter","Tab"].includes(o.key)&&!O.value.some($=>{let{value:fe}=$;return fe===L.value[0].value})&&ge(h.value[0]),m.value=!0),o.key==="ArrowDown"&&u.value&&((A=n.value)==null||A.focus("next")),o.key==="Enter"&&G.value&&(ge(ot(l,G.value)),k.value&&(D.value="")),["Backspace","Delete"].includes(o.key)){if(!l.multiple&&k.value&&O.value.length>0&&!G.value)return ge(O.value[0],!1);if(~_.value){o.preventDefault();const $=_.value;ge(O.value[_.value],!1),_.value=$>=q-1?q-2:$}else o.key==="Backspace"&&!G.value&&(_.value=q-1);return}if(l.multiple)if(o.key==="ArrowLeft"){if(_.value<0&&S&&S>0)return;const $=_.value>-1?_.value-1:q-1;O.value[$]?_.value=$:(_.value=-1,(te=p.value)==null||te.setSelectionRange(G.value.length,G.value.length))}else if(o.key==="ArrowRight"){if(_.value<0)return;const $=_.value+1;O.value[$]?_.value=$:(_.value=-1,(se=p.value)==null||se.setSelectionRange(0,0))}else~_.value&&Dt(o)&&(_.value=-1)}function xe(){var o;l.eager&&((o=W.value)==null||o.calculateVisibleItems())}function Ie(){var o;P.value&&(m.value=!0,(o=p.value)==null||o.focus())}function ge(o){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!o||o.props.disabled))if(l.multiple){const q=O.value.findIndex(A=>(l.valueComparator||$t)(A.value,o.value)),Z=S??!~q;if(~q){const A=Z?[...O.value,o]:[...O.value];A.splice(q,1),O.value=A}else Z&&(O.value=[...O.value,o]);l.clearOnSelect&&(G.value="")}else{const q=S!==!1;O.value=q?[o]:[],D.value=q&&!k.value?o.title:"",pt(()=>{ce.value=!1,m.value=!0})}}function Q(o){P.value=!0,setTimeout(()=>{r.value=!0})}function be(o){r.value=!1}function we(o){(o==null||o===""&&!l.multiple&&!k.value)&&(O.value=[])}return Pe(P,(o,S)=>{if(!(o||o===S)&&(_.value=-1,ce.value=!1,G.value)){if(l.multiple){ge(ot(l,G.value));return}if(!k.value)return;O.value.some(q=>{let{title:Z}=q;return Z===G.value})?D.value="":ge(ot(l,G.value))}}),Pe(ce,()=>{if(!l.hideSelected&&ce.value&&O.value.length){const o=L.value.findIndex(S=>O.value.some(q=>(l.valueComparator||$t)(q.value,S.value)));ga&&window.requestAnimationFrame(()=>{var S;o>=0&&((S=W.value)==null||S.scrollToIndex(o))})}}),Pe(()=>l.items,(o,S)=>{ce.value||P.value&&!S.length&&o.length&&(ce.value=!0)}),et(()=>{const o=!!(!l.hideNoData||L.value.length||d["prepend-item"]||d["append-item"]||d["no-data"]),S=O.value.length>0,q=Ve.filterProps(l);return e(Ve,he({ref:p},q,{modelValue:G.value,"onUpdate:modelValue":[Z=>G.value=Z,we],focused:P.value,"onUpdate:focused":Z=>P.value=Z,validationValue:O.externalValue,counterValue:F.value,dirty:S,class:["v-combobox",{"v-combobox--active-menu":ce.value,"v-combobox--chips":!!l.chips,"v-combobox--selection-slot":!!k.value,"v-combobox--selecting-index":_.value>-1,[`v-combobox--${l.multiple?"multiple":"single"}`]:!0},l.class],style:l.style,readonly:Y.isReadonly.value,placeholder:S?void 0:l.placeholder,"onClick:clear":z,"onMousedown:control":M,onKeydown:oe}),{...d,default:()=>e(De,null,[e(Ya,he({ref:s,modelValue:ce.value,"onUpdate:modelValue":Z=>ce.value=Z,activator:"parent",contentClass:"v-combobox__content",disabled:re.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:l.transition,onAfterEnter:xe,onAfterLeave:Ie},l.menuProps),{default:()=>[o&&e(kt,he({ref:n,selected:v.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:Z=>Z.preventDefault(),onKeydown:x,onFocusin:Q,onFocusout:be,tabindex:"-1","aria-live":"polite",color:l.itemColor??l.color},i,l.listProps),{default:()=>{var Z,A,te;return[(Z=d["prepend-item"])==null?void 0:Z.call(d),!L.value.length&&!l.hideNoData&&(((A=d["no-data"])==null?void 0:A.call(d))??e(Je,{key:"no-data",title:U(l.noDataText)},null)),e(Ea,{ref:W,renderless:!0,items:L.value,itemKey:"value"},{default:se=>{var Me;let{item:$,index:fe,itemRef:_e}=se;const ze=he($.props,{ref:_e,key:$.value,active:u.value&&fe===0?!0:void 0,onClick:()=>ge($,null)});return((Me=d.item)==null?void 0:Me.call(d,{item:$,index:fe,props:ze}))??e(Je,he(ze,{role:"option"}),{prepend:Ae=>{let{isSelected:Fe}=Ae;return e(De,null,[l.multiple&&!l.hideSelected?e(Qa,{key:$.value,modelValue:Fe,ripple:!1,tabindex:"-1"},null):void 0,$.props.prependAvatar&&e(Se,{image:$.props.prependAvatar},null),$.props.prependIcon&&e(I,{icon:$.props.prependIcon},null)])},title:()=>{var Ae;return m.value?$.title:Ga("v-combobox",$.title,(Ae=w($))==null?void 0:Ae.title)}})}}),(te=d["append-item"])==null?void 0:te.call(d)]}})]}),O.value.map((Z,A)=>{function te(_e){_e.stopPropagation(),_e.preventDefault(),ge(Z,!1)}const se={"onClick:close":te,onKeydown(_e){_e.key!=="Enter"&&_e.key!==" "||(_e.preventDefault(),_e.stopPropagation(),te(_e))},onMousedown(_e){_e.preventDefault(),_e.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},$=g.value?!!d.chip:!!d.selection,fe=$?ka(g.value?d.chip({item:Z,index:A,props:se}):d.selection({item:Z,index:A})):void 0;if(!($&&!fe))return e("div",{key:Z.value,class:["v-combobox__selection",A===_.value&&["v-combobox__selection--selected",ie.value]],style:A===_.value?pe.value:{}},[g.value?d.chip?e(ya,{key:"chip-defaults",defaults:{VChip:{closable:l.closableChips,size:"small",text:Z.title}}},{default:()=>[fe]}):e(ve,he({key:"chip",closable:l.closableChips,size:"small",text:Z.title,disabled:Z.props.disabled},se),null):fe??e("span",{class:"v-combobox__selection-text"},[Z.title,l.multiple&&A<O.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[f(",")])])])})]),"append-inner":function(){var se,$;for(var Z=arguments.length,A=new Array(Z),te=0;te<Z;te++)A[te]=arguments[te];return e(De,null,[(se=d["append-inner"])==null?void 0:se.call(d,...A),(!l.hideNoData||l.items.length)&&l.menuIcon?e(I,{class:"v-combobox__menu-icon",color:($=p.value)==null?void 0:$.fieldIconColor,icon:l.menuIcon,onMousedown:V,onClick:_a,"aria-label":U(J.value),title:U(J.value),tabindex:"-1"},null):void 0])}})}),Nt({isFocused:P,isPristine:m,menu:ce,search:G,selectionIndex:_,filteredItems:h,select:ge},p)}}),It=Symbol.for("vuetify:v-tabs"),fl=Ze({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...wt(ba({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),ft=Qe()({name:"VTab",props:fl(),setup(l,K){let{slots:y,attrs:d}=K;const{textColorClasses:U,textColorStyles:p}=Rt(()=>l.sliderColor),P=B(),m=B(),r=de(()=>l.direction==="horizontal"),s=de(()=>{var _,j;return((j=(_=P.value)==null?void 0:_.group)==null?void 0:j.isSelected.value)??!1});function W(_){var le,T;let{value:j}=_;if(j){const C=(T=(le=P.value)==null?void 0:le.$el.parentElement)==null?void 0:T.querySelector(".v-tab--selected .v-tab__slider"),ie=m.value;if(!C||!ie)return;const pe=getComputedStyle(C).color,O=C.getBoundingClientRect(),Y=ie.getBoundingClientRect(),g=r.value?"x":"y",k=r.value?"X":"Y",D=r.value?"right":"bottom",G=r.value?"width":"height",F=O[g],h=Y[g],w=F>h?O[D]-Y[D]:O[g]-Y[g],L=Math.sign(w)>0?r.value?"right":"bottom":Math.sign(w)<0?r.value?"left":"top":"center",ye=(Math.abs(w)+(Math.sign(w)<0?O[G]:Y[G]))/Math.max(O[G],Y[G])||0,ce=O[G]/Y[G]||0,J=1.5;Xa(ie,{backgroundColor:[pe,"currentcolor"],transform:[`translate${k}(${w}px) scale${k}(${ce})`,`translate${k}(${w/J}px) scale${k}(${(ye-1)/J+1})`,"none"],transformOrigin:Array(3).fill(L)},{duration:225,easing:Ja})}}return et(()=>{const _=R.filterProps(l);return e(R,he({symbol:It,ref:P,class:["v-tab",l.class],style:l.style,tabindex:s.value?0:-1,role:"tab","aria-selected":String(s.value),active:!1},_,d,{block:l.fixed,maxWidth:l.fixed?300:void 0,"onGroup:selected":W}),{...y,default:()=>{var j;return e(De,null,[((j=y.default)==null?void 0:j.call(y))??l.text,!l.hideSlider&&e("div",{ref:m,class:["v-tab__slider",U.value],style:p.value},null)])}})}),Nt({},P)}}),pl=Ze({...wt(Xt(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),gl=Qe()({name:"VTabsWindow",props:pl(),emits:{"update:modelValue":l=>!0},setup(l,K){let{slots:y}=K;const d=Kt(It,null),U=gt(l,"modelValue"),p=de({get(){var P;return U.value!=null||!d?U.value:(P=d.items.value.find(m=>d.selected.value.includes(m.id)))==null?void 0:P.value},set(P){U.value=P}});return et(()=>{const P=xt.filterProps(l);return e(xt,he({_as:"VTabsWindow"},P,{modelValue:p.value,"onUpdate:modelValue":m=>p.value=m,class:["v-tabs-window",l.class],style:l.style,mandatory:!1,touch:!1}),y)}),{}}}),_l=Ze({...Jt()},"VTabsWindowItem"),kl=Qe()({name:"VTabsWindowItem",props:_l(),setup(l,K){let{slots:y}=K;return et(()=>{const d=st.filterProps(l);return e(st,he({_as:"VTabsWindowItem"},d,{class:["v-tabs-window-item",l.class],style:l.style}),y)}),{}}});function yl(l){return l?l.map(K=>Pa(K)?K:{text:K,value:K}):[]}const bl=Ze({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...$a({mandatory:"force",selectedClass:"v-tab-item--selected"}),...Va(),...Ht()},"VTabs"),hl=Qe()({name:"VTabs",props:bl(),emits:{"update:modelValue":l=>!0},setup(l,K){let{attrs:y,slots:d}=K;const U=gt(l,"modelValue"),p=de(()=>yl(l.items)),{densityClasses:P}=ha(l),{backgroundColorClasses:m,backgroundColorStyles:r}=xa(()=>l.bgColor),{scopeId:s}=ol();return wa({VTab:{color:je(()=>l.color),direction:je(()=>l.direction),stacked:je(()=>l.stacked),fixed:je(()=>l.fixedTabs),sliderColor:je(()=>l.sliderColor),hideSlider:je(()=>l.hideSlider)}}),et(()=>{const W=Tt.filterProps(l),_=!!(d.window||l.items.length>0);return e(De,null,[e(Tt,he(W,{modelValue:U.value,"onUpdate:modelValue":j=>U.value=j,class:["v-tabs",`v-tabs--${l.direction}`,`v-tabs--align-tabs-${l.alignTabs}`,{"v-tabs--fixed-tabs":l.fixedTabs,"v-tabs--grow":l.grow,"v-tabs--stacked":l.stacked},P.value,m.value,l.class],style:[{"--v-tabs-height":bt(l.height)},r.value,l.style],role:"tablist",symbol:It},s,y),{default:()=>{var j;return[((j=d.default)==null?void 0:j.call(d))??p.value.map(le=>{var T;return((T=d.tab)==null?void 0:T.call(d,{item:le}))??e(ft,he(le,{key:le.text,value:le.value}),{default:d[`tab.${le.value}`]?()=>{var C;return(C=d[`tab.${le.value}`])==null?void 0:C.call(d,{item:le})}:void 0})})]}}),_&&e(gl,he({modelValue:U.value,"onUpdate:modelValue":j=>U.value=j,key:"tabs-window"},s),{default:()=>{var j;return[p.value.map(le=>{var T;return((T=d.item)==null?void 0:T.call(d,{item:le}))??e(kl,{value:le.value},{default:()=>{var C;return(C=d[`item.${le.value}`])==null?void 0:C.call(d,{item:le})}})}),(j=d.window)==null?void 0:j.call(d)]}})])}),{}}}),xl={class:"d-flex align-center gap-3"},wl={class:"text-body-2 ma-0 opacity-90"},Vl={class:"d-flex align-center gap-4"},Pl={class:"flex-grow-1"},Cl={class:"text-h6 font-weight-bold mb-1"},Il={class:"text-body-2 text-medium-emphasis mb-1"},Sl={class:"text-body-2 text-medium-emphasis mb-0"},$l={class:"d-flex align-center justify-space-between w-100"},Dl={class:"d-flex align-center"},Tl={key:0,class:"text-warning"},Ul={key:1},zl={key:0,class:"text-center pa-8"},Al={class:"d-flex align-center gap-4 mt-1"},Ml={key:1,class:"text-primary"},El={class:"d-flex gap-2"},Hl=Re({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup(l,{emit:K}){const y=l,d=K,U=de({get:()=>y.modelValue,set:V=>d("update:modelValue",V)}),p=B(!1),P=B([]),m=B(!1),r=B(!1),s=B(""),W=B(""),_=B(!1),j=B(-1),le=B(!1),T=B({itemId:null,quantity:1,unit:"pcs",isCritical:!1}),C=B([]),ie=B(!1),pe=async()=>{var V;if(y.product)try{const x=y.product.id_product||y.product.id;console.log("🔄 Fetching composition for product ID:",x);const oe=await vt.getAll({product_id:x,page:1,per_page:100});oe.success&&((V=oe.data)!=null&&V.data)&&(console.log("📦 Raw composition items from API:",oe.data.data.slice(0,2)),console.log("📦 Sample composition item structure:",JSON.stringify(oe.data.data[0],null,2)),P.value=oe.data.data)}catch(x){console.error("Error fetching product composition:",x)}},O=async()=>{var V;ie.value=!0;try{const x=await aa.getAll({page:1,per_page:100,active:!0});x.success&&((V=x.data)!=null&&V.data)&&(console.log("📦 Raw available items from API:",x.data.data.slice(0,3)),C.value=x.data.data.map(oe=>{var xe,Ie,ge;return{id:((xe=oe.id_item)==null?void 0:xe.toString())||((Ie=oe.id)==null?void 0:Ie.toString()),name:oe.name,current_stock:((ge=oe.inventory)==null?void 0:ge.current_stock)||0,unit:oe.unit||"pcs"}}),console.log("📦 Processed available items:",C.value.slice(0,3)))}catch(x){console.error("Error fetching available items:",x),C.value=[]}finally{ie.value=!1}},Y=de(()=>T.value.itemId&&T.value.quantity>0&&T.value.unit.trim().length>0),g=de(()=>{if(!T.value.itemId)return null;const V=C.value.find(x=>x.id===T.value.itemId);return(V==null?void 0:V.unit)||null}),k=de(()=>{if(!T.value.itemId)return null;const V=C.value.find(x=>x.id===T.value.itemId);return V?F(V):null}),D=de(()=>k.value!==null&&k.value<=0),G=de(()=>Array.isArray(C.value)?C.value:[]),F=V=>V.current_stock||V.stock||0,h=()=>ie.value?"Memuat items...":!C.value||C.value.length===0?"Tidak ada item tersedia":"Tidak ada item yang ditemukan",w=V=>{const x=F(V);return x>50?"success":x>20?"warning":x>0?"error":"grey"},L=V=>{const x=F(V);return x>50?"Aman":x>20?"Rendah":x>0?"Kritis":"Habis"};Pe(()=>T.value.itemId,V=>{if(V){const x=C.value.find(oe=>oe.id===V);x!=null&&x.unit&&(T.value.unit=x.unit)}}),Pe(()=>y.items,V=>{console.log("📋 Props items changed:",V),V&&V.length>0&&console.log("📋 Sample item structure:",V[0]),P.value=[...V]},{immediate:!0}),Pe(()=>y.modelValue,V=>{V&&y.product&&(console.log("🔄 Dialog opened, fetching composition..."),pe())}),ut(()=>{O()});const re=()=>{le.value=!0},ye=()=>P.value.some(x=>{var oe;return((oe=x.item)==null?void 0:oe.inventory)&&x.item.inventory.current_stock<x.quantity_needed})?"error":"success",ce=()=>P.value.some(x=>{var oe;return((oe=x.item)==null?void 0:oe.inventory)&&x.item.inventory.current_stock<x.quantity_needed})?"Stok Kritis":"Stok Aman",J=()=>{if(!Y.value)return;const V=C.value.find(xe=>xe.id===T.value.itemId);if(!V)return;if(P.value.find(xe=>{var Ie;return((Ie=xe.item)==null?void 0:Ie.id)===V.id})){s.value=`Item "${V.name}" sudah ada dalam komposisi produk ini`,m.value=!0;return}const oe={id_product_item:`temp_${Date.now()}`,item:{id:String(V.id),name:V.name,inventory:{current_stock:V.current_stock||0}},quantity_needed:T.value.quantity,unit:T.value.unit,is_critical:T.value.isCritical};P.value.push(oe),n()},v=(V,x)=>{var Ie;if(console.log("🔍 EditItem called with:",V),console.log("🔍 Item structure:",JSON.stringify(V,null,2)),C.value.length===0){console.warn("⚠️ Available items not loaded yet, fetching..."),O().then(()=>{console.log("✅ Available items loaded, retrying edit"),v(V,x)});return}_.value=!0,j.value=x;let oe=((Ie=V.item)==null?void 0:Ie.id)||null;oe!==null&&(oe=oe.toString()),console.log("🎯 Found itemId (converted to string):",oe),console.log("🔍 Available items for reference:",C.value.map(ge=>({id:ge.id,name:ge.name}))),T.value={itemId:oe,quantity:V.quantity_needed,unit:V.unit,isCritical:V.is_critical},console.log("📝 Form data set for edit:",T.value);const xe=C.value.find(ge=>ge.id===oe);if(xe)console.log("✅ Item found in available items:",xe.name);else{console.warn("⚠️ Item ID not found in available items, trying alternative matching...");const ge=C.value.find(Q=>{var be;return Q.name===((be=V.item)==null?void 0:be.name)});ge?(console.log("✅ Found item by name matching, using ID:",ge.id),T.value.itemId=ge.id):console.error("❌ Could not find item in available items by ID or name")}},u=()=>{if(!Y.value||j.value===-1)return;const V=C.value.find(x=>x.id===T.value.itemId);V&&(P.value[j.value]={...P.value[j.value],item:{id:String(V.id),name:V.name,inventory:{current_stock:V.current_stock||0}},quantity_needed:T.value.quantity,unit:T.value.unit,is_critical:T.value.isCritical},n())},n=()=>{_.value=!1,j.value=-1,T.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},i=V=>{P.value.splice(V,1)},z=async()=>{var V,x,oe,xe,Ie,ge;if(y.product){p.value=!0;try{console.log("💾 Saving composition for product:",y.product.name),console.log("📦 Items to save:",P.value);const Q=parseInt(String(((V=y.product)==null?void 0:V.id_product)||((x=y.product)==null?void 0:x.id)||"0")),be=y.items||[],we=P.value;for(const E of we){const o=be.find(q=>q.id_product_item===E.id_product_item),S={product_id:Q,item_id:parseInt(((oe=E.item)==null?void 0:oe.id)||"0"),quantity_needed:E.quantity_needed,unit:E.unit,is_critical:E.is_critical,notes:E.notes||""};console.log("📤 API Data:",S);try{o&&!((xe=E.id_product_item)!=null&&xe.toString().startsWith("temp_"))?(console.log("✏️ Updating item:",o.id_product_item),await vt.update(parseInt(o.id_product_item||"0"),S)):(console.log("➕ Creating new item"),await vt.create(S))}catch(q){throw console.error("❌ Error processing item:",q),(Ie=q.message)!=null&&Ie.includes("already assigned")?s.value=`Item "${(ge=E.item)==null?void 0:ge.name}" sudah ditambahkan ke produk ini`:s.value=q.message||"Terjadi kesalahan saat menyimpan item",m.value=!0,q}}for(const E of be)if(!we.find(S=>S.id_product_item===E.id_product_item)&&E.id_product_item)try{console.log("🗑️ Deleting item:",E.id_product_item),await vt.delete(parseInt(E.id_product_item))}catch(S){console.error("❌ Error deleting item:",S),s.value=`Gagal menghapus item: ${S.message}`,m.value=!0}console.log("✅ Composition saved successfully!"),W.value="Komposisi produk berhasil disimpan!",r.value=!0,d("save",{product:y.product,items:P.value}),d("refresh"),M()}catch(Q){console.error("❌ Error saving composition:",Q),m.value||(s.value=Q.message||"Terjadi kesalahan saat menyimpan komposisi",m.value=!0)}finally{p.value=!1}}},M=()=>{U.value=!1,setTimeout(()=>{P.value=[...y.items],n()},300)};return(V,x)=>{var oe,xe,Ie,ge;return b(),ne(De,null,[e(Oe,{modelValue:U.value,"onUpdate:modelValue":x[9]||(x[9]=Q=>U.value=Q),"max-width":"900",persistent:""},{default:t(()=>[e(ue,null,{default:t(()=>[e(Ce,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var Q;return[a("div",xl,[e(I,{icon:"mdi-chef-hat",size:"24"}),a("div",null,[x[13]||(x[13]=a("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),a("p",wl,c(((Q=V.product)==null?void 0:Q.name)||"Produk"),1)])]),e(R,{icon:"mdi-close",variant:"text",size:"small",onClick:M})]}),_:1}),e(me,{class:"pa-6"},{default:t(()=>[e(ue,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(me,{class:"pa-4"},{default:t(()=>{var Q,be,we,E,o;return[a("div",Vl,[e(Se,{image:(Q=V.product)==null?void 0:Q.image_url,size:"64"},{default:t(()=>{var S;return[(S=V.product)!=null&&S.image_url?ee("",!0):(b(),N(I,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),a("div",Pl,[a("h4",Cl,c((be=V.product)==null?void 0:be.name),1),a("p",Il," SKU: "+c(((we=V.product)==null?void 0:we.sku)||"SKU-"+((E=V.product)==null?void 0:E.id_product)),1),a("p",Sl," Harga: "+c(X(tt)(((o=V.product)==null?void 0:o.price)||0)),1)]),e(ve,{color:ye(),variant:"tonal"},{default:t(()=>[f(c(ce()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e(ue,{class:"mb-6",elevation:"2"},{default:t(()=>[e(Ce,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[a("div",$l,[a("div",Dl,[e(I,{icon:_.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),f(" "+c(_.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(me,{class:"pa-4"},{default:t(()=>[e($e,null,{default:t(()=>[e(H,{cols:"12",md:"4"},{default:t(()=>[e(Pt,{modelValue:T.value.itemId,"onUpdate:modelValue":x[0]||(x[0]=Q=>T.value.itemId=Q),items:G.value,loading:ie.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item (termasuk yang stok kosong)...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":h()},{item:t(({props:Q,item:be})=>[e(Je,he(Q,{class:{"text-medium-emphasis":F(be.raw)<=0}}),{prepend:t(()=>[e(Se,{size:"32",class:"me-3",color:F(be.raw)<=0?"warning":"primary",variant:"tonal"},{default:t(()=>[e(I,{icon:"mdi-package-variant",color:F(be.raw)<=0?"warning":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[F(be.raw)>0?(b(),N(ve,{key:0,size:"x-small",color:w(be.raw),variant:"tonal"},{default:t(()=>[f(c(L(be.raw)),1)]),_:2},1032,["color"])):(b(),N(ve,{key:1,size:"x-small",color:"warning",variant:"tonal","prepend-icon":"mdi-alert"},{default:t(()=>x[15]||(x[15]=[f(" Kosong ")])),_:1,__:[15]}))]),default:t(()=>[e(nt,null,{default:t(()=>[f(c(be.raw.name),1)]),_:2},1024),e(it,{class:"text-medium-emphasis"},{default:t(()=>[F(be.raw)<=0?(b(),ne("span",Tl,[e(I,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),x[14]||(x[14]=f(" Stok Kosong - Masih bisa digunakan "))])):(b(),ne("span",Ul," Stok: "+c(F(be.raw))+" "+c(be.raw.unit),1))]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(Ve,{modelValue:T.value.quantity,"onUpdate:modelValue":x[1]||(x[1]=Q=>T.value.quantity=Q),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(Ve,{modelValue:T.value.unit,"onUpdate:modelValue":x[2]||(x[2]=Q=>T.value.unit=Q),label:"Satuan",variant:"outlined",placeholder:"kg, pcs, ml",readonly:!!g.value,hint:g.value?`Satuan dari item: ${g.value}`:"","persistent-hint":""},null,8,["modelValue","readonly","hint"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(rt,{modelValue:T.value.isCritical,"onUpdate:modelValue":x[3]||(x[3]=Q=>T.value.isCritical=Q),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(R,{color:_.value?"success":"primary",block:"","prepend-icon":_.value?"mdi-check":"mdi-plus",onClick:x[4]||(x[4]=Q=>_.value?u():J()),disabled:!Y.value},{default:t(()=>[f(c(_.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),_.value?(b(),N(R,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:n},{default:t(()=>x[16]||(x[16]=[f(" Batal ")])),_:1,__:[16]})):ee("",!0)]),_:1})]),_:1}),D.value?(b(),N(He,{key:0,color:"warning",variant:"tonal",class:"mt-4","prepend-icon":"mdi-alert"},{default:t(()=>[e(_t,null,{default:t(()=>x[17]||(x[17]=[f("Item Stok Kosong")])),_:1,__:[17]}),x[18]||(x[18]=a("div",null,"Item yang dipilih sedang kosong stok, namun masih bisa ditambahkan ke komposisi. Pastikan untuk memperbarui stok sebelum produksi.",-1))]),_:1,__:[18]})):ee("",!0)]),_:1})]),_:1}),e(ue,{elevation:"2"},{default:t(()=>[e(Ce,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e(I,{icon:"mdi-format-list-bulleted",class:"me-2"}),f(" Daftar Item Komposisi ("+c(P.value.length)+") ",1)]),_:1}),e(me,{class:"pa-0"},{default:t(()=>[P.value.length===0?(b(),ne("div",zl,[e(I,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),x[19]||(x[19]=a("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),x[20]||(x[20]=a("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(b(),N(kt,{key:1},{default:t(()=>[(b(!0),ne(De,null,Ge(P.value,(Q,be)=>(b(),N(Je,{key:Q.id||be,class:"border-b"},{prepend:t(()=>[e(Se,{size:"40",class:"me-3"},{default:t(()=>{var we,E;return[e(I,{icon:(we=Q.item)!=null&&we.inventory&&Q.item.inventory.current_stock>=Q.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(E=Q.item)!=null&&E.inventory&&Q.item.inventory.current_stock>=Q.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[a("div",El,[e(R,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:we=>v(Q,be)},null,8,["onClick"]),e(R,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:we=>i(be)},null,8,["onClick"])])]),default:t(()=>[e(nt,{class:"font-weight-medium"},{default:t(()=>{var we;return[f(c(((we=Q.item)==null?void 0:we.name)||"Item tidak ditemukan")+" ",1),Q.is_critical?(b(),N(ve,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>x[21]||(x[21]=[f(" Kritis ")])),_:1,__:[21]})):ee("",!0)]}),_:2},1024),e(it,null,{default:t(()=>{var we;return[a("div",Al,[a("span",null,"Dibutuhkan: "+c(Q.quantity_needed)+" "+c(Q.unit),1),(we=Q.item)!=null&&we.inventory?(b(),ne("span",{key:0,class:Xe(Q.item.inventory.current_stock>=Q.quantity_needed?"text-success":"text-error")}," Stok: "+c(Q.item.inventory.current_stock)+" "+c(Q.unit),3)):ee("",!0),Q.formatted_total_cost?(b(),ne("span",Ml,c(Q.formatted_total_cost),1)):ee("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(Ke,{class:"pa-6 pt-0"},{default:t(()=>[e(R,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:re},{default:t(()=>x[22]||(x[22]=[f(" Setting HPP ")])),_:1,__:[22]}),e(Le),e(R,{variant:"outlined",onClick:M},{default:t(()=>x[23]||(x[23]=[f(" Batal ")])),_:1,__:[23]}),e(R,{color:"primary",onClick:z,loading:p.value},{default:t(()=>x[24]||(x[24]=[f(" Simpan Komposisi ")])),_:1,__:[24]},8,["loading"])]),_:1})]),_:1}),e(at,{modelValue:m.value,"onUpdate:modelValue":x[6]||(x[6]=Q=>m.value=Q),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:x[5]||(x[5]=Q=>m.value=!1)},{default:t(()=>x[25]||(x[25]=[f(" Tutup ")])),_:1,__:[25]})]),default:t(()=>[f(c(s.value)+" ",1)]),_:1},8,["modelValue"]),e(at,{modelValue:r.value,"onUpdate:modelValue":x[8]||(x[8]=Q=>r.value=Q),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:x[7]||(x[7]=Q=>r.value=!1)},{default:t(()=>x[26]||(x[26]=[f(" Tutup ")])),_:1,__:[26]})]),default:t(()=>[f(c(W.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(la,{modelValue:le.value,"onUpdate:modelValue":x[10]||(x[10]=Q=>le.value=Q),"product-id":parseInt(String(((oe=V.product)==null?void 0:oe.id_product)||((xe=V.product)==null?void 0:xe.id)||"0")),"product-name":((Ie=V.product)==null?void 0:Ie.product_name)||((ge=V.product)==null?void 0:ge.name),onHppUpdated:x[11]||(x[11]=Q=>d("refresh")),onPriceUpdated:x[12]||(x[12]=Q=>d("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),Yt=Ne(Hl,[["__scopeId","data-v-beb645c6"]]),Bl={class:"composition-cards"},Fl={key:1,class:"text-center pa-12"},Kl={key:2,class:"text-center pa-12"},Rl={class:"d-flex align-center gap-3"},ql={class:"flex-grow-1 min-width-0"},Ol={class:"text-h6 font-weight-bold text-truncate"},Ll={class:"text-caption text-medium-emphasis mb-0"},Nl={class:"d-flex align-center gap-2 mb-3"},jl={class:"text-body-2 font-weight-medium"},Wl={class:"composition-items"},Gl={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},Xl={class:"text-body-2 text-truncate"},Jl={class:"text-end flex-shrink-0"},Yl={class:"text-body-2 font-weight-medium"},Ql={key:0,class:"text-caption text-success"},Zl={key:1,class:"text-caption text-primary"},eo={class:"d-flex justify-between align-center mb-3"},to={class:"text-h6 font-weight-bold text-primary"},ao={class:"d-flex gap-2"},lo={class:"d-flex align-center"},oo={class:"d-flex align-center gap-4"},so={class:"flex-grow-1"},no={class:"text-h5 font-weight-bold mb-2"},io={class:"d-flex align-center gap-4 mb-2"},ro={class:"text-body-2"},uo={class:"text-h6 text-primary font-weight-bold"},co={class:"d-flex align-center mt-1 gap-4"},mo={class:"d-flex align-center"},vo={class:"d-flex align-center"},fo={key:0,class:"d-flex align-center"},po={class:"text-primary font-weight-medium"},go={key:1,class:"text-center py-8"},_o={class:"text-h6 font-weight-bold"},ko={class:"text-h6 font-weight-bold"},yo={class:"text-h6 font-weight-bold"},bo=Re({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup(l,{emit:K}){const y=l,d=K,U=B(!1),p=B(!1),P=B(null),m=B([]),r=B(null),s=B({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),W=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],_=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],j=F=>{P.value=F,m.value=F.items||[],U.value=!0},le=F=>{r.value=F,p.value=!0},T=F=>{console.log("Composition saved:",F),d("refresh")},C=()=>{s.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},ie=de(()=>!!(s.value.search||s.value.stockStatus||s.value.itemType||s.value.criticalOnly||s.value.sortBy!=="name_asc")),pe=de(()=>{let F=0;return s.value.search&&F++,s.value.stockStatus&&F++,s.value.itemType&&F++,s.value.criticalOnly&&F++,s.value.sortBy!=="name_asc"&&F++,F}),O=de(()=>{const F=new Map;y.productItems.forEach(w=>{if(!w.product)return;const L=w.product.id_product||w.product.id;F.has(L)||F.set(L,{...w.product,items:[],totalItems:0}),F.get(L).items.push(w),F.get(L).totalItems++});let h=Array.from(F.values());if(s.value.search){const w=s.value.search.toLowerCase();h=h.filter(L=>L.name.toLowerCase().includes(w)||L.sku&&L.sku.toLowerCase().includes(w)||L.items.some(re=>{var ye;return(ye=re.item)==null?void 0:ye.name.toLowerCase().includes(w)}))}return s.value.stockStatus&&(h=h.filter(w=>{const L=Y(w);switch(s.value.stockStatus){case"safe":return L.color==="success";case"critical":return L.color==="warning";case"out":return L.color==="error";default:return!0}})),s.value.criticalOnly&&(h=h.filter(w=>w.items.some(L=>L.is_critical))),h.sort((w,L)=>{switch(s.value.sortBy){case"name_asc":return w.name.localeCompare(L.name);case"name_desc":return L.name.localeCompare(w.name);case"price_asc":return(w.price||0)-(L.price||0);case"price_desc":return(L.price||0)-(w.price||0);case"items_asc":return w.totalItems-L.totalItems;case"items_desc":return L.totalItems-w.totalItems;default:return w.name.localeCompare(L.name)}}),h}),Y=F=>{let h=!1,w=!1;return F.items.forEach(L=>{var re;if((re=L.item)!=null&&re.inventory){const ye=L.item.inventory.current_stock||0,ce=L.quantity_needed||0;ye<=0?h=!0:(ye<ce||L.is_critical)&&(w=!0)}}),h?{text:"Stok Habis",color:"error"}:w?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},g=F=>{if(!(F!=null&&F.inventory))return"grey";const h=F.inventory.current_stock||0;return h<=0?"error":h<=10?"warning":"success"},k=F=>{if(!(F!=null&&F.inventory))return"Tidak ada data";const h=F.inventory.current_stock||0;return h<=0?"Habis":h<=10?"Rendah":"Aman"},D=F=>{const h=g(F);return{"text-error":h==="error","text-warning":h==="warning","text-success":h==="success","text-grey":h==="grey"}},G=F=>`Item Komposisi (${F})`;return(F,h)=>(b(),ne("div",Bl,[e(ue,{class:"mb-6"},{default:t(()=>[e(Ce,{class:"d-flex align-center justify-between"},{default:t(()=>[h[12]||(h[12]=a("div",null,[a("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),a("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),e(R,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:h[0]||(h[0]=w=>d("refresh")),loading:F.loading},{default:t(()=>h[11]||(h[11]=[f(" Refresh ")])),_:1,__:[11]},8,["loading"])]),_:1,__:[12]})]),_:1}),e(ue,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(me,null,{default:t(()=>[e($e,null,{default:t(()=>[e(H,{cols:"12",md:"3"},{default:t(()=>[e(Ve,{modelValue:s.value.search,"onUpdate:modelValue":h[1]||(h[1]=w=>s.value.search=w),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:s.value.stockStatus,"onUpdate:modelValue":h[2]||(h[2]=w=>s.value.stockStatus=w),items:W,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:s.value.sortBy,"onUpdate:modelValue":h[3]||(h[3]=w=>s.value.sortBy=w),items:_,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(Ha,{modelValue:s.value.criticalOnly,"onUpdate:modelValue":h[4]||(h[4]=w=>s.value.criticalOnly=w),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e($e,{class:"mt-3"},{default:t(()=>[e(H,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(R,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:C,disabled:!ie.value},{default:t(()=>h[13]||(h[13]=[f(" Reset Filter ")])),_:1,__:[13]},8,["disabled"]),ie.value?(b(),N(ve,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[f(c(pe.value)+" filter aktif ",1)]),_:1})):ee("",!0)]),_:1}),e(H,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(ve,{color:O.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[f(c(O.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!F.loading&&O.value.length===0&&ie.value?(b(),N(He,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):ee("",!0),F.loading?(b(),ne("div",Fl,[e(qt,{color:"primary",indeterminate:"",size:"64"}),h[14]||(h[14]=a("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):O.value.length===0?(b(),ne("div",Kl,[e(I,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),h[16]||(h[16]=a("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),h[17]||(h[17]=a("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(R,{color:"primary",size:"large","prepend-icon":"mdi-plus"},{default:t(()=>h[15]||(h[15]=[f(" Buat Komposisi Pertama ")])),_:1,__:[15]})])):(b(),N($e,{key:3},{default:t(()=>[(b(!0),ne(De,null,Ge(O.value,w=>(b(),N(H,{key:w.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ue,{class:Xe(["composition-card h-100",{"border-error":Y(w).color==="error"}]),elevation:"2"},{default:t(()=>[e(Ce,{class:"pa-4 pb-2"},{default:t(()=>[a("div",Rl,[e(Se,{image:w.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[w.image_url?ee("",!0):(b(),N(I,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),a("div",ql,[a("h3",Ol,c(w.name),1),a("p",Ll,c(w.sku||"SKU-"+w.id_product),1)])])]),_:2},1024),e(me,{class:"py-2"},{default:t(()=>[e(ve,{color:Y(w).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[f(c(Y(w).text),1)]),_:2},1032,["color"]),a("div",Nl,[e(I,{icon:"mdi-format-list-bulleted",size:"16"}),a("span",jl,c(G(w.totalItems)),1)]),a("div",Wl,[(b(!0),ne(De,null,Ge(w.items,L=>{var re,ye,ce,J;return b(),ne("div",{key:L.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[a("div",Gl,[e(I,{icon:(re=L.item)!=null&&re.inventory&&L.item.inventory.current_stock>=L.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(ye=L.item)!=null&&ye.inventory&&L.item.inventory.current_stock>=L.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),a("span",Xl,c(((ce=L.item)==null?void 0:ce.name)||"Item tidak ditemukan"),1),L.is_critical?(b(),N(ve,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>h[18]||(h[18]=[f(" Kritis ")])),_:1,__:[18]})):ee("",!0)]),a("div",Jl,[a("div",Yl,c(L.quantity_needed)+" "+c(L.unit),1),(J=L.item)!=null&&J.inventory?(b(),ne("div",Ql," Stok: "+c(L.item.inventory.current_stock)+" "+c(L.unit),1)):ee("",!0),L.formatted_total_cost?(b(),ne("div",Zl,c(L.formatted_total_cost),1)):ee("",!0)])])}),128))])]),_:2},1024),e(me,{class:"pt-0"},{default:t(()=>[e(Ue,{class:"mb-3"}),a("div",eo,[h[19]||(h[19]=a("span",{class:"text-body-2"},"Harga:",-1)),a("span",to,c(X(tt)(w.price||0)),1)]),a("div",ao,[e(R,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:L=>le(w)},{default:t(()=>h[20]||(h[20]=[f(" Detail ")])),_:2,__:[20]},1032,["onClick"]),e(R,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:L=>j(w)},{default:t(()=>h[21]||(h[21]=[f(" Kelola ")])),_:2,__:[21]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(Yt,{modelValue:U.value,"onUpdate:modelValue":h[5]||(h[5]=w=>U.value=w),product:P.value,items:m.value,onSave:T,onRefresh:h[6]||(h[6]=w=>d("refresh"))},null,8,["modelValue","product","items"]),e(Oe,{modelValue:p.value,"onUpdate:modelValue":h[10]||(h[10]=w=>p.value=w),"max-width":"900",scrollable:""},{default:t(()=>[e(ue,null,{default:t(()=>[e(Ce,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",lo,[e(I,{icon:"mdi-eye",class:"mr-2",color:"primary"}),h[22]||(h[22]=a("span",null,"Detail Komposisi Produk",-1))]),e(R,{icon:"",variant:"text",onClick:h[7]||(h[7]=w=>p.value=!1)},{default:t(()=>[e(I,{icon:"mdi-close"})]),_:1})]),_:1}),e(Ue),r.value?(b(),N(me,{key:0},{default:t(()=>[e(Ba,null,{default:t(()=>[e($e,null,{default:t(()=>[e(H,{cols:"12"},{default:t(()=>[e(ue,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(me,null,{default:t(()=>[a("div",oo,[e(Se,{image:r.value.image_url,size:"80"},{default:t(()=>[r.value.image_url?ee("",!0):(b(),N(I,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),a("div",so,[a("h2",no,c(r.value.name),1),a("div",io,[e(ve,{color:Y(r.value).color,variant:"tonal",size:"small"},{default:t(()=>[f(c(Y(r.value).text),1)]),_:1},8,["color"]),a("span",ro,"SKU: "+c(r.value.sku||"-"),1)]),a("div",uo,c(X(tt)(r.value.price||0)),1)])])]),_:1})]),_:1})]),_:1})]),_:1}),e($e,null,{default:t(()=>[e(H,{cols:"12"},{default:t(()=>[e(ue,{variant:"outlined"},{default:t(()=>[e(Ce,{class:"text-h6"},{default:t(()=>[e(I,{icon:"mdi-format-list-bulleted",class:"mr-2"}),f(" Komposisi Item ("+c(r.value.totalItems||0)+") ",1)]),_:1}),e(me,null,{default:t(()=>[r.value.items&&r.value.items.length>0?(b(),N(kt,{key:0},{default:t(()=>[(b(!0),ne(De,null,Ge(r.value.items,(w,L)=>(b(),N(Je,{key:w.id_product_item,class:"px-0"},{prepend:t(()=>[e(Se,{size:"40",color:g(w.item),variant:"tonal"},{default:t(()=>{var re;return[e(I,{icon:(re=w.item)!=null&&re.inventory&&w.item.inventory.current_stock>=w.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(ve,{color:g(w.item),variant:"tonal",size:"small"},{default:t(()=>[f(c(k(w.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(nt,{class:"font-weight-medium"},{default:t(()=>{var re;return[f(c(((re=w.item)==null?void 0:re.name)||"Unknown Item")+" ",1),w.is_critical?(b(),N(ve,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>h[23]||(h[23]=[f(" Kritis ")])),_:1,__:[23]})):ee("",!0)]}),_:2},1024),e(it,null,{default:t(()=>{var re,ye;return[a("div",co,[a("div",mo,[e(I,{icon:"mdi-scale",size:"14",class:"mr-1"}),a("span",null," Kebutuhan: "+c(Number(w.quantity_needed||0).toLocaleString("id-ID"))+" "+c(w.unit),1)]),a("div",vo,[e(I,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),a("span",{class:Xe(D(w.item))}," Stok: "+c(Number(((ye=(re=w.item)==null?void 0:re.inventory)==null?void 0:ye.current_stock)||0).toLocaleString("id-ID"))+" "+c(w.unit),3)]),w.formatted_total_cost?(b(),ne("div",fo,[e(I,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),a("span",po,c(w.formatted_total_cost),1)])):ee("",!0)])]}),_:2},1024),L<r.value.items.length-1?(b(),N(Ue,{key:0,class:"mt-3"})):ee("",!0)]),_:2},1024))),128))]),_:1})):(b(),ne("div",go,[e(I,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),h[24]||(h[24]=a("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e($e,{class:"mt-4"},{default:t(()=>[e(H,{cols:"12",md:"4"},{default:t(()=>[e(ue,{variant:"outlined",color:"primary"},{default:t(()=>[e(me,{class:"text-center"},{default:t(()=>[e(I,{icon:"mdi-format-list-bulleted",size:"32",class:"mb-2"}),a("div",_o,c(r.value.totalItems||0),1),h[25]||(h[25]=a("div",{class:"text-body-2"},"Total Item",-1))]),_:1,__:[25]})]),_:1})]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(ue,{variant:"outlined",color:"warning"},{default:t(()=>[e(me,{class:"text-center"},{default:t(()=>{var w;return[e(I,{icon:"mdi-alert",size:"32",class:"mb-2"}),a("div",ko,c(((w=r.value.items)==null?void 0:w.filter(L=>L.is_critical).length)||0),1),h[26]||(h[26]=a("div",{class:"text-body-2"},"Item Kritis",-1))]}),_:1,__:[26]})]),_:1})]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(ue,{variant:"outlined",color:"success"},{default:t(()=>[e(me,{class:"text-center"},{default:t(()=>[e(I,{icon:"mdi-currency-usd",size:"32",class:"mb-2"}),a("div",yo,c(X(tt)(r.value.price||0)),1),h[27]||(h[27]=a("div",{class:"text-body-2"},"Harga Jual",-1))]),_:1,__:[27]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):ee("",!0),e(Ue),e(Ke,{class:"pa-4"},{default:t(()=>[e(Le),e(R,{variant:"outlined",onClick:h[8]||(h[8]=w=>p.value=!1)},{default:t(()=>h[28]||(h[28]=[f(" Tutup ")])),_:1,__:[28]}),e(R,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:h[9]||(h[9]=()=>{p.value=!1,j(r.value)})},{default:t(()=>h[29]||(h[29]=[f(" Kelola Komposisi ")])),_:1,__:[29]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),ho=Ne(bo,[["__scopeId","data-v-8f4d44b6"]]),xo={class:"d-flex align-center gap-2"},wo={class:"text-white"},Vo={class:"text-h6 mb-4 d-flex align-center gap-2"},Po={class:"text-h6 mb-4 d-flex align-center gap-2"},Co={class:"d-flex flex-column gap-2"},Io={key:0,class:"d-flex align-center gap-2"},So={class:"d-flex align-center gap-2 mb-2"},$o={class:"d-flex gap-2"},Do={class:"d-flex gap-2"},To={class:"d-flex align-center justify-space-between"},Uo={class:"d-flex align-center gap-2"},zo={class:"text-end"},Ao={class:"text-h6 font-weight-bold"},Mo={class:"text-caption"},Eo={class:"text-h6 mb-4 d-flex align-center gap-2"},Ho={class:"text-h6 mb-4 d-flex align-center gap-2"},Bo={class:"image-upload-container"},Fo={key:0,class:"mb-4"},Ko={class:"text-center mt-2"},Ro={class:"text-h6 mb-4 d-flex align-center gap-2"},qo={class:"text-h6 mb-4 d-flex align-center gap-2"},Oo={class:"d-flex align-center"},Lo={class:"text-subtitle-1"},No={class:"text-body-1"},jo={class:"d-flex align-center"},Wo={class:"text-subtitle-1"},Go=Re({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup(l,{emit:K}){var J,v,u;const y=Ot(),{nameRules:d,categoryRules:U}=Lt(),{getProductHPPBreakdown:p}=oa(),P=B(!1),m=B(!1),r=async()=>{if(!(!_.editMode||!C.id))try{const n=await fetch(`/api/products/${C.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(n.ok){const i=await n.json();m.value=i.success&&i.data&&i.data.length>0}}catch(n){console.error("Error checking HPP status:",n)}},s=async()=>{if(C.id)try{P.value=!0;const n=await p(C.id,"latest");n&&(C.cost=n.total_hpp,le("update-form","cost",n.total_hpp))}catch(n){console.error("Error refreshing HPP:",n)}finally{P.value=!1}},W=()=>{console.log("Open items setup for product:",C.id)},_=l,j=de(()=>_.errorMessage),le=K,T=B(),C=ht({..._.formData});Pe(()=>_.formData,n=>{Object.assign(C,n)},{deep:!0}),Pe(C,n=>{Object.keys(n).forEach(i=>{le("update-form",i,n[i])})},{deep:!0}),Pe(()=>_.modelValue,n=>{n&&_.editMode&&r()});const ie=ht({length:((J=_.formData.dimensions)==null?void 0:J.length)||null,width:((v=_.formData.dimensions)==null?void 0:v.width)||null,height:((u=_.formData.dimensions)==null?void 0:u.height)||null});Pe(ie,n=>{const i=n.length!==null||n.width!==null||n.height!==null;C.dimensions=i?{length:n.length!==null?n.length:void 0,width:n.width!==null?n.width:void 0,height:n.height!==null?n.height:void 0}:{}},{deep:!0});const pe=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],O=de(()=>{if(!C.price||!C.cost||C.cost<=0)return 0;const n=(C.price-C.cost)/C.cost*100;return Math.ceil(n)}),Y=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),g=n=>n<10?"error":n<25?"warning":n<50?"success":"info",k=n=>n<10?"tabler-trending-down":n<25?"tabler-trending-up":n<50?"tabler-trending-up-2":"tabler-trending-up-3",D=n=>!n||n===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),G=n=>{if(!n||n.trim()===""||n==="Rp 0")return 0;const z=n.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(z)||0},F=B(!1),h=n=>{const i=G(n);C.price=i},w=()=>{F.value=!0},L=()=>{F.value=!1},re=async()=>{var i;const{valid:n}=await((i=T.value)==null?void 0:i.validate());n&&le("submit",C)},ye=n=>{le("image-change",n)},ce=()=>{le("remove-image")};return(n,i)=>(b(),N(Oe,{"model-value":n.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":i[25]||(i[25]=z=>n.$emit("update:modelValue",z))},{default:t(()=>[e(ue,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(Ce,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[a("div",xo,[e(I,{icon:n.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),a("span",wo,c(n.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(R,{icon:"tabler-x",variant:"text",color:"white",onClick:i[0]||(i[0]=z=>n.$emit("close"))})]),_:1}),e(Ue),e(me,{class:"pa-6"},{default:t(()=>[e(Ct,{ref_key:"formRef",ref:T,onSubmit:Vt(re,["prevent"])},{default:t(()=>[e($e,null,{default:t(()=>[e(H,{cols:"12"},{default:t(()=>[a("h6",Vo,[e(I,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),i[26]||(i[26]=f(" Informasi Dasar "))])]),_:1}),e(H,{cols:"12",md:"8"},{default:t(()=>[e(Ve,{modelValue:C.name,"onUpdate:modelValue":i[1]||(i[1]=z=>C.name=z),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:X(d),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(Ve,{modelValue:C.sku,"onUpdate:modelValue":i[2]||(i[2]=z=>C.sku=z),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(Ut,{modelValue:C.description,"onUpdate:modelValue":i[3]||(i[3]=z=>C.description=z),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"6"},{default:t(()=>[e(Be,{"model-value":C.category_id,"onUpdate:modelValue":i[4]||(i[4]=z=>C.category_id=z),items:n.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:X(U),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e(H,{cols:"12",md:"6"},{default:t(()=>[e(Ve,{modelValue:C.brand,"onUpdate:modelValue":i[5]||(i[5]=z=>C.brand=z),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[a("h6",Po,[e(I,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),i[27]||(i[27]=f(" Harga & Biaya "))])]),_:1}),e(H,{cols:"12",md:"6"},{default:t(()=>[e(Ve,{"model-value":D(C.price),"onUpdate:modelValue":i[6]||(i[6]=z=>h(z)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:w,onBlur:L},null,8,["model-value"])]),_:1}),e(H,{cols:"12",md:"6"},{default:t(()=>[a("div",Co,[e(Ve,{"model-value":D(C.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),n.editMode?(b(),ne("div",Io,[e(ve,{color:m.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e(I,{icon:m.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),f(" "+c(m.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),m.value?(b(),N(R,{key:0,size:"small",variant:"outlined",color:"primary",onClick:s,loading:P.value},{default:t(()=>[e(I,{icon:"tabler-refresh",size:"14",class:"me-1"}),i[28]||(i[28]=f(" Update HPP "))]),_:1,__:[28]},8,["loading"])):(b(),N(Ee,{key:1},{activator:t(({props:z})=>[e(ve,he(z,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e(I,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),i[29]||(i[29]=f(" Belum Ada Resep "))]),_:2,__:[29]},1040)]),default:t(()=>[i[30]||(i[30]=a("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[30]}))])):ee("",!0)])]),_:1}),n.editMode?(b(),N(H,{key:0,cols:"12"},{default:t(()=>[m.value?(b(),N(He,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(_t,null,{default:t(()=>[e(I,{icon:"tabler-info-circle",class:"me-2"}),i[31]||(i[31]=f(" HPP Otomatis Aktif "))]),_:1,__:[31]}),i[32]||(i[32]=a("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[32]})):(b(),N(He,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(_t,null,{default:t(()=>[e(I,{icon:"tabler-alert-triangle",class:"me-2"}),i[33]||(i[33]=f(" HPP Manual "))]),_:1,__:[33]}),i[34]||(i[34]=a("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[34]}))]),_:1})):ee("",!0),e(H,{cols:"12"},{default:t(()=>[m.value&&n.editMode?(b(),N(He,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[a("div",So,[e(I,{icon:"tabler-check-circle"}),i[35]||(i[35]=a("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),i[38]||(i[38]=a("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),a("div",$o,[e(R,{size:"small",color:"primary",variant:"outlined",onClick:W},{default:t(()=>[e(I,{icon:"tabler-edit",size:"14",class:"me-1"}),i[36]||(i[36]=f(" Edit Resep "))]),_:1,__:[36]}),e(R,{size:"small",variant:"outlined",color:"info",onClick:s,loading:P.value},{default:t(()=>[e(I,{icon:"tabler-refresh",size:"14",class:"me-1"}),i[37]||(i[37]=f(" Refresh HPP "))]),_:1,__:[37]},8,["loading"])])]),_:1,__:[38]})):!m.value&&n.editMode?(b(),N(He,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[a("div",Do,[e(R,{size:"small",variant:"outlined",color:"info",onClick:i[7]||(i[7]=z=>X(y).push("/hpp-management"))},{default:t(()=>[e(I,{icon:"tabler-calculator",size:"14",class:"me-1"}),i[39]||(i[39]=f(" Lihat HPP Management "))]),_:1,__:[39]})])]),_:1})):ee("",!0)]),_:1}),e(H,{cols:"12"},{default:t(()=>[C.price&&C.cost&&C.cost>0?(b(),N(He,{key:0,color:g(O.value),variant:"tonal",class:"mb-0"},{default:t(()=>[a("div",To,[a("div",Uo,[e(I,{icon:k(O.value)},null,8,["icon"]),i[40]||(i[40]=a("span",{class:"font-weight-medium"},"Profit Margin",-1))]),a("div",zo,[a("div",Ao,c(Math.round(O.value))+"%",1),a("div",Mo," Keuntungan: "+c(Y(C.price-C.cost)),1)])])]),_:1},8,["color"])):ee("",!0)]),_:1}),e(H,{cols:"12"},{default:t(()=>[a("h6",Eo,[e(I,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),i[41]||(i[41]=f(" Dimensi (cm) "))])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(Ve,{modelValue:ie.length,"onUpdate:modelValue":i[8]||(i[8]=z=>ie.length=z),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(Ve,{modelValue:ie.width,"onUpdate:modelValue":i[9]||(i[9]=z=>ie.width=z),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(Ve,{modelValue:ie.height,"onUpdate:modelValue":i[10]||(i[10]=z=>ie.height=z),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[a("h6",Ho,[e(I,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),i[42]||(i[42]=f(" Gambar Produk "))])]),_:1}),e(H,{cols:"12"},{default:t(()=>[a("div",Bo,[n.imagePreview?(b(),ne("div",Fo,[e(Oa,{src:n.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),a("div",Ko,[e(R,{size:"small",color:"error",variant:"outlined",onClick:ce},{default:t(()=>i[43]||(i[43]=[f(" Hapus Gambar ")])),_:1,__:[43]})])])):ee("",!0),e(La,{"model-value":n.selectedImage,"onUpdate:modelValue":i[11]||(i[11]=z=>ye(Array.isArray(z)?z:[z])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),i[44]||(i[44]=a("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e(H,{cols:"12"},{default:t(()=>[a("h6",Ro,[e(I,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),i[45]||(i[45]=f(" Pengaturan "))])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(Be,{"model-value":C.status,"onUpdate:modelValue":i[12]||(i[12]=z=>C.status=z),items:pe,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(rt,{"model-value":C.active,"onUpdate:modelValue":i[13]||(i[13]=z=>C.active=z??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(rt,{"model-value":C.featured,"onUpdate:modelValue":i[14]||(i[14]=z=>C.featured=z??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[a("h6",qo,[e(I,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),i[46]||(i[46]=f(" SEO (Opsional) "))])]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(Ve,{modelValue:C.meta_title,"onUpdate:modelValue":i[15]||(i[15]=z=>C.meta_title=z),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(Ut,{modelValue:C.meta_description,"onUpdate:modelValue":i[16]||(i[16]=z=>C.meta_description=z),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(vl,{"model-value":C.tags,"onUpdate:modelValue":i[17]||(i[17]=z=>C.tags=z),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Ue),e(Ke,{class:"pa-6"},{default:t(()=>[e(Le),e(R,{variant:"outlined",class:"coffee-secondary",onClick:i[18]||(i[18]=z=>n.$emit("close"))},{default:t(()=>i[47]||(i[47]=[f(" Batal ")])),_:1,__:[47]}),e(R,{color:"primary",class:"coffee-primary",loading:n.loading,onClick:re},{default:t(()=>[f(c(n.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),n.useDialogError?ee("",!0):(b(),N(at,{key:0,"model-value":!!j.value,"onUpdate:modelValue":i[20]||(i[20]=z=>!z&&n.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(R,{icon:"tabler-x",size:"small",variant:"text",onClick:i[19]||(i[19]=z=>n.$emit("clear-error"))})]),default:t(()=>[a("div",Oo,[e(I,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),a("div",null,[i[48]||(i[48]=a("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),a("div",Lo,c(j.value),1)])])]),_:1},8,["model-value"])),n.useDialogError?(b(),N(Oe,{key:1,"model-value":!!j.value,"onUpdate:modelValue":i[22]||(i[22]=z=>!z&&n.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(ue,null,{default:t(()=>[e(Ce,{class:"d-flex align-center text-error"},{default:t(()=>[e(I,{icon:"tabler-alert-circle",class:"me-2"}),i[49]||(i[49]=f(" Error Occurred "))]),_:1,__:[49]}),e(Ue),e(me,{class:"py-4"},{default:t(()=>[a("div",No,c(j.value),1)]),_:1}),e(Ue),e(Ke,{class:"justify-end pa-4"},{default:t(()=>[e(R,{color:"error",variant:"outlined",onClick:i[21]||(i[21]=z=>n.$emit("clear-error"))},{default:t(()=>i[50]||(i[50]=[f(" Close ")])),_:1,__:[50]})]),_:1})]),_:1})]),_:1},8,["model-value"])):ee("",!0),e(at,{"model-value":!!n.successMessage,"onUpdate:modelValue":i[24]||(i[24]=z=>!z&&n.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(R,{icon:"tabler-x",size:"small",variant:"text",onClick:i[23]||(i[23]=z=>n.$emit("clear-success"))})]),default:t(()=>[a("div",jo,[e(I,{icon:"tabler-check-circle",class:"me-3",size:"28"}),a("div",null,[i[51]||(i[51]=a("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),a("div",Wo,c(n.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),Xo=Ne(Go,[["__scopeId","data-v-66fc4b3b"]]),Jo={key:0,class:"mt-4"},Yo={class:"d-flex align-center gap-2 mb-2"},Qo={class:"d-flex flex-wrap gap-2"},Zo=Re({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup(l,{emit:K}){const y=l,d=K,{categories:U,loading:p,fetchCategories:P}=Na(),m=B(!1),r=B("");ut(()=>{P(),r.value=s.search||""});const s=ht({...y.filters});Pe(()=>y.filters,Y=>{Object.assign(s,Y),r.value=Y.search||""},{deep:!0}),Ca(r,Y=>{console.log("🔍 Search query changed:",Y),s.search=Y,Y.length>=3||Y.length===0?(console.log("✅ Triggering search with query:",Y),m.value=!0,d("search",Y),T(),setTimeout(()=>{m.value=!1},500)):console.log("⏳ Query too short, waiting for more characters:",Y.length)},{debounce:500,maxWait:1e3});const W=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],_=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],j=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],le=de(()=>!!(r.value||s.category_id||s.active||s.stock_status||s.featured!==null||s.min_price||s.max_price)),T=()=>{d("update:filters",{...s})},C=()=>{r.value="",Object.assign(s,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),T()},ie=Y=>{const g=U.value.find(k=>k.id_category===Y);return(g==null?void 0:g.name)||"Unknown"},pe=Y=>{if(!Y)return"Semua";const g=W.find(k=>k.value===Y);return(g==null?void 0:g.title)||String(Y)},O=Y=>{const g=_.find(k=>k.value===Y);return(g==null?void 0:g.title)||Y};return(Y,g)=>(b(),N(ue,{class:"mb-6"},{default:t(()=>[e(Ce,{class:"d-flex align-center gap-2"},{default:t(()=>[e(I,{icon:"tabler-filter",class:"coffee-icon"}),g[11]||(g[11]=f(" Filter & Pencarian Produk "))]),_:1,__:[11]}),e(me,null,{default:t(()=>[e($e,null,{default:t(()=>[e(H,{cols:"12",md:"4"},{default:t(()=>[e(Ve,{modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=k=>r.value=k),label:"Cari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:m.value,clearable:"",variant:"outlined",hint:r.value.length>0&&r.value.length<3?`Ketik ${3-r.value.length} karakter lagi untuk mencari`:"","persistent-hint":""},null,8,["modelValue","loading","hint"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:s.category_id,"onUpdate:modelValue":[g[1]||(g[1]=k=>s.category_id=k),T],items:X(U),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:X(p),clearable:"",variant:"outlined"},null,8,["modelValue","items","loading"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:s.active,"onUpdate:modelValue":[g[2]||(g[2]=k=>s.active=k),T],items:W,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:s.stock_status,"onUpdate:modelValue":[g[3]||(g[3]=k=>s.stock_status=k),T],items:_,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(R,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:C})]),_:1})]),_:1}),e($e,{class:"mt-3"},{default:t(()=>[e(H,{cols:"12",md:"3"},{default:t(()=>[e(Ve,{modelValue:s.min_price,"onUpdate:modelValue":g[4]||(g[4]=k=>s.min_price=k),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:T},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Ve,{modelValue:s.max_price,"onUpdate:modelValue":g[5]||(g[5]=k=>s.max_price=k),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:T},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:s.sort_order,"onUpdate:modelValue":[g[6]||(g[6]=k=>s.sort_order=k),T],items:j,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),le.value?(b(),ne("div",Jo,[a("div",Yo,[e(I,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),g[12]||(g[12]=a("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),a("div",Qo,[r.value?(b(),N(ve,{key:0,closable:"",size:"small",color:"coffee","onClick:close":g[7]||(g[7]=k=>{r.value="",s.search="",T()})},{default:t(()=>[f(" Pencarian: "+c(r.value),1)]),_:1})):ee("",!0),s.category_id?(b(),N(ve,{key:1,closable:"",size:"small",color:"coffee","onClick:close":g[8]||(g[8]=k=>{s.category_id=null,T()})},{default:t(()=>[f(" Kategori: "+c(ie(s.category_id)),1)]),_:1})):ee("",!0),s.active?(b(),N(ve,{key:2,closable:"",size:"small",color:"coffee","onClick:close":g[9]||(g[9]=k=>{s.active=null,T()})},{default:t(()=>[f(" Status: "+c(pe(s.active)),1)]),_:1})):ee("",!0),s.stock_status?(b(),N(ve,{key:3,closable:"",size:"small",color:"coffee","onClick:close":g[10]||(g[10]=k=>{s.stock_status=null,T()})},{default:t(()=>[f(" Stok: "+c(O(s.stock_status)),1)]),_:1})):ee("",!0)])])):ee("",!0)]),_:1})]),_:1}))}}),es=Ne(Zo,[["__scopeId","data-v-1afc3ae3"]]),ts={class:"d-flex align-center gap-2"},as={class:"text-h6"},ls={class:"d-flex align-center gap-2"},os={class:"text-h6"},ss={class:"d-flex align-center gap-2"},ns={class:"text-h6"},is={class:"d-flex align-center gap-2"},rs={class:"text-h6"},us={class:"d-flex align-center gap-2"},ds={class:"text-h6"},cs={class:"d-flex align-center gap-2"},ms={class:"text-h6"},vs={class:"d-flex align-center gap-2"},fs={class:"text-h6"},ps={class:"d-flex align-center gap-2"},gs={class:"text-h6"},_s=Re({__name:"ProductStatsCards",props:{stats:{}},setup(l){const K=d=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(d),y=d=>`${d.toFixed(1)}%`;return(d,U)=>(b(),N($e,{class:"mb-6"},{default:t(()=>[e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ue,{class:"stats-card"},{default:t(()=>[e(me,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-package"})]),_:1}),a("div",null,[U[0]||(U[0]=a("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),a("div",ts,[a("h6",as,c(((p=d.stats)==null?void 0:p.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ue,{class:"stats-card"},{default:t(()=>[e(me,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-check"})]),_:1}),a("div",null,[U[1]||(U[1]=a("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),a("div",ls,[a("h6",os,c(((p=d.stats)==null?void 0:p.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ue,{class:"stats-card"},{default:t(()=>[e(me,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-star"})]),_:1}),a("div",null,[U[2]||(U[2]=a("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),a("div",ss,[a("h6",ns,c(((p=d.stats)==null?void 0:p.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ue,{class:"stats-card"},{default:t(()=>[e(me,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-alert-triangle"})]),_:1}),a("div",null,[U[3]||(U[3]=a("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),a("div",is,[a("h6",rs,c(((p=d.stats)==null?void 0:p.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ue,{class:"stats-card"},{default:t(()=>[e(me,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-currency-dollar"})]),_:1}),a("div",null,[U[4]||(U[4]=a("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),a("div",us,[a("h6",ds,c(K(((p=d.stats)==null?void 0:p.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ue,{class:"stats-card"},{default:t(()=>[e(me,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-chart-line"})]),_:1}),a("div",null,[U[5]||(U[5]=a("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),a("div",cs,[a("h6",ms,c(K(((p=d.stats)==null?void 0:p.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ue,{class:"stats-card"},{default:t(()=>[e(me,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-trending-up"})]),_:1}),a("div",null,[U[6]||(U[6]=a("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),a("div",vs,[a("h6",fs,c(y(((p=d.stats)==null?void 0:p.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ue,{class:"stats-card"},{default:t(()=>[e(me,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-x-circle"})]),_:1}),a("div",null,[U[7]||(U[7]=a("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),a("div",ps,[a("h6",gs,c(((p=d.stats)==null?void 0:p.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),ks=Ne(_s,[["__scopeId","data-v-124783ae"]]),ys={class:"d-flex align-center gap-2"},bs={class:"d-flex align-center gap-2"},hs={class:"text-center py-8"},xs={class:"d-flex align-center gap-3 py-2"},ws={class:"font-weight-medium"},Vs={class:"text-caption text-medium-emphasis"},Ps={class:"text-end"},Cs={class:"font-weight-medium"},Is={key:0,class:"text-caption text-medium-emphasis"},Ss={class:"text-center profit-margin-container"},$s={class:"text-center"},Ds={key:0,class:"text-caption text-medium-emphasis mt-1"},Ts={class:"d-flex align-center gap-2"},Us={class:"text-body-2"},zs={class:"text-caption text-medium-emphasis"},As={class:"d-flex align-center gap-1"},Ms=Re({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","bulk-delete","update:page","update:items-per-page","update:sort-by","update:selected-products"],setup(l){const K=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],y=m=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),d=m=>new Date(m).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),U=m=>new Date(m).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),p=(m,r)=>m<=0?"error":r&&m<=r?"warning":"success",P=m=>m<10?"error":m<25?"warning":m<50?"success":"info";return(m,r)=>(b(),N(ue,null,{default:t(()=>[e(Ce,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",ys,[e(I,{icon:"tabler-list",class:"coffee-icon"}),r[7]||(r[7]=f(" Data Produk ")),m.totalItems?(b(),N(ve,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[f(c(m.totalItems)+" item ",1)]),_:1})):ee("",!0)]),a("div",bs,[m.selectedProducts.length>0?(b(),N(R,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:r[0]||(r[0]=s=>m.$emit("bulk-delete"))},{default:t(()=>[f(" Hapus Terpilih ("+c(m.selectedProducts.length)+") ",1)]),_:1})):ee("",!0),e(R,{"prepend-icon":"tabler-plus",color:"coffee",onClick:r[1]||(r[1]=s=>m.$emit("add-product"))},{default:t(()=>r[8]||(r[8]=[f(" Tambah Produk ")])),_:1,__:[8]})])]),_:1}),e(Ue),e(Za,{"model-value":m.selectedProducts,"onUpdate:modelValue":r[3]||(r[3]=s=>m.$emit("update:selected-products",s)),headers:K,items:m.products,"items-length":m.totalItems,loading:m.loading,"items-per-page":m.itemsPerPage,page:m.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:page":r[4]||(r[4]=s=>m.$emit("update:page",s)),"onUpdate:itemsPerPage":r[5]||(r[5]=s=>m.$emit("update:items-per-page",s)),"onUpdate:sortBy":r[6]||(r[6]=s=>m.$emit("update:sort-by",s))},{loading:t(()=>[e(el,{type:"table-row@10"})]),"no-data":t(()=>[a("div",hs,[e(I,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),r[10]||(r[10]=a("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),r[11]||(r[11]=a("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(R,{"prepend-icon":"tabler-plus",color:"coffee",onClick:r[2]||(r[2]=s=>m.$emit("add-product"))},{default:t(()=>r[9]||(r[9]=[f(" Tambah Produk Pertama ")])),_:1,__:[9]})])]),"item.name":t(({item:s})=>[a("div",xs,[e(Se,{image:s.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[s.image_url?ee("",!0):(b(),N(I,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),a("div",null,[a("div",ws,c(s.name),1),a("div",Vs," SKU: "+c(s.sku||"-"),1)])])]),"item.category":t(({item:s})=>[e(ve,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var W;return[f(c(((W=s.category)==null?void 0:W.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:s})=>[a("div",Ps,[a("div",Cs,c(y(s.price)),1),s.cost?(b(),ne("div",Is," HPP: "+c(y(s.cost)),1)):ee("",!0)])]),"item.profit_margin":t(({item:s})=>[a("div",Ss,[s.cost&&s.cost>0&&s.profit_margin!==void 0?(b(),N(ve,{key:0,color:P(s.profit_margin),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[f(c(Math.round(s.profit_margin))+"% ",1)]),_:2},1032,["color"])):(b(),N(ve,{key:1,color:"grey",size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>r[12]||(r[12]=[f(" - ")])),_:1,__:[12]}))])]),"item.stock":t(({item:s})=>[a("div",$s,[e(ve,{color:p(s.stock,s.min_stock),size:"small",variant:"tonal"},{default:t(()=>[f(c(s.stock)+" "+c(s.unit||"pcs"),1)]),_:2},1032,["color"]),s.min_stock?(b(),ne("div",Ds," Min: "+c(s.min_stock),1)):ee("",!0)])]),"item.active":t(({item:s})=>[a("div",Ts,[e(ve,{color:s.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[f(c(s.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),s.featured?(b(),N(Ee,{key:0,text:"Produk Unggulan"},{activator:t(({props:W})=>[e(I,he(W,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):ee("",!0)])]),"item.created_at":t(({item:s})=>[a("div",Us,c(d(s.created_at??"")),1),a("div",zs,c(U((s==null?void 0:s.created_at)??"")),1)]),"item.actions":t(({item:s})=>[a("div",As,[e(Ee,{text:"Kelola Komposisi"},{activator:t(({props:W})=>[e(R,he(W,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:_=>m.$emit("open-composition-dialog",s)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Kelola Variant"},{activator:t(({props:W})=>[e(R,he(W,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:_=>m.$emit("open-variant-dialog",s)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Edit Produk"},{activator:t(({props:W})=>[e(R,he(W,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:_=>m.$emit("edit-product",s)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:s.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:W})=>{var _;return[e(R,he(W,{icon:s.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:s.active?"success":"error",loading:((_=m.toggleLoading)==null?void 0:_[s.id_product])||!1,onClick:j=>m.$emit("toggle-active",s)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Ee,{text:s.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:W})=>[e(R,he(W,{icon:s.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:s.featured?"warning":"default",onClick:_=>m.$emit("toggle-featured",s)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Ee,{text:"Hapus Produk"},{activator:t(({props:W})=>[e(R,he(W,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:_=>m.$emit("delete-product",s)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),Es=Ne(Ms,[["__scopeId","data-v-bbf8f372"]]),Hs={class:"d-flex align-center gap-3"},Bs={class:"text-h5 font-weight-bold"},Fs={class:"text-h6"},Ks={class:"text-body-1"},Rs={class:"d-flex flex-column"},qs={class:"font-weight-medium"},Os={class:"text-caption text-grey-darken-1"},Ls={class:"font-weight-medium"},Ns={key:0,class:"text-caption"},js={key:1,class:"text-grey-lighten-1 text-caption"},Ws={class:"v-data-table__footer"},Gs={class:"pa-4 d-flex justify-space-between align-center"},Xs={class:"text-subtitle-1 font-weight-bold"},Js={class:"text-subtitle-2 text-uppercase"},Ys={class:"text-h6 font-weight-bold my-2"},Qs={class:"text-caption"},Qt=Re({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup(l,{emit:K}){const y=l,d=K,U=B(!1),p=B(null),P=B(null),m=B(!1),r=B(!1),s=B("latest"),W=B(0),_=B(0),j=B(""),le=B(0),T=B(!1),C=B(!1),ie=B(""),pe=B(""),O=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],Y=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],g=J=>!J||J===0?"":new Intl.NumberFormat("id-ID").format(J),k=J=>{if(!J)return 0;const v=J.replace(/[^\d]/g,"");return parseInt(v)||0},D=J=>{var u;const v=k(J);if(_.value=v,j.value=g(v),(u=p.value)!=null&&u.total_hpp&&v>0){const n=p.value.total_hpp;W.value=n>0?Math.round((v-n)/n*100):0}else W.value=0},G=J=>tt(J),F=async(J,v)=>{U.value=!0;try{await new Promise(u=>setTimeout(u,500)),p.value={total_hpp:15e4,method:v,calculated_at:new Date().toISOString(),items:[{item_name:"Tepung Terigu",item_code:"TPNG001",quantity_needed:.5,unit:"kg",cost_per_unit:15e3,total_cost:7500,is_critical:!1,notes:null},{item_name:"Gula Pasir",item_code:"GUL001",quantity_needed:.25,unit:"kg",cost_per_unit:12e3,total_cost:3e3,is_critical:!1,notes:null},{item_name:"Telur Ayam",item_code:"TLR001",quantity_needed:3,unit:"pcs",cost_per_unit:3e3,total_cost:9e3,is_critical:!0,notes:"Price volatile"}]},m.value=!0}catch(u){console.error("Error loading HPP breakdown:",u),m.value=!1}finally{U.value=!1}},h=async(J,v)=>{U.value=!0;try{if(await new Promise(u=>setTimeout(u,1e3)),p.value){switch(v){case"latest":p.value.total_hpp=Math.round(p.value.total_hpp*1.1);break;case"average":p.value.total_hpp=Math.round(p.value.total_hpp*1.05);break;default:p.value.total_hpp=Math.round(p.value.total_hpp*1.03)}p.value.calculated_at=new Date().toISOString()}}catch(u){throw u}finally{U.value=!1}},w=async(J,v,u,n,i)=>{U.value=!0;try{return await new Promise(z=>setTimeout(z,1e3)),{data:{new_price:u,markup_percentage:p.value?Math.round((u-p.value.total_hpp)/p.value.total_hpp*100):0}}}catch(z){throw z}finally{U.value=!1}},L=async()=>{var J,v,u;if(y.variantId)try{const n=localStorage.getItem("token"),i=await qe.get(`/api/variants/${y.variantId}`,{headers:{Authorization:`Bearer ${n}`,Accept:"application/json"}});if(i.data.success&&i.data.data){const z=i.data.data;if(z.price&&z.price>0)_.value=Number(z.price),j.value=g(Number(z.price));else if((J=p.value)!=null&&J.total_hpp){const M=Math.round(p.value.total_hpp*1.2);_.value=M,j.value=g(M)}if((v=p.value)!=null&&v.total_hpp&&_.value>0){const M=p.value.total_hpp;W.value=M>0?Math.round((_.value-M)/M*100):0}le.value+=1}}catch(n){console.warn("Could not load target price, using default:",n),(u=p.value)!=null&&u.total_hpp&&(_.value=Math.round(p.value.total_hpp*1.2))}},re=async()=>{y.variantId&&(await F(y.variantId,s.value),await L())},ye=async()=>{var J,v;if(y.variantId)try{await h(y.variantId,s.value),ie.value=`HPP successfully updated using ${s.value} method!`,T.value=!0,d("hpp-updated"),await re()}catch(u){console.error("Error updating HPP:",u),pe.value=((v=(J=u==null?void 0:u.response)==null?void 0:J.data)==null?void 0:v.message)||"Failed to update HPP",C.value=!0}},ce=async()=>{var J,v,u,n,i,z;if(y.variantId&&((J=p.value)!=null&&J.total_hpp)&&_.value)try{const M=await w(y.variantId,s.value,_.value,!0,!0);if((v=M==null?void 0:M.data)!=null&&v.new_price){if(_.value=M.data.new_price,j.value=g(M.data.new_price),((u=M==null?void 0:M.data)==null?void 0:u.markup_percentage)!==void 0)W.value=M.data.markup_percentage;else{const V=p.value.total_hpp;W.value=V>0?Math.round((M.data.new_price-V)/V*100):0}le.value+=1,await pt()}await re(),ie.value=`Price successfully updated to ${G(((n=M==null?void 0:M.data)==null?void 0:n.new_price)||_.value)}!`,T.value=!0,d("price-updated")}catch(M){console.error("Error applying price suggestion:",M),pe.value=((z=(i=M==null?void 0:M.response)==null?void 0:i.data)==null?void 0:z.message)||"Failed to update variant price",C.value=!0}};return Pe(()=>y.modelValue,J=>{J&&y.variantId&&re()}),Pe(()=>y.variantId,J=>{J&&y.modelValue&&re()}),Pe(s,async()=>{y.variantId&&await re()}),Pe([()=>{var J;return(J=p.value)==null?void 0:J.total_hpp},_],()=>{var J;if((J=p.value)!=null&&J.total_hpp&&_.value>0){const v=p.value.total_hpp;W.value=v>0?Math.round((_.value-v)/v*100):0}else W.value=0}),Pe(_,J=>{J!==k(j.value)&&(j.value=g(J))}),(J,v)=>(b(),ne(De,null,[e(Oe,{"model-value":J.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":v[6]||(v[6]=u=>J.$emit("update:modelValue",u))},{default:t(()=>[e(ue,null,{default:t(()=>[e(Ce,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",Hs,[e(I,{icon:"mdi-calculator-variant",size:"24"}),a("span",null,"HPP Breakdown - "+c(J.variantName||"Variant"),1)]),e(R,{icon:"mdi-close",size:"small",variant:"text",onClick:v[0]||(v[0]=u=>J.$emit("update:modelValue",!1))})]),_:1}),e(me,null,{default:t(()=>[e($e,{class:"mb-4"},{default:t(()=>[e(H,{cols:"12",md:"6"},{default:t(()=>[e(Be,{modelValue:s.value,"onUpdate:modelValue":[v[1]||(v[1]=u=>s.value=u),re],items:O,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"6"},{default:t(()=>[e(R,{color:"primary",variant:"elevated",loading:U.value,"prepend-icon":"mdi-update",block:"",onClick:ye},{default:t(()=>[f(" Update HPP with "+c(s.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),m.value?(b(),N(ue,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(me,null,{default:t(()=>[e($e,{align:"center"},{default:t(()=>[e(H,{cols:"12",md:"4"},{default:t(()=>{var u;return[v[11]||(v[11]=a("div",{class:"text-subtitle-2"}," Total HPP ",-1)),a("div",Bs,c(G(((u=p.value)==null?void 0:u.total_hpp)||0)),1)]}),_:1,__:[11]}),e(H,{cols:"12",md:"4"},{default:t(()=>{var u;return[v[12]||(v[12]=a("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),a("div",Fs,c((u=O.find(n=>{var i;return n.value===((i=p.value)==null?void 0:i.method)}))==null?void 0:u.title),1)]}),_:1,__:[12]}),e(H,{cols:"12",md:"4"},{default:t(()=>{var u;return[v[13]||(v[13]=a("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),a("div",Ks,c((u=p.value)!=null&&u.calculated_at?new Date(p.value.calculated_at).toLocaleString():"-"),1)]}),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):ee("",!0),m.value?(b(),N(ue,{key:1},{default:t(()=>{var u;return[e(Ce,null,{default:t(()=>{var n,i;return[e(I,{icon:"mdi-format-list-bulleted",class:"me-2"}),f(" Item Breakdown ("+c(((i=(n=p.value)==null?void 0:n.items)==null?void 0:i.length)||0)+" items) ",1)]}),_:1}),e(tl,{headers:Y,items:((u=p.value)==null?void 0:u.items)||[],"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:n})=>[a("div",Rs,[a("span",qs,c(n.item_name),1),a("span",Os,c(n.item_code),1)])]),"item.quantity_needed":t(({item:n})=>[a("span",Ls,c(n.quantity_needed)+" "+c(n.unit),1)]),"item.cost_per_unit":t(({item:n})=>[a("span",null,c(G(n.cost_per_unit)),1)]),"item.total_cost":t(({item:n})=>[e(ve,{color:n.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[f(c(G(n.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:n})=>[e(ve,{color:n.is_critical?"error":"success","prepend-icon":n.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[f(c(n.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:n})=>[n.notes?(b(),ne("span",Ns,c(n.notes),1)):(b(),ne("span",js,"—"))]),bottom:t(()=>{var n;return[a("div",Ws,[e(Ue),a("div",Gs,[a("div",Xs," Total HPP: "+c(G(((n=p.value)==null?void 0:n.total_hpp)||0)),1),e(ve,{color:"info",variant:"elevated"},{default:t(()=>{var i,z;return[f(c(((z=(i=p.value)==null?void 0:i.items)==null?void 0:z.length)||0)+" items ",1)]}),_:1})])])]}),_:1},8,["items"])]}),_:1})):ee("",!0),m.value?(b(),N(ue,{key:2,class:"mt-4"},{default:t(()=>[e(Ce,null,{default:t(()=>[e(I,{icon:"mdi-cash-multiple",class:"me-2"}),v[14]||(v[14]=f(" Price Suggestion "))]),_:1,__:[14]}),e(me,null,{default:t(()=>[e($e,null,{default:t(()=>[e(H,{cols:"12",md:"6"},{default:t(()=>{var u;return[(b(),N(Ve,{key:le.value,modelValue:j.value,"onUpdate:modelValue":[v[2]||(v[2]=n=>j.value=n),D],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${G(((u=p.value)==null?void 0:u.total_hpp)||0)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1}),e(H,{cols:"12",md:"6"},{default:t(()=>{var u;return[(b(),N(Ve,{key:le.value,modelValue:W.value,"onUpdate:modelValue":v[3]||(v[3]=n=>W.value=n),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${G(_.value-(((u=p.value)==null?void 0:u.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e($e,{class:"mt-2"},{default:t(()=>[e(H,{cols:"12",md:"12"},{default:t(()=>[e(R,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:U.value,disabled:!_.value||_.value<=0,block:"",onClick:ce},{default:t(()=>v[15]||(v[15]=[f(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):ee("",!0),r.value?(b(),N(ue,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(Ce,null,{default:t(()=>[e(I,{icon:"mdi-lightbulb",class:"me-2"}),v[16]||(v[16]=f(" Price Suggestions "))]),_:1,__:[16]}),e(me,null,{default:t(()=>[e($e,null,{default:t(()=>[(b(!0),ne(De,null,Ge(P.value.suggestions,(u,n)=>(b(),N(H,{key:n,cols:"12",md:"4"},{default:t(()=>[e(ue,{variant:"elevated"},{default:t(()=>[e(me,{class:"text-center"},{default:t(()=>[a("div",Js,c(n)+" Method ",1),a("div",Ys,c(G(u.suggested_price)),1),a("div",Qs,[f(" HPP: "+c(G(u.hpp)),1),v[17]||(v[17]=a("br",null,null,-1)),f(" Markup: "+c(u.markup_percentage.toFixed(1))+"%",1),v[18]||(v[18]=a("br",null,null,-1)),f(" Margin: "+c(u.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):ee("",!0),!m.value&&!U.value?(b(),N(ue,{key:4,variant:"outlined"},{default:t(()=>[e(me,{class:"text-center py-8"},{default:t(()=>[e(I,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),v[20]||(v[20]=a("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),v[21]||(v[21]=a("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:v[4]||(v[4]=u=>J.$emit("update:modelValue",!1))},{default:t(()=>v[19]||(v[19]=[f(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):ee("",!0)]),_:1}),e(Ke,{class:"pa-4"},{default:t(()=>[e(Le),e(R,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:v[5]||(v[5]=u=>J.$emit("update:modelValue",!1))},{default:t(()=>v[22]||(v[22]=[f(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(at,{modelValue:T.value,"onUpdate:modelValue":v[8]||(v[8]=u=>T.value=u),color:"success",location:"top"},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:v[7]||(v[7]=u=>T.value=!1)},{default:t(()=>v[23]||(v[23]=[f(" Close ")])),_:1,__:[23]})]),default:t(()=>[f(c(ie.value)+" ",1)]),_:1},8,["modelValue"]),e(at,{modelValue:C.value,"onUpdate:modelValue":v[10]||(v[10]=u=>C.value=u),color:"error",location:"top"},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:v[9]||(v[9]=u=>C.value=!1)},{default:t(()=>v[24]||(v[24]=[f(" Close ")])),_:1,__:[24]})]),default:t(()=>[f(c(pe.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),Zs={class:"d-flex align-center gap-2"},en={class:"pa-4",style:{"background-color":"#2A2A2A"}},tn={key:0,class:"d-flex align-center gap-3"},an={class:"text-h6 text-white font-weight-bold"},ln={class:"d-flex align-center gap-4 mt-1"},on={class:"text-caption text-grey-lighten-1"},sn={class:"text-caption text-grey-lighten-1"},nn={class:"pa-4 add-item-form"},rn={class:"d-flex align-center justify-space-between mb-4"},un={class:"d-flex align-center gap-2"},dn={class:"text-h6"},cn={key:0,class:"text-error"},mn={key:1},vn={class:"d-flex align-center"},fn={class:"pa-4 text-center"},pn={class:"pa-4 pt-0"},gn={class:"d-flex align-center justify-between mb-4"},_n={class:"text-h6"},kn={key:0,class:"composition-list"},yn={class:"d-flex align-center justify-between"},bn={class:"d-flex align-center gap-3"},hn={class:"font-weight-medium"},xn={class:"text-caption text-medium-emphasis"},wn={class:"font-weight-medium text-primary"},Vn={class:"d-flex align-center gap-2"},Pn={class:"text-center"},Cn={key:0,class:"text-body-2 text-medium-emphasis"},In={class:"text-center"},Sn={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},$n=Re({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup(l,{emit:K}){const y=l,d=K,U=B(),p=B(!1),P=B(!1),m=B([]),r=B([]),s=B(!1),W=B(null),_=B(!1),j=B(null),le=B(!1),T=B(!1),C=B(""),ie=B(""),pe=B("success"),O=B(!1),Y=de({get:()=>(console.log("🔵 [DEBUG] Dialog getter called, props.modelValue:",y.modelValue),y.modelValue),set:E=>{console.log("🔵 [DEBUG] Dialog setter called with value:",E),d("update:modelValue",E)}}),g=()=>({item_id:null,quantity:1,is_critical:!1}),k=B(g()),D=de(()=>!k.value.item_id||!Array.isArray(m.value)?null:m.value.find(E=>E.id_item===k.value.item_id)),G=de(()=>!D.value||s.value&&W.value!==null?null:r.value.find(E=>{var o,S;return E.name===((o=D.value)==null?void 0:o.name)||E.id&&((S=D.value)==null?void 0:S.id_item)&&E.id===D.value.id_item})),F=de(()=>{if(!D.value)return"";if(s.value&&W.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(G.value){const E=G.value;return`Item sudah ada dengan quantity ${E.quantity} ${E.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${w(D.value)} ${D.value.unit}`}),h=de(()=>Array.isArray(m.value)?m.value.filter(E=>w(E)>0):[]),w=E=>{var o,S;return((o=E.inventory)==null?void 0:o.current_stock)||((S=E.inventory)==null?void 0:S.available_stock)||E.current_stock||0},L=()=>P.value?"Memuat items...":!m.value||m.value.length===0?"Tidak ada item tersedia":h.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",re=E=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(E),ye=E=>{switch(E){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},ce=E=>{switch(E){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},J=(E,o,S)=>{var $,fe,_e,ze,Me,Ae,Fe,Ye;if(!o)return!0;const q=o.toLowerCase().trim(),Z=((fe=($=S==null?void 0:S.raw)==null?void 0:$.name)==null?void 0:fe.toLowerCase())||"",A=((ze=(_e=S==null?void 0:S.raw)==null?void 0:_e.item_code)==null?void 0:ze.toLowerCase())||"",te=((Ae=(Me=S==null?void 0:S.raw)==null?void 0:Me.unit)==null?void 0:Ae.toLowerCase())||"",se=((Ye=(Fe=S==null?void 0:S.raw)==null?void 0:Fe.description)==null?void 0:Ye.toLowerCase())||"";return Z.includes(q)||A.includes(q)||te.includes(q)||se.includes(q)},v=async()=>{var E,o,S;P.value=!0,console.log("Loading available items...");try{const q=await qe.get("/api/items?per_page=all&include=inventory");console.log("Items API response:",q.data);const Z=((o=(E=q.data)==null?void 0:E.data)==null?void 0:o.data)||((S=q.data)==null?void 0:S.data)||q.data||[];m.value=Array.isArray(Z)?Z:[],console.log("Available items loaded:",m.value.length,"items"),console.log("Sample items with inventory:",m.value.slice(0,3))}catch(q){console.error("Error loading items:",q),q!=null&&q.response&&(console.error("API Error Status:",q.response.status),console.error("API Error Data:",q.response.data)),m.value=[]}finally{P.value=!1}},u=async()=>{var E,o,S,q,Z;if(!(!((E=y.variant)!=null&&E.id)&&!((o=y.variant)!=null&&o.id_variant)))try{const A=y.variant.id||y.variant.id_variant;console.log("Loading composition items for variant:",A);const te=await qe.get(`/api/variant-items/variant/${A}`);console.log("Composition API response:",te.data);const se=((q=(S=te.data)==null?void 0:S.data)==null?void 0:q.composition)||((Z=te.data)==null?void 0:Z.composition)||[];if(!Array.isArray(se)){console.warn("API response composition is not an array:",se),r.value=[];return}r.value=se.map($=>{var fe,_e,ze,Me,Ae,Fe,Ye,dt,ct,mt;return{id:$.id_variant_item||$.id,name:((fe=$.item)==null?void 0:fe.name)||$.name,quantity:parseFloat($.quantity_needed||$.quantity||$.qty||"1"),unit:$.unit||((_e=$.item)==null?void 0:_e.unit)||"pcs",stock:((Me=(ze=$.item)==null?void 0:ze.inventory)==null?void 0:Me.current_stock)||((Fe=(Ae=$.item)==null?void 0:Ae.inventory)==null?void 0:Fe.available_stock)||((Ye=$.item)==null?void 0:Ye.current_stock)||$.stock||0,price:parseFloat(((dt=$.item)==null?void 0:dt.cost_per_unit)||((ct=$.item)==null?void 0:ct.price)||$.price||"0"),is_critical:$.is_critical||!1,inventory:(mt=$.item)!=null&&mt.inventory?{current_stock:$.item.inventory.current_stock||0,available_stock:$.item.inventory.available_stock||0,stock_status:$.item.inventory.stock_status||"unknown",reorder_level:$.item.inventory.reorder_level||0}:null}}),console.log("Composition items loaded:",r.value)}catch(A){console.error("Error loading composition items:",A),A!=null&&A.response&&(console.error("API Error Status:",A.response.status),console.error("API Error Data:",A.response.data)),r.value=[]}},n=async()=>{var Z,A;const{valid:E}=await U.value.validate();if(!E||!D.value)return;const o=D.value.name,S=D.value.id_item,q=k.value.quantity;if(console.log("🔍 Handle save - Mode:",s.value?"EDIT":"ADD"),console.log("🔍 Item:",o,"ID:",S),console.log("🔍 Quantity:",q),s.value&&W.value!==null){console.log("✏️ Edit mode: Updating existing item at index",W.value);const se=r.value[W.value].quantity;console.log(`📝 Updating item "${o}":`),console.log(`   - Old quantity: ${se}`),console.log(`   - New quantity: ${q}`),r.value[W.value].quantity=q,r.value[W.value].is_critical=k.value.is_critical,console.log("✅ Item updated successfully in edit mode"),s.value=!1,W.value=null}else{console.log("➕ Add mode: Checking for existing item");const te=r.value.findIndex(se=>se.name===o||se.id&&S&&se.id===S);if(te!==-1){const $=r.value[te].quantity,fe=$+q;console.log("📦 Item already exists! Accumulating quantity:"),console.log(`   - Item: ${o}`),console.log(`   - Old quantity: ${$}`),console.log(`   - Adding: ${q}`),console.log(`   - New quantity: ${fe}`),r.value[te].quantity=fe}else{console.log("➕ Adding new item to composition:",o);const se={name:o,quantity:q,unit:D.value.unit,stock:((Z=D.value.inventory)==null?void 0:Z.current_stock)||((A=D.value.inventory)==null?void 0:A.available_stock)||D.value.current_stock||0,price:D.value.cost_per_unit||0,is_critical:k.value.is_critical,inventory:D.value.inventory?{current_stock:D.value.inventory.current_stock||0,available_stock:D.value.inventory.available_stock||0,stock_status:D.value.inventory.stock_status||"unknown",reorder_level:D.value.inventory.reorder_level||0}:null};r.value.push(se),console.log("✅ New item added successfully")}}k.value=g(),console.log("🔄 Form reset")},i=(E,o)=>{console.log("🔍 Edit item called:",E,o);const S=m.value.find(q=>q.name===E.name||q.id_item===E.id);S?(console.log("✅ Found item in available items:",S),s.value=!0,W.value=o,k.value={item_id:S.id_item,quantity:E.quantity,is_critical:E.is_critical||!1},console.log("📝 Edit mode activated!"),console.log("📝 Form data set:",k.value),console.log("📝 Editing item at index:",o),setTimeout(()=>{const q=document.querySelector(".add-item-form");q&&q.scrollIntoView({behavior:"smooth",block:"start"})},100)):(console.error("❌ Could not find item in available items"),console.log("Available items:",m.value.map(q=>({id:q.id_item,name:q.name}))),console.log("Looking for item:",{id:E.id,name:E.name}))},z=()=>{console.log("❌ Edit mode cancelled"),s.value=!1,W.value=null,k.value=g()},M=(E,o)=>{j.value={item:E,index:o},_.value=!0},V=async()=>{var Z,A,te;if(!j.value)return;const{item:E,index:o}=j.value,S=E.name,q=E.id;le.value=!0,console.log("🚀 Starting delete process for:",S,"ID:",q,"Index:",o);try{q?(console.log("🗑️ Deleting item from database:",S,"with ID:",q),await qe.delete(`/api/variant-items/${q}`),console.log("✅ Item deleted from database successfully")):console.log("📝 Item has no ID, removing from local list only"),_.value=!1,j.value=null,console.log("✅ Delete dialog closed"),console.log("🔄 Force refreshing composition list..."),await u(),console.log("✅ Composition list refreshed from server. New count:",r.value.length),console.log("📡 Emitting save event to parent component..."),d("save"),console.log("✅ Save event emitted to parent component"),console.log("🎉 Item successfully deleted:",S)}catch(se){console.error("❌ Error deleting item:",se),console.error("❌ Error details:",(Z=se.response)==null?void 0:Z.data),alert("Gagal menghapus item: "+(((te=(A=se.response)==null?void 0:A.data)==null?void 0:te.message)||se.message))}finally{le.value=!1,console.log("🏁 Delete process completed")}},x=()=>{_.value=!1,j.value=null},oe=()=>{switch(pe.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},xe=()=>{switch(pe.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Ie=()=>{switch(pe.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},ge=()=>{switch(pe.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Q=async()=>{var E,o,S,q;if(!((E=y.variant)!=null&&E.id)&&!((o=y.variant)!=null&&o.id_variant)){console.error("No variant ID found");return}p.value=!0;try{const Z=y.variant.id||y.variant.id_variant;console.log("🔍 [DEBUG] Composition items count:",r.value.length),console.log("🔍 [DEBUG] Raw composition items:",JSON.stringify(r.value,null,2));const A=r.value.some(te=>te.id);if(console.log("🔍 [DEBUG] Has existing items:",A),A){console.log("� [EDIT MODE] Updating existing composition");const te={items:r.value.map($=>{const fe=m.value.find(_e=>_e.name===$.name);return console.log(`Mapping item "${$.name}":`),console.log("  - Found item:",fe==null?void 0:fe.id_item),console.log("  - Original ID (id_variant_item):",$.id),console.log("  - Quantity:",$.quantity),console.log("  - Unit:",$.unit),console.log("  - Is critical:",$.is_critical),{id_variant_item:$.id,quantity_needed:Number($.quantity),unit:$.unit,is_critical:$.is_critical||!1}}).filter($=>$.id_variant_item&&$.quantity_needed>0)};console.log("Edit payload:",JSON.stringify(te,null,2));const se=await qe.post("/api/variant-items/bulk-update",te);console.log("Composition updated successfully:",se.data)}else{console.log("✨ [CREATE MODE] Creating new composition");const te={id_variant:Z,items:r.value.map($=>{const fe=m.value.find(_e=>_e.name===$.name);return console.log(`Mapping item "${$.name}":`),console.log("  - Found item:",fe==null?void 0:fe.id_item),console.log("  - Quantity:",$.quantity),console.log("  - Unit:",$.unit),console.log("  - Is critical:",$.is_critical),{id_item:fe==null?void 0:fe.id_item,quantity_needed:Number($.quantity),unit:$.unit,is_critical:$.is_critical||!1}}).filter($=>$.id_item&&$.quantity_needed>0)};console.log("Create payload:",JSON.stringify(te,null,2));const se=await qe.post("/api/variant-items/bulk-store",te);console.log("Composition created successfully:",se.data)}d("save"),we()}catch(Z){console.error("Error saving composition:",Z),alert("Gagal menyimpan komposisi: "+(((q=(S=Z.response)==null?void 0:S.data)==null?void 0:q.message)||Z.message))}finally{p.value=!1}},be=()=>{O.value=!0},we=()=>{Y.value=!1,k.value=g(),r.value=[],s.value=!1,W.value=null};return Pe(()=>y.modelValue,E=>{E?(k.value=g(),v(),u()):(s.value=!1,W.value=null)}),Pe(()=>k.value.item_id,E=>{E&&D.value&&console.log("Item selected:",D.value.name,"Unit:",D.value.unit)}),ut(()=>{v()}),(E,o)=>{var S,q,Z;return b(),ne(De,null,[e(Oe,{modelValue:Y.value,"onUpdate:modelValue":o[3]||(o[3]=A=>Y.value=A),"max-width":"1000px",persistent:""},{default:t(()=>[e(ue,null,{default:t(()=>[e(Ce,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[a("div",Zs,[e(I,{icon:"mdi-delete",color:"white"}),o[9]||(o[9]=a("span",null,"Kelola Komposisi Item",-1))]),e(R,{icon:"mdi-close",variant:"text",color:"white",onClick:we,disabled:p.value},null,8,["disabled"])]),_:1}),e(me,{class:"pa-0"},{default:t(()=>[a("div",en,[E.variant?(b(),ne("div",tn,[e(I,{icon:"mdi-coffee",size:"32",color:"white"}),a("div",null,[a("h3",an,c(E.variant.name),1),a("div",ln,[a("span",on,"SKU: "+c(E.variant.sku),1),a("span",sn,"Harga: "+c(re(E.variant.price||0)),1),e(ve,{color:"success",size:"small",variant:"tonal"},{default:t(()=>o[10]||(o[10]=[f(" Stok Aman ")])),_:1,__:[10]})])])])):ee("",!0)]),a("div",nn,[a("div",rn,[a("div",un,[e(I,{icon:"mdi-plus-circle",color:"success"}),a("h4",dn,c(s.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(Ct,{ref_key:"form",ref:U,onSubmit:Vt(n,["prevent"])},{default:t(()=>[e($e,null,{default:t(()=>[e(H,{cols:"12",md:"4"},{default:t(()=>[e(Pt,{modelValue:k.value.item_id,"onUpdate:modelValue":o[0]||(o[0]=A=>k.value.item_id=A),items:h.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[A=>!!A||"Item wajib dipilih"],loading:P.value,disabled:P.value||m.value&&m.value.length===0,"no-data-text":L(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":J},{"prepend-inner":t(()=>[e(I,{icon:"mdi-package",size:"16"})]),item:t(({props:A,item:te})=>[e(Je,he(A,{title:te.raw.name,disabled:w(te.raw)<=0,class:["pa-3",{"text-disabled":w(te.raw)<=0}]}),{prepend:t(()=>[e(I,{icon:"mdi-package-variant",color:w(te.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[a("div",{class:Xe(["text-caption",w(te.raw)<=0?"text-disabled":"text-medium-emphasis"])},[w(te.raw)<=0?(b(),ne("span",cn,[e(I,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),o[11]||(o[11]=f(" Stok Habis "))])):(b(),ne("span",mn," Stok: "+c(w(te.raw))+" "+c(te.raw.unit),1))],2)]),append:t(()=>{var se;return[w(te.raw)>0?(b(),N(ve,{key:0,size:"x-small",color:ye(((se=te.raw.inventory)==null?void 0:se.stock_status)||te.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var $;return[f(c(ce((($=te.raw.inventory)==null?void 0:$.stock_status)||te.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(b(),N(ve,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>o[12]||(o[12]=[f(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:A})=>[a("div",vn,[e(I,{icon:"mdi-package-variant",size:"16",class:"me-2"}),a("span",null,c(A.raw.name),1)])]),"no-data":t(()=>[a("div",fn,[e(I,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),o[13]||(o[13]=a("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),o[14]||(o[14]=a("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(Ve,{modelValue:k.value.quantity,"onUpdate:modelValue":o[1]||(o[1]=A=>k.value.quantity=A),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[A=>!!A||"Jumlah wajib diisi",A=>A>0||"Jumlah harus lebih dari 0"],hint:F.value,"persistent-hint":"",color:G.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>{var A;return[e(Ve,{"model-value":((A=D.value)==null?void 0:A.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!D.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e(I,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e(H,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(rt,{modelValue:k.value.is_critical,"onUpdate:modelValue":o[2]||(o[2]=A=>k.value.is_critical=A),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(R,{color:s.value?"primary":G.value?"warning":"#D4A574",onClick:n,loading:p.value,disabled:!k.value.item_id||!k.value.quantity,block:""},{default:t(()=>[e(I,{icon:s.value?"mdi-content-save":G.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),f(" "+c(s.value?"Update":G.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),s.value?(b(),N(R,{key:0,color:"grey",variant:"outlined",onClick:z,size:"small",block:""},{default:t(()=>[e(I,{icon:"mdi-close",class:"me-1"}),o[15]||(o[15]=f(" Batal "))]),_:1,__:[15]})):ee("",!0)]),_:1})]),_:1})]),_:1},512)]),a("div",pn,[a("div",gn,[a("h4",_n,"Daftar Item Komposisi ("+c(r.value.length)+")",1)]),r.value.length>0?(b(),ne("div",kn,[(b(!0),ne(De,null,Ge(r.value,(A,te)=>(b(),N(ue,{key:te,variant:"outlined",class:"mb-3"},{default:t(()=>[e(me,{class:"pa-3"},{default:t(()=>{var se,$,fe,_e,ze,Me,Ae;return[a("div",yn,[a("div",bn,[e(I,{icon:"mdi-check-circle",color:"success"}),a("div",null,[a("div",hn,c(A.name),1),a("div",xn,[a("span",wn,"Dibutuhkan: "+c(A.quantity)+" "+c(A.unit),1),o[16]||(o[16]=f(" • ")),a("span",{class:Xe({"text-success":(((se=A.inventory)==null?void 0:se.current_stock)??0)>((($=A.inventory)==null?void 0:$.reorder_level)??0),"text-warning":(((fe=A.inventory)==null?void 0:fe.current_stock)??0)<=(((_e=A.inventory)==null?void 0:_e.reorder_level)??0)&&(((ze=A.inventory)==null?void 0:ze.current_stock)??0)>0,"text-error":(((Me=A.inventory)==null?void 0:Me.current_stock)??0)<=0})}," Stok: "+c(((Ae=A.inventory)==null?void 0:Ae.current_stock)||A.stock||0)+" "+c(A.unit),3),f(" • "+c(re(A.price)),1)])])]),a("div",Vn,[e(R,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:Fe=>i(A,te)},null,8,["onClick"]),e(R,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Fe=>M(A,te)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(b(),N(ue,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e(I,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),o[17]||(o[17]=a("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(Ke,{class:"px-6 pb-6"},{default:t(()=>[e(R,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:be},{default:t(()=>o[18]||(o[18]=[f(" Setting HPP ")])),_:1,__:[18]}),e(Le),e(R,{variant:"outlined",onClick:we,disabled:p.value},{default:t(()=>o[19]||(o[19]=[f(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(R,{color:"#D4A574",onClick:Q,loading:p.value,disabled:r.value.length===0},{default:t(()=>o[20]||(o[20]=[f(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Qt,{modelValue:O.value,"onUpdate:modelValue":o[4]||(o[4]=A=>O.value=A),"variant-id":((S=E.variant)==null?void 0:S.id)||((q=E.variant)==null?void 0:q.id_variant),"variant-name":(Z=E.variant)==null?void 0:Z.name,onHppUpdated:o[5]||(o[5]=A=>d("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Oe,{modelValue:_.value,"onUpdate:modelValue":o[6]||(o[6]=A=>_.value=A),"max-width":"400px",persistent:""},{default:t(()=>[e(ue,null,{default:t(()=>[e(Ce,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e(I,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),o[21]||(o[21]=f(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(Ue),e(me,{class:"pa-6"},{default:t(()=>[a("div",Pn,[e(I,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),o[24]||(o[24]=a("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),j.value?(b(),ne("div",Cn,[a("strong",null,c(j.value.item.name),1),o[22]||(o[22]=a("br",null,null,-1)),f(" Dibutuhkan: "+c(j.value.item.quantity)+" "+c(j.value.item.unit),1)])):ee("",!0),e(He,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>o[23]||(o[23]=[a("strong",null,"Perhatian:",-1),f(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(Ke,{class:"px-6 pb-6"},{default:t(()=>[e(R,{variant:"outlined",onClick:x,disabled:le.value,class:"flex-grow-1"},{default:t(()=>o[25]||(o[25]=[f(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(R,{color:"error",onClick:V,loading:le.value,class:"flex-grow-1"},{default:t(()=>o[26]||(o[26]=[f(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Oe,{modelValue:T.value,"onUpdate:modelValue":o[8]||(o[8]=A=>T.value=A),"max-width":"450px",persistent:""},{default:t(()=>[e(ue,null,{default:t(()=>[e(Ce,{class:Xe(["d-flex align-center justify-center text-h6",Ie()])},{default:t(()=>[e(I,{icon:oe(),color:xe(),class:"me-2",size:"24"},null,8,["icon","color"]),f(" "+c(ie.value),1)]),_:1},8,["class"]),e(Ue),e(me,{class:"pa-6"},{default:t(()=>[a("div",In,[e(I,{icon:oe(),color:xe(),size:"64",class:"mb-4"},null,8,["icon","color"]),a("div",Sn,c(C.value),1),e(He,{type:pe.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[pe.value==="success"?(b(),ne(De,{key:0},[o[27]||(o[27]=a("strong",null,"Berhasil!",-1)),o[28]||(o[28]=f(" Perubahan telah disimpan. "))],64)):pe.value==="info"?(b(),ne(De,{key:1},[o[29]||(o[29]=a("strong",null,"Informasi:",-1)),o[30]||(o[30]=f(" Item telah diperbarui sesuai permintaan. "))],64)):(b(),ne(De,{key:2},[o[31]||(o[31]=a("strong",null,"Perhatian:",-1)),o[32]||(o[32]=f(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(Ke,{class:"px-6 pb-6"},{default:t(()=>[e(Le),e(R,{color:ge(),onClick:o[7]||(o[7]=A=>T.value=!1),class:"px-6"},{default:t(()=>[e(I,{icon:"mdi-check",class:"me-1"}),o[33]||(o[33]=f(" OK "))]),_:1,__:[33]},8,["color"]),e(Le)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Dn=Ne($n,[["__scopeId","data-v-df449ced"]]),Tn={class:"d-flex align-center gap-2"},Un={class:"mt-2"},zn={key:0,class:"mt-1 font-weight-medium"},An={key:1,class:"mt-1 text-warning"},Mn=Re({__name:"CreateVariantDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save"],setup(l,{emit:K}){const y=l,d=K,U=B(),p=B(!1),P=B(!1),m=B([]),r=B({name:"",selectedProduct:null,selectedProductId:null,active:!0}),s=[g=>!!g||"Nama variant wajib diisi",g=>g.length>=3||"Nama variant minimal 3 karakter"],W=[g=>!!g||"Produk wajib dipilih"],_=(g,k="success")=>{const D=document.createElement("div");D.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${k==="success"?"#4CAF50":"#f44336"};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 9999;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
  `;const G=document.createElement("span");if(G.innerHTML=k==="success"?"✓":"✕",G.style.cssText=`
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    font-weight: bold;
  `,D.appendChild(G),D.appendChild(document.createTextNode(g)),!document.querySelector("#snackbar-styles")){const F=document.createElement("style");F.id="snackbar-styles",F.textContent=`
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `,document.head.appendChild(F)}document.body.appendChild(D),setTimeout(()=>{D.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{D.parentNode&&D.parentNode.removeChild(D)},300)},3e3),console.log(`${k}: ${g}`)},j=async()=>{P.value=!0;try{const g=await qe.get("/api/products");m.value=g.data.data||g.data||[],console.log("Fetched products:",m.value),console.log("First product structure:",m.value[0])}catch(g){console.error("Gagal mengambil data produk:",g),m.value=[]}finally{P.value=!1}},le=g=>{!g&&m.value.length===0&&j()},T=g=>{console.log("Product object changed:",g),r.value.selectedProduct=g,g?r.value.selectedProductId=g.id:r.value.selectedProductId=null},C=de(()=>{if(console.log("Computing selected product info..."),console.log("form.selectedProduct:",r.value.selectedProduct),console.log("form.selectedProductId:",r.value.selectedProductId),r.value.selectedProduct)return console.log("Using selectedProduct object:",r.value.selectedProduct),r.value.selectedProduct;if(r.value.selectedProductId&&m.value.length>0){console.log("Searching for product with ID:",r.value.selectedProductId),console.log("Product IDs available:",m.value.map(k=>({id:k.id,name:k.name})));const g=m.value.find(k=>k.id===r.value.selectedProductId);return console.log("Found selected product by ID:",g),g}return console.log("No product selected or no products available"),null}),ie=()=>{console.log("Generating SKU...");const g=C.value;if(console.log("Product info for SKU:",g),console.log("Form name:",r.value.name),console.log("Form selectedProductId:",r.value.selectedProductId),!g||!r.value.name)return console.log("Missing productInfo or name, returning empty SKU"),"";const k=g.sku||"PROD",D=r.value.name.replace(/\s+/g,"").toUpperCase().substring(0,3),G=Date.now().toString().slice(-4),F=`${k}-${D}-${G}`;return console.log("Generated SKU:",F),F},pe=async()=>{var D,G;if(p.value)return;const{valid:g}=await U.value.validate();if(!g)return;const k=C.value;if(console.log("Product info in saveVariant:",k),!k){_("Produk tidak ditemukan","error");return}if(!k.id&&!k.id_product){_("ID Produk tidak valid","error"),console.error("Product missing ID:",k);return}p.value=!0;try{const F={id_product:k.id||k.id_product,name:r.value.name,sku:ie(),price:0,cost_price:null,barcode:null,variant_values:[],active:r.value.active};console.log("Payload being sent:",F),console.log("Payload JSON:",JSON.stringify(F));const h=await qe.post("/api/variants",F);if(console.log("API Response:",h.data),console.log("Response Status:",h.status),h.data.success!==!1&&(h.status===200||h.status===201))_("Variant berhasil dibuat!","success"),console.log("Created variant data:",h.data.data),d("save"),Y();else throw new Error(h.data.message||"Gagal membuat variant")}catch(F){const h=((G=(D=F.response)==null?void 0:D.data)==null?void 0:G.message)||F.message||"Gagal membuat variant";_(h,"error"),console.error("Save variant error:",F)}finally{p.value=!1}},O=()=>{var g;r.value={name:"",selectedProduct:null,selectedProductId:null,active:!0},(g=U.value)==null||g.resetValidation()},Y=()=>{d("update:modelValue",!1),O()};return Pe(()=>y.modelValue,g=>{g&&(O(),j())}),(g,k)=>(b(),N(Oe,{"model-value":g.modelValue,"onUpdate:modelValue":k[3]||(k[3]=D=>g.$emit("update:modelValue",D)),"max-width":"600px",persistent:""},{default:t(()=>[e(ue,null,{default:t(()=>[e(Ce,{class:"bg-primary text-white"},{default:t(()=>[e(I,{icon:"mdi-plus-circle",class:"me-2"}),k[4]||(k[4]=f(" Tambah Variant Baru ")),e(Le),e(R,{icon:"mdi-close",variant:"text",color:"white",onClick:Y})]),_:1,__:[4]}),e(Ct,{ref_key:"formRef",ref:U,onSubmit:Vt(pe,["prevent"])},{default:t(()=>[e(me,{class:"pa-6"},{default:t(()=>[e($e,null,{default:t(()=>[e(H,{cols:"12"},{default:t(()=>[e(Pt,{modelValue:r.value.selectedProduct,"onUpdate:modelValue":[k[0]||(k[0]=D=>r.value.selectedProduct=D),T],items:m.value,loading:P.value,"item-title":"name","return-object":"",label:"Pilih Produk *",placeholder:"Cari produk...",variant:"outlined",rules:W,required:"","no-data-text":"Tidak ada produk ditemukan","onUpdate:search":le},{item:t(({props:D,item:G})=>[e(Je,Ia(Sa(D)),{prepend:t(()=>[e(Se,{image:G.raw.image_url,size:"40"},{default:t(()=>[G.raw.image_url?ee("",!0):(b(),N(I,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"])]),default:t(()=>[e(nt,null,{default:t(()=>[f(c(G.raw.name),1)]),_:2},1024),e(it,null,{default:t(()=>[f("SKU: "+c(G.raw.sku||"-"),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:D})=>[a("div",Tn,[e(Se,{image:D.raw.image_url,size:"24"},{default:t(()=>[D.raw.image_url?ee("",!0):(b(),N(I,{key:0,icon:"mdi-coffee",size:"16"}))]),_:2},1032,["image"]),a("span",null,c(D.raw.name),1)])]),_:1},8,["modelValue","items","loading"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(Ve,{modelValue:r.value.name,"onUpdate:modelValue":k[1]||(k[1]=D=>r.value.name=D),label:"Nama Variant *",placeholder:"Contoh: Large Hot, Medium Cold, dll",variant:"outlined",rules:s,required:""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(He,{color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(_t,null,{default:t(()=>[e(I,{icon:"mdi-information",class:"me-2"}),k[5]||(k[5]=f(" SKU Otomatis "))]),_:1,__:[5]}),a("div",Un,[k[6]||(k[6]=f(" SKU variant akan dibuat otomatis berdasarkan nama produk dan variant ")),r.value.name&&(r.value.selectedProduct||r.value.selectedProductId)?(b(),ne("div",zn," Preview SKU: "+c(ie()),1)):r.value.name&&!r.value.selectedProduct&&!r.value.selectedProductId?(b(),ne("div",An," Pilih produk terlebih dahulu untuk melihat preview SKU ")):ee("",!0)])]),_:1})]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(rt,{modelValue:r.value.active,"onUpdate:modelValue":k[2]||(k[2]=D=>r.value.active=D),label:"Variant Aktif",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Ue),e(Ke,{class:"pa-6"},{default:t(()=>[e(Le),e(R,{variant:"outlined",onClick:Y,disabled:p.value},{default:t(()=>k[7]||(k[7]=[f(" Batal ")])),_:1,__:[7]},8,["disabled"]),e(R,{type:"submit",color:"primary",loading:p.value},{default:t(()=>k[8]||(k[8]=[f(" Simpan Variant ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),En=Ne(Mn,[["__scopeId","data-v-6f78bbf1"]]),Hn={class:"product-variant-tab"},Bn={class:"d-flex gap-2"},Fn={key:0,class:"mt-4 d-flex align-center gap-2"},Kn={key:1,class:"text-center pa-12"},Rn={key:2,class:"text-center pa-12"},qn={class:"d-flex align-center gap-3"},On={class:"flex-grow-1 min-width-0"},Ln={class:"text-h6 font-weight-bold text-truncate"},Nn={class:"text-body-2 text-medium-emphasis mb-0"},jn={class:"d-flex flex-column gap-1"},Wn={class:"text-xs"},Gn={class:"d-flex align-center gap-2"},Xn={class:"text-primary font-weight-medium"},Jn={class:"d-flex gap-1"},Yn={class:"d-flex align-center justify-space-between w-100"},Qn={class:"d-flex gap-1"},Zn=Re({__name:"ProductVariantTab",props:{loading:{type:Boolean}},emits:["refresh"],setup(l,{emit:K}){const y=K,d=B(!1),U=B([]),p=B(!1),P=B(!1),m=B(null),r=B(!1),s=B(!1),W=B(!1),_=B({search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}),j=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],le=[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Variant Terbanyak",value:"variants_desc"},{title:"Variant Tersedikit",value:"variants_asc"}],T=de(()=>!!(_.value.search||_.value.stockStatus||_.value.activeStatus!==null||_.value.sortBy!=="name_asc")),C=de(()=>{const v={};return U.value.forEach(u=>{const n=u.id_product;v[n]||(v[n]={product:u.product||{id:u.id_product,id_product:u.id_product,name:`Product ${u.id_product}`,sku:""},variants:[]}),v[n].variants.push(u)}),Object.values(v)}),ie=de(()=>{let v=[...C.value];if(_.value.search){const u=_.value.search.toLowerCase();v=v.filter(n=>{var i;return n.product.name.toLowerCase().includes(u)||((i=n.product.sku)==null?void 0:i.toLowerCase().includes(u))||n.variants.some(z=>z.name.toLowerCase().includes(u)||z.sku.toLowerCase().includes(u))})}switch(_.value.stockStatus&&(v=v.filter(u=>u.variants.some(n=>{var z;return(((z=n.composition_summary)==null?void 0:z.stock_status)||"safe")===_.value.stockStatus}))),_.value.activeStatus!==null&&(v=v.filter(u=>u.variants.some(n=>n.is_active===_.value.activeStatus))),_.value.sortBy){case"name_asc":v.sort((u,n)=>u.product.name.localeCompare(n.product.name));break;case"name_desc":v.sort((u,n)=>n.product.name.localeCompare(u.product.name));break;case"variants_desc":v.sort((u,n)=>n.variants.length-u.variants.length);break;case"variants_asc":v.sort((u,n)=>u.variants.length-n.variants.length);break}return v}),pe=(v,u="success")=>{},O=async()=>{var v,u,n;d.value=!0;try{const i=await qe.get("/api/variants",{params:{per_page:1e3,with_product:!0,with_composition:!0}});if(i.data.success===!1)throw new Error(i.data.message||"Failed to load variants");const z=((v=i.data.data)==null?void 0:v.data)||i.data.data||[];U.value=z.map(M=>({...M,is_active:M.active!==void 0?M.active:M.is_active,id:M.id_variant||M.id,id_product:M.id_product||M.product_id}))}catch(i){(n=(u=i.response)==null?void 0:u.data)!=null&&n.message||i.message,U.value=[]}finally{d.value=!1}},Y=v=>{m.value=v,r.value=!0},g=v=>{v&&(m.value=v,s.value=!0)},k=v=>{m.value=v,p.value=!0},D=()=>{W.value=!0},G=async()=>{var v,u;if(m.value)try{P.value=!0,await qe.delete(`/api/variants/${m.value.id_variant}`),pe("Variant berhasil dihapus","success"),await O(),p.value=!1}catch(n){(u=(v=n.response)==null?void 0:v.data)!=null&&u.message}finally{P.value=!1}},F=v=>{switch(v){case"critical":return"error";case"out":return"error";case"safe":return"success";default:return"primary"}},h=v=>{switch(v){case"critical":return"Kritis";case"out":return"Habis";case"safe":return"Aman";default:return"Normal"}},w=v=>{const u=v.filter(n=>n.is_active).length;return u===0?"error":u===v.length?"success":"warning"},L=v=>v.some(u=>{var i;const n=(i=u.composition_summary)==null?void 0:i.stock_status;return n==="critical"||n==="out"}),re=v=>{const u=v.filter(i=>i.is_active).length,n=v.filter(i=>{var M;const z=(M=i.composition_summary)==null?void 0:M.stock_status;return z==="critical"||z==="out"}).length;return n>0?{text:`${n} Stok Kritis`,color:"error",icon:"mdi-alert-circle"}:u===v.length?{text:"Semua Aktif",color:"success",icon:"mdi-check-circle"}:u===0?{text:"Semua Nonaktif",color:"error",icon:"mdi-close-circle"}:{text:`${u}/${v.length} Aktif`,color:"warning",icon:"mdi-minus-circle"}},ye=()=>{_.value={search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}},ce=()=>{O(),y("refresh")},J=()=>{console.log("Variant created, refreshing data..."),O(),y("refresh")};return ut(()=>{O()}),(v,u)=>{var n,i,z;return b(),ne("div",Hn,[e(ue,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(Ce,{class:"d-flex align-center justify-space-between"},{default:t(()=>[u[14]||(u[14]=a("div",null,[a("h2",{class:"text-h5 font-weight-bold"},"Variant Produk"),a("p",{class:"text-body-2 text-medium-emphasis"}," Kelola variant dan komposisi untuk produk Anda ")],-1)),a("div",Bn,[e(R,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:O,loading:d.value},{default:t(()=>u[12]||(u[12]=[f(" Refresh ")])),_:1,__:[12]},8,["loading"]),e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:D},{default:t(()=>u[13]||(u[13]=[f(" Tambah Variant ")])),_:1,__:[13]})])]),_:1,__:[14]})]),_:1}),e(ue,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(me,null,{default:t(()=>[e($e,null,{default:t(()=>[e(H,{cols:"12",md:"3"},{default:t(()=>[e(Ve,{modelValue:_.value.search,"onUpdate:modelValue":u[0]||(u[0]=M=>_.value.search=M),label:"Cari Variant",placeholder:"Nama variant, SKU, atau produk...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:_.value.stockStatus,"onUpdate:modelValue":u[1]||(u[1]=M=>_.value.stockStatus=M),items:j,label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:_.value.activeStatus,"onUpdate:modelValue":u[2]||(u[2]=M=>_.value.activeStatus=M),items:[{title:"Semua Status",value:null},{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Status Aktif",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:_.value.sortBy,"onUpdate:modelValue":u[3]||(u[3]=M=>_.value.sortBy=M),items:le,label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),T.value?(b(),ne("div",Fn,[u[16]||(u[16]=a("span",{class:"text-body-2"},"Filter aktif:",-1)),_.value.search?(b(),N(ve,{key:0,size:"small",closable:"","onClick:close":u[4]||(u[4]=M=>_.value.search="")},{default:t(()=>[f(" Pencarian: "+c(_.value.search),1)]),_:1})):ee("",!0),_.value.stockStatus?(b(),N(ve,{key:1,size:"small",closable:"","onClick:close":u[5]||(u[5]=M=>_.value.stockStatus="")},{default:t(()=>{var M;return[f(" Stok: "+c((M=j.find(V=>V.value===_.value.stockStatus))==null?void 0:M.title),1)]}),_:1})):ee("",!0),_.value.activeStatus!==null?(b(),N(ve,{key:2,size:"small",closable:"","onClick:close":u[6]||(u[6]=M=>_.value.activeStatus=null)},{default:t(()=>[f(" Status: "+c(_.value.activeStatus?"Aktif":"Nonaktif"),1)]),_:1})):ee("",!0),e(R,{variant:"text",size:"small",color:"error",onClick:ye},{default:t(()=>u[15]||(u[15]=[f(" Hapus Semua Filter ")])),_:1,__:[15]})])):ee("",!0)]),_:1})]),_:1}),!d.value&&ie.value.length===0&&T.value?(b(),N(He,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada variant yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):ee("",!0),d.value?(b(),ne("div",Kn,[e(qt,{color:"primary",indeterminate:"",size:"64"}),u[17]||(u[17]=a("div",{class:"mt-4 text-h6"},"Memuat variant...",-1))])):C.value.length===0?(b(),ne("div",Rn,[e(I,{icon:"mdi-tune-variant",size:"96",class:"text-disabled mb-6"}),u[19]||(u[19]=a("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Variant Produk",-1)),u[20]||(u[20]=a("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat variant untuk produk Anda agar dapat menawarkan pilihan yang beragam ",-1)),e(R,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:D},{default:t(()=>u[18]||(u[18]=[f(" Buat Variant Pertama ")])),_:1,__:[18]})])):(b(),N($e,{key:3},{default:t(()=>[(b(!0),ne(De,null,Ge(ie.value,M=>(b(),N(H,{key:M.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ue,{class:Xe(["variant-group-card h-100",{"border-error":L(M.variants)}]),elevation:"2"},{default:t(()=>[e(Ce,{class:"pa-4 pb-2"},{default:t(()=>[a("div",qn,[e(Se,{image:M.product.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[M.product.image_url?ee("",!0):(b(),N(I,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),a("div",On,[a("h3",Ln,c(M.product.name),1),a("p",Nn," SKU: "+c(M.product.sku||"-"),1)]),e(ve,{color:w(M.variants),size:"small",variant:"tonal"},{default:t(()=>[f(c(M.variants.length)+" Variant ",1)]),_:2},1032,["color"])])]),_:2},1024),e(Ue),e(me,{class:"pa-4"},{default:t(()=>[e(kt,{class:"pa-0"},{default:t(()=>[(b(!0),ne(De,null,Ge(M.variants,(V,x)=>(b(),N(Je,{key:V.id_variant,class:Xe(["pa-2 rounded-lg variant-item",{"mb-2":x<M.variants.length-1}])},{prepend:t(()=>[e(Se,{size:"32",color:V.is_active?"success":"error",variant:"tonal"},{default:t(()=>[e(I,{icon:V.is_active?"mdi-check":"mdi-close",size:"16"},null,8,["icon"])]),_:2},1032,["color"])]),append:t(()=>[a("div",Jn,[e(Ee,{text:"Kelola Komposisi"},{activator:t(({props:oe})=>[e(R,he({ref_for:!0},oe,{icon:"mdi-chef-hat",size:"small",variant:"text",color:"primary",onClick:xe=>Y(V)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Hapus Variant"},{activator:t(({props:oe})=>[e(R,he({ref_for:!0},oe,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:xe=>k(V)}),null,16,["onClick"])]),_:2},1024)])]),default:t(()=>[e(nt,{class:"text-sm font-weight-medium"},{default:t(()=>[f(c(V.name),1)]),_:2},1024),e(it,null,{default:t(()=>[a("div",jn,[a("span",Wn,"SKU: "+c(V.sku),1),a("div",Gn,[a("span",Xn,c(X(tt)(V.price||0)),1),V.composition_summary?(b(),N(ve,{key:0,color:F(V.composition_summary.stock_status),size:"x-small",variant:"tonal"},{default:t(()=>[f(c(h(V.composition_summary.stock_status)),1)]),_:2},1032,["color"])):ee("",!0)])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:2},1024)]),_:2},1024),e(Ue),e(Ke,{class:"pa-4"},{default:t(()=>[a("div",Yn,[a("div",null,[e(ve,{color:re(M.variants).color,size:"small",variant:"tonal"},{default:t(()=>[e(I,{icon:re(M.variants).icon,size:"14",class:"me-1"},null,8,["icon"]),f(" "+c(re(M.variants).text),1)]),_:2},1032,["color"])]),a("div",Qn,[e(Ee,{text:"Setting HPP Produk"},{activator:t(({props:V})=>[e(R,he({ref_for:!0},V,{icon:"mdi-calculator-variant",size:"small",variant:"text",color:"warning",onClick:x=>g(M.variants[0])}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Tambah Variant"},{activator:t(({props:V})=>[e(R,he({ref_for:!0},V,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:D}),null,16)]),_:1}),e(Ee,{text:"Pengaturan Produk (Coming Soon)"},{activator:t(({props:V})=>[e(R,he({ref_for:!0},V,{icon:"mdi-cog",size:"small",variant:"text",color:"secondary",disabled:""}),null,16)]),_:1})])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(Dn,{modelValue:r.value,"onUpdate:modelValue":u[7]||(u[7]=M=>r.value=M),variant:m.value,onSave:ce},null,8,["modelValue","variant"]),e(Qt,{modelValue:s.value,"onUpdate:modelValue":u[8]||(u[8]=M=>s.value=M),"variant-id":(n=m.value)==null?void 0:n.id_variant,"variant-name":(i=m.value)==null?void 0:i.name,onHppUpdated:O,onPriceUpdated:O},null,8,["modelValue","variant-id","variant-name"]),e(En,{modelValue:W.value,"onUpdate:modelValue":u[9]||(u[9]=M=>W.value=M),onSave:J},null,8,["modelValue"]),e(At,{modelValue:p.value,"onUpdate:modelValue":u[10]||(u[10]=M=>p.value=M),title:"Konfirmasi Hapus Variant","item-name":(z=m.value)==null?void 0:z.name,loading:P.value,"confirm-text":"Hapus Variant",onConfirm:G,onCancel:u[11]||(u[11]=M=>p.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),zt=Ne(Zn,[["__scopeId","data-v-38a8b956"]]),ei={class:"product-management"},ti={class:"d-flex justify-space-between align-center mb-6"},ai={class:"d-flex gap-3 align-center"},li={key:0,class:"d-flex gap-2"},oi={class:"d-flex align-center"},si=Re({__name:"products-management",setup(l){Ot();const{productsList:K,categories:y,loading:d,saveLoading:U,deleteLoading:p,toggleLoading:P,stats:m,dialog:r,deleteDialog:s,editMode:W,selectedProduct:_,selectedProducts:j,currentPage:le,totalItems:T,itemsPerPage:C,filters:ie,errorMessage:pe,successMessage:O,modalErrorMessage:Y,formData:g,selectedImage:k,imagePreview:D,canCreateEdit:G,hasSelectedProducts:F,fetchProductsList:h,fetchCategories:w,fetchStats:L,saveProduct:re,deleteProduct:ye,bulkDeleteProducts:ce,toggleActiveStatus:J,toggleFeaturedStatus:v,openCreateDialog:u,openEditDialog:n,openDeleteDialog:i,closeDialog:z,handleImageUpload:M,clearModalError:V,onPageChange:x}=Lt(),{dialog:oe,editMode:xe,formData:Ie,availableItems:ge,saveLoading:Q,modalErrorMessage:be,openCreateDialog:we,closeDialog:E,saveRecipe:o,clearModalError:S,fetchAvailableItems:q}=Fa(),{productItemsList:Z,loading:A,fetchProductItemsForComposition:te}=ta(),se=B("products"),$=B(!1),fe=B(null),_e=B(!1),ze=B(null),Me=async()=>{await ye()},Ae=async()=>{await ce()},Fe=Te=>{const ae=Te.id_product||Te.id;we(ae)},Ye=async Te=>{fe.value=Te;try{await te({page:1,per_page:50,critical_only:!1})}catch{}$.value=!0},dt=Te=>{ze.value=Te,_e.value=!0},ct=Te=>{if(!Te)return[];const ae=Te.id_product||Te.id;return Z.value.filter(lt=>{var ke;return((ke=lt.product)==null?void 0:ke.id_product)===ae||lt.product_id===ae})||[]},mt=Te=>{Object.assign(ie,Te),h()},Zt=Te=>{ie.search=Te,h()},ea=()=>{k.value=null,D.value&&(D.value="")};return Pe(se,async Te=>{Te==="compositions"&&await te({page:1,per_page:15,critical_only:!1})},{immediate:!1}),ut(()=>{h(),w(),L(),q()}),(Te,ae)=>{var lt;return b(),ne("div",ei,[a("div",ti,[ae[19]||(ae[19]=a("div",null,[a("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),a("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),a("div",ai,[X(F)&&se.value==="products"?(b(),ne("div",li,[e(ve,{color:"primary",size:"small"},{default:t(()=>[f(c(X(j).length)+" dipilih ",1)]),_:1}),e(R,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:Ae},{default:t(()=>ae[17]||(ae[17]=[f(" Hapus Terpilih ")])),_:1,__:[17]})])):ee("",!0),X(G)&&se.value==="products"?(b(),N(R,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:X(u)},{default:t(()=>ae[18]||(ae[18]=[f(" Tambah Produk ")])),_:1,__:[18]},8,["onClick"])):ee("",!0)])]),e(hl,{modelValue:se.value,"onUpdate:modelValue":ae[0]||(ae[0]=ke=>se.value=ke),class:"mb-6"},{default:t(()=>[e(ft,{value:"products"},{default:t(()=>[e(I,{icon:"mdi-coffee",class:"me-2"}),ae[20]||(ae[20]=f(" Produk "))]),_:1,__:[20]}),e(ft,{value:"compositions"},{default:t(()=>[e(I,{icon:"mdi-chef-hat",class:"me-2"}),ae[21]||(ae[21]=f(" Komposisi Produk "))]),_:1,__:[21]}),e(ft,{value:"variants"},{default:t(()=>[e(I,{icon:"mdi-tune-variant",class:"me-2"}),ae[22]||(ae[22]=f(" Variant Produk "))]),_:1,__:[22]})]),_:1},8,["modelValue"]),X(pe)?(b(),N(He,{key:0,type:"error",variant:"outlined",class:"mb-4",text:X(pe),closable:"","onClick:close":ae[1]||(ae[1]=ke=>pe.value="")},null,8,["text"])):ee("",!0),X(O)?(b(),N(He,{key:1,type:"success",variant:"outlined",class:"mb-4",text:X(O),closable:"","onClick:close":ae[2]||(ae[2]=ke=>O.value="")},null,8,["text"])):ee("",!0),e(xt,{modelValue:se.value,"onUpdate:modelValue":ae[4]||(ae[4]=ke=>se.value=ke)},{default:t(()=>[e(st,{value:"products"},{default:t(()=>[e(ks,{stats:X(m)},null,8,["stats"]),e(es,{filters:X(ie),"onUpdate:filters":mt,onSearch:Zt},null,8,["filters"]),e(Es,{products:X(K),loading:X(d),"current-page":X(le),"total-items":X(T),"items-per-page":X(C),"selected-products":X(j),"toggle-loading":X(P),"onUpdate:page":X(x),onAddProduct:X(u),onEditProduct:X(n),onOpenRecipeDialog:Fe,onOpenCompositionDialog:Ye,onOpenVariantDialog:dt,onDeleteProduct:X(i),onToggleActive:X(J),onToggleFeatured:X(v),"onUpdate:selectedProducts":ae[3]||(ae[3]=ke=>j.value=ke)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:page","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured"])]),_:1}),e(st,{value:"compositions"},{default:t(()=>[e(ho,{"product-items":X(Z),loading:X(A),onRefresh:X(te)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(st,{value:"variants"},{default:t(()=>[e(zt,{loading:X(d),onRefresh:X(h)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(Xo,{modelValue:X(r),"onUpdate:modelValue":[ae[5]||(ae[5]=ke=>yt(r)?r.value=ke:null),ae[6]||(ae[6]=ke=>r.value=ke)],"edit-mode":X(W),"form-data":X(g),categories:X(y),loading:X(U),"error-message":X(Y),"selected-image":X(k)?[X(k)]:[],"image-preview":X(D),onClose:X(z),onSubmit:X(re),onImageChange:X(M),onRemoveImage:ea,onClearError:X(V),onUpdateForm:ae[7]||(ae[7]=(ke,St)=>X(g)[ke]=St)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(Ka,{modelValue:X(oe),"onUpdate:modelValue":[ae[8]||(ae[8]=ke=>yt(oe)?oe.value=ke:null),ae[9]||(ae[9]=ke=>oe.value=ke)],"edit-mode":X(xe),"form-data":X(Ie),"available-items":X(ge),loading:X(Q),"error-message":X(be),onClose:X(E),onSave:X(o),onClearError:X(S)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(At,{modelValue:X(s),"onUpdate:modelValue":ae[10]||(ae[10]=ke=>yt(s)?s.value=ke:null),title:"Konfirmasi Hapus Produk","item-name":(lt=X(_))==null?void 0:lt.name,loading:X(p),"confirm-text":"Hapus Produk",onConfirm:Me,onCancel:ae[11]||(ae[11]=ke=>s.value=!1)},null,8,["modelValue","item-name","loading"]),e(Yt,{modelValue:$.value,"onUpdate:modelValue":ae[12]||(ae[12]=ke=>$.value=ke),product:fe.value,items:ct(fe.value),onSave:ae[13]||(ae[13]=()=>{X(h)(),$.value=!1}),onRefresh:X(h)},null,8,["modelValue","product","items","onRefresh"]),e(Oe,{modelValue:_e.value,"onUpdate:modelValue":ae[16]||(ae[16]=ke=>_e.value=ke),"max-width":"1400px",persistent:""},{default:t(()=>[e(ue,null,{default:t(()=>[e(Ce,{class:"d-flex justify-between align-center"},{default:t(()=>{var ke;return[a("div",oi,[e(I,{icon:"tabler-versions",class:"me-2"}),f(" Kelola Variant - "+c((ke=ze.value)==null?void 0:ke.name),1)]),e(R,{icon:"tabler-x",variant:"text",onClick:ae[14]||(ae[14]=St=>_e.value=!1)})]}),_:1}),e(Ue),e(me,{class:"pa-0"},{default:t(()=>[ze.value?(b(),N(zt,{key:0,product:ze.value},null,8,["product"])):ee("",!0)]),_:1}),e(Ue),e(Ke,null,{default:t(()=>[e(Le),e(R,{color:"grey-darken-1",variant:"outlined",onClick:ae[15]||(ae[15]=ke=>_e.value=!1)},{default:t(()=>[e(I,{icon:"mdi-close",class:"me-1"}),ae[23]||(ae[23]=f(" Tutup "))]),_:1,__:[23]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Yi=Ne(si,[["__scopeId","data-v-8c8b1097"]]);export{Yi as default};
