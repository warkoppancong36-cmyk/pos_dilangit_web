var he=Object.defineProperty;var we=(L,l,u)=>l in L?he(L,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):L[l]=u;var ce=(L,l,u)=>we(L,typeof l!="symbol"?l+"":l,u);import{D as Se}from"./DeleteConfirmationDialog-CqR4EUJS.js";import{ay as N,d as ue,r as b,V as X,w as ee,D as fe,g as R,f as a,b as e,e as t,X as J,t as p,a0 as $,$ as Te,l as I,c as U,F as ve,i as pe,s as k,aA as _e,o as g,at as Ce,m as Ue}from"./main-Ck3oUqWb.js";import{V as ge}from"./VDialog-BaCx5EhR.js";import{b as ye,c as be,V as q}from"./VCard-2F4cS_aM.js";import{V as $e}from"./VForm-BN6t1PjR.js";import{V as H}from"./VCardText-BKByNquo.js";import{V as Be}from"./VAlert-DpBE1a89.js";import{V as z,a as m}from"./VRow-1DBZ728D.js";import{V as F}from"./VTextField-Cj1TfF2L.js";import{V as Pe}from"./VTextarea-Dx8K1_qG.js";import{V as te}from"./VDivider-DxFhN4lP.js";import{V as ae}from"./VSelect-BV4WhzpI.js";import{V as Ae}from"./VSwitch-CKHxCUCI.js";import{V as xe}from"./VSpacer-D9SzGbRv.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as j}from"./VChip-BFHVzcUj.js";import{V as Le}from"./VDataTableServer-Dj6hjWxi.js";import"./VOverlay-DZc1y4zN.js";import"./forwardRefs-B931MWyl.js";import"./VImg-DtUkqdhO.js";import"./VAvatar-Csa6cPAe.js";/* empty css              */import"./VList-Z_uKjW5U.js";import"./VMenu-BboVVtPU.js";import"./VCheckboxBtn-CrZoWsPS.js";import"./VDataTable-D8X6sT4a.js";import"./VTable-gnjPFkML.js";import"./filter-BvukkJZ3.js";class D{static async getDiscounts(l={}){console.log("=== DISCOUNTS API CALL ==="),console.log("Input filters:",l);const u=await N.get(this.BASE_URL,{params:l});return console.log("Discounts API response:",u.data),u.data.data}static async getDiscount(l){return(await N.get(`${this.BASE_URL}/${l}`)).data.data}static async createDiscount(l){return(await N.post(this.BASE_URL,l)).data.data}static async updateDiscount(l,u){return(await N.put(`${this.BASE_URL}/${l}`,u)).data.data}static async deleteDiscount(l){await N.delete(`${this.BASE_URL}/${l}`)}static async validateDiscountCode(l,u,y){return(await N.post(`${this.BASE_URL}/validate-code`,{code:l,order_total:u,customer_id:y})).data.data}static async getStats(){return(await N.get(`${this.BASE_URL}/stats`)).data.data}static async toggleStatus(l){return(await N.post(`${this.BASE_URL}/${l}/toggle-status`)).data.data}static async duplicate(l){return(await N.post(`${this.BASE_URL}/${l}/duplicate`)).data.data}static formatDiscountValue(l){switch(l.type){case"percentage":return`${l.value}%`;case"fixed_amount":return`Rp ${this.formatCurrency(l.value)}`;default:return l.value.toString()}}static formatCurrency(l){return new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0}).format(l)}static getDiscountTypeLabel(l){return{percentage:"Persentase",fixed_amount:"Jumlah Tetap",buy_x_get_y:"Beli X Dapat Y"}[l]||l}static getStatusColor(l){return{active:"success",inactive:"secondary",expired:"error",scheduled:"warning",exhausted:"info"}[l]||"primary"}static getStatusLabel(l){return{active:"Aktif",inactive:"Tidak Aktif",expired:"Kadaluarsa",scheduled:"Terjadwal",exhausted:"Habis"}[l]||l}static isDiscountValid(l){if(!l.active)return!1;const u=new Date,y=new Date(l.valid_from),h=new Date(l.valid_until);return u>=y&&u<=h}static canDiscountBeUsed(l,u){return!(!this.isDiscountValid(l)||l.minimum_amount&&u<l.minimum_amount||l.usage_limit&&l.used_count>=l.usage_limit)}static calculateDiscountAmount(l,u){if(!this.canDiscountBeUsed(l,u))return 0;let y=0;switch(l.type){case"percentage":y=u*l.value/100;break;case"fixed_amount":y=l.value;break;case"buy_x_get_y":y=0;break}return l.maximum_discount&&y>l.maximum_discount&&(y=l.maximum_discount),Math.round(y*100)/100}}ce(D,"BASE_URL","/api/discounts");const Re={class:"d-flex align-center"},Ie={class:"text-subtitle-2 mb-2"},Fe={key:0,class:"text-body-2"},Me={class:"ml-4 mt-1"},Ke={key:0,class:"text-caption text-info mt-1"},Ne={key:1,class:"text-caption text-error mt-1"},ze={key:2,class:"text-caption text-success mt-1"},Ee=ue({__name:"DiscountDialog",props:{modelValue:{type:Boolean},mode:{},discount:{default:null}},emits:["update:modelValue","saved"],setup(L,{emit:l}){const u=L,y=l,h=b(),S=b(!1),M=b(!1),_=b({}),V=b(!1),B=b(""),x=b({loading:!1,available:null}),o=b({name:"",code:"",description:"",type:"percentage",value:0,minimum_amount:void 0,maximum_discount:void 0,usage_limit:void 0,usage_limit_per_customer:void 0,valid_from:"",valid_until:"",active:!0}),E=[{title:"Persentase (%)",value:"percentage"},{title:"Jumlah Tetap (Rp)",value:"fixed_amount"},{title:"Beli X Dapat Y",value:"buy_x_get_y"}],P=X({get:()=>u.modelValue,set:r=>y("update:modelValue",r)}),Y=X(()=>u.mode==="create"?"Tambah Diskon Baru":"Edit Diskon"),Q=[r=>!!r||"Nama diskon wajib diisi",r=>r.length>=3||"Nama minimal 3 karakter"],n=[r=>!!r||"Kode diskon wajib diisi",r=>r.length>=3||"Kode minimal 3 karakter",r=>/^[A-Z0-9_-]+$/.test(r)||"Kode hanya boleh huruf kapital, angka, - dan _"],s=X(()=>[r=>r>0||"Nilai harus lebih dari 0",...o.value.type==="percentage"?[r=>r<=100||"Persentase maksimal 100%"]:[]]),T=[r=>!!r||"Tanggal mulai wajib diisi"],w=X(()=>[r=>!!r||"Tanggal berakhir wajib diisi",r=>{if(!r||!o.value.valid_from)return!0;const i=new Date(o.value.valid_from);return new Date(r)>i||"Tanggal berakhir harus setelah tanggal mulai"}]),O=_e(async r=>{if(!r||r.length<3){x.value={loading:!1,available:null};return}try{x.value.loading=!0,await new Promise(i=>setTimeout(i,500)),x.value={loading:!1,available:!0}}catch(i){x.value={loading:!1,available:null},console.error("Code validation error:",i)}},500),C=()=>{O(o.value.code)},le=()=>{const r="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let i="";for(let c=0;c<8;c++)i+=r.charAt(Math.floor(Math.random()*r.length));o.value.code=i,C()},se=()=>{switch(o.value.type){case"percentage":return"Persentase Diskon";case"fixed_amount":return"Jumlah Diskon";case"buy_x_get_y":return"Persentase/Jumlah Diskon";default:return"Nilai"}},ie=()=>{o.value.type!=="percentage"&&(o.value.maximum_discount=void 0)},oe=()=>{o.value={name:"",code:"",description:"",type:"percentage",value:0,minimum_amount:void 0,maximum_discount:void 0,usage_limit:void 0,usage_limit_per_customer:void 0,valid_from:"",valid_until:"",active:!0},x.value={loading:!1,available:null},_.value={},V.value=!1,B.value=""},W=()=>{if(u.discount){const r=u.discount;o.value={name:r.name,code:r.code,description:r.description||"",type:r.type,value:r.value,minimum_amount:r.minimum_amount,maximum_discount:r.maximum_discount,usage_limit:r.usage_limit,usage_limit_per_customer:r.usage_limit_per_customer,valid_from:r.valid_from?new Date(r.valid_from).toISOString().slice(0,16):"",valid_until:r.valid_until?new Date(r.valid_until).toISOString().slice(0,16):"",active:r.active}}},ne=async()=>{var i,c,K;_.value={},V.value=!1,B.value="";const{valid:r}=await((i=h.value)==null?void 0:i.validate());if(!(!r||x.value.available===!1)){if(o.value.valid_from&&o.value.valid_until){const A=new Date(o.value.valid_from);if(new Date(o.value.valid_until)<=A){B.value="Tanggal berakhir harus setelah tanggal mulai",V.value=!0;return}}try{M.value=!0,u.mode==="create"?await D.createDiscount(o.value):u.discount&&await D.updateDiscount(u.discount.id_discount,o.value),y("saved")}catch(A){console.error("Save error:",A),(K=(c=A.response)==null?void 0:c.data)!=null&&K.errors?(_.value=A.response.data.errors,B.value=A.response.data.message||"Terjadi kesalahan validasi"):B.value=A.message||"Terjadi kesalahan saat menyimpan data",V.value=!0}finally{M.value=!1}}},Z=()=>{P.value=!1};return ee(()=>u.modelValue,r=>{r&&(u.mode==="edit"&&u.discount?W():oe())}),ee(()=>o.value.code,r=>{r&&C()}),ee(()=>o.value.valid_from,()=>{(_.value.valid_from||_.value.valid_until)&&(_.value={},V.value=!1)}),ee(()=>o.value.valid_until,()=>{(_.value.valid_from||_.value.valid_until)&&(_.value={},V.value=!1)}),fe(()=>{u.modelValue&&u.mode==="edit"&&u.discount&&W()}),(r,i)=>(g(),R(ge,{modelValue:P.value,"onUpdate:modelValue":i[14]||(i[14]=c=>P.value=c),"max-width":"800px",persistent:"",scrollable:""},{default:a(()=>[e(q,null,{default:a(()=>[e(ye,{class:"d-flex align-center justify-space-between bg-primary text-white"},{default:a(()=>[t("div",Re,[e(J,{icon:"mdi-tag-outline",size:"24",class:"me-2"}),t("span",null,p(Y.value),1)]),e($,{icon:"mdi-close",variant:"text",color:"white",onClick:Z})]),_:1}),e($e,{ref_key:"formRef",ref:h,modelValue:S.value,"onUpdate:modelValue":i[13]||(i[13]=c=>S.value=c),onSubmit:Te(ne,["prevent"])},{default:a(()=>[e(H,{class:"pa-6"},{default:a(()=>[V.value?(g(),R(Be,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:"","onClick:close":i[0]||(i[0]=c=>V.value=!1)},{default:a(()=>[t("div",Ie,p(B.value),1),Object.keys(_.value).length>0?(g(),U("div",Fe,[(g(!0),U(ve,null,pe(_.value,(c,K)=>(g(),U("div",{key:K,class:"mb-1"},[t("strong",null,p(K==="valid_until"?"Tanggal Berakhir":K==="valid_from"?"Tanggal Mulai":K)+":",1),t("ul",Me,[(g(!0),U(ve,null,pe(c,A=>(g(),U("li",{key:A,class:"text-caption"},p(A),1))),128))])]))),128))])):I("",!0)]),_:1})):I("",!0),e(z,null,{default:a(()=>[e(m,{cols:"12"},{default:a(()=>i[15]||(i[15]=[t("h6",{class:"text-h6 mb-4"},"Informasi Dasar",-1)])),_:1,__:[15]}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:o.value.name,"onUpdate:modelValue":i[1]||(i[1]=c=>o.value.name=c),label:"Nama Diskon",rules:Q,variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:o.value.code,"onUpdate:modelValue":i[2]||(i[2]=c=>o.value.code=c),label:"Kode Diskon",rules:n,variant:"outlined",required:"",onBlur:C},{"append-inner":a(()=>[e($,{icon:"mdi-dice-multiple",size:"small",variant:"text",onClick:le})]),_:1},8,["modelValue"]),x.value.loading?(g(),U("div",Ke,[e(J,{icon:"mdi-loading",size:"14",class:"spin me-1"}),i[16]||(i[16]=k(" Mengecek ketersediaan kode... "))])):x.value.available===!1?(g(),U("div",Ne,[e(J,{icon:"mdi-alert",size:"14",class:"me-1"}),i[17]||(i[17]=k(" Kode sudah digunakan "))])):x.value.available===!0?(g(),U("div",ze,[e(J,{icon:"mdi-check",size:"14",class:"me-1"}),i[18]||(i[18]=k(" Kode tersedia "))])):I("",!0)]),_:1}),e(m,{cols:"12"},{default:a(()=>[e(Pe,{modelValue:o.value.description,"onUpdate:modelValue":i[3]||(i[3]=c=>o.value.description=c),label:"Deskripsi",variant:"outlined",rows:"3","auto-grow":""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12"},{default:a(()=>[e(te,{class:"my-4"}),i[19]||(i[19]=t("h6",{class:"text-h6 mb-4"},"Konfigurasi Diskon",-1))]),_:1,__:[19]}),e(m,{cols:"12",md:"4"},{default:a(()=>[e(ae,{modelValue:o.value.type,"onUpdate:modelValue":[i[4]||(i[4]=c=>o.value.type=c),ie],items:E,label:"Tipe Diskon",rules:[c=>!!c||"Tipe diskon wajib dipilih"],variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",md:"4"},{default:a(()=>[e(F,{modelValue:o.value.value,"onUpdate:modelValue":i[5]||(i[5]=c=>o.value.value=c),modelModifiers:{number:!0},label:se(),rules:s.value,variant:"outlined",type:"number",prefix:o.value.type==="fixed_amount"?"Rp":void 0,suffix:o.value.type==="percentage"?"%":void 0,min:"0",required:""},null,8,["modelValue","label","rules","prefix","suffix"])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:o.value.minimum_amount,"onUpdate:modelValue":i[6]||(i[6]=c=>o.value.minimum_amount=c),modelModifiers:{number:!0},label:"Minimum Pembelian",variant:"outlined",type:"number",prefix:"Rp",min:"0",hint:"Kosongkan jika tidak ada minimum"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:o.value.maximum_discount,"onUpdate:modelValue":i[7]||(i[7]=c=>o.value.maximum_discount=c),modelModifiers:{number:!0},label:"Maksimum Diskon",variant:"outlined",type:"number",prefix:"Rp",min:"0",hint:"Hanya untuk diskon persentase",disabled:o.value.type!=="percentage"},null,8,["modelValue","disabled"])]),_:1}),e(m,{cols:"12"},{default:a(()=>[e(te,{class:"my-4"}),i[20]||(i[20]=t("h6",{class:"text-h6 mb-4"},"Batasan Penggunaan",-1))]),_:1,__:[20]}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:o.value.usage_limit,"onUpdate:modelValue":i[8]||(i[8]=c=>o.value.usage_limit=c),modelModifiers:{number:!0},label:"Batas Total Penggunaan",variant:"outlined",type:"number",min:"1",hint:"Kosongkan untuk unlimited"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:o.value.usage_limit_per_customer,"onUpdate:modelValue":i[9]||(i[9]=c=>o.value.usage_limit_per_customer=c),modelModifiers:{number:!0},label:"Batas Per Pengguna",variant:"outlined",type:"number",min:"1",hint:"Kosongkan untuk unlimited"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12"},{default:a(()=>[e(te,{class:"my-4"}),i[21]||(i[21]=t("h6",{class:"text-h6 mb-4"},"Periode Berlaku",-1))]),_:1,__:[21]}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:o.value.valid_from,"onUpdate:modelValue":i[10]||(i[10]=c=>o.value.valid_from=c),label:"Berlaku Dari",rules:T,variant:"outlined",type:"datetime-local",required:""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(F,{modelValue:o.value.valid_until,"onUpdate:modelValue":i[11]||(i[11]=c=>o.value.valid_until=c),label:"Berlaku Sampai",rules:w.value,variant:"outlined",type:"datetime-local",required:""},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12"},{default:a(()=>[e(te,{class:"my-4"}),i[22]||(i[22]=t("h6",{class:"text-h6 mb-4"},"Status",-1))]),_:1,__:[22]}),e(m,{cols:"12"},{default:a(()=>[e(Ae,{modelValue:o.value.active,"onUpdate:modelValue":i[12]||(i[12]=c=>o.value.active=c),label:"Aktifkan diskon ini",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(be,{class:"pa-6 pt-0"},{default:a(()=>[e(xe),e($,{variant:"outlined",onClick:Z},{default:a(()=>i[23]||(i[23]=[k(" Batal ")])),_:1,__:[23]}),e($,{type:"submit",color:"primary",loading:M.value,disabled:!S.value||x.value.available===!1},{default:a(()=>[k(p(u.mode==="create"?"Simpan":"Update"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]))}}),je=ke(Ee,[["__scopeId","data-v-ac9c8f11"]]),Oe={class:"d-flex align-center"},qe={class:"mb-6"},He={class:"mb-3"},Je={class:"text-body-1 font-weight-medium"},Xe={class:"mb-3"},Ye={class:"mb-3"},Qe={class:"text-body-1"},We={class:"mb-6"},Ze={class:"mb-3"},Ge={class:"mb-3"},et={class:"text-body-1 font-weight-medium"},tt={class:"mb-3"},at={class:"text-body-1 font-weight-medium"},lt={class:"mb-3"},st={class:"text-body-1 font-weight-medium"},it={class:"mb-3"},ot={class:"text-body-1 font-weight-medium"},nt={class:"mb-3"},ut={class:"text-body-1 font-weight-medium"},dt={class:"mb-6"},rt={class:"mb-3"},mt={class:"text-body-1 font-weight-medium"},ct={key:0,class:"text-medium-emphasis"},vt={key:1,class:"text-medium-emphasis"},pt={class:"mb-3"},ft={class:"text-body-1 font-weight-medium"},_t={class:"mb-3"},gt={class:"text-caption text-medium-emphasis mt-1"},yt={class:"mb-6"},bt={class:"mb-3"},xt={class:"text-body-1 font-weight-medium"},kt={class:"mb-3"},Vt={class:"text-body-1 font-weight-medium"},Dt={class:"mb-3"},ht={class:"mb-6"},wt={class:"mb-3"},St={class:"mb-3"},Tt={class:"mb-3"},Ct={class:"text-body-2"},Ut={class:"mb-3"},$t={class:"text-body-2"},Bt=ue({__name:"DiscountViewDialog",props:{modelValue:{type:Boolean},discount:{}},emits:["update:modelValue"],setup(L,{emit:l}){const u=L,y=l,h=X({get:()=>u.modelValue,set:n=>y("update:modelValue",n)}),S=X(()=>{var n;return(n=u.discount)!=null&&n.usage_limit?u.discount.used_count/u.discount.usage_limit*100:0}),M=()=>{h.value=!1},_=n=>D.formatDiscountValue(n),V=n=>D.getDiscountTypeLabel(n),B=n=>({percentage:"primary",fixed_amount:"success",buy_x_get_y:"warning"})[n]||"secondary",x=n=>D.getStatusColor(n),o=n=>D.getStatusLabel(n),E=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),P=n=>new Date(n).toLocaleString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),Y=()=>{if(!u.discount)return"";const n=new Date,T=new Date(u.discount.valid_until).getTime()-n.getTime();if(T<=0)return"Kadaluarsa";const w=Math.floor(T/(1e3*60*60*24)),O=Math.floor(T%(1e3*60*60*24)/(1e3*60*60)),C=Math.floor(T%(1e3*60*60)/(1e3*60));return w>0?`${w} hari ${O} jam`:O>0?`${O} jam ${C} menit`:C>0?`${C} menit`:"Kurang dari 1 menit"},Q=()=>{if(!u.discount)return"secondary";const n=new Date,T=new Date(u.discount.valid_until).getTime()-n.getTime();if(T<=0)return"error";const w=Math.floor(T/(1e3*60*60*24));return w<=1?"error":w<=7?"warning":"success"};return(n,s)=>(g(),R(ge,{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=T=>h.value=T),"max-width":"600px",scrollable:""},{default:a(()=>[n.discount?(g(),R(q,{key:0},{default:a(()=>[e(ye,{class:"d-flex align-center justify-space-between bg-primary text-white"},{default:a(()=>[t("div",Oe,[e(J,{icon:"mdi-eye",size:"24",class:"me-2"}),s[1]||(s[1]=t("span",null,"Detail Diskon",-1))]),e($,{icon:"mdi-close",variant:"text",color:"white",onClick:M})]),_:1}),e(H,{class:"pa-6"},{default:a(()=>[t("div",qe,[s[5]||(s[5]=t("h6",{class:"text-h6 mb-4"},"Informasi Dasar",-1)),e(z,null,{default:a(()=>[e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",He,[s[2]||(s[2]=t("div",{class:"text-caption text-medium-emphasis"},"Nama Diskon",-1)),t("div",Je,p(n.discount.name),1)])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",Xe,[s[3]||(s[3]=t("div",{class:"text-caption text-medium-emphasis"},"Kode Diskon",-1)),e(j,{color:"primary",variant:"tonal",size:"small"},{default:a(()=>[k(p(n.discount.code),1)]),_:1})])]),_:1}),n.discount.description?(g(),R(m,{key:0,cols:"12"},{default:a(()=>[t("div",Ye,[s[4]||(s[4]=t("div",{class:"text-caption text-medium-emphasis"},"Deskripsi",-1)),t("div",Qe,p(n.discount.description),1)])]),_:1})):I("",!0)]),_:1})]),t("div",We,[s[12]||(s[12]=t("h6",{class:"text-h6 mb-4"},"Konfigurasi Diskon",-1)),e(z,null,{default:a(()=>[e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",Ze,[s[6]||(s[6]=t("div",{class:"text-caption text-medium-emphasis"},"Tipe Diskon",-1)),e(j,{color:B(n.discount.type),variant:"tonal",size:"small"},{default:a(()=>[k(p(V(n.discount.type)),1)]),_:1},8,["color"])])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",Ge,[s[7]||(s[7]=t("div",{class:"text-caption text-medium-emphasis"},"Nilai Diskon",-1)),t("div",et,p(_(n.discount)),1)])]),_:1}),n.discount.type==="buy_x_get_y"?(g(),R(m,{key:0,cols:"12",md:"6"},{default:a(()=>[t("div",tt,[s[8]||(s[8]=t("div",{class:"text-caption text-medium-emphasis"},"Beli Quantity",-1)),t("div",at,p(n.discount.buy_quantity),1)])]),_:1})):I("",!0),n.discount.type==="buy_x_get_y"?(g(),R(m,{key:1,cols:"12",md:"6"},{default:a(()=>[t("div",lt,[s[9]||(s[9]=t("div",{class:"text-caption text-medium-emphasis"},"Dapat Quantity",-1)),t("div",st,p(n.discount.get_quantity),1)])]),_:1})):I("",!0),n.discount.minimum_amount?(g(),R(m,{key:2,cols:"12",md:"6"},{default:a(()=>[t("div",it,[s[10]||(s[10]=t("div",{class:"text-caption text-medium-emphasis"},"Minimum Pembelian",-1)),t("div",ot,p(E(n.discount.minimum_amount)),1)])]),_:1})):I("",!0),n.discount.maximum_discount_amount?(g(),R(m,{key:3,cols:"12",md:"6"},{default:a(()=>[t("div",nt,[s[11]||(s[11]=t("div",{class:"text-caption text-medium-emphasis"},"Maksimum Diskon",-1)),t("div",ut,p(E(n.discount.maximum_discount_amount)),1)])]),_:1})):I("",!0)]),_:1})]),t("div",dt,[s[16]||(s[16]=t("h6",{class:"text-h6 mb-4"},"Informasi Penggunaan",-1)),e(z,null,{default:a(()=>[e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",rt,[s[13]||(s[13]=t("div",{class:"text-caption text-medium-emphasis"},"Total Digunakan",-1)),t("div",mt,[k(p(n.discount.used_count||0)+" ",1),n.discount.usage_limit?(g(),U("span",ct," / "+p(n.discount.usage_limit),1)):(g(),U("span",vt," / Unlimited "))])])]),_:1}),n.discount.usage_limit_per_user?(g(),R(m,{key:0,cols:"12",md:"6"},{default:a(()=>[t("div",pt,[s[14]||(s[14]=t("div",{class:"text-caption text-medium-emphasis"},"Batas Per Pengguna",-1)),t("div",ft,p(n.discount.usage_limit_per_user),1)])]),_:1})):I("",!0),n.discount.usage_limit?(g(),R(m,{key:1,cols:"12",md:"6"},{default:a(()=>[t("div",_t,[s[15]||(s[15]=t("div",{class:"text-caption text-medium-emphasis"},"Progress Penggunaan",-1)),e(Ce,{"model-value":S.value,color:S.value>=90?"error":S.value>=70?"warning":"success",height:"8",rounded:"",class:"mt-2"},null,8,["model-value","color"]),t("div",gt,p(S.value.toFixed(1))+"% terpakai ",1)])]),_:1})):I("",!0)]),_:1})]),t("div",yt,[s[20]||(s[20]=t("h6",{class:"text-h6 mb-4"},"Periode Berlaku",-1)),e(z,null,{default:a(()=>[e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",bt,[s[17]||(s[17]=t("div",{class:"text-caption text-medium-emphasis"},"Berlaku Dari",-1)),t("div",xt,p(P(n.discount.valid_from)),1)])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",kt,[s[18]||(s[18]=t("div",{class:"text-caption text-medium-emphasis"},"Berlaku Sampai",-1)),t("div",Vt,p(P(n.discount.valid_until)),1)])]),_:1}),e(m,{cols:"12"},{default:a(()=>[t("div",Dt,[s[19]||(s[19]=t("div",{class:"text-caption text-medium-emphasis"},"Sisa Waktu",-1)),e(j,{color:Q(),variant:"tonal",size:"small"},{default:a(()=>[e(J,{icon:"mdi-clock-outline",size:"16",class:"me-1"}),k(" "+p(Y()),1)]),_:1},8,["color"])])]),_:1})]),_:1})]),t("div",ht,[s[23]||(s[23]=t("h6",{class:"text-h6 mb-4"},"Status",-1)),e(z,null,{default:a(()=>[e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",wt,[s[21]||(s[21]=t("div",{class:"text-caption text-medium-emphasis"},"Status Aktif",-1)),e(j,{color:n.discount.active?"success":"error",variant:"tonal",size:"small"},{default:a(()=>[e(J,{icon:n.discount.active?"mdi-check":"mdi-close",size:"16",class:"me-1"},null,8,["icon"]),k(" "+p(n.discount.active?"Aktif":"Tidak Aktif"),1)]),_:1},8,["color"])])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",St,[s[22]||(s[22]=t("div",{class:"text-caption text-medium-emphasis"},"Status Berlaku",-1)),e(j,{color:x(n.discount.status),variant:"tonal",size:"small"},{default:a(()=>[k(p(o(n.discount.status)),1)]),_:1},8,["color"])])]),_:1})]),_:1})]),t("div",null,[s[26]||(s[26]=t("h6",{class:"text-h6 mb-4"},"Informasi Sistem",-1)),e(z,null,{default:a(()=>[e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",Tt,[s[24]||(s[24]=t("div",{class:"text-caption text-medium-emphasis"},"Dibuat Pada",-1)),t("div",Ct,p(P(n.discount.created_at)),1)])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",Ut,[s[25]||(s[25]=t("div",{class:"text-caption text-medium-emphasis"},"Terakhir Diupdate",-1)),t("div",$t,p(P(n.discount.updated_at)),1)])]),_:1})]),_:1})])]),_:1}),e(be,{class:"pa-6 pt-0"},{default:a(()=>[e(xe),e($,{variant:"outlined",onClick:M},{default:a(()=>s[27]||(s[27]=[k(" Tutup ")])),_:1,__:[27]})]),_:1})]),_:1})):I("",!0)]),_:1},8,["modelValue"]))}}),Pt={class:"discount-management"},At={class:"d-flex justify-space-between align-center mb-6"},Lt={class:"d-flex gap-3 align-center"},Rt={class:"text-h3 font-weight-bold"},It={class:"text-h3 font-weight-bold"},Ft={class:"text-h3 font-weight-bold"},Mt={class:"text-h3 font-weight-bold"},Kt={class:"d-flex align-center"},Nt={class:"font-weight-medium"},zt={class:"text-center"},Et={class:"font-weight-medium"},jt={key:0,class:"text-caption text-medium-emphasis"},Ot={key:1,class:"text-caption text-medium-emphasis"},qt={class:"text-sm"},Ht={class:"text-medium-emphasis"},Jt={class:"d-flex align-center gap-2"},Xt=ue({__name:"discounts-management",setup(L){const l=b([]),u=b(!1),y=b(null),h=b(1),S=b(15),M=b(0),_=b({search:"",type:"all",status:"all",sort_by:"created_at",sort_order:"desc"}),V=b(!1),B=b(!1),x=b(!1),o=b(null),E=b("create"),P=b(!1),Y=[{title:"Semua Tipe",value:"all"},{title:"Persentase",value:"percentage"},{title:"Jumlah Tetap",value:"fixed_amount"},{title:"Beli X Dapat Y",value:"buy_x_get_y"}],Q=[{title:"Semua Status",value:"all"},{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"},{title:"Kadaluarsa",value:"expired"},{title:"Terjadwal",value:"scheduled"}],n=[{title:"Tanggal Dibuat",value:"created_at"},{title:"Nama",value:"name"},{title:"Kode",value:"code"},{title:"Nilai",value:"value"},{title:"Penggunaan",value:"used_count"},{title:"Tanggal Berlaku",value:"valid_from"}],s=[{title:"Kode",key:"code",sortable:!1},{title:"Nama",key:"name",sortable:!0},{title:"Tipe",key:"type",sortable:!1},{title:"Nilai",key:"value",sortable:!0},{title:"Penggunaan",key:"usage",sortable:!1},{title:"Periode Berlaku",key:"valid_period",sortable:!1},{title:"Status",key:"status",sortable:!1},{title:"Aksi",key:"actions",sortable:!1,align:"center"}],T=_e(()=>{console.log("=== DISCOUNTS DEBOUNCED SEARCH ==="),console.log("Search term:",_.value.search),h.value=1,w()},500),w=async()=>{try{u.value=!0;const f={search:_.value.search||void 0,type:_.value.type==="all"?void 0:_.value.type,status:_.value.status==="all"?void 0:_.value.status,sort_by:_.value.sort_by||"created_at",sort_order:"desc",page:h.value,per_page:S.value};console.log("=== DISCOUNTS FETCH ==="),console.log("Filters:",_.value),console.log("Processed filters:",f);const v=await D.getDiscounts(f);console.log("Discounts API result:",v),l.value=v.data,M.value=v.total,console.log("Discounts loaded:",l.value.length)}catch(f){console.error("Failed to fetch discounts:",f)}finally{u.value=!1}},O=async()=>{try{y.value=await D.getStats()}catch(f){console.error("Failed to fetch discount stats:",f)}},C=async()=>{await Promise.all([w(),O()])},le=f=>{h.value=f.page,S.value=f.itemsPerPage,w()},se=()=>{o.value=null,E.value="create",V.value=!0},ie=f=>{o.value=f,B.value=!0},oe=f=>{o.value=f,E.value="edit",V.value=!0},W=async f=>{try{await D.duplicate(f.id_discount),await C()}catch(v){console.error("Failed to duplicate discount:",v)}},ne=async f=>{try{await D.toggleStatus(f.id_discount),await w()}catch(v){console.error("Failed to toggle discount status:",v)}},Z=f=>{o.value=f,x.value=!0},r=async()=>{if(o.value)try{P.value=!0,await D.deleteDiscount(o.value.id_discount),await C(),x.value=!1}catch(f){console.error("Failed to delete discount:",f)}finally{P.value=!1}},i=()=>{o.value=null,x.value=!1},c=()=>{V.value=!1,C()},K=f=>D.formatDiscountValue(f),A=f=>D.getDiscountTypeLabel(f),de=f=>({percentage:"primary",fixed_amount:"success",buy_x_get_y:"warning"})[f]||"secondary",Ve=f=>D.getStatusColor(f||"inactive"),De=f=>D.getStatusLabel(f||"inactive"),re=f=>new Date(f).toLocaleDateString("id-ID");return fe(()=>{C()}),(f,v)=>{var me;return g(),U("div",Pt,[t("div",At,[v[10]||(v[10]=t("div",null,[t("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Diskon"),t("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola kode diskon dan potongan harga untuk coffee shop Anda")],-1)),t("div",Lt,[e($,{color:"primary","prepend-icon":"mdi-plus",onClick:se},{default:a(()=>v[9]||(v[9]=[k(" Tambah Diskon ")])),_:1,__:[9]})])]),e(z,{class:"mb-6"},{default:a(()=>[e(m,{cols:"12",md:"3"},{default:a(()=>[e(q,{color:"primary",variant:"tonal"},{default:a(()=>[e(H,{class:"text-center"},{default:a(()=>{var d;return[t("div",Rt,p(((d=y.value)==null?void 0:d.total_discounts)||0),1),v[11]||(v[11]=t("div",{class:"text-body-2 text-medium-emphasis"},"Total Diskon",-1))]}),_:1,__:[11]})]),_:1})]),_:1}),e(m,{cols:"12",md:"3"},{default:a(()=>[e(q,{color:"success",variant:"tonal"},{default:a(()=>[e(H,{class:"text-center"},{default:a(()=>{var d;return[t("div",It,p(((d=y.value)==null?void 0:d.active_discounts)||0),1),v[12]||(v[12]=t("div",{class:"text-body-2 text-medium-emphasis"},"Aktif",-1))]}),_:1,__:[12]})]),_:1})]),_:1}),e(m,{cols:"12",md:"3"},{default:a(()=>[e(q,{color:"warning",variant:"tonal"},{default:a(()=>[e(H,{class:"text-center"},{default:a(()=>{var d;return[t("div",Ft,p(((d=y.value)==null?void 0:d.total_usage)||0),1),v[13]||(v[13]=t("div",{class:"text-body-2 text-medium-emphasis"},"Terpakai",-1))]}),_:1,__:[13]})]),_:1})]),_:1}),e(m,{cols:"12",md:"3"},{default:a(()=>[e(q,{color:"error",variant:"tonal"},{default:a(()=>[e(H,{class:"text-center"},{default:a(()=>{var d;return[t("div",Mt,p(((d=y.value)==null?void 0:d.expired_discounts)||0),1),v[14]||(v[14]=t("div",{class:"text-body-2 text-medium-emphasis"},"Kedaluwarsa",-1))]}),_:1,__:[14]})]),_:1})]),_:1})]),_:1}),e(q,null,{default:a(()=>[e(H,null,{default:a(()=>[e(z,{class:"mb-4"},{default:a(()=>[e(m,{cols:"12",md:"4"},{default:a(()=>[e(F,{modelValue:_.value.search,"onUpdate:modelValue":v[0]||(v[0]=d=>_.value.search=d),label:"Cari diskon...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:Ue(T)},null,8,["modelValue","onInput"])]),_:1}),e(m,{cols:"12",md:"2"},{default:a(()=>[e(ae,{modelValue:_.value.type,"onUpdate:modelValue":[v[1]||(v[1]=d=>_.value.type=d),w],items:Y,label:"Tipe",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"2"},{default:a(()=>[e(ae,{modelValue:_.value.status,"onUpdate:modelValue":[v[2]||(v[2]=d=>_.value.status=d),w],items:Q,label:"Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"2"},{default:a(()=>[e(ae,{modelValue:_.value.sort_by,"onUpdate:modelValue":[v[3]||(v[3]=d=>_.value.sort_by=d),w],items:n,label:"Urutkan",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"2",class:"d-flex align-center"},{default:a(()=>[e($,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:C},{default:a(()=>v[15]||(v[15]=[k(" Refresh ")])),_:1,__:[15]})]),_:1})]),_:1}),e(Le,{"items-per-page":S.value,"onUpdate:itemsPerPage":v[4]||(v[4]=d=>S.value=d),page:h.value,"onUpdate:page":v[5]||(v[5]=d=>h.value=d),headers:s,items:l.value,"items-length":M.value,loading:u.value,class:"discount-table","onUpdate:options":le},{"item.code":a(({item:d})=>[t("div",Kt,[e(j,{size:"small",color:"primary",variant:"tonal"},{default:a(()=>[k(p(d.code),1)]),_:2},1024)])]),"item.type":a(({item:d})=>[e(j,{size:"small",color:de(d.type),variant:"tonal"},{default:a(()=>[k(p(A(d.type)),1)]),_:2},1032,["color"])]),"item.value":a(({item:d})=>[t("span",Nt,p(K(d)),1)]),"item.usage":a(({item:d})=>[t("div",zt,[t("div",Et,p(d.used_count),1),d.usage_limit?(g(),U("div",jt," / "+p(d.usage_limit),1)):(g(),U("div",Ot," Unlimited "))])]),"item.valid_period":a(({item:d})=>[t("div",qt,[t("div",null,p(re(d.valid_from)),1),t("div",Ht,p(re(d.valid_until)),1)])]),"item.status":a(({item:d})=>[e(j,{size:"small",color:Ve(d.status),variant:"tonal"},{default:a(()=>[k(p(De(d.status)),1)]),_:2},1032,["color"])]),"item.actions":a(({item:d})=>[t("div",Jt,[e($,{icon:"mdi-eye",size:"small",variant:"text",onClick:G=>ie(d)},null,8,["onClick"]),e($,{icon:"mdi-pencil",size:"small",variant:"text",onClick:G=>oe(d)},null,8,["onClick"]),e($,{icon:d.active?"mdi-pause":"mdi-play",size:"small",variant:"text",onClick:G=>ne(d)},null,8,["icon","onClick"]),e($,{icon:"mdi-content-copy",size:"small",variant:"text",onClick:G=>W(d)},null,8,["onClick"]),e($,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:G=>Z(d)},null,8,["onClick"])])]),_:1},8,["items-per-page","page","items","items-length","loading"])]),_:1})]),_:1}),e(je,{modelValue:V.value,"onUpdate:modelValue":v[6]||(v[6]=d=>V.value=d),discount:o.value,mode:E.value,onSaved:c},null,8,["modelValue","discount","mode"]),e(Bt,{modelValue:B.value,"onUpdate:modelValue":v[7]||(v[7]=d=>B.value=d),discount:o.value},null,8,["modelValue","discount"]),e(Se,{modelValue:x.value,"onUpdate:modelValue":v[8]||(v[8]=d=>x.value=d),loading:P.value,"item-name":((me=o.value)==null?void 0:me.name)||"",title:"Konfirmasi Hapus Diskon",onConfirm:r,onCancel:i},null,8,["modelValue","loading","item-name"])])}}}),ha=ke(Xt,[["__scopeId","data-v-67d63569"]]);export{ha as default};
