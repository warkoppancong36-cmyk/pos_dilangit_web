import{P as ne}from"./PosApi-Biq9vmJs.js";import ie from"./EditOrderDialog-BtnbCNIc.js";import de from"./OrderDetailDialog-D7RzJ5cC.js";import{V as ue}from"./VDialog-QmK9zPjX.js";import{V as b,b as ce}from"./VCard-Bm-WIwfT.js";import{d as me,r as u,V as pe,D as ge,w as M,g as U,f as o,o as c,b as l,e as r,X as $,a1 as x,c as v,l as E,t as i,F as ve,i as _e,s as w,_ as fe}from"./main-1eF4oZyR.js";import{V as _}from"./VCardText-DKi0NVLE.js";import{V as L,a as m}from"./VRow-LE3O-Vbx.js";import{V as N}from"./VTextField-DRfyYJNT.js";import{V as ye}from"./VSelect-DYaaPaI4.js";import{V as he}from"./VDataTable-B1NuwVem.js";import{V as A}from"./VChip-DsFodI2z.js";import"./VForm-C4OfBTtx.js";import"./forwardRefs-B931MWyl.js";import"./VTextarea-Bcr38PkU.js";import"./VImg-Co7pVBFs.js";import"./VDivider-aIb8DG1x.js";import"./VSpacer-B2n2qfAa.js";/* empty css              */import"./VTable-8_itj861.js";import"./VOverlay-BPXGhwad.js";import"./VAvatar-DPv1Jpi5.js";import"./VList-CjYzkRvx.js";import"./VMenu-CHGpGPUI.js";import"./VCheckboxBtn-D4wQIBO4.js";import"./filter-BSeas981.js";const Ve={class:"d-flex align-items-center gap-2"},be={class:"text-h4"},xe={class:"text-h4"},ke={class:"text-h4"},De={class:"text-h4"},we={key:0},Te={class:"font-weight-medium"},Ce={class:"text-caption text-medium-emphasis"},Se={key:1,class:"text-medium-emphasis"},Ie={class:"font-weight-medium"},Oe={key:0},Pe={key:1,class:"text-medium-emphasis"},Fe={class:"text-body-2"},Ue={class:"text-caption text-medium-emphasis"},Ne={key:0,class:"pa-4 text-center border-t"},Ae=me({__name:"TransactionHistoryDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(j,{emit:H}){const Q=j,q=H,T=u(!1),d=u([]),f=u(""),y=u(""),p=u(""),g=u(""),C=u(!1),S=u(!1),k=u(null),n=u({current_page:1,per_page:15,total:0,last_page:1}),h=u({total_orders:0,total_revenue:0,average_order:0,pending_orders:0}),K=[{title:"No. Pesanan",key:"order_number",sortable:!0},{title:"Pelanggan",key:"customer",sortable:!1},{title:"Status",key:"status",sortable:!0},{title:"Total",key:"total_amount",sortable:!0},{title:"Pembayaran",key:"payment_method",sortable:!1},{title:"Tanggal",key:"created_at",sortable:!0},{title:"Aksi",key:"actions",sortable:!1,width:"120px"}],W=[{title:"Pending",value:"pending"},{title:"Diproses",value:"preparing"},{title:"Selesai",value:"completed"},{title:"Dibatalkan",value:"cancelled"}],X=[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],D=pe({get:()=>Q.modelValue,set:a=>q("update:modelValue",a)}),V=async(a=1,t=15)=>{try{T.value=!0;const e={page:a,per_page:t>=999999?"all":t};f.value&&(e.search=f.value),y.value&&(e.status=y.value),p.value&&(e.date_from=p.value),g.value&&(e.date_to=g.value);const s=await ne.getOrders(e);s.success?s.data.data&&Array.isArray(s.data.data)?(d.value=s.data.data,n.value={current_page:s.data.current_page||1,per_page:t>=999999?-1:s.data.per_page||15,total:s.data.total||0,last_page:s.data.last_page||1}):Array.isArray(s.data)?(d.value=s.data,n.value={current_page:1,per_page:t>=999999?-1:s.data.length,total:s.data.length,last_page:1}):(console.warn("Unexpected response structure:",s),d.value=[],n.value={current_page:1,per_page:15,total:0,last_page:1}):(d.value=[],n.value={current_page:1,per_page:15,total:0,last_page:1}),z()}catch(e){console.error("Error loading transactions:",e),d.value=[],n.value={current_page:1,per_page:15,total:0,last_page:1}}finally{T.value=!1}},Y=a=>{V(a,n.value.per_page)},G=async a=>{if(a===-1){const t=n.value.total;if(t>1e3&&!window.confirm(`Anda akan memuat semua ${t} transaksi. Ini mungkin memakan waktu lama. Lanjutkan?`))return;await V(1,999999)}else await V(1,a)},z=()=>{const a=d.value,t=a.reduce((s,P)=>{const F=typeof P.total_amount=="string"?parseFloat(P.total_amount):P.total_amount;return s+(isNaN(F)||!isFinite(F)?0:F)},0),e=a.length>0&&t>0?t/a.length:0;h.value={total_orders:n.value.total,total_revenue:t,average_order:e,pending_orders:a.filter(s=>s.status==="pending").length}},R=a=>{k.value=a,C.value=!0},J=a=>{},Z=a=>{k.value=a,S.value=!0},B=a=>{const t=d.value.findIndex(e=>e.id_order===a.id_order);t!==-1&&(d.value[t]=a),z()},ee=a=>({pending:"warning",preparing:"info",completed:"success",cancelled:"error"})[a]||"default",te=a=>({pending:"Pending",preparing:"Diproses",completed:"Selesai",cancelled:"Dibatalkan"})[a]||a,ae=a=>({cash:"Tunai",card:"Kartu",digital_wallet:"E-Wallet",qris:"QRIS",bank_transfer:"Transfer"})[a]||a,I=a=>{const t=typeof a=="string"?parseFloat(a):a;return isNaN(t)||!isFinite(t)?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t)},le=a=>new Date(a).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}),oe=a=>new Date(a).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),se=()=>{D.value=!1},re=()=>{const a=new Date().toISOString().split("T")[0],t=new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0];p.value=t,g.value=a};ge(()=>{re()}),M(D,a=>{a&&V()});let O=null;return M([f,y,p,g],()=>{O&&clearTimeout(O),O=setTimeout(()=>{V(1,n.value.per_page)},500)}),(a,t)=>(c(),U(ue,{modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=e=>D.value=e),"max-width":"1200",scrollable:""},{default:o(()=>[l(b,{class:"coffee-dialog"},{default:o(()=>[l(ce,{class:"d-flex align-center justify-space-between coffee-header"},{default:o(()=>[r("div",Ve,[l($,{icon:"tabler-history",class:"text-white"}),t[7]||(t[7]=r("div",null,[r("div",{class:"coffee-title"},"Riwayat Transaksi"),r("div",{class:"coffee-subtitle"},"Daftar transaksi dan pembayaran")],-1))]),l(x,{icon:"tabler-x",variant:"text",color:"white",onClick:se})]),_:1}),l(_,{class:"pb-0 px-6"},{default:o(()=>[l(L,null,{default:o(()=>[l(m,{cols:"12",md:"4"},{default:o(()=>[l(N,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),label:"Cari transaksi...",variant:"outlined",density:"compact","prepend-inner-icon":"tabler-search",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),l(m,{cols:"12",md:"2"},{default:o(()=>[l(ye,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value=e),items:W,label:"Status",variant:"outlined",density:"compact",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),l(m,{cols:"12",md:"3"},{default:o(()=>[l(N,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),label:"Dari Tanggal",type:"date",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),l(m,{cols:"12",md:"3"},{default:o(()=>[l(N,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=e=>g.value=e),label:"Sampai Tanggal",type:"date",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(_,{class:"px-6"},{default:o(()=>[l(L,{class:"mb-4"},{default:o(()=>[l(m,{cols:"12",md:"3"},{default:o(()=>[l(b,{variant:"tonal",color:"primary"},{default:o(()=>[l(_,{class:"text-center"},{default:o(()=>[r("h3",be,i(h.value.total_orders),1),t[8]||(t[8]=r("p",{class:"text-body-2 mb-0"},"Total Transaksi",-1))]),_:1,__:[8]})]),_:1})]),_:1}),l(m,{cols:"12",md:"3"},{default:o(()=>[l(b,{variant:"tonal",color:"success"},{default:o(()=>[l(_,{class:"text-center"},{default:o(()=>[r("h3",xe,i(I(h.value.total_revenue)),1),t[9]||(t[9]=r("p",{class:"text-body-2 mb-0"},"Total Pendapatan",-1))]),_:1,__:[9]})]),_:1})]),_:1}),l(m,{cols:"12",md:"3"},{default:o(()=>[l(b,{variant:"tonal",color:"info"},{default:o(()=>[l(_,{class:"text-center"},{default:o(()=>[r("h3",ke,i(I(h.value.average_order)),1),t[10]||(t[10]=r("p",{class:"text-body-2 mb-0"},"Rata-rata per Transaksi",-1))]),_:1,__:[10]})]),_:1})]),_:1}),l(m,{cols:"12",md:"3"},{default:o(()=>[l(b,{variant:"tonal",color:"warning"},{default:o(()=>[l(_,{class:"text-center"},{default:o(()=>[r("h3",De,i(h.value.pending_orders),1),t[11]||(t[11]=r("p",{class:"text-body-2 mb-0"},"Transaksi Pending",-1))]),_:1,__:[11]})]),_:1})]),_:1})]),_:1}),l(he,{headers:K,items:d.value,loading:T.value,"items-per-page":n.value.per_page===-1?d.value.length:n.value.per_page,page:n.value.current_page,"items-length":n.value.total,"server-items-length":n.value.total,"items-per-page-options":X,"show-select":!1,class:"elevation-1","onUpdate:page":Y,"onUpdate:itemsPerPage":G},{"item.order_number":o(({item:e})=>[l(x,{variant:"text",color:"primary",size:"small",onClick:s=>R(e)},{default:o(()=>[w(i(e.order_number),1)]),_:2},1032,["onClick"])]),"item.customer":o(({item:e})=>[e.customer?(c(),v("div",we,[r("div",Te,i(e.customer.name),1),r("div",Ce,i(e.customer.phone),1)])):(c(),v("span",Se,"-"))]),"item.status":o(({item:e})=>[l(A,{color:ee(e.status),size:"small",variant:"tonal"},{default:o(()=>[w(i(te(e.status)),1)]),_:2},1032,["color"])]),"item.total_amount":o(({item:e})=>[r("span",Ie,i(I(e.total_amount)),1)]),"item.payment_method":o(({item:e})=>[e.payments&&e.payments.length>0?(c(),v("div",Oe,[(c(!0),v(ve,null,_e(e.payments,s=>(c(),U(A,{key:s.id_payment,size:"small",variant:"outlined",class:"ma-1"},{default:o(()=>[w(i(ae(s.payment_method)),1)]),_:2},1024))),128))])):(c(),v("span",Pe,"-"))]),"item.created_at":o(({item:e})=>[r("div",null,[r("div",Fe,i(le(e.created_at)),1),r("div",Ue,i(oe(e.created_at)),1)])]),"item.actions":o(({item:e})=>[l(x,{icon:"tabler-eye",variant:"text",size:"small",onClick:s=>R(e)},null,8,["onClick"]),l(x,{icon:"tabler-printer",variant:"text",size:"small",onClick:s=>J(e)},null,8,["onClick"]),e.status==="pending"?(c(),U(x,{key:0,icon:"tabler-edit",variant:"text",size:"small",color:"primary",onClick:s=>Z(e)},null,8,["onClick"])):E("",!0)]),_:1},8,["items","loading","items-per-page","page","items-length","server-items-length"]),n.value.per_page===-1?(c(),v("div",Ne,[l(A,{color:"success",variant:"tonal",size:"large"},{default:o(()=>[l($,{start:"",icon:"tabler-check-circle"}),w(" Menampilkan semua "+i(d.value.length)+" transaksi ",1)]),_:1})])):E("",!0)]),_:1})]),_:1}),l(de,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=e=>C.value=e),order:k.value,onOrderUpdated:B},null,8,["modelValue","order"]),l(ie,{modelValue:S.value,"onUpdate:modelValue":t[5]||(t[5]=e=>S.value=e),order:k.value,onOrderUpdated:B},null,8,["modelValue","order"])]),_:1},8,["modelValue"]))}}),it=fe(Ae,[["__scopeId","data-v-62c75017"]]);export{it as default};
