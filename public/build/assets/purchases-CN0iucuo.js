import{d as st,r as g,D as ot,c as h,e as r,b as t,m as rt,a1 as R,f as a,ax as nt,X as T,au as ut,av as it,j as dt,o as d,s as p,g as I,l as O,t as i,F as H,i as U,as as ct,a5 as mt,_ as pt}from"./main-l8Zi8A50.js";import{C as _t}from"./auto-Cz6uSJnr.js";import{V as v,b as S}from"./VCard-B80elx7E.js";import{V as A,a as c}from"./VRow-DDBVNEM2.js";import{V as f}from"./VCardText-BPi2Iy10.js";import{V as J}from"./VSelect-BaoN9uK2.js";import{V as j}from"./VTextField-BGm3d7HA.js";import{V as C}from"./VChip-Du4c8qsc.js";import{V as K}from"./VDataTable-DUjMRVtp.js";import{V as ht}from"./VDivider-j9GK0eK6.js";import{b as Y}from"./route-block-B_A1xBdJ.js";import"./VAvatar-BMYyudiA.js";import"./VImg-DSOJICNe.js";/* empty css              */import"./forwardRefs-B931MWyl.js";import"./VList-BhQfh3yK.js";import"./VOverlay-nC_It03B.js";import"./VMenu-BQ9xgK0C.js";import"./VCheckboxBtn-DlffD0dx.js";import"./VTable-Eeu4cyAU.js";import"./filter-CtZEku-b.js";const vt={class:"purchase-report-page"},ft={class:"d-flex flex-column flex-md-row justify-space-between align-start align-md-center mb-6 ga-4"},gt={class:"d-flex align-center mb-2"},yt={key:0,class:"text-center py-8"},bt={key:1},xt={class:"text-h5 font-weight-bold text-primary"},wt={class:"text-h5 font-weight-bold text-success"},kt={class:"text-h5 font-weight-bold text-info"},Pt={class:"text-h5 font-weight-bold text-warning"},Tt={key:0},Dt={key:1,class:"text-center py-8"},Vt={class:"d-flex justify-space-between align-center mb-1"},St={class:"d-flex align-center"},At={class:"text-caption"},It={class:"font-weight-bold"},Ct={class:"font-weight-bold text-primary"},Mt={class:"top-items-container"},Et={class:"d-flex justify-space-between align-center"},Nt={class:"d-flex align-center"},Ft={class:"font-weight-medium"},Lt={class:"text-caption text-medium-emphasis"},Rt={class:"text-end"},$t={class:"font-weight-bold text-primary"},Bt={class:"font-weight-bold text-primary"},zt={key:2,class:"text-center py-12"},X=st({__name:"purchases",setup(Ot){const G=dt(),y=g(!1),M=g(!1),s=g(null),b=g("month"),x=g(""),D=g(""),V=g(""),E=g();let N=null;const W=[{title:"Filter per Bulan",value:"month"},{title:"Custom Range",value:"custom"}],m=new Date().getFullYear(),Z=[{title:"Januari",value:`${m}-01`},{title:"Februari",value:`${m}-02`},{title:"Maret",value:`${m}-03`},{title:"April",value:`${m}-04`},{title:"Mei",value:`${m}-05`},{title:"Juni",value:`${m}-06`},{title:"Juli",value:`${m}-07`},{title:"Agustus",value:`${m}-08`},{title:"September",value:`${m}-09`},{title:"Oktober",value:`${m}-10`},{title:"November",value:`${m}-11`},{title:"Desember",value:`${m}-12`}],q=[{title:"Supplier",key:"name",align:"start"},{title:"Total Purchase",key:"total_purchases",align:"center"},{title:"Total Amount",key:"total_amount",align:"end"}],Q=[{title:"Tanggal",key:"date",align:"start"},{title:"Purchase",key:"purchase_count",align:"center"},{title:"Total Amount",key:"total_amount",align:"end"}],w=l=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),$=l=>new Date(l).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),B=l=>({pending:"warning",approved:"info",received:"success",cancelled:"error"})[l.toLowerCase()]||"primary",tt=l=>["warning","success","info","secondary","primary"][l]||"primary",et=()=>{if(b.value==="month"){const l=new Date().toISOString().slice(0,7);x.value=l}P()},P=async()=>{if(!y.value){y.value=!0;try{let l={};if(b.value==="custom")if(D.value&&V.value)l.start_date=D.value,l.end_date=V.value;else{y.value=!1;return}else if(x.value)l.month=x.value;else{y.value=!1;return}const e=await ut.get("/api/reports/purchases",{params:l});e.data.success&&(s.value=e.data.data,await it(),setTimeout(()=>{at()},100))}catch(l){console.error("Error loading purchase report:",l)}finally{y.value=!1}}},at=()=>{if(!E.value||!s.value)return;N&&N.destroy();const l=E.value.getContext("2d");if(!l)return;const e=s.value.daily_purchases.map(u=>$(u.date)),o=s.value.daily_purchases.map(u=>(typeof u.total_amount=="string"?parseFloat(u.total_amount.replace(/[^\d.-]/g,"")):u.total_amount)||0);N=new _t(l,{type:"line",data:{labels:e,datasets:[{label:"Pembelian Harian",data:o,borderColor:"rgb(33, 150, 243)",backgroundColor:"rgba(33, 150, 243, 0.1)",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:function(u){return w(u)}}}}}})},lt=async()=>{if(!s.value){console.warn("No purchase data to export");return}M.value=!0;try{const l=await mt(()=>import("./xlsx-CfQreh1U.js"),[]),e=b.value==="custom"?`${D.value} s/d ${V.value}`:`Bulan ${x.value}`,o=[["LAPORAN PEMBELIAN"],["Periode:",e],["Tanggal Export:",new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})],[],["RINGKASAN PEMBELIAN"],["Total Purchase:",s.value.summary.total_purchases],["Total Amount:",Math.round(parseFloat(s.value.summary.total_amount.replace(/[^\d.-]/g,"")))],["Rata-rata Purchase:",Math.round(parseFloat(s.value.summary.avg_purchase_value.replace(/[^\d.-]/g,"")))],["Purchase Selesai:",s.value.summary.completed_purchases],["Purchase Pending:",s.value.summary.pending_purchases],["Purchase Dibatalkan:",s.value.summary.cancelled_purchases],[]],u=l.utils.book_new(),F=l.utils.aoa_to_sheet(o);if(F["!cols"]=[{wch:20},{wch:25}],l.utils.book_append_sheet(u,F,"Ringkasan"),s.value.daily_purchases&&s.value.daily_purchases.length>0){const k=[["PEMBELIAN HARIAN"],["Periode:",e],[],["Tanggal","Jumlah Purchase","Total Amount","Rata-rata"],...s.value.daily_purchases.map(n=>[new Date(n.date).toLocaleDateString("id-ID"),n.purchase_count,Math.round(typeof n.total_amount=="string"?parseFloat(n.total_amount.replace(/[^\d.-]/g,"")):n.total_amount),Math.round(typeof n.avg_purchase_value=="string"?parseFloat(n.avg_purchase_value.replace(/[^\d.-]/g,"")):n.avg_purchase_value)])],_=l.utils.aoa_to_sheet(k);_["!cols"]=[{wch:15},{wch:15},{wch:20},{wch:20}],l.utils.book_append_sheet(u,_,"Pembelian Harian")}if(s.value.status_breakdown&&s.value.status_breakdown.length>0){const k=[["BREAKDOWN STATUS PEMBELIAN"],["Periode:",e],[],["Status","Jumlah Purchase","Total Amount"],...s.value.status_breakdown.map(n=>[n.status,n.purchase_count,Math.round(typeof n.total_amount=="string"?parseFloat(n.total_amount.replace(/[^\d.-]/g,"")):n.total_amount)])],_=l.utils.aoa_to_sheet(k);_["!cols"]=[{wch:20},{wch:15},{wch:20}],l.utils.book_append_sheet(u,_,"Status Breakdown")}if(s.value.top_items&&s.value.top_items.length>0){const k=[["ITEM PALING BANYAK DIBELI"],["Periode:",e],[],["No","Nama Item","Total Dibeli","Total Amount","Rata-rata Unit Cost"],...s.value.top_items.map((n,L)=>[L+1,n.name,Math.round(parseFloat(n.total_purchased)),Math.round(typeof n.total_amount=="string"?parseFloat(n.total_amount.replace(/[^\d.-]/g,"")):n.total_amount),Math.round(parseFloat(n.avg_unit_cost))])],_=l.utils.aoa_to_sheet(k);_["!cols"]=[{wch:5},{wch:35},{wch:15},{wch:20},{wch:20}],l.utils.book_append_sheet(u,_,"Top Items")}if(s.value.top_suppliers&&s.value.top_suppliers.length>0){const k=[["SUPPLIER TERBAIK"],["Periode:",e],[],["No","Nama Supplier","Jumlah Purchase","Total Amount"],...s.value.top_suppliers.map((n,L)=>[L+1,n.name,n.total_purchases,Math.round(typeof n.total_amount=="string"?parseFloat(n.total_amount.replace(/[^\d.-]/g,"")):n.total_amount)])],_=l.utils.aoa_to_sheet(k);_["!cols"]=[{wch:5},{wch:30},{wch:15},{wch:20}],l.utils.book_append_sheet(u,_,"Top Suppliers")}const z=`laporan-pembelian-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.xlsx`;l.writeFile(u,z),console.log("âœ… Purchase report exported successfully:",z)}catch(l){console.error("Error exporting purchase report:",l)}finally{M.value=!1}};return ot(()=>{const l=new Date,e=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`;x.value=e,P()}),(l,e)=>(d(),h("div",vt,[r("div",ft,[r("div",null,[r("div",gt,[t(R,{icon:"mdi-arrow-left",variant:"text",size:"small",onClick:e[0]||(e[0]=o=>rt(G).back()),class:"me-2"}),e[5]||(e[5]=r("h1",{class:"text-h4 font-weight-bold"},"Laporan Pembelian",-1))]),e[6]||(e[6]=r("p",{class:"text-body-1 text-medium-emphasis"}," Analisis lengkap pembelian dan performa supplier ",-1))]),t(R,{color:"primary","prepend-icon":"mdi-file-excel",onClick:lt,loading:M.value},{default:a(()=>e[7]||(e[7]=[p(" Export Excel ")])),_:1,__:[7]},8,["loading"])]),t(v,{class:"mb-6"},{default:a(()=>[t(f,null,{default:a(()=>[t(A,null,{default:a(()=>[t(c,{cols:"12",md:"4"},{default:a(()=>[t(J,{modelValue:b.value,"onUpdate:modelValue":[e[1]||(e[1]=o=>b.value=o),et],items:W,label:"Pilih Periode",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),b.value==="custom"?(d(),I(c,{key:0,cols:"12",md:"3"},{default:a(()=>[t(j,{modelValue:D.value,"onUpdate:modelValue":[e[2]||(e[2]=o=>D.value=o),P],type:"date",label:"Tanggal Mulai",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})):O("",!0),b.value==="custom"?(d(),I(c,{key:1,cols:"12",md:"3"},{default:a(()=>[t(j,{modelValue:V.value,"onUpdate:modelValue":[e[3]||(e[3]=o=>V.value=o),P],type:"date",label:"Tanggal Akhir",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})):(d(),I(c,{key:2,cols:"12",md:"3"},{default:a(()=>[t(J,{modelValue:x.value,"onUpdate:modelValue":[e[4]||(e[4]=o=>x.value=o),P],items:Z,label:"Pilih Bulan",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})),t(c,{cols:"12",md:"2"},{default:a(()=>[t(R,{color:"primary",block:"",onClick:P,loading:y.value},{default:a(()=>e[8]||(e[8]=[p(" Refresh ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),y.value?(d(),h("div",yt,[t(nt,{indeterminate:"",color:"primary",size:"64"}),e[9]||(e[9]=r("p",{class:"text-body-1 mt-4"},"Memuat data laporan...",-1))])):s.value?(d(),h("div",bt,[t(A,{class:"mb-6"},{default:a(()=>[t(c,{cols:"6",md:"3"},{default:a(()=>[t(v,null,{default:a(()=>[t(f,{class:"text-center"},{default:a(()=>[t(T,{icon:"mdi-currency-usd",size:"32",class:"text-primary mb-2"}),r("div",xt,i(w(s.value.summary.total_amount)),1),e[10]||(e[10]=r("div",{class:"text-body-2 text-medium-emphasis"},"Total Pembelian",-1))]),_:1,__:[10]})]),_:1})]),_:1}),t(c,{cols:"6",md:"3"},{default:a(()=>[t(v,null,{default:a(()=>[t(f,{class:"text-center"},{default:a(()=>[t(T,{icon:"mdi-cart",size:"32",class:"text-success mb-2"}),r("div",wt,i(s.value.summary.total_purchases),1),e[11]||(e[11]=r("div",{class:"text-body-2 text-medium-emphasis"},"Total Purchase",-1))]),_:1,__:[11]})]),_:1})]),_:1}),t(c,{cols:"6",md:"3"},{default:a(()=>[t(v,null,{default:a(()=>[t(f,{class:"text-center"},{default:a(()=>[t(T,{icon:"mdi-package",size:"32",class:"text-info mb-2"}),r("div",kt,i(s.value.summary.total_items),1),e[12]||(e[12]=r("div",{class:"text-body-2 text-medium-emphasis"},"Total Item",-1))]),_:1,__:[12]})]),_:1})]),_:1}),t(c,{cols:"6",md:"3"},{default:a(()=>[t(v,null,{default:a(()=>[t(f,{class:"text-center"},{default:a(()=>[t(T,{icon:"mdi-calculator",size:"32",class:"text-warning mb-2"}),r("div",Pt,i(w(s.value.summary.average_purchase)),1),e[13]||(e[13]=r("div",{class:"text-body-2 text-medium-emphasis"},"Rata-rata Purchase",-1))]),_:1,__:[13]})]),_:1})]),_:1})]),_:1}),t(A,{class:"mb-6"},{default:a(()=>[t(c,{cols:"12",md:"8"},{default:a(()=>[t(v,null,{default:a(()=>[t(S,null,{default:a(()=>e[14]||(e[14]=[p("Trend Pembelian Harian")])),_:1,__:[14]}),t(f,null,{default:a(()=>[s.value&&s.value.daily_purchases&&s.value.daily_purchases.length>0?(d(),h("div",Tt,[r("canvas",{ref_key:"dailyPurchaseChart",ref:E,class:"w-100",style:{"max-height":"300px"}},null,512)])):(d(),h("div",Dt,[t(T,{icon:"mdi-chart-line",size:"48",class:"text-medium-emphasis mb-2"}),e[15]||(e[15]=r("p",{class:"text-body-2 text-medium-emphasis"},"Tidak ada data pembelian harian",-1))]))]),_:1})]),_:1})]),_:1}),t(c,{cols:"12",md:"4"},{default:a(()=>[t(v,null,{default:a(()=>[t(S,null,{default:a(()=>e[16]||(e[16]=[p("Status Pembelian")])),_:1,__:[16]}),t(f,null,{default:a(()=>[(d(!0),h(H,null,U(s.value.status_breakdown,o=>(d(),h("div",{key:o.status,class:"mb-3"},[r("div",Vt,[r("div",St,[t(C,{color:B(o.status),size:"small",variant:"tonal",class:"me-2"},{default:a(()=>[p(i(o.status),1)]),_:2},1032,["color"]),r("span",At,i(o.count)+" purchase",1)]),r("span",It,i(w(o.total_amount)),1)]),t(ct,{"model-value":o.total_amount/s.value.summary.total_amount*100,color:B(o.status),height:"4",rounded:""},null,8,["model-value","color"])]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),t(A,{class:"mb-6"},{default:a(()=>[t(c,{cols:"12",md:"6"},{default:a(()=>[t(v,null,{default:a(()=>[t(S,null,{default:a(()=>e[17]||(e[17]=[p("Top Supplier")])),_:1,__:[17]}),t(f,null,{default:a(()=>[t(K,{headers:q,items:s.value.top_suppliers,"items-per-page":5,class:"elevation-0","no-data-text":"Tidak ada data supplier"},{"item.total_purchases":a(({item:o})=>[t(C,{size:"small",color:"primary",variant:"tonal"},{default:a(()=>[p(i(o.total_purchases),1)]),_:2},1024)]),"item.total_amount":a(({item:o})=>[r("span",Ct,i(w(o.total_amount)),1)]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),t(c,{cols:"12",md:"6"},{default:a(()=>[t(v,null,{default:a(()=>[t(S,null,{default:a(()=>e[18]||(e[18]=[p("Top Item Dibeli")])),_:1,__:[18]}),t(f,null,{default:a(()=>[r("div",Mt,[(d(!0),h(H,null,U(s.value.top_items,(o,u)=>(d(),h("div",{key:o.id,class:"mb-3"},[r("div",Et,[r("div",Nt,[t(C,{color:tt(u),size:"small",class:"me-2"},{default:a(()=>[p(i(u+1),1)]),_:2},1032,["color"]),r("div",null,[r("div",Ft,i(o.name),1),r("div",Lt,i(o.total_purchased)+" dibeli ",1)])]),r("div",Rt,[r("div",$t,i(w(o.total_amount)),1)])]),u<s.value.top_items.length-1?(d(),I(ht,{key:0,class:"mt-3"})):O("",!0)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),t(A,null,{default:a(()=>[t(c,{cols:"12"},{default:a(()=>[t(v,null,{default:a(()=>[t(S,null,{default:a(()=>e[19]||(e[19]=[p("Pembelian per Hari")])),_:1,__:[19]}),t(f,null,{default:a(()=>[t(K,{headers:Q,items:s.value.daily_purchases,"items-per-page":10,class:"elevation-0","no-data-text":"Tidak ada data pembelian"},{"item.date":a(({item:o})=>[p(i($(o.date)),1)]),"item.purchase_count":a(({item:o})=>[t(C,{size:"small",color:"info",variant:"tonal"},{default:a(()=>[p(i(o.purchase_count),1)]),_:2},1024)]),"item.total_amount":a(({item:o})=>[r("span",Bt,i(w(o.total_amount)),1)]),_:1},8,["items"])]),_:1})]),_:1})]),_:1})]),_:1})])):(d(),h("div",zt,[t(T,{icon:"mdi-cart-variant",size:"64",class:"text-medium-emphasis mb-4"}),e[20]||(e[20]=r("h3",{class:"text-h6 mb-2"},"Tidak ada data laporan",-1)),e[21]||(e[21]=r("p",{class:"text-body-2 text-medium-emphasis"}," Silakan pilih periode yang berbeda atau periksa kembali filter Anda ",-1))]))]))}});typeof Y=="function"&&Y(X);const de=pt(X,[["__scopeId","data-v-557d0506"]]);export{de as default};
