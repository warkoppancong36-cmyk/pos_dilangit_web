import{b as se,c as te,g as le,h as ie,d as re,i as ue}from"./VTextField-CqW65gYl.js";import{f as ce}from"./forwardRefs-B931MWyl.js";import{a6 as ve,a7 as de,ae as fe,b5 as ge,bf as oe,V as v,co as ne,r as n,W as me,b0 as pe,w as he,a8 as Ce,c5 as Ee,b as h,p as W,F as Y,av as ye,c2 as Se,ab as De}from"./main-CF0p_HVp.js";import{V as be}from"./VChip-CjuOE0So.js";import{C as g}from"./CategoriesApi-CuGX_4_M.js";const ke=de({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:a=>typeof a=="boolean"||[1e3,1024].includes(Number(a))},...re({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:a=>a.multiple?[]:null,validator:a=>oe(a).every(m=>m!=null&&typeof m=="object")},...ie({clearable:!0})},"VFileInput"),Ve=ve()({name:"VFileInput",inheritAttrs:!1,props:ke(),emits:{"click:control":a=>!0,"mousedown:control":a=>!0,"update:focused":a=>!0,"update:modelValue":a=>!0},setup(a,m){let{attrs:k,emit:R,slots:r}=m;const{t:V}=fe(),s=ge(a,"modelValue",a.modelValue,e=>oe(e),e=>!a.multiple&&Array.isArray(e)?e[0]:e),{isFocused:D,focus:A,blur:C}=se(a),E=v(()=>typeof a.showSize!="boolean"?a.showSize:void 0),y=v(()=>(s.value??[]).reduce((e,o)=>{let{size:S=0}=o;return e+S},0)),F=v(()=>ne(y.value,E.value)),I=v(()=>(s.value??[]).map(e=>{const{name:o="",size:S=0}=e;return a.showSize?`${o} (${ne(S,E.value)})`:o})),z=v(()=>{var o;const e=((o=s.value)==null?void 0:o.length)??0;return a.showSize?V(a.counterSizeString,e,F.value):V(a.counterString,e)}),B=n(),b=n(),i=n(),T=me(()=>D.value||a.active),p=v(()=>["plain","underlined"].includes(a.variant)),d=pe(!1);function M(){var e;i.value!==document.activeElement&&((e=i.value)==null||e.focus()),D.value||A()}function j(e){var o;(o=i.value)==null||o.click()}function N(e){R("mousedown:control",e)}function O(e){var o;(o=i.value)==null||o.click(),R("click:control",e)}function $(e){e.stopPropagation(),M(),ye(()=>{s.value=[],Se(a["onClick:clear"],e)})}function G(e){e.preventDefault(),e.stopImmediatePropagation(),d.value=!0}function x(e){e.preventDefault(),d.value=!1}function f(e){var S,_;if(e.preventDefault(),e.stopImmediatePropagation(),d.value=!1,!((_=(S=e.dataTransfer)==null?void 0:S.files)!=null&&_.length)||!i.value)return;const o=new DataTransfer;for(const H of e.dataTransfer.files)o.items.add(H);i.value.files=o.files,i.value.dispatchEvent(new Event("change",{bubbles:!0}))}return he(s,e=>{(!Array.isArray(e)||!e.length)&&i.value&&(i.value.value="")}),Ce(()=>{const e=!!(r.counter||a.counter),o=!!(e||r.details),[S,_]=Ee(k),{modelValue:H,...Z}=te.filterProps(a),J=le.filterProps(a);return h(te,W({ref:B,modelValue:a.multiple?s.value:s.value[0],class:["v-file-input",{"v-file-input--chips":!!a.chips,"v-file-input--dragging":d.value,"v-file-input--hide":a.hideInput,"v-input--plain-underlined":p.value},a.class],style:a.style,"onClick:prepend":j},S,Z,{centerAffix:!p.value,focused:D.value}),{...r,default:L=>{let{id:U,isDisabled:P,isDirty:K,isReadonly:q,isValid:X}=L;return h(le,W({ref:b,"prepend-icon":a.prependIcon,onMousedown:N,onClick:O,"onClick:clear":$,"onClick:prependInner":a["onClick:prependInner"],"onClick:appendInner":a["onClick:appendInner"]},J,{id:U.value,active:T.value||K.value,dirty:K.value||a.dirty,disabled:P.value,focused:D.value,error:X.value===!1,onDragover:G,onDrop:f}),{...r,default:ee=>{var u;let{props:{class:t,...l}}=ee;return h(Y,null,[h("input",W({ref:i,type:"file",readonly:q.value,disabled:P.value,multiple:a.multiple,name:a.name,onClick:c=>{c.stopPropagation(),q.value&&c.preventDefault(),M()},onChange:c=>{if(!c.target)return;const Q=c.target;s.value=[...Q.files??[]]},onDragleave:x,onFocus:M,onBlur:C},l,_),null),h("div",{class:t},[!!((u=s.value)!=null&&u.length)&&!a.hideInput&&(r.selection?r.selection({fileNames:I.value,totalBytes:y.value,totalBytesReadable:F.value}):a.chips?I.value.map(c=>h(be,{key:c,size:"small",text:c},null)):I.value.join(", "))])])}})},details:o?L=>{var U,P;return h(Y,null,[(U=r.details)==null?void 0:U.call(r,L),e&&h(Y,null,[h("span",null,null),h(ue,{active:!!((P=s.value)!=null&&P.length),value:z.value,disabled:a.disabled},r.counter)])])}:void 0})}),ce({},B,b,i)}}),w={SUCCESS:{CREATED:"Kategori berhasil ditambahkan",UPDATED:"Kategori berhasil diperbarui",DELETED:"Kategori berhasil dihapus",ACTIVATED:"Status kategori berhasil diaktifkan",DEACTIVATED:"Status kategori berhasil dinonaktifkan"},ERROR:{FETCH:"Terjadi kesalahan saat mengambil data kategori",SAVE:"Terjadi kesalahan saat menyimpan kategori",DELETE:"Terjadi kesalahan saat menghapus kategori",TOGGLE:"Terjadi kesalahan saat mengubah status kategori",IMAGE_TYPE:"File harus berupa gambar",IMAGE_SIZE:"Ukuran file maksimal 2MB",REQUIRED_NAME:"Nama kategori wajib diisi"}},Pe=()=>{const a=De(),m=n([]),k=n(!1),R=n(!1),r=n(!1),V=n({}),s=n(!1),D=n(!1),A=n(!1),C=n(null),E=n({name:"",description:"",image:null,active:!0}),y=n(null),F=n(""),I=n("all"),z=n(10),B=n("grid"),b=n(1),i=n({current_page:1,last_page:1,per_page:10,total:0}),T=n(""),p=n(""),d=n(""),M=v(()=>{var t,l,u,c;return((l=(t=a.user)==null?void 0:t.role)==null?void 0:l.name)==="admin"||((c=(u=a.user)==null?void 0:u.role)==null?void 0:c.name)==="manager"}),j=v(()=>s.value),N=v(()=>i.value.last_page),O=v(()=>m.value.length),$=v(()=>m.value.filter(t=>t.active).length),G=v(()=>m.value.filter(t=>!t.active).length),x=v(()=>i.value.total),f=()=>{setTimeout(()=>{T.value="",p.value=""},5e3)},e=async()=>{var t;k.value=!0;try{const l={page:b.value,per_page:z.value,search:((t=F.value)==null?void 0:t.trim())||void 0,status:I.value!=="all"?I.value:void 0},u=await g.getCategories(l);u.success?(m.value=u.data,i.value=u.pagination):(p.value=u.message||w.ERROR.FETCH,f())}catch(l){p.value=g.handleError(l),f()}finally{k.value=!1}};return{categories:m,loading:k,saveLoading:R,deleteLoading:r,toggleLoading:V,dialog:s,deleteDialog:D,editMode:A,selectedCategory:C,formData:E,imagePreview:y,search:F,statusFilter:I,perPage:z,viewMode:B,currentPage:b,pagination:i,successMessage:T,errorMessage:p,modalErrorMessage:d,canCreateEdit:M,isDialogOpen:j,totalPages:N,totalCategories:O,activeCategories:$,inactiveCategories:G,totalData:x,fetchCategories:e,fetchAllCategories:async()=>{try{k.value=!0;const t={page:1,per_page:100,status:"active"},l=await g.getCategories(t);l.success?(m.value=l.data,l.pagination&&(i.value=l.pagination)):(p.value=l.message||w.ERROR.FETCH,f())}catch(t){p.value=g.handleError(t),f()}finally{k.value=!1}},handleImageUpload:t=>{const l=t[0];if(l){const u=g.validateImage(l);if(!u.valid){d.value=u.error;return}E.value.image=l;const c=new FileReader;c.onload=Q=>{var ae;y.value=(ae=Q.target)==null?void 0:ae.result},c.readAsDataURL(l)}},removeImage:()=>{E.value.image=null,y.value=null;const t=document.querySelector('input[type="file"]');t&&(t.value="")},saveCategory:async t=>{R.value=!0,d.value="";try{const l=t||E.value;(A.value&&C.value?await g.updateCategory(C.value.id_category,l):await g.createCategory(l)).success&&(await e(),s.value=!1,T.value=A.value?w.SUCCESS.UPDATED:w.SUCCESS.CREATED,f())}catch(l){d.value=g.handleError(l)}finally{R.value=!1}},deleteCategory:t=>{C.value=t,D.value=!0},confirmDelete:async()=>{if(C.value){r.value=!0;try{(await g.deleteCategory(C.value.id_category)).success&&(await e(),D.value=!1,T.value=w.SUCCESS.DELETED,f())}catch(t){p.value=g.handleError(t),f()}finally{r.value=!1}}},toggleActiveStatus:async t=>{V.value[t.id_category]=!0;try{(await g.toggleActiveStatus(t.id_category)).success&&(await e(),T.value=t.active?w.SUCCESS.DEACTIVATED:w.SUCCESS.ACTIVATED,f())}catch(l){p.value=g.handleError(l),f()}finally{V.value[t.id_category]=!1}},openCreateDialog:()=>{A.value=!1,d.value="",E.value={name:"",description:"",image:null,active:!0},y.value=null,s.value=!0},openEditDialog:t=>{A.value=!0,C.value=t,d.value="",E.value={name:t.name,description:t.description||"",image:null,active:t.active},y.value=t.image?t.image_url||`/storage/categories/${t.image}`:null,s.value=!0},closeDialog:()=>{s.value=!1,d.value="",y.value=null},onPageChange:t=>{b.value=t,e()},onSearch:()=>{b.value=1,e()},onFilterChange:()=>{b.value=1,e()},clearMessages:f}};export{Ve as V,Pe as u};
