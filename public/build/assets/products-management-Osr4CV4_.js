import{D as St}from"./DeleteConfirmationDialog-D5jBxQV4.js";import{f as Ae}from"./formatters-BD6tdLx_.js";import{P as rt,u as Mt}from"./useProductItems-Cyemv03p.js";import{I as Kt}from"./ItemsApi-DH48vP9T.js";import{u as _t,H as Bt}from"./HPPBreakdownDialog-BgPNNlZj.js";import{V as Le}from"./VDialog-Xtnr8Lep.js";import{V as Z,b as xe,c as Ee}from"./VCard-VRKN42a8.js";import{a8 as Ft,a9 as Et,af as Rt,r as T,aH as ot,ag as qt,aN as wt,bi as Lt,V as ve,W as Nt,w as he,bt as Vt,b8 as ft,aa as Ot,b as e,p as we,bd as jt,cv as Jt,c8 as Pt,bg as Wt,F as ze,X as V,cm as Gt,c9 as Qt,aJ as Xt,s as u,d as Re,D as at,c as X,f as t,e as l,t as n,a0 as R,g as E,l as j,m as B,aw as dt,i as Je,v as We,o as f,ax as gt,$ as kt,j as It,cw as Zt,aR as Yt,ay as qe,ap as ea,aq as ta,a5 as mt}from"./main-CZcwCq2A.js";import{V as ae}from"./VCardText-DzUTjxq1.js";import{V as Pe}from"./VAvatar-BbKgxYq2.js";import{V as de}from"./VChip-B31-cFI4.js";import{V as Ve,a as S}from"./VRow-BB9Qagf4.js";import{V as yt}from"./VAutocomplete-DB2_UI2g.js";import{e as aa,t as st,V as ct,a as je,b as et,d as it}from"./VList-CTLcdq0w.js";import{u as la,V as be,m as oa}from"./VTextField-Bvm9lZm4.js";import{V as Ye}from"./VSwitch-BpoLfoNh.js";import{a as ut,V as Ke}from"./VAlert-DIu0Fd8I.js";import{V as Ne}from"./VSpacer-sLc4wLMc.js";import{V as tt}from"./VSnackbar-Dvr6hg5A.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as sa,m as ia,a as na,V as Be}from"./VSelect-6RgSElTF.js";import{V as ra}from"./VCheckbox-Y7YhDD0_.js";import{V as Ue}from"./VDivider-Dq1xcEti.js";import{V as ua}from"./VContainer-DAFIY5S3.js";import{a as Dt,u as da,P as ca}from"./useProducts-VOLZ_i22.js";import{V as bt}from"./VForm-zOcARJKp.js";import{V as Ct}from"./VTextarea-BNfScnPD.js";import{V as Me}from"./VTooltip-BJiRpo72.js";import{m as ma,V as va}from"./VImg-CZiu-0Tn.js";import{V as pa,u as fa}from"./useCategories-DgpfiprV.js";import{u as ga,m as _a,h as ka}from"./filter-C2q_maaW.js";import{f as ya}from"./forwardRefs-B931MWyl.js";import{V as ba}from"./VMenu-CbT1ZBp4.js";import{V as ha}from"./VCheckboxBtn-C1Q7S_mX.js";import{V as xa}from"./VDataTableServer-6vFOI8Xk.js";import{V as wa}from"./VSkeletonLoader-Kv1hTD8l.js";import{V as Va}from"./VDataTable-BtTiFNkt.js";import{V as Pa,a as Ca,b as vt,c as pt}from"./VTabs-CqnRj3d_.js";import"./ProductsApi-Cxum_lCa.js";import"./api-ULoQvb4X.js";import"./index-D-EbNoF1.js";import"./VOverlay-BnNPRBSW.js";/* empty css              */import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-DBfgLhyn.js";import"./VTable-BqGA11K6.js";const $a=Et({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,..._a({filterKeys:["title"]}),...ia({hideNoData:!0,returnObject:!0}),...jt(oa({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...ma({transition:!1})},"VCombobox"),Sa=Ft()({name:"VCombobox",props:$a(),emits:{"update:focused":D=>!0,"update:modelValue":D=>!0,"update:search":D=>!0,"update:menu":D=>!0},setup(D,ke){var r;let{emit:K,slots:H}=ke;const{t:O}=Rt(),k=T(),W=ot(!1),A=ot(!0),g=ot(!1),_=T(),Y=T(),y=ot(-1);let Q=!1;const{items:me,transformIn:pe,transformOut:I}=aa(D),{textColorClasses:ue,textColorStyles:ce}=qt(()=>{var a;return(a=k.value)==null?void 0:a.color}),N=wt(D,"modelValue",[],a=>pe(Lt(a)),a=>{const p=I(a);return D.multiple?p:p[0]??null}),oe=la(D),x=ve(()=>!!(D.chips||H.chip)),d=ve(()=>x.value||!!H.selection),w=ot(!D.multiple&&!d.value?((r=N.value[0])==null?void 0:r.title)??"":""),m=ve({get:()=>w.value,set:a=>{var p;if(w.value=a??"",!D.multiple&&!d.value&&(N.value=[st(D,a)]),a&&D.multiple&&((p=D.delimiters)!=null&&p.length)){const F=a.split(new RegExp(`(?:${D.delimiters.join("|")})+`));F.length>1&&(F.forEach(M=>{M=M.trim(),M&&Ce(st(D,M))}),w.value="")}a||(y.value=-1),A.value=!a}}),h=ve(()=>typeof D.counterValue=="function"?D.counterValue(N.value):typeof D.counterValue=="number"?D.counterValue:D.multiple?N.value.length:m.value.length),{filteredItems:i,getMatches:v}=ga(D,me,()=>A.value?"":m.value),U=ve(()=>D.hideSelected?i.value.filter(a=>!N.value.some(p=>p.value===a.value)):i.value),ee=ve(()=>D.hideNoData&&!U.value.length||oe.isReadonly.value||oe.isDisabled.value),le=wt(D,"menu"),ie=ve({get:()=>le.value,set:a=>{var p;le.value&&!a&&((p=_.value)!=null&&p.Î¨openChildren.size)||a&&ee.value||(le.value=a)}}),q=Nt(()=>ie.value?D.closeText:D.openText);he(w,a=>{Q?ft(()=>Q=!1):W.value&&!ie.value&&(ie.value=!0),K("update:search",a)}),he(N,a=>{var p;!D.multiple&&!d.value&&(w.value=((p=a[0])==null?void 0:p.title)??"")});const z=ve(()=>N.value.map(a=>a.value)),c=ve(()=>{var p;return(D.autoSelectFirst===!0||D.autoSelectFirst==="exact"&&m.value===((p=U.value[0])==null?void 0:p.title))&&U.value.length>0&&!A.value&&!g.value}),o=T(),s=sa(o,k);function P(a){Q=!0,D.openOnClear&&(ie.value=!0)}function fe(){ee.value||(ie.value=!0)}function J(a){ee.value||(W.value&&(a.preventDefault(),a.stopPropagation()),ie.value=!ie.value)}function _e(a){var p;a.key!==" "&&Pt(a)&&((p=k.value)==null||p.focus())}function De(a){var M,$,b,L;if(Jt(a)||oe.isReadonly.value)return;const p=(M=k.value)==null?void 0:M.selectionStart,F=N.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(a.key)&&a.preventDefault(),["Enter","ArrowDown"].includes(a.key)&&(ie.value=!0),["Escape"].includes(a.key)&&(ie.value=!1),["Enter","Escape","Tab"].includes(a.key)&&(c.value&&["Enter","Tab"].includes(a.key)&&!N.value.some(C=>{let{value:ne}=C;return ne===U.value[0].value})&&Ce(i.value[0]),A.value=!0),a.key==="ArrowDown"&&c.value&&(($=o.value)==null||$.focus("next")),a.key==="Enter"&&m.value&&(Ce(st(D,m.value)),d.value&&(w.value="")),["Backspace","Delete"].includes(a.key)){if(!D.multiple&&d.value&&N.value.length>0&&!m.value)return Ce(N.value[0],!1);if(~y.value){a.preventDefault();const C=y.value;Ce(N.value[y.value],!1),y.value=C>=F-1?F-2:C}else a.key==="Backspace"&&!m.value&&(y.value=F-1);return}if(D.multiple)if(a.key==="ArrowLeft"){if(y.value<0&&p&&p>0)return;const C=y.value>-1?y.value-1:F-1;N.value[C]?y.value=C:(y.value=-1,(b=k.value)==null||b.setSelectionRange(m.value.length,m.value.length))}else if(a.key==="ArrowRight"){if(y.value<0)return;const C=y.value+1;N.value[C]?y.value=C:(y.value=-1,(L=k.value)==null||L.setSelectionRange(0,0))}else~y.value&&Pt(a)&&(y.value=-1)}function te(){var a;D.eager&&((a=Y.value)==null||a.calculateVisibleItems())}function He(){var a;W.value&&(A.value=!0,(a=k.value)==null||a.focus())}function Ce(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!a||a.props.disabled))if(D.multiple){const F=N.value.findIndex($=>(D.valueComparator||Vt)($.value,a.value)),M=p??!~F;if(~F){const $=M?[...N.value,a]:[...N.value];$.splice(F,1),N.value=$}else M&&(N.value=[...N.value,a]);D.clearOnSelect&&(m.value="")}else{const F=p!==!1;N.value=F?[a]:[],w.value=F&&!d.value?a.title:"",ft(()=>{ie.value=!1,A.value=!0})}}function Ge(a){W.value=!0,setTimeout(()=>{g.value=!0})}function Qe(a){g.value=!1}function Fe(a){(a==null||a===""&&!D.multiple&&!d.value)&&(N.value=[])}return he(W,(a,p)=>{if(!(a||a===p)&&(y.value=-1,ie.value=!1,m.value)){if(D.multiple){Ce(st(D,m.value));return}if(!d.value)return;N.value.some(F=>{let{title:M}=F;return M===m.value})?w.value="":Ce(st(D,m.value))}}),he(ie,()=>{if(!D.hideSelected&&ie.value&&N.value.length){const a=U.value.findIndex(p=>N.value.some(F=>(D.valueComparator||Vt)(F.value,p.value)));Wt&&window.requestAnimationFrame(()=>{var p;a>=0&&((p=Y.value)==null||p.scrollToIndex(a))})}}),he(()=>D.items,(a,p)=>{ie.value||W.value&&!p.length&&a.length&&(ie.value=!0)}),Ot(()=>{const a=!!(!D.hideNoData||U.value.length||H["prepend-item"]||H["append-item"]||H["no-data"]),p=N.value.length>0,F=be.filterProps(D);return e(be,we({ref:k},F,{modelValue:m.value,"onUpdate:modelValue":[M=>m.value=M,Fe],focused:W.value,"onUpdate:focused":M=>W.value=M,validationValue:N.externalValue,counterValue:h.value,dirty:p,class:["v-combobox",{"v-combobox--active-menu":ie.value,"v-combobox--chips":!!D.chips,"v-combobox--selection-slot":!!d.value,"v-combobox--selecting-index":y.value>-1,[`v-combobox--${D.multiple?"multiple":"single"}`]:!0},D.class],style:D.style,readonly:oe.isReadonly.value,placeholder:p?void 0:D.placeholder,"onClick:clear":P,"onMousedown:control":fe,onKeydown:De}),{...H,default:()=>e(ze,null,[e(ba,we({ref:_,modelValue:ie.value,"onUpdate:modelValue":M=>ie.value=M,activator:"parent",contentClass:"v-combobox__content",disabled:ee.value,eager:D.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:D.transition,onAfterEnter:te,onAfterLeave:He},D.menuProps),{default:()=>[a&&e(ct,we({ref:o,selected:z.value,selectStrategy:D.multiple?"independent":"single-independent",onMousedown:M=>M.preventDefault(),onKeydown:_e,onFocusin:Ge,onFocusout:Qe,tabindex:"-1","aria-live":"polite",color:D.itemColor??D.color},s,D.listProps),{default:()=>{var M,$,b;return[(M=H["prepend-item"])==null?void 0:M.call(H),!U.value.length&&!D.hideNoData&&((($=H["no-data"])==null?void 0:$.call(H))??e(je,{key:"no-data",title:O(D.noDataText)},null)),e(na,{ref:Y,renderless:!0,items:U.value,itemKey:"value"},{default:L=>{var se;let{item:C,index:ne,itemRef:re}=L;const ye=we(C.props,{ref:re,key:C.value,active:c.value&&ne===0?!0:void 0,onClick:()=>Ce(C,null)});return((se=H.item)==null?void 0:se.call(H,{item:C,index:ne,props:ye}))??e(je,we(ye,{role:"option"}),{prepend:$e=>{let{isSelected:Se}=$e;return e(ze,null,[D.multiple&&!D.hideSelected?e(ha,{key:C.value,modelValue:Se,ripple:!1,tabindex:"-1"},null):void 0,C.props.prependAvatar&&e(Pe,{image:C.props.prependAvatar},null),C.props.prependIcon&&e(V,{icon:C.props.prependIcon},null)])},title:()=>{var $e;return A.value?C.title:ka("v-combobox",C.title,($e=v(C))==null?void 0:$e.title)}})}}),(b=H["append-item"])==null?void 0:b.call(H)]}})]}),N.value.map((M,$)=>{function b(re){re.stopPropagation(),re.preventDefault(),Ce(M,!1)}const L={"onClick:close":b,onKeydown(re){re.key!=="Enter"&&re.key!==" "||(re.preventDefault(),re.stopPropagation(),b(re))},onMousedown(re){re.preventDefault(),re.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},C=x.value?!!H.chip:!!H.selection,ne=C?Qt(x.value?H.chip({item:M,index:$,props:L}):H.selection({item:M,index:$})):void 0;if(!(C&&!ne))return e("div",{key:M.value,class:["v-combobox__selection",$===y.value&&["v-combobox__selection--selected",ue.value]],style:$===y.value?ce.value:{}},[x.value?H.chip?e(Xt,{key:"chip-defaults",defaults:{VChip:{closable:D.closableChips,size:"small",text:M.title}}},{default:()=>[ne]}):e(de,we({key:"chip",closable:D.closableChips,size:"small",text:M.title,disabled:M.props.disabled},L),null):ne??e("span",{class:"v-combobox__selection-text"},[M.title,D.multiple&&$<N.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[u(",")])])])})]),"append-inner":function(){var L,C;for(var M=arguments.length,$=new Array(M),b=0;b<M;b++)$[b]=arguments[b];return e(ze,null,[(L=H["append-inner"])==null?void 0:L.call(H,...$),(!D.hideNoData||D.items.length)&&D.menuIcon?e(V,{class:"v-combobox__menu-icon",color:(C=k.value)==null?void 0:C.fieldIconColor,icon:D.menuIcon,onMousedown:J,onClick:Gt,"aria-label":O(q.value),title:O(q.value),tabindex:"-1"},null):void 0])}})}),ya({isFocused:W,isPristine:A,menu:ie,search:m,selectionIndex:y,filteredItems:i,select:Ce},k)}}),Ia={class:"d-flex align-center gap-3"},Da={class:"text-body-2 ma-0 opacity-90"},za={class:"d-flex align-center gap-4"},Ua={class:"flex-grow-1"},Ta={class:"text-h6 font-weight-bold mb-1"},Aa={class:"text-body-2 text-medium-emphasis mb-1"},Ha={class:"d-flex align-center gap-4 mb-0"},Ma={class:"text-body-2 text-medium-emphasis mb-0"},Ka={class:"text-body-2 text-info mb-0 font-weight-medium"},Ba={key:0,class:"text-body-2 text-success mb-0 font-weight-medium"},Fa={class:"text-body-1 font-weight-bold"},Ea={class:"text-body-1 font-weight-bold"},Ra={class:"text-body-1 font-weight-bold"},qa={class:"text-body-1 font-weight-bold"},La={class:"d-flex align-center justify-space-between w-100"},Na={class:"d-flex align-center"},Oa={key:0,class:"text-warning"},ja={key:1},Ja={key:0,class:"text-center pa-8"},Wa={class:"d-flex align-center gap-4 mt-1"},Ga={key:1,class:"text-primary"},Qa={class:"d-flex gap-2"},Xa=Re({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup(D,{emit:ke}){const K=D,H=ke,O=ve({get:()=>K.modelValue,set:r=>H("update:modelValue",r)}),k=T(!1),W=T([]),A=T(!1),g=T(!1),_=T(""),Y=T(""),y=T(!1),Q=T(-1),me=T(!1),{loading:pe,currentHPPBreakdown:I,getProductHPPBreakdown:ue}=_t(),ce=ve(()=>{var r,a,p;return((r=I.value)==null?void 0:r.total_hpp)||((a=K.product)==null?void 0:a.hpp)||((p=K.product)==null?void 0:p.cost)||0}),N=ve(()=>{var p;const r=((p=K.product)==null?void 0:p.price)||0,a=ce.value;return r-a}),oe=ve(()=>{var p;const r=((p=K.product)==null?void 0:p.price)||0,a=ce.value;return r<=0?0:Math.round((r-a)/r*100)}),x=T({itemId:null,quantity:1,unit:"pcs",isCritical:!1}),d=T([]),w=T(!1),m=T([]),h=async()=>{var r;if(K.product)try{const a=K.product.id_product||K.product.id,p=await rt.getAll({product_id:a,page:1,per_page:1e5});p.success&&((r=p.data)!=null&&r.data)&&(W.value=p.data.data,m.value=JSON.parse(JSON.stringify(p.data.data)))}catch(a){console.error("Error fetching product composition:",a)}},i=async()=>{var r;w.value=!0;try{const a=await Kt.getAll({page:1,per_page:1e5,active:!0});a.success&&((r=a.data)!=null&&r.data)&&(d.value=a.data.data.map(p=>{var F,M,$;return{id:((F=p.id_item)==null?void 0:F.toString())||((M=p.id)==null?void 0:M.toString()),name:p.name,current_stock:(($=p.inventory)==null?void 0:$.current_stock)||0,unit:p.unit||"pcs"}}))}catch(a){console.error("Error fetching available items:",a),d.value=[]}finally{w.value=!1}},v=ve(()=>x.value.itemId&&x.value.quantity>0&&x.value.unit.trim().length>0),U=ve(()=>{if(!x.value.itemId)return null;const r=d.value.find(a=>a.id===x.value.itemId);return(r==null?void 0:r.unit)||null}),ee=ve(()=>{if(!x.value.itemId)return null;const r=d.value.find(a=>a.id===x.value.itemId);return r?q(r):null}),le=ve(()=>ee.value!==null&&ee.value<=0),ie=ve(()=>Array.isArray(d.value)?d.value:[]),q=r=>r.current_stock||r.stock||0,z=()=>w.value?"Memuat items...":!d.value||d.value.length===0?"Tidak ada item tersedia":"Tidak ada item yang ditemukan",c=r=>{const a=q(r);return a>50?"success":a>20?"warning":a>0?"error":"grey"},o=r=>{const a=q(r);return a>50?"Aman":a>20?"Rendah":a>0?"Kritis":"Habis"};he(()=>x.value.itemId,r=>{if(r){const a=d.value.find(p=>p.id===r);a!=null&&a.unit&&(x.value.unit=a.unit)}}),he(()=>K.items,r=>{r&&r.length>0,W.value=[...r]},{immediate:!0}),he(()=>K.modelValue,async r=>{r&&K.product&&(h(),await s())});const s=async()=>{if(K.product&&(K.product.id_product||K.product.id))try{const r=parseInt(String(K.product.id_product||K.product.id));await ue(r,"latest")}catch(r){console.warn("Could not load HPP data:",r)}};at(()=>{i()});const P=()=>{me.value=!0},fe=async()=>{await s(),H("refresh")},J=()=>W.value.some(a=>{var p;return((p=a.item)==null?void 0:p.inventory)&&a.item.inventory.current_stock<a.quantity_needed})?"error":"success",_e=()=>W.value.some(a=>{var p;return((p=a.item)==null?void 0:p.inventory)&&a.item.inventory.current_stock<a.quantity_needed})?"Stok Kritis":"Stok Aman",De=()=>{if(!v.value)return;const r=d.value.find(F=>F.id===x.value.itemId);if(!r)return;if(W.value.find(F=>{var M;return((M=F.item)==null?void 0:M.id)===r.id})){_.value=`Item "${r.name}" sudah ada dalam komposisi produk ini`,A.value=!0;return}const p={id_product_item:`temp_${Date.now()}`,item:{id:String(r.id),name:r.name,inventory:{current_stock:r.current_stock||0}},quantity_needed:x.value.quantity,unit:x.value.unit,is_critical:x.value.isCritical};W.value.push(p),Ce()},te=(r,a)=>{var M;if(d.value.length===0){console.warn("â ï¸ Available items not loaded yet, fetching..."),i().then(()=>{te(r,a)});return}y.value=!0,Q.value=a;let p=((M=r.item)==null?void 0:M.id)||null;if(p!==null&&(p=p.toString()),x.value={itemId:p,quantity:parseFloat(r.quantity_needed.toString())||0,unit:r.unit,isCritical:r.is_critical},!d.value.find($=>$.id===p)){console.warn("â ï¸ Item ID not found in available items, trying alternative matching...");const $=d.value.find(b=>{var L;return b.name===((L=r.item)==null?void 0:L.name)});$?x.value.itemId=$.id:console.error("â Could not find item in available items by ID or name")}},He=()=>{if(!v.value||Q.value===-1)return;const r=d.value.find(a=>a.id===x.value.itemId);r&&(W.value[Q.value]={...W.value[Q.value],item:{id:String(r.id),name:r.name,inventory:{current_stock:r.current_stock||0}},quantity_needed:x.value.quantity,unit:x.value.unit,is_critical:x.value.isCritical},Ce())},Ce=()=>{y.value=!1,Q.value=-1,x.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},Ge=r=>{W.value.splice(r,1)},Qe=async()=>{var r,a,p,F,M,$,b,L,C;if(K.product){k.value=!0;try{const ne=parseInt(String(((r=K.product)==null?void 0:r.id_product)||((a=K.product)==null?void 0:a.id)||"0")),re=m.value||[],ye=W.value;for(const se of ye){const $e=re.find(Te=>{var Xe,Ze;return!!(Te.id_product_item===se.id_product_item||se.id_product_item&&!se.id_product_item.toString().startsWith("temp_")&&((Xe=Te.item)==null?void 0:Xe.id)===((Ze=se.item)==null?void 0:Ze.id))});if(!((p=se.item)!=null&&p.id)||parseInt(se.item.id)===0){console.warn("â ï¸ Skipping item with invalid item_id:",{item_name:(F=se.item)==null?void 0:F.name,item_id:(M=se.item)==null?void 0:M.id,full_item:se});continue}const Se={product_id:ne,item_id:parseInt((($=se.item)==null?void 0:$.id)||"0"),quantity_needed:parseFloat(se.quantity_needed.toString()),unit:se.unit,is_critical:se.is_critical,notes:se.notes||""};try{$e&&!((b=se.id_product_item)!=null&&b.toString().startsWith("temp_"))?await rt.update(parseInt($e.id_product_item||"0"),Se):await rt.create(Se)}catch(Te){throw console.error("â Error processing item:",Te),(L=Te.message)!=null&&L.includes("already assigned")?_.value=`Item "${(C=se.item)==null?void 0:C.name}" sudah ditambahkan ke produk ini`:_.value=Te.message||"Terjadi kesalahan saat menyimpan item",A.value=!0,Te}}for(const se of re)if(!ye.find(Se=>Se.id_product_item===se.id_product_item)&&se.id_product_item)try{await rt.delete(parseInt(se.id_product_item))}catch(Se){console.error("â Error deleting item:",Se),_.value=`Gagal menghapus item: ${Se.message}`,A.value=!0}Y.value="Komposisi produk berhasil disimpan!",g.value=!0,H("save",{product:K.product,items:W.value}),H("refresh"),Fe()}catch(ne){console.error("â Error saving composition:",ne),A.value||(_.value=ne.message||"Terjadi kesalahan saat menyimpan komposisi",A.value=!0)}finally{k.value=!1}}},Fe=()=>{O.value=!1,setTimeout(()=>{W.value=[...K.items],Ce()},300)};return(r,a)=>{var p,F,M,$;return f(),X(ze,null,[e(Le,{modelValue:O.value,"onUpdate:modelValue":a[9]||(a[9]=b=>O.value=b),"max-width":"900",persistent:""},{default:t(()=>[e(Z,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var b;return[l("div",Ia,[e(V,{icon:"mdi-chef-hat",size:"24"}),l("div",null,[a[12]||(a[12]=l("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),l("p",Da,n(((b=r.product)==null?void 0:b.name)||"Produk"),1)])]),e(R,{icon:"mdi-close",variant:"text",size:"small",onClick:Fe})]}),_:1}),e(ae,{class:"pa-6"},{default:t(()=>[e(Z,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(ae,{class:"pa-4"},{default:t(()=>{var b,L,C,ne,re,ye;return[l("div",za,[e(Pe,{image:(b=r.product)==null?void 0:b.image_url,size:"64"},{default:t(()=>{var se;return[(se=r.product)!=null&&se.image_url?j("",!0):(f(),E(V,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),l("div",Ua,[l("h4",Ta,n((L=r.product)==null?void 0:L.name),1),l("p",Aa," SKU: "+n(((C=r.product)==null?void 0:C.sku)||"SKU-"+((ne=r.product)==null?void 0:ne.id_product)),1),l("div",Ha,[l("p",Ma," Harga: "+n(B(Ae)(((re=r.product)==null?void 0:re.price)||0)),1),l("p",Ka," HPP: "+n(B(Ae)(ce.value)),1),(ye=r.product)!=null&&ye.price&&ce.value?(f(),X("p",Ba," Margin: "+n(B(Ae)(N.value)),1)):j("",!0)])]),e(de,{color:J(),variant:"tonal"},{default:t(()=>[u(n(_e()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e(Ve,{class:"mb-6"},{default:t(()=>[e(S,{cols:"12",md:"3"},{default:t(()=>[e(Z,{variant:"outlined",color:"info"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>[e(V,{icon:"mdi-calculator",size:"20",class:"mb-1"}),l("div",Fa,[u(n(B(Ae)(ce.value))+" ",1),B(pe)?(f(),E(dt,{key:0,indeterminate:"",size:"12",width:"2",class:"ml-1"})):j("",!0)]),a[13]||(a[13]=l("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[13]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Z,{variant:"outlined",color:"primary"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>{var b;return[e(V,{icon:"mdi-currency-usd",size:"20",class:"mb-1"}),l("div",Ea,n(B(Ae)(((b=r.product)==null?void 0:b.price)||0)),1),a[14]||(a[14]=l("div",{class:"text-caption"},"Harga Jual",-1))]}),_:1,__:[14]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Z,{variant:"outlined",color:"success"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>[e(V,{icon:"mdi-trending-up",size:"20",class:"mb-1"}),l("div",Ra,n(B(Ae)(N.value)),1),a[15]||(a[15]=l("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[15]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Z,{variant:"outlined",color:"warning"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>[e(V,{icon:"mdi-percent",size:"20",class:"mb-1"}),l("div",qa,n(oe.value)+"% ",1),a[16]||(a[16]=l("div",{class:"text-caption"},"Margin %",-1))]),_:1,__:[16]})]),_:1})]),_:1})]),_:1}),e(Z,{class:"mb-6",elevation:"2"},{default:t(()=>[e(xe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[l("div",La,[l("div",Na,[e(V,{icon:y.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),u(" "+n(y.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(ae,{class:"pa-4"},{default:t(()=>[e(Ve,null,{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>[e(yt,{modelValue:x.value.itemId,"onUpdate:modelValue":a[0]||(a[0]=b=>x.value.itemId=b),items:ie.value,loading:w.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item (termasuk yang stok kosong)...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":z()},{item:t(({props:b,item:L})=>[e(je,we(b,{class:{"text-medium-emphasis":q(L.raw)<=0}}),{prepend:t(()=>[e(Pe,{size:"32",class:"me-3",color:q(L.raw)<=0?"warning":"primary",variant:"tonal"},{default:t(()=>[e(V,{icon:"mdi-package-variant",color:q(L.raw)<=0?"warning":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[q(L.raw)>0?(f(),E(de,{key:0,size:"x-small",color:c(L.raw),variant:"tonal"},{default:t(()=>[u(n(o(L.raw)),1)]),_:2},1032,["color"])):(f(),E(de,{key:1,size:"x-small",color:"warning",variant:"tonal","prepend-icon":"mdi-alert"},{default:t(()=>a[18]||(a[18]=[u(" Kosong ")])),_:1,__:[18]}))]),default:t(()=>[e(et,null,{default:t(()=>[u(n(L.raw.name),1)]),_:2},1024),e(it,{class:"text-medium-emphasis"},{default:t(()=>[q(L.raw)<=0?(f(),X("span",Oa,[e(V,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),a[17]||(a[17]=u(" Stok Kosong - Masih bisa digunakan "))])):(f(),X("span",ja," Stok: "+n(q(L.raw))+" "+n(L.raw.unit),1))]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(be,{modelValue:x.value.quantity,"onUpdate:modelValue":a[1]||(a[1]=b=>x.value.quantity=b),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(be,{modelValue:x.value.unit,"onUpdate:modelValue":a[2]||(a[2]=b=>x.value.unit=b),label:"Satuan",variant:"outlined",placeholder:"kg, pcs, ml",readonly:!!U.value,hint:U.value?`Satuan dari item: ${U.value}`:"","persistent-hint":""},null,8,["modelValue","readonly","hint"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Ye,{modelValue:x.value.isCritical,"onUpdate:modelValue":a[3]||(a[3]=b=>x.value.isCritical=b),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(R,{color:y.value?"success":"primary",block:"","prepend-icon":y.value?"mdi-check":"mdi-plus",onClick:a[4]||(a[4]=b=>y.value?He():De()),disabled:!v.value},{default:t(()=>[u(n(y.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),y.value?(f(),E(R,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:Ce},{default:t(()=>a[19]||(a[19]=[u(" Batal ")])),_:1,__:[19]})):j("",!0)]),_:1})]),_:1}),le.value?(f(),E(Ke,{key:0,color:"warning",variant:"tonal",class:"mt-4","prepend-icon":"mdi-alert"},{default:t(()=>[e(ut,null,{default:t(()=>a[20]||(a[20]=[u("Item Stok Kosong")])),_:1,__:[20]}),a[21]||(a[21]=l("div",null,"Item yang dipilih sedang kosong stok, namun masih bisa ditambahkan ke komposisi. Pastikan untuk memperbarui stok sebelum produksi.",-1))]),_:1,__:[21]})):j("",!0)]),_:1})]),_:1}),e(Z,{elevation:"2"},{default:t(()=>[e(xe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e(V,{icon:"mdi-format-list-bulleted",class:"me-2"}),u(" Daftar Item Komposisi ("+n(W.value.length)+") ",1)]),_:1}),e(ae,{class:"pa-0"},{default:t(()=>[W.value.length===0?(f(),X("div",Ja,[e(V,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),a[22]||(a[22]=l("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),a[23]||(a[23]=l("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(f(),E(ct,{key:1},{default:t(()=>[(f(!0),X(ze,null,Je(W.value,(b,L)=>(f(),E(je,{key:b.id||L,class:"border-b"},{prepend:t(()=>[e(Pe,{size:"40",class:"me-3"},{default:t(()=>{var C,ne;return[e(V,{icon:(C=b.item)!=null&&C.inventory&&b.item.inventory.current_stock>=b.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(ne=b.item)!=null&&ne.inventory&&b.item.inventory.current_stock>=b.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[l("div",Qa,[e(R,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:C=>te(b,L)},null,8,["onClick"]),e(R,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:C=>Ge(L)},null,8,["onClick"])])]),default:t(()=>[e(et,{class:"font-weight-medium"},{default:t(()=>{var C;return[u(n(((C=b.item)==null?void 0:C.name)||"Item tidak ditemukan")+" ",1),b.is_critical?(f(),E(de,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>a[24]||(a[24]=[u(" Kritis ")])),_:1,__:[24]})):j("",!0)]}),_:2},1024),e(it,null,{default:t(()=>{var C;return[l("div",Wa,[l("span",null,"Dibutuhkan: "+n(parseFloat(b.quantity_needed))+" "+n(b.unit),1),(C=b.item)!=null&&C.inventory?(f(),X("span",{key:0,class:We(b.item.inventory.current_stock>=b.quantity_needed?"text-success":"text-error")}," Stok: "+n(b.item.inventory.current_stock)+" "+n(b.unit),3)):j("",!0),b.formatted_total_cost?(f(),X("span",Ga,n(b.formatted_total_cost),1)):j("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(Ee,{class:"pa-6 pt-0"},{default:t(()=>[e(R,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:P},{default:t(()=>a[25]||(a[25]=[u(" Setting HPP ")])),_:1,__:[25]}),e(Ne),e(R,{variant:"outlined",onClick:Fe},{default:t(()=>a[26]||(a[26]=[u(" Batal ")])),_:1,__:[26]}),e(R,{color:"primary",onClick:Qe,loading:k.value},{default:t(()=>a[27]||(a[27]=[u(" Simpan Komposisi ")])),_:1,__:[27]},8,["loading"])]),_:1})]),_:1}),e(tt,{modelValue:A.value,"onUpdate:modelValue":a[6]||(a[6]=b=>A.value=b),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:a[5]||(a[5]=b=>A.value=!1)},{default:t(()=>a[28]||(a[28]=[u(" Tutup ")])),_:1,__:[28]})]),default:t(()=>[u(n(_.value)+" ",1)]),_:1},8,["modelValue"]),e(tt,{modelValue:g.value,"onUpdate:modelValue":a[8]||(a[8]=b=>g.value=b),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:a[7]||(a[7]=b=>g.value=!1)},{default:t(()=>a[29]||(a[29]=[u(" Tutup ")])),_:1,__:[29]})]),default:t(()=>[u(n(Y.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(Bt,{modelValue:me.value,"onUpdate:modelValue":a[10]||(a[10]=b=>me.value=b),"product-id":parseInt(String(((p=r.product)==null?void 0:p.id_product)||((F=r.product)==null?void 0:F.id)||"0")),"product-name":((M=r.product)==null?void 0:M.product_name)||(($=r.product)==null?void 0:$.name),onHppUpdated:fe,onPriceUpdated:a[11]||(a[11]=b=>H("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),zt=Oe(Xa,[["__scopeId","data-v-e5c956e7"]]),Za={class:"composition-cards"},Ya={key:1,class:"text-center pa-12"},el={key:2,class:"text-center pa-12"},tl={class:"d-flex align-center gap-3"},al={class:"flex-grow-1 min-width-0"},ll={class:"text-h6 font-weight-bold text-truncate"},ol={class:"text-caption text-medium-emphasis mb-0"},sl={class:"d-flex align-center gap-2 mb-3"},il={class:"text-body-2 font-weight-medium"},nl={class:"composition-items"},rl={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},ul={class:"text-body-2 text-truncate"},dl={class:"text-end flex-shrink-0"},cl={class:"text-body-2 font-weight-medium"},ml={key:0,class:"text-caption text-success"},vl={key:1,class:"text-caption text-primary"},pl={class:"d-flex justify-between align-center mb-3"},fl={class:"text-h6 font-weight-bold text-primary"},gl={class:"d-flex gap-2"},_l={class:"d-flex align-center"},kl={class:"d-flex align-center gap-4"},yl={class:"flex-grow-1"},bl={class:"text-h5 font-weight-bold mb-2"},hl={class:"d-flex align-center gap-4 mb-2"},xl={class:"text-body-2"},wl={class:"d-flex align-center gap-4"},Vl={class:"text-h6 text-primary font-weight-bold"},Pl={class:"text-body-2 text-info font-weight-medium"},Cl={key:0,class:"text-body-2 text-success font-weight-medium"},$l={class:"d-flex align-center mt-1 gap-4"},Sl={class:"d-flex align-center"},Il={class:"d-flex align-center"},Dl={key:0,class:"d-flex align-center"},zl={class:"text-primary font-weight-medium"},Ul={key:1,class:"text-center py-8"},Tl={class:"text-h6 font-weight-bold"},Al={class:"text-h6 font-weight-bold"},Hl={class:"text-h6 font-weight-bold"},Ml={class:"text-h6 font-weight-bold"},Kl={class:"text-h6 font-weight-bold"},Bl=Re({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup(D,{emit:ke}){const K=D,H=ke,O=T(!1),k=T(!1),W=T(null),A=T([]),g=T(null),_=T({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),Y=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],y=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],Q=h=>{W.value=h,A.value=h.items||[],O.value=!0},me=h=>{g.value=h,k.value=!0},pe=h=>{H("refresh")},I=()=>{_.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},ue=ve(()=>!!(_.value.search||_.value.stockStatus||_.value.itemType||_.value.criticalOnly||_.value.sortBy!=="name_asc")),ce=ve(()=>{let h=0;return _.value.search&&h++,_.value.stockStatus&&h++,_.value.itemType&&h++,_.value.criticalOnly&&h++,_.value.sortBy!=="name_asc"&&h++,h}),N=ve(()=>{const h=new Map;K.productItems.forEach(v=>{if(!v.product)return;const U=v.product.id_product||v.product.id;h.has(U)||h.set(U,{...v.product,items:[],totalItems:0}),h.get(U).items.push(v),h.get(U).totalItems++});let i=Array.from(h.values());if(_.value.search){const v=_.value.search.toLowerCase();i=i.filter(U=>U.name.toLowerCase().includes(v)||U.sku&&U.sku.toLowerCase().includes(v)||U.items.some(ee=>{var le;return(le=ee.item)==null?void 0:le.name.toLowerCase().includes(v)}))}return _.value.stockStatus&&(i=i.filter(v=>{const U=oe(v);switch(_.value.stockStatus){case"safe":return U.color==="success";case"critical":return U.color==="warning";case"out":return U.color==="error";default:return!0}})),_.value.criticalOnly&&(i=i.filter(v=>v.items.some(U=>U.is_critical))),i.sort((v,U)=>{switch(_.value.sortBy){case"name_asc":return v.name.localeCompare(U.name);case"name_desc":return U.name.localeCompare(v.name);case"price_asc":return(v.price||0)-(U.price||0);case"price_desc":return(U.price||0)-(v.price||0);case"items_asc":return v.totalItems-U.totalItems;case"items_desc":return U.totalItems-v.totalItems;default:return v.name.localeCompare(U.name)}}),i}),oe=h=>{let i=!1,v=!1;return h.items.forEach(U=>{var ee;if((ee=U.item)!=null&&ee.inventory){const le=U.item.inventory.current_stock||0,ie=U.quantity_needed||0;le<=0?i=!0:(le<ie||U.is_critical)&&(v=!0)}}),i?{text:"Stok Habis",color:"error"}:v?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},x=h=>{if(!(h!=null&&h.inventory))return"grey";const i=h.inventory.current_stock||0;return i<=0?"error":i<=10?"warning":"success"},d=h=>{if(!(h!=null&&h.inventory))return"Tidak ada data";const i=h.inventory.current_stock||0;return i<=0?"Habis":i<=10?"Rendah":"Aman"},w=h=>{const i=x(h);return{"text-error":i==="error","text-warning":i==="warning","text-success":i==="success","text-grey":i==="grey"}},m=h=>`Item Komposisi (${h})`;return(h,i)=>(f(),X("div",Za,[e(Z,{class:"mb-6"},{default:t(()=>[e(xe,{class:"d-flex align-center justify-between"},{default:t(()=>[i[12]||(i[12]=l("div",null,[l("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),l("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),e(R,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:i[0]||(i[0]=v=>H("refresh")),loading:h.loading},{default:t(()=>i[11]||(i[11]=[u(" Refresh ")])),_:1,__:[11]},8,["loading"])]),_:1,__:[12]})]),_:1}),e(Z,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ae,null,{default:t(()=>[e(Ve,null,{default:t(()=>[e(S,{cols:"12",md:"3"},{default:t(()=>[e(be,{modelValue:_.value.search,"onUpdate:modelValue":i[1]||(i[1]=v=>_.value.search=v),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:_.value.stockStatus,"onUpdate:modelValue":i[2]||(i[2]=v=>_.value.stockStatus=v),items:Y,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:_.value.sortBy,"onUpdate:modelValue":i[3]||(i[3]=v=>_.value.sortBy=v),items:y,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(ra,{modelValue:_.value.criticalOnly,"onUpdate:modelValue":i[4]||(i[4]=v=>_.value.criticalOnly=v),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Ve,{class:"mt-3"},{default:t(()=>[e(S,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(R,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:I,disabled:!ue.value},{default:t(()=>i[13]||(i[13]=[u(" Reset Filter ")])),_:1,__:[13]},8,["disabled"]),ue.value?(f(),E(de,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[u(n(ce.value)+" filter aktif ",1)]),_:1})):j("",!0)]),_:1}),e(S,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(de,{color:N.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[u(n(N.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!h.loading&&N.value.length===0&&ue.value?(f(),E(Ke,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):j("",!0),h.loading?(f(),X("div",Ya,[e(dt,{color:"primary",indeterminate:"",size:"64"}),i[14]||(i[14]=l("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):N.value.length===0?(f(),X("div",el,[e(V,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),i[16]||(i[16]=l("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),i[17]||(i[17]=l("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(R,{color:"primary",size:"large","prepend-icon":"mdi-plus"},{default:t(()=>i[15]||(i[15]=[u(" Buat Komposisi Pertama ")])),_:1,__:[15]})])):(f(),E(Ve,{key:3},{default:t(()=>[(f(!0),X(ze,null,Je(N.value,v=>(f(),E(S,{key:v.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(Z,{class:We(["composition-card h-100",{"border-error":oe(v).color==="error"}]),elevation:"2"},{default:t(()=>[e(xe,{class:"pa-4 pb-2"},{default:t(()=>[l("div",tl,[e(Pe,{image:v.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[v.image_url?j("",!0):(f(),E(V,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),l("div",al,[l("h3",ll,n(v.name),1),l("p",ol,n(v.sku||"SKU-"+v.id_product),1)])])]),_:2},1024),e(ae,{class:"py-2"},{default:t(()=>[e(de,{color:oe(v).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[u(n(oe(v).text),1)]),_:2},1032,["color"]),l("div",sl,[e(V,{icon:"mdi-format-list-bulleted",size:"16"}),l("span",il,n(m(v.totalItems)),1)]),l("div",nl,[(f(!0),X(ze,null,Je(v.items,U=>{var ee,le,ie,q;return f(),X("div",{key:U.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[l("div",rl,[e(V,{icon:(ee=U.item)!=null&&ee.inventory&&U.item.inventory.current_stock>=U.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(le=U.item)!=null&&le.inventory&&U.item.inventory.current_stock>=U.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),l("span",ul,n(((ie=U.item)==null?void 0:ie.name)||"Item tidak ditemukan"),1),U.is_critical?(f(),E(de,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>i[18]||(i[18]=[u(" Kritis ")])),_:1,__:[18]})):j("",!0)]),l("div",dl,[l("div",cl,n(parseFloat(U.quantity_needed))+" "+n(U.unit),1),(q=U.item)!=null&&q.inventory?(f(),X("div",ml," Stok: "+n(U.item.inventory.current_stock)+" "+n(U.unit),1)):j("",!0),U.formatted_total_cost?(f(),X("div",vl,n(U.formatted_total_cost),1)):j("",!0)])])}),128))])]),_:2},1024),e(ae,{class:"pt-0"},{default:t(()=>[e(Ue,{class:"mb-3"}),l("div",pl,[i[19]||(i[19]=l("span",{class:"text-body-2"},"Harga:",-1)),l("span",fl,n(B(Ae)(v.price||0)),1)]),l("div",gl,[e(R,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:U=>me(v)},{default:t(()=>i[20]||(i[20]=[u(" Detail ")])),_:2,__:[20]},1032,["onClick"]),e(R,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:U=>Q(v)},{default:t(()=>i[21]||(i[21]=[u(" Kelola ")])),_:2,__:[21]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(zt,{modelValue:O.value,"onUpdate:modelValue":i[5]||(i[5]=v=>O.value=v),product:W.value,items:A.value,onSave:pe,onRefresh:i[6]||(i[6]=v=>H("refresh"))},null,8,["modelValue","product","items"]),e(Le,{modelValue:k.value,"onUpdate:modelValue":i[10]||(i[10]=v=>k.value=v),"max-width":"900",scrollable:""},{default:t(()=>[e(Z,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",_l,[e(V,{icon:"mdi-eye",class:"mr-2",color:"primary"}),i[22]||(i[22]=l("span",null,"Detail Komposisi Produk",-1))]),e(R,{icon:"",variant:"text",onClick:i[7]||(i[7]=v=>k.value=!1)},{default:t(()=>[e(V,{icon:"mdi-close"})]),_:1})]),_:1}),e(Ue),g.value?(f(),E(ae,{key:0},{default:t(()=>[e(ua,null,{default:t(()=>[e(Ve,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(Z,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(ae,null,{default:t(()=>[l("div",kl,[e(Pe,{image:g.value.image_url,size:"80"},{default:t(()=>[g.value.image_url?j("",!0):(f(),E(V,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),l("div",yl,[l("h2",bl,n(g.value.name),1),l("div",hl,[e(de,{color:oe(g.value).color,variant:"tonal",size:"small"},{default:t(()=>[u(n(oe(g.value).text),1)]),_:1},8,["color"]),l("span",xl,"SKU: "+n(g.value.sku||"-"),1)]),l("div",wl,[l("div",Vl,n(B(Ae)(g.value.price||0)),1),l("div",Pl," HPP: "+n(B(Ae)(g.value.hpp||g.value.cost||0)),1),g.value.price&&(g.value.hpp||g.value.cost)?(f(),X("div",Cl," Margin: "+n(B(Ae)((g.value.price||0)-(g.value.hpp||g.value.cost||0))),1)):j("",!0)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e(Ve,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(Z,{variant:"outlined"},{default:t(()=>[e(xe,{class:"text-h6"},{default:t(()=>[e(V,{icon:"mdi-format-list-bulleted",class:"mr-2"}),u(" Komposisi Item ("+n(g.value.totalItems||0)+") ",1)]),_:1}),e(ae,null,{default:t(()=>[g.value.items&&g.value.items.length>0?(f(),E(ct,{key:0},{default:t(()=>[(f(!0),X(ze,null,Je(g.value.items,(v,U)=>(f(),E(je,{key:v.id_product_item,class:"px-0"},{prepend:t(()=>[e(Pe,{size:"40",color:x(v.item),variant:"tonal"},{default:t(()=>{var ee;return[e(V,{icon:(ee=v.item)!=null&&ee.inventory&&v.item.inventory.current_stock>=v.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(de,{color:x(v.item),variant:"tonal",size:"small"},{default:t(()=>[u(n(d(v.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(et,{class:"font-weight-medium"},{default:t(()=>{var ee;return[u(n(((ee=v.item)==null?void 0:ee.name)||"Unknown Item")+" ",1),v.is_critical?(f(),E(de,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>i[23]||(i[23]=[u(" Kritis ")])),_:1,__:[23]})):j("",!0)]}),_:2},1024),e(it,null,{default:t(()=>{var ee,le;return[l("div",$l,[l("div",Sl,[e(V,{icon:"mdi-scale",size:"14",class:"mr-1"}),l("span",null," Kebutuhan: "+n(Number(v.quantity_needed||0).toLocaleString("id-ID"))+" "+n(v.unit),1)]),l("div",Il,[e(V,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),l("span",{class:We(w(v.item))}," Stok: "+n(Number(((le=(ee=v.item)==null?void 0:ee.inventory)==null?void 0:le.current_stock)||0).toLocaleString("id-ID"))+" "+n(v.unit),3)]),v.formatted_total_cost?(f(),X("div",Dl,[e(V,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),l("span",zl,n(v.formatted_total_cost),1)])):j("",!0)])]}),_:2},1024),U<g.value.items.length-1?(f(),E(Ue,{key:0,class:"mt-3"})):j("",!0)]),_:2},1024))),128))]),_:1})):(f(),X("div",Ul,[e(V,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),i[24]||(i[24]=l("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(Ve,{class:"mt-4"},{default:t(()=>[e(S,{cols:"12",md:"2"},{default:t(()=>[e(Z,{variant:"outlined",color:"primary"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(V,{icon:"mdi-format-list-bulleted",size:"24",class:"mb-2"}),l("div",Tl,n(g.value.totalItems||0),1),i[25]||(i[25]=l("div",{class:"text-caption"},"Total Item",-1))]),_:1,__:[25]})]),_:1})]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Z,{variant:"outlined",color:"warning"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>{var v;return[e(V,{icon:"mdi-alert",size:"24",class:"mb-2"}),l("div",Al,n(((v=g.value.items)==null?void 0:v.filter(U=>U.is_critical).length)||0),1),i[26]||(i[26]=l("div",{class:"text-caption"},"Item Kritis",-1))]}),_:1,__:[26]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Z,{variant:"outlined",color:"info"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(V,{icon:"mdi-calculator",size:"24",class:"mb-2"}),l("div",Hl,n(B(Ae)(g.value.hpp||g.value.cost||0)),1),i[27]||(i[27]=l("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[27]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Z,{variant:"outlined",color:"success"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(V,{icon:"mdi-currency-usd",size:"24",class:"mb-2"}),l("div",Ml,n(B(Ae)(g.value.price||0)),1),i[28]||(i[28]=l("div",{class:"text-caption"},"Harga Jual",-1))]),_:1,__:[28]})]),_:1})]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Z,{variant:"outlined",color:"purple"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(V,{icon:"mdi-trending-up",size:"24",class:"mb-2"}),l("div",Kl,n(B(Ae)((g.value.price||0)-(g.value.hpp||g.value.cost||0))),1),i[29]||(i[29]=l("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[29]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0),e(Ue),e(Ee,{class:"pa-4"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",onClick:i[8]||(i[8]=v=>k.value=!1)},{default:t(()=>i[30]||(i[30]=[u(" Tutup ")])),_:1,__:[30]}),e(R,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:i[9]||(i[9]=()=>{k.value=!1,Q(g.value)})},{default:t(()=>i[31]||(i[31]=[u(" Kelola Komposisi ")])),_:1,__:[31]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),Fl=Oe(Bl,[["__scopeId","data-v-25f6bef1"]]),El={class:"d-flex align-center gap-2"},Rl={class:"text-white"},ql={class:"text-h6 mb-4 d-flex align-center gap-2"},Ll={class:"text-h6 mb-4 d-flex align-center gap-2"},Nl={class:"d-flex flex-column gap-2"},Ol={key:0,class:"d-flex align-center gap-2"},jl={class:"d-flex align-center gap-2 mb-2"},Jl={class:"d-flex gap-2"},Wl={class:"d-flex gap-2"},Gl={class:"d-flex align-center justify-space-between"},Ql={class:"d-flex align-center gap-2"},Xl={class:"text-end"},Zl={class:"text-h6 font-weight-bold"},Yl={class:"text-caption"},eo={class:"text-h6 mb-4 d-flex align-center gap-2"},to={class:"text-h6 mb-4 d-flex align-center gap-2"},ao={class:"image-upload-container"},lo={key:0,class:"mb-4"},oo={class:"text-center mt-2"},so={class:"text-h6 mb-4 d-flex align-center gap-2"},io={class:"text-h6 mb-4 d-flex align-center gap-2"},no={class:"text-h6 mb-4 d-flex align-center gap-2"},ro={class:"d-flex align-center"},uo={class:"text-subtitle-1"},co={class:"text-body-1"},mo={class:"d-flex align-center"},vo={class:"text-subtitle-1"},po=Re({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup(D,{emit:ke}){var q,z,c;const K=It(),{nameRules:H,categoryRules:O}=Dt(),{getProductHPPBreakdown:k}=_t(),W=T(!1),A=T(!1),g=async()=>{if(!(!y.editMode||!I.id))try{const o=await fetch(`/api/products/${I.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(o.ok){const s=await o.json();A.value=s.success&&s.data&&s.data.length>0}}catch(o){console.error("Error checking HPP status:",o)}},_=async()=>{if(I.id)try{W.value=!0;const o=await k(I.id,"latest");o&&(I.cost=o.total_hpp,me("update-form","cost",o.total_hpp))}catch(o){console.error("Error refreshing HPP:",o)}finally{W.value=!1}},Y=()=>{},y=D,Q=ve(()=>y.errorMessage),me=ke,pe=T(),I=gt({...y.formData,available_in_kitchen:!!y.formData.available_in_kitchen,available_in_bar:!!y.formData.available_in_bar});he(()=>y.formData,o=>{const s={...o,available_in_kitchen:!!o.available_in_kitchen,available_in_bar:!!o.available_in_bar};Object.assign(I,s)},{deep:!0}),he(I,o=>{Object.keys(o).forEach(s=>{me("update-form",s,o[s])})},{deep:!0}),he(()=>y.modelValue,o=>{o&&y.editMode&&g()});const ue=gt({length:((q=y.formData.dimensions)==null?void 0:q.length)||null,width:((z=y.formData.dimensions)==null?void 0:z.width)||null,height:((c=y.formData.dimensions)==null?void 0:c.height)||null});he(ue,o=>{const s=o.length!==null||o.width!==null||o.height!==null;I.dimensions=s?{length:o.length!==null?o.length:void 0,width:o.width!==null?o.width:void 0,height:o.height!==null?o.height:void 0}:{}},{deep:!0});const ce=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],N=ve(()=>{if(!I.price||!I.cost||I.cost<=0)return 0;const o=(I.price-I.cost)/I.cost*100;return Math.ceil(o)}),oe=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),x=o=>o<10?"error":o<25?"warning":o<50?"success":"info",d=o=>o<10?"tabler-trending-down":o<25?"tabler-trending-up":o<50?"tabler-trending-up-2":"tabler-trending-up-3",w=o=>!o||o===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),m=o=>{if(!o||o.trim()===""||o==="Rp 0")return 0;const P=o.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(P)||0},h=T(!1),i=o=>{const s=m(o);I.price=s},v=()=>{h.value=!0},U=()=>{h.value=!1},ee=async()=>{var s;const{valid:o}=await((s=pe.value)==null?void 0:s.validate());o&&me("submit",I)},le=o=>{me("image-change",o)},ie=()=>{me("remove-image")};return(o,s)=>(f(),E(Le,{"model-value":o.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":s[27]||(s[27]=P=>o.$emit("update:modelValue",P))},{default:t(()=>[e(Z,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[l("div",El,[e(V,{icon:o.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),l("span",Rl,n(o.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(R,{icon:"tabler-x",variant:"text",color:"white",onClick:s[0]||(s[0]=P=>o.$emit("close"))})]),_:1}),e(Ue),e(ae,{class:"pa-6"},{default:t(()=>[e(bt,{ref_key:"formRef",ref:pe,onSubmit:kt(ee,["prevent"])},{default:t(()=>[e(Ve,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[l("h6",ql,[e(V,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),s[28]||(s[28]=u(" Informasi Dasar "))])]),_:1}),e(S,{cols:"12",md:"8"},{default:t(()=>[e(be,{modelValue:I.name,"onUpdate:modelValue":s[1]||(s[1]=P=>I.name=P),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:B(H),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(be,{modelValue:I.sku,"onUpdate:modelValue":s[2]||(s[2]=P=>I.sku=P),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(Ct,{modelValue:I.description,"onUpdate:modelValue":s[3]||(s[3]=P=>I.description=P),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(Be,{"model-value":I.category_id,"onUpdate:modelValue":s[4]||(s[4]=P=>I.category_id=P),items:o.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:B(O),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(be,{modelValue:I.brand,"onUpdate:modelValue":s[5]||(s[5]=P=>I.brand=P),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[l("h6",Ll,[e(V,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),s[29]||(s[29]=u(" Harga & Biaya "))])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(be,{"model-value":w(I.price),"onUpdate:modelValue":s[6]||(s[6]=P=>i(P)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:v,onBlur:U},null,8,["model-value"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[l("div",Nl,[e(be,{"model-value":w(I.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),o.editMode?(f(),X("div",Ol,[e(de,{color:A.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e(V,{icon:A.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),u(" "+n(A.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),A.value?(f(),E(R,{key:0,size:"small",variant:"outlined",color:"primary",onClick:_,loading:W.value},{default:t(()=>[e(V,{icon:"tabler-refresh",size:"14",class:"me-1"}),s[30]||(s[30]=u(" Update HPP "))]),_:1,__:[30]},8,["loading"])):(f(),E(Me,{key:1},{activator:t(({props:P})=>[e(de,we(P,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e(V,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),s[31]||(s[31]=u(" Belum Ada Resep "))]),_:2,__:[31]},1040)]),default:t(()=>[s[32]||(s[32]=l("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[32]}))])):j("",!0)])]),_:1}),o.editMode?(f(),E(S,{key:0,cols:"12"},{default:t(()=>[A.value?(f(),E(Ke,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ut,null,{default:t(()=>[e(V,{icon:"tabler-info-circle",class:"me-2"}),s[33]||(s[33]=u(" HPP Otomatis Aktif "))]),_:1,__:[33]}),s[34]||(s[34]=l("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[34]})):(f(),E(Ke,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ut,null,{default:t(()=>[e(V,{icon:"tabler-alert-triangle",class:"me-2"}),s[35]||(s[35]=u(" HPP Manual "))]),_:1,__:[35]}),s[36]||(s[36]=l("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[36]}))]),_:1})):j("",!0),e(S,{cols:"12"},{default:t(()=>[A.value&&o.editMode?(f(),E(Ke,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[l("div",jl,[e(V,{icon:"tabler-check-circle"}),s[37]||(s[37]=l("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),s[40]||(s[40]=l("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),l("div",Jl,[e(R,{size:"small",color:"primary",variant:"outlined",onClick:Y},{default:t(()=>[e(V,{icon:"tabler-edit",size:"14",class:"me-1"}),s[38]||(s[38]=u(" Edit Resep "))]),_:1,__:[38]}),e(R,{size:"small",variant:"outlined",color:"info",onClick:_,loading:W.value},{default:t(()=>[e(V,{icon:"tabler-refresh",size:"14",class:"me-1"}),s[39]||(s[39]=u(" Refresh HPP "))]),_:1,__:[39]},8,["loading"])])]),_:1,__:[40]})):!A.value&&o.editMode?(f(),E(Ke,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[l("div",Wl,[e(R,{size:"small",variant:"outlined",color:"info",onClick:s[7]||(s[7]=P=>B(K).push("/hpp-management"))},{default:t(()=>[e(V,{icon:"tabler-calculator",size:"14",class:"me-1"}),s[41]||(s[41]=u(" Lihat HPP Management "))]),_:1,__:[41]})])]),_:1})):j("",!0)]),_:1}),e(S,{cols:"12"},{default:t(()=>[I.price&&I.cost&&I.cost>0?(f(),E(Ke,{key:0,color:x(N.value),variant:"tonal",class:"mb-0"},{default:t(()=>[l("div",Gl,[l("div",Ql,[e(V,{icon:d(N.value)},null,8,["icon"]),s[42]||(s[42]=l("span",{class:"font-weight-medium"},"Profit Margin",-1))]),l("div",Xl,[l("div",Zl,n(Math.round(N.value))+"%",1),l("div",Yl," Keuntungan: "+n(oe(I.price-I.cost)),1)])])]),_:1},8,["color"])):j("",!0)]),_:1}),e(S,{cols:"12"},{default:t(()=>[l("h6",eo,[e(V,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),s[43]||(s[43]=u(" Dimensi (cm) "))])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(be,{modelValue:ue.length,"onUpdate:modelValue":s[8]||(s[8]=P=>ue.length=P),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(be,{modelValue:ue.width,"onUpdate:modelValue":s[9]||(s[9]=P=>ue.width=P),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(be,{modelValue:ue.height,"onUpdate:modelValue":s[10]||(s[10]=P=>ue.height=P),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[l("h6",to,[e(V,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),s[44]||(s[44]=u(" Gambar Produk "))])]),_:1}),e(S,{cols:"12"},{default:t(()=>[l("div",ao,[o.imagePreview?(f(),X("div",lo,[e(va,{src:o.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),l("div",oo,[e(R,{size:"small",color:"error",variant:"outlined",onClick:ie},{default:t(()=>s[45]||(s[45]=[u(" Hapus Gambar ")])),_:1,__:[45]})])])):j("",!0),e(pa,{"model-value":o.selectedImage,"onUpdate:modelValue":s[11]||(s[11]=P=>le(Array.isArray(P)?P:[P])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),s[46]||(s[46]=l("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e(S,{cols:"12"},{default:t(()=>[l("h6",so,[e(V,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),s[47]||(s[47]=u(" Pengaturan "))])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(Be,{"model-value":I.status,"onUpdate:modelValue":s[12]||(s[12]=P=>I.status=P),items:ce,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(Ye,{"model-value":I.active,"onUpdate:modelValue":s[13]||(s[13]=P=>I.active=P??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(Ye,{"model-value":I.featured,"onUpdate:modelValue":s[14]||(s[14]=P=>I.featured=P??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[l("h6",io,[e(V,{icon:"tabler-tools-kitchen-2",size:"20",class:"coffee-icon"}),s[48]||(s[48]=u(" Ketersediaan Station "))])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(Ye,{"model-value":I.available_in_kitchen,"onUpdate:modelValue":s[15]||(s[15]=P=>I.available_in_kitchen=!!P),label:"Tersedia di Kitchen",color:"coffee",inset:""},{prepend:t(()=>[e(V,{icon:"tabler-chef-hat",class:"me-2",color:I.available_in_kitchen?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(Ye,{"model-value":I.available_in_bar,"onUpdate:modelValue":s[16]||(s[16]=P=>I.available_in_bar=!!P),label:"Tersedia di Bar",color:"coffee",inset:""},{prepend:t(()=>[e(V,{icon:"tabler-glass-cocktail",class:"me-2",color:I.available_in_bar?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[l("h6",no,[e(V,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),s[49]||(s[49]=u(" SEO (Opsional) "))])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(be,{modelValue:I.meta_title,"onUpdate:modelValue":s[17]||(s[17]=P=>I.meta_title=P),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(Ct,{modelValue:I.meta_description,"onUpdate:modelValue":s[18]||(s[18]=P=>I.meta_description=P),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(Sa,{"model-value":I.tags,"onUpdate:modelValue":s[19]||(s[19]=P=>I.tags=P),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Ue),e(Ee,{class:"pa-6"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",class:"coffee-secondary",onClick:s[20]||(s[20]=P=>o.$emit("close"))},{default:t(()=>s[50]||(s[50]=[u(" Batal ")])),_:1,__:[50]}),e(R,{color:"primary",class:"coffee-primary",loading:o.loading,onClick:ee},{default:t(()=>[u(n(o.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),o.useDialogError?j("",!0):(f(),E(tt,{key:0,"model-value":!!Q.value,"onUpdate:modelValue":s[22]||(s[22]=P=>!P&&o.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(R,{icon:"tabler-x",size:"small",variant:"text",onClick:s[21]||(s[21]=P=>o.$emit("clear-error"))})]),default:t(()=>[l("div",ro,[e(V,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),l("div",null,[s[51]||(s[51]=l("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),l("div",uo,n(Q.value),1)])])]),_:1},8,["model-value"])),o.useDialogError?(f(),E(Le,{key:1,"model-value":!!Q.value,"onUpdate:modelValue":s[24]||(s[24]=P=>!P&&o.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(Z,null,{default:t(()=>[e(xe,{class:"d-flex align-center text-error"},{default:t(()=>[e(V,{icon:"tabler-alert-circle",class:"me-2"}),s[52]||(s[52]=u(" Error Occurred "))]),_:1,__:[52]}),e(Ue),e(ae,{class:"py-4"},{default:t(()=>[l("div",co,n(Q.value),1)]),_:1}),e(Ue),e(Ee,{class:"justify-end pa-4"},{default:t(()=>[e(R,{color:"error",variant:"outlined",onClick:s[23]||(s[23]=P=>o.$emit("clear-error"))},{default:t(()=>s[53]||(s[53]=[u(" Close ")])),_:1,__:[53]})]),_:1})]),_:1})]),_:1},8,["model-value"])):j("",!0),e(tt,{"model-value":!!o.successMessage,"onUpdate:modelValue":s[26]||(s[26]=P=>!P&&o.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(R,{icon:"tabler-x",size:"small",variant:"text",onClick:s[25]||(s[25]=P=>o.$emit("clear-success"))})]),default:t(()=>[l("div",mo,[e(V,{icon:"tabler-check-circle",class:"me-3",size:"28"}),l("div",null,[s[54]||(s[54]=l("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),l("div",vo,n(o.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),fo=Oe(po,[["__scopeId","data-v-333cc50b"]]),go={key:0,class:"mt-4"},_o={class:"d-flex align-center gap-2 mb-2"},ko={class:"d-flex flex-wrap gap-2"},yo=Re({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup(D,{emit:ke}){const K=D,H=ke,{categories:O,loading:k,fetchAllCategories:W}=fa(),A=T(!1),g=T("");at(async()=>{await W(),g.value=_.search||""});const _=gt({...K.filters});he(()=>K.filters,x=>{Object.assign(_,x),g.value=x.search||""},{deep:!0}),Zt(g,x=>{_.search=x,(x.length>=3||x.length===0)&&(A.value=!0,H("search",x),I(),setTimeout(()=>{A.value=!1},500))},{debounce:500,maxWait:1e3});const Y=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],y=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],Q=[{title:"Kitchen Only",value:"kitchen"},{title:"Bar Only",value:"bar"},{title:"Kitchen & Bar",value:"both"}],me=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],pe=ve(()=>!!(g.value||_.category_id||_.active||_.stock_status||_.station||_.featured!==null||_.min_price||_.max_price)),I=()=>{H("update:filters",{..._})},ue=()=>{g.value="",Object.assign(_,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),I()},ce=x=>{const d=O.value.find(w=>w.id_category===x);return(d==null?void 0:d.name)||"Unknown"},N=x=>{if(!x)return"Semua";const d=Y.find(w=>w.value===x);return(d==null?void 0:d.title)||String(x)},oe=x=>{const d=y.find(w=>w.value===x);return(d==null?void 0:d.title)||x};return(x,d)=>(f(),E(Z,{class:"mb-6"},{default:t(()=>[e(xe,{class:"d-flex align-center gap-2"},{default:t(()=>[e(V,{icon:"tabler-filter",class:"coffee-icon"}),d[12]||(d[12]=u(" Filter & Pencarian Produk "))]),_:1,__:[12]}),e(ae,null,{default:t(()=>[e(Ve,null,{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>[e(be,{modelValue:g.value,"onUpdate:modelValue":d[0]||(d[0]=w=>g.value=w),label:"Cari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:A.value,clearable:"",variant:"outlined",hint:g.value.length>0&&g.value.length<3?`Ketik ${3-g.value.length} karakter lagi untuk mencari`:"","persistent-hint":""},null,8,["modelValue","loading","hint"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:_.category_id,"onUpdate:modelValue":[d[1]||(d[1]=w=>_.category_id=w),I],items:B(O),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:B(k),clearable:"",variant:"outlined"},{"no-data":t(()=>[e(je,null,{default:t(()=>[e(et,null,{default:t(()=>[u(n(B(k)?"Memuat kategori...":"Tidak ada kategori"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:_.active,"onUpdate:modelValue":[d[2]||(d[2]=w=>_.active=w),I],items:Y,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:_.stock_status,"onUpdate:modelValue":[d[3]||(d[3]=w=>_.stock_status=w),I],items:y,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:_.station,"onUpdate:modelValue":[d[4]||(d[4]=w=>_.station=w),I],items:Q,label:"Station",placeholder:"Semua station","prepend-inner-icon":"tabler-tools-kitchen-2",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(R,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:ue})]),_:1})]),_:1}),e(Ve,{class:"mt-3"},{default:t(()=>[e(S,{cols:"12",md:"3"},{default:t(()=>[e(be,{modelValue:_.min_price,"onUpdate:modelValue":d[5]||(d[5]=w=>_.min_price=w),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:I},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(be,{modelValue:_.max_price,"onUpdate:modelValue":d[6]||(d[6]=w=>_.max_price=w),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:I},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:_.sort_order,"onUpdate:modelValue":[d[7]||(d[7]=w=>_.sort_order=w),I],items:me,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),pe.value?(f(),X("div",go,[l("div",_o,[e(V,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),d[13]||(d[13]=l("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),l("div",ko,[g.value?(f(),E(de,{key:0,closable:"",size:"small",color:"coffee","onClick:close":d[8]||(d[8]=w=>{g.value="",_.search="",I()})},{default:t(()=>[u(" Pencarian: "+n(g.value),1)]),_:1})):j("",!0),_.category_id?(f(),E(de,{key:1,closable:"",size:"small",color:"coffee","onClick:close":d[9]||(d[9]=w=>{_.category_id=null,I()})},{default:t(()=>[u(" Kategori: "+n(ce(_.category_id)),1)]),_:1})):j("",!0),_.active?(f(),E(de,{key:2,closable:"",size:"small",color:"coffee","onClick:close":d[10]||(d[10]=w=>{_.active=null,I()})},{default:t(()=>[u(" Status: "+n(N(_.active)),1)]),_:1})):j("",!0),_.stock_status?(f(),E(de,{key:3,closable:"",size:"small",color:"coffee","onClick:close":d[11]||(d[11]=w=>{_.stock_status=null,I()})},{default:t(()=>[u(" Stok: "+n(oe(_.stock_status)),1)]),_:1})):j("",!0)])])):j("",!0)]),_:1})]),_:1}))}}),bo=Oe(yo,[["__scopeId","data-v-d597dc7f"]]),ho={class:"d-flex align-center gap-2"},xo={class:"text-h6"},wo={class:"d-flex align-center gap-2"},Vo={class:"text-h6"},Po={class:"d-flex align-center gap-2"},Co={class:"text-h6"},$o={class:"d-flex align-center gap-2"},So={class:"text-h6"},Io={class:"d-flex align-center gap-2"},Do={class:"text-h6"},zo={class:"d-flex align-center gap-2"},Uo={class:"text-h6"},To={class:"d-flex align-center gap-2"},Ao={class:"text-h6"},Ho={class:"d-flex align-center gap-2"},Mo={class:"text-h6"},Ko=Re({__name:"ProductStatsCards",props:{stats:{}},setup(D){const ke=H=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(H),K=H=>`${H.toFixed(1)}%`;return(H,O)=>(f(),E(Ve,{class:"mb-6"},{default:t(()=>[e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Z,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Pe,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-package"})]),_:1}),l("div",null,[O[0]||(O[0]=l("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),l("div",ho,[l("h6",xo,n(((k=H.stats)==null?void 0:k.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Z,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Pe,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-check"})]),_:1}),l("div",null,[O[1]||(O[1]=l("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),l("div",wo,[l("h6",Vo,n(((k=H.stats)==null?void 0:k.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Z,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Pe,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-star"})]),_:1}),l("div",null,[O[2]||(O[2]=l("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),l("div",Po,[l("h6",Co,n(((k=H.stats)==null?void 0:k.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Z,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Pe,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-alert-triangle"})]),_:1}),l("div",null,[O[3]||(O[3]=l("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),l("div",$o,[l("h6",So,n(((k=H.stats)==null?void 0:k.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Z,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Pe,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-currency-dollar"})]),_:1}),l("div",null,[O[4]||(O[4]=l("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),l("div",Io,[l("h6",Do,n(ke(((k=H.stats)==null?void 0:k.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Z,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Pe,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-chart-line"})]),_:1}),l("div",null,[O[5]||(O[5]=l("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),l("div",zo,[l("h6",Uo,n(ke(((k=H.stats)==null?void 0:k.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Z,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Pe,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-trending-up"})]),_:1}),l("div",null,[O[6]||(O[6]=l("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),l("div",To,[l("h6",Ao,n(K(((k=H.stats)==null?void 0:k.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Z,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Pe,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-x-circle"})]),_:1}),l("div",null,[O[7]||(O[7]=l("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),l("div",Ho,[l("h6",Mo,n(((k=H.stats)==null?void 0:k.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),Bo=Oe(Ko,[["__scopeId","data-v-124783ae"]]),Fo={class:"d-flex align-center gap-2"},Eo={class:"d-flex align-center gap-2"},Ro={class:"text-center py-8"},qo={class:"d-flex align-center gap-3 py-2"},Lo={class:"font-weight-medium"},No={class:"text-caption text-medium-emphasis"},Oo={class:"text-end"},jo={class:"font-weight-medium"},Jo={class:"text-caption text-medium-emphasis d-flex align-center justify-end gap-1"},Wo={class:"text-center profit-margin-container"},Go={class:"text-center"},Qo={key:0,class:"text-caption text-medium-emphasis mt-1"},Xo={class:"d-flex align-center gap-2"},Zo={class:"text-body-2"},Yo={class:"text-caption text-medium-emphasis"},es={class:"d-flex align-center gap-1"},ts=300*1e3,as=1e3,ls=Re({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","bulk-delete","update:page","update:items-per-page","update:sort-by","update:selected-products"],setup(D,{expose:ke}){const K=D,{currentHPPBreakdown:H,getProductHPPBreakdown:O}=_t(),k=T({}),W=T({}),A=T({}),g=T(new Set),_=T(new Set);let Y=null;const y=m=>{const h=A.value[m];return h?Date.now()-h.timestamp<ts:!1},Q=async()=>{if(_.value.size===0)return;const m=Array.from(_.value);_.value.clear();const h=m.filter(v=>{const U=K.products.find(ee=>(ee.id_product||ee.id)===v);return U&&(U.hpp===void 0||U.hpp===null)});if(h.length===0)return;const i=3;for(let v=0;v<h.length;v+=i){const ee=h.slice(v,v+i).map(async le=>{var ie;if(!(W.value[le]||y(le))){W.value[le]=!0,g.value.add(le);try{if(await O(le,"latest"),(ie=H.value)!=null&&ie.total_hpp){const q=H.value.total_hpp;k.value[le]=q,A.value[le]={data:q,timestamp:Date.now(),attempted:!0}}else A.value[le]={data:0,timestamp:Date.now(),attempted:!0}}catch(q){console.warn(`Could not load HPP for product ${le}:`,q),A.value[le]={data:0,timestamp:Date.now(),attempted:!0}}finally{W.value[le]=!1}}});await Promise.all(ee),v+i<m.length&&await new Promise(le=>setTimeout(le,500))}},me=m=>{if(y(m)){k.value[m]=A.value[m].data;return}g.value.has(m)||(_.value.add(m),Y&&clearTimeout(Y),Y=setTimeout(()=>{Q()},as))},pe=()=>{for(const m of K.products){const h=m.id_product||m.id;h&&(y(h)?k.value[h]=A.value[h].data:!g.value.has(h)&&!W.value[h]&&me(h))}},I=m=>{const h=m.id_product||m.id;return k.value[h]||m.cost||0},ue=m=>{const h=I(m),i=m.price||0;return i<=0||h<=0?0:Math.round((i-h)/i*100)};Yt(()=>{K.products&&K.products.length>0&&pe()}),at(()=>{K.products&&K.products.length>0&&pe()}),ke({refreshHPPData:async m=>{m?(delete A.value[m],delete k.value[m],g.value.delete(m),K.products.find(i=>(i.id_product||i.id)===m)&&me(m)):(A.value={},k.value={},g.value.clear(),_.value.clear(),pe())}});const N=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],oe=m=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),x=m=>new Date(m).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),d=m=>new Date(m).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),w=m=>m<10?"error":m<25?"warning":m<50?"success":"info";return(m,h)=>(f(),E(Z,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",Fo,[e(V,{icon:"tabler-list",class:"coffee-icon"}),h[7]||(h[7]=u(" Data Produk ")),m.totalItems?(f(),E(de,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[u(n(m.totalItems)+" item ",1)]),_:1})):j("",!0)]),l("div",Eo,[m.selectedProducts.length>0?(f(),E(R,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:h[0]||(h[0]=i=>m.$emit("bulk-delete"))},{default:t(()=>[u(" Hapus Terpilih ("+n(m.selectedProducts.length)+") ",1)]),_:1})):j("",!0),e(R,{"prepend-icon":"tabler-plus",color:"coffee",onClick:h[1]||(h[1]=i=>m.$emit("add-product"))},{default:t(()=>h[8]||(h[8]=[u(" Tambah Produk ")])),_:1,__:[8]})])]),_:1}),e(Ue),e(xa,{"model-value":m.selectedProducts,"onUpdate:modelValue":h[3]||(h[3]=i=>m.$emit("update:selected-products",i)),headers:N,items:m.products,"items-length":m.totalItems,loading:m.loading,"items-per-page":m.itemsPerPage,page:m.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:page":h[4]||(h[4]=i=>m.$emit("update:page",i)),"onUpdate:itemsPerPage":h[5]||(h[5]=i=>m.$emit("update:items-per-page",i)),"onUpdate:sortBy":h[6]||(h[6]=i=>m.$emit("update:sort-by",i))},{loading:t(()=>[e(wa,{type:"table-row@10"})]),"no-data":t(()=>[l("div",Ro,[e(V,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),h[10]||(h[10]=l("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),h[11]||(h[11]=l("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(R,{"prepend-icon":"tabler-plus",color:"coffee",onClick:h[2]||(h[2]=i=>m.$emit("add-product"))},{default:t(()=>h[9]||(h[9]=[u(" Tambah Produk Pertama ")])),_:1,__:[9]})])]),"item.name":t(({item:i})=>[l("div",qo,[e(Pe,{image:i.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[i.image_url?j("",!0):(f(),E(V,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),l("div",null,[l("div",Lo,n(i.name),1),l("div",No," SKU: "+n(i.sku||"-"),1)])])]),"item.category":t(({item:i})=>[e(de,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var v;return[u(n(((v=i.category)==null?void 0:v.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:i})=>[l("div",Oo,[l("div",jo,n(oe(i.price)),1),l("div",Jo,[l("span",null,"HPP: "+n(oe(I(i))),1),W.value[i.id_product||i.id]&&I(i)>0?(f(),E(dt,{key:0,indeterminate:"",size:"12",width:"2"})):j("",!0)])])]),"item.profit_margin":t(({item:i})=>[l("div",Wo,[e(de,{color:w(ue(i)),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[u(n(ue(i))+"% ",1)]),_:2},1032,["color"])])]),"item.stock":t(({item:i})=>[l("div",Go,[e(de,{color:i.stock_status==="out_of_stock"?"error":i.stock_status==="low_stock"?"warning":"success",size:"small",variant:"tonal"},{default:t(()=>[u(n(i.stock_status==="out_of_stock"?"Habis":i.stock_status==="low_stock"?"Rendah":"Aman"),1)]),_:2},1032,["color"]),i.min_stock?(f(),X("div",Qo," Min: "+n(i.min_stock),1)):j("",!0)])]),"item.active":t(({item:i})=>[l("div",Xo,[e(de,{color:i.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[u(n(i.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),i.featured?(f(),E(Me,{key:0,text:"Produk Unggulan"},{activator:t(({props:v})=>[e(V,we(v,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):j("",!0)])]),"item.created_at":t(({item:i})=>[l("div",Zo,n(x(i.created_at??"")),1),l("div",Yo,n(d((i==null?void 0:i.created_at)??"")),1)]),"item.actions":t(({item:i})=>[l("div",es,[e(Me,{text:"Kelola Komposisi"},{activator:t(({props:v})=>[e(R,we(v,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:U=>m.$emit("open-composition-dialog",i)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Kelola Variant"},{activator:t(({props:v})=>[e(R,we(v,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:U=>m.$emit("open-variant-dialog",i)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Edit Produk"},{activator:t(({props:v})=>[e(R,we(v,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:U=>m.$emit("edit-product",i)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:i.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:v})=>{var U;return[e(R,we(v,{icon:i.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:i.active?"success":"error",loading:((U=m.toggleLoading)==null?void 0:U[i.id_product])||!1,onClick:ee=>m.$emit("toggle-active",i)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Me,{text:i.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:v})=>[e(R,we(v,{icon:i.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:i.featured?"warning":"default",onClick:U=>m.$emit("toggle-featured",i)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Me,{text:"Hapus Produk"},{activator:t(({props:v})=>[e(R,we(v,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:U=>m.$emit("delete-product",i)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),os=Oe(ls,[["__scopeId","data-v-0df0c22e"]]),ss={class:"d-flex align-center gap-3"},is={class:"text-h5 font-weight-bold"},ns={class:"text-h6"},rs={class:"text-body-1"},us={class:"d-flex flex-column"},ds={class:"font-weight-medium"},cs={class:"text-caption text-grey-darken-1"},ms={class:"font-weight-medium"},vs={key:0,class:"text-caption"},ps={key:1,class:"text-grey-lighten-1 text-caption"},fs={class:"v-data-table__footer"},gs={class:"pa-4 d-flex justify-space-between align-center"},_s={class:"text-subtitle-1 font-weight-bold"},ks={class:"text-subtitle-2 text-uppercase"},ys={class:"text-h6 font-weight-bold my-2"},bs={class:"text-caption"},Ut=Re({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup(D,{emit:ke}){const K=D,H=ke,O=T(!1),k=T(null),W=T(null),A=T(!1),g=T(!1),_=T("latest"),Y=T(0),y=T(0),Q=T(""),me=T(0),pe=T(!1),I=T(!1),ue=T(""),ce=T(""),N=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],oe=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],x=q=>!q||q===0?"":new Intl.NumberFormat("id-ID").format(q),d=q=>{if(!q)return 0;const z=q.replace(/[^\d]/g,"");return parseInt(z)||0},w=q=>{var c;const z=d(q);if(y.value=z,Q.value=x(z),(c=k.value)!=null&&c.total_hpp&&z>0){const o=k.value.total_hpp;Y.value=o>0?Math.round((z-o)/o*100):0}else Y.value=0},m=q=>Ae(q),h=async(q,z)=>{O.value=!0;try{await new Promise(c=>setTimeout(c,500)),k.value={total_hpp:15e4,method:z,calculated_at:new Date().toISOString(),items:[{item_name:"Tepung Terigu",item_code:"TPNG001",quantity_needed:.5,unit:"kg",cost_per_unit:15e3,total_cost:7500,is_critical:!1,notes:null},{item_name:"Gula Pasir",item_code:"GUL001",quantity_needed:.25,unit:"kg",cost_per_unit:12e3,total_cost:3e3,is_critical:!1,notes:null},{item_name:"Telur Ayam",item_code:"TLR001",quantity_needed:3,unit:"pcs",cost_per_unit:3e3,total_cost:9e3,is_critical:!0,notes:"Price volatile"}]},A.value=!0}catch(c){console.error("Error loading HPP breakdown:",c),A.value=!1}finally{O.value=!1}},i=async(q,z)=>{O.value=!0;try{if(await new Promise(c=>setTimeout(c,1e3)),k.value){switch(z){case"latest":k.value.total_hpp=Math.round(k.value.total_hpp*1.1);break;case"average":k.value.total_hpp=Math.round(k.value.total_hpp*1.05);break;default:k.value.total_hpp=Math.round(k.value.total_hpp*1.03)}k.value.calculated_at=new Date().toISOString()}}catch(c){throw c}finally{O.value=!1}},v=async(q,z,c,o,s)=>{O.value=!0;try{return await new Promise(P=>setTimeout(P,1e3)),{data:{new_price:c,markup_percentage:k.value?Math.round((c-k.value.total_hpp)/k.value.total_hpp*100):0}}}catch(P){throw P}finally{O.value=!1}},U=async()=>{var q,z,c;if(K.variantId)try{const o=localStorage.getItem("token"),s=await qe.get(`/api/variants/${K.variantId}`,{headers:{Authorization:`Bearer ${o}`,Accept:"application/json"}});if(s.data.success&&s.data.data){const P=s.data.data;if(P.price&&P.price>0)y.value=Number(P.price),Q.value=x(Number(P.price));else if((q=k.value)!=null&&q.total_hpp){const fe=Math.round(k.value.total_hpp*1.2);y.value=fe,Q.value=x(fe)}if((z=k.value)!=null&&z.total_hpp&&y.value>0){const fe=k.value.total_hpp;Y.value=fe>0?Math.round((y.value-fe)/fe*100):0}me.value+=1}}catch(o){console.warn("Could not load target price, using default:",o),(c=k.value)!=null&&c.total_hpp&&(y.value=Math.round(k.value.total_hpp*1.2))}},ee=async()=>{K.variantId&&(await h(K.variantId,_.value),await U())},le=async()=>{var q,z;if(K.variantId)try{await i(K.variantId,_.value),ue.value=`HPP successfully updated using ${_.value} method!`,pe.value=!0,H("hpp-updated"),await ee()}catch(c){console.error("Error updating HPP:",c),ce.value=((z=(q=c==null?void 0:c.response)==null?void 0:q.data)==null?void 0:z.message)||"Failed to update HPP",I.value=!0}},ie=async()=>{var q,z,c,o,s,P,fe,J,_e,De;if(K.variantId&&((q=k.value)!=null&&q.total_hpp)&&y.value)try{const te=await v(K.variantId,_.value,y.value,!0,!0);if((z=te==null?void 0:te.data)!=null&&z.new_price){if(y.value=te.data.new_price,Q.value=x(te.data.new_price),((c=te==null?void 0:te.data)==null?void 0:c.markup_percentage)!==void 0)Y.value=te.data.markup_percentage;else{const He=k.value.total_hpp;Y.value=He>0?Math.round((te.data.new_price-He)/He*100):0}me.value+=1,await ft()}K.variantId&&await h(K.variantId,_.value),ue.value=`Price successfully updated to ${m(((o=te==null?void 0:te.data)==null?void 0:o.new_price)||y.value)}!`,pe.value=!0,H("price-updated",{variantId:K.variantId,oldPrice:(s=te==null?void 0:te.data)==null?void 0:s.old_price,newPrice:(P=te==null?void 0:te.data)==null?void 0:P.new_price,hpp:(fe=te==null?void 0:te.data)==null?void 0:fe.hpp,markupPercentage:(J=te==null?void 0:te.data)==null?void 0:J.markup_percentage})}catch(te){console.error("Error applying price suggestion:",te),ce.value=((De=(_e=te==null?void 0:te.response)==null?void 0:_e.data)==null?void 0:De.message)||"Failed to update variant price",I.value=!0}};return he(()=>K.modelValue,q=>{q&&K.variantId&&ee()}),he(()=>K.variantId,q=>{q&&K.modelValue&&ee()}),he(_,async()=>{K.variantId&&await ee()}),he([()=>{var q;return(q=k.value)==null?void 0:q.total_hpp},y],()=>{var q;if((q=k.value)!=null&&q.total_hpp&&y.value>0){const z=k.value.total_hpp;Y.value=z>0?Math.round((y.value-z)/z*100):0}else Y.value=0}),he(y,q=>{q!==d(Q.value)&&(Q.value=x(q))}),(q,z)=>(f(),X(ze,null,[e(Le,{"model-value":q.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":z[6]||(z[6]=c=>q.$emit("update:modelValue",c))},{default:t(()=>[e(Z,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",ss,[e(V,{icon:"mdi-calculator-variant",size:"24"}),l("span",null,"HPP Breakdown - "+n(q.variantName||"Variant"),1)]),e(R,{icon:"mdi-close",size:"small",variant:"text",onClick:z[0]||(z[0]=c=>q.$emit("update:modelValue",!1))})]),_:1}),e(ae,null,{default:t(()=>[e(Ve,{class:"mb-4"},{default:t(()=>[e(S,{cols:"12",md:"6"},{default:t(()=>[e(Be,{modelValue:_.value,"onUpdate:modelValue":[z[1]||(z[1]=c=>_.value=c),ee],items:N,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(R,{color:"primary",variant:"elevated",loading:O.value,"prepend-icon":"mdi-update",block:"",onClick:le},{default:t(()=>[u(" Update HPP with "+n(_.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),A.value?(f(),E(Z,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(ae,null,{default:t(()=>[e(Ve,{align:"center"},{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>{var c;return[z[11]||(z[11]=l("div",{class:"text-subtitle-2"}," Total HPP ",-1)),l("div",is,n(m(((c=k.value)==null?void 0:c.total_hpp)||0)),1)]}),_:1,__:[11]}),e(S,{cols:"12",md:"4"},{default:t(()=>{var c;return[z[12]||(z[12]=l("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),l("div",ns,n((c=N.find(o=>{var s;return o.value===((s=k.value)==null?void 0:s.method)}))==null?void 0:c.title),1)]}),_:1,__:[12]}),e(S,{cols:"12",md:"4"},{default:t(()=>{var c;return[z[13]||(z[13]=l("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),l("div",rs,n((c=k.value)!=null&&c.calculated_at?new Date(k.value.calculated_at).toLocaleString():"-"),1)]}),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):j("",!0),A.value?(f(),E(Z,{key:1},{default:t(()=>{var c;return[e(xe,null,{default:t(()=>{var o,s;return[e(V,{icon:"mdi-format-list-bulleted",class:"me-2"}),u(" Item Breakdown ("+n(((s=(o=k.value)==null?void 0:o.items)==null?void 0:s.length)||0)+" items) ",1)]}),_:1}),e(Va,{headers:oe,items:((c=k.value)==null?void 0:c.items)||[],"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:o})=>[l("div",us,[l("span",ds,n(o.item_name),1),l("span",cs,n(o.item_code),1)])]),"item.quantity_needed":t(({item:o})=>[l("span",ms,n(o.quantity_needed)+" "+n(o.unit),1)]),"item.cost_per_unit":t(({item:o})=>[l("span",null,n(m(o.cost_per_unit)),1)]),"item.total_cost":t(({item:o})=>[e(de,{color:o.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[u(n(m(o.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:o})=>[e(de,{color:o.is_critical?"error":"success","prepend-icon":o.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[u(n(o.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:o})=>[o.notes?(f(),X("span",vs,n(o.notes),1)):(f(),X("span",ps,"â"))]),bottom:t(()=>{var o;return[l("div",fs,[e(Ue),l("div",gs,[l("div",_s," Total HPP: "+n(m(((o=k.value)==null?void 0:o.total_hpp)||0)),1),e(de,{color:"info",variant:"elevated"},{default:t(()=>{var s,P;return[u(n(((P=(s=k.value)==null?void 0:s.items)==null?void 0:P.length)||0)+" items ",1)]}),_:1})])])]}),_:1},8,["items"])]}),_:1})):j("",!0),A.value?(f(),E(Z,{key:2,class:"mt-4"},{default:t(()=>[e(xe,null,{default:t(()=>[e(V,{icon:"mdi-cash-multiple",class:"me-2"}),z[14]||(z[14]=u(" Price Suggestion "))]),_:1,__:[14]}),e(ae,null,{default:t(()=>[e(Ve,null,{default:t(()=>[e(S,{cols:"12",md:"6"},{default:t(()=>{var c;return[(f(),E(be,{key:me.value,modelValue:Q.value,"onUpdate:modelValue":[z[2]||(z[2]=o=>Q.value=o),w],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${m(((c=k.value)==null?void 0:c.total_hpp)||0)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>{var c;return[(f(),E(be,{key:me.value,modelValue:Y.value,"onUpdate:modelValue":z[3]||(z[3]=o=>Y.value=o),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${m(y.value-(((c=k.value)==null?void 0:c.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e(Ve,{class:"mt-2"},{default:t(()=>[e(S,{cols:"12",md:"12"},{default:t(()=>[e(R,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:O.value,disabled:!y.value||y.value<=0,block:"",onClick:ie},{default:t(()=>z[15]||(z[15]=[u(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0),g.value?(f(),E(Z,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(xe,null,{default:t(()=>[e(V,{icon:"mdi-lightbulb",class:"me-2"}),z[16]||(z[16]=u(" Price Suggestions "))]),_:1,__:[16]}),e(ae,null,{default:t(()=>[e(Ve,null,{default:t(()=>[(f(!0),X(ze,null,Je(W.value.suggestions,(c,o)=>(f(),E(S,{key:o,cols:"12",md:"4"},{default:t(()=>[e(Z,{variant:"elevated"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[l("div",ks,n(o)+" Method ",1),l("div",ys,n(m(c.suggested_price)),1),l("div",bs,[u(" HPP: "+n(m(c.hpp)),1),z[17]||(z[17]=l("br",null,null,-1)),u(" Markup: "+n(c.markup_percentage.toFixed(1))+"%",1),z[18]||(z[18]=l("br",null,null,-1)),u(" Margin: "+n(c.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):j("",!0),!A.value&&!O.value?(f(),E(Z,{key:4,variant:"outlined"},{default:t(()=>[e(ae,{class:"text-center py-8"},{default:t(()=>[e(V,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),z[20]||(z[20]=l("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),z[21]||(z[21]=l("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:z[4]||(z[4]=c=>q.$emit("update:modelValue",!1))},{default:t(()=>z[19]||(z[19]=[u(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):j("",!0)]),_:1}),e(Ee,{class:"pa-4"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:z[5]||(z[5]=c=>q.$emit("update:modelValue",!1))},{default:t(()=>z[22]||(z[22]=[u(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(tt,{modelValue:pe.value,"onUpdate:modelValue":z[8]||(z[8]=c=>pe.value=c),color:"success",location:"top"},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:z[7]||(z[7]=c=>pe.value=!1)},{default:t(()=>z[23]||(z[23]=[u(" Close ")])),_:1,__:[23]})]),default:t(()=>[u(n(ue.value)+" ",1)]),_:1},8,["modelValue"]),e(tt,{modelValue:I.value,"onUpdate:modelValue":z[10]||(z[10]=c=>I.value=c),color:"error",location:"top"},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:z[9]||(z[9]=c=>I.value=!1)},{default:t(()=>z[24]||(z[24]=[u(" Close ")])),_:1,__:[24]})]),default:t(()=>[u(n(ce.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),hs={class:"d-flex align-center gap-2"},xs={class:"pa-4",style:{"background-color":"#2A2A2A"}},ws={key:0,class:"d-flex align-center gap-3"},Vs={class:"text-h6 text-white font-weight-bold"},Ps={class:"d-flex align-center gap-4 mt-1"},Cs={class:"text-caption text-grey-lighten-1"},$s={class:"text-caption text-grey-lighten-1"},Ss={class:"pa-4 add-item-form"},Is={class:"d-flex align-center justify-space-between mb-4"},Ds={class:"d-flex align-center gap-2"},zs={class:"text-h6"},Us={key:0,class:"text-error"},Ts={key:1},As={class:"d-flex align-center"},Hs={class:"pa-4 text-center"},Ms={class:"pa-4 pt-0"},Ks={class:"d-flex align-center justify-between mb-4"},Bs={class:"text-h6"},Fs={key:0,class:"composition-list"},Es={class:"d-flex align-center justify-between"},Rs={class:"d-flex align-center gap-3"},qs={class:"font-weight-medium"},Ls={class:"text-caption text-medium-emphasis"},Ns={class:"font-weight-medium text-primary"},Os={class:"d-flex align-center gap-2"},js={class:"text-center"},Js={key:0,class:"text-body-2 text-medium-emphasis"},Ws={class:"text-center"},Gs={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},Qs=Re({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup(D,{emit:ke}){const K=D,H=ke,O=T(),k=T(!1),W=T(!1),A=T([]),g=T([]),_=T(!1),Y=T(null),y=T(!1),Q=T(null),me=T(!1),pe=T(!1),I=T(""),ue=T(""),ce=T("success"),N=T(!1),oe=ve({get:()=>K.modelValue,set:r=>{H("update:modelValue",r)}}),x=()=>({item_id:null,quantity:1,is_critical:!1}),d=T(x()),w=ve(()=>!d.value.item_id||!Array.isArray(A.value)?null:A.value.find(r=>r.id_item===d.value.item_id)),m=ve(()=>!w.value||_.value&&Y.value!==null?null:g.value.find(r=>{var a,p;return r.name===((a=w.value)==null?void 0:a.name)||r.id&&((p=w.value)==null?void 0:p.id_item)&&r.id===w.value.id_item})),h=ve(()=>{if(!w.value)return"";if(_.value&&Y.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(m.value){const r=m.value;return`Item sudah ada dengan quantity ${r.quantity} ${r.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${v(w.value)} ${w.value.unit}`}),i=ve(()=>Array.isArray(A.value)?A.value.filter(r=>v(r)>0):[]),v=r=>{var a,p;return((a=r.inventory)==null?void 0:a.current_stock)||((p=r.inventory)==null?void 0:p.available_stock)||r.current_stock||0},U=()=>W.value?"Memuat items...":!A.value||A.value.length===0?"Tidak ada item tersedia":i.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",ee=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r),le=r=>{switch(r){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},ie=r=>{switch(r){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},q=(r,a,p)=>{var C,ne,re,ye,se,$e,Se,Te;if(!a)return!0;const F=a.toLowerCase().trim(),M=((ne=(C=p==null?void 0:p.raw)==null?void 0:C.name)==null?void 0:ne.toLowerCase())||"",$=((ye=(re=p==null?void 0:p.raw)==null?void 0:re.item_code)==null?void 0:ye.toLowerCase())||"",b=(($e=(se=p==null?void 0:p.raw)==null?void 0:se.unit)==null?void 0:$e.toLowerCase())||"",L=((Te=(Se=p==null?void 0:p.raw)==null?void 0:Se.description)==null?void 0:Te.toLowerCase())||"";return M.includes(F)||$.includes(F)||b.includes(F)||L.includes(F)},z=async()=>{var r,a,p;W.value=!0;try{const F=await qe.get("/api/items?per_page=all&include=inventory"),M=((a=(r=F.data)==null?void 0:r.data)==null?void 0:a.data)||((p=F.data)==null?void 0:p.data)||F.data||[];A.value=Array.isArray(M)?M:[]}catch(F){console.error("Error loading items:",F),F!=null&&F.response&&(console.error("API Error Status:",F.response.status),console.error("API Error Data:",F.response.data)),A.value=[]}finally{W.value=!1}},c=async()=>{var r,a,p,F,M;if(!(!((r=K.variant)!=null&&r.id)&&!((a=K.variant)!=null&&a.id_variant)))try{const $=K.variant.id||K.variant.id_variant,b=await qe.get(`/api/variant-items/variant/${$}`),L=((F=(p=b.data)==null?void 0:p.data)==null?void 0:F.composition)||((M=b.data)==null?void 0:M.composition)||[];if(!Array.isArray(L)){console.warn("API response composition is not an array:",L),g.value=[];return}g.value=L.map(C=>{var ne,re,ye,se,$e,Se,Te,Xe,Ze,nt;return{id:C.id_variant_item||C.id,name:((ne=C.item)==null?void 0:ne.name)||C.name,quantity:parseFloat(C.quantity_needed||C.quantity||C.qty||"1"),unit:C.unit||((re=C.item)==null?void 0:re.unit)||"pcs",stock:((se=(ye=C.item)==null?void 0:ye.inventory)==null?void 0:se.current_stock)||((Se=($e=C.item)==null?void 0:$e.inventory)==null?void 0:Se.available_stock)||((Te=C.item)==null?void 0:Te.current_stock)||C.stock||0,price:parseFloat(((Xe=C.item)==null?void 0:Xe.cost_per_unit)||((Ze=C.item)==null?void 0:Ze.price)||C.price||"0"),is_critical:C.is_critical||!1,inventory:(nt=C.item)!=null&&nt.inventory?{current_stock:C.item.inventory.current_stock||0,available_stock:C.item.inventory.available_stock||0,stock_status:C.item.inventory.stock_status||"unknown",reorder_level:C.item.inventory.reorder_level||0}:null}})}catch($){console.error("Error loading composition items:",$),$!=null&&$.response&&(console.error("API Error Status:",$.response.status),console.error("API Error Data:",$.response.data)),g.value=[]}},o=async()=>{var M,$;const{valid:r}=await O.value.validate();if(!r||!w.value)return;const a=w.value.name,p=w.value.id_item,F=d.value.quantity;if(_.value&&Y.value!==null)g.value[Y.value].quantity,g.value[Y.value].quantity=F,g.value[Y.value].is_critical=d.value.is_critical,_.value=!1,Y.value=null;else{const b=g.value.findIndex(L=>L.name===a||L.id&&p&&L.id===p);if(b!==-1){const ne=g.value[b].quantity+F;g.value[b].quantity=ne}else{const L={name:a,quantity:F,unit:w.value.unit,stock:((M=w.value.inventory)==null?void 0:M.current_stock)||(($=w.value.inventory)==null?void 0:$.available_stock)||w.value.current_stock||0,price:w.value.cost_per_unit||0,is_critical:d.value.is_critical,inventory:w.value.inventory?{current_stock:w.value.inventory.current_stock||0,available_stock:w.value.inventory.available_stock||0,stock_status:w.value.inventory.stock_status||"unknown",reorder_level:w.value.inventory.reorder_level||0}:null};g.value.push(L)}}d.value=x()},s=(r,a)=>{const p=A.value.find(F=>F.name===r.name||F.id_item===r.id);p?(_.value=!0,Y.value=a,d.value={item_id:p.id_item,quantity:r.quantity,is_critical:r.is_critical||!1},setTimeout(()=>{const F=document.querySelector(".add-item-form");F&&F.scrollIntoView({behavior:"smooth",block:"start"})},100)):console.error("â Could not find item in available items")},P=()=>{_.value=!1,Y.value=null,d.value=x()},fe=(r,a)=>{Q.value={item:r,index:a},y.value=!0},J=async()=>{var F,M,$;if(!Q.value)return;const{item:r,index:a}=Q.value;r.name;const p=r.id;me.value=!0;try{p&&await qe.delete(`/api/variant-items/${p}`),y.value=!1,Q.value=null,await c(),H("save")}catch(b){console.error("â Error deleting item:",b),console.error("â Error details:",(F=b.response)==null?void 0:F.data),alert("Gagal menghapus item: "+((($=(M=b.response)==null?void 0:M.data)==null?void 0:$.message)||b.message))}finally{me.value=!1}},_e=()=>{y.value=!1,Q.value=null},De=()=>{switch(ce.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},te=()=>{switch(ce.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},He=()=>{switch(ce.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},Ce=()=>{switch(ce.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Ge=async()=>{var r,a,p,F;if(!((r=K.variant)!=null&&r.id)&&!((a=K.variant)!=null&&a.id_variant)){console.error("No variant ID found");return}k.value=!0;try{const M=K.variant.id||K.variant.id_variant;if(g.value.some(b=>b.id)){const b={items:g.value.map(C=>{const ne=A.value.find(re=>re.name===C.name);return{id_variant_item:C.id,quantity_needed:Number(C.quantity),unit:C.unit,is_critical:C.is_critical||!1}}).filter(C=>C.id_variant_item&&C.quantity_needed>0)},L=await qe.post("/api/variant-items/bulk-update",b)}else{const b={id_variant:M,items:g.value.map(C=>{const ne=A.value.find(re=>re.name===C.name);return{id_item:ne==null?void 0:ne.id_item,quantity_needed:Number(C.quantity),unit:C.unit,is_critical:C.is_critical||!1}}).filter(C=>C.id_item&&C.quantity_needed>0)},L=await qe.post("/api/variant-items/bulk-store",b)}H("save"),Fe()}catch(M){console.error("Error saving composition:",M),alert("Gagal menyimpan komposisi: "+(((F=(p=M.response)==null?void 0:p.data)==null?void 0:F.message)||M.message))}finally{k.value=!1}},Qe=()=>{N.value=!0},Fe=()=>{oe.value=!1,d.value=x(),g.value=[],_.value=!1,Y.value=null};return he(()=>K.modelValue,r=>{r?(d.value=x(),z(),c()):(_.value=!1,Y.value=null)}),he(()=>d.value.item_id,r=>{r&&w.value}),at(()=>{z()}),(r,a)=>{var p,F,M;return f(),X(ze,null,[e(Le,{modelValue:oe.value,"onUpdate:modelValue":a[3]||(a[3]=$=>oe.value=$),"max-width":"1000px",persistent:""},{default:t(()=>[e(Z,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[l("div",hs,[e(V,{icon:"mdi-delete",color:"white"}),a[9]||(a[9]=l("span",null,"Kelola Komposisi Item",-1))]),e(R,{icon:"mdi-close",variant:"text",color:"white",onClick:Fe,disabled:k.value},null,8,["disabled"])]),_:1}),e(ae,{class:"pa-0"},{default:t(()=>[l("div",xs,[r.variant?(f(),X("div",ws,[e(V,{icon:"mdi-coffee",size:"32",color:"white"}),l("div",null,[l("h3",Vs,n(r.variant.name),1),l("div",Ps,[l("span",Cs,"SKU: "+n(r.variant.sku),1),l("span",$s,"Harga: "+n(ee(r.variant.price||0)),1),e(de,{color:"success",size:"small",variant:"tonal"},{default:t(()=>a[10]||(a[10]=[u(" Stok Aman ")])),_:1,__:[10]})])])])):j("",!0)]),l("div",Ss,[l("div",Is,[l("div",Ds,[e(V,{icon:"mdi-plus-circle",color:"success"}),l("h4",zs,n(_.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(bt,{ref_key:"form",ref:O,onSubmit:kt(o,["prevent"])},{default:t(()=>[e(Ve,null,{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>[e(yt,{modelValue:d.value.item_id,"onUpdate:modelValue":a[0]||(a[0]=$=>d.value.item_id=$),items:i.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[$=>!!$||"Item wajib dipilih"],loading:W.value,disabled:W.value||A.value&&A.value.length===0,"no-data-text":U(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":q},{"prepend-inner":t(()=>[e(V,{icon:"mdi-package",size:"16"})]),item:t(({props:$,item:b})=>[e(je,we($,{title:b.raw.name,disabled:v(b.raw)<=0,class:["pa-3",{"text-disabled":v(b.raw)<=0}]}),{prepend:t(()=>[e(V,{icon:"mdi-package-variant",color:v(b.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[l("div",{class:We(["text-caption",v(b.raw)<=0?"text-disabled":"text-medium-emphasis"])},[v(b.raw)<=0?(f(),X("span",Us,[e(V,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),a[11]||(a[11]=u(" Stok Habis "))])):(f(),X("span",Ts," Stok: "+n(v(b.raw))+" "+n(b.raw.unit),1))],2)]),append:t(()=>{var L;return[v(b.raw)>0?(f(),E(de,{key:0,size:"x-small",color:le(((L=b.raw.inventory)==null?void 0:L.stock_status)||b.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var C;return[u(n(ie(((C=b.raw.inventory)==null?void 0:C.stock_status)||b.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(f(),E(de,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>a[12]||(a[12]=[u(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:$})=>[l("div",As,[e(V,{icon:"mdi-package-variant",size:"16",class:"me-2"}),l("span",null,n($.raw.name),1)])]),"no-data":t(()=>[l("div",Hs,[e(V,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),a[13]||(a[13]=l("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),a[14]||(a[14]=l("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(be,{modelValue:d.value.quantity,"onUpdate:modelValue":a[1]||(a[1]=$=>d.value.quantity=$),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[$=>!!$||"Jumlah wajib diisi",$=>$>0||"Jumlah harus lebih dari 0"],hint:h.value,"persistent-hint":"",color:m.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>{var $;return[e(be,{"model-value":(($=w.value)==null?void 0:$.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!w.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e(V,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e(S,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(Ye,{modelValue:d.value.is_critical,"onUpdate:modelValue":a[2]||(a[2]=$=>d.value.is_critical=$),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(R,{color:_.value?"primary":m.value?"warning":"#D4A574",onClick:o,loading:k.value,disabled:!d.value.item_id||!d.value.quantity,block:""},{default:t(()=>[e(V,{icon:_.value?"mdi-content-save":m.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),u(" "+n(_.value?"Update":m.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),_.value?(f(),E(R,{key:0,color:"grey",variant:"outlined",onClick:P,size:"small",block:""},{default:t(()=>[e(V,{icon:"mdi-close",class:"me-1"}),a[15]||(a[15]=u(" Batal "))]),_:1,__:[15]})):j("",!0)]),_:1})]),_:1})]),_:1},512)]),l("div",Ms,[l("div",Ks,[l("h4",Bs,"Daftar Item Komposisi ("+n(g.value.length)+")",1)]),g.value.length>0?(f(),X("div",Fs,[(f(!0),X(ze,null,Je(g.value,($,b)=>(f(),E(Z,{key:b,variant:"outlined",class:"mb-3"},{default:t(()=>[e(ae,{class:"pa-3"},{default:t(()=>{var L,C,ne,re,ye,se,$e;return[l("div",Es,[l("div",Rs,[e(V,{icon:"mdi-check-circle",color:"success"}),l("div",null,[l("div",qs,n($.name),1),l("div",Ls,[l("span",Ns,"Dibutuhkan: "+n($.quantity)+" "+n($.unit),1),a[16]||(a[16]=u(" â¢ ")),l("span",{class:We({"text-success":(((L=$.inventory)==null?void 0:L.current_stock)??0)>(((C=$.inventory)==null?void 0:C.reorder_level)??0),"text-warning":(((ne=$.inventory)==null?void 0:ne.current_stock)??0)<=(((re=$.inventory)==null?void 0:re.reorder_level)??0)&&(((ye=$.inventory)==null?void 0:ye.current_stock)??0)>0,"text-error":(((se=$.inventory)==null?void 0:se.current_stock)??0)<=0})}," Stok: "+n((($e=$.inventory)==null?void 0:$e.current_stock)||$.stock||0)+" "+n($.unit),3),u(" â¢ "+n(ee($.price)),1)])])]),l("div",Os,[e(R,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:Se=>s($,b)},null,8,["onClick"]),e(R,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Se=>fe($,b)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(f(),E(Z,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e(V,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),a[17]||(a[17]=l("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(Ee,{class:"px-6 pb-6"},{default:t(()=>[e(R,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:Qe},{default:t(()=>a[18]||(a[18]=[u(" Setting HPP ")])),_:1,__:[18]}),e(Ne),e(R,{variant:"outlined",onClick:Fe,disabled:k.value},{default:t(()=>a[19]||(a[19]=[u(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(R,{color:"#D4A574",onClick:Ge,loading:k.value,disabled:g.value.length===0},{default:t(()=>a[20]||(a[20]=[u(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ut,{modelValue:N.value,"onUpdate:modelValue":a[4]||(a[4]=$=>N.value=$),"variant-id":((p=r.variant)==null?void 0:p.id)||((F=r.variant)==null?void 0:F.id_variant),"variant-name":(M=r.variant)==null?void 0:M.name,onHppUpdated:a[5]||(a[5]=$=>H("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Le,{modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=$=>y.value=$),"max-width":"400px",persistent:""},{default:t(()=>[e(Z,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e(V,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),a[21]||(a[21]=u(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(Ue),e(ae,{class:"pa-6"},{default:t(()=>[l("div",js,[e(V,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),a[24]||(a[24]=l("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),Q.value?(f(),X("div",Js,[l("strong",null,n(Q.value.item.name),1),a[22]||(a[22]=l("br",null,null,-1)),u(" Dibutuhkan: "+n(Q.value.item.quantity)+" "+n(Q.value.item.unit),1)])):j("",!0),e(Ke,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>a[23]||(a[23]=[l("strong",null,"Perhatian:",-1),u(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(Ee,{class:"px-6 pb-6"},{default:t(()=>[e(R,{variant:"outlined",onClick:_e,disabled:me.value,class:"flex-grow-1"},{default:t(()=>a[25]||(a[25]=[u(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(R,{color:"error",onClick:J,loading:me.value,class:"flex-grow-1"},{default:t(()=>a[26]||(a[26]=[u(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Le,{modelValue:pe.value,"onUpdate:modelValue":a[8]||(a[8]=$=>pe.value=$),"max-width":"450px",persistent:""},{default:t(()=>[e(Z,null,{default:t(()=>[e(xe,{class:We(["d-flex align-center justify-center text-h6",He()])},{default:t(()=>[e(V,{icon:De(),color:te(),class:"me-2",size:"24"},null,8,["icon","color"]),u(" "+n(ue.value),1)]),_:1},8,["class"]),e(Ue),e(ae,{class:"pa-6"},{default:t(()=>[l("div",Ws,[e(V,{icon:De(),color:te(),size:"64",class:"mb-4"},null,8,["icon","color"]),l("div",Gs,n(I.value),1),e(Ke,{type:ce.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[ce.value==="success"?(f(),X(ze,{key:0},[a[27]||(a[27]=l("strong",null,"Berhasil!",-1)),a[28]||(a[28]=u(" Perubahan telah disimpan. "))],64)):ce.value==="info"?(f(),X(ze,{key:1},[a[29]||(a[29]=l("strong",null,"Informasi:",-1)),a[30]||(a[30]=u(" Item telah diperbarui sesuai permintaan. "))],64)):(f(),X(ze,{key:2},[a[31]||(a[31]=l("strong",null,"Perhatian:",-1)),a[32]||(a[32]=u(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(Ee,{class:"px-6 pb-6"},{default:t(()=>[e(Ne),e(R,{color:Ce(),onClick:a[7]||(a[7]=$=>pe.value=!1),class:"px-6"},{default:t(()=>[e(V,{icon:"mdi-check",class:"me-1"}),a[33]||(a[33]=u(" OK "))]),_:1,__:[33]},8,["color"]),e(Ne)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Xs=Oe(Qs,[["__scopeId","data-v-d2ce0c17"]]),Zs={class:"d-flex align-center gap-2"},Ys={class:"mt-2"},ei={key:0,class:"mt-1 font-weight-medium"},ti={key:1,class:"mt-1 text-warning"},ai=Re({__name:"CreateVariantDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save"],setup(D,{emit:ke}){const K=D,H=ke,O=T(),k=T(!1),W=T(!1),A=T([]),g=T({name:"",selectedProduct:null,selectedProductId:null,active:!0}),_=[x=>!!x||"Nama variant wajib diisi",x=>x.length>=3||"Nama variant minimal 3 karakter"],Y=[x=>!!x||"Produk wajib dipilih"],y=(x,d="success")=>{const w=document.createElement("div");w.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${d==="success"?"#4CAF50":"#f44336"};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 9999;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
  `;const m=document.createElement("span");if(m.innerHTML=d==="success"?"â":"â",m.style.cssText=`
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    font-weight: bold;
  `,w.appendChild(m),w.appendChild(document.createTextNode(x)),!document.querySelector("#snackbar-styles")){const h=document.createElement("style");h.id="snackbar-styles",h.textContent=`
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `,document.head.appendChild(h)}document.body.appendChild(w),setTimeout(()=>{w.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{w.parentNode&&w.parentNode.removeChild(w)},300)},3e3)},Q=async()=>{W.value=!0;try{const x=await qe.get("/api/products");A.value=x.data.data||x.data||[]}catch(x){console.error("Gagal mengambil data produk:",x),A.value=[]}finally{W.value=!1}},me=x=>{!x&&A.value.length===0&&Q()},pe=x=>{g.value.selectedProduct=x,x?g.value.selectedProductId=x.id:g.value.selectedProductId=null},I=ve(()=>g.value.selectedProduct?g.value.selectedProduct:g.value.selectedProductId&&A.value.length>0?A.value.find(d=>d.id===g.value.selectedProductId):null),ue=()=>{const x=I.value;if(!x||!g.value.name)return"";const d=x.sku||"PROD",w=g.value.name.replace(/\s+/g,"").toUpperCase().substring(0,3),m=Date.now().toString().slice(-4);return`${d}-${w}-${m}`},ce=async()=>{var w,m;if(k.value)return;const{valid:x}=await O.value.validate();if(!x)return;const d=I.value;if(!d){y("Produk tidak ditemukan","error");return}if(!d.id&&!d.id_product){y("ID Produk tidak valid","error"),console.error("Product missing ID:",d);return}k.value=!0;try{const h={id_product:d.id||d.id_product,name:g.value.name,sku:ue(),price:0,cost_price:null,barcode:null,variant_values:[],active:g.value.active},i=await qe.post("/api/variants",h);if(i.data.success!==!1&&(i.status===200||i.status===201))y("Variant berhasil dibuat!","success"),H("save"),oe();else throw new Error(i.data.message||"Gagal membuat variant")}catch(h){const i=((m=(w=h.response)==null?void 0:w.data)==null?void 0:m.message)||h.message||"Gagal membuat variant";y(i,"error"),console.error("Save variant error:",h)}finally{k.value=!1}},N=()=>{var x;g.value={name:"",selectedProduct:null,selectedProductId:null,active:!0},(x=O.value)==null||x.resetValidation()},oe=()=>{H("update:modelValue",!1),N()};return he(()=>K.modelValue,x=>{x&&(N(),Q())}),(x,d)=>(f(),E(Le,{"model-value":x.modelValue,"onUpdate:modelValue":d[3]||(d[3]=w=>x.$emit("update:modelValue",w)),"max-width":"600px",persistent:""},{default:t(()=>[e(Z,null,{default:t(()=>[e(xe,{class:"bg-primary text-white"},{default:t(()=>[e(V,{icon:"mdi-plus-circle",class:"me-2"}),d[4]||(d[4]=u(" Tambah Variant Baru ")),e(Ne),e(R,{icon:"mdi-close",variant:"text",color:"white",onClick:oe})]),_:1,__:[4]}),e(bt,{ref_key:"formRef",ref:O,onSubmit:kt(ce,["prevent"])},{default:t(()=>[e(ae,{class:"pa-6"},{default:t(()=>[e(Ve,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(yt,{modelValue:g.value.selectedProduct,"onUpdate:modelValue":[d[0]||(d[0]=w=>g.value.selectedProduct=w),pe],items:A.value,loading:W.value,"item-title":"name","return-object":"",label:"Pilih Produk *",placeholder:"Cari produk...",variant:"outlined",rules:Y,required:"","no-data-text":"Tidak ada produk ditemukan","onUpdate:search":me},{item:t(({props:w,item:m})=>[e(je,ea(ta(w)),{prepend:t(()=>[e(Pe,{image:m.raw.image_url,size:"40"},{default:t(()=>[m.raw.image_url?j("",!0):(f(),E(V,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"])]),default:t(()=>[e(et,null,{default:t(()=>[u(n(m.raw.name),1)]),_:2},1024),e(it,null,{default:t(()=>[u("SKU: "+n(m.raw.sku||"-"),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:w})=>[l("div",Zs,[e(Pe,{image:w.raw.image_url,size:"24"},{default:t(()=>[w.raw.image_url?j("",!0):(f(),E(V,{key:0,icon:"mdi-coffee",size:"16"}))]),_:2},1032,["image"]),l("span",null,n(w.raw.name),1)])]),_:1},8,["modelValue","items","loading"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(be,{modelValue:g.value.name,"onUpdate:modelValue":d[1]||(d[1]=w=>g.value.name=w),label:"Nama Variant *",placeholder:"Contoh: Large Hot, Medium Cold, dll",variant:"outlined",rules:_,required:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(Ke,{color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ut,null,{default:t(()=>[e(V,{icon:"mdi-information",class:"me-2"}),d[5]||(d[5]=u(" SKU Otomatis "))]),_:1,__:[5]}),l("div",Ys,[d[6]||(d[6]=u(" SKU variant akan dibuat otomatis berdasarkan nama produk dan variant ")),g.value.name&&(g.value.selectedProduct||g.value.selectedProductId)?(f(),X("div",ei," Preview SKU: "+n(ue()),1)):g.value.name&&!g.value.selectedProduct&&!g.value.selectedProductId?(f(),X("div",ti," Pilih produk terlebih dahulu untuk melihat preview SKU ")):j("",!0)])]),_:1})]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(Ye,{modelValue:g.value.active,"onUpdate:modelValue":d[2]||(d[2]=w=>g.value.active=w),label:"Variant Aktif",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Ue),e(Ee,{class:"pa-6"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",onClick:oe,disabled:k.value},{default:t(()=>d[7]||(d[7]=[u(" Batal ")])),_:1,__:[7]},8,["disabled"]),e(R,{type:"submit",color:"primary",loading:k.value},{default:t(()=>d[8]||(d[8]=[u(" Simpan Variant ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),li=Oe(ai,[["__scopeId","data-v-5477c365"]]),oi={class:"product-variant-tab"},si={class:"d-flex gap-2"},ii={key:0,class:"mt-4 d-flex align-center gap-2"},ni={key:1,class:"text-center pa-12"},ri={key:2,class:"text-center pa-12"},ui={class:"d-flex align-center gap-3"},di={class:"flex-grow-1 min-width-0"},ci={class:"text-h6 font-weight-bold text-truncate"},mi={class:"text-body-2 text-medium-emphasis mb-0"},vi={class:"d-flex flex-column gap-1"},pi={class:"text-xs"},fi={class:"d-flex align-center gap-2"},gi={class:"text-primary font-weight-medium"},_i={class:"d-flex gap-1"},ki={class:"d-flex align-center justify-space-between w-100"},yi={class:"d-flex gap-1"},bi=Re({__name:"ProductVariantTab",props:{loading:{type:Boolean}},emits:["refresh"],setup(D,{emit:ke}){const K=ke,H=T(!1),O=T([]),k=T(!1),W=T(!1),A=T(null),g=T(!1),_=T(!1),Y=T(!1),y=T({search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}),Q=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],me=[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Variant Terbanyak",value:"variants_desc"},{title:"Variant Tersedikit",value:"variants_asc"}],pe=ve(()=>!!(y.value.search||y.value.stockStatus||y.value.activeStatus!==null||y.value.sortBy!=="name_asc")),I=ve(()=>{const c={};return O.value.forEach(o=>{const s=o.id_product;c[s]||(c[s]={product:o.product||{id:o.id_product,id_product:o.id_product,name:`Product ${o.id_product}`,sku:""},variants:[]}),c[s].variants.push(o)}),Object.values(c)}),ue=ve(()=>{let c=[...I.value];if(y.value.search){const o=y.value.search.toLowerCase();c=c.filter(s=>{var P;return s.product.name.toLowerCase().includes(o)||((P=s.product.sku)==null?void 0:P.toLowerCase().includes(o))||s.variants.some(fe=>fe.name.toLowerCase().includes(o)||fe.sku.toLowerCase().includes(o))})}switch(y.value.stockStatus&&(c=c.filter(o=>o.variants.some(s=>{var fe;return(((fe=s.composition_summary)==null?void 0:fe.stock_status)||"safe")===y.value.stockStatus}))),y.value.activeStatus!==null&&(c=c.filter(o=>o.variants.some(s=>s.is_active===y.value.activeStatus))),y.value.sortBy){case"name_asc":c.sort((o,s)=>o.product.name.localeCompare(s.product.name));break;case"name_desc":c.sort((o,s)=>s.product.name.localeCompare(o.product.name));break;case"variants_desc":c.sort((o,s)=>s.variants.length-o.variants.length);break;case"variants_asc":c.sort((o,s)=>o.variants.length-s.variants.length);break}return c}),ce=(c,o="success")=>{},N=async c=>{try{const o=O.value.findIndex(s=>s.id_variant===c.variantId);o!==-1&&(O.value[o]={...O.value[o],price:c.newPrice,cost:c.hpp}),ce(`Price updated to ${new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(c.newPrice)}`,"success")}catch(o){console.error("Error handling price update:",o),await oe()}},oe=async()=>{var c,o,s;H.value=!0;try{const P=await qe.get("/api/variants",{params:{per_page:1e3,with_product:!0,with_composition:!0}});if(P.data.success===!1)throw new Error(P.data.message||"Failed to load variants");const fe=((c=P.data.data)==null?void 0:c.data)||P.data.data||[];O.value=fe.map(J=>({...J,is_active:J.active!==void 0?J.active:J.is_active,id:J.id_variant||J.id,id_product:J.id_product||J.product_id}))}catch(P){(s=(o=P.response)==null?void 0:o.data)!=null&&s.message||P.message,O.value=[]}finally{H.value=!1}},x=c=>{A.value=c,g.value=!0},d=c=>{c&&(A.value=c,_.value=!0)},w=c=>{A.value=c,k.value=!0},m=()=>{Y.value=!0},h=async()=>{var c,o;if(A.value)try{W.value=!0,await qe.delete(`/api/variants/${A.value.id_variant}`),ce("Variant berhasil dihapus","success"),await oe(),k.value=!1}catch(s){(o=(c=s.response)==null?void 0:c.data)!=null&&o.message}finally{W.value=!1}},i=c=>{switch(c){case"critical":return"error";case"out":return"error";case"safe":return"success";default:return"primary"}},v=c=>{switch(c){case"critical":return"Kritis";case"out":return"Habis";case"safe":return"Aman";default:return"Normal"}},U=c=>{const o=c.filter(s=>s.is_active).length;return o===0?"error":o===c.length?"success":"warning"},ee=c=>c.some(o=>{var P;const s=(P=o.composition_summary)==null?void 0:P.stock_status;return s==="critical"||s==="out"}),le=c=>{const o=c.filter(P=>P.is_active).length,s=c.filter(P=>{var J;const fe=(J=P.composition_summary)==null?void 0:J.stock_status;return fe==="critical"||fe==="out"}).length;return s>0?{text:`${s} Stok Kritis`,color:"error",icon:"mdi-alert-circle"}:o===c.length?{text:"Semua Aktif",color:"success",icon:"mdi-check-circle"}:o===0?{text:"Semua Nonaktif",color:"error",icon:"mdi-close-circle"}:{text:`${o}/${c.length} Aktif`,color:"warning",icon:"mdi-minus-circle"}},ie=()=>{y.value={search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}},q=()=>{oe(),K("refresh")},z=()=>{oe(),K("refresh")};return at(()=>{oe()}),(c,o)=>{var s,P,fe;return f(),X("div",oi,[e(Z,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o[14]||(o[14]=l("div",null,[l("h2",{class:"text-h5 font-weight-bold"},"Variant Produk"),l("p",{class:"text-body-2 text-medium-emphasis"}," Kelola variant dan komposisi untuk produk Anda ")],-1)),l("div",si,[e(R,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:oe,loading:H.value},{default:t(()=>o[12]||(o[12]=[u(" Refresh ")])),_:1,__:[12]},8,["loading"]),e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:m},{default:t(()=>o[13]||(o[13]=[u(" Tambah Variant ")])),_:1,__:[13]})])]),_:1,__:[14]})]),_:1}),e(Z,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ae,null,{default:t(()=>[e(Ve,null,{default:t(()=>[e(S,{cols:"12",md:"3"},{default:t(()=>[e(be,{modelValue:y.value.search,"onUpdate:modelValue":o[0]||(o[0]=J=>y.value.search=J),label:"Cari Variant",placeholder:"Nama variant, SKU, atau produk...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:y.value.stockStatus,"onUpdate:modelValue":o[1]||(o[1]=J=>y.value.stockStatus=J),items:Q,label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:y.value.activeStatus,"onUpdate:modelValue":o[2]||(o[2]=J=>y.value.activeStatus=J),items:[{title:"Semua Status",value:null},{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Status Aktif",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:y.value.sortBy,"onUpdate:modelValue":o[3]||(o[3]=J=>y.value.sortBy=J),items:me,label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),pe.value?(f(),X("div",ii,[o[16]||(o[16]=l("span",{class:"text-body-2"},"Filter aktif:",-1)),y.value.search?(f(),E(de,{key:0,size:"small",closable:"","onClick:close":o[4]||(o[4]=J=>y.value.search="")},{default:t(()=>[u(" Pencarian: "+n(y.value.search),1)]),_:1})):j("",!0),y.value.stockStatus?(f(),E(de,{key:1,size:"small",closable:"","onClick:close":o[5]||(o[5]=J=>y.value.stockStatus="")},{default:t(()=>{var J;return[u(" Stok: "+n((J=Q.find(_e=>_e.value===y.value.stockStatus))==null?void 0:J.title),1)]}),_:1})):j("",!0),y.value.activeStatus!==null?(f(),E(de,{key:2,size:"small",closable:"","onClick:close":o[6]||(o[6]=J=>y.value.activeStatus=null)},{default:t(()=>[u(" Status: "+n(y.value.activeStatus?"Aktif":"Nonaktif"),1)]),_:1})):j("",!0),e(R,{variant:"text",size:"small",color:"error",onClick:ie},{default:t(()=>o[15]||(o[15]=[u(" Hapus Semua Filter ")])),_:1,__:[15]})])):j("",!0)]),_:1})]),_:1}),!H.value&&ue.value.length===0&&pe.value?(f(),E(Ke,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada variant yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):j("",!0),H.value?(f(),X("div",ni,[e(dt,{color:"primary",indeterminate:"",size:"64"}),o[17]||(o[17]=l("div",{class:"mt-4 text-h6"},"Memuat variant...",-1))])):I.value.length===0?(f(),X("div",ri,[e(V,{icon:"mdi-tune-variant",size:"96",class:"text-disabled mb-6"}),o[19]||(o[19]=l("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Variant Produk",-1)),o[20]||(o[20]=l("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat variant untuk produk Anda agar dapat menawarkan pilihan yang beragam ",-1)),e(R,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:m},{default:t(()=>o[18]||(o[18]=[u(" Buat Variant Pertama ")])),_:1,__:[18]})])):(f(),E(Ve,{key:3},{default:t(()=>[(f(!0),X(ze,null,Je(ue.value,J=>(f(),E(S,{key:J.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(Z,{class:We(["variant-group-card h-100",{"border-error":ee(J.variants)}]),elevation:"2"},{default:t(()=>[e(xe,{class:"pa-4 pb-2"},{default:t(()=>[l("div",ui,[e(Pe,{image:J.product.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[J.product.image_url?j("",!0):(f(),E(V,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),l("div",di,[l("h3",ci,n(J.product.name),1),l("p",mi," SKU: "+n(J.product.sku||"-"),1)]),e(de,{color:U(J.variants),size:"small",variant:"tonal"},{default:t(()=>[u(n(J.variants.length)+" Variant ",1)]),_:2},1032,["color"])])]),_:2},1024),e(Ue),e(ae,{class:"pa-4"},{default:t(()=>[e(ct,{class:"pa-0"},{default:t(()=>[(f(!0),X(ze,null,Je(J.variants,(_e,De)=>(f(),E(je,{key:_e.id_variant,class:We(["pa-2 rounded-lg variant-item",{"mb-2":De<J.variants.length-1}])},{prepend:t(()=>[e(Pe,{size:"32",color:_e.is_active?"success":"error",variant:"tonal"},{default:t(()=>[e(V,{icon:_e.is_active?"mdi-check":"mdi-close",size:"16"},null,8,["icon"])]),_:2},1032,["color"])]),append:t(()=>[l("div",_i,[e(Me,{text:"Kelola Komposisi"},{activator:t(({props:te})=>[e(R,we({ref_for:!0},te,{icon:"mdi-chef-hat",size:"small",variant:"text",color:"primary",onClick:He=>x(_e)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Hapus Variant"},{activator:t(({props:te})=>[e(R,we({ref_for:!0},te,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:He=>w(_e)}),null,16,["onClick"])]),_:2},1024)])]),default:t(()=>[e(et,{class:"text-sm font-weight-medium"},{default:t(()=>[u(n(_e.name),1)]),_:2},1024),e(it,null,{default:t(()=>[l("div",vi,[l("span",pi,"SKU: "+n(_e.sku),1),l("div",fi,[l("span",gi,n(B(Ae)(_e.price||0)),1),_e.composition_summary?(f(),E(de,{key:0,color:i(_e.composition_summary.stock_status),size:"x-small",variant:"tonal"},{default:t(()=>[u(n(v(_e.composition_summary.stock_status)),1)]),_:2},1032,["color"])):j("",!0)])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:2},1024)]),_:2},1024),e(Ue),e(Ee,{class:"pa-4"},{default:t(()=>[l("div",ki,[l("div",null,[e(de,{color:le(J.variants).color,size:"small",variant:"tonal"},{default:t(()=>[e(V,{icon:le(J.variants).icon,size:"14",class:"me-1"},null,8,["icon"]),u(" "+n(le(J.variants).text),1)]),_:2},1032,["color"])]),l("div",yi,[e(Me,{text:"Setting HPP Produk"},{activator:t(({props:_e})=>[e(R,we({ref_for:!0},_e,{icon:"mdi-calculator-variant",size:"small",variant:"text",color:"warning",onClick:De=>d(J.variants[0])}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Tambah Variant"},{activator:t(({props:_e})=>[e(R,we({ref_for:!0},_e,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:m}),null,16)]),_:1}),e(Me,{text:"Pengaturan Produk (Coming Soon)"},{activator:t(({props:_e})=>[e(R,we({ref_for:!0},_e,{icon:"mdi-cog",size:"small",variant:"text",color:"secondary",disabled:""}),null,16)]),_:1})])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(Xs,{modelValue:g.value,"onUpdate:modelValue":o[7]||(o[7]=J=>g.value=J),variant:A.value,onSave:q},null,8,["modelValue","variant"]),e(Ut,{modelValue:_.value,"onUpdate:modelValue":o[8]||(o[8]=J=>_.value=J),"variant-id":(s=A.value)==null?void 0:s.id_variant,"variant-name":(P=A.value)==null?void 0:P.name,onHppUpdated:oe,onPriceUpdated:N},null,8,["modelValue","variant-id","variant-name"]),e(li,{modelValue:Y.value,"onUpdate:modelValue":o[9]||(o[9]=J=>Y.value=J),onSave:z},null,8,["modelValue"]),e(St,{modelValue:k.value,"onUpdate:modelValue":o[10]||(o[10]=J=>k.value=J),title:"Konfirmasi Hapus Variant","item-name":(fe=A.value)==null?void 0:fe.name,loading:W.value,"confirm-text":"Hapus Variant",onConfirm:h,onCancel:o[11]||(o[11]=J=>k.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),$t=Oe(bi,[["__scopeId","data-v-22b81d4b"]]),hi={class:"product-management"},xi={class:"d-flex justify-space-between align-center mb-6"},wi={class:"d-flex gap-3 align-center"},Vi={key:0,class:"d-flex gap-2"},Pi={class:"d-flex align-center"},Ci=Re({__name:"products-management",setup(D){It();const{productsList:ke,categories:K,loading:H,saveLoading:O,deleteLoading:k,toggleLoading:W,stats:A,dialog:g,deleteDialog:_,editMode:Y,selectedProduct:y,selectedProducts:Q,currentPage:me,totalItems:pe,itemsPerPage:I,filters:ue,errorMessage:ce,successMessage:N,modalErrorMessage:oe,formData:x,selectedImage:d,imagePreview:w,canCreateEdit:m,hasSelectedProducts:h,fetchProductsList:i,fetchCategories:v,fetchStats:U,saveProduct:ee,deleteProduct:le,bulkDeleteProducts:ie,toggleActiveStatus:q,toggleFeaturedStatus:z,openCreateDialog:c,openEditDialog:o,openDeleteDialog:s,closeDialog:P,handleImageUpload:fe,clearModalError:J,onPageChange:_e}=Dt(),{dialog:De,editMode:te,formData:He,availableItems:Ce,saveLoading:Ge,modalErrorMessage:Qe,openCreateDialog:Fe,closeDialog:r,saveRecipe:a,clearModalError:p,fetchAvailableItems:F}=da(),{productItemsList:M,loading:$,fetchProductItemsForComposition:b}=Mt(),L=T("products"),C=T(),ne=T(!1),re=T(null),ye=T(!1),se=T(null),$e=async()=>{await le()},Se=async()=>{await ie()},Te=Ie=>{const G=Ie.id_product||Ie.id;Fe(G)},Xe=async Ie=>{re.value=Ie;try{await b({page:1,per_page:50,critical_only:!1})}catch{}ne.value=!0},Ze=Ie=>{se.value=Ie,ye.value=!0},nt=Ie=>{if(!Ie)return[];const G=Ie.id_product||Ie.id;return M.value.filter(lt=>{var ge;return((ge=lt.product)==null?void 0:ge.id_product)===G||lt.product_id===G})||[]},ht=async()=>{if(await b({page:1,per_page:50,critical_only:!1}),await i(),re.value&&C.value){const Ie=re.value.id_product||re.value.id;await C.value.refreshHPPData(Ie)}},Tt=Ie=>{Object.assign(ue,Ie),i()},At=Ie=>{ue.search=Ie,i()},Ht=()=>{d.value=null,w.value&&(w.value="")};return he(L,async Ie=>{Ie==="compositions"&&await b({page:1,per_page:15,critical_only:!1})},{immediate:!1}),at(()=>{i(),v(),U(),F()}),(Ie,G)=>{var lt;return f(),X("div",hi,[l("div",xi,[G[18]||(G[18]=l("div",null,[l("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),l("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),l("div",wi,[B(h)&&L.value==="products"?(f(),X("div",Vi,[e(de,{color:"primary",size:"small"},{default:t(()=>[u(n(B(Q).length)+" dipilih ",1)]),_:1}),e(R,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:Se},{default:t(()=>G[16]||(G[16]=[u(" Hapus Terpilih ")])),_:1,__:[16]})])):j("",!0),B(m)&&L.value==="products"?(f(),E(R,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:B(c)},{default:t(()=>G[17]||(G[17]=[u(" Tambah Produk ")])),_:1,__:[17]},8,["onClick"])):j("",!0)])]),e(Pa,{modelValue:L.value,"onUpdate:modelValue":G[0]||(G[0]=ge=>L.value=ge),class:"mb-6"},{default:t(()=>[e(vt,{value:"products"},{default:t(()=>[e(V,{icon:"mdi-coffee",class:"me-2"}),G[19]||(G[19]=u(" Produk "))]),_:1,__:[19]}),e(vt,{value:"compositions"},{default:t(()=>[e(V,{icon:"mdi-chef-hat",class:"me-2"}),G[20]||(G[20]=u(" Komposisi Produk "))]),_:1,__:[20]}),e(vt,{value:"variants"},{default:t(()=>[e(V,{icon:"mdi-tune-variant",class:"me-2"}),G[21]||(G[21]=u(" Variant Produk "))]),_:1,__:[21]})]),_:1},8,["modelValue"]),B(ce)?(f(),E(Ke,{key:0,type:"error",variant:"outlined",class:"mb-4",text:B(ce),closable:"","onClick:close":G[1]||(G[1]=ge=>ce.value="")},null,8,["text"])):j("",!0),B(N)?(f(),E(Ke,{key:1,type:"success",variant:"outlined",class:"mb-4",text:B(N),closable:"","onClick:close":G[2]||(G[2]=ge=>N.value="")},null,8,["text"])):j("",!0),e(Ca,{modelValue:L.value,"onUpdate:modelValue":G[4]||(G[4]=ge=>L.value=ge)},{default:t(()=>[e(pt,{value:"products"},{default:t(()=>[e(Bo,{stats:B(A)},null,8,["stats"]),e(bo,{filters:B(ue),"onUpdate:filters":Tt,onSearch:At},null,8,["filters"]),e(os,{ref_key:"productTableRef",ref:C,products:B(ke),loading:B(H),"current-page":B(me),"total-items":B(pe),"items-per-page":B(I),"selected-products":B(Q),"toggle-loading":B(W),"onUpdate:page":B(_e),onAddProduct:B(c),onEditProduct:B(o),onOpenRecipeDialog:Te,onOpenCompositionDialog:Xe,onOpenVariantDialog:Ze,onDeleteProduct:B(s),onToggleActive:B(q),onToggleFeatured:B(z),"onUpdate:selectedProducts":G[3]||(G[3]=ge=>Q.value=ge)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:page","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured"])]),_:1}),e(pt,{value:"compositions"},{default:t(()=>[e(Fl,{"product-items":B(M),loading:B($),onRefresh:B(b)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(pt,{value:"variants"},{default:t(()=>[e($t,{loading:B(H),onRefresh:B(i)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(fo,{modelValue:B(g),"onUpdate:modelValue":[G[5]||(G[5]=ge=>mt(g)?g.value=ge:null),G[6]||(G[6]=ge=>g.value=ge)],"edit-mode":B(Y),"form-data":B(x),categories:B(K),loading:B(O),"error-message":B(oe),"selected-image":B(d)?[B(d)]:[],"image-preview":B(w),onClose:B(P),onSubmit:B(ee),onImageChange:B(fe),onRemoveImage:Ht,onClearError:B(J),onUpdateForm:G[7]||(G[7]=(ge,xt)=>B(x)[ge]=xt)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(ca,{modelValue:B(De),"onUpdate:modelValue":[G[8]||(G[8]=ge=>mt(De)?De.value=ge:null),G[9]||(G[9]=ge=>De.value=ge)],"edit-mode":B(te),"form-data":B(He),"available-items":B(Ce),loading:B(Ge),"error-message":B(Qe),onClose:B(r),onSave:B(a),onClearError:B(p)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(St,{modelValue:B(_),"onUpdate:modelValue":G[10]||(G[10]=ge=>mt(_)?_.value=ge:null),title:"Konfirmasi Hapus Produk","item-name":(lt=B(y))==null?void 0:lt.name,loading:B(k),"confirm-text":"Hapus Produk",onConfirm:$e,onCancel:G[11]||(G[11]=ge=>_.value=!1)},null,8,["modelValue","item-name","loading"]),e(zt,{modelValue:ne.value,"onUpdate:modelValue":G[12]||(G[12]=ge=>ne.value=ge),product:re.value,items:nt(re.value),onSave:ht,onRefresh:ht},null,8,["modelValue","product","items"]),e(Le,{modelValue:ye.value,"onUpdate:modelValue":G[15]||(G[15]=ge=>ye.value=ge),"max-width":"1400px",persistent:""},{default:t(()=>[e(Z,null,{default:t(()=>[e(xe,{class:"d-flex justify-between align-center"},{default:t(()=>{var ge;return[l("div",Pi,[e(V,{icon:"tabler-versions",class:"me-2"}),u(" Kelola Variant - "+n((ge=se.value)==null?void 0:ge.name),1)]),e(R,{icon:"tabler-x",variant:"text",onClick:G[13]||(G[13]=xt=>ye.value=!1)})]}),_:1}),e(Ue),e(ae,{class:"pa-0"},{default:t(()=>[se.value?(f(),E($t,{key:0,product:se.value},null,8,["product"])):j("",!0)]),_:1}),e(Ue),e(Ee,null,{default:t(()=>[e(Ne),e(R,{color:"grey-darken-1",variant:"outlined",onClick:G[14]||(G[14]=ge=>ye.value=!1)},{default:t(()=>[e(V,{icon:"mdi-close",class:"me-1"}),G[22]||(G[22]=u(" Tutup "))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),bn=Oe(Ci,[["__scopeId","data-v-9db14e64"]]);export{bn as default};
