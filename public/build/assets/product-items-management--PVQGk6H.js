import{D as nt}from"./DeleteConfirmationDialog-DblewY2j.js";import{d as pe,r as C,V as B,w as rt,g as $,f as o,b as e,e as d,t as _,a0 as U,l as L,s as v,$ as dt,p as ut,o as f,a as ct,c as V,F as se,i as le,X as R,v as Ae,aE as mt,aI as Q,aD as Ee,a3 as pt,D as gt,m as c,a5 as ft,j as vt}from"./main-BAoom0fI.js";import{V as Ue}from"./VDialog-BmgDQMRG.js";import{b as ie,c as be,V as W}from"./VCard-DKixmwd6.js";import{V as Z}from"./VDivider-_RM1H4oe.js";import{V as G}from"./VCardText-yO_LL98H.js";import{V as E,a as J}from"./VAlert-CHrHbPG-.js";import{V as _t}from"./VForm-DgH_Emvc.js";import{V as ce,a as A}from"./VRow-CzNjCVcw.js";import{V as me}from"./VSelect-G7MgFaCB.js";import{a as yt}from"./VList-u_Bmr7t0.js";import{V as X,a as kt}from"./VChip-D9OHswR6.js";import{V as Fe}from"./VTextField-DXPIZ412.js";import{V as Le}from"./VCheckbox-DC7HQcLY.js";import{V as bt}from"./VTextarea-Bnrln25Y.js";import{V as Ce}from"./VSpacer-wXUiayGy.js";import{V as ve}from"./VTooltip-DGkuGp0y.js";import{a as Ct,V as ht}from"./VDataTable-Dh_60B_A.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{I as Pt}from"./ItemsApi-CpJP4FvA.js";import{P as wt}from"./ProductsApi-BCSAD1tK.js";import"./VOverlay-DiNeOxb-.js";import"./forwardRefs-B931MWyl.js";import"./VImg-B6o-C-IY.js";import"./VAvatar-BGY_BPux.js";/* empty css              */import"./VMenu-CpAU4c1j.js";import"./VCheckboxBtn-DQc1gldW.js";import"./VTable-D4YUyDzm.js";import"./filter-Clp8NBwU.js";const Dt={class:"text-h5"},Vt={class:"text-body-2"},It={class:"d-flex align-center justify-space-between"},xt=pe({__name:"ProductItemDialog",props:{dialog:{type:Boolean},editMode:{type:Boolean},formData:{},loading:{type:Boolean},products:{},items:{},errorMessage:{}},emits:["update:dialog","update:errorMessage","update:formData","save","itemChange"],setup(t,{emit:i}){const l=t,k=i,D=C(),F=C(!1),x=B({get:()=>l.dialog,set:a=>k("update:dialog",a)}),S=B({get:()=>l.formData,set:a=>k("update:formData",a)}),I={required:a=>!!a||"This field is required",positiveNumber:a=>a>0||"Must be greater than 0",stockValidation:a=>{if(!a||a<=0)return"Jumlah harus lebih dari 0";const s=h();if(!s)return!0;const u=p(s);return a<=u||`Jumlah tidak boleh melebihi stok tersedia (${u})`}},h=()=>l.items.find(a=>a.id_item===l.formData.item_id),p=a=>a?a.inventory?a.inventory.available_stock||a.inventory.current_stock||0:a.current_stock||a.available_stock||0:0,r=()=>{const a=h();return!a||!l.formData.quantity_needed?!1:l.formData.quantity_needed>p(a)},g=()=>{const a=h();if(!a||!l.formData.quantity_needed)return"primary";const s=p(a),u=l.formData.quantity_needed,b=u/s*100;return u>s?"error":b>80?"warning":"primary"},ae=()=>{const a=h();if(!a)return"";const s=p(a),u=l.formData.quantity_needed||0,b=s>0?(u/s*100).toFixed(1):"0";return`Stok tersedia: ${s} | Akan menggunakan: ${b}%`},oe=B(()=>l.items.map(a=>{const s=p(a),u=s<=0?"OUT_OF_STOCK":s<=10?"LOW_STOCK":"IN_STOCK",b=u==="OUT_OF_STOCK"?"error":u==="LOW_STOCK"?"warning":"success",H=u==="OUT_OF_STOCK"?"Habis":u==="LOW_STOCK"?`${s} (Rendah)`:`${s}`,Y=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a.cost_per_unit||0);return{...a,displayName:`${a.name} (${s} ${a.unit})`,stockStatus:u,stockChipColor:b,stockText:H,formattedCost:Y}})),n=(a,s)=>{const u={...l.formData,[a]:s};k("update:formData",u)},m=a=>{n("item_id",a),k("itemChange",a)},P=async()=>{var s;const{valid:a}=await((s=D.value)==null?void 0:s.validate());a&&k("save")};return rt(x,a=>{a||k("update:errorMessage","")}),(a,s)=>(f(),$(Ue,{modelValue:x.value,"onUpdate:modelValue":s[9]||(s[9]=u=>x.value=u),persistent:"","max-width":"600px",scrollable:""},{default:o(()=>[e(W,null,{default:o(()=>[e(ie,{class:"d-flex justify-space-between align-center"},{default:o(()=>[d("span",Dt,_(a.editMode?"Edit Komposisi Produk":"Tambah Komposisi Produk"),1),e(U,{icon:"tabler-x",size:"small",variant:"text",onClick:s[0]||(s[0]=u=>x.value=!1)})]),_:1}),e(Z),e(G,null,{default:o(()=>[a.errorMessage?(f(),$(E,{key:0,type:"error",variant:"outlined",class:"mb-4",text:a.errorMessage,closable:"","onClick:close":s[1]||(s[1]=()=>k("update:errorMessage",""))},null,8,["text"])):L("",!0),r()?(f(),$(E,{key:1,type:"warning",variant:"tonal",density:"compact",class:"mb-4"},{default:o(()=>[e(J,{class:"mb-2"},{default:o(()=>s[10]||(s[10]=[v("Peringatan Stok")])),_:1,__:[10]}),d("div",Vt,[v(" Jumlah yang dibutuhkan ("+_(a.formData.quantity_needed)+") melebihi stok tersedia ("+_(h()?p(h()):0)+"). ",1),s[11]||(s[11]=d("br",null,null,-1)),s[12]||(s[12]=v(" Silakan kurangi jumlah yang dibutuhkan atau pastikan stok mencukupi. "))])]),_:1})):L("",!0),e(_t,{ref_key:"formRef",ref:D,modelValue:F.value,"onUpdate:modelValue":s[7]||(s[7]=u=>F.value=u),onSubmit:dt(P,["prevent"])},{default:o(()=>[e(ce,null,{default:o(()=>[e(A,{cols:"12"},{default:o(()=>[e(me,{"model-value":S.value.product_id,items:a.products,"item-title":"name","item-value":"id_product",label:"Produk *",rules:[I.required],variant:"outlined",clearable:"",disabled:a.editMode,"no-data-text":"Tidak ada produk tersedia","onUpdate:modelValue":s[2]||(s[2]=u=>n("product_id",u))},null,8,["model-value","items","rules","disabled"])]),_:1}),e(A,{cols:"12"},{default:o(()=>[e(me,{"model-value":S.value.item_id,items:oe.value,"item-title":"displayName","item-value":"id_item",label:"Item *",rules:[I.required],variant:"outlined",clearable:"",disabled:a.editMode,"no-data-text":"Tidak ada item tersedia","onUpdate:modelValue":m},{item:o(({props:u,item:b})=>[e(yt,ut(u,{disabled:b.raw.stockStatus==="OUT_OF_STOCK"}),{title:o(()=>[v(_(b.raw.name),1)]),subtitle:o(()=>[d("div",It,[d("span",null,_(b.raw.unit)+" • "+_(b.raw.formattedCost),1),e(X,{color:b.raw.stockChipColor,size:"x-small",variant:"tonal"},{default:o(()=>[v(_(b.raw.stockText),1)]),_:2},1032,["color"])])]),_:2},1040,["disabled"])]),_:1},8,["model-value","items","rules","disabled"])]),_:1}),e(A,{cols:"6"},{default:o(()=>[e(Fe,{"model-value":S.value.quantity_needed,type:"number",label:"Jumlah Dibutuhkan *",rules:[I.required,I.positiveNumber,I.stockValidation],variant:"outlined",min:"1",step:"1",max:h()?p(h()):void 0,color:g(),error:r(),"error-messages":r()?`Stok tidak cukup (${h()?p(h()):0} tersedia)`:[],hint:ae(),"persistent-hint":"","onUpdate:modelValue":s[3]||(s[3]=u=>n("quantity_needed",u?parseInt(u):0))},null,8,["model-value","rules","max","color","error","error-messages","hint"])]),_:1}),e(A,{cols:"6"},{default:o(()=>[e(Fe,{"model-value":S.value.unit,label:"Satuan *",rules:[I.required],variant:"outlined",placeholder:"e.g., kg, liter, pcs","onUpdate:modelValue":s[4]||(s[4]=u=>n("unit",u))},null,8,["model-value","rules"])]),_:1}),e(A,{cols:"12"},{default:o(()=>[e(Le,{"model-value":S.value.is_critical,label:"Item Kritis",hint:"Tandai jika item ini sangat penting untuk produksi","onUpdate:modelValue":s[5]||(s[5]=u=>n("is_critical",u))},null,8,["model-value"])]),_:1}),e(A,{cols:"12"},{default:o(()=>[e(bt,{"model-value":S.value.notes,label:"Catatan",variant:"outlined",rows:"3",placeholder:"Catatan tambahan tentang hubungan produk-item ini...","onUpdate:modelValue":s[6]||(s[6]=u=>n("notes",u))},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(Z),e(be,{class:"px-6 py-4"},{default:o(()=>[e(Ce),e(U,{variant:"text",onClick:s[8]||(s[8]=u=>x.value=!1)},{default:o(()=>s[13]||(s[13]=[v(" Batal ")])),_:1,__:[13]}),e(U,{color:"primary",loading:a.loading,disabled:!F.value||r(),onClick:P},{default:o(()=>[v(_(a.editMode?"Perbarui":"Simpan"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),$t={class:"product-item-group-view pa-4"},St={class:"d-flex justify-space-between align-start mb-3"},Tt={class:"flex-grow-1"},At={class:"text-h6 font-weight-bold mb-1"},Ft={class:"text-body-2 text-grey mb-0"},Et={class:"items-list"},Ut={class:"text-subtitle-2 font-weight-bold mb-3 text-grey-darken-1"},Lt={class:"d-flex justify-space-between align-center"},Ot={class:"flex-grow-1"},Mt={class:"d-flex align-center mb-1"},Kt={class:"text-body-1 font-weight-medium"},Nt={class:"d-flex align-center text-body-2 text-grey"},qt={class:"d-flex align-center"},zt={class:"text-caption text-grey"},jt={key:3,class:"d-flex justify-center mt-4"},Bt=pe({__name:"ProductItemGroupView",props:{productItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},totalItems:{},products:{},items:{}},emits:["edit","delete","check-capacity","view-hpp","update:page"],setup(t,{emit:i}){const l=t,k=i,D=n=>{var m;console.log("🔧 EDIT CLICKED!",n),console.log(`EDIT CLICKED: ${(m=n.item)==null?void 0:m.name}`),k("edit",n)},F=n=>{var m;console.log("🗑️ DELETE CLICKED!",n),console.log(`DELETE CLICKED: ${(m=n.item)==null?void 0:m.name}`),k("delete",n)},x=n=>{console.log("📊 CAPACITY CLICKED!",n),console.log(`CAPACITY CLICKED: ${n.name}`),k("check-capacity",n)},S=B(()=>{console.log("🔍 Grouping product items..."),console.log("📦 Available products:",l.products.length),console.log("🧰 Available items:",l.items.length),console.log("🔗 Product items to group:",l.productItems.length);const n={};l.productItems.forEach(P=>{const a=P.product_id;let s=P.product||l.products.find(b=>b.id_product===a);console.log(`Looking for product ID ${a}:`,s?`Found: ${s.name}`:"NOT FOUND"),n[a]||(n[a]={product:s||{id_product:a,name:"Unknown Product",sku:"N/A"},items:[]});const u=P.item||l.items.find(b=>b.id_item===P.item_id);console.log(`Looking for item ID ${P.item_id}:`,u?`Found: ${u.name}`:"NOT FOUND"),n[a].items.push({...P,item:u})});const m=Object.values(n);return console.log("✅ Final grouped result:",m),m}),I=n=>{if(n==null||n==="")return"0";const m=typeof n=="string"?Number.parseFloat(n):n;return isNaN(m)?"0":new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:3}).format(m)},h=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),p=n=>n.some(m=>{var P;return(P=m.item)==null?void 0:P.is_low_stock}),r=n=>p(n)?"warning":"success",g=n=>p(n)?"Stok Rendah":"Stok Aman",ae=n=>{var m;return(m=n.inventory)!=null&&m.is_low_stock||n.is_low_stock?"text-warning":"text-success"},oe=n=>{var m;return(m=n.inventory)!=null&&m.is_low_stock||n.is_low_stock?"mdi-alert-circle":"mdi-check-circle"};return(n,m)=>{const P=ct("VSkeleton");return f(),V("div",$t,[n.loading?(f(),$(ce,{key:0},{default:o(()=>[(f(),V(se,null,le(3,a=>e(A,{key:a,cols:"12",md:"6",lg:"4"},{default:o(()=>[e(W,{elevation:"0",variant:"outlined",class:"mb-4"},{default:o(()=>[e(G,null,{default:o(()=>[e(P,{type:"text",width:"60%",class:"mb-2"}),e(P,{type:"text",width:"40%",class:"mb-4"}),(f(),V(se,null,le(3,s=>e(P,{key:s,type:"text",width:"100%",class:"mb-1"})),64))]),_:1})]),_:1})]),_:2},1024)),64))]),_:1})):S.value.length===0?(f(),$(W,{key:1,elevation:"0",variant:"outlined",class:"text-center pa-8"},{default:o(()=>[e(R,{icon:"mdi-package-variant-closed",size:"64",color:"grey-lighten-1",class:"mb-4"}),m[1]||(m[1]=d("h3",{class:"text-h6 text-grey-darken-1 mb-2"}," Belum Ada Komposisi Produk ",-1)),m[2]||(m[2]=d("p",{class:"text-body-2 text-grey"}," Mulai tambahkan komposisi produk untuk mengelola item yang dibutuhkan ",-1))]),_:1,__:[1,2]})):(f(),$(ce,{key:2},{default:o(()=>[(f(!0),V(se,null,le(S.value,a=>(f(),$(A,{key:a.product.id_product,cols:"12",md:"6",lg:"4"},{default:o(()=>[e(W,{elevation:"1",variant:"flat",class:Ae(["mb-4 product-card",{"border-warning":p(a.items)}])},{default:o(()=>[e(G,{class:"pb-2"},{default:o(()=>[d("div",St,[d("div",Tt,[d("h3",At,_(a.product.name),1),d("p",Ft,_(a.product.sku),1)]),e(X,{color:r(a.items),variant:"tonal",size:"small"},{default:o(()=>[v(_(g(a.items)),1)]),_:2},1032,["color"])]),e(Z,{class:"my-3"}),d("div",Et,[d("h4",Ut," Item Komposisi ("+_(a.items.length)+") ",1),(f(!0),V(se,null,le(a.items,s=>{var u,b,H,Y;return f(),V("div",{key:s.id_product_item,class:"item-row mb-3"},[d("div",Lt,[d("div",Ot,[d("div",Mt,[d("h5",Kt,_(((u=s.item)==null?void 0:u.name)||"Unknown Item"),1),s.is_critical?(f(),$(X,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:o(()=>m[3]||(m[3]=[v(" Kritis ")])),_:1,__:[3]})):L("",!0)]),d("div",Nt,[e(R,{icon:"mdi-scale",size:"16",class:"mr-1"}),d("span",null,_(I(s.quantity_needed))+" "+_((b=s.item)==null?void 0:b.unit),1)]),s.item?(f(),V("div",{key:0,class:Ae(["d-flex align-center text-caption mt-1",ae(s.item)])},[e(R,{icon:oe(s.item),size:"12",class:"mr-1"},null,8,["icon"]),d("span",null," Stok: "+_(I((H=s.item.inventory)==null?void 0:H.current_stock))+" "+_(s.item.unit),1)],2)):L("",!0)]),d("div",qt,[e(U,{icon:"",variant:"text",size:"small",color:"primary",onClick:ue=>D(s)},{default:o(()=>[e(R,{icon:"mdi-pencil",size:"16"}),e(ve,{activator:"parent",location:"top"},{default:o(()=>m[4]||(m[4]=[v(" Edit ")])),_:1,__:[4]})]),_:2},1032,["onClick"]),e(U,{icon:"",variant:"text",size:"small",color:"info",disabled:!((Y=s.item)!=null&&Y.id_item),onClick:ue=>x(a.product)},{default:o(()=>[e(R,{icon:"mdi-calculator",size:"16"}),e(ve,{activator:"parent",location:"top"},{default:o(()=>m[5]||(m[5]=[v(" Cek Kapasitas ")])),_:1,__:[5]})]),_:2},1032,["disabled","onClick"]),e(U,{icon:"",variant:"text",size:"small",color:"error",onClick:ue=>F(s)},{default:o(()=>[e(R,{icon:"mdi-delete",size:"16"}),e(ve,{activator:"parent",location:"top"},{default:o(()=>m[6]||(m[6]=[v(" Hapus ")])),_:1,__:[6]})]),_:2},1032,["onClick"])])]),a.items.indexOf(s)<a.items.length-1?(f(),$(Z,{key:0,class:"mt-2"})):L("",!0)])}),128))])]),_:2},1024),e(be,{class:"pt-0 px-4 pb-3"},{default:o(()=>[e(U,{variant:"tonal",color:"orange",size:"small","prepend-icon":"mdi-calculator-variant",onClick:s=>n.$emit("view-hpp",a.product)},{default:o(()=>m[7]||(m[7]=[v(" Setting HPP ")])),_:2,__:[7]},1032,["onClick"]),e(Ce),d("div",zt," Harga: "+_(h(a.product.price||0)),1)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),n.totalItems>n.itemsPerPage?(f(),V("div",jt,[e(Ct,{"model-value":n.currentPage,length:Math.ceil(n.totalItems/n.itemsPerPage),"onUpdate:modelValue":m[0]||(m[0]=a=>n.$emit("update:page",a))},null,8,["model-value","length"])])):L("",!0)])}}}),Ht=Oe(Bt,[["__scopeId","data-v-fb5a4a4c"]]),Rt={key:0,class:"text-center py-8"},Jt={key:1},Wt={class:"mt-2"},Yt={class:"text-h4 font-weight-bold"},Qt={key:0,class:"mb-6"},Xt={class:"d-flex align-center gap-2"},Zt={class:"font-weight-medium"},Gt={class:"text-caption text-medium-emphasis"},ea={class:"text-end"},ta={class:"font-weight-medium"},aa={class:"text-end"},oa={class:"font-weight-medium"},sa={class:"text-end"},la={class:"mt-6"},ia={key:0},na={key:1},ra={key:2},da={key:2},ua=pe({__name:"ProductionCapacityDialog",props:{dialog:{type:Boolean},loading:{type:Boolean},productionCapacity:{},selectedProduct:{}},emits:["update:dialog"],setup(t,{emit:i}){const l=t,k=i,D=B({get:()=>l.dialog,set:p=>k("update:dialog",p)}),F=[{title:"Item",value:"item_name",sortable:!1},{title:"Available",value:"available_stock",align:"end"},{title:"Needed/Unit",value:"needed_per_product",align:"end"},{title:"Can Produce",value:"can_produce",align:"end"},{title:"Status",value:"status",align:"center"}],x=p=>new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2}).format(p),S=p=>p.can_produce===0?"tabler-alert-triangle":p.can_produce<5?"tabler-alert-circle":"tabler-check-circle",I=p=>p.can_produce===0?"error":p.can_produce<5?"warning":"success",h=p=>p.can_produce===0?"Out of Stock":p.can_produce<5?"Low Stock":"Sufficient";return(p,r)=>(f(),$(Ue,{modelValue:D.value,"onUpdate:modelValue":r[2]||(r[2]=g=>D.value=g),persistent:"","max-width":"800px",scrollable:""},{default:o(()=>[e(W,null,{default:o(()=>[e(ie,{class:"d-flex justify-space-between align-center"},{default:o(()=>[r[3]||(r[3]=d("span",{class:"text-h5"},"Production Capacity Analysis",-1)),e(U,{icon:"tabler-x",size:"small",variant:"text",onClick:r[0]||(r[0]=g=>D.value=!1)})]),_:1,__:[3]}),e(Z),e(G,null,{default:o(()=>[p.loading?(f(),V("div",Rt,[e(mt,{indeterminate:"",color:"primary",size:"64"}),r[4]||(r[4]=d("div",{class:"mt-4"},"Calculating production capacity...",-1))])):p.productionCapacity?(f(),V("div",Jt,[e(E,{color:p.productionCapacity.can_produce>0?"success":"error",variant:"tonal",class:"mb-6"},{default:o(()=>[e(J,null,{default:o(()=>{var g;return[v(_(((g=p.selectedProduct)==null?void 0:g.name)||"Product")+" - Production Capacity ",1)]}),_:1}),d("div",Wt,[d("div",Yt,_(x(p.productionCapacity.can_produce))+" units ",1),r[5]||(r[5]=d("div",{class:"text-body-2"}," Maximum production with current inventory ",-1))])]),_:1},8,["color"]),p.productionCapacity.limiting_items.length>0?(f(),V("div",Qt,[e(ie,{class:"px-0"},{default:o(()=>r[6]||(r[6]=[v("Limiting Factors")])),_:1,__:[6]}),e(E,{color:"warning",variant:"tonal",class:"mb-4"},{default:o(()=>[e(J,null,{default:o(()=>r[7]||(r[7]=[v("Production Limited By:")])),_:1,__:[7]}),e(kt,{class:"mt-2"},{default:o(()=>[(f(!0),V(se,null,le(p.productionCapacity.limiting_items,g=>(f(),$(X,{key:g,color:"warning",size:"small",variant:"tonal"},{default:o(()=>[v(_(g),1)]),_:2},1024))),128))]),_:1})]),_:1})])):L("",!0),e(ie,{class:"px-0 mb-4"},{default:o(()=>r[8]||(r[8]=[v("Item Requirements Analysis")])),_:1,__:[8]}),e(ht,{headers:F,items:p.productionCapacity.details,"items-per-page":10,class:"elevation-1"},{"item.item_name":o(({item:g})=>[d("div",Xt,[e(R,{icon:S(g),color:I(g),size:"20"},null,8,["icon","color"]),d("div",null,[d("div",Zt,_(g.item_name),1),d("div",Gt," ID: "+_(g.item_id),1)])])]),"item.available_stock":o(({item:g})=>[d("div",ea,[d("div",ta,_(x(g.available_stock)),1),r[9]||(r[9]=d("div",{class:"text-caption text-medium-emphasis"},"Available",-1))])]),"item.needed_per_product":o(({item:g})=>[d("div",aa,[d("div",oa,_(x(g.needed_per_product)),1),r[10]||(r[10]=d("div",{class:"text-caption text-medium-emphasis"},"Per unit",-1))])]),"item.can_produce":o(({item:g})=>[d("div",sa,[e(X,{color:g.can_produce>=p.productionCapacity.can_produce?"success":"error",size:"small",variant:"tonal"},{default:o(()=>[v(_(x(g.can_produce)),1)]),_:2},1032,["color"])])]),"item.status":o(({item:g})=>[e(X,{color:I(g),size:"small",variant:"tonal"},{default:o(()=>[v(_(h(g)),1)]),_:2},1032,["color"])]),_:1},8,["items"]),d("div",la,[e(ie,{class:"px-0"},{default:o(()=>r[11]||(r[11]=[v("Recommendations")])),_:1,__:[11]}),p.productionCapacity.can_produce===0?(f(),V("div",ia,[e(E,{color:"error",variant:"tonal"},{default:o(()=>[e(J,null,{default:o(()=>r[12]||(r[12]=[v("Cannot Produce")])),_:1,__:[12]}),r[13]||(r[13]=d("div",null,"One or more critical items are out of stock. Please restock the limiting items listed above.",-1))]),_:1,__:[13]})])):p.productionCapacity.can_produce<10?(f(),V("div",na,[e(E,{color:"warning",variant:"tonal"},{default:o(()=>[e(J,null,{default:o(()=>r[14]||(r[14]=[v("Low Production Capacity")])),_:1,__:[14]}),r[15]||(r[15]=d("div",null,"Consider restocking items to increase production capacity.",-1))]),_:1,__:[15]})])):(f(),V("div",ra,[e(E,{color:"success",variant:"tonal"},{default:o(()=>[e(J,null,{default:o(()=>r[16]||(r[16]=[v("Good Production Capacity")])),_:1,__:[16]}),r[17]||(r[17]=d("div",null,"Sufficient inventory for production. Consider planning production batches.",-1))]),_:1,__:[17]})]))])])):(f(),V("div",da,[e(E,{color:"info",variant:"tonal"},{default:o(()=>[e(J,null,{default:o(()=>r[18]||(r[18]=[v("No Data Available")])),_:1,__:[18]}),r[19]||(r[19]=d("div",null,"Unable to calculate production capacity. Please ensure the product has items configured.",-1))]),_:1,__:[19]})]))]),_:1}),e(Z),e(be,{class:"pa-4"},{default:o(()=>[e(Ce),e(U,{color:"primary",variant:"outlined",onClick:r[1]||(r[1]=g=>D.value=!1)},{default:o(()=>r[20]||(r[20]=[v(" Close ")])),_:1,__:[20]})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ne={async getAll(t={}){var i;try{return(await Q.get("/api/product-items",{params:t})).data}catch(l){throw console.error("ProductItemsApi.getAll error:",l),((i=l.response)==null?void 0:i.data)||l}},async getById(t){var i;try{return(await Q.get(`/api/product-items/${t}`)).data}catch(l){throw console.error("ProductItemsApi.getById error:",l),((i=l.response)==null?void 0:i.data)||l}},async create(t){var i;try{return(await Q.post("/api/product-items",t)).data}catch(l){throw console.error("ProductItemsApi.create error:",l),((i=l.response)==null?void 0:i.data)||l}},async update(t,i){var l;try{return(await Q.put(`/api/product-items/${t}`,i)).data}catch(k){throw console.error("ProductItemsApi.update error:",k),((l=k.response)==null?void 0:l.data)||k}},async delete(t){var i;try{return(await Q.delete(`/api/product-items/${t}`)).data}catch(l){throw console.error("ProductItemsApi.delete error:",l),((i=l.response)==null?void 0:i.data)||l}},async getProductionCapacity(t){var i;try{return(await Q.get(`/api/product-items/production-capacity/${t}`)).data}catch(l){throw console.error("ProductItemsApi.getProductionCapacity error:",l),((i=l.response)==null?void 0:i.data)||l}}},z=C([]),j=C([]),T=C([]),re=C(!1),_e=C(!1),ye=C(!1),ge=C(!1),he=C(!1),Pe=C(!1),de=C(!1),N=C(null),we=C(null),De=C(null),ee=C(1),ke=C(0),Ve=C(15),Me=Ee({product_id:void 0,item_id:void 0,critical_only:!1}),M=C(""),Ie=C(""),K=C(""),O=Ee({product_id:0,item_id:0,quantity_needed:0,unit:"",is_critical:!1,notes:""}),ca=B(()=>!0),ma=B(()=>[{title:"Pilih Produk",value:0},...j.value.map(t=>({title:t.name,value:t.id_product||t.id}))]),pa=B(()=>[{title:"Pilih Item",value:0},...T.value.map(t=>({title:`${t.name} (${t.unit})`,value:t.id_item||t.id}))]),te=async()=>{re.value=!0,M.value="";try{const t={page:ee.value,per_page:Ve.value,...Me};Object.keys(t).forEach(l=>{const D=t[l];(D===void 0||D===0||typeof D=="string"&&D==="")&&delete t[l]});const i=await ne.getAll(t);i.success&&i.data&&(Array.isArray(i.data)?(z.value=i.data,ke.value=i.data.length):(z.value=i.data.data||[],ke.value=i.data.total||0,ee.value=i.data.current_page||1),console.log("🔗 ProductItems loaded:",z.value.length),z.value.length>0&&(console.log("🔗 First ProductItem:",z.value[0]),console.log("🆔 ProductItem product_ids needed:",[...new Set(z.value.map(l=>l.product_id))]),console.log("🆔 ProductItem item_ids needed:",[...new Set(z.value.map(l=>l.item_id))])))}catch(t){console.error("Error fetching product items:",t),M.value=t.message||"Failed to fetch product items"}finally{re.value=!1}},ga=async()=>{try{const t=await wt.getAll({});console.log("🔍 fetchProducts response:",t),t.success&&t.data?(j.value=Array.isArray(t.data)?t.data:[],console.log("📦 Products loaded:",j.value.length),console.log("🆔 Product IDs available:",j.value.map(i=>i.id_product||i.id))):j.value=[]}catch(t){console.error("❌ Error fetching products:",t),j.value=[]}},fa=async()=>{var t;try{console.log("🔄 Starting fetchItems..."),console.log("🔐 Auth token exists:",!!pt("accessToken").value);const i=await Pt.getAll({per_page:1e3});console.log("🔍 fetchItems response:",i),console.log("🔍 fetchItems response.success:",i.success),console.log("🔍 fetchItems response.data:",i.data),console.log("🔍 fetchItems response.data.data:",(t=i.data)==null?void 0:t.data),i.success&&i.data&&i.data.data?(T.value=Array.isArray(i.data.data)?i.data.data:[],console.log("✅ Items set to:",T.value),console.log("✅ Items count:",T.value.length),console.log("✅ First item:",T.value[0]),console.log("🆔 Item IDs available:",T.value.map(l=>l.id_item||l.id))):(T.value=[],console.log("❌ Items set to empty array - response not successful or no data")),console.log("📦 Items loaded:",T.value.length)}catch(i){console.error("❌ Error fetching items:",i),console.error("❌ Error details:",JSON.stringify(i,null,2)),T.value=[]}},va=async()=>{if(ya()){_e.value=!0,K.value="";try{let t;de.value&&N.value?t=await ne.update(N.value.id_product_item,O):t=await ne.create(O),t.success?(Ie.value=de.value?"Hubungan produk-item berhasil diperbarui!":"Hubungan produk-item berhasil ditambahkan!",Ne(),await te()):K.value=t.message||"Terjadi kesalahan saat menyimpan"}catch(t){console.error("Error saving product item:",t),K.value=t.message||"Terjadi kesalahan saat menyimpan"}finally{_e.value=!1}}},_a=async()=>{if(N.value){ye.value=!0;try{const t=await ne.delete(N.value.id_product_item);t.success?(Ie.value="Hubungan produk-item berhasil dihapus!",qe(),await te()):M.value=t.message||"Gagal menghapus hubungan produk-item"}catch(t){console.error("Error deleting product item:",t),M.value=t.message||"Terjadi kesalahan saat menghapus"}finally{ye.value=!1}}},Ke=async t=>{re.value=!0;try{const i=await ne.getProductionCapacity(t);i.success?(De.value=i.data,Pe.value=!0):M.value=i.message||"Gagal menghitung kapasitas produksi"}catch(i){console.error("Error getting production capacity:",i),M.value=i.message||"Terjadi kesalahan saat menghitung kapasitas produksi"}finally{re.value=!1}},ya=()=>O.product_id<=0?(K.value="Produk harus dipilih",!1):O.item_id<=0?(K.value="Item harus dipilih",!1):O.quantity_needed<=0?(K.value="Jumlah yang dibutuhkan harus lebih besar dari 0",!1):O.unit.trim()?!0:(K.value="Satuan harus diisi",!1),ka=()=>{de.value=!1,N.value=null,ze(),ge.value=!0},ba=t=>{de.value=!0,N.value=t,wa(t),ge.value=!0},Ca=t=>{N.value=t,he.value=!0},ha=t=>{console.log("🔍 openCapacityDialog called with:",t);let i,l;if(typeof t=="number"){if(i=t,l=j.value.find(k=>(k.id_product||k.id)===i),!l){console.error("❌ Product not found in products list for ID:",i),M.value="Product tidak ditemukan";return}}else if(t&&typeof t=="object")l=t,i=l.id_product||l.id;else{console.error("❌ Invalid parameter:",t),M.value="Parameter tidak valid";return}if(console.log("🆔 Product ID:",i),console.log("📦 Product:",l),!i){console.error("❌ Product ID is undefined"),M.value="Product ID tidak ditemukan";return}we.value=l,Ke(i)},Ne=()=>{ge.value=!1,je(),ze()},qe=()=>{he.value=!1,N.value=null},Pa=()=>{Pe.value=!1,we.value=null,De.value=null},ze=()=>{Object.assign(O,{product_id:0,item_id:0,quantity_needed:0,unit:"",is_critical:!1,notes:""})},wa=t=>{Object.assign(O,{product_id:t.product_id,item_id:t.item_id,quantity_needed:t.quantity_needed,unit:t.unit,is_critical:t.is_critical,notes:t.notes||""})},je=()=>{K.value=""},Da=t=>{const i=T.value.find(l=>(l.id_item||l.id)===t);i&&(O.unit=i.unit)},Va=t=>{ee.value=t,te()},Ia=t=>{Ve.value=t,ee.value=1,te()},xa=()=>{ee.value=1,te()},$a=()=>({productItemsList:z,products:j,items:T,loading:re,saveLoading:_e,deleteLoading:ye,dialog:ge,deleteDialog:he,capacityDialog:Pe,editMode:de,selectedProductItem:N,selectedProduct:we,productionCapacity:De,currentPage:ee,totalItems:ke,itemsPerPage:Ve,filters:Me,errorMessage:M,successMessage:Ie,modalErrorMessage:K,formData:O,canCreateEdit:ca,productOptions:ma,itemOptions:pa,fetchProductItemsList:te,fetchProducts:ga,fetchItems:fa,saveProductItem:va,deleteProductItem:_a,getProductionCapacity:Ke,openCreateDialog:ka,openEditDialog:ba,openDeleteDialog:Ca,openCapacityDialog:ha,closeDialog:Ne,closeDeleteDialog:qe,closeCapacityDialog:Pa,clearModalError:je,onItemChange:Da,onPageChange:Va,onItemsPerPageChange:Ia,handleFiltersUpdate:xa}),Sa={class:"product-item-management"},Ta={class:"d-flex justify-space-between align-center mb-6"},Aa={class:"d-flex gap-3 align-center"},Fa=pe({__name:"product-items-management",setup(t){const i=vt(),{productItemsList:l,products:k,items:D,loading:F,saveLoading:x,deleteLoading:S,dialog:I,deleteDialog:h,capacityDialog:p,editMode:r,selectedProductItem:g,selectedProduct:ae,productionCapacity:oe,currentPage:n,totalItems:m,itemsPerPage:P,filters:a,errorMessage:s,successMessage:u,modalErrorMessage:b,formData:H,canCreateEdit:Y,productOptions:ue,itemOptions:Be,fetchProductItemsList:He,fetchProducts:Re,fetchItems:Je,saveProductItem:We,deleteProductItem:Ye,openCreateDialog:Qe,openEditDialog:Xe,openDeleteDialog:Ze,openCapacityDialog:Ge,onItemChange:et,onPageChange:tt,handleFiltersUpdate:fe}=$a(),at=async()=>{await Ye()},ot=q=>{Xe(q)},st=q=>{Ze(q)},lt=q=>{Ge(q)},it=q=>{console.log("🏃‍♂️ Navigating to HPP management for product:",q.name),i.push("/hpp-management")};return gt(async()=>{await Promise.all([Re(),Je()]),await He()}),(q,y)=>{var xe,$e,Se,Te;return f(),V("div",Sa,[d("div",Ta,[y[12]||(y[12]=d("div",null,[d("h1",{class:"text-h4 font-weight-bold coffee-title"}," Komposisi Produk "),d("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"}," Kelola hubungan antara produk dan item yang dibutuhkan untuk produksi ")],-1)),d("div",Aa,[c(Y)?(f(),$(U,{key:0,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:c(Qe)},{default:o(()=>y[11]||(y[11]=[v(" Tambah Komposisi ")])),_:1,__:[11]},8,["onClick"])):L("",!0)])]),c(s)?(f(),$(E,{key:0,type:"error",variant:"outlined",class:"mb-4",text:c(s),closable:"","onClick:close":y[0]||(y[0]=w=>s.value="")},null,8,["text"])):L("",!0),c(u)?(f(),$(E,{key:1,type:"success",variant:"outlined",class:"mb-4",text:c(u),closable:"","onClick:close":y[1]||(y[1]=w=>u.value="")},null,8,["text"])):L("",!0),e(W,{class:"mb-6",elevation:"0",variant:"outlined"},{default:o(()=>[e(G,null,{default:o(()=>[e(ce,null,{default:o(()=>[e(A,{cols:"12",md:"4"},{default:o(()=>[e(me,{modelValue:c(a).product_id,"onUpdate:modelValue":[y[2]||(y[2]=w=>c(a).product_id=w),c(fe)],items:c(ue),label:"Filter Produk",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),e(A,{cols:"12",md:"4"},{default:o(()=>[e(me,{modelValue:c(a).item_id,"onUpdate:modelValue":[y[3]||(y[3]=w=>c(a).item_id=w),c(fe)],items:c(Be),label:"Filter Item",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),e(A,{cols:"12",md:"4",class:"d-flex align-center"},{default:o(()=>[e(Le,{modelValue:c(a).critical_only,"onUpdate:modelValue":[y[4]||(y[4]=w=>c(a).critical_only=w),c(fe)],label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(W,{elevation:"0",variant:"outlined"},{default:o(()=>[e(G,{class:"pa-0"},{default:o(()=>[e(Ht,{"product-items":c(l),loading:c(F),"current-page":c(n),"items-per-page":c(P),"total-items":c(m),products:c(k),items:c(D),onEdit:ot,onDelete:st,onCheckCapacity:lt,onViewHpp:it,"onUpdate:page":c(tt)},null,8,["product-items","loading","current-page","items-per-page","total-items","products","items","onUpdate:page"])]),_:1})]),_:1}),e(xt,{dialog:c(I),"edit-mode":c(r),loading:c(x),"form-data":c(H),products:c(k),items:c(D),"error-message":c(b),onSave:c(We),"onUpdate:dialog":y[5]||(y[5]=w=>I.value=w),"onUpdate:errorMessage":y[6]||(y[6]=w=>b.value=w),"onUpdate:formData":y[7]||(y[7]=w=>Object.assign(c(H),w)),onItemChange:c(et)},null,8,["dialog","edit-mode","loading","form-data","products","items","error-message","onSave","onItemChange"]),e(nt,{modelValue:c(h),"onUpdate:modelValue":y[8]||(y[8]=w=>ft(h)?h.value=w:null),loading:c(S),"item-name":`${($e=(xe=c(g))==null?void 0:xe.product)==null?void 0:$e.name} - ${(Te=(Se=c(g))==null?void 0:Se.item)==null?void 0:Te.name}`||"","item-type":"komposisi",onConfirm:at,onCancel:y[9]||(y[9]=w=>h.value=!1)},null,8,["modelValue","loading","item-name"]),e(ua,{dialog:c(p),"selected-product":c(ae),"production-capacity":c(oe),loading:c(F),"onUpdate:dialog":y[10]||(y[10]=w=>p.value=w)},null,8,["dialog","selected-product","production-capacity","loading"])])}}}),co=Oe(Fa,[["__scopeId","data-v-e5b16884"]]);export{co as default};
