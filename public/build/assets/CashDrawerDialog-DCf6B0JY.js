import{g as U}from"./auth-a9M5ekjn.js";import{d as ce,V as me,r as n,w as W,D as pe,g as fe,f as s,aA as E,o as y,b as t,e as c,X as k,a0 as m,s as i,c as x,l as ve,t as p,F as ge,i as ye,v as Ve,m as Y}from"./main-B1aqd0Vn.js";import{V as M}from"./VDialog-Bl480fUx.js";import{V as C,b as D,c as j}from"./VCard-CjyTzbY9.js";import{V as he}from"./VDivider-B15MkpeQ.js";import{V as w}from"./VCardText-BbBK60TB.js";import{V as Z,a as z}from"./VRow-C4K8Zx7m.js";import{V as L}from"./VSpacer-DhS8yAXj.js";import{V as ee}from"./VForm-DQbOO8ON.js";import{V as ae}from"./VTextField-7RUAZ8_f.js";import{V as te}from"./VTextarea-DUvcUbov.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VOverlay-B-mghzwU.js";import"./forwardRefs-B931MWyl.js";import"./VImg-Bko2yg7S.js";import"./VAvatar-2w9SeItb.js";/* empty css              */const be={class:"d-flex align-center gap-2"},ke={class:"text-h4 font-weight-bold text-primary"},xe={key:0,class:"text-error text-caption"},Ce={class:"text-body-2 text-medium-emphasis mt-1"},De={key:0,class:"text-center text-medium-emphasis py-4"},we={key:1},Ie={class:"font-weight-medium"},Ke={class:"text-caption text-medium-emphasis"},Ne={class:"text-right"},Ae=ce({__name:"CashDrawerDialog",props:{modelValue:{type:Boolean},dailySales:{default:0},dailyExpenses:{default:0}},emits:["update:modelValue"],setup(le,{emit:se}){const d=le,oe=se,A=me({get:()=>d.modelValue,set:a=>oe("update:modelValue",a)}),u=n(0),S=n(""),g=n([]),I=n(!1),R=n(),F=n(!1),f=n(null),V=n(""),h=n(""),O=n(!1),K=n(!1),q=n(),B=n(!1),v=n(null),_=n(""),b=n(""),T=n(!1),N={required:a=>!!a||"Field wajib diisi",positive:a=>(typeof a=="string"?parseFloat(a.replace(/[^\d]/g,"")):a)>0||"Nilai harus lebih besar dari 0"},$=a=>{console.log("formatCurrency called with:",a,"type:",typeof a);const e=typeof a=="string"?parseFloat(a):a;return isNaN(e)||e===null||e===void 0?(console.log("formatCurrency received invalid number:",a,"type:",typeof a),"Rp 0"):new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},ne=a=>{if(!a)return"-";try{const e=new Date(a);return isNaN(e.getTime())?(console.warn("Invalid date format:",a),"-"):e.toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(e){return console.error("Error formatting date:",e,"dateString:",a),"-"}},J=async()=>{try{const a=U(),e={"Content-Type":"application/json",Accept:"application/json"};a&&(e.Authorization=`Bearer ${a}`);const l=await E.get("/api/cash-drawer/data",{headers:e});console.log("API Response:",l.data);const o=l.data.data;let r=0;(o==null?void 0:o.current_balance)!==void 0&&(o==null?void 0:o.current_balance)!==null&&(typeof o.current_balance=="string"?r=parseFloat(o.current_balance):typeof o.current_balance=="number"&&(r=o.current_balance)),u.value=isNaN(r)?0:r,console.log("Parsed balance:",r,"type:",typeof r),console.log("currentCash.value after assignment:",u.value,"type:",typeof u.value),S.value=new Date().toLocaleString("id-ID"),g.value=Array.isArray(o==null?void 0:o.today_transactions)?o.today_transactions:[]}catch(a){console.error("Error loading cash data:",a),console.log("Using fallback data");const e=5e5,l=typeof d.dailySales=="number"&&!isNaN(d.dailySales)?d.dailySales:0,o=typeof d.dailyExpenses=="number"&&!isNaN(d.dailyExpenses)?d.dailyExpenses:0;u.value=e+l-o,S.value=new Date().toLocaleString("id-ID"),g.value=[]}},P=()=>{A.value=!1},re=()=>{I.value=!0,f.value=null,V.value="",h.value=""},H=()=>{var a;I.value=!1,(a=R.value)==null||a.reset()},X=a=>{var r;const l=(((r=a.target)==null?void 0:r.value)||a).toString().replace(/\D/g,"");if(l===""){f.value=null,V.value="";return}const o=parseInt(l,10);f.value=o,V.value=o.toLocaleString("id-ID")},ue=async()=>{if(f.value)try{O.value=!0;const a=U(),e={"Content-Type":"application/json",Accept:"application/json"};a&&(e.Authorization=`Bearer ${a}`);const o=(await E.post("/api/cash-drawer/cash-in",{amount:f.value,notes:h.value,description:"Kas Masuk Manual"},{headers:e})).data;u.value=o.data.new_balance,g.value.unshift({id:Date.now(),type:"in",type_text:"Kas Masuk",amount:f.value,notes:h.value||"Kas masuk manual",created_at:new Date().toISOString()}),H(),console.log("Kas masuk berhasil ditambahkan")}catch(a){console.error("Error processing cash in:",a)}finally{O.value=!1}},ie=()=>{K.value=!0,v.value=null,_.value="",b.value=""},G=()=>{var a;K.value=!1,(a=q.value)==null||a.reset()},Q=a=>{var r;const l=(((r=a.target)==null?void 0:r.value)||a).toString().replace(/\D/g,"");if(l===""){v.value=null,_.value="";return}const o=parseInt(l,10);v.value=o,_.value=o.toLocaleString("id-ID")},de=async()=>{if(v.value)try{T.value=!0;const a=U(),e={"Content-Type":"application/json",Accept:"application/json"};a&&(e.Authorization=`Bearer ${a}`);const o=(await E.post("/api/cash-drawer/cash-out",{amount:v.value,notes:b.value,description:"Kas Keluar Manual"},{headers:e})).data;u.value=o.data.new_balance,g.value.unshift({id:Date.now(),type:"out",type_text:"Kas Keluar",amount:v.value,notes:b.value||"Kas keluar manual",created_at:new Date().toISOString()}),G(),console.log("Kas keluar berhasil ditambahkan")}catch(a){console.error("Error processing cash out:",a)}finally{T.value=!1}};return W(()=>d.modelValue,a=>{a&&J()}),W(u,(a,e)=>{console.log("currentCash changed from",e,"to",a)},{deep:!0,immediate:!0}),pe(()=>{d.modelValue&&J()}),(a,e)=>(y(),fe(M,{modelValue:A.value,"onUpdate:modelValue":e[8]||(e[8]=l=>A.value=l),"max-width":"600",persistent:""},{default:s(()=>[t(C,{class:"coffee-dialog"},{default:s(()=>[t(D,{class:"d-flex align-center justify-space-between coffee-header"},{default:s(()=>[c("div",be,[t(k,{icon:"mdi-cash-register",class:"text-white"}),e[9]||(e[9]=c("span",{class:"text-white"}," Cash Drawer ",-1))]),t(m,{icon:"tabler-x",variant:"text",color:"white",onClick:P})]),_:1}),t(he),t(w,null,{default:s(()=>[t(Z,null,{default:s(()=>[t(z,{cols:"12"},{default:s(()=>[t(C,{class:"mb-6",variant:"tonal",color:"primary"},{default:s(()=>[t(D,{class:"text-h6 pb-2"},{default:s(()=>[t(k,{icon:"mdi-cash-multiple",size:"20",class:"me-2"}),e[10]||(e[10]=i(" Kas Saat Ini "))]),_:1,__:[10]}),t(w,{class:"pt-0"},{default:s(()=>[c("div",ke,p($(u.value)),1),isNaN(u.value)?(y(),x("div",xe," Debug: currentCash is "+p(u.value)+" ("+p(typeof u.value)+") ",1)):ve("",!0),c("div",Ce," Terakhir update: "+p(S.value),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(Z,{class:"mb-4"},{default:s(()=>[t(z,{cols:"6"},{default:s(()=>[t(m,{color:"success",variant:"flat",block:"",size:"large","prepend-icon":"mdi-plus-circle",onClick:re},{default:s(()=>e[11]||(e[11]=[i(" Kas Masuk ")])),_:1,__:[11]})]),_:1}),t(z,{cols:"6"},{default:s(()=>[t(m,{color:"error",variant:"flat",block:"",size:"large","prepend-icon":"mdi-minus-circle",onClick:ie},{default:s(()=>e[12]||(e[12]=[i(" Kas Keluar ")])),_:1,__:[12]})]),_:1})]),_:1}),t(C,{variant:"outlined"},{default:s(()=>[t(D,{class:"text-h6"},{default:s(()=>[t(k,{icon:"mdi-history",size:"20",class:"me-2"}),e[13]||(e[13]=i(" Transaksi Hari Ini "))]),_:1,__:[13]}),t(w,null,{default:s(()=>[g.value.length===0?(y(),x("div",De," Belum ada transaksi hari ini ")):(y(),x("div",we,[(y(!0),x(ge,null,ye(g.value,(l,o)=>(y(),x("div",{key:o,class:"d-flex justify-space-between align-center py-2 border-b"},[c("div",null,[c("div",Ie,p(l.type_text||l.description),1),c("div",Ke,p(ne(l.created_at)),1)]),c("div",Ne,[c("div",{class:Ve([l.type==="in"?"text-success":"text-error","font-weight-bold"])},p(l.type==="in"?"+":"-")+p($(l.amount)),3)])]))),128))]))]),_:1})]),_:1})]),_:1}),t(j,null,{default:s(()=>[t(L),t(m,{variant:"text",onClick:P},{default:s(()=>e[14]||(e[14]=[i(" Tutup ")])),_:1,__:[14]})]),_:1})]),_:1}),t(M,{modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=l=>I.value=l),"max-width":"400",persistent:""},{default:s(()=>[t(C,null,{default:s(()=>[t(D,null,{default:s(()=>[t(k,{icon:"mdi-plus-circle",class:"me-2"}),e[15]||(e[15]=i(" Kas Masuk "))]),_:1,__:[15]}),t(w,null,{default:s(()=>[t(Y(ee),{ref_key:"cashInForm",ref:R,modelValue:F.value,"onUpdate:modelValue":e[2]||(e[2]=l=>F.value=l)},{default:s(()=>[t(ae,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=l=>V.value=l),label:"Jumlah Kas Masuk",variant:"outlined",prefix:"Rp",placeholder:"0",rules:[N.required,N.positive],class:"mb-4",onInput:X,onBlur:X},null,8,["modelValue","rules"]),t(te,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=l=>h.value=l),label:"Catatan (Opsional)",variant:"outlined",rows:"3",placeholder:"Masukkan catatan untuk kas masuk..."},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(j,null,{default:s(()=>[t(m,{variant:"text",onClick:H},{default:s(()=>e[16]||(e[16]=[i(" Batal ")])),_:1,__:[16]}),t(L),t(m,{color:"success",loading:O.value,disabled:!F.value||!f.value,onClick:ue},{default:s(()=>e[17]||(e[17]=[i(" Simpan ")])),_:1,__:[17]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:K.value,"onUpdate:modelValue":e[7]||(e[7]=l=>K.value=l),"max-width":"400",persistent:""},{default:s(()=>[t(C,null,{default:s(()=>[t(D,null,{default:s(()=>[t(k,{icon:"mdi-minus-circle",class:"me-2"}),e[18]||(e[18]=i(" Kas Keluar "))]),_:1,__:[18]}),t(w,null,{default:s(()=>[t(Y(ee),{ref_key:"cashOutForm",ref:q,modelValue:B.value,"onUpdate:modelValue":e[6]||(e[6]=l=>B.value=l)},{default:s(()=>[t(ae,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=l=>_.value=l),label:"Jumlah Kas Keluar",variant:"outlined",prefix:"Rp",placeholder:"0",rules:[N.required,N.positive],class:"mb-4",onInput:Q,onBlur:Q},null,8,["modelValue","rules"]),t(te,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),label:"Catatan (Opsional)",variant:"outlined",rows:"3",placeholder:"Masukkan catatan untuk kas keluar..."},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(j,null,{default:s(()=>[t(m,{variant:"text",onClick:G},{default:s(()=>e[19]||(e[19]=[i(" Batal ")])),_:1,__:[19]}),t(L),t(m,{color:"error",loading:T.value,disabled:!B.value||!v.value,onClick:de},{default:s(()=>e[20]||(e[20]=[i(" Simpan ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),Xe=_e(Ae,[["__scopeId","data-v-dd61cb50"]]);export{Xe as default};
