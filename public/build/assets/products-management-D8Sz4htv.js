import{D as Ut}from"./DeleteConfirmationDialog-QXjdNEjt.js";import{f as Ke}from"./formatters-BD6tdLx_.js";import{P as gt,u as Bt}from"./useProductItems-DEZLRw9t.js";import{I as Et}from"./ItemsApi-D6TjYobS.js";import{u as wt,H as Ft}from"./HPPBreakdownDialog-FQY0Xrtz.js";import{V as Oe}from"./VDialog-_e1VDpOv.js";import{V as ee,b as Pe,c as je}from"./VCard-Jbd3k76N.js";import{a6 as Rt,a7 as Lt,ae as Nt,r as D,b0 as mt,af as qt,b5 as It,bf as Ot,V as me,W as jt,w as Ce,br as $t,av as ht,a8 as Jt,b as e,p as xe,ba as Wt,cx as Gt,c8 as Dt,bd as Qt,F as Ue,X as k,cm as Xt,c9 as Zt,aY as Yt,s as c,d as Ne,D as ut,c as Z,f as t,e as o,t as r,a1 as R,g as F,l as W,m as B,ax as pt,cw as _t,at as Fe,i as Ye,v as lt,o as m,_ as Je,az as xt,a0 as Pt,j as At,cy as ea,bp as ta,au as We,ao as aa,ap as la,a3 as kt}from"./main-ELhEevnV.js";import{V as ae}from"./VCardText-ParJ3FGj.js";import{V as $e}from"./VAvatar-BxtSZQnQ.js";import{V as se}from"./VChip-35XKqHoD.js";import{V as De,a as I}from"./VRow-Bg6KAjYD.js";import{V as Vt}from"./VAutocomplete-B_uEGbdG.js";import{u as oa,t as vt,V as ft,a as Qe,b as rt,d as dt}from"./VList-E34bmaCO.js";import{u as ia,V as we,m as sa}from"./VTextField-BQLvXQO7.js";import{V as nt}from"./VSwitch-B1iXWg2P.js";import{V as Ge}from"./VSpacer-Bw5dOM42.js";import{V as ct}from"./VSnackbar-Cgbr6uHK.js";import{P as na}from"./ProductsApi-B7incu-X.js";import{u as ra,m as ua,a as da,V as Re}from"./VSelect-DP-tOd57.js";import{V as ca}from"./VCheckbox-DI5DvW3D.js";import{V as He}from"./VDivider-D3wxuLmG.js";import{a as ma,V as va}from"./VDataTable-DRWcA8G3.js";import{V as pa}from"./VContainer-BeRMPbCd.js";import{a as Ht,u as fa,P as ga}from"./useProducts-CqDpcjcF.js";import{V as Ct}from"./VForm-DK8daYBP.js";import{V as zt}from"./VTextarea-D8dMvja6.js";import{V as Be}from"./VTooltip-BkhJ4Q_5.js";import{m as _a,V as ka}from"./VImg-D3MXW20U.js";import{V as ya,u as ba}from"./useCategories-BpSRBdcx.js";import{u as ha,m as xa,h as wa}from"./filter-Cxs2yC_o.js";import{f as Pa}from"./forwardRefs-B931MWyl.js";import{V as Va}from"./VMenu-DdkdRyxH.js";import{V as Ca}from"./VCheckboxBtn-DsjYxew2.js";import{V as Sa}from"./VDataTableServer-Dyh8nGoh.js";import{V as Ia}from"./VSkeletonLoader-CV4i-SGx.js";import{V as $a,a as Da,b as yt,c as bt}from"./VTabs-BvTEVp_Q.js";import"./api-CuV6UI37.js";import"./index-D-EbNoF1.js";import"./VOverlay-DdzEoQqc.js";/* empty css              */import"./VTable-b7dvh4am.js";import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-CcVC10vZ.js";const za=Lt({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...xa({filterKeys:["title"]}),...ua({hideNoData:!0,returnObject:!0}),...Wt(sa({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),..._a({transition:!1})},"VCombobox"),Ta=Rt()({name:"VCombobox",props:za(),emits:{"update:focused":$=>!0,"update:modelValue":$=>!0,"update:search":$=>!0,"update:menu":$=>!0},setup($,be){var n;let{emit:N,slots:z}=be;const{t:J}=Nt(),g=D(),G=mt(!1),U=mt(!0),h=mt(!1),v=D(),j=D(),p=mt(-1);let A=!1;const{items:de,transformIn:ke,transformOut:S}=oa($),{textColorClasses:ne,textColorStyles:re}=qt(()=>{var i;return(i=g.value)==null?void 0:i.color}),Q=It($,"modelValue",[],i=>ke(Ot(i)),i=>{const b=S(i);return $.multiple?b:b[0]??null}),ve=ia($),T=me(()=>!!($.chips||z.chip)),_=me(()=>T.value||!!z.selection),f=mt(!$.multiple&&!_.value?((n=Q.value[0])==null?void 0:n.title)??"":""),w=me({get:()=>f.value,set:i=>{var b;if(f.value=i??"",!$.multiple&&!_.value&&(Q.value=[vt($,i)]),i&&$.multiple&&((b=$.delimiters)!=null&&b.length)){const M=i.split(new RegExp(`(?:${$.delimiters.join("|")})+`));M.length>1&&(M.forEach(K=>{K=K.trim(),K&&Me(vt($,K))}),f.value="")}i||(p.value=-1),U.value=!i}}),_e=me(()=>typeof $.counterValue=="function"?$.counterValue(Q.value):typeof $.counterValue=="number"?$.counterValue:$.multiple?Q.value.length:w.value.length),{filteredItems:pe,getMatches:fe}=ha($,de,()=>U.value?"":w.value),P=me(()=>$.hideSelected?pe.value.filter(i=>!Q.value.some(b=>b.value===i.value)):pe.value),q=me(()=>$.hideNoData&&!P.value.length||ve.isReadonly.value||ve.isDisabled.value),x=It($,"menu"),O=me({get:()=>x.value,set:i=>{var b;x.value&&!i&&((b=v.value)!=null&&b.Î¨openChildren.size)||i&&q.value||(x.value=i)}}),E=jt(()=>O.value?$.closeText:$.openText);Ce(f,i=>{A?ht(()=>A=!1):G.value&&!O.value&&(O.value=!0),N("update:search",i)}),Ce(Q,i=>{var b;!$.multiple&&!_.value&&(f.value=((b=i[0])==null?void 0:b.title)??"")});const y=me(()=>Q.value.map(i=>i.value)),s=me(()=>{var b;return($.autoSelectFirst===!0||$.autoSelectFirst==="exact"&&w.value===((b=P.value[0])==null?void 0:b.title))&&P.value.length>0&&!U.value&&!h.value}),a=D(),l=ra(a,g);function u(i){A=!0,$.openOnClear&&(O.value=!0)}function te(){q.value||(O.value=!0)}function L(i){q.value||(G.value&&(i.preventDefault(),i.stopPropagation()),O.value=!O.value)}function ce(i){var b;i.key!==" "&&Dt(i)&&((b=g.value)==null||b.focus())}function Te(i){var K,d,H,X;if(Gt(i)||ve.isReadonly.value)return;const b=(K=g.value)==null?void 0:K.selectionStart,M=Q.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(i.key)&&i.preventDefault(),["Enter","ArrowDown"].includes(i.key)&&(O.value=!0),["Escape"].includes(i.key)&&(O.value=!1),["Enter","Escape","Tab"].includes(i.key)&&(s.value&&["Enter","Tab"].includes(i.key)&&!Q.value.some(C=>{let{value:oe}=C;return oe===P.value[0].value})&&Me(pe.value[0]),U.value=!0),i.key==="ArrowDown"&&s.value&&((d=a.value)==null||d.focus("next")),i.key==="Enter"&&w.value&&(Me(vt($,w.value)),_.value&&(f.value="")),["Backspace","Delete"].includes(i.key)){if(!$.multiple&&_.value&&Q.value.length>0&&!w.value)return Me(Q.value[0],!1);if(~p.value){i.preventDefault();const C=p.value;Me(Q.value[p.value],!1),p.value=C>=M-1?M-2:C}else i.key==="Backspace"&&!w.value&&(p.value=M-1);return}if($.multiple)if(i.key==="ArrowLeft"){if(p.value<0&&b&&b>0)return;const C=p.value>-1?p.value-1:M-1;Q.value[C]?p.value=C:(p.value=-1,(H=g.value)==null||H.setSelectionRange(w.value.length,w.value.length))}else if(i.key==="ArrowRight"){if(p.value<0)return;const C=p.value+1;Q.value[C]?p.value=C:(p.value=-1,(X=g.value)==null||X.setSelectionRange(0,0))}else~p.value&&Dt(i)&&(p.value=-1)}function le(){var i;$.eager&&((i=j.value)==null||i.calculateVisibleItems())}function ze(){var i;G.value&&(U.value=!0,(i=g.value)==null||i.focus())}function Me(i){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!i||i.props.disabled))if($.multiple){const M=Q.value.findIndex(d=>($.valueComparator||$t)(d.value,i.value)),K=b??!~M;if(~M){const d=K?[...Q.value,i]:[...Q.value];d.splice(M,1),Q.value=d}else K&&(Q.value=[...Q.value,i]);$.clearOnSelect&&(w.value="")}else{const M=b!==!1;Q.value=M?[i]:[],f.value=M&&!_.value?i.title:"",ht(()=>{O.value=!1,U.value=!0})}}function ot(i){G.value=!0,setTimeout(()=>{h.value=!0})}function Xe(i){h.value=!1}function V(i){(i==null||i===""&&!$.multiple&&!_.value)&&(Q.value=[])}return Ce(G,(i,b)=>{if(!(i||i===b)&&(p.value=-1,O.value=!1,w.value)){if($.multiple){Me(vt($,w.value));return}if(!_.value)return;Q.value.some(M=>{let{title:K}=M;return K===w.value})?f.value="":Me(vt($,w.value))}}),Ce(O,()=>{if(!$.hideSelected&&O.value&&Q.value.length){const i=P.value.findIndex(b=>Q.value.some(M=>($.valueComparator||$t)(M.value,b.value)));Qt&&window.requestAnimationFrame(()=>{var b;i>=0&&((b=j.value)==null||b.scrollToIndex(i))})}}),Ce(()=>$.items,(i,b)=>{O.value||G.value&&!b.length&&i.length&&(O.value=!0)}),Jt(()=>{const i=!!(!$.hideNoData||P.value.length||z["prepend-item"]||z["append-item"]||z["no-data"]),b=Q.value.length>0,M=we.filterProps($);return e(we,xe({ref:g},M,{modelValue:w.value,"onUpdate:modelValue":[K=>w.value=K,V],focused:G.value,"onUpdate:focused":K=>G.value=K,validationValue:Q.externalValue,counterValue:_e.value,dirty:b,class:["v-combobox",{"v-combobox--active-menu":O.value,"v-combobox--chips":!!$.chips,"v-combobox--selection-slot":!!_.value,"v-combobox--selecting-index":p.value>-1,[`v-combobox--${$.multiple?"multiple":"single"}`]:!0},$.class],style:$.style,readonly:ve.isReadonly.value,placeholder:b?void 0:$.placeholder,"onClick:clear":u,"onMousedown:control":te,onKeydown:Te}),{...z,default:()=>e(Ue,null,[e(Va,xe({ref:v,modelValue:O.value,"onUpdate:modelValue":K=>O.value=K,activator:"parent",contentClass:"v-combobox__content",disabled:q.value,eager:$.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:$.transition,onAfterEnter:le,onAfterLeave:ze},$.menuProps),{default:()=>[i&&e(ft,xe({ref:a,selected:y.value,selectStrategy:$.multiple?"independent":"single-independent",onMousedown:K=>K.preventDefault(),onKeydown:ce,onFocusin:ot,onFocusout:Xe,tabindex:"-1","aria-live":"polite",color:$.itemColor??$.color},l,$.listProps),{default:()=>{var K,d,H;return[(K=z["prepend-item"])==null?void 0:K.call(z),!P.value.length&&!$.hideNoData&&(((d=z["no-data"])==null?void 0:d.call(z))??e(Qe,{key:"no-data",title:J($.noDataText)},null)),e(da,{ref:j,renderless:!0,items:P.value,itemKey:"value"},{default:X=>{var Se;let{item:C,index:oe,itemRef:ie}=X;const he=xe(C.props,{ref:ie,key:C.value,active:s.value&&oe===0?!0:void 0,onClick:()=>Me(C,null)});return((Se=z.item)==null?void 0:Se.call(z,{item:C,index:oe,props:he}))??e(Qe,xe(he,{role:"option"}),{prepend:Ve=>{let{isSelected:Ae}=Ve;return e(Ue,null,[$.multiple&&!$.hideSelected?e(Ca,{key:C.value,modelValue:Ae,ripple:!1,tabindex:"-1"},null):void 0,C.props.prependAvatar&&e($e,{image:C.props.prependAvatar},null),C.props.prependIcon&&e(k,{icon:C.props.prependIcon},null)])},title:()=>{var Ve;return U.value?C.title:wa("v-combobox",C.title,(Ve=fe(C))==null?void 0:Ve.title)}})}}),(H=z["append-item"])==null?void 0:H.call(z)]}})]}),Q.value.map((K,d)=>{function H(ie){ie.stopPropagation(),ie.preventDefault(),Me(K,!1)}const X={"onClick:close":H,onKeydown(ie){ie.key!=="Enter"&&ie.key!==" "||(ie.preventDefault(),ie.stopPropagation(),H(ie))},onMousedown(ie){ie.preventDefault(),ie.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},C=T.value?!!z.chip:!!z.selection,oe=C?Zt(T.value?z.chip({item:K,index:d,props:X}):z.selection({item:K,index:d})):void 0;if(!(C&&!oe))return e("div",{key:K.value,class:["v-combobox__selection",d===p.value&&["v-combobox__selection--selected",ne.value]],style:d===p.value?re.value:{}},[T.value?z.chip?e(Yt,{key:"chip-defaults",defaults:{VChip:{closable:$.closableChips,size:"small",text:K.title}}},{default:()=>[oe]}):e(se,xe({key:"chip",closable:$.closableChips,size:"small",text:K.title,disabled:K.props.disabled},X),null):oe??e("span",{class:"v-combobox__selection-text"},[K.title,$.multiple&&d<Q.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[c(",")])])])})]),"append-inner":function(){var X,C;for(var K=arguments.length,d=new Array(K),H=0;H<K;H++)d[H]=arguments[H];return e(Ue,null,[(X=z["append-inner"])==null?void 0:X.call(z,...d),(!$.hideNoData||$.items.length)&&$.menuIcon?e(k,{class:"v-combobox__menu-icon",color:(C=g.value)==null?void 0:C.fieldIconColor,icon:$.menuIcon,onMousedown:L,onClick:Xt,"aria-label":J(E.value),title:J(E.value),tabindex:"-1"},null):void 0])}})}),Pa({isFocused:G,isPristine:U,menu:O,search:w,selectionIndex:p,filteredItems:pe,select:Me},g)}}),Ua={class:"d-flex align-center gap-3"},Aa={class:"text-body-2 ma-0 opacity-90"},Ha={class:"d-flex align-center gap-4"},Ma={class:"flex-grow-1"},Ka={class:"text-h6 font-weight-bold mb-1"},Ba={class:"text-body-2 text-medium-emphasis mb-1"},Ea={class:"d-flex align-center gap-4 mb-0"},Fa={class:"text-body-2 text-medium-emphasis mb-0"},Ra={class:"text-body-2 text-info mb-0 font-weight-medium"},La={key:0,class:"text-body-2 text-success mb-0 font-weight-medium"},Na={class:"text-body-1 font-weight-bold"},qa={class:"text-body-1 font-weight-bold"},Oa={class:"text-body-1 font-weight-bold"},ja={class:"text-body-1 font-weight-bold"},Ja={class:"d-flex align-center justify-space-between w-100"},Wa={class:"d-flex align-center"},Ga={key:0,class:"text-warning"},Qa={key:1},Xa={key:0,class:"text-center pa-8"},Za={class:"d-flex align-center gap-4 mt-1"},Ya={key:1,class:"text-primary"},el={class:"d-flex gap-2"},tl=Ne({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup($,{emit:be}){const N=$,z=be,J=me({get:()=>N.modelValue,set:V=>z("update:modelValue",V)}),g=D(!1),G=D([]),U=D(!1),h=D(!1),v=D(""),j=D(""),p=D(!1),A=D(-1),de=D(!1),{loading:ke,currentHPPBreakdown:S,getProductHPPBreakdown:ne}=wt(),re=me(()=>{var V,n,i;return((V=S.value)==null?void 0:V.total_hpp)||((n=N.product)==null?void 0:n.hpp)||((i=N.product)==null?void 0:i.cost)||0}),Q=me(()=>{var i;const V=((i=N.product)==null?void 0:i.price)||0,n=re.value;return V-n}),ve=me(()=>{var i;const V=((i=N.product)==null?void 0:i.price)||0,n=re.value;return V<=0?0:Math.round((V-n)/V*100)}),T=D({itemId:null,quantity:1,unit:"pcs",isCritical:!1}),_=D([]),f=D(!1),w=D([]),_e=async()=>{var V;if(N.product)try{const n=N.product.id_product||N.product.id,i=await gt.getAll({product_id:n,page:1,per_page:1e5});i.success&&((V=i.data)!=null&&V.data)&&(G.value=i.data.data,w.value=JSON.parse(JSON.stringify(i.data.data)),console.log("ðŸ“¥ Fetched composition items:",i.data.data),i.data.data.length>0&&console.log("ðŸ“¥ First item structure:",{full:i.data.data[0],item:i.data.data[0].item,item_id:i.data.data[0].item_id,id_product_item:i.data.data[0].id_product_item}))}catch(n){console.error("Error fetching product composition:",n)}},pe=async()=>{var V;f.value=!0;try{const n=await Et.getAll({page:1,per_page:1e5,active:!0});n.success&&((V=n.data)!=null&&V.data)&&(_.value=n.data.data.map(i=>{var b,M,K;return{id:((b=i.id_item)==null?void 0:b.toString())||((M=i.id)==null?void 0:M.toString()),name:i.name,current_stock:((K=i.inventory)==null?void 0:K.current_stock)||0,unit:i.unit||"pcs"}}))}catch(n){console.error("Error fetching available items:",n),_.value=[]}finally{f.value=!1}},fe=me(()=>T.value.itemId&&T.value.quantity>0);me(()=>{if(!T.value.itemId)return null;const V=_.value.find(n=>n.id===T.value.itemId);return(V==null?void 0:V.unit)||null});const P=me(()=>{if(!T.value.itemId)return null;const V=_.value.find(n=>n.id===T.value.itemId);return V?O(V):null}),q=me(()=>P.value!==null&&P.value<=0),x=me(()=>Array.isArray(_.value)?_.value:[]),O=V=>V.current_stock||V.stock||0,E=()=>f.value?"Memuat items...":!_.value||_.value.length===0?"Tidak ada item tersedia":"Tidak ada item yang ditemukan",y=V=>{const n=O(V);return n>50?"success":n>20?"warning":n>0?"error":"grey"},s=V=>{const n=O(V);return n>50?"Aman":n>20?"Rendah":n>0?"Kritis":"Habis"};Ce(()=>N.items,V=>{V&&V.length>0,G.value=[...V]},{immediate:!0}),Ce(()=>N.modelValue,async V=>{V&&N.product&&(_e(),await a())});const a=async()=>{if(N.product&&(N.product.id_product||N.product.id))try{const V=parseInt(String(N.product.id_product||N.product.id));await ne(V,"latest")}catch(V){console.warn("Could not load HPP data:",V)}};ut(()=>{pe()});const l=()=>{de.value=!0},u=async()=>{await a(),z("refresh")},te=()=>G.value.some(n=>{var i;return((i=n.item)==null?void 0:i.inventory)&&n.item.inventory.current_stock<n.quantity_needed})?"error":"success",L=()=>G.value.some(n=>{var i;return((i=n.item)==null?void 0:i.inventory)&&n.item.inventory.current_stock<n.quantity_needed})?"Stok Kritis":"Stok Aman",ce=()=>{if(!fe.value)return;const V=_.value.find(b=>b.id===T.value.itemId);if(!V)return;if(G.value.find(b=>{var K,d;const M=((K=b.item)==null?void 0:K.id)||((d=b.item)==null?void 0:d.id_item)||b.item_id;return String(M)===String(V.id)})){v.value=`Item "${V.name}" sudah ada dalam komposisi produk ini. Silakan edit item yang sudah ada.`,U.value=!0;return}const i={id_product_item:`temp_${Date.now()}`,item:{id:String(V.id),name:V.name,inventory:{current_stock:V.current_stock||0}},quantity_needed:T.value.quantity,unit:T.value.unit,is_critical:T.value.isCritical};G.value.push(i),ze()},Te=(V,n)=>{var M,K;if(_.value.length===0){console.warn("âš ï¸ Available items not loaded yet, fetching..."),pe().then(()=>{Te(V,n)});return}p.value=!0,A.value=n;let i=((M=V.item)==null?void 0:M.id)||((K=V.item)==null?void 0:K.id_item)||V.item_id||null;if(i!==null&&(i=i.toString()),console.log("âœï¸ Edit Item:",{itemId:i,item:V,item_item:V.item,item_id_root:V.item_id}),T.value={itemId:i,quantity:parseFloat(V.quantity_needed.toString())||0,unit:V.unit,isCritical:V.is_critical},!_.value.find(d=>d.id===i)){console.warn("âš ï¸ Item ID not found in available items, trying alternative matching...");const d=_.value.find(H=>{var X;return H.name===((X=V.item)==null?void 0:X.name)});d?T.value.itemId=d.id:console.error("âŒ Could not find item in available items by ID or name")}},le=()=>{var K,d;if(!fe.value||A.value===-1)return;const V=_.value.find(H=>H.id===T.value.itemId);if(!V)return;const n=G.value[A.value],i=((K=n.item)==null?void 0:K.id)||((d=n.item)==null?void 0:d.id_item)||n.item_id,b=V.id,M=String(i)!==String(b);if(M&&G.value.find((X,C)=>{var ie,he;if(C===A.value)return!1;const oe=((ie=X.item)==null?void 0:ie.id)||((he=X.item)==null?void 0:he.id_item)||X.item_id;return String(oe)===String(b)})){v.value=`Item "${V.name}" sudah ada dalam komposisi produk ini. Silakan edit item yang sudah ada.`,U.value=!0;return}console.log("ðŸ”„ Update Item:",{hasItemChanged:M,currentItemId:i,selectedItemId:b,currentProductItemId:n.id_product_item,currentItem:n}),G.value[A.value]={...G.value[A.value],id_product_item:M?`temp_${Date.now()}`:n.id_product_item,item_id:parseInt(String(b)),item:{id:String(V.id),id_item:parseInt(String(V.id)),name:V.name,inventory:{current_stock:V.current_stock||0}},quantity_needed:T.value.quantity,unit:T.value.unit,is_critical:T.value.isCritical},ze()},ze=()=>{p.value=!1,A.value=-1,T.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},Me=V=>{G.value.splice(V,1)},ot=async()=>{var V,n,i,b,M,K,d,H,X,C,oe,ie,he,Se,Ve,Ae;if(N.product){g.value=!0;try{const Le=parseInt(String(((V=N.product)==null?void 0:V.id_product)||((n=N.product)==null?void 0:n.id)||"0")),et=w.value||[],Ze=G.value;for(const ue of Ze)if(String(ue.id_product_item||"").startsWith("temp_")){const qe=((i=ue.item)==null?void 0:i.id)||((b=ue.item)==null?void 0:b.id_item)||ue.item_id,Ee=et.find(tt=>{var ye,Y;const it=((ye=tt.item)==null?void 0:ye.id)||((Y=tt.item)==null?void 0:Y.id_item)||tt.item_id,st=Ze.find(at=>at.id_product_item===tt.id_product_item&&!String(at.id_product_item).startsWith("temp_"));return String(it)===String(qe)&&!st});Ee&&(console.log("ðŸ”„ Converting DELETE+CREATE to UPDATE:",{item_name:(M=ue.item)==null?void 0:M.name,old_id:Ee.id_product_item,temp_id:ue.id_product_item}),ue.id_product_item=Ee.id_product_item)}for(const ue of Ze){const Ie=et.find(Ee=>{const tt=Ee.id_product_item,it=ue.id_product_item;if(!it||String(it).startsWith("temp_"))return!1;const st=parseInt(String(tt)),ye=parseInt(String(it));return!isNaN(st)&&!isNaN(ye)&&st===ye?(console.log("âœ… Found existing match:",st,"===",ye),!0):!1});if(console.log("ðŸ” Item matching result:",{item_name:(K=ue.item)==null?void 0:K.name,current_id_product_item:ue.id_product_item,current_id_type:typeof ue.id_product_item,existingItem_found:!!Ie,existingItem_id:Ie==null?void 0:Ie.id_product_item,existingItem_id_type:typeof(Ie==null?void 0:Ie.id_product_item)}),!((d=ue.item)!=null&&d.id)||parseInt(ue.item.id)===0){console.warn("âš ï¸ Skipping item with invalid item_id:",{item_name:(H=ue.item)==null?void 0:H.name,item_id:(X=ue.item)==null?void 0:X.id,full_item:ue});continue}const qe={product_id:Le,item_id:parseInt(((C=ue.item)==null?void 0:C.id)||"0"),quantity_needed:parseFloat(ue.quantity_needed.toString()),unit:ue.unit||"",is_critical:ue.is_critical,notes:ue.notes||""};console.log("ðŸ” Processing item:",{item_name:(oe=ue.item)==null?void 0:oe.name,item_id:(ie=ue.item)==null?void 0:ie.id,id_product_item:ue.id_product_item,existingItem:Ie?{id:Ie.id_product_item,item_id:(he=Ie.item)==null?void 0:he.id}:null,action:Ie&&Ie.id_product_item?"UPDATE":"CREATE"});try{Ie&&Ie.id_product_item&&!Ie.id_product_item.toString().startsWith("temp_")?(console.log("ðŸ“ Updating item:",Ie.id_product_item),await gt.update(parseInt(Ie.id_product_item),qe)):(console.log("âž• Creating new item"),await gt.create(qe))}catch(Ee){throw console.error("âŒ Error processing item:",Ee),(Se=Ee.message)!=null&&Se.includes("already assigned")?v.value=`Item "${(Ve=ue.item)==null?void 0:Ve.name}" sudah ditambahkan ke produk ini`:v.value=Ee.message||"Terjadi kesalahan saat menyimpan item",U.value=!0,Ee}}for(const ue of et)if(!Ze.find(qe=>String(qe.id_product_item)===String(ue.id_product_item))&&ue.id_product_item)try{console.log("ï¿½ï¸ Deleting item:",ue.id_product_item,(Ae=ue.item)==null?void 0:Ae.name),await gt.delete(parseInt(String(ue.id_product_item)))}catch(qe){console.error("âŒ Error deleting item:",qe),v.value=`Gagal menghapus item: ${qe.message}`,U.value=!0}j.value="Komposisi produk berhasil disimpan!",h.value=!0,z("save",{product:N.product,items:G.value}),z("refresh"),Xe()}catch(Le){console.error("âŒ Error saving composition:",Le),U.value||(v.value=Le.message||"Terjadi kesalahan saat menyimpan komposisi",U.value=!0)}finally{g.value=!1}}},Xe=()=>{J.value=!1,setTimeout(()=>{G.value=[...N.items],ze()},300)};return(V,n)=>{var i,b,M,K;return m(),Z(Ue,null,[e(Oe,{modelValue:J.value,"onUpdate:modelValue":n[8]||(n[8]=d=>J.value=d),"max-width":"900",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var d;return[o("div",Ua,[e(k,{icon:"mdi-chef-hat",size:"24"}),o("div",null,[n[11]||(n[11]=o("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),o("p",Aa,r(((d=V.product)==null?void 0:d.name)||"Produk"),1)])]),e(R,{icon:"mdi-close",variant:"text",size:"small",onClick:Xe})]}),_:1}),e(ae,{class:"pa-6"},{default:t(()=>[e(ee,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(ae,{class:"pa-4"},{default:t(()=>{var d,H,X,C,oe,ie;return[o("div",Ha,[e($e,{image:(d=V.product)==null?void 0:d.image_url,size:"64"},{default:t(()=>{var he;return[(he=V.product)!=null&&he.image_url?W("",!0):(m(),F(k,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),o("div",Ma,[o("h4",Ka,r((H=V.product)==null?void 0:H.name),1),o("p",Ba," SKU: "+r(((X=V.product)==null?void 0:X.sku)||"SKU-"+((C=V.product)==null?void 0:C.id_product)),1),o("div",Ea,[o("p",Fa," Harga: "+r(B(Ke)(((oe=V.product)==null?void 0:oe.price)||0)),1),o("p",Ra," HPP: "+r(B(Ke)(re.value)),1),(ie=V.product)!=null&&ie.price&&re.value?(m(),Z("p",La," Margin: "+r(B(Ke)(Q.value)),1)):W("",!0)])]),e(se,{color:te(),variant:"tonal"},{default:t(()=>[c(r(L()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e(De,{class:"mb-6"},{default:t(()=>[e(I,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"info"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>[e(k,{icon:"mdi-calculator",size:"20",class:"mb-1"}),o("div",Na,[c(r(B(Ke)(re.value))+" ",1),B(ke)?(m(),F(pt,{key:0,indeterminate:"",size:"12",width:"2",class:"ml-1"})):W("",!0)]),n[12]||(n[12]=o("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[12]})]),_:1})]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"primary"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>{var d;return[e(k,{icon:"mdi-currency-usd",size:"20",class:"mb-1"}),o("div",qa,r(B(Ke)(((d=V.product)==null?void 0:d.price)||0)),1),n[13]||(n[13]=o("div",{class:"text-caption"},"Harga Jual",-1))]}),_:1,__:[13]})]),_:1})]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"success"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>[e(k,{icon:"mdi-trending-up",size:"20",class:"mb-1"}),o("div",Oa,r(B(Ke)(Q.value)),1),n[14]||(n[14]=o("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[14]})]),_:1})]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"warning"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>[e(k,{icon:"mdi-percent",size:"20",class:"mb-1"}),o("div",ja,r(ve.value)+"% ",1),n[15]||(n[15]=o("div",{class:"text-caption"},"Margin %",-1))]),_:1,__:[15]})]),_:1})]),_:1})]),_:1}),e(ee,{class:"mb-6",elevation:"2"},{default:t(()=>[e(Pe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[o("div",Ja,[o("div",Wa,[e(k,{icon:p.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),c(" "+r(p.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(ae,{class:"pa-4"},{default:t(()=>[e(De,null,{default:t(()=>[e(I,{cols:"12",md:"4"},{default:t(()=>[e(Vt,{modelValue:T.value.itemId,"onUpdate:modelValue":n[0]||(n[0]=d=>T.value.itemId=d),items:x.value,loading:f.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item (termasuk yang stok kosong)...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":E()},{item:t(({props:d,item:H})=>[e(Qe,xe(d,{class:{"text-medium-emphasis":O(H.raw)<=0}}),{prepend:t(()=>[e($e,{size:"32",class:"me-3",color:O(H.raw)<=0?"warning":"primary",variant:"tonal"},{default:t(()=>[e(k,{icon:"mdi-package-variant",color:O(H.raw)<=0?"warning":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[O(H.raw)>0?(m(),F(se,{key:0,size:"x-small",color:y(H.raw),variant:"tonal"},{default:t(()=>[c(r(s(H.raw)),1)]),_:2},1032,["color"])):(m(),F(se,{key:1,size:"x-small",color:"warning",variant:"tonal","prepend-icon":"mdi-alert"},{default:t(()=>n[17]||(n[17]=[c(" Kosong ")])),_:1,__:[17]}))]),default:t(()=>[e(rt,null,{default:t(()=>[c(r(H.raw.name),1)]),_:2},1024),e(dt,{class:"text-medium-emphasis"},{default:t(()=>[O(H.raw)<=0?(m(),Z("span",Ga,[e(k,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),n[16]||(n[16]=c(" Stok Kosong - Masih bisa digunakan "))])):(m(),Z("span",Qa," Stok: "+r(O(H.raw))+" "+r(H.raw.unit),1))]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(we,{modelValue:T.value.quantity,"onUpdate:modelValue":n[1]||(n[1]=d=>T.value.quantity=d),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(nt,{modelValue:T.value.isCritical,"onUpdate:modelValue":n[2]||(n[2]=d=>T.value.isCritical=d),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(R,{color:p.value?"success":"primary",block:"","prepend-icon":p.value?"mdi-check":"mdi-plus",onClick:n[3]||(n[3]=d=>p.value?le():ce()),disabled:!fe.value},{default:t(()=>[c(r(p.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),p.value?(m(),F(R,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:ze},{default:t(()=>n[18]||(n[18]=[c(" Batal ")])),_:1,__:[18]})):W("",!0)]),_:1})]),_:1}),q.value?(m(),F(Fe,{key:0,color:"warning",variant:"tonal",class:"mt-4","prepend-icon":"mdi-alert"},{default:t(()=>[e(_t,null,{default:t(()=>n[19]||(n[19]=[c("Item Stok Kosong")])),_:1,__:[19]}),n[20]||(n[20]=o("div",null,"Item yang dipilih sedang kosong stok, namun masih bisa ditambahkan ke komposisi. Pastikan untuk memperbarui stok sebelum produksi.",-1))]),_:1,__:[20]})):W("",!0)]),_:1})]),_:1}),e(ee,{elevation:"2"},{default:t(()=>[e(Pe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e(k,{icon:"mdi-format-list-bulleted",class:"me-2"}),c(" Daftar Item Komposisi ("+r(G.value.length)+") ",1)]),_:1}),e(ae,{class:"pa-0"},{default:t(()=>[G.value.length===0?(m(),Z("div",Xa,[e(k,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),n[21]||(n[21]=o("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),n[22]||(n[22]=o("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(m(),F(ft,{key:1},{default:t(()=>[(m(!0),Z(Ue,null,Ye(G.value,(d,H)=>(m(),F(Qe,{key:d.id||H,class:"border-b"},{prepend:t(()=>[e($e,{size:"40",class:"me-3"},{default:t(()=>{var X,C;return[e(k,{icon:(X=d.item)!=null&&X.inventory&&d.item.inventory.current_stock>=d.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(C=d.item)!=null&&C.inventory&&d.item.inventory.current_stock>=d.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[o("div",el,[e(R,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:X=>Te(d,H)},null,8,["onClick"]),e(R,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:X=>Me(H)},null,8,["onClick"])])]),default:t(()=>[e(rt,{class:"font-weight-medium"},{default:t(()=>{var X;return[c(r(((X=d.item)==null?void 0:X.name)||"Item tidak ditemukan")+" ",1),d.is_critical?(m(),F(se,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>n[23]||(n[23]=[c(" Kritis ")])),_:1,__:[23]})):W("",!0)]}),_:2},1024),e(dt,null,{default:t(()=>{var X;return[o("div",Za,[o("span",null,"Dibutuhkan: "+r(parseFloat(d.quantity_needed.toString()))+" "+r(d.unit),1),(X=d.item)!=null&&X.inventory?(m(),Z("span",{key:0,class:lt(d.item.inventory.current_stock>=d.quantity_needed?"text-success":"text-error")}," Stok: "+r(d.item.inventory.current_stock)+" "+r(d.unit),3)):W("",!0),d.formatted_total_cost?(m(),Z("span",Ya,r(d.formatted_total_cost),1)):W("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(je,{class:"pa-6 pt-0"},{default:t(()=>[e(R,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:l},{default:t(()=>n[24]||(n[24]=[c(" Setting HPP ")])),_:1,__:[24]}),e(Ge),e(R,{variant:"outlined",onClick:Xe},{default:t(()=>n[25]||(n[25]=[c(" Batal ")])),_:1,__:[25]}),e(R,{color:"primary",onClick:ot,loading:g.value},{default:t(()=>n[26]||(n[26]=[c(" Simpan Komposisi ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1}),e(ct,{modelValue:U.value,"onUpdate:modelValue":n[5]||(n[5]=d=>U.value=d),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:n[4]||(n[4]=d=>U.value=!1)},{default:t(()=>n[27]||(n[27]=[c(" Tutup ")])),_:1,__:[27]})]),default:t(()=>[c(r(v.value)+" ",1)]),_:1},8,["modelValue"]),e(ct,{modelValue:h.value,"onUpdate:modelValue":n[7]||(n[7]=d=>h.value=d),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:n[6]||(n[6]=d=>h.value=!1)},{default:t(()=>n[28]||(n[28]=[c(" Tutup ")])),_:1,__:[28]})]),default:t(()=>[c(r(j.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(Ft,{modelValue:de.value,"onUpdate:modelValue":n[9]||(n[9]=d=>de.value=d),"product-id":parseInt(String(((i=V.product)==null?void 0:i.id_product)||((b=V.product)==null?void 0:b.id)||"0")),"product-name":((M=V.product)==null?void 0:M.product_name)||((K=V.product)==null?void 0:K.name),onHppUpdated:u,onPriceUpdated:n[10]||(n[10]=d=>z("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),Mt=Je(tl,[["__scopeId","data-v-dd1919ac"]]),al={class:"product-selection"},ll={key:0,class:"text-center pa-4"},ol={key:1,class:"product-list",style:{"max-height":"400px","overflow-y":"auto"}},il={class:"d-flex flex-column align-end"},sl={key:0,class:"text-body-2 text-primary font-weight-medium"},nl={key:2,class:"text-center pa-8"},rl={class:"text-h6 mt-2 text-medium-emphasis"},ul={class:"text-body-2 text-medium-emphasis"},dl=Ne({__name:"ProductSelectionList",emits:["select"],setup($,{emit:be}){const N=be,z=D([]),J=D(!1),g=D(""),G=async()=>{try{J.value=!0;const h=await na.getAll({per_page:100,search:g.value,active:!0});h.success&&(z.value=h.data||[])}catch(h){console.error("Error fetching products:",h)}finally{J.value=!1}},U=h=>{N("select",h)};return ut(()=>{G()}),(h,v)=>(m(),Z("div",al,[e(we,{modelValue:g.value,"onUpdate:modelValue":[v[0]||(v[0]=j=>g.value=j),G],label:"Cari produk...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",class:"mb-3"},null,8,["modelValue"]),J.value?(m(),Z("div",ll,[e(pt,{indeterminate:"",color:"primary"}),v[1]||(v[1]=o("div",{class:"mt-2"},"Memuat produk...",-1))])):z.value.length>0?(m(),Z("div",ol,[e(ft,{density:"compact"},{default:t(()=>[(m(!0),Z(Ue,null,Ye(z.value,j=>(m(),F(Qe,{key:j.id_product||j.id,class:"product-item",onClick:p=>U(j),style:{cursor:"pointer"},ripple:!0},{prepend:t(()=>[j.image_url?(m(),F($e,{key:0,image:j.image_url,size:"32",class:"me-3"},null,8,["image"])):(m(),F(k,{key:1,icon:"mdi-package-variant",size:"32",color:"grey-lighten-1",class:"me-3"}))]),append:t(()=>[o("div",il,[j.price?(m(),Z("div",sl,r(j.formatted_price||B(Ke)(j.price)),1)):W("",!0),e(k,{icon:"mdi-chevron-right",size:"16",color:"grey-lighten-1"})])]),default:t(()=>[e(rt,{class:"text-body-2"},{default:t(()=>[c(r(j.name),1)]),_:2},1024),j.sku?(m(),F(dt,{key:0,class:"text-caption"},{default:t(()=>[c(" SKU: "+r(j.sku),1)]),_:2},1024)):W("",!0)]),_:2},1032,["onClick"]))),128))]),_:1})])):(m(),Z("div",nl,[e(k,{icon:"mdi-package-variant-closed",size:"64",color:"grey-lighten-2"}),o("div",rl,r(g.value?"Tidak ada produk ditemukan":"Belum ada produk"),1),o("div",ul,r(g.value?"Coba ubah kata kunci pencarian":"Tambah produk terlebih dahulu"),1)]))]))}}),cl=Je(dl,[["__scopeId","data-v-1280b878"]]),ml={class:"composition-cards"},vl={class:"d-flex gap-2"},pl={key:1,class:"text-center pa-12"},fl={key:2,class:"text-center pa-12"},gl={class:"d-flex align-center gap-3"},_l={class:"flex-grow-1 min-width-0"},kl={class:"text-h6 font-weight-bold text-truncate"},yl={class:"text-caption text-medium-emphasis mb-0"},bl={class:"d-flex align-center gap-2 mb-3"},hl={class:"text-body-2 font-weight-medium"},xl={class:"composition-items"},wl={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},Pl={class:"text-body-2 text-truncate"},Vl={class:"text-end flex-shrink-0"},Cl={class:"text-body-2 font-weight-medium"},Sl={key:0,class:"text-caption text-success"},Il={key:1,class:"text-caption text-primary"},$l={class:"d-flex justify-between align-center mb-3"},Dl={class:"text-h6 font-weight-bold text-primary"},zl={class:"d-flex gap-2"},Tl={key:4,class:"d-flex justify-center mt-6"},Ul={key:5,class:"text-center mt-4"},Al={class:"d-flex align-center"},Hl={class:"d-flex align-center gap-4"},Ml={class:"flex-grow-1"},Kl={class:"text-h5 font-weight-bold mb-2"},Bl={class:"d-flex align-center gap-4 mb-2"},El={class:"text-body-2"},Fl={class:"d-flex align-center gap-4"},Rl={class:"text-h6 text-primary font-weight-bold"},Ll={class:"text-body-2 text-info font-weight-medium"},Nl={key:0,class:"text-body-2 text-success font-weight-medium"},ql={class:"d-flex align-center mt-1 gap-4"},Ol={class:"d-flex align-center"},jl={class:"d-flex align-center"},Jl={key:0,class:"d-flex align-center"},Wl={class:"text-primary font-weight-medium"},Gl={key:1,class:"text-center py-8"},Ql={class:"text-h6 font-weight-bold"},Xl={class:"text-h6 font-weight-bold"},Zl={class:"text-h6 font-weight-bold"},Yl={class:"text-h6 font-weight-bold"},eo={class:"text-h6 font-weight-bold"},to=Ne({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup($,{emit:be}){const N=$,z=be,J=D(!1),g=D(!1),G=D(!1),U=D(null),h=D([]),v=D(null),j=D(1),p=D(12),A=D({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),de=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],ke=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],S=s=>{U.value=s,h.value=s.items||[],J.value=!0},ne=()=>{G.value=!0},re=s=>{U.value=s,h.value=[],G.value=!1,J.value=!0},Q=()=>{z("refresh"),y()},ve=s=>{v.value=s,g.value=!0},T=()=>{A.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},_=me(()=>!!(A.value.search||A.value.stockStatus||A.value.itemType||A.value.criticalOnly||A.value.sortBy!=="name_asc")),f=me(()=>{let s=0;return A.value.search&&s++,A.value.stockStatus&&s++,A.value.itemType&&s++,A.value.criticalOnly&&s++,A.value.sortBy!=="name_asc"&&s++,s}),w=me(()=>{const s=new Map;N.productItems.forEach(l=>{if(!l.product)return;const u=l.product.id_product||l.product.id;s.has(u)||s.set(u,{...l.product,items:[],totalItems:0}),s.get(u).items.push(l),s.get(u).totalItems++});let a=Array.from(s.values());if(A.value.search){const l=A.value.search.toLowerCase();a=a.filter(u=>u.name.toLowerCase().includes(l)||u.sku&&u.sku.toLowerCase().includes(l)||u.items.some(te=>{var L;return(L=te.item)==null?void 0:L.name.toLowerCase().includes(l)}))}return A.value.stockStatus&&(a=a.filter(l=>{const u=fe(l);switch(A.value.stockStatus){case"safe":return u.color==="success";case"critical":return u.color==="warning";case"out":return u.color==="error";default:return!0}})),A.value.criticalOnly&&(a=a.filter(l=>l.items.some(u=>u.is_critical))),a.sort((l,u)=>{switch(A.value.sortBy){case"name_asc":return l.name.localeCompare(u.name);case"name_desc":return u.name.localeCompare(l.name);case"price_asc":return(l.price||0)-(u.price||0);case"price_desc":return(u.price||0)-(l.price||0);case"items_asc":return l.totalItems-u.totalItems;case"items_desc":return u.totalItems-l.totalItems;default:return l.name.localeCompare(u.name)}}),a}),_e=me(()=>Math.ceil(w.value.length/p.value)),pe=me(()=>{const s=(j.value-1)*p.value,a=s+p.value;return w.value.slice(s,a)}),fe=s=>{let a=!1,l=!1;return s.items.forEach(u=>{var te;if((te=u.item)!=null&&te.inventory){const L=u.item.inventory.current_stock||0,ce=u.quantity_needed||0;L<=0?a=!0:(L<ce||u.is_critical)&&(l=!0)}}),a?{text:"Stok Habis",color:"error"}:l?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},P=s=>{if(!(s!=null&&s.inventory))return"grey";const a=s.inventory.current_stock||0;return a<=0?"error":a<=10?"warning":"success"},q=s=>{if(!(s!=null&&s.inventory))return"Tidak ada data";const a=s.inventory.current_stock||0;return a<=0?"Habis":a<=10?"Rendah":"Aman"},x=s=>{const a=P(s);return{"text-error":a==="error","text-warning":a==="warning","text-success":a==="success","text-grey":a==="grey"}},O=s=>`Item Komposisi (${s})`,E=s=>{j.value=s},y=()=>{j.value=1};return Ce(()=>[A.value.search,A.value.stockStatus,A.value.criticalOnly,A.value.sortBy],()=>{y()}),(s,a)=>(m(),Z("div",ml,[e(ee,{class:"mb-6"},{default:t(()=>[e(Pe,{class:"d-flex align-center justify-between"},{default:t(()=>[a[16]||(a[16]=o("div",null,[o("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),o("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),o("div",vl,[e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:ne},{default:t(()=>a[14]||(a[14]=[c(" Tambah Komposisi ")])),_:1,__:[14]}),e(R,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:a[0]||(a[0]=l=>z("refresh")),loading:s.loading},{default:t(()=>a[15]||(a[15]=[c(" Refresh ")])),_:1,__:[15]},8,["loading"])])]),_:1,__:[16]})]),_:1}),e(ee,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ae,null,{default:t(()=>[e(De,null,{default:t(()=>[e(I,{cols:"12",md:"3"},{default:t(()=>[e(we,{modelValue:A.value.search,"onUpdate:modelValue":a[1]||(a[1]=l=>A.value.search=l),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Re,{modelValue:A.value.stockStatus,"onUpdate:modelValue":a[2]||(a[2]=l=>A.value.stockStatus=l),items:de,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Re,{modelValue:A.value.sortBy,"onUpdate:modelValue":a[3]||(a[3]=l=>A.value.sortBy=l),items:ke,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(ca,{modelValue:A.value.criticalOnly,"onUpdate:modelValue":a[4]||(a[4]=l=>A.value.criticalOnly=l),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(De,{class:"mt-3"},{default:t(()=>[e(I,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(R,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:T,disabled:!_.value},{default:t(()=>a[17]||(a[17]=[c(" Reset Filter ")])),_:1,__:[17]},8,["disabled"]),_.value?(m(),F(se,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[c(r(f.value)+" filter aktif ",1)]),_:1})):W("",!0)]),_:1}),e(I,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(se,{color:w.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[c(r(w.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!s.loading&&w.value.length===0&&_.value?(m(),F(Fe,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):W("",!0),s.loading?(m(),Z("div",pl,[e(pt,{color:"primary",indeterminate:"",size:"64"}),a[18]||(a[18]=o("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):w.value.length===0?(m(),Z("div",fl,[e(k,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),a[20]||(a[20]=o("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),a[21]||(a[21]=o("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(R,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:ne},{default:t(()=>a[19]||(a[19]=[c(" Buat Komposisi Pertama ")])),_:1,__:[19]})])):(m(),F(De,{key:3},{default:t(()=>[(m(!0),Z(Ue,null,Ye(pe.value,l=>(m(),F(I,{key:l.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ee,{class:lt(["composition-card h-100",{"border-error":fe(l).color==="error"}]),elevation:"2"},{default:t(()=>[e(Pe,{class:"pa-4 pb-2"},{default:t(()=>[o("div",gl,[e($e,{image:l.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[l.image_url?W("",!0):(m(),F(k,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),o("div",_l,[o("h3",kl,r(l.name),1),o("p",yl,r(l.sku||"SKU-"+l.id_product),1)])])]),_:2},1024),e(ae,{class:"py-2"},{default:t(()=>[e(se,{color:fe(l).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[c(r(fe(l).text),1)]),_:2},1032,["color"]),o("div",bl,[e(k,{icon:"mdi-format-list-bulleted",size:"16"}),o("span",hl,r(O(l.totalItems)),1)]),o("div",xl,[(m(!0),Z(Ue,null,Ye(l.items,u=>{var te,L,ce,Te;return m(),Z("div",{key:u.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[o("div",wl,[e(k,{icon:(te=u.item)!=null&&te.inventory&&u.item.inventory.current_stock>=u.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(L=u.item)!=null&&L.inventory&&u.item.inventory.current_stock>=u.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),o("span",Pl,r(((ce=u.item)==null?void 0:ce.name)||"Item tidak ditemukan"),1),u.is_critical?(m(),F(se,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>a[22]||(a[22]=[c(" Kritis ")])),_:1,__:[22]})):W("",!0)]),o("div",Vl,[o("div",Cl,r(parseFloat(u.quantity_needed))+" "+r(u.unit),1),(Te=u.item)!=null&&Te.inventory?(m(),Z("div",Sl," Stok: "+r(u.item.inventory.current_stock)+" "+r(u.unit),1)):W("",!0),u.formatted_total_cost?(m(),Z("div",Il,r(u.formatted_total_cost),1)):W("",!0)])])}),128))])]),_:2},1024),e(ae,{class:"pt-0"},{default:t(()=>[e(He,{class:"mb-3"}),o("div",$l,[a[23]||(a[23]=o("span",{class:"text-body-2"},"Harga:",-1)),o("span",Dl,r(B(Ke)(l.price||0)),1)]),o("div",zl,[e(R,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:u=>ve(l)},{default:t(()=>a[24]||(a[24]=[c(" Detail ")])),_:2,__:[24]},1032,["onClick"]),e(R,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:u=>S(l)},{default:t(()=>a[25]||(a[25]=[c(" Kelola ")])),_:2,__:[25]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),w.value.length>p.value?(m(),Z("div",Tl,[e(ma,{modelValue:j.value,"onUpdate:modelValue":[a[5]||(a[5]=l=>j.value=l),E],length:_e.value,"total-visible":s.$vuetify.display.smAndDown?5:7,size:"small"},null,8,["modelValue","length","total-visible"])])):W("",!0),w.value.length>0?(m(),Z("div",Ul,[e(se,{variant:"tonal",color:"primary",size:"small"},{default:t(()=>[c(" Menampilkan "+r((j.value-1)*p.value+1)+"-"+r(Math.min(j.value*p.value,w.value.length))+" dari "+r(w.value.length)+" produk ",1)]),_:1})])):W("",!0),e(Mt,{modelValue:J.value,"onUpdate:modelValue":a[6]||(a[6]=l=>J.value=l),product:U.value,items:h.value,onSave:Q,onRefresh:a[7]||(a[7]=l=>z("refresh"))},null,8,["modelValue","product","items"]),e(Oe,{modelValue:g.value,"onUpdate:modelValue":a[11]||(a[11]=l=>g.value=l),"max-width":"900",scrollable:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",Al,[e(k,{icon:"mdi-eye",class:"mr-2",color:"primary"}),a[26]||(a[26]=o("span",null,"Detail Komposisi Produk",-1))]),e(R,{icon:"",variant:"text",onClick:a[8]||(a[8]=l=>g.value=!1)},{default:t(()=>[e(k,{icon:"mdi-close"})]),_:1})]),_:1}),e(He),v.value?(m(),F(ae,{key:0},{default:t(()=>[e(pa,null,{default:t(()=>[e(De,null,{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[e(ee,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(ae,null,{default:t(()=>[o("div",Hl,[e($e,{image:v.value.image_url,size:"80"},{default:t(()=>[v.value.image_url?W("",!0):(m(),F(k,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),o("div",Ml,[o("h2",Kl,r(v.value.name),1),o("div",Bl,[e(se,{color:fe(v.value).color,variant:"tonal",size:"small"},{default:t(()=>[c(r(fe(v.value).text),1)]),_:1},8,["color"]),o("span",El,"SKU: "+r(v.value.sku||"-"),1)]),o("div",Fl,[o("div",Rl,r(B(Ke)(v.value.price||0)),1),o("div",Ll," HPP: "+r(B(Ke)(v.value.hpp||v.value.cost||0)),1),v.value.price&&(v.value.hpp||v.value.cost)?(m(),Z("div",Nl," Margin: "+r(B(Ke)((v.value.price||0)-(v.value.hpp||v.value.cost||0))),1)):W("",!0)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e(De,null,{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[e(ee,{variant:"outlined"},{default:t(()=>[e(Pe,{class:"text-h6"},{default:t(()=>[e(k,{icon:"mdi-format-list-bulleted",class:"mr-2"}),c(" Komposisi Item ("+r(v.value.totalItems||0)+") ",1)]),_:1}),e(ae,null,{default:t(()=>[v.value.items&&v.value.items.length>0?(m(),F(ft,{key:0},{default:t(()=>[(m(!0),Z(Ue,null,Ye(v.value.items,(l,u)=>(m(),F(Qe,{key:l.id_product_item,class:"px-0"},{prepend:t(()=>[e($e,{size:"40",color:P(l.item),variant:"tonal"},{default:t(()=>{var te;return[e(k,{icon:(te=l.item)!=null&&te.inventory&&l.item.inventory.current_stock>=l.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(se,{color:P(l.item),variant:"tonal",size:"small"},{default:t(()=>[c(r(q(l.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(rt,{class:"font-weight-medium"},{default:t(()=>{var te;return[c(r(((te=l.item)==null?void 0:te.name)||"Unknown Item")+" ",1),l.is_critical?(m(),F(se,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>a[27]||(a[27]=[c(" Kritis ")])),_:1,__:[27]})):W("",!0)]}),_:2},1024),e(dt,null,{default:t(()=>{var te,L;return[o("div",ql,[o("div",Ol,[e(k,{icon:"mdi-scale",size:"14",class:"mr-1"}),o("span",null," Kebutuhan: "+r(Number(l.quantity_needed||0).toLocaleString("id-ID"))+" "+r(l.unit),1)]),o("div",jl,[e(k,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),o("span",{class:lt(x(l.item))}," Stok: "+r(Number(((L=(te=l.item)==null?void 0:te.inventory)==null?void 0:L.current_stock)||0).toLocaleString("id-ID"))+" "+r(l.unit),3)]),l.formatted_total_cost?(m(),Z("div",Jl,[e(k,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),o("span",Wl,r(l.formatted_total_cost),1)])):W("",!0)])]}),_:2},1024),u<v.value.items.length-1?(m(),F(He,{key:0,class:"mt-3"})):W("",!0)]),_:2},1024))),128))]),_:1})):(m(),Z("div",Gl,[e(k,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),a[28]||(a[28]=o("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(De,{class:"mt-4"},{default:t(()=>[e(I,{cols:"12",md:"2"},{default:t(()=>[e(ee,{variant:"outlined",color:"primary"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(k,{icon:"mdi-format-list-bulleted",size:"24",class:"mb-2"}),o("div",Ql,r(v.value.totalItems||0),1),a[29]||(a[29]=o("div",{class:"text-caption"},"Total Item",-1))]),_:1,__:[29]})]),_:1})]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(ee,{variant:"outlined",color:"warning"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>{var l;return[e(k,{icon:"mdi-alert",size:"24",class:"mb-2"}),o("div",Xl,r(((l=v.value.items)==null?void 0:l.filter(u=>u.is_critical).length)||0),1),a[30]||(a[30]=o("div",{class:"text-caption"},"Item Kritis",-1))]}),_:1,__:[30]})]),_:1})]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"info"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(k,{icon:"mdi-calculator",size:"24",class:"mb-2"}),o("div",Zl,r(B(Ke)(v.value.hpp||v.value.cost||0)),1),a[31]||(a[31]=o("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[31]})]),_:1})]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"success"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(k,{icon:"mdi-currency-usd",size:"24",class:"mb-2"}),o("div",Yl,r(B(Ke)(v.value.price||0)),1),a[32]||(a[32]=o("div",{class:"text-caption"},"Harga Jual",-1))]),_:1,__:[32]})]),_:1})]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(ee,{variant:"outlined",color:"purple"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(k,{icon:"mdi-trending-up",size:"24",class:"mb-2"}),o("div",eo,r(B(Ke)((v.value.price||0)-(v.value.hpp||v.value.cost||0))),1),a[33]||(a[33]=o("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[33]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):W("",!0),e(He),e(je,{class:"pa-4"},{default:t(()=>[e(Ge),e(R,{variant:"outlined",onClick:a[9]||(a[9]=l=>g.value=!1)},{default:t(()=>a[34]||(a[34]=[c(" Tutup ")])),_:1,__:[34]}),e(R,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:a[10]||(a[10]=()=>{g.value=!1,S(v.value)})},{default:t(()=>a[35]||(a[35]=[c(" Kelola Komposisi ")])),_:1,__:[35]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Oe,{modelValue:G.value,"onUpdate:modelValue":a[13]||(a[13]=l=>G.value=l),"max-width":"600px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-between pa-4"},{default:t(()=>[a[36]||(a[36]=o("span",{class:"text-h6"},"Pilih Produk untuk Komposisi",-1)),e(R,{variant:"text",icon:"mdi-close",size:"small",onClick:a[12]||(a[12]=l=>G.value=!1)})]),_:1,__:[36]}),e(ae,{class:"pa-4"},{default:t(()=>[e(cl,{onSelect:re})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),ao=Je(to,[["__scopeId","data-v-e2cb9847"]]),lo={class:"d-flex align-center gap-2"},oo={class:"text-white"},io={class:"text-h6 mb-4 d-flex align-center gap-2"},so={class:"text-h6 mb-4 d-flex align-center gap-2"},no={class:"d-flex flex-column gap-2"},ro={key:0,class:"d-flex align-center gap-2"},uo={class:"d-flex align-center gap-2 mb-2"},co={class:"d-flex gap-2"},mo={class:"d-flex gap-2"},vo={class:"d-flex align-center justify-space-between"},po={class:"d-flex align-center gap-2"},fo={class:"text-end"},go={class:"text-h6 font-weight-bold"},_o={class:"text-caption"},ko={class:"text-h6 mb-4 d-flex align-center gap-2"},yo={class:"text-h6 mb-4 d-flex align-center gap-2"},bo={class:"image-upload-container"},ho={key:0,class:"mb-4"},xo={class:"text-center mt-2"},wo={class:"text-h6 mb-4 d-flex align-center gap-2"},Po={class:"text-h6 mb-4 d-flex align-center gap-2"},Vo={class:"text-h6 mb-4 d-flex align-center gap-2"},Co={class:"d-flex align-center"},So={class:"text-subtitle-1"},Io={class:"text-body-1"},$o={class:"d-flex align-center"},Do={class:"text-subtitle-1"},zo=Ne({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup($,{emit:be}){var E,y,s;const N=At(),{nameRules:z,categoryRules:J}=Ht(),{getProductHPPBreakdown:g}=wt(),G=D(!1),U=D(!1),h=async()=>{if(!(!p.editMode||!S.id))try{const a=await fetch(`/api/products/${S.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(a.ok){const l=await a.json();U.value=l.success&&l.data&&l.data.length>0}}catch(a){console.error("Error checking HPP status:",a)}},v=async()=>{if(S.id)try{G.value=!0;const a=await g(S.id,"latest");a&&(S.cost=a.total_hpp,de("update-form","cost",a.total_hpp))}catch(a){console.error("Error refreshing HPP:",a)}finally{G.value=!1}},j=()=>{},p=$,A=me(()=>p.errorMessage),de=be,ke=D(),S=xt({...p.formData,available_in_kitchen:!!p.formData.available_in_kitchen,available_in_bar:!!p.formData.available_in_bar});Ce(()=>p.formData,a=>{const l={...a,available_in_kitchen:!!a.available_in_kitchen,available_in_bar:!!a.available_in_bar};Object.assign(S,l)},{deep:!0}),Ce(S,a=>{Object.keys(a).forEach(l=>{de("update-form",l,a[l])})},{deep:!0}),Ce(()=>p.modelValue,a=>{a&&p.editMode&&h()});const ne=xt({length:((E=p.formData.dimensions)==null?void 0:E.length)||null,width:((y=p.formData.dimensions)==null?void 0:y.width)||null,height:((s=p.formData.dimensions)==null?void 0:s.height)||null});Ce(ne,a=>{const l=a.length!==null||a.width!==null||a.height!==null;S.dimensions=l?{length:a.length!==null?a.length:void 0,width:a.width!==null?a.width:void 0,height:a.height!==null?a.height:void 0}:{}},{deep:!0});const re=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],Q=me(()=>{if(!S.price||!S.cost||S.cost<=0)return 0;const a=(S.price-S.cost)/S.cost*100;return Math.ceil(a)}),ve=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),T=a=>a<10?"error":a<25?"warning":a<50?"success":"info",_=a=>a<10?"tabler-trending-down":a<25?"tabler-trending-up":a<50?"tabler-trending-up-2":"tabler-trending-up-3",f=a=>!a||a===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),w=a=>{if(!a||a.trim()===""||a==="Rp 0")return 0;const u=a.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(u)||0},_e=D(!1),pe=a=>{const l=w(a);S.price=l},fe=()=>{_e.value=!0},P=()=>{_e.value=!1},q=async()=>{var l;const{valid:a}=await((l=ke.value)==null?void 0:l.validate());a&&de("submit",S)},x=a=>{de("image-change",a)},O=()=>{de("remove-image")};return(a,l)=>(m(),F(Oe,{"model-value":a.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":l[27]||(l[27]=u=>a.$emit("update:modelValue",u))},{default:t(()=>[e(ee,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[o("div",lo,[e(k,{icon:a.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),o("span",oo,r(a.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(R,{icon:"tabler-x",variant:"text",color:"white",onClick:l[0]||(l[0]=u=>a.$emit("close"))})]),_:1}),e(He),e(ae,{class:"pa-6"},{default:t(()=>[e(Ct,{ref_key:"formRef",ref:ke,onSubmit:Pt(q,["prevent"])},{default:t(()=>[e(De,null,{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[o("h6",io,[e(k,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),l[28]||(l[28]=c(" Informasi Dasar "))])]),_:1}),e(I,{cols:"12",md:"8"},{default:t(()=>[e(we,{modelValue:S.name,"onUpdate:modelValue":l[1]||(l[1]=u=>S.name=u),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:B(z),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(we,{modelValue:S.sku,"onUpdate:modelValue":l[2]||(l[2]=u=>S.sku=u),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(zt,{modelValue:S.description,"onUpdate:modelValue":l[3]||(l[3]=u=>S.description=u),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[e(Re,{"model-value":S.category_id,"onUpdate:modelValue":l[4]||(l[4]=u=>S.category_id=u),items:a.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:B(J),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[e(we,{modelValue:S.brand,"onUpdate:modelValue":l[5]||(l[5]=u=>S.brand=u),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[o("h6",so,[e(k,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),l[29]||(l[29]=c(" Harga & Biaya "))])]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[e(we,{"model-value":f(S.price),"onUpdate:modelValue":l[6]||(l[6]=u=>pe(u)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:fe,onBlur:P},null,8,["model-value"])]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[o("div",no,[e(we,{"model-value":f(S.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),a.editMode?(m(),Z("div",ro,[e(se,{color:U.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e(k,{icon:U.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),c(" "+r(U.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),U.value?(m(),F(R,{key:0,size:"small",variant:"outlined",color:"primary",onClick:v,loading:G.value},{default:t(()=>[e(k,{icon:"tabler-refresh",size:"14",class:"me-1"}),l[30]||(l[30]=c(" Update HPP "))]),_:1,__:[30]},8,["loading"])):(m(),F(Be,{key:1},{activator:t(({props:u})=>[e(se,xe(u,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e(k,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),l[31]||(l[31]=c(" Belum Ada Resep "))]),_:2,__:[31]},1040)]),default:t(()=>[l[32]||(l[32]=o("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[32]}))])):W("",!0)])]),_:1}),a.editMode?(m(),F(I,{key:0,cols:"12"},{default:t(()=>[U.value?(m(),F(Fe,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(_t,null,{default:t(()=>[e(k,{icon:"tabler-info-circle",class:"me-2"}),l[33]||(l[33]=c(" HPP Otomatis Aktif "))]),_:1,__:[33]}),l[34]||(l[34]=o("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[34]})):(m(),F(Fe,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(_t,null,{default:t(()=>[e(k,{icon:"tabler-alert-triangle",class:"me-2"}),l[35]||(l[35]=c(" HPP Manual "))]),_:1,__:[35]}),l[36]||(l[36]=o("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[36]}))]),_:1})):W("",!0),e(I,{cols:"12"},{default:t(()=>[U.value&&a.editMode?(m(),F(Fe,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[o("div",uo,[e(k,{icon:"tabler-check-circle"}),l[37]||(l[37]=o("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),l[40]||(l[40]=o("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),o("div",co,[e(R,{size:"small",color:"primary",variant:"outlined",onClick:j},{default:t(()=>[e(k,{icon:"tabler-edit",size:"14",class:"me-1"}),l[38]||(l[38]=c(" Edit Resep "))]),_:1,__:[38]}),e(R,{size:"small",variant:"outlined",color:"info",onClick:v,loading:G.value},{default:t(()=>[e(k,{icon:"tabler-refresh",size:"14",class:"me-1"}),l[39]||(l[39]=c(" Refresh HPP "))]),_:1,__:[39]},8,["loading"])])]),_:1,__:[40]})):!U.value&&a.editMode?(m(),F(Fe,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[o("div",mo,[e(R,{size:"small",variant:"outlined",color:"info",onClick:l[7]||(l[7]=u=>B(N).push("/hpp-management"))},{default:t(()=>[e(k,{icon:"tabler-calculator",size:"14",class:"me-1"}),l[41]||(l[41]=c(" Lihat HPP Management "))]),_:1,__:[41]})])]),_:1})):W("",!0)]),_:1}),e(I,{cols:"12"},{default:t(()=>[S.price&&S.cost&&S.cost>0?(m(),F(Fe,{key:0,color:T(Q.value),variant:"tonal",class:"mb-0"},{default:t(()=>[o("div",vo,[o("div",po,[e(k,{icon:_(Q.value)},null,8,["icon"]),l[42]||(l[42]=o("span",{class:"font-weight-medium"},"Profit Margin",-1))]),o("div",fo,[o("div",go,r(Math.round(Q.value))+"%",1),o("div",_o," Keuntungan: "+r(ve(S.price-S.cost)),1)])])]),_:1},8,["color"])):W("",!0)]),_:1}),e(I,{cols:"12"},{default:t(()=>[o("h6",ko,[e(k,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),l[43]||(l[43]=c(" Dimensi (cm) "))])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(we,{modelValue:ne.length,"onUpdate:modelValue":l[8]||(l[8]=u=>ne.length=u),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(we,{modelValue:ne.width,"onUpdate:modelValue":l[9]||(l[9]=u=>ne.width=u),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(we,{modelValue:ne.height,"onUpdate:modelValue":l[10]||(l[10]=u=>ne.height=u),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[o("h6",yo,[e(k,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),l[44]||(l[44]=c(" Gambar Produk "))])]),_:1}),e(I,{cols:"12"},{default:t(()=>[o("div",bo,[a.imagePreview?(m(),Z("div",ho,[e(ka,{src:a.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),o("div",xo,[e(R,{size:"small",color:"error",variant:"outlined",onClick:O},{default:t(()=>l[45]||(l[45]=[c(" Hapus Gambar ")])),_:1,__:[45]})])])):W("",!0),e(ya,{"model-value":a.selectedImage,"onUpdate:modelValue":l[11]||(l[11]=u=>x(Array.isArray(u)?u:[u])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),l[46]||(l[46]=o("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e(I,{cols:"12"},{default:t(()=>[o("h6",wo,[e(k,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),l[47]||(l[47]=c(" Pengaturan "))])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(Re,{"model-value":S.status,"onUpdate:modelValue":l[12]||(l[12]=u=>S.status=u),items:re,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(nt,{"model-value":S.active,"onUpdate:modelValue":l[13]||(l[13]=u=>S.active=u??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(nt,{"model-value":S.featured,"onUpdate:modelValue":l[14]||(l[14]=u=>S.featured=u??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[o("h6",Po,[e(k,{icon:"tabler-tools-kitchen-2",size:"20",class:"coffee-icon"}),l[48]||(l[48]=c(" Ketersediaan Station "))])]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[e(nt,{"model-value":S.available_in_kitchen,"onUpdate:modelValue":l[15]||(l[15]=u=>S.available_in_kitchen=!!u),label:"Tersedia di Kitchen",color:"coffee",inset:""},{prepend:t(()=>[e(k,{icon:"tabler-chef-hat",class:"me-2",color:S.available_in_kitchen?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[e(nt,{"model-value":S.available_in_bar,"onUpdate:modelValue":l[16]||(l[16]=u=>S.available_in_bar=!!u),label:"Tersedia di Bar",color:"coffee",inset:""},{prepend:t(()=>[e(k,{icon:"tabler-glass-cocktail",class:"me-2",color:S.available_in_bar?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[o("h6",Vo,[e(k,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),l[49]||(l[49]=c(" SEO (Opsional) "))])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(we,{modelValue:S.meta_title,"onUpdate:modelValue":l[17]||(l[17]=u=>S.meta_title=u),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(zt,{modelValue:S.meta_description,"onUpdate:modelValue":l[18]||(l[18]=u=>S.meta_description=u),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(Ta,{"model-value":S.tags,"onUpdate:modelValue":l[19]||(l[19]=u=>S.tags=u),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(He),e(je,{class:"pa-6"},{default:t(()=>[e(Ge),e(R,{variant:"outlined",class:"coffee-secondary",onClick:l[20]||(l[20]=u=>a.$emit("close"))},{default:t(()=>l[50]||(l[50]=[c(" Batal ")])),_:1,__:[50]}),e(R,{color:"primary",class:"coffee-primary",loading:a.loading,onClick:q},{default:t(()=>[c(r(a.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),a.useDialogError?W("",!0):(m(),F(ct,{key:0,"model-value":!!A.value,"onUpdate:modelValue":l[22]||(l[22]=u=>!u&&a.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(R,{icon:"tabler-x",size:"small",variant:"text",onClick:l[21]||(l[21]=u=>a.$emit("clear-error"))})]),default:t(()=>[o("div",Co,[e(k,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),o("div",null,[l[51]||(l[51]=o("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),o("div",So,r(A.value),1)])])]),_:1},8,["model-value"])),a.useDialogError?(m(),F(Oe,{key:1,"model-value":!!A.value,"onUpdate:modelValue":l[24]||(l[24]=u=>!u&&a.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(ee,null,{default:t(()=>[e(Pe,{class:"d-flex align-center text-error"},{default:t(()=>[e(k,{icon:"tabler-alert-circle",class:"me-2"}),l[52]||(l[52]=c(" Error Occurred "))]),_:1,__:[52]}),e(He),e(ae,{class:"py-4"},{default:t(()=>[o("div",Io,r(A.value),1)]),_:1}),e(He),e(je,{class:"justify-end pa-4"},{default:t(()=>[e(R,{color:"error",variant:"outlined",onClick:l[23]||(l[23]=u=>a.$emit("clear-error"))},{default:t(()=>l[53]||(l[53]=[c(" Close ")])),_:1,__:[53]})]),_:1})]),_:1})]),_:1},8,["model-value"])):W("",!0),e(ct,{"model-value":!!a.successMessage,"onUpdate:modelValue":l[26]||(l[26]=u=>!u&&a.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(R,{icon:"tabler-x",size:"small",variant:"text",onClick:l[25]||(l[25]=u=>a.$emit("clear-success"))})]),default:t(()=>[o("div",$o,[e(k,{icon:"tabler-check-circle",class:"me-3",size:"28"}),o("div",null,[l[54]||(l[54]=o("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),o("div",Do,r(a.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),To=Je(zo,[["__scopeId","data-v-333cc50b"]]),Uo={key:0,class:"mt-4"},Ao={class:"d-flex align-center gap-2 mb-2"},Ho={class:"d-flex flex-wrap gap-2"},Mo=Ne({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup($,{emit:be}){const N=$,z=be,{categories:J,loading:g,fetchAllCategories:G}=ba(),U=D(!1),h=D("");ut(async()=>{await G(),h.value=v.search||""});const v=xt({...N.filters});Ce(()=>N.filters,_=>{Object.assign(v,_),h.value=_.search||""},{deep:!0}),ea(h,_=>{v.search=_,(_.length>=3||_.length===0)&&(U.value=!0,z("search",_),S(),setTimeout(()=>{U.value=!1},500))},{debounce:500,maxWait:1e3});const j=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],p=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],A=[{title:"Kitchen Only",value:"kitchen"},{title:"Bar Only",value:"bar"},{title:"Kitchen & Bar",value:"both"}],de=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],ke=me(()=>!!(h.value||v.category_id||v.active||v.stock_status||v.station||v.featured!==null||v.min_price||v.max_price)),S=()=>{z("update:filters",{...v})},ne=()=>{h.value="",v.search="",z("search",""),S()},re=()=>{h.value="",Object.assign(v,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),S()},Q=_=>{const f=J.value.find(w=>w.id_category===_);return(f==null?void 0:f.name)||"Unknown"},ve=_=>{if(!_)return"Semua";const f=j.find(w=>w.value===_);return(f==null?void 0:f.title)||String(_)},T=_=>{const f=p.find(w=>w.value===_);return(f==null?void 0:f.title)||_};return(_,f)=>(m(),F(ee,{class:"mb-6"},{default:t(()=>[e(Pe,{class:"d-flex align-center gap-2"},{default:t(()=>[e(k,{icon:"tabler-filter",class:"coffee-icon"}),f[11]||(f[11]=c(" Filter & Pencarian Produk "))]),_:1,__:[11]}),e(ae,null,{default:t(()=>[e(De,null,{default:t(()=>[e(I,{cols:"12",md:"4"},{default:t(()=>[e(we,{modelValue:h.value,"onUpdate:modelValue":f[0]||(f[0]=w=>h.value=w),label:"Cari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:U.value,clearable:"",variant:"outlined",hint:h.value.length>0&&h.value.length<3?`Ketik ${3-h.value.length} karakter lagi untuk mencari`:"","persistent-hint":"","onClick:clear":ne},null,8,["modelValue","loading","hint"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Re,{modelValue:v.category_id,"onUpdate:modelValue":[f[1]||(f[1]=w=>v.category_id=w),S],items:B(J),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:B(g),clearable:"",variant:"outlined"},{"no-data":t(()=>[e(Qe,null,{default:t(()=>[e(rt,null,{default:t(()=>[c(r(B(g)?"Memuat kategori...":"Tidak ada kategori"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(Re,{modelValue:v.active,"onUpdate:modelValue":[f[2]||(f[2]=w=>v.active=w),S],items:j,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(Re,{modelValue:v.stock_status,"onUpdate:modelValue":[f[3]||(f[3]=w=>v.stock_status=w),S],items:p,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(Re,{modelValue:v.station,"onUpdate:modelValue":[f[4]||(f[4]=w=>v.station=w),S],items:A,label:"Station",placeholder:"Semua station","prepend-inner-icon":"tabler-tools-kitchen-2",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(R,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:re})]),_:1})]),_:1}),e(De,{class:"mt-3"},{default:t(()=>[e(I,{cols:"12",md:"3"},{default:t(()=>[e(we,{modelValue:v.min_price,"onUpdate:modelValue":f[5]||(f[5]=w=>v.min_price=w),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:S},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(we,{modelValue:v.max_price,"onUpdate:modelValue":f[6]||(f[6]=w=>v.max_price=w),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:S},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(Re,{modelValue:v.sort_order,"onUpdate:modelValue":[f[7]||(f[7]=w=>v.sort_order=w),S],items:de,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),ke.value?(m(),Z("div",Uo,[o("div",Ao,[e(k,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),f[12]||(f[12]=o("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),o("div",Ho,[h.value?(m(),F(se,{key:0,closable:"",size:"small",color:"coffee","onClick:close":ne},{default:t(()=>[c(" Pencarian: "+r(h.value),1)]),_:1})):W("",!0),v.category_id?(m(),F(se,{key:1,closable:"",size:"small",color:"coffee","onClick:close":f[8]||(f[8]=w=>{v.category_id=null,S()})},{default:t(()=>[c(" Kategori: "+r(Q(v.category_id)),1)]),_:1})):W("",!0),v.active?(m(),F(se,{key:2,closable:"",size:"small",color:"coffee","onClick:close":f[9]||(f[9]=w=>{v.active=null,S()})},{default:t(()=>[c(" Status: "+r(ve(v.active)),1)]),_:1})):W("",!0),v.stock_status?(m(),F(se,{key:3,closable:"",size:"small",color:"coffee","onClick:close":f[10]||(f[10]=w=>{v.stock_status=null,S()})},{default:t(()=>[c(" Stok: "+r(T(v.stock_status)),1)]),_:1})):W("",!0)])])):W("",!0)]),_:1})]),_:1}))}}),Ko=Je(Mo,[["__scopeId","data-v-d0e7ae77"]]),Bo={class:"d-flex align-center gap-2"},Eo={class:"text-h6"},Fo={class:"d-flex align-center gap-2"},Ro={class:"text-h6"},Lo={class:"d-flex align-center gap-2"},No={class:"text-h6"},qo={class:"d-flex align-center gap-2"},Oo={class:"text-h6"},jo={class:"d-flex align-center gap-2"},Jo={class:"text-h6"},Wo={class:"d-flex align-center gap-2"},Go={class:"text-h6"},Qo={class:"d-flex align-center gap-2"},Xo={class:"text-h6"},Zo={class:"d-flex align-center gap-2"},Yo={class:"text-h6"},ei=Ne({__name:"ProductStatsCards",props:{stats:{}},setup($){const be=z=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(z),N=z=>`${z.toFixed(1)}%`;return(z,J)=>(m(),F(De,{class:"mb-6"},{default:t(()=>[e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-package"})]),_:1}),o("div",null,[J[0]||(J[0]=o("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),o("div",Bo,[o("h6",Eo,r(((g=z.stats)==null?void 0:g.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-check"})]),_:1}),o("div",null,[J[1]||(J[1]=o("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),o("div",Fo,[o("h6",Ro,r(((g=z.stats)==null?void 0:g.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-star"})]),_:1}),o("div",null,[J[2]||(J[2]=o("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),o("div",Lo,[o("h6",No,r(((g=z.stats)==null?void 0:g.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-alert-triangle"})]),_:1}),o("div",null,[J[3]||(J[3]=o("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),o("div",qo,[o("h6",Oo,r(((g=z.stats)==null?void 0:g.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-currency-dollar"})]),_:1}),o("div",null,[J[4]||(J[4]=o("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),o("div",jo,[o("h6",Jo,r(be(((g=z.stats)==null?void 0:g.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-chart-line"})]),_:1}),o("div",null,[J[5]||(J[5]=o("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),o("div",Wo,[o("h6",Go,r(be(((g=z.stats)==null?void 0:g.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-trending-up"})]),_:1}),o("div",null,[J[6]||(J[6]=o("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),o("div",Qo,[o("h6",Xo,r(N(((g=z.stats)==null?void 0:g.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-x-circle"})]),_:1}),o("div",null,[J[7]||(J[7]=o("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),o("div",Zo,[o("h6",Yo,r(((g=z.stats)==null?void 0:g.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),ti=Je(ei,[["__scopeId","data-v-124783ae"]]),ai={class:"d-flex align-center gap-2"},li={class:"d-flex align-center gap-2"},oi={class:"text-center py-8"},ii={class:"d-flex align-center gap-3 py-2"},si={class:"font-weight-medium"},ni={class:"text-caption text-medium-emphasis"},ri={class:"text-end"},ui={class:"font-weight-medium"},di={class:"text-caption text-medium-emphasis d-flex align-center justify-end gap-1"},ci={class:"text-center profit-margin-container"},mi={class:"text-center"},vi={key:0,class:"text-caption text-medium-emphasis mt-1"},pi={class:"d-flex align-center gap-2"},fi={class:"d-flex gap-2 align-center"},gi={class:"text-body-2"},_i={class:"text-caption text-medium-emphasis"},ki={class:"d-flex align-center gap-1"},yi=300*1e3,bi=1e3,hi=Ne({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","toggle-kitchen","toggle-bar","bulk-delete","update:options","update:selected-products"],setup($,{expose:be,emit:N}){const z=$,J=N,{currentHPPBreakdown:g,getProductHPPBreakdown:G}=wt(),U=D({}),h=D({}),v=D({}),j=D(new Set),p=D(new Set);let A=null;const de=P=>{const q=v.value[P];return q?Date.now()-q.timestamp<yi:!1},ke=async()=>{if(p.value.size===0)return;const P=Array.from(p.value);p.value.clear();const q=P.filter(O=>{const E=z.products.find(y=>(y.id_product||y.id)===O);return E&&(E.hpp===void 0||E.hpp===null)});if(q.length===0)return;const x=3;for(let O=0;O<q.length;O+=x){const y=q.slice(O,O+x).map(async s=>{var a;if(!(h.value[s]||de(s))){h.value[s]=!0,j.value.add(s);try{if(await G(s,"latest"),(a=g.value)!=null&&a.total_hpp){const l=g.value.total_hpp;U.value[s]=l,v.value[s]={data:l,timestamp:Date.now(),attempted:!0}}else v.value[s]={data:0,timestamp:Date.now(),attempted:!0}}catch(l){console.warn(`Could not load HPP for product ${s}:`,l),v.value[s]={data:0,timestamp:Date.now(),attempted:!0}}finally{h.value[s]=!1}}});await Promise.all(y),O+x<P.length&&await new Promise(s=>setTimeout(s,500))}},S=P=>{if(de(P)){U.value[P]=v.value[P].data;return}j.value.has(P)||(p.value.add(P),A&&clearTimeout(A),A=setTimeout(()=>{ke()},bi))},ne=()=>{for(const P of z.products){const q=P.id_product||P.id;q&&(de(q)?U.value[q]=v.value[q].data:!j.value.has(q)&&!h.value[q]&&S(q))}},re=P=>{const q=P.id_product||P.id;return U.value[q]||P.cost||0},Q=P=>{const q=re(P),x=P.price||0;return x<=0||q<=0?0:Math.round((x-q)/x*100)};ta(()=>{z.products&&z.products.length>0&&ne()}),ut(()=>{z.products&&z.products.length>0&&ne()}),be({refreshHPPData:async P=>{P?(delete v.value[P],delete U.value[P],j.value.delete(P),z.products.find(x=>(x.id_product||x.id)===P)&&S(P)):(v.value={},U.value={},j.value.clear(),p.value.clear(),ne())}});const T=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Station",key:"station_availability",sortable:!1,width:"150px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],_=P=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(P),f=P=>new Date(P).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),w=P=>new Date(P).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),_e=P=>P<10?"error":P<25?"warning":P<50?"success":"info",pe=P=>{J("toggle-kitchen",P)},fe=P=>{J("toggle-bar",P)};return(P,q)=>(m(),F(ee,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",ai,[e(k,{icon:"tabler-list",class:"coffee-icon"}),q[5]||(q[5]=c(" Data Produk ")),P.totalItems?(m(),F(se,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[c(r(P.totalItems)+" item ",1)]),_:1})):W("",!0)]),o("div",li,[P.selectedProducts.length>0?(m(),F(R,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:q[0]||(q[0]=x=>P.$emit("bulk-delete"))},{default:t(()=>[c(" Hapus Terpilih ("+r(P.selectedProducts.length)+") ",1)]),_:1})):W("",!0),e(R,{"prepend-icon":"tabler-plus",color:"coffee",onClick:q[1]||(q[1]=x=>P.$emit("add-product"))},{default:t(()=>q[6]||(q[6]=[c(" Tambah Produk ")])),_:1,__:[6]})])]),_:1}),e(He),e(Sa,{"model-value":P.selectedProducts,"onUpdate:modelValue":q[3]||(q[3]=x=>P.$emit("update:selected-products",x)),headers:T,items:P.products,"items-length":P.totalItems,loading:P.loading,"items-per-page":P.itemsPerPage,page:P.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:options":q[4]||(q[4]=x=>P.$emit("update:options",x))},{loading:t(()=>[e(Ia,{type:"table-row@10"})]),"no-data":t(()=>[o("div",oi,[e(k,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),q[8]||(q[8]=o("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),q[9]||(q[9]=o("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(R,{"prepend-icon":"tabler-plus",color:"coffee",onClick:q[2]||(q[2]=x=>P.$emit("add-product"))},{default:t(()=>q[7]||(q[7]=[c(" Tambah Produk Pertama ")])),_:1,__:[7]})])]),"item.name":t(({item:x})=>[o("div",ii,[e($e,{image:x.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[x.image_url?W("",!0):(m(),F(k,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),o("div",null,[o("div",si,r(x.name),1),o("div",ni," SKU: "+r(x.sku||"-"),1)])])]),"item.category":t(({item:x})=>[e(se,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var O;return[c(r(((O=x.category)==null?void 0:O.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:x})=>[o("div",ri,[o("div",ui,r(_(x.price)),1),o("div",di,[o("span",null,"HPP: "+r(_(re(x))),1),h.value[x.id_product||x.id]&&re(x)>0?(m(),F(pt,{key:0,indeterminate:"",size:"12",width:"2"})):W("",!0)])])]),"item.profit_margin":t(({item:x})=>[o("div",ci,[e(se,{color:_e(Q(x)),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[c(r(Q(x))+"% ",1)]),_:2},1032,["color"])])]),"item.stock":t(({item:x})=>[o("div",mi,[e(se,{color:x.stock_status==="out_of_stock"?"error":x.stock_status==="low_stock"?"warning":"success",size:"small",variant:"tonal"},{default:t(()=>[c(r(x.stock_status==="out_of_stock"?"Habis":x.stock_status==="low_stock"?"Rendah":"Aman"),1)]),_:2},1032,["color"]),x.min_stock?(m(),Z("div",vi," Min: "+r(x.min_stock),1)):W("",!0)])]),"item.active":t(({item:x})=>[o("div",pi,[e(se,{color:x.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[c(r(x.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),x.featured?(m(),F(Be,{key:0,text:"Produk Unggulan"},{activator:t(({props:O})=>[e(k,xe(O,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):W("",!0)])]),"item.station_availability":t(({item:x})=>[o("div",fi,[e(Be,{location:"top"},{activator:t(({props:O})=>{var E,y,s;return[e(se,xe(O,{color:x.available_in_kitchen?"success":"error",variant:"flat",size:"small",class:["station-chip cursor-pointer",{"station-chip-loading":(E=P.toggleLoading)==null?void 0:E[x.id_product]}],onClick:a=>pe(x),loading:((y=P.toggleLoading)==null?void 0:y[x.id_product])||!1,disabled:((s=P.toggleLoading)==null?void 0:s[x.id_product])||!1}),{prepend:t(()=>[e(k,{icon:x.available_in_kitchen?"tabler-check":"tabler-x",size:"14",color:"white"},null,8,["icon"])]),default:t(()=>[q[10]||(q[10]=o("span",{style:{color:"white !important","font-weight":"600 !important"}}," Kitchen ",-1))]),_:2,__:[10]},1040,["color","class","onClick","loading","disabled"])]}),default:t(()=>[o("span",null,r(x.available_in_kitchen?"Tersedia di Kitchen":"Tidak tersedia di Kitchen"),1)]),_:2},1024),e(Be,{location:"top"},{activator:t(({props:O})=>{var E,y,s;return[e(se,xe(O,{color:x.available_in_bar?"success":"error",variant:"flat",size:"small",class:["station-chip cursor-pointer",{"station-chip-loading":(E=P.toggleLoading)==null?void 0:E[x.id_product]}],onClick:a=>fe(x),loading:((y=P.toggleLoading)==null?void 0:y[x.id_product])||!1,disabled:((s=P.toggleLoading)==null?void 0:s[x.id_product])||!1}),{prepend:t(()=>[e(k,{icon:x.available_in_bar?"tabler-check":"tabler-x",size:"14",color:"white"},null,8,["icon"])]),default:t(()=>[q[11]||(q[11]=o("span",{style:{color:"white !important","font-weight":"600 !important"}}," Bar ",-1))]),_:2,__:[11]},1040,["color","class","onClick","loading","disabled"])]}),default:t(()=>[o("span",null,r(x.available_in_bar?"Tersedia di Bar":"Tidak tersedia di Bar"),1)]),_:2},1024)])]),"item.created_at":t(({item:x})=>[o("div",gi,r(f(x.created_at??"")),1),o("div",_i,r(w((x==null?void 0:x.created_at)??"")),1)]),"item.actions":t(({item:x})=>[o("div",ki,[e(Be,{text:"Kelola Komposisi"},{activator:t(({props:O})=>[e(R,xe(O,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:E=>P.$emit("open-composition-dialog",x)}),null,16,["onClick"])]),_:2},1024),e(Be,{text:"Kelola Variant"},{activator:t(({props:O})=>[e(R,xe(O,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:E=>P.$emit("open-variant-dialog",x)}),null,16,["onClick"])]),_:2},1024),e(Be,{text:"Edit Produk"},{activator:t(({props:O})=>[e(R,xe(O,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:E=>P.$emit("edit-product",x)}),null,16,["onClick"])]),_:2},1024),e(Be,{text:x.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:O})=>{var E;return[e(R,xe(O,{icon:x.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:x.active?"success":"error",loading:((E=P.toggleLoading)==null?void 0:E[x.id_product])||!1,onClick:y=>P.$emit("toggle-active",x)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Be,{text:x.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:O})=>[e(R,xe(O,{icon:x.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:x.featured?"warning":"default",onClick:E=>P.$emit("toggle-featured",x)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Be,{text:"Hapus Produk"},{activator:t(({props:O})=>[e(R,xe(O,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:E=>P.$emit("delete-product",x)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),xi=Je(hi,[["__scopeId","data-v-e3fcb175"]]),wi={class:"d-flex align-center gap-3"},Pi={class:"text-h5 font-weight-bold"},Vi={class:"text-h6"},Ci={class:"text-body-1"},Si={class:"d-flex flex-column"},Ii={class:"font-weight-medium"},$i={class:"text-caption text-grey-darken-1"},Di={class:"font-weight-medium"},zi={key:0,class:"text-caption"},Ti={key:1,class:"text-grey-lighten-1 text-caption"},Ui={class:"v-data-table__footer"},Ai={class:"pa-4 d-flex justify-space-between align-center"},Hi={class:"text-subtitle-1 font-weight-bold"},Mi={class:"text-subtitle-2 text-uppercase"},Ki={class:"text-h6 font-weight-bold my-2"},Bi={class:"text-caption"},Kt=Ne({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup($,{emit:be}){const N=$,z=be,J=D(!1),g=D(null),G=D(null),U=D(!1),h=D(!1),v=D("latest"),j=D(0),p=D(0),A=D(""),de=D(0),ke=D(!1),S=D(!1),ne=D(""),re=D(""),Q=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],ve=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],T=E=>!E||E===0?"":new Intl.NumberFormat("id-ID").format(E),_=E=>{if(!E)return 0;const y=E.replace(/[^\d]/g,"");return parseInt(y)||0},f=E=>{var s;const y=_(E);if(p.value=y,A.value=T(y),(s=g.value)!=null&&s.total_hpp&&y>0){const a=g.value.total_hpp;j.value=a>0?Math.round((y-a)/a*100):0}else j.value=0},w=E=>Ke(E),_e=async(E,y)=>{J.value=!0;try{await new Promise(s=>setTimeout(s,500)),g.value={total_hpp:15e4,method:y,calculated_at:new Date().toISOString(),items:[{item_name:"Tepung Terigu",item_code:"TPNG001",quantity_needed:.5,unit:"kg",cost_per_unit:15e3,total_cost:7500,is_critical:!1,notes:null},{item_name:"Gula Pasir",item_code:"GUL001",quantity_needed:.25,unit:"kg",cost_per_unit:12e3,total_cost:3e3,is_critical:!1,notes:null},{item_name:"Telur Ayam",item_code:"TLR001",quantity_needed:3,unit:"pcs",cost_per_unit:3e3,total_cost:9e3,is_critical:!0,notes:"Price volatile"}]},U.value=!0}catch(s){console.error("Error loading HPP breakdown:",s),U.value=!1}finally{J.value=!1}},pe=async(E,y)=>{J.value=!0;try{if(await new Promise(s=>setTimeout(s,1e3)),g.value){switch(y){case"latest":g.value.total_hpp=Math.round(g.value.total_hpp*1.1);break;case"average":g.value.total_hpp=Math.round(g.value.total_hpp*1.05);break;default:g.value.total_hpp=Math.round(g.value.total_hpp*1.03)}g.value.calculated_at=new Date().toISOString()}}catch(s){throw s}finally{J.value=!1}},fe=async(E,y,s,a,l)=>{J.value=!0;try{return await new Promise(u=>setTimeout(u,1e3)),{data:{new_price:s,markup_percentage:g.value?Math.round((s-g.value.total_hpp)/g.value.total_hpp*100):0}}}catch(u){throw u}finally{J.value=!1}},P=async()=>{var E,y,s;if(N.variantId)try{const a=localStorage.getItem("token"),l=await We.get(`/api/variants/${N.variantId}`,{headers:{Authorization:`Bearer ${a}`,Accept:"application/json"}});if(l.data.success&&l.data.data){const u=l.data.data;if(u.price&&u.price>0)p.value=Number(u.price),A.value=T(Number(u.price));else if((E=g.value)!=null&&E.total_hpp){const te=Math.round(g.value.total_hpp*1.2);p.value=te,A.value=T(te)}if((y=g.value)!=null&&y.total_hpp&&p.value>0){const te=g.value.total_hpp;j.value=te>0?Math.round((p.value-te)/te*100):0}de.value+=1}}catch(a){console.warn("Could not load target price, using default:",a),(s=g.value)!=null&&s.total_hpp&&(p.value=Math.round(g.value.total_hpp*1.2))}},q=async()=>{N.variantId&&(await _e(N.variantId,v.value),await P())},x=async()=>{var E,y;if(N.variantId)try{await pe(N.variantId,v.value),ne.value=`HPP successfully updated using ${v.value} method!`,ke.value=!0,z("hpp-updated"),await q()}catch(s){console.error("Error updating HPP:",s),re.value=((y=(E=s==null?void 0:s.response)==null?void 0:E.data)==null?void 0:y.message)||"Failed to update HPP",S.value=!0}},O=async()=>{var E,y,s,a,l,u,te,L,ce,Te;if(N.variantId&&((E=g.value)!=null&&E.total_hpp)&&p.value)try{const le=await fe(N.variantId,v.value,p.value,!0,!0);if((y=le==null?void 0:le.data)!=null&&y.new_price){if(p.value=le.data.new_price,A.value=T(le.data.new_price),((s=le==null?void 0:le.data)==null?void 0:s.markup_percentage)!==void 0)j.value=le.data.markup_percentage;else{const ze=g.value.total_hpp;j.value=ze>0?Math.round((le.data.new_price-ze)/ze*100):0}de.value+=1,await ht()}N.variantId&&await _e(N.variantId,v.value),ne.value=`Price successfully updated to ${w(((a=le==null?void 0:le.data)==null?void 0:a.new_price)||p.value)}!`,ke.value=!0,z("price-updated",{variantId:N.variantId,oldPrice:(l=le==null?void 0:le.data)==null?void 0:l.old_price,newPrice:(u=le==null?void 0:le.data)==null?void 0:u.new_price,hpp:(te=le==null?void 0:le.data)==null?void 0:te.hpp,markupPercentage:(L=le==null?void 0:le.data)==null?void 0:L.markup_percentage})}catch(le){console.error("Error applying price suggestion:",le),re.value=((Te=(ce=le==null?void 0:le.response)==null?void 0:ce.data)==null?void 0:Te.message)||"Failed to update variant price",S.value=!0}};return Ce(()=>N.modelValue,E=>{E&&N.variantId&&q()}),Ce(()=>N.variantId,E=>{E&&N.modelValue&&q()}),Ce(v,async()=>{N.variantId&&await q()}),Ce([()=>{var E;return(E=g.value)==null?void 0:E.total_hpp},p],()=>{var E;if((E=g.value)!=null&&E.total_hpp&&p.value>0){const y=g.value.total_hpp;j.value=y>0?Math.round((p.value-y)/y*100):0}else j.value=0}),Ce(p,E=>{E!==_(A.value)&&(A.value=T(E))}),(E,y)=>(m(),Z(Ue,null,[e(Oe,{"model-value":E.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":y[6]||(y[6]=s=>E.$emit("update:modelValue",s))},{default:t(()=>[e(ee,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",wi,[e(k,{icon:"mdi-calculator-variant",size:"24"}),o("span",null,"HPP Breakdown - "+r(E.variantName||"Variant"),1)]),e(R,{icon:"mdi-close",size:"small",variant:"text",onClick:y[0]||(y[0]=s=>E.$emit("update:modelValue",!1))})]),_:1}),e(ae,null,{default:t(()=>[e(De,{class:"mb-4"},{default:t(()=>[e(I,{cols:"12",md:"6"},{default:t(()=>[e(Re,{modelValue:v.value,"onUpdate:modelValue":[y[1]||(y[1]=s=>v.value=s),q],items:Q,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[e(R,{color:"primary",variant:"elevated",loading:J.value,"prepend-icon":"mdi-update",block:"",onClick:x},{default:t(()=>[c(" Update HPP with "+r(v.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),U.value?(m(),F(ee,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(ae,null,{default:t(()=>[e(De,{align:"center"},{default:t(()=>[e(I,{cols:"12",md:"4"},{default:t(()=>{var s;return[y[11]||(y[11]=o("div",{class:"text-subtitle-2"}," Total HPP ",-1)),o("div",Pi,r(w(((s=g.value)==null?void 0:s.total_hpp)||0)),1)]}),_:1,__:[11]}),e(I,{cols:"12",md:"4"},{default:t(()=>{var s;return[y[12]||(y[12]=o("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),o("div",Vi,r((s=Q.find(a=>{var l;return a.value===((l=g.value)==null?void 0:l.method)}))==null?void 0:s.title),1)]}),_:1,__:[12]}),e(I,{cols:"12",md:"4"},{default:t(()=>{var s;return[y[13]||(y[13]=o("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),o("div",Ci,r((s=g.value)!=null&&s.calculated_at?new Date(g.value.calculated_at).toLocaleString():"-"),1)]}),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):W("",!0),U.value?(m(),F(ee,{key:1},{default:t(()=>{var s;return[e(Pe,null,{default:t(()=>{var a,l;return[e(k,{icon:"mdi-format-list-bulleted",class:"me-2"}),c(" Item Breakdown ("+r(((l=(a=g.value)==null?void 0:a.items)==null?void 0:l.length)||0)+" items) ",1)]}),_:1}),e(va,{headers:ve,items:((s=g.value)==null?void 0:s.items)||[],"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:a})=>[o("div",Si,[o("span",Ii,r(a.item_name),1),o("span",$i,r(a.item_code),1)])]),"item.quantity_needed":t(({item:a})=>[o("span",Di,r(a.quantity_needed)+" "+r(a.unit),1)]),"item.cost_per_unit":t(({item:a})=>[o("span",null,r(w(a.cost_per_unit)),1)]),"item.total_cost":t(({item:a})=>[e(se,{color:a.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[c(r(w(a.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:a})=>[e(se,{color:a.is_critical?"error":"success","prepend-icon":a.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[c(r(a.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:a})=>[a.notes?(m(),Z("span",zi,r(a.notes),1)):(m(),Z("span",Ti,"â€”"))]),bottom:t(()=>{var a;return[o("div",Ui,[e(He),o("div",Ai,[o("div",Hi," Total HPP: "+r(w(((a=g.value)==null?void 0:a.total_hpp)||0)),1),e(se,{color:"info",variant:"elevated"},{default:t(()=>{var l,u;return[c(r(((u=(l=g.value)==null?void 0:l.items)==null?void 0:u.length)||0)+" items ",1)]}),_:1})])])]}),_:1},8,["items"])]}),_:1})):W("",!0),U.value?(m(),F(ee,{key:2,class:"mt-4"},{default:t(()=>[e(Pe,null,{default:t(()=>[e(k,{icon:"mdi-cash-multiple",class:"me-2"}),y[14]||(y[14]=c(" Price Suggestion "))]),_:1,__:[14]}),e(ae,null,{default:t(()=>[e(De,null,{default:t(()=>[e(I,{cols:"12",md:"6"},{default:t(()=>{var s;return[(m(),F(we,{key:de.value,modelValue:A.value,"onUpdate:modelValue":[y[2]||(y[2]=a=>A.value=a),f],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${w(((s=g.value)==null?void 0:s.total_hpp)||0)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>{var s;return[(m(),F(we,{key:de.value,modelValue:j.value,"onUpdate:modelValue":y[3]||(y[3]=a=>j.value=a),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${w(p.value-(((s=g.value)==null?void 0:s.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e(De,{class:"mt-2"},{default:t(()=>[e(I,{cols:"12",md:"12"},{default:t(()=>[e(R,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:J.value,disabled:!p.value||p.value<=0,block:"",onClick:O},{default:t(()=>y[15]||(y[15]=[c(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):W("",!0),h.value?(m(),F(ee,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(Pe,null,{default:t(()=>[e(k,{icon:"mdi-lightbulb",class:"me-2"}),y[16]||(y[16]=c(" Price Suggestions "))]),_:1,__:[16]}),e(ae,null,{default:t(()=>[e(De,null,{default:t(()=>[(m(!0),Z(Ue,null,Ye(G.value.suggestions,(s,a)=>(m(),F(I,{key:a,cols:"12",md:"4"},{default:t(()=>[e(ee,{variant:"elevated"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[o("div",Mi,r(a)+" Method ",1),o("div",Ki,r(w(s.suggested_price)),1),o("div",Bi,[c(" HPP: "+r(w(s.hpp)),1),y[17]||(y[17]=o("br",null,null,-1)),c(" Markup: "+r(s.markup_percentage.toFixed(1))+"%",1),y[18]||(y[18]=o("br",null,null,-1)),c(" Margin: "+r(s.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):W("",!0),!U.value&&!J.value?(m(),F(ee,{key:4,variant:"outlined"},{default:t(()=>[e(ae,{class:"text-center py-8"},{default:t(()=>[e(k,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),y[20]||(y[20]=o("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),y[21]||(y[21]=o("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:y[4]||(y[4]=s=>E.$emit("update:modelValue",!1))},{default:t(()=>y[19]||(y[19]=[c(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):W("",!0)]),_:1}),e(je,{class:"pa-4"},{default:t(()=>[e(Ge),e(R,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:y[5]||(y[5]=s=>E.$emit("update:modelValue",!1))},{default:t(()=>y[22]||(y[22]=[c(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(ct,{modelValue:ke.value,"onUpdate:modelValue":y[8]||(y[8]=s=>ke.value=s),color:"success",location:"top"},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:y[7]||(y[7]=s=>ke.value=!1)},{default:t(()=>y[23]||(y[23]=[c(" Close ")])),_:1,__:[23]})]),default:t(()=>[c(r(ne.value)+" ",1)]),_:1},8,["modelValue"]),e(ct,{modelValue:S.value,"onUpdate:modelValue":y[10]||(y[10]=s=>S.value=s),color:"error",location:"top"},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:y[9]||(y[9]=s=>S.value=!1)},{default:t(()=>y[24]||(y[24]=[c(" Close ")])),_:1,__:[24]})]),default:t(()=>[c(r(re.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),Ei={class:"d-flex align-center gap-2"},Fi={class:"pa-4",style:{"background-color":"#2A2A2A"}},Ri={key:0,class:"d-flex align-center gap-3"},Li={class:"text-h6 text-white font-weight-bold"},Ni={class:"d-flex align-center gap-4 mt-1"},qi={class:"text-caption text-grey-lighten-1"},Oi={class:"text-caption text-grey-lighten-1"},ji={class:"pa-4 add-item-form"},Ji={class:"d-flex align-center justify-space-between mb-4"},Wi={class:"d-flex align-center gap-2"},Gi={class:"text-h6"},Qi={key:0,class:"text-error"},Xi={key:1},Zi={class:"d-flex align-center"},Yi={class:"pa-4 text-center"},es={class:"pa-4 pt-0"},ts={class:"d-flex align-center justify-between mb-4"},as={class:"text-h6"},ls={key:0,class:"composition-list"},os={class:"d-flex align-center justify-between"},is={class:"d-flex align-center gap-3"},ss={class:"font-weight-medium"},ns={class:"text-caption text-medium-emphasis"},rs={class:"font-weight-medium text-primary"},us={class:"d-flex align-center gap-2"},ds={class:"text-center"},cs={key:0,class:"text-body-2 text-medium-emphasis"},ms={class:"text-center"},vs={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},ps=Ne({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup($,{emit:be}){const N=$,z=be,J=D(),g=D(!1),G=D(!1),U=D([]),h=D([]),v=D(!1),j=D(null),p=D(!1),A=D(null),de=D(!1),ke=D(!1),S=D(""),ne=D(""),re=D("success"),Q=D(!1),ve=me({get:()=>N.modelValue,set:n=>{z("update:modelValue",n)}}),T=()=>({item_id:null,quantity:1,is_critical:!1}),_=D(T()),f=me(()=>!_.value.item_id||!Array.isArray(U.value)?null:U.value.find(n=>n.id_item===_.value.item_id)),w=me(()=>!f.value||v.value&&j.value!==null?null:h.value.find(n=>{var i,b;return n.name===((i=f.value)==null?void 0:i.name)||n.id&&((b=f.value)==null?void 0:b.id_item)&&n.id===f.value.id_item})),_e=me(()=>{if(!f.value)return"";if(v.value&&j.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(w.value){const n=w.value;return`Item sudah ada dengan quantity ${n.quantity} ${n.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${fe(f.value)} ${f.value.unit}`}),pe=me(()=>Array.isArray(U.value)?U.value.filter(n=>fe(n)>0):[]),fe=n=>{var i,b;return((i=n.inventory)==null?void 0:i.current_stock)||((b=n.inventory)==null?void 0:b.available_stock)||n.current_stock||0},P=()=>G.value?"Memuat items...":!U.value||U.value.length===0?"Tidak ada item tersedia":pe.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",q=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),x=n=>{switch(n){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},O=n=>{switch(n){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},E=(n,i,b)=>{var C,oe,ie,he,Se,Ve,Ae,Le;if(!i)return!0;const M=i.toLowerCase().trim(),K=((oe=(C=b==null?void 0:b.raw)==null?void 0:C.name)==null?void 0:oe.toLowerCase())||"",d=((he=(ie=b==null?void 0:b.raw)==null?void 0:ie.item_code)==null?void 0:he.toLowerCase())||"",H=((Ve=(Se=b==null?void 0:b.raw)==null?void 0:Se.unit)==null?void 0:Ve.toLowerCase())||"",X=((Le=(Ae=b==null?void 0:b.raw)==null?void 0:Ae.description)==null?void 0:Le.toLowerCase())||"";return K.includes(M)||d.includes(M)||H.includes(M)||X.includes(M)},y=async()=>{var n,i,b;G.value=!0;try{const M=await We.get("/api/items?per_page=all&include=inventory"),K=((i=(n=M.data)==null?void 0:n.data)==null?void 0:i.data)||((b=M.data)==null?void 0:b.data)||M.data||[];U.value=Array.isArray(K)?K:[]}catch(M){console.error("Error loading items:",M),M!=null&&M.response&&(console.error("API Error Status:",M.response.status),console.error("API Error Data:",M.response.data)),U.value=[]}finally{G.value=!1}},s=async()=>{var n,i,b,M,K;if(!(!((n=N.variant)!=null&&n.id)&&!((i=N.variant)!=null&&i.id_variant)))try{const d=N.variant.id||N.variant.id_variant,H=await We.get(`/api/variant-items/variant/${d}`),X=((M=(b=H.data)==null?void 0:b.data)==null?void 0:M.composition)||((K=H.data)==null?void 0:K.composition)||[];if(!Array.isArray(X)){console.warn("API response composition is not an array:",X),h.value=[];return}h.value=X.map(C=>{var oe,ie,he,Se,Ve,Ae,Le,et,Ze,ue;return{id:C.id_variant_item||C.id,name:((oe=C.item)==null?void 0:oe.name)||C.name,quantity:parseFloat(C.quantity_needed||C.quantity||C.qty||"1"),unit:C.unit||((ie=C.item)==null?void 0:ie.unit)||"pcs",stock:((Se=(he=C.item)==null?void 0:he.inventory)==null?void 0:Se.current_stock)||((Ae=(Ve=C.item)==null?void 0:Ve.inventory)==null?void 0:Ae.available_stock)||((Le=C.item)==null?void 0:Le.current_stock)||C.stock||0,price:parseFloat(((et=C.item)==null?void 0:et.cost_per_unit)||((Ze=C.item)==null?void 0:Ze.price)||C.price||"0"),is_critical:C.is_critical||!1,inventory:(ue=C.item)!=null&&ue.inventory?{current_stock:C.item.inventory.current_stock||0,available_stock:C.item.inventory.available_stock||0,stock_status:C.item.inventory.stock_status||"unknown",reorder_level:C.item.inventory.reorder_level||0}:null}})}catch(d){console.error("Error loading composition items:",d),d!=null&&d.response&&(console.error("API Error Status:",d.response.status),console.error("API Error Data:",d.response.data)),h.value=[]}},a=async()=>{var K,d;const{valid:n}=await J.value.validate();if(!n||!f.value)return;const i=f.value.name,b=f.value.id_item,M=_.value.quantity;if(v.value&&j.value!==null)h.value[j.value].quantity,h.value[j.value].quantity=M,h.value[j.value].is_critical=_.value.is_critical,v.value=!1,j.value=null;else{const H=h.value.findIndex(X=>X.name===i||X.id&&b&&X.id===b);if(H!==-1){const oe=h.value[H].quantity+M;h.value[H].quantity=oe}else{const X={name:i,quantity:M,unit:f.value.unit,stock:((K=f.value.inventory)==null?void 0:K.current_stock)||((d=f.value.inventory)==null?void 0:d.available_stock)||f.value.current_stock||0,price:f.value.cost_per_unit||0,is_critical:_.value.is_critical,inventory:f.value.inventory?{current_stock:f.value.inventory.current_stock||0,available_stock:f.value.inventory.available_stock||0,stock_status:f.value.inventory.stock_status||"unknown",reorder_level:f.value.inventory.reorder_level||0}:null};h.value.push(X)}}_.value=T()},l=(n,i)=>{const b=U.value.find(M=>M.name===n.name||M.id_item===n.id);b?(v.value=!0,j.value=i,_.value={item_id:b.id_item,quantity:n.quantity,is_critical:n.is_critical||!1},setTimeout(()=>{const M=document.querySelector(".add-item-form");M&&M.scrollIntoView({behavior:"smooth",block:"start"})},100)):console.error("âŒ Could not find item in available items")},u=()=>{v.value=!1,j.value=null,_.value=T()},te=(n,i)=>{A.value={item:n,index:i},p.value=!0},L=async()=>{var M,K,d;if(!A.value)return;const{item:n,index:i}=A.value;n.name;const b=n.id;de.value=!0;try{b&&await We.delete(`/api/variant-items/${b}`),p.value=!1,A.value=null,await s(),z("save")}catch(H){console.error("âŒ Error deleting item:",H),console.error("âŒ Error details:",(M=H.response)==null?void 0:M.data),alert("Gagal menghapus item: "+(((d=(K=H.response)==null?void 0:K.data)==null?void 0:d.message)||H.message))}finally{de.value=!1}},ce=()=>{p.value=!1,A.value=null},Te=()=>{switch(re.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},le=()=>{switch(re.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},ze=()=>{switch(re.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},Me=()=>{switch(re.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},ot=async()=>{var n,i,b,M;if(!((n=N.variant)!=null&&n.id)&&!((i=N.variant)!=null&&i.id_variant)){console.error("No variant ID found");return}g.value=!0;try{const K=N.variant.id||N.variant.id_variant;if(h.value.some(H=>H.id)){const H={items:h.value.map(C=>{const oe=U.value.find(ie=>ie.name===C.name);return{id_variant_item:C.id,quantity_needed:Number(C.quantity),unit:C.unit,is_critical:C.is_critical||!1}}).filter(C=>C.id_variant_item&&C.quantity_needed>0)},X=await We.post("/api/variant-items/bulk-update",H)}else{const H={id_variant:K,items:h.value.map(C=>{const oe=U.value.find(ie=>ie.name===C.name);return{id_item:oe==null?void 0:oe.id_item,quantity_needed:Number(C.quantity),unit:C.unit,is_critical:C.is_critical||!1}}).filter(C=>C.id_item&&C.quantity_needed>0)},X=await We.post("/api/variant-items/bulk-store",H)}z("save"),V()}catch(K){console.error("Error saving composition:",K),alert("Gagal menyimpan komposisi: "+(((M=(b=K.response)==null?void 0:b.data)==null?void 0:M.message)||K.message))}finally{g.value=!1}},Xe=()=>{Q.value=!0},V=()=>{ve.value=!1,_.value=T(),h.value=[],v.value=!1,j.value=null};return Ce(()=>N.modelValue,n=>{n?(_.value=T(),y(),s()):(v.value=!1,j.value=null)}),Ce(()=>_.value.item_id,n=>{n&&f.value}),ut(()=>{y()}),(n,i)=>{var b,M,K;return m(),Z(Ue,null,[e(Oe,{modelValue:ve.value,"onUpdate:modelValue":i[3]||(i[3]=d=>ve.value=d),"max-width":"1000px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[o("div",Ei,[e(k,{icon:"mdi-delete",color:"white"}),i[9]||(i[9]=o("span",null,"Kelola Komposisi Item",-1))]),e(R,{icon:"mdi-close",variant:"text",color:"white",onClick:V,disabled:g.value},null,8,["disabled"])]),_:1}),e(ae,{class:"pa-0"},{default:t(()=>[o("div",Fi,[n.variant?(m(),Z("div",Ri,[e(k,{icon:"mdi-coffee",size:"32",color:"white"}),o("div",null,[o("h3",Li,r(n.variant.name),1),o("div",Ni,[o("span",qi,"SKU: "+r(n.variant.sku),1),o("span",Oi,"Harga: "+r(q(n.variant.price||0)),1),e(se,{color:"success",size:"small",variant:"tonal"},{default:t(()=>i[10]||(i[10]=[c(" Stok Aman ")])),_:1,__:[10]})])])])):W("",!0)]),o("div",ji,[o("div",Ji,[o("div",Wi,[e(k,{icon:"mdi-plus-circle",color:"success"}),o("h4",Gi,r(v.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(Ct,{ref_key:"form",ref:J,onSubmit:Pt(a,["prevent"])},{default:t(()=>[e(De,null,{default:t(()=>[e(I,{cols:"12",md:"4"},{default:t(()=>[e(Vt,{modelValue:_.value.item_id,"onUpdate:modelValue":i[0]||(i[0]=d=>_.value.item_id=d),items:pe.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[d=>!!d||"Item wajib dipilih"],loading:G.value,disabled:G.value||U.value&&U.value.length===0,"no-data-text":P(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":E},{"prepend-inner":t(()=>[e(k,{icon:"mdi-package",size:"16"})]),item:t(({props:d,item:H})=>[e(Qe,xe(d,{title:H.raw.name,disabled:fe(H.raw)<=0,class:["pa-3",{"text-disabled":fe(H.raw)<=0}]}),{prepend:t(()=>[e(k,{icon:"mdi-package-variant",color:fe(H.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[o("div",{class:lt(["text-caption",fe(H.raw)<=0?"text-disabled":"text-medium-emphasis"])},[fe(H.raw)<=0?(m(),Z("span",Qi,[e(k,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),i[11]||(i[11]=c(" Stok Habis "))])):(m(),Z("span",Xi," Stok: "+r(fe(H.raw))+" "+r(H.raw.unit),1))],2)]),append:t(()=>{var X;return[fe(H.raw)>0?(m(),F(se,{key:0,size:"x-small",color:x(((X=H.raw.inventory)==null?void 0:X.stock_status)||H.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var C;return[c(r(O(((C=H.raw.inventory)==null?void 0:C.stock_status)||H.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(m(),F(se,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>i[12]||(i[12]=[c(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:d})=>[o("div",Zi,[e(k,{icon:"mdi-package-variant",size:"16",class:"me-2"}),o("span",null,r(d.raw.name),1)])]),"no-data":t(()=>[o("div",Yi,[e(k,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),i[13]||(i[13]=o("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),i[14]||(i[14]=o("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(we,{modelValue:_.value.quantity,"onUpdate:modelValue":i[1]||(i[1]=d=>_.value.quantity=d),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[d=>!!d||"Jumlah wajib diisi",d=>d>0||"Jumlah harus lebih dari 0"],hint:_e.value,"persistent-hint":"",color:w.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>{var d;return[e(we,{"model-value":((d=f.value)==null?void 0:d.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!f.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e(k,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e(I,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(nt,{modelValue:_.value.is_critical,"onUpdate:modelValue":i[2]||(i[2]=d=>_.value.is_critical=d),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(R,{color:v.value?"primary":w.value?"warning":"#D4A574",onClick:a,loading:g.value,disabled:!_.value.item_id||!_.value.quantity,block:""},{default:t(()=>[e(k,{icon:v.value?"mdi-content-save":w.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),c(" "+r(v.value?"Update":w.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),v.value?(m(),F(R,{key:0,color:"grey",variant:"outlined",onClick:u,size:"small",block:""},{default:t(()=>[e(k,{icon:"mdi-close",class:"me-1"}),i[15]||(i[15]=c(" Batal "))]),_:1,__:[15]})):W("",!0)]),_:1})]),_:1})]),_:1},512)]),o("div",es,[o("div",ts,[o("h4",as,"Daftar Item Komposisi ("+r(h.value.length)+")",1)]),h.value.length>0?(m(),Z("div",ls,[(m(!0),Z(Ue,null,Ye(h.value,(d,H)=>(m(),F(ee,{key:H,variant:"outlined",class:"mb-3"},{default:t(()=>[e(ae,{class:"pa-3"},{default:t(()=>{var X,C,oe,ie,he,Se,Ve;return[o("div",os,[o("div",is,[e(k,{icon:"mdi-check-circle",color:"success"}),o("div",null,[o("div",ss,r(d.name),1),o("div",ns,[o("span",rs,"Dibutuhkan: "+r(d.quantity)+" "+r(d.unit),1),i[16]||(i[16]=c(" â€¢ ")),o("span",{class:lt({"text-success":(((X=d.inventory)==null?void 0:X.current_stock)??0)>(((C=d.inventory)==null?void 0:C.reorder_level)??0),"text-warning":(((oe=d.inventory)==null?void 0:oe.current_stock)??0)<=(((ie=d.inventory)==null?void 0:ie.reorder_level)??0)&&(((he=d.inventory)==null?void 0:he.current_stock)??0)>0,"text-error":(((Se=d.inventory)==null?void 0:Se.current_stock)??0)<=0})}," Stok: "+r(((Ve=d.inventory)==null?void 0:Ve.current_stock)||d.stock||0)+" "+r(d.unit),3),c(" â€¢ "+r(q(d.price)),1)])])]),o("div",us,[e(R,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:Ae=>l(d,H)},null,8,["onClick"]),e(R,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Ae=>te(d,H)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(m(),F(ee,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e(k,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),i[17]||(i[17]=o("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(je,{class:"px-6 pb-6"},{default:t(()=>[e(R,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:Xe},{default:t(()=>i[18]||(i[18]=[c(" Setting HPP ")])),_:1,__:[18]}),e(Ge),e(R,{variant:"outlined",onClick:V,disabled:g.value},{default:t(()=>i[19]||(i[19]=[c(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(R,{color:"#D4A574",onClick:ot,loading:g.value,disabled:h.value.length===0},{default:t(()=>i[20]||(i[20]=[c(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Kt,{modelValue:Q.value,"onUpdate:modelValue":i[4]||(i[4]=d=>Q.value=d),"variant-id":((b=n.variant)==null?void 0:b.id)||((M=n.variant)==null?void 0:M.id_variant),"variant-name":(K=n.variant)==null?void 0:K.name,onHppUpdated:i[5]||(i[5]=d=>z("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Oe,{modelValue:p.value,"onUpdate:modelValue":i[6]||(i[6]=d=>p.value=d),"max-width":"400px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e(k,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),i[21]||(i[21]=c(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(He),e(ae,{class:"pa-6"},{default:t(()=>[o("div",ds,[e(k,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),i[24]||(i[24]=o("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),A.value?(m(),Z("div",cs,[o("strong",null,r(A.value.item.name),1),i[22]||(i[22]=o("br",null,null,-1)),c(" Dibutuhkan: "+r(A.value.item.quantity)+" "+r(A.value.item.unit),1)])):W("",!0),e(Fe,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>i[23]||(i[23]=[o("strong",null,"Perhatian:",-1),c(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(je,{class:"px-6 pb-6"},{default:t(()=>[e(R,{variant:"outlined",onClick:ce,disabled:de.value,class:"flex-grow-1"},{default:t(()=>i[25]||(i[25]=[c(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(R,{color:"error",onClick:L,loading:de.value,class:"flex-grow-1"},{default:t(()=>i[26]||(i[26]=[c(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Oe,{modelValue:ke.value,"onUpdate:modelValue":i[8]||(i[8]=d=>ke.value=d),"max-width":"450px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(Pe,{class:lt(["d-flex align-center justify-center text-h6",ze()])},{default:t(()=>[e(k,{icon:Te(),color:le(),class:"me-2",size:"24"},null,8,["icon","color"]),c(" "+r(ne.value),1)]),_:1},8,["class"]),e(He),e(ae,{class:"pa-6"},{default:t(()=>[o("div",ms,[e(k,{icon:Te(),color:le(),size:"64",class:"mb-4"},null,8,["icon","color"]),o("div",vs,r(S.value),1),e(Fe,{type:re.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[re.value==="success"?(m(),Z(Ue,{key:0},[i[27]||(i[27]=o("strong",null,"Berhasil!",-1)),i[28]||(i[28]=c(" Perubahan telah disimpan. "))],64)):re.value==="info"?(m(),Z(Ue,{key:1},[i[29]||(i[29]=o("strong",null,"Informasi:",-1)),i[30]||(i[30]=c(" Item telah diperbarui sesuai permintaan. "))],64)):(m(),Z(Ue,{key:2},[i[31]||(i[31]=o("strong",null,"Perhatian:",-1)),i[32]||(i[32]=c(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(je,{class:"px-6 pb-6"},{default:t(()=>[e(Ge),e(R,{color:Me(),onClick:i[7]||(i[7]=d=>ke.value=!1),class:"px-6"},{default:t(()=>[e(k,{icon:"mdi-check",class:"me-1"}),i[33]||(i[33]=c(" OK "))]),_:1,__:[33]},8,["color"]),e(Ge)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),fs=Je(ps,[["__scopeId","data-v-d2ce0c17"]]),gs={class:"d-flex align-center gap-2"},_s={class:"mt-2"},ks={key:0,class:"mt-1 font-weight-medium"},ys={key:1,class:"mt-1 text-warning"},bs=Ne({__name:"CreateVariantDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save"],setup($,{emit:be}){const N=$,z=be,J=D(),g=D(!1),G=D(!1),U=D([]),h=D({name:"",selectedProduct:null,selectedProductId:null,active:!0}),v=[T=>!!T||"Nama variant wajib diisi",T=>T.length>=3||"Nama variant minimal 3 karakter"],j=[T=>!!T||"Produk wajib dipilih"],p=(T,_="success")=>{const f=document.createElement("div");f.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${_==="success"?"#4CAF50":"#f44336"};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 9999;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
  `;const w=document.createElement("span");if(w.innerHTML=_==="success"?"âœ“":"âœ•",w.style.cssText=`
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    font-weight: bold;
  `,f.appendChild(w),f.appendChild(document.createTextNode(T)),!document.querySelector("#snackbar-styles")){const _e=document.createElement("style");_e.id="snackbar-styles",_e.textContent=`
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `,document.head.appendChild(_e)}document.body.appendChild(f),setTimeout(()=>{f.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{f.parentNode&&f.parentNode.removeChild(f)},300)},3e3)},A=async()=>{G.value=!0;try{const T=await We.get("/api/products");U.value=T.data.data||T.data||[]}catch(T){console.error("Gagal mengambil data produk:",T),U.value=[]}finally{G.value=!1}},de=T=>{!T&&U.value.length===0&&A()},ke=T=>{h.value.selectedProduct=T,T?h.value.selectedProductId=T.id:h.value.selectedProductId=null},S=me(()=>h.value.selectedProduct?h.value.selectedProduct:h.value.selectedProductId&&U.value.length>0?U.value.find(_=>_.id===h.value.selectedProductId):null),ne=()=>{const T=S.value;if(!T||!h.value.name)return"";const _=T.sku||"PROD",f=h.value.name.replace(/\s+/g,"").toUpperCase().substring(0,3),w=Date.now().toString().slice(-4);return`${_}-${f}-${w}`},re=async()=>{var f,w;if(g.value)return;const{valid:T}=await J.value.validate();if(!T)return;const _=S.value;if(!_){p("Produk tidak ditemukan","error");return}if(!_.id&&!_.id_product){p("ID Produk tidak valid","error"),console.error("Product missing ID:",_);return}g.value=!0;try{const _e={id_product:_.id||_.id_product,name:h.value.name,sku:ne(),price:0,cost_price:null,barcode:null,variant_values:[],active:h.value.active},pe=await We.post("/api/variants",_e);if(pe.data.success!==!1&&(pe.status===200||pe.status===201))p("Variant berhasil dibuat!","success"),z("save"),ve();else throw new Error(pe.data.message||"Gagal membuat variant")}catch(_e){const pe=((w=(f=_e.response)==null?void 0:f.data)==null?void 0:w.message)||_e.message||"Gagal membuat variant";p(pe,"error"),console.error("Save variant error:",_e)}finally{g.value=!1}},Q=()=>{var T;h.value={name:"",selectedProduct:null,selectedProductId:null,active:!0},(T=J.value)==null||T.resetValidation()},ve=()=>{z("update:modelValue",!1),Q()};return Ce(()=>N.modelValue,T=>{T&&(Q(),A())}),(T,_)=>(m(),F(Oe,{"model-value":T.modelValue,"onUpdate:modelValue":_[3]||(_[3]=f=>T.$emit("update:modelValue",f)),"max-width":"600px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(Pe,{class:"bg-primary text-white"},{default:t(()=>[e(k,{icon:"mdi-plus-circle",class:"me-2"}),_[4]||(_[4]=c(" Tambah Variant Baru ")),e(Ge),e(R,{icon:"mdi-close",variant:"text",color:"white",onClick:ve})]),_:1,__:[4]}),e(Ct,{ref_key:"formRef",ref:J,onSubmit:Pt(re,["prevent"])},{default:t(()=>[e(ae,{class:"pa-6"},{default:t(()=>[e(De,null,{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[e(Vt,{modelValue:h.value.selectedProduct,"onUpdate:modelValue":[_[0]||(_[0]=f=>h.value.selectedProduct=f),ke],items:U.value,loading:G.value,"item-title":"name","return-object":"",label:"Pilih Produk *",placeholder:"Cari produk...",variant:"outlined",rules:j,required:"","no-data-text":"Tidak ada produk ditemukan","onUpdate:search":de},{item:t(({props:f,item:w})=>[e(Qe,aa(la(f)),{prepend:t(()=>[e($e,{image:w.raw.image_url,size:"40"},{default:t(()=>[w.raw.image_url?W("",!0):(m(),F(k,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"])]),default:t(()=>[e(rt,null,{default:t(()=>[c(r(w.raw.name),1)]),_:2},1024),e(dt,null,{default:t(()=>[c("SKU: "+r(w.raw.sku||"-"),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:f})=>[o("div",gs,[e($e,{image:f.raw.image_url,size:"24"},{default:t(()=>[f.raw.image_url?W("",!0):(m(),F(k,{key:0,icon:"mdi-coffee",size:"16"}))]),_:2},1032,["image"]),o("span",null,r(f.raw.name),1)])]),_:1},8,["modelValue","items","loading"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(we,{modelValue:h.value.name,"onUpdate:modelValue":_[1]||(_[1]=f=>h.value.name=f),label:"Nama Variant *",placeholder:"Contoh: Large Hot, Medium Cold, dll",variant:"outlined",rules:v,required:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(Fe,{color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(_t,null,{default:t(()=>[e(k,{icon:"mdi-information",class:"me-2"}),_[5]||(_[5]=c(" SKU Otomatis "))]),_:1,__:[5]}),o("div",_s,[_[6]||(_[6]=c(" SKU variant akan dibuat otomatis berdasarkan nama produk dan variant ")),h.value.name&&(h.value.selectedProduct||h.value.selectedProductId)?(m(),Z("div",ks," Preview SKU: "+r(ne()),1)):h.value.name&&!h.value.selectedProduct&&!h.value.selectedProductId?(m(),Z("div",ys," Pilih produk terlebih dahulu untuk melihat preview SKU ")):W("",!0)])]),_:1})]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(nt,{modelValue:h.value.active,"onUpdate:modelValue":_[2]||(_[2]=f=>h.value.active=f),label:"Variant Aktif",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(He),e(je,{class:"pa-6"},{default:t(()=>[e(Ge),e(R,{variant:"outlined",onClick:ve,disabled:g.value},{default:t(()=>_[7]||(_[7]=[c(" Batal ")])),_:1,__:[7]},8,["disabled"]),e(R,{type:"submit",color:"primary",loading:g.value},{default:t(()=>_[8]||(_[8]=[c(" Simpan Variant ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),hs=Je(bs,[["__scopeId","data-v-5477c365"]]),xs={class:"product-variant-tab"},ws={class:"d-flex gap-2"},Ps={key:0,class:"mt-4 d-flex align-center gap-2"},Vs={key:1,class:"text-center pa-12"},Cs={key:2,class:"text-center pa-12"},Ss={class:"d-flex align-center gap-3"},Is={class:"flex-grow-1 min-width-0"},$s={class:"text-h6 font-weight-bold text-truncate"},Ds={class:"text-body-2 text-medium-emphasis mb-0"},zs={class:"d-flex flex-column gap-1"},Ts={class:"text-xs"},Us={class:"d-flex align-center gap-2"},As={class:"text-primary font-weight-medium"},Hs={class:"d-flex gap-1"},Ms={class:"d-flex align-center justify-space-between w-100"},Ks={class:"d-flex gap-1"},Bs=Ne({__name:"ProductVariantTab",props:{loading:{type:Boolean}},emits:["refresh"],setup($,{emit:be}){const N=be,z=D(!1),J=D([]),g=D(!1),G=D(!1),U=D(null),h=D(!1),v=D(!1),j=D(!1),p=D({search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}),A=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],de=[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Variant Terbanyak",value:"variants_desc"},{title:"Variant Tersedikit",value:"variants_asc"}],ke=me(()=>!!(p.value.search||p.value.stockStatus||p.value.activeStatus!==null||p.value.sortBy!=="name_asc")),S=me(()=>{const s={};return J.value.forEach(a=>{const l=a.id_product;s[l]||(s[l]={product:a.product||{id:a.id_product,id_product:a.id_product,name:`Product ${a.id_product}`,sku:""},variants:[]}),s[l].variants.push(a)}),Object.values(s)}),ne=me(()=>{let s=[...S.value];if(p.value.search){const a=p.value.search.toLowerCase();s=s.filter(l=>{var u;return l.product.name.toLowerCase().includes(a)||((u=l.product.sku)==null?void 0:u.toLowerCase().includes(a))||l.variants.some(te=>te.name.toLowerCase().includes(a)||te.sku.toLowerCase().includes(a))})}switch(p.value.stockStatus&&(s=s.filter(a=>a.variants.some(l=>{var te;return(((te=l.composition_summary)==null?void 0:te.stock_status)||"safe")===p.value.stockStatus}))),p.value.activeStatus!==null&&(s=s.filter(a=>a.variants.some(l=>l.is_active===p.value.activeStatus))),p.value.sortBy){case"name_asc":s.sort((a,l)=>a.product.name.localeCompare(l.product.name));break;case"name_desc":s.sort((a,l)=>l.product.name.localeCompare(a.product.name));break;case"variants_desc":s.sort((a,l)=>l.variants.length-a.variants.length);break;case"variants_asc":s.sort((a,l)=>a.variants.length-l.variants.length);break}return s}),re=(s,a="success")=>{},Q=async s=>{try{const a=J.value.findIndex(l=>l.id_variant===s.variantId);a!==-1&&(J.value[a]={...J.value[a],price:s.newPrice,cost:s.hpp}),re(`Price updated to ${new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(s.newPrice)}`,"success")}catch(a){console.error("Error handling price update:",a),await ve()}},ve=async()=>{var s,a,l;z.value=!0;try{const u=await We.get("/api/variants",{params:{per_page:1e3,with_product:!0,with_composition:!0}});if(u.data.success===!1)throw new Error(u.data.message||"Failed to load variants");const te=((s=u.data.data)==null?void 0:s.data)||u.data.data||[];J.value=te.map(L=>({...L,is_active:L.active!==void 0?L.active:L.is_active,id:L.id_variant||L.id,id_product:L.id_product||L.product_id}))}catch(u){(l=(a=u.response)==null?void 0:a.data)!=null&&l.message||u.message,J.value=[]}finally{z.value=!1}},T=s=>{U.value=s,h.value=!0},_=s=>{s&&(U.value=s,v.value=!0)},f=s=>{U.value=s,g.value=!0},w=()=>{j.value=!0},_e=async()=>{var s,a;if(U.value)try{G.value=!0,await We.delete(`/api/variants/${U.value.id_variant}`),re("Variant berhasil dihapus","success"),await ve(),g.value=!1}catch(l){(a=(s=l.response)==null?void 0:s.data)!=null&&a.message}finally{G.value=!1}},pe=s=>{switch(s){case"critical":return"error";case"out":return"error";case"safe":return"success";default:return"primary"}},fe=s=>{switch(s){case"critical":return"Kritis";case"out":return"Habis";case"safe":return"Aman";default:return"Normal"}},P=s=>{const a=s.filter(l=>l.is_active).length;return a===0?"error":a===s.length?"success":"warning"},q=s=>s.some(a=>{var u;const l=(u=a.composition_summary)==null?void 0:u.stock_status;return l==="critical"||l==="out"}),x=s=>{const a=s.filter(u=>u.is_active).length,l=s.filter(u=>{var L;const te=(L=u.composition_summary)==null?void 0:L.stock_status;return te==="critical"||te==="out"}).length;return l>0?{text:`${l} Stok Kritis`,color:"error",icon:"mdi-alert-circle"}:a===s.length?{text:"Semua Aktif",color:"success",icon:"mdi-check-circle"}:a===0?{text:"Semua Nonaktif",color:"error",icon:"mdi-close-circle"}:{text:`${a}/${s.length} Aktif`,color:"warning",icon:"mdi-minus-circle"}},O=()=>{p.value={search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}},E=()=>{ve(),N("refresh")},y=()=>{ve(),N("refresh")};return ut(()=>{ve()}),(s,a)=>{var l,u,te;return m(),Z("div",xs,[e(ee,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a[14]||(a[14]=o("div",null,[o("h2",{class:"text-h5 font-weight-bold"},"Variant Produk"),o("p",{class:"text-body-2 text-medium-emphasis"}," Kelola variant dan komposisi untuk produk Anda ")],-1)),o("div",ws,[e(R,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:ve,loading:z.value},{default:t(()=>a[12]||(a[12]=[c(" Refresh ")])),_:1,__:[12]},8,["loading"]),e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:w},{default:t(()=>a[13]||(a[13]=[c(" Tambah Variant ")])),_:1,__:[13]})])]),_:1,__:[14]})]),_:1}),e(ee,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ae,null,{default:t(()=>[e(De,null,{default:t(()=>[e(I,{cols:"12",md:"3"},{default:t(()=>[e(we,{modelValue:p.value.search,"onUpdate:modelValue":a[0]||(a[0]=L=>p.value.search=L),label:"Cari Variant",placeholder:"Nama variant, SKU, atau produk...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Re,{modelValue:p.value.stockStatus,"onUpdate:modelValue":a[1]||(a[1]=L=>p.value.stockStatus=L),items:A,label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Re,{modelValue:p.value.activeStatus,"onUpdate:modelValue":a[2]||(a[2]=L=>p.value.activeStatus=L),items:[{title:"Semua Status",value:null},{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Status Aktif",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Re,{modelValue:p.value.sortBy,"onUpdate:modelValue":a[3]||(a[3]=L=>p.value.sortBy=L),items:de,label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),ke.value?(m(),Z("div",Ps,[a[16]||(a[16]=o("span",{class:"text-body-2"},"Filter aktif:",-1)),p.value.search?(m(),F(se,{key:0,size:"small",closable:"","onClick:close":a[4]||(a[4]=L=>p.value.search="")},{default:t(()=>[c(" Pencarian: "+r(p.value.search),1)]),_:1})):W("",!0),p.value.stockStatus?(m(),F(se,{key:1,size:"small",closable:"","onClick:close":a[5]||(a[5]=L=>p.value.stockStatus="")},{default:t(()=>{var L;return[c(" Stok: "+r((L=A.find(ce=>ce.value===p.value.stockStatus))==null?void 0:L.title),1)]}),_:1})):W("",!0),p.value.activeStatus!==null?(m(),F(se,{key:2,size:"small",closable:"","onClick:close":a[6]||(a[6]=L=>p.value.activeStatus=null)},{default:t(()=>[c(" Status: "+r(p.value.activeStatus?"Aktif":"Nonaktif"),1)]),_:1})):W("",!0),e(R,{variant:"text",size:"small",color:"error",onClick:O},{default:t(()=>a[15]||(a[15]=[c(" Hapus Semua Filter ")])),_:1,__:[15]})])):W("",!0)]),_:1})]),_:1}),!z.value&&ne.value.length===0&&ke.value?(m(),F(Fe,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada variant yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):W("",!0),z.value?(m(),Z("div",Vs,[e(pt,{color:"primary",indeterminate:"",size:"64"}),a[17]||(a[17]=o("div",{class:"mt-4 text-h6"},"Memuat variant...",-1))])):S.value.length===0?(m(),Z("div",Cs,[e(k,{icon:"mdi-tune-variant",size:"96",class:"text-disabled mb-6"}),a[19]||(a[19]=o("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Variant Produk",-1)),a[20]||(a[20]=o("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat variant untuk produk Anda agar dapat menawarkan pilihan yang beragam ",-1)),e(R,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:w},{default:t(()=>a[18]||(a[18]=[c(" Buat Variant Pertama ")])),_:1,__:[18]})])):(m(),F(De,{key:3},{default:t(()=>[(m(!0),Z(Ue,null,Ye(ne.value,L=>(m(),F(I,{key:L.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ee,{class:lt(["variant-group-card h-100",{"border-error":q(L.variants)}]),elevation:"2"},{default:t(()=>[e(Pe,{class:"pa-4 pb-2"},{default:t(()=>[o("div",Ss,[e($e,{image:L.product.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[L.product.image_url?W("",!0):(m(),F(k,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),o("div",Is,[o("h3",$s,r(L.product.name),1),o("p",Ds," SKU: "+r(L.product.sku||"-"),1)]),e(se,{color:P(L.variants),size:"small",variant:"tonal"},{default:t(()=>[c(r(L.variants.length)+" Variant ",1)]),_:2},1032,["color"])])]),_:2},1024),e(He),e(ae,{class:"pa-4"},{default:t(()=>[e(ft,{class:"pa-0"},{default:t(()=>[(m(!0),Z(Ue,null,Ye(L.variants,(ce,Te)=>(m(),F(Qe,{key:ce.id_variant,class:lt(["pa-2 rounded-lg variant-item",{"mb-2":Te<L.variants.length-1}])},{prepend:t(()=>[e($e,{size:"32",color:ce.is_active?"success":"error",variant:"tonal"},{default:t(()=>[e(k,{icon:ce.is_active?"mdi-check":"mdi-close",size:"16"},null,8,["icon"])]),_:2},1032,["color"])]),append:t(()=>[o("div",Hs,[e(Be,{text:"Kelola Komposisi"},{activator:t(({props:le})=>[e(R,xe({ref_for:!0},le,{icon:"mdi-chef-hat",size:"small",variant:"text",color:"primary",onClick:ze=>T(ce)}),null,16,["onClick"])]),_:2},1024),e(Be,{text:"Hapus Variant"},{activator:t(({props:le})=>[e(R,xe({ref_for:!0},le,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:ze=>f(ce)}),null,16,["onClick"])]),_:2},1024)])]),default:t(()=>[e(rt,{class:"text-sm font-weight-medium"},{default:t(()=>[c(r(ce.name),1)]),_:2},1024),e(dt,null,{default:t(()=>[o("div",zs,[o("span",Ts,"SKU: "+r(ce.sku),1),o("div",Us,[o("span",As,r(B(Ke)(ce.price||0)),1),ce.composition_summary?(m(),F(se,{key:0,color:pe(ce.composition_summary.stock_status),size:"x-small",variant:"tonal"},{default:t(()=>[c(r(fe(ce.composition_summary.stock_status)),1)]),_:2},1032,["color"])):W("",!0)])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:2},1024)]),_:2},1024),e(He),e(je,{class:"pa-4"},{default:t(()=>[o("div",Ms,[o("div",null,[e(se,{color:x(L.variants).color,size:"small",variant:"tonal"},{default:t(()=>[e(k,{icon:x(L.variants).icon,size:"14",class:"me-1"},null,8,["icon"]),c(" "+r(x(L.variants).text),1)]),_:2},1032,["color"])]),o("div",Ks,[e(Be,{text:"Setting HPP Produk"},{activator:t(({props:ce})=>[e(R,xe({ref_for:!0},ce,{icon:"mdi-calculator-variant",size:"small",variant:"text",color:"warning",onClick:Te=>_(L.variants[0])}),null,16,["onClick"])]),_:2},1024),e(Be,{text:"Tambah Variant"},{activator:t(({props:ce})=>[e(R,xe({ref_for:!0},ce,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:w}),null,16)]),_:1}),e(Be,{text:"Pengaturan Produk (Coming Soon)"},{activator:t(({props:ce})=>[e(R,xe({ref_for:!0},ce,{icon:"mdi-cog",size:"small",variant:"text",color:"secondary",disabled:""}),null,16)]),_:1})])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(fs,{modelValue:h.value,"onUpdate:modelValue":a[7]||(a[7]=L=>h.value=L),variant:U.value,onSave:E},null,8,["modelValue","variant"]),e(Kt,{modelValue:v.value,"onUpdate:modelValue":a[8]||(a[8]=L=>v.value=L),"variant-id":(l=U.value)==null?void 0:l.id_variant,"variant-name":(u=U.value)==null?void 0:u.name,onHppUpdated:ve,onPriceUpdated:Q},null,8,["modelValue","variant-id","variant-name"]),e(hs,{modelValue:j.value,"onUpdate:modelValue":a[9]||(a[9]=L=>j.value=L),onSave:y},null,8,["modelValue"]),e(Ut,{modelValue:g.value,"onUpdate:modelValue":a[10]||(a[10]=L=>g.value=L),title:"Konfirmasi Hapus Variant","item-name":(te=U.value)==null?void 0:te.name,loading:G.value,"confirm-text":"Hapus Variant",onConfirm:_e,onCancel:a[11]||(a[11]=L=>g.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),Tt=Je(Bs,[["__scopeId","data-v-22b81d4b"]]),Es={class:"product-management"},Fs={class:"d-flex justify-space-between align-center mb-6"},Rs={class:"d-flex gap-3 align-center"},Ls={key:0,class:"d-flex gap-2"},Ns={class:"d-flex align-center"},qs=Ne({__name:"products-management",setup($){At();const{productsList:be,categories:N,loading:z,saveLoading:J,deleteLoading:g,toggleLoading:G,stats:U,dialog:h,deleteDialog:v,editMode:j,selectedProduct:p,selectedProducts:A,currentPage:de,totalItems:ke,itemsPerPage:S,filters:ne,errorMessage:re,successMessage:Q,modalErrorMessage:ve,formData:T,selectedImage:_,imagePreview:f,canCreateEdit:w,hasSelectedProducts:_e,fetchProductsList:pe,fetchCategories:fe,fetchStats:P,saveProduct:q,deleteProduct:x,bulkDeleteProducts:O,toggleActiveStatus:E,toggleFeaturedStatus:y,toggleKitchenAvailability:s,toggleBarAvailability:a,openCreateDialog:l,openEditDialog:u,openDeleteDialog:te,closeDialog:L,handleImageUpload:ce,clearModalError:Te,updateOptions:le}=Ht(),{dialog:ze,editMode:Me,formData:ot,availableItems:Xe,saveLoading:V,modalErrorMessage:n,openCreateDialog:i,closeDialog:b,saveRecipe:M,clearModalError:K,fetchAvailableItems:d}=fa(),{productItemsList:H,loading:X,fetchProductItemsForComposition:C}=Bt(),oe=D("products"),ie=D(),he=D(!1),Se=D(null),Ve=D(!1),Ae=D(null),Le=async()=>{await x()},et=async()=>{await O()},Ze=ye=>{const Y=ye.id_product||ye.id;i(Y)},ue=async ye=>{Se.value=ye;try{await C({page:1,per_page:100,critical_only:!1})}catch{}he.value=!0},Ie=ye=>{Ae.value=ye,Ve.value=!0},qe=ye=>{if(!ye)return[];const Y=ye.id_product||ye.id;return H.value.filter(at=>{var ge;return((ge=at.product)==null?void 0:ge.id_product)===Y||at.product_id===Y})||[]},Ee=async()=>{if(await C({page:1,per_page:100,critical_only:!1}),await pe(),Se.value&&ie.value){const ye=Se.value.id_product||Se.value.id;await ie.value.refreshHPPData(ye)}},tt=ye=>{Object.assign(ne,ye),pe()},it=ye=>{console.log("Search query received:",ye),ne.search=ye,console.log("Filters after search update:",ne),pe()},st=()=>{_.value=null,f.value&&(f.value="")};return Ce(oe,async ye=>{ye==="compositions"&&await C({page:1,per_page:100,critical_only:!1})},{immediate:!1}),ut(()=>{pe(),fe(),P(),d(),C({page:1,per_page:100,critical_only:!1})}),(ye,Y)=>{var at;return m(),Z("div",Es,[o("div",Fs,[Y[18]||(Y[18]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),o("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),o("div",Rs,[B(_e)&&oe.value==="products"?(m(),Z("div",Ls,[e(se,{color:"primary",size:"small"},{default:t(()=>[c(r(B(A).length)+" dipilih ",1)]),_:1}),e(R,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:et},{default:t(()=>Y[16]||(Y[16]=[c(" Hapus Terpilih ")])),_:1,__:[16]})])):W("",!0),B(w)&&oe.value==="products"?(m(),F(R,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:B(l)},{default:t(()=>Y[17]||(Y[17]=[c(" Tambah Produk ")])),_:1,__:[17]},8,["onClick"])):W("",!0)])]),e($a,{modelValue:oe.value,"onUpdate:modelValue":Y[0]||(Y[0]=ge=>oe.value=ge),class:"mb-6"},{default:t(()=>[e(yt,{value:"products"},{default:t(()=>[e(k,{icon:"mdi-coffee",class:"me-2"}),Y[19]||(Y[19]=c(" Produk "))]),_:1,__:[19]}),e(yt,{value:"compositions"},{default:t(()=>[e(k,{icon:"mdi-chef-hat",class:"me-2"}),Y[20]||(Y[20]=c(" Komposisi Produk "))]),_:1,__:[20]}),e(yt,{value:"variants"},{default:t(()=>[e(k,{icon:"mdi-tune-variant",class:"me-2"}),Y[21]||(Y[21]=c(" Variant Produk "))]),_:1,__:[21]})]),_:1},8,["modelValue"]),B(re)?(m(),F(Fe,{key:0,type:"error",variant:"outlined",class:"mb-4",text:B(re),closable:"","onClick:close":Y[1]||(Y[1]=ge=>re.value="")},null,8,["text"])):W("",!0),B(Q)?(m(),F(Fe,{key:1,type:"success",variant:"outlined",class:"mb-4",text:B(Q),closable:"","onClick:close":Y[2]||(Y[2]=ge=>Q.value="")},null,8,["text"])):W("",!0),e(Da,{modelValue:oe.value,"onUpdate:modelValue":Y[4]||(Y[4]=ge=>oe.value=ge)},{default:t(()=>[e(bt,{value:"products"},{default:t(()=>[e(ti,{stats:B(U)},null,8,["stats"]),e(Ko,{filters:B(ne),"onUpdate:filters":tt,onSearch:it},null,8,["filters"]),e(xi,{ref_key:"productTableRef",ref:ie,products:B(be),loading:B(z),"current-page":B(de),"total-items":B(ke),"items-per-page":B(S),"selected-products":B(A),"toggle-loading":B(G),"onUpdate:options":B(le),onAddProduct:B(l),onEditProduct:B(u),onOpenRecipeDialog:Ze,onOpenCompositionDialog:ue,onOpenVariantDialog:Ie,onDeleteProduct:B(te),onToggleActive:B(E),onToggleFeatured:B(y),onToggleKitchen:B(s),onToggleBar:B(a),"onUpdate:selectedProducts":Y[3]||(Y[3]=ge=>A.value=ge)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:options","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured","onToggleKitchen","onToggleBar"])]),_:1}),e(bt,{value:"compositions"},{default:t(()=>[e(ao,{"product-items":B(H),loading:B(X),onRefresh:B(C)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(bt,{value:"variants"},{default:t(()=>[e(Tt,{loading:B(z),onRefresh:B(pe)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(To,{modelValue:B(h),"onUpdate:modelValue":[Y[5]||(Y[5]=ge=>kt(h)?h.value=ge:null),Y[6]||(Y[6]=ge=>h.value=ge)],"edit-mode":B(j),"form-data":B(T),categories:B(N),loading:B(J),"error-message":B(ve),"selected-image":B(_)?[B(_)]:[],"image-preview":B(f),onClose:B(L),onSubmit:B(q),onImageChange:B(ce),onRemoveImage:st,onClearError:B(Te),onUpdateForm:Y[7]||(Y[7]=(ge,St)=>B(T)[ge]=St)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(ga,{modelValue:B(ze),"onUpdate:modelValue":[Y[8]||(Y[8]=ge=>kt(ze)?ze.value=ge:null),Y[9]||(Y[9]=ge=>ze.value=ge)],"edit-mode":B(Me),"form-data":B(ot),"available-items":B(Xe),loading:B(V),"error-message":B(n),onClose:B(b),onSave:B(M),onClearError:B(K)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(Ut,{modelValue:B(v),"onUpdate:modelValue":Y[10]||(Y[10]=ge=>kt(v)?v.value=ge:null),title:"Konfirmasi Hapus Produk","item-name":(at=B(p))==null?void 0:at.name,loading:B(g),"confirm-text":"Hapus Produk",onConfirm:Le,onCancel:Y[11]||(Y[11]=ge=>v.value=!1)},null,8,["modelValue","item-name","loading"]),e(Mt,{modelValue:he.value,"onUpdate:modelValue":Y[12]||(Y[12]=ge=>he.value=ge),product:Se.value,items:qe(Se.value),onSave:Ee,onRefresh:Ee},null,8,["modelValue","product","items"]),e(Oe,{modelValue:Ve.value,"onUpdate:modelValue":Y[15]||(Y[15]=ge=>Ve.value=ge),"max-width":"1400px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(Pe,{class:"d-flex justify-between align-center"},{default:t(()=>{var ge;return[o("div",Ns,[e(k,{icon:"tabler-versions",class:"me-2"}),c(" Kelola Variant - "+r((ge=Ae.value)==null?void 0:ge.name),1)]),e(R,{icon:"tabler-x",variant:"text",onClick:Y[13]||(Y[13]=St=>Ve.value=!1)})]}),_:1}),e(He),e(ae,{class:"pa-0"},{default:t(()=>[Ae.value?(m(),F(Tt,{key:0,product:Ae.value},null,8,["product"])):W("",!0)]),_:1}),e(He),e(je,null,{default:t(()=>[e(Ge),e(R,{color:"grey-darken-1",variant:"outlined",onClick:Y[14]||(Y[14]=ge=>Ve.value=!1)},{default:t(()=>[e(k,{icon:"mdi-close",class:"me-1"}),Y[22]||(Y[22]=c(" Tutup "))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Mn=Je(qs,[["__scopeId","data-v-0500c9fb"]]);export{Mn as default};
