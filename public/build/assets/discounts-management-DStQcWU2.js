var he=Object.defineProperty;var we=(P,i,m)=>i in P?he(P,i,{enumerable:!0,configurable:!0,writable:!0,value:m}):P[i]=m;var pe=(P,i,m)=>we(P,typeof i!="symbol"?i+"":i,m);import{D as Se}from"./DeleteConfirmationDialog-z_qVrTTK.js";import{au as N,d as ve,r as y,w as H,V as Y,D as ge,g as I,f as a,b as e,e as t,X,t as f,a1 as C,a0 as Te,l as L,at as Ue,c as $,F as fe,i as _e,s as V,aK as ye,o as g,_ as be,as as $e,m as Ce}from"./main-Ck8C79PT.js";import{V as xe}from"./VDialog-BSUdv00L.js";import{b as ke,c as Ve,V as O}from"./VCard-DmMufESZ.js";import{V as Be}from"./VForm-GCePGqu-.js";import{V as J}from"./VCardText-BNTi3UNn.js";import{V as j,a as v}from"./VRow-RYZ_APj3.js";import{V as M}from"./VTextField-DIzZ6UMa.js";import{V as Pe}from"./VTextarea-GAd0e_B8.js";import{V as ee}from"./VDivider-SDZJsEUw.js";import{V as te}from"./VSelect-D5yoLOVO.js";import{V as Ae}from"./VSwitch-DIiv8iBc.js";import{V as De}from"./VSpacer-C8nWjSks.js";import{V as E}from"./VChip-CN8v6baz.js";import{V as Re}from"./VDataTableServer-CJk1dg3i.js";import"./VOverlay-DN5CqJQx.js";import"./forwardRefs-B931MWyl.js";import"./VImg-D_-r9UKr.js";import"./VAvatar-BrKXcFqe.js";/* empty css              */import"./VList--ImGxPeg.js";import"./VMenu-Cn31-nAO.js";import"./VCheckboxBtn-D5ufpB3T.js";import"./VDataTable-JrJZP1Zo.js";import"./VTable-DmH0UwXw.js";import"./filter-CuL_9HrV.js";class h{static async getDiscounts(i={}){return(await N.get(this.BASE_URL,{params:i})).data.data}static async getDiscount(i){return(await N.get(`${this.BASE_URL}/${i}`)).data.data}static async createDiscount(i){return(await N.post(this.BASE_URL,i)).data.data}static async updateDiscount(i,m){return(await N.put(`${this.BASE_URL}/${i}`,m)).data.data}static async deleteDiscount(i){await N.delete(`${this.BASE_URL}/${i}`)}static async validateDiscountCode(i,m,b){return(await N.post(`${this.BASE_URL}/validate-code`,{code:i,order_total:m,customer_id:b})).data.data}static async getStats(){return(await N.get(`${this.BASE_URL}/stats`)).data.data}static async toggleStatus(i){return(await N.post(`${this.BASE_URL}/${i}/toggle-status`)).data.data}static async duplicate(i){return(await N.post(`${this.BASE_URL}/${i}/duplicate`)).data.data}static formatDiscountValue(i){switch(i.type){case"percentage":return`${i.value}%`;case"fixed_amount":return`Rp ${this.formatCurrency(i.value)}`;default:return i.value.toString()}}static formatCurrency(i){return new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0}).format(i)}static getDiscountTypeLabel(i){return{percentage:"Persentase",fixed_amount:"Jumlah Tetap",buy_x_get_y:"Beli X Dapat Y"}[i]||i}static getStatusColor(i){return{active:"success",inactive:"secondary",expired:"error",scheduled:"warning",exhausted:"info"}[i]||"primary"}static getStatusLabel(i){return{active:"Aktif",inactive:"Tidak Aktif",expired:"Kadaluarsa",scheduled:"Terjadwal",exhausted:"Habis"}[i]||i}static isDiscountValid(i){if(!i.active)return!1;const m=new Date,b=new Date(i.valid_from),w=new Date(i.valid_until);return m>=b&&m<=w}static canDiscountBeUsed(i,m){return!(!this.isDiscountValid(i)||i.minimum_amount&&m<i.minimum_amount||i.usage_limit&&i.used_count>=i.usage_limit)}static calculateDiscountAmount(i,m){if(!this.canDiscountBeUsed(i,m))return 0;let b=0;switch(i.type){case"percentage":b=m*i.value/100;break;case"fixed_amount":b=i.value;break;case"buy_x_get_y":b=0;break}return i.maximum_discount&&b>i.maximum_discount&&(b=i.maximum_discount),Math.round(b*100)/100}}pe(h,"BASE_URL","/api/discounts");const Ie={class:"d-flex align-center"},Le={class:"text-subtitle-2 mb-2"},Fe={key:0,class:"text-body-2"},Ke={class:"ml-4 mt-1"},Me={key:0,class:"text-caption text-info mt-1"},ze={key:1,class:"text-caption text-error mt-1"},Ne={key:2,class:"text-caption text-success mt-1"},je=ve({__name:"DiscountDialog",props:{modelValue:{type:Boolean},mode:{},discount:{default:null}},emits:["update:modelValue","saved"],setup(P,{emit:i}){const m=P,b=i,w=y(),S=y(!1),z=y(!1),_=y({}),D=y(!1),B=y(""),x=y({loading:!1,available:null}),n=y({name:"",code:"",description:"",type:"percentage",value:0,minimum_amount:void 0,maximum_discount:void 0,usage_limit:void 0,usage_limit_per_customer:void 0,valid_from:"",valid_until:"",active:!0}),T=s=>!s||s===0?"":new Intl.NumberFormat("id-ID").format(s),A=s=>{if(!s||s.trim()==="")return;const l=s.replace(/[^\d]/g,"");if(l==="")return;const c=parseInt(l);return isNaN(c)?void 0:c},F=y(""),K=y("");H(()=>n.value.minimum_amount,s=>{F.value=T(s)}),H(()=>n.value.maximum_discount,s=>{K.value=T(s)});const u=s=>{const l=A(s);n.value.minimum_amount=l,F.value=T(l)},o=s=>{const l=A(s);n.value.maximum_discount=l,K.value=T(l)},U=[{title:"Persentase (%)",value:"percentage"},{title:"Jumlah Tetap (Rp)",value:"fixed_amount"},{title:"Beli X Dapat Y",value:"buy_x_get_y"}],k=Y({get:()=>m.modelValue,set:s=>b("update:modelValue",s)}),q=Y(()=>m.mode==="create"?"Tambah Diskon Baru":"Edit Diskon"),R=[s=>!!s||"Nama diskon wajib diisi",s=>s.length>=3||"Nama minimal 3 karakter"],ae=[s=>!!s||"Kode diskon wajib diisi",s=>s.length>=3||"Kode minimal 3 karakter",s=>/^[A-Z0-9_-]+$/.test(s)||"Kode hanya boleh huruf kapital, angka, - dan _"],le=Y(()=>[s=>s>0||"Nilai harus lebih dari 0",...n.value.type==="percentage"?[s=>s<=100||"Persentase maksimal 100%"]:[]]),se=[s=>!!s||"Tanggal mulai wajib diisi"],ie=Y(()=>[s=>!!s||"Tanggal berakhir wajib diisi",s=>{if(!s||!n.value.valid_from)return!0;const l=new Date(n.value.valid_from);return new Date(s)>l||"Tanggal berakhir harus setelah tanggal mulai"}]),oe=ye(async s=>{if(!s||s.length<3){x.value={loading:!1,available:null};return}try{x.value.loading=!0,await new Promise(l=>setTimeout(l,500)),x.value={loading:!1,available:!0}}catch(l){x.value={loading:!1,available:null},console.error("Code validation error:",l)}},500),Q=()=>{oe(n.value.code)},ne=()=>{const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let l="";for(let c=0;c<8;c++)l+=s.charAt(Math.floor(Math.random()*s.length));n.value.code=l,Q()},ue=()=>{switch(n.value.type){case"percentage":return"Persentase Diskon";case"fixed_amount":return"Jumlah Diskon";case"buy_x_get_y":return"Persentase/Jumlah Diskon";default:return"Nilai"}},de=()=>{n.value.type!=="percentage"&&(n.value.maximum_discount=void 0)},re=()=>{n.value={name:"",code:"",description:"",type:"percentage",value:0,minimum_amount:void 0,maximum_discount:void 0,usage_limit:void 0,usage_limit_per_customer:void 0,valid_from:"",valid_until:"",active:!0},F.value="",K.value="",x.value={loading:!1,available:null},_.value={},D.value=!1,B.value=""},W=()=>{if(m.discount){const s=m.discount;n.value={name:s.name,code:s.code,description:s.description||"",type:s.type,value:s.value,minimum_amount:s.minimum_amount,maximum_discount:s.maximum_discount,usage_limit:s.usage_limit,usage_limit_per_customer:s.usage_limit_per_customer,valid_from:s.valid_from?new Date(s.valid_from).toISOString().slice(0,16):"",valid_until:s.valid_until?new Date(s.valid_until).toISOString().slice(0,16):"",active:s.active},F.value=T(s.minimum_amount),K.value=T(s.maximum_discount)}},me=async()=>{var l,c,p;_.value={},D.value=!1,B.value="";const{valid:s}=await((l=w.value)==null?void 0:l.validate());if(!(!s||x.value.available===!1)){if(n.value.valid_from&&n.value.valid_until){const r=new Date(n.value.valid_from);if(new Date(n.value.valid_until)<=r){B.value="Tanggal berakhir harus setelah tanggal mulai",D.value=!0;return}}try{z.value=!0,m.mode==="create"?await h.createDiscount(n.value):m.discount&&await h.updateDiscount(m.discount.id_discount,n.value),b("saved")}catch(r){console.error("Save error:",r),(p=(c=r.response)==null?void 0:c.data)!=null&&p.errors?(_.value=r.response.data.errors,B.value=r.response.data.message||"Terjadi kesalahan validasi"):B.value=r.message||"Terjadi kesalahan saat menyimpan data",D.value=!0}finally{z.value=!1}}},Z=()=>{k.value=!1};return H(()=>m.modelValue,s=>{s&&(m.mode==="edit"&&m.discount?W():re())}),H(()=>n.value.code,s=>{s&&Q()}),H(()=>n.value.valid_from,()=>{(_.value.valid_from||_.value.valid_until)&&(_.value={},D.value=!1)}),H(()=>n.value.valid_until,()=>{(_.value.valid_from||_.value.valid_until)&&(_.value={},D.value=!1)}),ge(()=>{m.modelValue&&m.mode==="edit"&&m.discount&&W()}),(s,l)=>(g(),I(xe,{modelValue:k.value,"onUpdate:modelValue":l[16]||(l[16]=c=>k.value=c),"max-width":"800px",persistent:"",scrollable:""},{default:a(()=>[e(O,null,{default:a(()=>[e(ke,{class:"d-flex align-center justify-space-between bg-primary text-white"},{default:a(()=>[t("div",Ie,[e(X,{icon:"mdi-tag-outline",size:"24",class:"me-2"}),t("span",null,f(q.value),1)]),e(C,{icon:"mdi-close",variant:"text",color:"white",onClick:Z})]),_:1}),e(Be,{ref_key:"formRef",ref:w,modelValue:S.value,"onUpdate:modelValue":l[15]||(l[15]=c=>S.value=c),onSubmit:Te(me,["prevent"])},{default:a(()=>[e(J,{class:"pa-6"},{default:a(()=>[D.value?(g(),I(Ue,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:"","onClick:close":l[0]||(l[0]=c=>D.value=!1)},{default:a(()=>[t("div",Le,f(B.value),1),Object.keys(_.value).length>0?(g(),$("div",Fe,[(g(!0),$(fe,null,_e(_.value,(c,p)=>(g(),$("div",{key:p,class:"mb-1"},[t("strong",null,f(p==="valid_until"?"Tanggal Berakhir":p==="valid_from"?"Tanggal Mulai":p)+":",1),t("ul",Ke,[(g(!0),$(fe,null,_e(c,r=>(g(),$("li",{key:r,class:"text-caption"},f(r),1))),128))])]))),128))])):L("",!0)]),_:1})):L("",!0),e(j,null,{default:a(()=>[e(v,{cols:"12"},{default:a(()=>l[17]||(l[17]=[t("h6",{class:"text-h6 mb-4"},"Informasi Dasar",-1)])),_:1,__:[17]}),e(v,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:n.value.name,"onUpdate:modelValue":l[1]||(l[1]=c=>n.value.name=c),label:"Nama Diskon",rules:R,variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:n.value.code,"onUpdate:modelValue":l[2]||(l[2]=c=>n.value.code=c),label:"Kode Diskon",rules:ae,variant:"outlined",required:"",onBlur:Q},{"append-inner":a(()=>[e(C,{icon:"mdi-dice-multiple",size:"small",variant:"text",onClick:ne})]),_:1},8,["modelValue"]),x.value.loading?(g(),$("div",Me,[e(X,{icon:"mdi-loading",size:"14",class:"spin me-1"}),l[18]||(l[18]=V(" Mengecek ketersediaan kode... "))])):x.value.available===!1?(g(),$("div",ze,[e(X,{icon:"mdi-alert",size:"14",class:"me-1"}),l[19]||(l[19]=V(" Kode sudah digunakan "))])):x.value.available===!0?(g(),$("div",Ne,[e(X,{icon:"mdi-check",size:"14",class:"me-1"}),l[20]||(l[20]=V(" Kode tersedia "))])):L("",!0)]),_:1}),e(v,{cols:"12"},{default:a(()=>[e(Pe,{modelValue:n.value.description,"onUpdate:modelValue":l[3]||(l[3]=c=>n.value.description=c),label:"Deskripsi",variant:"outlined",rows:"3","auto-grow":""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:a(()=>[e(ee,{class:"my-4"}),l[21]||(l[21]=t("h6",{class:"text-h6 mb-4"},"Konfigurasi Diskon",-1))]),_:1,__:[21]}),e(v,{cols:"12",md:"4"},{default:a(()=>[e(te,{modelValue:n.value.type,"onUpdate:modelValue":[l[4]||(l[4]=c=>n.value.type=c),de],items:U,label:"Tipe Diskon",rules:[c=>!!c||"Tipe diskon wajib dipilih"],variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12",md:"4"},{default:a(()=>[e(M,{modelValue:n.value.value,"onUpdate:modelValue":l[5]||(l[5]=c=>n.value.value=c),modelModifiers:{number:!0},label:ue(),rules:le.value,variant:"outlined",type:"number",prefix:n.value.type==="fixed_amount"?"Rp":void 0,suffix:n.value.type==="percentage"?"%":void 0,min:"0",required:""},null,8,["modelValue","label","rules","prefix","suffix"])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:F.value,"onUpdate:modelValue":l[6]||(l[6]=c=>F.value=c),label:"Minimum Pembelian",variant:"outlined",prefix:"Rp",hint:"Kosongkan jika tidak ada minimum",onInput:l[7]||(l[7]=c=>u(c.target.value))},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:K.value,"onUpdate:modelValue":l[8]||(l[8]=c=>K.value=c),label:"Maksimum Diskon",variant:"outlined",prefix:"Rp",hint:"Hanya untuk diskon persentase",disabled:n.value.type!=="percentage",onInput:l[9]||(l[9]=c=>o(c.target.value))},null,8,["modelValue","disabled"])]),_:1}),e(v,{cols:"12"},{default:a(()=>[e(ee,{class:"my-4"}),l[22]||(l[22]=t("h6",{class:"text-h6 mb-4"},"Batasan Penggunaan",-1))]),_:1,__:[22]}),e(v,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:n.value.usage_limit,"onUpdate:modelValue":l[10]||(l[10]=c=>n.value.usage_limit=c),modelModifiers:{number:!0},label:"Batas Total Penggunaan",variant:"outlined",type:"number",min:"1",hint:"Kosongkan untuk unlimited"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:n.value.usage_limit_per_customer,"onUpdate:modelValue":l[11]||(l[11]=c=>n.value.usage_limit_per_customer=c),modelModifiers:{number:!0},label:"Batas Per Pengguna",variant:"outlined",type:"number",min:"1",hint:"Kosongkan untuk unlimited"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:a(()=>[e(ee,{class:"my-4"}),l[23]||(l[23]=t("h6",{class:"text-h6 mb-4"},"Periode Berlaku",-1))]),_:1,__:[23]}),e(v,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:n.value.valid_from,"onUpdate:modelValue":l[12]||(l[12]=c=>n.value.valid_from=c),label:"Berlaku Dari",rules:se,variant:"outlined",type:"datetime-local",required:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:n.value.valid_until,"onUpdate:modelValue":l[13]||(l[13]=c=>n.value.valid_until=c),label:"Berlaku Sampai",rules:ie.value,variant:"outlined",type:"datetime-local",required:""},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12"},{default:a(()=>[e(ee,{class:"my-4"}),l[24]||(l[24]=t("h6",{class:"text-h6 mb-4"},"Status",-1))]),_:1,__:[24]}),e(v,{cols:"12"},{default:a(()=>[e(Ae,{modelValue:n.value.active,"onUpdate:modelValue":l[14]||(l[14]=c=>n.value.active=c),label:"Aktifkan diskon ini",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Ve,{class:"pa-6 pt-0"},{default:a(()=>[e(De),e(C,{variant:"outlined",onClick:Z},{default:a(()=>l[25]||(l[25]=[V(" Batal ")])),_:1,__:[25]}),e(C,{type:"submit",color:"primary",loading:z.value,disabled:!S.value||x.value.available===!1},{default:a(()=>[V(f(m.mode==="create"?"Simpan":"Update"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]))}}),Ee=be(je,[["__scopeId","data-v-ffa670a5"]]),qe={class:"d-flex align-center"},Oe={class:"mb-6"},Je={class:"mb-3"},Xe={class:"text-body-1 font-weight-medium"},He={class:"mb-3"},Ye={class:"mb-3"},Qe={class:"text-body-1"},We={class:"mb-6"},Ze={class:"mb-3"},Ge={class:"mb-3"},et={class:"text-body-1 font-weight-medium"},tt={class:"mb-3"},at={class:"text-body-1 font-weight-medium"},lt={class:"mb-3"},st={class:"text-body-1 font-weight-medium"},it={class:"mb-3"},ot={class:"text-body-1 font-weight-medium"},nt={class:"mb-3"},ut={class:"text-body-1 font-weight-medium"},dt={class:"mb-6"},rt={class:"mb-3"},mt={class:"text-body-1 font-weight-medium"},ct={key:0,class:"text-medium-emphasis"},vt={key:1,class:"text-medium-emphasis"},pt={class:"mb-3"},ft={class:"text-body-1 font-weight-medium"},_t={class:"mb-3"},gt={class:"text-caption text-medium-emphasis mt-1"},yt={class:"mb-6"},bt={class:"mb-3"},xt={class:"text-body-1 font-weight-medium"},kt={class:"mb-3"},Vt={class:"text-body-1 font-weight-medium"},Dt={class:"mb-3"},ht={class:"mb-6"},wt={class:"mb-3"},St={class:"mb-3"},Tt={class:"mb-3"},Ut={class:"text-body-2"},$t={class:"mb-3"},Ct={class:"text-body-2"},Bt=ve({__name:"DiscountViewDialog",props:{modelValue:{type:Boolean},discount:{}},emits:["update:modelValue"],setup(P,{emit:i}){const m=P,b=i,w=Y({get:()=>m.modelValue,set:u=>b("update:modelValue",u)}),S=Y(()=>{var u;return(u=m.discount)!=null&&u.usage_limit?m.discount.used_count/m.discount.usage_limit*100:0}),z=()=>{w.value=!1},_=u=>h.formatDiscountValue(u),D=u=>h.getDiscountTypeLabel(u),B=u=>({percentage:"primary",fixed_amount:"success",buy_x_get_y:"warning"})[u]||"secondary",x=u=>h.getStatusColor(u),n=u=>h.getStatusLabel(u),T=u=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(u),A=u=>new Date(u).toLocaleString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),F=()=>{if(!m.discount)return"";const u=new Date,U=new Date(m.discount.valid_until).getTime()-u.getTime();if(U<=0)return"Kadaluarsa";const k=Math.floor(U/(1e3*60*60*24)),q=Math.floor(U%(1e3*60*60*24)/(1e3*60*60)),R=Math.floor(U%(1e3*60*60)/(1e3*60));return k>0?`${k} hari ${q} jam`:q>0?`${q} jam ${R} menit`:R>0?`${R} menit`:"Kurang dari 1 menit"},K=()=>{if(!m.discount)return"secondary";const u=new Date,U=new Date(m.discount.valid_until).getTime()-u.getTime();if(U<=0)return"error";const k=Math.floor(U/(1e3*60*60*24));return k<=1?"error":k<=7?"warning":"success"};return(u,o)=>(g(),I(xe,{modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=U=>w.value=U),"max-width":"600px",scrollable:""},{default:a(()=>[u.discount?(g(),I(O,{key:0},{default:a(()=>[e(ke,{class:"d-flex align-center justify-space-between bg-primary text-white"},{default:a(()=>[t("div",qe,[e(X,{icon:"mdi-eye",size:"24",class:"me-2"}),o[1]||(o[1]=t("span",null,"Detail Diskon",-1))]),e(C,{icon:"mdi-close",variant:"text",color:"white",onClick:z})]),_:1}),e(J,{class:"pa-6"},{default:a(()=>[t("div",Oe,[o[5]||(o[5]=t("h6",{class:"text-h6 mb-4"},"Informasi Dasar",-1)),e(j,null,{default:a(()=>[e(v,{cols:"12",md:"6"},{default:a(()=>[t("div",Je,[o[2]||(o[2]=t("div",{class:"text-caption text-medium-emphasis"},"Nama Diskon",-1)),t("div",Xe,f(u.discount.name),1)])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[t("div",He,[o[3]||(o[3]=t("div",{class:"text-caption text-medium-emphasis"},"Kode Diskon",-1)),e(E,{color:"primary",variant:"tonal",size:"small"},{default:a(()=>[V(f(u.discount.code),1)]),_:1})])]),_:1}),u.discount.description?(g(),I(v,{key:0,cols:"12"},{default:a(()=>[t("div",Ye,[o[4]||(o[4]=t("div",{class:"text-caption text-medium-emphasis"},"Deskripsi",-1)),t("div",Qe,f(u.discount.description),1)])]),_:1})):L("",!0)]),_:1})]),t("div",We,[o[12]||(o[12]=t("h6",{class:"text-h6 mb-4"},"Konfigurasi Diskon",-1)),e(j,null,{default:a(()=>[e(v,{cols:"12",md:"6"},{default:a(()=>[t("div",Ze,[o[6]||(o[6]=t("div",{class:"text-caption text-medium-emphasis"},"Tipe Diskon",-1)),e(E,{color:B(u.discount.type),variant:"tonal",size:"small"},{default:a(()=>[V(f(D(u.discount.type)),1)]),_:1},8,["color"])])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[t("div",Ge,[o[7]||(o[7]=t("div",{class:"text-caption text-medium-emphasis"},"Nilai Diskon",-1)),t("div",et,f(_(u.discount)),1)])]),_:1}),u.discount.type==="buy_x_get_y"?(g(),I(v,{key:0,cols:"12",md:"6"},{default:a(()=>[t("div",tt,[o[8]||(o[8]=t("div",{class:"text-caption text-medium-emphasis"},"Beli Quantity",-1)),t("div",at,f(u.discount.buy_quantity),1)])]),_:1})):L("",!0),u.discount.type==="buy_x_get_y"?(g(),I(v,{key:1,cols:"12",md:"6"},{default:a(()=>[t("div",lt,[o[9]||(o[9]=t("div",{class:"text-caption text-medium-emphasis"},"Dapat Quantity",-1)),t("div",st,f(u.discount.get_quantity),1)])]),_:1})):L("",!0),u.discount.minimum_amount?(g(),I(v,{key:2,cols:"12",md:"6"},{default:a(()=>[t("div",it,[o[10]||(o[10]=t("div",{class:"text-caption text-medium-emphasis"},"Minimum Pembelian",-1)),t("div",ot,f(T(u.discount.minimum_amount)),1)])]),_:1})):L("",!0),u.discount.maximum_discount_amount?(g(),I(v,{key:3,cols:"12",md:"6"},{default:a(()=>[t("div",nt,[o[11]||(o[11]=t("div",{class:"text-caption text-medium-emphasis"},"Maksimum Diskon",-1)),t("div",ut,f(T(u.discount.maximum_discount_amount)),1)])]),_:1})):L("",!0)]),_:1})]),t("div",dt,[o[16]||(o[16]=t("h6",{class:"text-h6 mb-4"},"Informasi Penggunaan",-1)),e(j,null,{default:a(()=>[e(v,{cols:"12",md:"6"},{default:a(()=>[t("div",rt,[o[13]||(o[13]=t("div",{class:"text-caption text-medium-emphasis"},"Total Digunakan",-1)),t("div",mt,[V(f(u.discount.used_count||0)+" ",1),u.discount.usage_limit?(g(),$("span",ct," / "+f(u.discount.usage_limit),1)):(g(),$("span",vt," / Unlimited "))])])]),_:1}),u.discount.usage_limit_per_user?(g(),I(v,{key:0,cols:"12",md:"6"},{default:a(()=>[t("div",pt,[o[14]||(o[14]=t("div",{class:"text-caption text-medium-emphasis"},"Batas Per Pengguna",-1)),t("div",ft,f(u.discount.usage_limit_per_user),1)])]),_:1})):L("",!0),u.discount.usage_limit?(g(),I(v,{key:1,cols:"12",md:"6"},{default:a(()=>[t("div",_t,[o[15]||(o[15]=t("div",{class:"text-caption text-medium-emphasis"},"Progress Penggunaan",-1)),e($e,{"model-value":S.value,color:S.value>=90?"error":S.value>=70?"warning":"success",height:"8",rounded:"",class:"mt-2"},null,8,["model-value","color"]),t("div",gt,f(S.value.toFixed(1))+"% terpakai ",1)])]),_:1})):L("",!0)]),_:1})]),t("div",yt,[o[20]||(o[20]=t("h6",{class:"text-h6 mb-4"},"Periode Berlaku",-1)),e(j,null,{default:a(()=>[e(v,{cols:"12",md:"6"},{default:a(()=>[t("div",bt,[o[17]||(o[17]=t("div",{class:"text-caption text-medium-emphasis"},"Berlaku Dari",-1)),t("div",xt,f(A(u.discount.valid_from)),1)])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[t("div",kt,[o[18]||(o[18]=t("div",{class:"text-caption text-medium-emphasis"},"Berlaku Sampai",-1)),t("div",Vt,f(A(u.discount.valid_until)),1)])]),_:1}),e(v,{cols:"12"},{default:a(()=>[t("div",Dt,[o[19]||(o[19]=t("div",{class:"text-caption text-medium-emphasis"},"Sisa Waktu",-1)),e(E,{color:K(),variant:"tonal",size:"small"},{default:a(()=>[e(X,{icon:"mdi-clock-outline",size:"16",class:"me-1"}),V(" "+f(F()),1)]),_:1},8,["color"])])]),_:1})]),_:1})]),t("div",ht,[o[23]||(o[23]=t("h6",{class:"text-h6 mb-4"},"Status",-1)),e(j,null,{default:a(()=>[e(v,{cols:"12",md:"6"},{default:a(()=>[t("div",wt,[o[21]||(o[21]=t("div",{class:"text-caption text-medium-emphasis"},"Status Aktif",-1)),e(E,{color:u.discount.active?"success":"error",variant:"tonal",size:"small"},{default:a(()=>[e(X,{icon:u.discount.active?"mdi-check":"mdi-close",size:"16",class:"me-1"},null,8,["icon"]),V(" "+f(u.discount.active?"Aktif":"Tidak Aktif"),1)]),_:1},8,["color"])])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[t("div",St,[o[22]||(o[22]=t("div",{class:"text-caption text-medium-emphasis"},"Status Berlaku",-1)),e(E,{color:x(u.discount.status),variant:"tonal",size:"small"},{default:a(()=>[V(f(n(u.discount.status)),1)]),_:1},8,["color"])])]),_:1})]),_:1})]),t("div",null,[o[26]||(o[26]=t("h6",{class:"text-h6 mb-4"},"Informasi Sistem",-1)),e(j,null,{default:a(()=>[e(v,{cols:"12",md:"6"},{default:a(()=>[t("div",Tt,[o[24]||(o[24]=t("div",{class:"text-caption text-medium-emphasis"},"Dibuat Pada",-1)),t("div",Ut,f(A(u.discount.created_at)),1)])]),_:1}),e(v,{cols:"12",md:"6"},{default:a(()=>[t("div",$t,[o[25]||(o[25]=t("div",{class:"text-caption text-medium-emphasis"},"Terakhir Diupdate",-1)),t("div",Ct,f(A(u.discount.updated_at)),1)])]),_:1})]),_:1})])]),_:1}),e(Ve,{class:"pa-6 pt-0"},{default:a(()=>[e(De),e(C,{variant:"outlined",onClick:z},{default:a(()=>o[27]||(o[27]=[V(" Tutup ")])),_:1,__:[27]})]),_:1})]),_:1})):L("",!0)]),_:1},8,["modelValue"]))}}),Pt={class:"discount-management"},At={class:"d-flex justify-space-between align-center mb-6"},Rt={class:"d-flex gap-3 align-center"},It={class:"text-h3 font-weight-bold"},Lt={class:"text-h3 font-weight-bold"},Ft={class:"text-h3 font-weight-bold"},Kt={class:"text-h3 font-weight-bold"},Mt={class:"d-flex align-center"},zt={class:"font-weight-medium"},Nt={class:"text-center"},jt={class:"font-weight-medium"},Et={key:0,class:"text-caption text-medium-emphasis"},qt={key:1,class:"text-caption text-medium-emphasis"},Ot={class:"text-sm"},Jt={class:"text-medium-emphasis"},Xt={class:"d-flex align-center gap-2"},Ht=ve({__name:"discounts-management",setup(P){const i=y([]),m=y(!1),b=y(null),w=y(1),S=y(15),z=y(0),_=y({search:"",type:"all",status:"all",sort_by:"created_at",sort_order:"desc"}),D=y(!1),B=y(!1),x=y(!1),n=y(null),T=y("create"),A=y(!1),F=[{title:"Semua Tipe",value:"all"},{title:"Persentase",value:"percentage"},{title:"Jumlah Tetap",value:"fixed_amount"},{title:"Beli X Dapat Y",value:"buy_x_get_y"}],K=[{title:"Semua Status",value:"all"},{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"},{title:"Kadaluarsa",value:"expired"},{title:"Terjadwal",value:"scheduled"}],u=[{title:"Tanggal Dibuat",value:"created_at"},{title:"Nama",value:"name"},{title:"Kode",value:"code"},{title:"Nilai",value:"value"},{title:"Penggunaan",value:"used_count"},{title:"Tanggal Berlaku",value:"valid_from"}],o=[{title:"Kode",key:"code",sortable:!1},{title:"Nama",key:"name",sortable:!0},{title:"Tipe",key:"type",sortable:!1},{title:"Nilai",key:"value",sortable:!0},{title:"Penggunaan",key:"usage",sortable:!1},{title:"Periode Berlaku",key:"valid_period",sortable:!1},{title:"Status",key:"status",sortable:!1},{title:"Aksi",key:"actions",sortable:!1,align:"center"}],U=ye(()=>{w.value=1,k()},500),k=async()=>{try{m.value=!0;const p={search:_.value.search||void 0,type:_.value.type==="all"?void 0:_.value.type,status:_.value.status==="all"?void 0:_.value.status,sort_by:_.value.sort_by||"created_at",sort_order:"desc",page:w.value,per_page:S.value},r=await h.getDiscounts(p);i.value=r.data,z.value=r.total}catch(p){console.error("Failed to fetch discounts:",p)}finally{m.value=!1}},q=async()=>{try{b.value=await h.getStats()}catch(p){console.error("Failed to fetch discount stats:",p)}},R=async()=>{await Promise.all([k(),q()])},ae=p=>{w.value=p.page,S.value=p.itemsPerPage,k()},le=()=>{n.value=null,T.value="create",D.value=!0},se=p=>{n.value=p,B.value=!0},ie=p=>{n.value=p,T.value="edit",D.value=!0},oe=async p=>{try{await h.duplicate(p.id_discount),await R()}catch(r){console.error("Failed to duplicate discount:",r)}},Q=async p=>{try{await h.toggleStatus(p.id_discount),await k()}catch(r){console.error("Failed to toggle discount status:",r)}},ne=p=>{n.value=p,x.value=!0},ue=async()=>{if(n.value)try{A.value=!0,await h.deleteDiscount(n.value.id_discount),await R(),x.value=!1}catch(p){console.error("Failed to delete discount:",p)}finally{A.value=!1}},de=()=>{n.value=null,x.value=!1},re=()=>{D.value=!1,R()},W=p=>h.formatDiscountValue(p),me=p=>h.getDiscountTypeLabel(p),Z=p=>({percentage:"primary",fixed_amount:"success",buy_x_get_y:"warning"})[p]||"secondary",s=p=>h.getStatusColor(p||"inactive"),l=p=>h.getStatusLabel(p||"inactive"),c=p=>new Date(p).toLocaleDateString("id-ID");return ge(()=>{R()}),(p,r)=>{var ce;return g(),$("div",Pt,[t("div",At,[r[11]||(r[11]=t("div",null,[t("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Diskon"),t("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola kode diskon dan potongan harga untuk coffee shop Anda")],-1)),t("div",Rt,[e(C,{color:"primary","prepend-icon":"mdi-plus",onClick:le},{default:a(()=>r[10]||(r[10]=[V(" Tambah Diskon ")])),_:1,__:[10]})])]),e(j,{class:"mb-6"},{default:a(()=>[e(v,{cols:"12",md:"3"},{default:a(()=>[e(O,{color:"primary",variant:"tonal"},{default:a(()=>[e(J,{class:"text-center"},{default:a(()=>{var d;return[t("div",It,f(((d=b.value)==null?void 0:d.total_discounts)||0),1),r[12]||(r[12]=t("div",{class:"text-body-2 text-medium-emphasis"},"Total Diskon",-1))]}),_:1,__:[12]})]),_:1})]),_:1}),e(v,{cols:"12",md:"3"},{default:a(()=>[e(O,{color:"success",variant:"tonal"},{default:a(()=>[e(J,{class:"text-center"},{default:a(()=>{var d;return[t("div",Lt,f(((d=b.value)==null?void 0:d.active_discounts)||0),1),r[13]||(r[13]=t("div",{class:"text-body-2 text-medium-emphasis"},"Aktif",-1))]}),_:1,__:[13]})]),_:1})]),_:1}),e(v,{cols:"12",md:"3"},{default:a(()=>[e(O,{color:"warning",variant:"tonal"},{default:a(()=>[e(J,{class:"text-center"},{default:a(()=>{var d;return[t("div",Ft,f(((d=b.value)==null?void 0:d.total_usage)||0),1),r[14]||(r[14]=t("div",{class:"text-body-2 text-medium-emphasis"},"Terpakai",-1))]}),_:1,__:[14]})]),_:1})]),_:1}),e(v,{cols:"12",md:"3"},{default:a(()=>[e(O,{color:"error",variant:"tonal"},{default:a(()=>[e(J,{class:"text-center"},{default:a(()=>{var d;return[t("div",Kt,f(((d=b.value)==null?void 0:d.expired_discounts)||0),1),r[15]||(r[15]=t("div",{class:"text-body-2 text-medium-emphasis"},"Kedaluwarsa",-1))]}),_:1,__:[15]})]),_:1})]),_:1})]),_:1}),e(O,null,{default:a(()=>[e(J,null,{default:a(()=>[e(j,{class:"mb-4"},{default:a(()=>[e(v,{cols:"12",md:"4"},{default:a(()=>[e(M,{modelValue:_.value.search,"onUpdate:modelValue":r[0]||(r[0]=d=>_.value.search=d),label:"Cari diskon...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:Ce(U),"onClick:clear":r[1]||(r[1]=d=>{_.value.search="",k()})},null,8,["modelValue","onInput"])]),_:1}),e(v,{cols:"12",md:"2"},{default:a(()=>[e(te,{modelValue:_.value.type,"onUpdate:modelValue":[r[2]||(r[2]=d=>_.value.type=d),k],items:F,label:"Tipe",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"2"},{default:a(()=>[e(te,{modelValue:_.value.status,"onUpdate:modelValue":[r[3]||(r[3]=d=>_.value.status=d),k],items:K,label:"Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"2"},{default:a(()=>[e(te,{modelValue:_.value.sort_by,"onUpdate:modelValue":[r[4]||(r[4]=d=>_.value.sort_by=d),k],items:u,label:"Urutkan",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"2",class:"d-flex align-center"},{default:a(()=>[e(C,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:R},{default:a(()=>r[16]||(r[16]=[V(" Refresh ")])),_:1,__:[16]})]),_:1})]),_:1}),e(Re,{"items-per-page":S.value,"onUpdate:itemsPerPage":r[5]||(r[5]=d=>S.value=d),page:w.value,"onUpdate:page":r[6]||(r[6]=d=>w.value=d),headers:o,items:i.value,"items-length":z.value,loading:m.value,class:"discount-table","onUpdate:options":ae},{"item.code":a(({item:d})=>[t("div",Mt,[e(E,{size:"small",color:"primary",variant:"tonal"},{default:a(()=>[V(f(d.code),1)]),_:2},1024)])]),"item.type":a(({item:d})=>[e(E,{size:"small",color:Z(d.type),variant:"tonal"},{default:a(()=>[V(f(me(d.type)),1)]),_:2},1032,["color"])]),"item.value":a(({item:d})=>[t("span",zt,f(W(d)),1)]),"item.usage":a(({item:d})=>[t("div",Nt,[t("div",jt,f(d.used_count),1),d.usage_limit?(g(),$("div",Et," / "+f(d.usage_limit),1)):(g(),$("div",qt," Unlimited "))])]),"item.valid_period":a(({item:d})=>[t("div",Ot,[t("div",null,f(c(d.valid_from)),1),t("div",Jt,f(c(d.valid_until)),1)])]),"item.status":a(({item:d})=>[e(E,{size:"small",color:s(d.status),variant:"tonal"},{default:a(()=>[V(f(l(d.status)),1)]),_:2},1032,["color"])]),"item.actions":a(({item:d})=>[t("div",Xt,[e(C,{icon:"mdi-eye",size:"small",variant:"text",onClick:G=>se(d)},null,8,["onClick"]),e(C,{icon:"mdi-pencil",size:"small",variant:"text",onClick:G=>ie(d)},null,8,["onClick"]),e(C,{icon:d.active?"mdi-pause":"mdi-play",size:"small",variant:"text",onClick:G=>Q(d)},null,8,["icon","onClick"]),e(C,{icon:"mdi-content-copy",size:"small",variant:"text",onClick:G=>oe(d)},null,8,["onClick"]),e(C,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:G=>ne(d)},null,8,["onClick"])])]),_:1},8,["items-per-page","page","items","items-length","loading"])]),_:1})]),_:1}),e(Ee,{modelValue:D.value,"onUpdate:modelValue":r[7]||(r[7]=d=>D.value=d),discount:n.value,mode:T.value,onSaved:re},null,8,["modelValue","discount","mode"]),e(Bt,{modelValue:B.value,"onUpdate:modelValue":r[8]||(r[8]=d=>B.value=d),discount:n.value},null,8,["modelValue","discount"]),e(Se,{modelValue:x.value,"onUpdate:modelValue":r[9]||(r[9]=d=>x.value=d),loading:A.value,"item-name":((ce=n.value)==null?void 0:ce.name)||"",title:"Konfirmasi Hapus Diskon",onConfirm:ue,onCancel:de},null,8,["modelValue","loading","item-name"])])}}}),Va=be(Ht,[["__scopeId","data-v-0232adf6"]]);export{Va as default};
