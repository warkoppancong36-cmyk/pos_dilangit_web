import{u as Q,H as ie}from"./HPPBreakdownDialog-BvKgS4U3.js";import{V as w,b as T,c as de}from"./VCard-CarlQF4f.js";import{d as K,r as S,D as te,g as $,f as t,b as e,e as a,X as D,a0 as k,m as l,s as u,l as U,t as o,at as ae,o as h,V as j,w as Y,v as X,c as q,F as le,i as oe,aq as ue,aT as ce,p as Z}from"./main-DcOxu_iY.js";import{V as I,a as f}from"./VRow-B8LfeWfS.js";import{V as z}from"./VCardText-ZbrtLebs.js";import{V as E}from"./VSelect-Db2YqPW8.js";import{V as L}from"./VChip-lx0Dd1Uw.js";import{V as J,a as pe}from"./VDataTable-Dj0xYjd9.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as se}from"./VDivider-5s4PHN83.js";import{V as me}from"./VSpacer-cna5IU0U.js";import{V as ve}from"./VDialog-CtHBFQfr.js";import{V as ee}from"./VMenu-it0dmSHg.js";import{V as _e,c as fe,a as ge,b as he,d as Pe}from"./VList-D3qaeDoM.js";import{V as re}from"./VTextField-BH8ElYDD.js";import"./api-BRWSBtFm.js";import"./index-D-EbNoF1.js";import"./VSnackbar-hMdzifwU.js";import"./VOverlay-yRNL_Cmy.js";import"./forwardRefs-B931MWyl.js";import"./VImg-B8cqB_Zg.js";import"./VAlert-CCf-MFc-.js";import"./VAvatar-CbTt8RiM.js";/* empty css              */import"./VCheckboxBtn-PzFViS6h.js";import"./VTable-DcuHuBFr.js";import"./filter-CynBo2Pf.js";const be={class:"d-flex align-center gap-3"},xe={class:"text-h4 font-weight-bold"},ye={class:"text-h4 font-weight-bold"},ke={class:"text-h4 font-weight-bold"},Ce={class:"text-h4 font-weight-bold"},Ve={class:"text-h6 font-weight-bold text-primary"},we={class:"text-h6 font-weight-bold text-success"},He={class:"text-h6 font-weight-bold text-error"},$e={class:"text-grey-darken-1"},Me={class:"font-weight-bold text-primary"},De={class:"text-caption"},ze=K({__name:"HPPDashboard",setup(O){const{loading:A,hppDashboard:p,bulkUpdateResults:C,hasDashboardData:V,getHPPDashboard:P,bulkUpdateHPP:M,formatCurrency:m}=Q(),B=S("latest"),H=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],b=[{title:"Product",value:"product_name",sortable:!0},{title:"Old Cost",value:"old_cost",align:"end"},{title:"New Cost",value:"new_cost",align:"end"},{title:"Difference",value:"difference",align:"center"},{title:"Updated",value:"updated_at",sortable:!0}],x=async()=>{await P()},N=async()=>{await M(B.value),await x()};return te(()=>{x()}),(R,s)=>(h(),$(w,null,{default:t(()=>[e(T,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",be,[e(D,{icon:"mdi-calculator-variant",size:"24"}),s[1]||(s[1]=a("span",null,"HPP Management Dashboard",-1))]),e(k,{color:"primary",variant:"elevated",onClick:x,loading:l(A),"prepend-icon":"mdi-refresh"},{default:t(()=>s[2]||(s[2]=[u(" Refresh Data ")])),_:1,__:[2]},8,["loading"])]),_:1}),e(z,null,{default:t(()=>[l(V)?(h(),$(I,{key:0,class:"mb-6"},{default:t(()=>[e(f,{cols:"12",md:"3"},{default:t(()=>[e(w,{color:"primary",variant:"tonal",class:"h-100"},{default:t(()=>[e(z,{class:"text-center"},{default:t(()=>[e(D,{icon:"mdi-package-variant",size:"48",class:"mb-2"}),a("div",xe,o(l(p).total_products),1),s[3]||(s[3]=a("div",{class:"text-subtitle-1"},"Total Products",-1))]),_:1,__:[3]})]),_:1})]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[e(w,{color:"success",variant:"tonal",class:"h-100"},{default:t(()=>[e(z,{class:"text-center"},{default:t(()=>[e(D,{icon:"mdi-check-circle",size:"48",class:"mb-2"}),a("div",ye,o(l(p).products_with_items),1),s[4]||(s[4]=a("div",{class:"text-subtitle-1"},"With HPP Data",-1))]),_:1,__:[4]})]),_:1})]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[e(w,{color:"warning",variant:"tonal",class:"h-100"},{default:t(()=>[e(z,{class:"text-center"},{default:t(()=>[e(D,{icon:"mdi-alert-circle",size:"48",class:"mb-2"}),a("div",ke,o(l(p).products_without_items),1),s[5]||(s[5]=a("div",{class:"text-subtitle-1"},"Missing HPP Data",-1))]),_:1,__:[5]})]),_:1})]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[e(w,{color:"info",variant:"tonal",class:"h-100"},{default:t(()=>[e(z,{class:"text-center"},{default:t(()=>{var v;return[e(D,{icon:"mdi-trending-up",size:"48",class:"mb-2"}),a("div",Ce,o(l(m)(((v=l(p).hpp_statistics)==null?void 0:v.average_margin)||0)),1),s[6]||(s[6]=a("div",{class:"text-subtitle-1"},"Average Margin",-1))]}),_:1,__:[6]})]),_:1})]),_:1})]),_:1})):U("",!0),l(V)&&l(p).hpp_statistics?(h(),$(I,{key:1,class:"mb-6"},{default:t(()=>[e(f,{cols:"12"},{default:t(()=>[e(w,null,{default:t(()=>[e(T,null,{default:t(()=>[e(D,{icon:"mdi-chart-line",class:"me-2"}),s[7]||(s[7]=u(" HPP Statistics "))]),_:1,__:[7]}),e(z,null,{default:t(()=>[e(I,null,{default:t(()=>[e(f,{cols:"12",md:"4"},{default:t(()=>[s[8]||(s[8]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Average HPP",-1)),a("div",Ve,o(l(m)(l(p).hpp_statistics.average_hpp)),1)]),_:1,__:[8]}),e(f,{cols:"12",md:"4"},{default:t(()=>[s[9]||(s[9]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Min HPP",-1)),a("div",we,o(l(m)(l(p).hpp_statistics.min_hpp)),1)]),_:1,__:[9]}),e(f,{cols:"12",md:"4"},{default:t(()=>[s[10]||(s[10]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Max HPP",-1)),a("div",He,o(l(m)(l(p).hpp_statistics.max_hpp)),1)]),_:1,__:[10]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):U("",!0),e(I,{class:"mb-6"},{default:t(()=>[e(f,{cols:"12"},{default:t(()=>[e(w,null,{default:t(()=>[e(T,null,{default:t(()=>[e(D,{icon:"mdi-update",class:"me-2"}),s[11]||(s[11]=u(" Bulk HPP Operations "))]),_:1,__:[11]}),e(z,null,{default:t(()=>[e(I,{align:"center"},{default:t(()=>[e(f,{cols:"12",md:"4"},{default:t(()=>[e(E,{modelValue:B.value,"onUpdate:modelValue":s[0]||(s[0]=v=>B.value=v),items:H,label:"HPP Calculation Method",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"4"},{default:t(()=>[e(k,{color:"primary",variant:"elevated",loading:l(A),onClick:N,"prepend-icon":"mdi-update",block:""},{default:t(()=>s[12]||(s[12]=[u(" Bulk Update All Products ")])),_:1,__:[12]},8,["loading"])]),_:1}),e(f,{cols:"12",md:"4"},{default:t(()=>[l(C).length>0?(h(),$(L,{key:0,color:"success",variant:"elevated","prepend-icon":"mdi-check"},{default:t(()=>[u(o(l(C).length)+" products updated ",1)]),_:1})):U("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(C).length>0?(h(),$(I,{key:2},{default:t(()=>[e(f,{cols:"12"},{default:t(()=>[e(w,null,{default:t(()=>[e(T,null,{default:t(()=>[e(D,{icon:"mdi-file-document-multiple",class:"me-2"}),u(" Bulk Update Results ("+o(l(C).length)+" products) ",1)]),_:1}),e(z,null,{default:t(()=>[e(J,{headers:b,items:l(C),"items-per-page":10,class:"elevation-1"},{"item.old_cost":t(({item:v})=>[a("span",$e,o(l(m)(v.old_cost)),1)]),"item.new_cost":t(({item:v})=>[a("span",Me,o(l(m)(v.new_cost)),1)]),"item.difference":t(({item:v})=>[e(L,{color:v.difference>0?"error":v.difference<0?"success":"grey",variant:"tonal",size:"small"},{default:t(()=>[u(o(v.difference>0?"+":"")+o(l(m)(v.difference)),1)]),_:2},1032,["color"])]),"item.updated_at":t(({item:v})=>[a("span",De,o(new Date(v.updated_at).toLocaleString()),1)]),_:1},8,["items"])]),_:1})]),_:1})]),_:1})]),_:1})):U("",!0),l(A)&&!l(V)?(h(),$(I,{key:3},{default:t(()=>[e(f,{cols:"12",class:"text-center py-12"},{default:t(()=>[e(ae,{indeterminate:"",size:"64"}),s[13]||(s[13]=a("div",{class:"mt-4 text-h6"},"Loading HPP Dashboard...",-1))]),_:1,__:[13]})]),_:1})):U("",!0),!l(A)&&!l(V)?(h(),$(I,{key:4},{default:t(()=>[e(f,{cols:"12",class:"text-center py-12"},{default:t(()=>[e(D,{icon:"mdi-chart-line",size:"64",class:"text-grey-lighten-1 mb-4"}),s[15]||(s[15]=a("div",{class:"text-h6 text-grey-darken-1 mb-2"},"No HPP Data Available",-1)),s[16]||(s[16]=a("div",{class:"text-body-2 text-grey-darken-1 mb-4"},' Click "Refresh Data" to load HPP dashboard information ',-1)),e(k,{color:"primary",variant:"elevated",onClick:x,"prepend-icon":"mdi-refresh"},{default:t(()=>s[14]||(s[14]=[u(" Load Dashboard ")])),_:1,__:[14]})]),_:1,__:[15,16]})]),_:1})):U("",!0)]),_:1})]),_:1}))}}),Ue=W(ze,[["__scopeId","data-v-3833158f"]]),Se={class:"d-flex align-center gap-3"},Ae={class:"text-center"},Be={class:"text-h5 font-weight-bold text-primary"},Ie={class:"text-center"},Le={class:"text-h5 font-weight-bold text-info"},Re={class:"text-center"},Te={class:"text-center"},Ne={class:"mb-4"},Fe={class:"text-h4 font-weight-bold"},je={class:"mb-4"},Oe={class:"mb-4"},Ge={class:"text-h6"},qe={class:"d-flex flex-column"},Ee={class:"font-weight-medium"},Qe={class:"text-caption text-grey-darken-1"},Ke={class:"font-weight-medium"},We={class:"text-end"},Xe={class:"text-caption mt-1"},Je={class:"v-data-table__footer"},Ye={class:"pa-4 d-flex justify-space-between align-center"},Ze={class:"text-subtitle-1 font-weight-bold"},et={class:"d-flex gap-2"},tt=K({__name:"HPPComparisonDialog",props:{modelValue:{type:Boolean},productId:{},productName:{default:""}},emits:["update:modelValue","hpp-updated"],setup(O,{emit:A}){const p=O,C=A,{loading:V,currentHPPComparison:P,hasComparisonData:M,compareHPPMethods:m,updateProductHPP:B,formatCurrency:H}=Q(),b=S("latest_purchase"),x={current:{title:"Current Cost",icon:"mdi-database",color:"primary"},latest_purchase:{title:"Latest Purchase",icon:"mdi-clock-outline",color:"success"},average_purchase:{title:"Average Purchase",icon:"mdi-chart-line",color:"warning"}},N=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Contribution",value:"percentage",align:"end"}],R=j(()=>M.value?P.value.current_price-P.value.current_cost:0),s=j(()=>!M.value||P.value.current_cost===0?0:R.value/P.value.current_cost*100),v=j(()=>M.value?P.value.breakdown[b.value]:null),F=async()=>{p.productId&&await m(p.productId)},G=g=>{b.value=g},_=async()=>{if(!p.productId)return;const g=b.value==="latest_purchase"?"latest":b.value==="average_purchase"?"average":"current";await B(p.productId,g),C("hpp-updated"),await F()},r=g=>g>0?"error":g<0?"success":"grey",i=g=>`${g>0?"+":""}${H(g)}`;return Y(()=>p.modelValue,g=>{g&&p.productId&&F()}),Y(()=>p.productId,g=>{g&&p.modelValue&&F()}),(g,d)=>(h(),$(ve,{"model-value":g.modelValue,"onUpdate:modelValue":d[2]||(d[2]=n=>g.$emit("update:modelValue",n)),"max-width":"1400",scrollable:""},{default:t(()=>[e(w,null,{default:t(()=>[e(T,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",Se,[e(D,{icon:"mdi-compare",size:"24"}),a("span",null,"HPP Methods Comparison - "+o(g.productName||"Product"),1)]),e(k,{icon:"mdi-close",size:"small",variant:"text",onClick:d[0]||(d[0]=n=>g.$emit("update:modelValue",!1))})]),_:1}),e(z,null,{default:t(()=>[l(M)?(h(),$(w,{key:0,variant:"outlined",class:"mb-4"},{default:t(()=>[e(T,null,{default:t(()=>[e(D,{icon:"mdi-chart-bar",class:"me-2"}),d[3]||(d[3]=u(" HPP Comparison Summary "))]),_:1,__:[3]}),e(z,null,{default:t(()=>[e(I,null,{default:t(()=>[e(f,{cols:"12",md:"3"},{default:t(()=>[a("div",Ae,[d[4]||(d[4]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Current Price",-1)),a("div",Be,o(l(H)(l(P).current_price)),1)])]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[a("div",Ie,[d[5]||(d[5]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Current Cost",-1)),a("div",Le,o(l(H)(l(P).current_cost)),1)])]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[a("div",Re,[d[6]||(d[6]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Current Margin",-1)),a("div",{class:X(["text-h5 font-weight-bold",R.value>=0?"text-success":"text-error"])},o(l(H)(R.value)),3)])]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[a("div",Te,[d[7]||(d[7]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Margin %",-1)),a("div",{class:X(["text-h5 font-weight-bold",s.value>=0?"text-success":"text-error"])},o(s.value.toFixed(1))+"% ",3)])]),_:1})]),_:1})]),_:1})]),_:1})):U("",!0),l(M)?(h(),$(I,{key:1},{default:t(()=>[(h(),q(le,null,oe(x,(n,c)=>e(f,{key:c,cols:"12",md:"4"},{default:t(()=>[e(w,{color:n.color,variant:"tonal",class:X(["h-100",{"v-card--selected":b.value===c}])},{default:t(()=>[e(T,{class:"d-flex justify-space-between align-center"},{default:t(()=>[a("div",null,[e(D,{icon:n.icon,class:"me-2"},null,8,["icon"]),u(" "+o(n.title),1)]),e(L,{color:n.color,variant:"elevated",size:"small"},{default:t(()=>[u(o(c.toUpperCase()),1)]),_:2},1032,["color"])]),_:2},1024),e(z,null,{default:t(()=>{var y;return[a("div",Ne,[d[8]||(d[8]=a("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"HPP Cost",-1)),a("div",Fe,o(l(H)(l(P).hpp_methods[c])),1)]),a("div",je,[d[9]||(d[9]=a("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"vs Current Cost",-1)),e(L,{color:r(l(P).hpp_methods[c]-l(P).current_cost),variant:"tonal",size:"small"},{default:t(()=>[u(o(i(l(P).hpp_methods[c]-l(P).current_cost)),1)]),_:2},1032,["color"])]),a("div",Oe,[d[10]||(d[10]=a("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"Items Count",-1)),a("div",Ge,o(((y=l(P).breakdown[c])==null?void 0:y.items.length)||0)+" items ",1)]),e(k,{color:n.color,variant:"elevated",block:"",onClick:ne=>G(c),"prepend-icon":b.value===c?"mdi-check":"mdi-eye"},{default:t(()=>[u(o(b.value===c?"Selected":"View Details"),1)]),_:2},1032,["color","onClick","prepend-icon"])]}),_:2},1024)]),_:2},1032,["color","class"])]),_:2},1024)),64))]),_:1})):U("",!0),l(M)&&v.value?(h(),$(w,{key:2,class:"mt-4"},{default:t(()=>[e(T,null,{default:t(()=>{var n;return[e(D,{icon:"mdi-format-list-bulleted",class:"me-2"}),u(" "+o((n=x[b.value])==null?void 0:n.title)+" - Detailed Breakdown ",1)]}),_:1}),e(J,{headers:N,items:v.value.items,"items-per-page":15,class:"elevation-0"},{"item.item_name":t(({item:n})=>[a("div",qe,[a("span",Ee,o(n.item_name),1),a("span",Qe,o(n.item_code),1)])]),"item.quantity_needed":t(({item:n})=>[a("span",Ke,o(Number(n.quantity_needed).toFixed(3))+" "+o(n.unit),1)]),"item.cost_per_unit":t(({item:n})=>[a("span",null,o(l(H)(n.cost_per_unit)),1)]),"item.total_cost":t(({item:n})=>[e(L,{color:n.is_critical?"error":"primary",variant:"tonal",size:"small"},{default:t(()=>[u(o(l(H)(n.total_cost)),1)]),_:2},1032,["color"])]),"item.percentage":t(({item:n})=>[a("div",We,[e(ue,{"model-value":n.total_cost/v.value.total_hpp*100,color:n.is_critical?"error":"primary",height:"4",rounded:""},null,8,["model-value","color"]),a("span",Xe,o((n.total_cost/v.value.total_hpp*100).toFixed(1))+"% ",1)])]),bottom:t(()=>{var n,c;return[a("div",Je,[e(se),a("div",Ye,[a("div",Ze," Total HPP ("+o((n=x[b.value])==null?void 0:n.title)+"): "+o(l(H)(v.value.total_hpp)),1),a("div",et,[e(L,{color:"info",variant:"elevated",size:"small"},{default:t(()=>[u(o(v.value.items.length)+" items ",1)]),_:1}),e(k,{color:(c=x[b.value])==null?void 0:c.color,variant:"elevated",size:"small",onClick:_,loading:l(V),"prepend-icon":"mdi-check"},{default:t(()=>d[11]||(d[11]=[u(" Apply This HPP ")])),_:1,__:[11]},8,["color","loading"])])])])]}),_:1},8,["items"])]),_:1})):U("",!0),l(V)&&!l(M)?(h(),$(w,{key:3},{default:t(()=>[e(z,{class:"text-center py-12"},{default:t(()=>[e(ae,{indeterminate:"",size:"64"}),d[12]||(d[12]=a("div",{class:"mt-4 text-h6"},"Loading HPP comparison...",-1))]),_:1,__:[12]})]),_:1})):U("",!0),!l(V)&&!l(M)?(h(),$(w,{key:4},{default:t(()=>[e(z,{class:"text-center py-12"},{default:t(()=>[e(D,{icon:"mdi-compare",size:"64",class:"text-grey-lighten-1 mb-4"}),d[14]||(d[14]=a("div",{class:"text-h6 text-grey-darken-1 mb-2"},"No Comparison Data Available",-1)),d[15]||(d[15]=a("div",{class:"text-body-2 text-grey-darken-1 mb-4"}," Unable to load HPP methods comparison for this product ",-1)),e(k,{color:"primary",variant:"elevated",onClick:F,"prepend-icon":"mdi-refresh"},{default:t(()=>d[13]||(d[13]=[u(" Try Again ")])),_:1,__:[13]})]),_:1,__:[14,15]})]),_:1})):U("",!0)]),_:1}),e(de,{class:"px-6 pb-6"},{default:t(()=>[e(me),e(k,{color:"grey-darken-1",variant:"text",onClick:d[1]||(d[1]=n=>g.$emit("update:modelValue",!1))},{default:t(()=>d[16]||(d[16]=[u(" Close ")])),_:1,__:[16]})]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),at=W(tt,[["__scopeId","data-v-4f8318c7"]]),lt={class:"hpp-actions"},ot={class:"d-flex align-center gap-2 mb-2"},st={class:"d-flex flex-column gap-2"},rt={key:0,class:"mt-2 text-center"},nt=K({__name:"HPPProductActions",props:{product:{}},emits:["hpp-updated","price-updated","product-updated"],setup(O,{emit:A}){const p=O,C=A,{loading:V,updateProductHPP:P,updatePriceFromHPP:M,formatCurrency:m}=Q(),B=S(!1),H=S(!1),b=S(30),x=S(0),N=[{title:"Current Cost",value:"current",icon:"mdi-database",description:"Use stored cost per unit"},{title:"Latest Purchase",value:"latest",icon:"mdi-clock-outline",description:"Use latest purchase prices"},{title:"Average Purchase",value:"average",icon:"mdi-chart-line",description:"Use average purchase prices"}],R=j(()=>(p.product.price||0)-(p.product.cost||0)),s=j(()=>!p.product.cost||p.product.cost===0?0:R.value/p.product.cost*100),v=j(()=>{const n=p.product.cost||0;return n===0?{color:"error",icon:"mdi-alert-circle",text:"No HPP"}:n>0&&s.value<10?{color:"warning",icon:"mdi-alert",text:"Low Margin"}:{color:"success",icon:"mdi-check-circle",text:"Good Margin"}}),F=()=>{B.value=!0},G=()=>{H.value=!0},_=async n=>{await P(p.product.id_product,n),g()},r=()=>{const n=p.product.cost||0;x.value=Math.round(n*(1+b.value/100))},i=async()=>{await M(p.product.id_product,"current",b.value,!1),d(),x.value=0},g=()=>{C("hpp-updated"),C("product-updated")},d=()=>{C("price-updated"),C("product-updated")};return(n,c)=>(h(),q("div",lt,[a("div",ot,[e(L,{color:v.value.color,"prepend-icon":v.value.icon,variant:"tonal",size:"small"},{default:t(()=>[u(" HPP: "+o(l(m)(n.product.cost||0)),1)]),_:1},8,["color","prepend-icon"]),n.product.price&&n.product.cost?(h(),$(L,{key:0,color:R.value>=0?"success":"error",variant:"tonal",size:"small"},{default:t(()=>[u(o(s.value.toFixed(1))+"% margin ",1)]),_:1},8,["color"])):U("",!0)]),e(ce,{variant:"tonal",density:"compact",class:"hpp-btn-group"},{default:t(()=>[e(k,{size:"small","prepend-icon":"mdi-calculator-variant",onClick:F,loading:l(V)},{default:t(()=>c[3]||(c[3]=[u(" HPP Detail ")])),_:1,__:[3]},8,["loading"]),e(k,{size:"small","prepend-icon":"mdi-compare",onClick:G,loading:l(V)},{default:t(()=>c[4]||(c[4]=[u(" Compare ")])),_:1,__:[4]},8,["loading"]),e(ee,null,{activator:t(({props:y})=>[e(k,Z({size:"small","prepend-icon":"mdi-update"},y,{loading:l(V)}),{default:t(()=>c[5]||(c[5]=[u(" Update HPP ")])),_:2,__:[5]},1040,["loading"])]),default:t(()=>[e(w,{"min-width":"250"},{default:t(()=>[e(_e,null,{default:t(()=>[e(fe,null,{default:t(()=>c[6]||(c[6]=[u("Update HPP Method")])),_:1,__:[6]}),(h(),q(le,null,oe(N,y=>e(ge,{key:y.value,onClick:ne=>_(y.value),"prepend-icon":y.icon},{default:t(()=>[e(he,null,{default:t(()=>[u(o(y.title),1)]),_:2},1024),e(Pe,null,{default:t(()=>[u(o(y.description),1)]),_:2},1024)]),_:2},1032,["onClick","prepend-icon"])),64))]),_:1})]),_:1})]),_:1}),e(ee,null,{activator:t(({props:y})=>[e(k,Z({size:"small","prepend-icon":"mdi-currency-usd"},y,{loading:l(V)}),{default:t(()=>c[7]||(c[7]=[u(" Price Tools ")])),_:2,__:[7]},1040,["loading"])]),default:t(()=>[e(w,{"min-width":"280"},{default:t(()=>[e(T,{class:"text-subtitle-1"},{default:t(()=>c[8]||(c[8]=[u("Price Calculator")])),_:1,__:[8]}),e(z,null,{default:t(()=>[e(re,{modelValue:b.value,"onUpdate:modelValue":c[0]||(c[0]=y=>b.value=y),modelModifiers:{number:!0},type:"number",label:"Markup %",variant:"outlined",density:"compact",suffix:"%",min:"0",max:"1000",class:"mb-3"},null,8,["modelValue"]),a("div",st,[e(k,{color:"info",variant:"tonal",size:"small",block:"",onClick:r,"prepend-icon":"mdi-calculator"},{default:t(()=>c[9]||(c[9]=[u(" Calculate Price ")])),_:1,__:[9]}),x.value>0?(h(),$(k,{key:0,color:"success",variant:"tonal",size:"small",block:"",onClick:i,"prepend-icon":"mdi-check"},{default:t(()=>[u(" Apply "+o(l(m)(x.value)),1)]),_:1})):U("",!0)]),x.value>0?(h(),q("div",rt,[e(L,{color:"info",variant:"tonal",size:"small"},{default:t(()=>[u(" Profit: "+o(l(m)(x.value-(n.product.cost||0))),1)]),_:1})])):U("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(ie,{modelValue:B.value,"onUpdate:modelValue":c[1]||(c[1]=y=>B.value=y),"product-id":n.product.id_product,"product-name":n.product.name,onHppUpdated:g,onPriceUpdated:d},null,8,["modelValue","product-id","product-name"]),e(at,{modelValue:H.value,"onUpdate:modelValue":c[2]||(c[2]=y=>H.value=y),"product-id":n.product.id_product,"product-name":n.product.name,onHppUpdated:g},null,8,["modelValue","product-id","product-name"])]))}}),it=W(nt,[["__scopeId","data-v-02ad34bc"]]),dt={class:"d-flex align-center justify-space-between mb-6"},ut={class:"d-flex gap-3"},ct={class:"d-flex align-center gap-3"},pt={class:"d-flex align-center gap-2"},mt={class:"d-flex flex-column"},vt={class:"font-weight-medium"},_t={class:"text-caption text-grey-darken-1"},ft={class:"font-weight-bold text-primary"},gt={class:"font-weight-medium"},ht={class:"d-flex flex-column align-end"},Pt={class:"text-caption"},bt={class:"v-data-table__footer"},xt={class:"pa-4 d-flex justify-space-between align-center"},yt={class:"text-body-2"},kt=K({__name:"hpp-management",setup(O){const{formatCurrency:A}=Q(),p=S([]),C=S(!1),V=S(""),P=S(1),M=S(15),m=S({category:null,hppStatus:null,marginRange:null}),B=S([{title:"All Categories",value:null},{title:"Food & Beverage",value:"food"},{title:"Electronics",value:"electronics"},{title:"Clothing",value:"clothing"},{title:"Others",value:"others"}]),H=[{title:"All Status",value:null},{title:"Good Margin",value:"good"},{title:"Low Margin",value:"low"},{title:"No HPP Data",value:"no_hpp"}],b=[{title:"All Ranges",value:null},{title:"< 10%",value:"low"},{title:"10% - 30%",value:"medium"},{title:"> 30%",value:"high"}],x=[{title:"Product",value:"name",sortable:!0,width:"200px"},{title:"Price",value:"current_price",align:"end",sortable:!0},{title:"HPP Cost",value:"current_cost",align:"end",sortable:!0},{title:"Margin",value:"margin",align:"end",sortable:!0},{title:"Status",value:"hpp_status",align:"center"},{title:"Actions",value:"actions",sortable:!1,width:"250px"}],N=j(()=>{let _=[...p.value];return m.value.hppStatus&&(_=_.filter(r=>m.value.hppStatus==="good"?r.margin_percent>=10:m.value.hppStatus==="low"?r.margin_percent<10&&r.cost>0:m.value.hppStatus==="no_hpp"?r.cost===0:!0)),m.value.marginRange&&(_=_.filter(r=>m.value.marginRange==="low"?r.margin_percent<10:m.value.marginRange==="medium"?r.margin_percent>=10&&r.margin_percent<=30:m.value.marginRange==="high"?r.margin_percent>30:!0)),_}),R=j(()=>Math.ceil(N.value.length/M.value)),s=async()=>{C.value=!0;try{const _=await fetch("/api/products",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);const r=await _.json();r.success&&(p.value=r.data.map(i=>({...i,margin_amount:(i.price||0)-(i.cost||0),margin_percent:i.cost>0?((i.price||0)-(i.cost||0))/i.cost*100:0,hpp_status:v(i)})))}catch(_){console.error("Error loading products:",_)}finally{C.value=!1}},v=_=>{const r=_.cost||0,i=r>0?((_.price||0)-r)/r*100:0;return r===0?{color:"error",icon:"mdi-alert-circle",text:"No HPP"}:i<10?{color:"warning",icon:"mdi-alert",text:"Low Margin"}:{color:"success",icon:"mdi-check-circle",text:"Good Margin"}},F=_=>_>0?"success":_<0?"error":"grey",G=()=>{m.value={category:null,hppStatus:null,marginRange:null}};return te(()=>{s()}),(_,r)=>(h(),q("div",null,[a("div",dt,[r[9]||(r[9]=a("div",null,[a("h1",{class:"text-h4 font-weight-bold mb-1"},"HPP Management"),a("p",{class:"text-body-1 text-grey-darken-1 mb-0"}," Manage Harga Pokok Produksi (Cost of Goods Sold) for all products ")],-1)),a("div",ut,[e(k,{color:"orange",variant:"outlined","prepend-icon":"mdi-package-variant-closed",onClick:r[0]||(r[0]=i=>_.$router.push("/product-items-management"))},{default:t(()=>r[7]||(r[7]=[u(" Komposisi Produk 123 ")])),_:1,__:[7]}),e(k,{color:"primary",variant:"elevated","prepend-icon":"mdi-plus",onClick:r[1]||(r[1]=i=>_.$router.push("/products-management"))},{default:t(()=>r[8]||(r[8]=[u(" Manage Products ")])),_:1,__:[8]})])]),e(Ue),e(w,{class:"mt-6"},{default:t(()=>[e(T,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",ct,[e(D,{icon:"mdi-package-variant",size:"24"}),r[10]||(r[10]=a("span",null,"Products HPP Overview",-1))]),a("div",pt,[e(re,{modelValue:V.value,"onUpdate:modelValue":r[2]||(r[2]=i=>V.value=i),"prepend-inner-icon":"mdi-magnify",label:"Search products...",variant:"outlined",density:"compact","hide-details":"",clearable:"",style:{"inline-size":"300px"}},null,8,["modelValue"]),e(k,{color:"primary",variant:"text",onClick:s,loading:C.value,icon:"mdi-refresh"},null,8,["loading"])])]),_:1}),e(z,null,{default:t(()=>[e(I,{class:"mb-4"},{default:t(()=>[e(f,{cols:"12",md:"3"},{default:t(()=>[e(E,{modelValue:m.value.category,"onUpdate:modelValue":r[3]||(r[3]=i=>m.value.category=i),items:B.value,label:"Category",variant:"outlined",density:"compact",clearable:"","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[e(E,{modelValue:m.value.hppStatus,"onUpdate:modelValue":r[4]||(r[4]=i=>m.value.hppStatus=i),items:H,label:"HPP Status",variant:"outlined",density:"compact",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[e(E,{modelValue:m.value.marginRange,"onUpdate:modelValue":r[5]||(r[5]=i=>m.value.marginRange=i),items:b,label:"Margin Range",variant:"outlined",density:"compact",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[e(k,{color:"error",variant:"text",onClick:G,"prepend-icon":"mdi-filter-off",block:""},{default:t(()=>r[11]||(r[11]=[u(" Clear Filters ")])),_:1,__:[11]})]),_:1})]),_:1}),e(J,{headers:x,items:N.value,loading:C.value,"items-per-page":M.value,search:V.value,class:"elevation-1"},{"item.name":t(({item:i})=>[a("div",mt,[a("span",vt,o(i.name),1),a("span",_t,o(i.sku),1)])]),"item.current_price":t(({item:i})=>[a("span",ft,o(l(A)(i.price||0)),1)]),"item.current_cost":t(({item:i})=>[a("span",gt,o(l(A)(i.cost||0)),1)]),"item.margin":t(({item:i})=>[a("div",ht,[e(L,{color:F(i.margin_amount),variant:"tonal",size:"small",class:"mb-1"},{default:t(()=>[u(o(l(A)(i.margin_amount)),1)]),_:2},1032,["color"]),a("span",Pt,o(i.margin_percent.toFixed(1))+"% ",1)])]),"item.hpp_status":t(({item:i})=>[e(L,{color:i.hpp_status.color,"prepend-icon":i.hpp_status.icon,variant:"tonal",size:"small"},{default:t(()=>[u(o(i.hpp_status.text),1)]),_:2},1032,["color","prepend-icon"])]),"item.actions":t(({item:i})=>[e(it,{product:i,onHppUpdated:s,onPriceUpdated:s,onProductUpdated:s},null,8,["product"])]),bottom:t(()=>[a("div",bt,[e(se),a("div",xt,[a("div",yt," Showing "+o(N.value.length)+" of "+o(p.value.length)+" products ",1),R.value>1?(h(),$(pe,{key:0,modelValue:P.value,"onUpdate:modelValue":r[6]||(r[6]=i=>P.value=i),length:R.value,"total-visible":7,size:"small"},null,8,["modelValue","length"])):U("",!0)])])]),_:1},8,["items","loading","items-per-page","search"])]),_:1})]),_:1})]))}}),Jt=W(kt,[["__scopeId","data-v-b21ab545"]]);export{Jt as default};
