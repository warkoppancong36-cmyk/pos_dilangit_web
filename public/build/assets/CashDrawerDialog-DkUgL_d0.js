import{g as E}from"./auth-CuuXRWj5.js";import{d as ce,V as me,r as n,w as W,D as pe,g as fe,f as s,av as M,o as g,b as a,e as c,X as b,a0 as m,s as r,c as k,l as ve,t as p,F as Ve,i as ge,v as ye,m as Y}from"./main-DcOxu_iY.js";import{V as U}from"./VDialog-CtHBFQfr.js";import{V as D,b as C,c as j}from"./VCard-CarlQF4f.js";import{V as _e}from"./VDivider-5s4PHN83.js";import{V as w}from"./VCardText-ZbrtLebs.js";import{V as Z,a as z}from"./VRow-B8LfeWfS.js";import{V as L}from"./VSpacer-cna5IU0U.js";import{V as ee}from"./VForm-BNe-nQJw.js";import{V as ae}from"./VTextField-BH8ElYDD.js";import{V as te}from"./VTextarea-C83dqbKk.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VOverlay-yRNL_Cmy.js";import"./forwardRefs-B931MWyl.js";import"./VImg-B8cqB_Zg.js";import"./VAvatar-CbTt8RiM.js";/* empty css              */const xe={class:"d-flex align-center gap-2"},be={class:"text-h4 font-weight-bold text-primary"},ke={key:0,class:"text-error text-caption"},De={class:"text-body-2 text-medium-emphasis mt-1"},Ce={key:0,class:"text-center text-medium-emphasis py-4"},we={key:1},Ie={class:"font-weight-medium"},Ne={class:"text-caption text-medium-emphasis"},Se={class:"text-right"},Ke=ce({__name:"CashDrawerDialog",props:{modelValue:{type:Boolean},dailySales:{default:0},dailyExpenses:{default:0}},emits:["update:modelValue"],setup(le,{emit:se}){const i=le,oe=se,K=me({get:()=>i.modelValue,set:t=>oe("update:modelValue",t)}),d=n(0),A=n(""),V=n([]),I=n(!1),R=n(),F=n(!1),f=n(null),y=n(""),_=n(""),O=n(!1),N=n(!1),q=n(),B=n(!1),v=n(null),h=n(""),x=n(""),T=n(!1),S={required:t=>!!t||"Field wajib diisi",positive:t=>(typeof t=="string"?parseFloat(t.replace(/[^\d]/g,"")):t)>0||"Nilai harus lebih besar dari 0"},$=t=>{const e=typeof t=="string"?parseFloat(t):t;return isNaN(e)||e===null||e===void 0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},ne=t=>{if(!t)return"-";try{const e=new Date(t);return isNaN(e.getTime())?(console.warn("Invalid date format:",t),"-"):e.toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(e){return console.error("Error formatting date:",e,"dateString:",t),"-"}},J=async()=>{try{const t=E(),e={"Content-Type":"application/json",Accept:"application/json"};t&&(e.Authorization=`Bearer ${t}`);const o=(await M.get("/api/cash-drawer/data",{headers:e})).data.data;let u=0;(o==null?void 0:o.current_balance)!==void 0&&(o==null?void 0:o.current_balance)!==null&&(typeof o.current_balance=="string"?u=parseFloat(o.current_balance):typeof o.current_balance=="number"&&(u=o.current_balance)),d.value=isNaN(u)?0:u,A.value=new Date().toLocaleString("id-ID"),V.value=Array.isArray(o==null?void 0:o.today_transactions)?o.today_transactions:[]}catch(t){console.error("Error loading cash data:",t);const e=5e5,l=typeof i.dailySales=="number"&&!isNaN(i.dailySales)?i.dailySales:0,o=typeof i.dailyExpenses=="number"&&!isNaN(i.dailyExpenses)?i.dailyExpenses:0;d.value=e+l-o,A.value=new Date().toLocaleString("id-ID"),V.value=[]}},H=()=>{K.value=!1},re=()=>{I.value=!0,f.value=null,y.value="",_.value=""},X=()=>{var t;I.value=!1,(t=R.value)==null||t.reset()},G=t=>{var u;const l=(((u=t.target)==null?void 0:u.value)||t).toString().replace(/\D/g,"");if(l===""){f.value=null,y.value="";return}const o=parseInt(l,10);f.value=o,y.value=o.toLocaleString("id-ID")},ue=async()=>{if(f.value)try{O.value=!0;const t=E(),e={"Content-Type":"application/json",Accept:"application/json"};t&&(e.Authorization=`Bearer ${t}`);const o=(await M.post("/api/cash-drawer/cash-in",{amount:f.value,notes:_.value,description:"Kas Masuk Manual"},{headers:e})).data;d.value=o.data.new_balance,V.value.unshift({id:Date.now(),type:"in",type_text:"Kas Masuk",amount:f.value,notes:_.value||"Kas masuk manual",created_at:new Date().toISOString()}),X()}catch(t){console.error("Error processing cash in:",t)}finally{O.value=!1}},ie=()=>{N.value=!0,v.value=null,h.value="",x.value=""},P=()=>{var t;N.value=!1,(t=q.value)==null||t.reset()},Q=t=>{var u;const l=(((u=t.target)==null?void 0:u.value)||t).toString().replace(/\D/g,"");if(l===""){v.value=null,h.value="";return}const o=parseInt(l,10);v.value=o,h.value=o.toLocaleString("id-ID")},de=async()=>{if(v.value)try{T.value=!0;const t=E(),e={"Content-Type":"application/json",Accept:"application/json"};t&&(e.Authorization=`Bearer ${t}`);const o=(await M.post("/api/cash-drawer/cash-out",{amount:v.value,notes:x.value,description:"Kas Keluar Manual"},{headers:e})).data;d.value=o.data.new_balance,V.value.unshift({id:Date.now(),type:"out",type_text:"Kas Keluar",amount:v.value,notes:x.value||"Kas keluar manual",created_at:new Date().toISOString()}),P()}catch(t){console.error("Error processing cash out:",t)}finally{T.value=!1}};return W(()=>i.modelValue,t=>{t&&J()}),W(d,(t,e)=>{},{deep:!0,immediate:!0}),pe(()=>{i.modelValue&&J()}),(t,e)=>(g(),fe(U,{modelValue:K.value,"onUpdate:modelValue":e[8]||(e[8]=l=>K.value=l),"max-width":"600",persistent:""},{default:s(()=>[a(D,{class:"coffee-dialog"},{default:s(()=>[a(C,{class:"d-flex align-center justify-space-between coffee-header"},{default:s(()=>[c("div",xe,[a(b,{icon:"mdi-cash-register",class:"text-white"}),e[9]||(e[9]=c("span",{class:"text-white"}," Cash Drawer ",-1))]),a(m,{icon:"tabler-x",variant:"text",color:"white",onClick:H})]),_:1}),a(_e),a(w,null,{default:s(()=>[a(Z,null,{default:s(()=>[a(z,{cols:"12"},{default:s(()=>[a(D,{class:"mb-6",variant:"tonal",color:"primary"},{default:s(()=>[a(C,{class:"text-h6 pb-2"},{default:s(()=>[a(b,{icon:"mdi-cash-multiple",size:"20",class:"me-2"}),e[10]||(e[10]=r(" Kas Saat Ini "))]),_:1,__:[10]}),a(w,{class:"pt-0"},{default:s(()=>[c("div",be,p($(d.value)),1),isNaN(d.value)?(g(),k("div",ke," Debug: currentCash is "+p(d.value)+" ("+p(typeof d.value)+") ",1)):ve("",!0),c("div",De," Terakhir update: "+p(A.value),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(Z,{class:"mb-4"},{default:s(()=>[a(z,{cols:"6"},{default:s(()=>[a(m,{color:"success",variant:"flat",block:"",size:"large","prepend-icon":"mdi-plus-circle",onClick:re},{default:s(()=>e[11]||(e[11]=[r(" Kas Masuk ")])),_:1,__:[11]})]),_:1}),a(z,{cols:"6"},{default:s(()=>[a(m,{color:"error",variant:"flat",block:"",size:"large","prepend-icon":"mdi-minus-circle",onClick:ie},{default:s(()=>e[12]||(e[12]=[r(" Kas Keluar ")])),_:1,__:[12]})]),_:1})]),_:1}),a(D,{variant:"outlined"},{default:s(()=>[a(C,{class:"text-h6"},{default:s(()=>[a(b,{icon:"mdi-history",size:"20",class:"me-2"}),e[13]||(e[13]=r(" Transaksi Hari Ini "))]),_:1,__:[13]}),a(w,null,{default:s(()=>[V.value.length===0?(g(),k("div",Ce," Belum ada transaksi hari ini ")):(g(),k("div",we,[(g(!0),k(Ve,null,ge(V.value,(l,o)=>(g(),k("div",{key:o,class:"d-flex justify-space-between align-center py-2 border-b"},[c("div",null,[c("div",Ie,p(l.type_text||l.description),1),c("div",Ne,p(ne(l.created_at)),1)]),c("div",Se,[c("div",{class:ye([l.type==="in"?"text-success":"text-error","font-weight-bold"])},p(l.type==="in"?"+":"-")+p($(l.amount)),3)])]))),128))]))]),_:1})]),_:1})]),_:1}),a(j,null,{default:s(()=>[a(L),a(m,{variant:"text",onClick:H},{default:s(()=>e[14]||(e[14]=[r(" Tutup ")])),_:1,__:[14]})]),_:1})]),_:1}),a(U,{modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=l=>I.value=l),"max-width":"400",persistent:""},{default:s(()=>[a(D,null,{default:s(()=>[a(C,null,{default:s(()=>[a(b,{icon:"mdi-plus-circle",class:"me-2"}),e[15]||(e[15]=r(" Kas Masuk "))]),_:1,__:[15]}),a(w,null,{default:s(()=>[a(Y(ee),{ref_key:"cashInForm",ref:R,modelValue:F.value,"onUpdate:modelValue":e[2]||(e[2]=l=>F.value=l)},{default:s(()=>[a(ae,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=l=>y.value=l),label:"Jumlah Kas Masuk",variant:"outlined",prefix:"Rp",placeholder:"0",rules:[S.required,S.positive],class:"mb-4",onInput:G,onBlur:G},null,8,["modelValue","rules"]),a(te,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=l=>_.value=l),label:"Catatan (Opsional)",variant:"outlined",rows:"3",placeholder:"Masukkan catatan untuk kas masuk..."},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),a(j,null,{default:s(()=>[a(m,{variant:"text",onClick:X},{default:s(()=>e[16]||(e[16]=[r(" Batal ")])),_:1,__:[16]}),a(L),a(m,{color:"success",loading:O.value,disabled:!F.value||!f.value,onClick:ue},{default:s(()=>e[17]||(e[17]=[r(" Simpan ")])),_:1,__:[17]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(U,{modelValue:N.value,"onUpdate:modelValue":e[7]||(e[7]=l=>N.value=l),"max-width":"400",persistent:""},{default:s(()=>[a(D,null,{default:s(()=>[a(C,null,{default:s(()=>[a(b,{icon:"mdi-minus-circle",class:"me-2"}),e[18]||(e[18]=r(" Kas Keluar "))]),_:1,__:[18]}),a(w,null,{default:s(()=>[a(Y(ee),{ref_key:"cashOutForm",ref:q,modelValue:B.value,"onUpdate:modelValue":e[6]||(e[6]=l=>B.value=l)},{default:s(()=>[a(ae,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=l=>h.value=l),label:"Jumlah Kas Keluar",variant:"outlined",prefix:"Rp",placeholder:"0",rules:[S.required,S.positive],class:"mb-4",onInput:Q,onBlur:Q},null,8,["modelValue","rules"]),a(te,{modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=l=>x.value=l),label:"Catatan (Opsional)",variant:"outlined",rows:"3",placeholder:"Masukkan catatan untuk kas keluar..."},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),a(j,null,{default:s(()=>[a(m,{variant:"text",onClick:P},{default:s(()=>e[19]||(e[19]=[r(" Batal ")])),_:1,__:[19]}),a(L),a(m,{color:"error",loading:T.value,disabled:!B.value||!v.value,onClick:de},{default:s(()=>e[20]||(e[20]=[r(" Simpan ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]))}}),Ge=he(Ke,[["__scopeId","data-v-3837ab7f"]]);export{Ge as default};
