import{d as X,r as C,aw as g,V as D,w as Y,D as Z,g as x,f as s,av as k,o as h,b as o,e as n,a0 as p,s as V,t as r,c as tt,l as at,m as M}from"./main-BDjA8ZE0.js";import{f as T}from"./helpers-B-vn2Qqf.js";import{_ as et}from"./VariantFormDialog.vue_vue_type_script_setup_true_lang-1r2W_LME.js";import ot from"./VariantCompositionDialog-BMlI44YI.js";import{_ as st}from"./VariantDetailDialog.vue_vue_type_script_setup_true_lang-DYjJCrL4.js";import{V as it}from"./VContainer-DGv6bNpU.js";import{V as B,a as f}from"./VRow-B_tm1uSD.js";import{V as N}from"./VCard-Af9i-cHC.js";import{V as lt}from"./VCardText-pusdEz6_.js";import{V as nt}from"./VTextField-BQMuFhOa.js";import{V as b}from"./VSelect-CqUH4kv5.js";import{V as rt}from"./VDataTableServer-Di72ajGe.js";import{V as dt}from"./VSwitch-DvQ6AnPY.js";import{V as S}from"./VChip-DmPw7oBU.js";import{V as ct}from"./VAvatar-BJUFvcQH.js";import{V as ut}from"./VImg-DavVY8Sw.js";import{_ as mt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VDialog-kKqt15qI.js";import"./VOverlay-DpeqFwNJ.js";import"./forwardRefs-B931MWyl.js";import"./VDivider-CNJRCtTw.js";import"./VForm-D-6FADkt.js";import"./VAlert-BUxPj0YW.js";import"./VSpacer-P6zft6lJ.js";/* empty css              */import"./DeleteConfirmationDialog-DIkwJ7SA.js";import"./VAutocomplete-X1kKS8Y9.js";import"./filter-BTEElEgT.js";import"./VList-BUBOvLR6.js";import"./VMenu-BN6MK1Ni.js";import"./VCheckboxBtn-Ml9VaORK.js";import"./VDataTable-BxIs7bLB.js";import"./VTable-CQyojuSP.js";const pt={class:"d-flex justify-between align-center"},ft={class:"d-flex align-center"},vt={class:"font-weight-medium"},_t={class:"text-caption text-medium-emphasis"},gt={class:"font-weight-medium"},Vt={class:"text-caption text-medium-emphasis"},kt={class:"text-end"},ht={class:"font-weight-medium"},wt={key:0,class:"text-caption text-medium-emphasis"},yt={class:"text-center"},Ct={class:"text-caption text-medium-emphasis"},xt={class:"d-flex"},bt=X({__name:"VariantManagement",setup(St){const w=C(!1),P=C([]),y=C([]),v=(e,a="success")=>{console.log(`${a.toUpperCase()}: ${e}`)},d=g({page:1,itemsPerPage:10,total:0}),i=g({search:"",product_id:null,status:null,stock_status:null}),c=g({show:!1,variant:null}),u=g({show:!1,variant:null}),_=g({show:!1,variant:null}),H=D(()=>[{title:"Produk",key:"product",sortable:!1},{title:"Nama Variant",key:"name"},{title:"Komposisi",key:"composition",sortable:!1},{title:"Harga",key:"price",align:"end"},{title:"Stok",key:"stock",align:"center"},{title:"Status",key:"status",sortable:!1,align:"center"},{title:"Aksi",key:"actions",sortable:!1,align:"center"}]),A=D(()=>y.value.map(e=>({title:e.name,value:e.id}))),E=[{title:"Aktif",value:!0},{title:"Tidak Aktif",value:!1}],F=[{title:"Stok Tersedia",value:"available"},{title:"Stok Menipis",value:"low"},{title:"Stok Habis",value:"out"}],m=async e=>{w.value=!0;try{const a={page:Math.max(1,d.page||1),per_page:Math.max(1,d.itemsPerPage||10),search:i.search||"",product_id:i.product_id||void 0,status:i.status!==null?i.status:void 0,stock_status:i.stock_status||void 0,...e};console.log("Loading variants with params:",a);const t=await k.get("/api/variants",{params:a});P.value=t.data.data.map(l=>({...l,is_active:l.active,id:l.id_variant||l.id,product_id:l.id_product||l.product_id})),d.total=t.data.total,d.page=t.data.current_page}catch(a){v("Gagal memuat data variant","error"),console.error("Error loading variants:",a)}finally{w.value=!1}},K=async()=>{try{const e=await k.get("/api/products",{params:{per_page:-1,status:!0}});y.value=e.data.data||e.data}catch(e){console.error("Error loading products:",e)}},G=()=>{c.variant=null,c.show=!0},I=e=>{c.variant={...e},c.show=!0},O=e=>{_.variant=e,_.show=!0},$=e=>{u.variant=e,u.show=!0},R=e=>{e.variant_items_count>0&&$(e)},j=async e=>{e.updating=!0;try{await k.post(`/api/variants/${e.id}/toggle-active`),v(`Variant ${e.is_active?"diaktifkan":"dinonaktifkan"}`)}catch{e.is_active=!e.is_active,v("Gagal mengubah status variant","error")}finally{e.updating=!1}},L=async e=>{if(confirm(`Hapus variant "${e.name}"?`))try{await k.delete(`/api/variants/${e.id}`),v("Variant berhasil dihapus"),m()}catch{v("Gagal menghapus variant","error")}},q=()=>{c.show=!1,m()},J=()=>{u.show=!1,m()},Q=()=>{i.search="",i.product_id=null,i.status=null,i.stock_status=null},W=(e,a)=>e<=0?"error":e<=a?"warning":"success";return Y(()=>i,()=>{d.page=1,m()},{deep:!0}),Z(()=>{K(),m()}),(e,a)=>(h(),x(it,{fluid:""},{default:s(()=>[o(B,{class:"mb-4"},{default:s(()=>[o(f,{cols:"12"},{default:s(()=>[n("div",pt,[a[9]||(a[9]=n("div",null,[n("h1",{class:"text-h4 font-weight-bold"},"Variant Management"),n("p",{class:"text-subtitle-1 text-medium-emphasis"}," Kelola variant produk dan komposisinya ")],-1)),o(p,{color:"primary",onClick:G,"prepend-icon":"mdi-plus",size:"large"},{default:s(()=>a[8]||(a[8]=[V(" Tambah Variant ")])),_:1,__:[8]})])]),_:1})]),_:1}),o(N,{class:"mb-4"},{default:s(()=>[o(lt,null,{default:s(()=>[o(B,null,{default:s(()=>[o(f,{cols:"12",md:"3"},{default:s(()=>[o(nt,{modelValue:i.search,"onUpdate:modelValue":a[0]||(a[0]=t=>i.search=t),label:"Cari variant...","prepend-inner-icon":"mdi-magnify",clearable:"",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),o(f,{cols:"12",md:"3"},{default:s(()=>[o(b,{modelValue:i.product_id,"onUpdate:modelValue":a[1]||(a[1]=t=>i.product_id=t),items:A.value,label:"Filter Produk",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),o(f,{cols:"12",md:"2"},{default:s(()=>[o(b,{modelValue:i.status,"onUpdate:modelValue":a[2]||(a[2]=t=>i.status=t),items:E,label:"Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),o(f,{cols:"12",md:"2"},{default:s(()=>[o(b,{modelValue:i.stock_status,"onUpdate:modelValue":a[3]||(a[3]=t=>i.stock_status=t),items:F,label:"Status Stok",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),o(f,{cols:"12",md:"2"},{default:s(()=>[o(p,{onClick:Q,variant:"outlined",color:"secondary",block:""},{default:s(()=>a[10]||(a[10]=[V(" Reset Filter ")])),_:1,__:[10]})]),_:1})]),_:1})]),_:1})]),_:1}),o(N,null,{default:s(()=>[o(rt,{"items-per-page":d.itemsPerPage,"onUpdate:itemsPerPage":a[4]||(a[4]=t=>d.itemsPerPage=t),headers:H.value,items:P.value,"items-length":d.total,loading:w.value,search:i.search,"onUpdate:options":m,class:"elevation-1"},{"item.product":s(({item:t})=>{var l,U;return[n("div",ft,[o(ct,{size:"40",class:"me-3"},{default:s(()=>{var z;return[o(ut,{src:((z=t.product)==null?void 0:z.image)||"/images/default-product.png"},null,8,["src"])]}),_:2},1024),n("div",null,[n("div",vt,r((l=t.product)==null?void 0:l.name),1),n("div",_t,r((U=t.product)==null?void 0:U.code),1)])])]}),"item.name":s(({item:t})=>[n("div",null,[n("div",gt,r(t.name),1),n("div",Vt,r(t.sku),1)])]),"item.composition":s(({item:t})=>[t.variant_items_count>0?(h(),x(S,{key:0,color:"info",size:"small",onClick:l=>R(t),class:"cursor-pointer"},{default:s(()=>[V(r(t.variant_items_count)+" Item ",1)]),_:2},1032,["onClick"])):(h(),x(S,{key:1,color:"warning",size:"small"},{default:s(()=>a[11]||(a[11]=[V(" Belum ada komposisi ")])),_:1,__:[11]}))]),"item.price":s(({item:t})=>[n("div",kt,[n("div",ht,r(M(T)(t.price)),1),t.cost_from_composition?(h(),tt("div",wt," HPP: "+r(M(T)(t.cost_from_composition)),1)):at("",!0)])]),"item.stock":s(({item:t})=>[n("div",yt,[o(S,{color:W(t.current_stock,t.min_stock),size:"small"},{default:s(()=>[V(r(t.current_stock),1)]),_:2},1032,["color"]),n("div",Ct," Min: "+r(t.min_stock),1)])]),"item.status":s(({item:t})=>[o(dt,{modelValue:t.is_active,"onUpdate:modelValue":l=>t.is_active=l,onChange:l=>j(t),color:"success",density:"compact","hide-details":"",loading:t.updating},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),"item.actions":s(({item:t})=>[n("div",xt,[o(p,{icon:"mdi-eye",size:"small",variant:"text",onClick:l=>O(t),title:"Detail"},null,8,["onClick"]),o(p,{icon:"mdi-puzzle",size:"small",variant:"text",color:"info",onClick:l=>$(t),title:"Kelola Komposisi"},null,8,["onClick"]),o(p,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:l=>I(t),title:"Edit"},null,8,["onClick"]),o(p,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:l=>L(t),title:"Hapus"},null,8,["onClick"])])]),_:1},8,["items-per-page","headers","items","items-length","loading","search"])]),_:1}),o(et,{modelValue:c.show,"onUpdate:modelValue":a[5]||(a[5]=t=>c.show=t),variant:c.variant,products:y.value,onSave:q},null,8,["modelValue","variant","products"]),o(ot,{modelValue:u.show,"onUpdate:modelValue":a[6]||(a[6]=t=>u.show=t),variant:u.variant,onSave:J},null,8,["modelValue","variant"]),o(st,{modelValue:_.show,"onUpdate:modelValue":a[7]||(a[7]=t=>_.show=t),variant:_.variant},null,8,["modelValue","variant"])]),_:1}))}}),la=mt(bt,[["__scopeId","data-v-cc76d196"]]);export{la as default};
