import{aA as $,d as K,r as v,V as h,D as W,w as R,g as q,f as o,o as _,b as t,e as n,X as Y,t as w,a0 as b,$ as ee,c as E,s as x,F as te,i as ae,l as le}from"./main-DkG1SMyJ.js";import{P as j}from"./PosApi-Cqf9jvGl.js";import{V as oe}from"./VDialog-DqE-G0jQ.js";import{V as k,b as se,c as re}from"./VCard-DmkXrdeT.js";import{V as C}from"./VCardText-B4o54qqp.js";import{V as ue}from"./VForm-zcibxJ6O.js";import{V as B,a as u}from"./VRow-BK4DnjCv.js";import{V as U}from"./VSelect-BoP3UuSP.js";import{V as p}from"./VTextField-Cvgx3pi2.js";import{V as ne}from"./VAlert-CUBcyKzL.js";import{V as de}from"./VTextarea-C3Bw7VzT.js";import{V as ie}from"./VDivider-BcYIK9yZ.js";import{V as me}from"./VSpacer-BHIauwXa.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VOverlay-BtGJJEWk.js";import"./forwardRefs-B931MWyl.js";import"./VImg-C5C-_8kk.js";import"./VAvatar-BxZDkD5y.js";/* empty css              */import"./VList-e--91MVP.js";import"./VMenu-DiWtwAXH.js";import"./VCheckboxBtn-kBMZQnV-.js";import"./VChip-Ccbl4S7w.js";const z="/api/customers";class pe{static async getCustomers(m){var r;try{return(await $.get(`${z}`,{params:m})).data}catch(d){throw((r=d.response)==null?void 0:r.data)||this.handleError(d)}}static async getCustomer(m){var r;try{return(await $.get(`${z}/${m}`)).data}catch(d){throw((r=d.response)==null?void 0:r.data)||this.handleError(d)}}static handleError(m){var r,d;return m.response?{success:!1,message:((r=m.response.data)==null?void 0:r.message)||"Server error occurred",errors:(d=m.response.data)==null?void 0:d.errors}:m.request?{success:!1,message:"Network error occurred"}:{success:!1,message:m.message||"An unexpected error occurred"}}}const fe={class:"d-flex align-items-center gap-2"},ve={class:"coffee-subtitle"},_e={key:0,class:"space-y-4"},Ve={class:"d-flex justify-space-between mb-2"},be={class:"font-weight-medium"},ye={key:0,class:"d-flex justify-space-between mb-2"},ge={class:"font-weight-medium text-error"},we={class:"d-flex justify-space-between"},xe={class:"font-weight-bold text-h6"},ke=K({__name:"EditOrderDialog",props:{modelValue:{type:Boolean},order:{}},emits:["update:modelValue","order-updated"],setup(M,{emit:m}){const r=M,d=m,N=v(),D=v(!1),P=v(!1),A=v([]),T=v([]),s=v({order_type:"",table_number:"",guest_count:1,id_customer:null,notes:"",discount_type:"",discount_value:0,items:[]}),L=[{title:"Makan di Tempat",value:"dine_in"},{title:"Bawa Pulang",value:"takeaway"},{title:"Antar",value:"delivery"}],Z=[{title:"Persentase",value:"percentage"},{title:"Nominal",value:"fixed"}],f={required:a=>!!a||"Field ini wajib diisi",minOne:a=>a>=1||"Minimal 1",minZero:a=>a>=0||"Minimal 0"},V=h({get:()=>r.modelValue,set:a=>d("update:modelValue",a)}),y=h(()=>{const a=s.value.items.reduce((l,i)=>l+i.quantity*i.unit_price,0);let e=0;return s.value.discount_type&&s.value.discount_value>0&&(s.value.discount_type==="percentage"?e=a*s.value.discount_value/100:e=s.value.discount_value),{subtotal:a,discount:e,total:a-e}}),H=async()=>{try{const a=await pe.getCustomers();a.success&&(A.value=a.data)}catch(a){console.error("Error loading customers:",a)}},J=async()=>{try{const a=await j.getProducts();a.success&&(T.value=a.data)}catch(a){console.error("Error loading products:",a)}},O=()=>{var a;r.order&&(s.value={order_type:r.order.order_type||"",table_number:r.order.table_number||"",guest_count:r.order.guest_count||1,id_customer:r.order.id_customer||null,notes:r.order.notes||"",discount_type:r.order.discount_type||"",discount_value:r.order.discount_amount||0,items:((a=r.order.orderItems)==null?void 0:a.map(e=>({id_product:e.id_product,quantity:e.quantity,unit_price:e.unit_price,notes:e.notes||""})))||[]})},Q=()=>{s.value.items.push({id_product:null,quantity:1,unit_price:0,notes:""})},X=a=>{s.value.items.splice(a,1)},G=a=>{const e=s.value.items[a],l=T.value.find(i=>i.id_product===e.id_product);l&&e.unit_price===0&&(e.unit_price=l.price||0)},S=a=>{},F=async()=>{var a;if((a=N.value)!=null&&a.validate())try{P.value=!0;const e={order_type:s.value.order_type,table_number:s.value.table_number,guest_count:s.value.guest_count,id_customer:s.value.id_customer,notes:s.value.notes,discount_type:s.value.discount_type,discount_value:s.value.discount_value,items:s.value.items.filter(i=>i.id_product)},l=await j.editOrder(r.order.id_order,e);l.success&&(d("order-updated",l.data),I(),console.log("Order updated successfully"))}catch(e){console.error("Error updating order:",e)}finally{P.value=!1}},I=()=>{V.value=!1},g=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a||0);return W(()=>{H(),J()}),R(V,a=>{a&&r.order&&O()}),R(()=>r.order,a=>{a&&V.value&&O()}),(a,e)=>(_(),q(oe,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=l=>V.value=l),"max-width":"900",scrollable:"",persistent:""},{default:o(()=>[t(k,{class:"coffee-dialog"},{default:o(()=>[t(se,{class:"d-flex align-center justify-space-between coffee-header"},{default:o(()=>{var l;return[n("div",fe,[t(Y,{icon:"tabler-edit",class:"text-white"}),n("div",null,[e[9]||(e[9]=n("div",{class:"coffee-title"},"Edit Transaksi",-1)),n("div",ve,w((l=a.order)==null?void 0:l.order_number),1)])]),t(b,{icon:"tabler-x",variant:"text",color:"white",onClick:I})]}),_:1}),t(C,{class:"pa-6"},{default:o(()=>[t(ue,{ref_key:"formRef",ref:N,modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=l=>D.value=l),onSubmit:ee(F,["prevent"])},{default:o(()=>[t(B,null,{default:o(()=>[t(u,{cols:"12"},{default:o(()=>e[10]||(e[10]=[n("h4",{class:"text-h6 mb-4"},"Informasi Pesanan",-1)])),_:1,__:[10]}),t(u,{cols:"12",md:"6"},{default:o(()=>[t(U,{modelValue:s.value.order_type,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.order_type=l),label:"Tipe Pesanan",items:L,variant:"outlined",rules:[f.required]},null,8,["modelValue","rules"])]),_:1}),t(u,{cols:"12",md:"6"},{default:o(()=>[t(p,{modelValue:s.value.table_number,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.table_number=l),label:"Nomor Meja",variant:"outlined",clearable:""},null,8,["modelValue"])]),_:1}),t(u,{cols:"12",md:"6"},{default:o(()=>[t(p,{modelValue:s.value.guest_count,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.guest_count=l),modelModifiers:{number:!0},label:"Jumlah Tamu",type:"number",variant:"outlined",min:"1"},null,8,["modelValue"])]),_:1}),t(u,{cols:"12",md:"6"},{default:o(()=>[t(U,{modelValue:s.value.id_customer,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.id_customer=l),label:"Pelanggan",items:A.value,"item-title":"name","item-value":"id_customer",variant:"outlined",clearable:"","prepend-inner-icon":"tabler-user"},null,8,["modelValue","items"])]),_:1}),t(u,{cols:"12"},{default:o(()=>e[11]||(e[11]=[n("h4",{class:"text-h6 mb-4 mt-4"},"Item Pesanan",-1)])),_:1,__:[11]}),t(u,{cols:"12"},{default:o(()=>[t(k,{variant:"outlined"},{default:o(()=>[t(C,null,{default:o(()=>[t(b,{color:"primary",variant:"outlined","prepend-icon":"tabler-plus",class:"mb-4",onClick:Q},{default:o(()=>e[12]||(e[12]=[x(" Tambah Item ")])),_:1,__:[12]}),s.value.items.length>0?(_(),E("div",_e,[(_(!0),E(te,null,ae(s.value.items,(l,i)=>(_(),q(k,{key:i,variant:"outlined",class:"mb-3"},{default:o(()=>[t(C,null,{default:o(()=>[t(B,{align:"center"},{default:o(()=>[t(u,{cols:"12",md:"4"},{default:o(()=>[t(U,{modelValue:l.id_product,"onUpdate:modelValue":[c=>l.id_product=c,c=>G(i)],label:"Produk",items:T.value,"item-title":"name","item-value":"id_product",variant:"outlined",density:"compact",rules:[f.required]},null,8,["modelValue","onUpdate:modelValue","items","rules"])]),_:2},1024),t(u,{cols:"12",md:"2"},{default:o(()=>[t(p,{modelValue:l.quantity,"onUpdate:modelValue":[c=>l.quantity=c,c=>S(i)],modelModifiers:{number:!0},label:"Qty",type:"number",variant:"outlined",density:"compact",min:"1",rules:[f.required,f.minOne]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(u,{cols:"12",md:"2"},{default:o(()=>[t(p,{modelValue:l.unit_price,"onUpdate:modelValue":[c=>l.unit_price=c,c=>S(i)],modelModifiers:{number:!0},label:"Harga",type:"number",variant:"outlined",density:"compact",min:"0",rules:[f.required,f.minZero]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(u,{cols:"12",md:"2"},{default:o(()=>[t(p,{"model-value":g(l.quantity*l.unit_price),label:"Total",variant:"outlined",density:"compact",readonly:""},null,8,["model-value"])]),_:2},1024),t(u,{cols:"12",md:"2"},{default:o(()=>[t(b,{icon:"tabler-trash",variant:"text",color:"error",size:"small",onClick:c=>X(i)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),t(B,null,{default:o(()=>[t(u,{cols:"12"},{default:o(()=>[t(p,{modelValue:l.notes,"onUpdate:modelValue":c=>l.notes=c,label:"Catatan Item",variant:"outlined",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])):(_(),q(ne,{key:1,type:"info",variant:"tonal",class:"mb-0"},{default:o(()=>e[13]||(e[13]=[x(" Belum ada item dalam pesanan ")])),_:1,__:[13]}))]),_:1})]),_:1})]),_:1}),t(u,{cols:"12"},{default:o(()=>e[14]||(e[14]=[n("h4",{class:"text-h6 mb-4 mt-4"},"Diskon",-1)])),_:1,__:[14]}),t(u,{cols:"12",md:"6"},{default:o(()=>[t(U,{modelValue:s.value.discount_type,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.discount_type=l),label:"Tipe Diskon",items:Z,variant:"outlined",clearable:""},null,8,["modelValue"])]),_:1}),t(u,{cols:"12",md:"6"},{default:o(()=>[t(p,{modelValue:s.value.discount_value,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.discount_value=l),modelModifiers:{number:!0},label:"Nilai Diskon",type:"number",variant:"outlined",min:"0",suffix:s.value.discount_type==="percentage"?"%":"Rp"},null,8,["modelValue","suffix"])]),_:1}),t(u,{cols:"12"},{default:o(()=>[t(de,{modelValue:s.value.notes,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.notes=l),label:"Catatan Pesanan",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1}),t(u,{cols:"12"},{default:o(()=>[t(k,{variant:"tonal",color:"primary"},{default:o(()=>[t(C,null,{default:o(()=>[e[18]||(e[18]=n("h4",{class:"text-h6 mb-3"},"Ringkasan Pesanan",-1)),n("div",Ve,[e[15]||(e[15]=n("span",null,"Subtotal:",-1)),n("span",be,w(g(y.value.subtotal)),1)]),y.value.discount>0?(_(),E("div",ye,[e[16]||(e[16]=n("span",null,"Diskon:",-1)),n("span",ge,"-"+w(g(y.value.discount)),1)])):le("",!0),t(ie,{class:"my-2"}),n("div",we,[e[17]||(e[17]=n("span",{class:"font-weight-bold"},"Total:",-1)),n("span",xe,w(g(y.value.total)),1)])]),_:1,__:[18]})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(re,{class:"pa-6 pt-0"},{default:o(()=>[t(me),t(b,{variant:"outlined",onClick:I},{default:o(()=>e[19]||(e[19]=[x(" Batal ")])),_:1,__:[19]}),t(b,{color:"primary",loading:P.value,disabled:!D.value||s.value.items.length===0,onClick:F},{default:o(()=>e[20]||(e[20]=[x(" Simpan Perubahan ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Je=ce(ke,[["__scopeId","data-v-0acb1915"]]);export{Je as default};
