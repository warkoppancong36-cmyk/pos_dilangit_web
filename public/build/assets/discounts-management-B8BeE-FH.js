var he=Object.defineProperty;var we=(R,l,d)=>l in R?he(R,l,{enumerable:!0,configurable:!0,writable:!0,value:d}):R[l]=d;var ce=(R,l,d)=>we(R,typeof l!="symbol"?l+"":l,d);import{D as Se}from"./DeleteConfirmationDialog-ypVY1Jm2.js";import{aA as I,d as ue,r as b,V as H,w as ee,D as fe,g as L,f as a,b as e,e as t,X,t as p,a0 as C,$ as Te,l as F,c as $,F as ve,i as pe,s as k,aU as _e,o as g,at as Ue,m as $e}from"./main-D8TUhak1.js";import{V as ge}from"./VDialog-DIDlQmDV.js";import{b as ye,c as be,V as O}from"./VCard-B_6lEwSo.js";import{V as Ce}from"./VForm-BMAA6FlO.js";import{V as J}from"./VCardText-H5ZGanGD.js";import{V as Be}from"./VAlert-D5b4ipH4.js";import{V as N,a as m}from"./VRow-DG5vr49O.js";import{V as M}from"./VTextField-QCEkIs1t.js";import{V as Pe}from"./VTextarea-TIUSeGyE.js";import{V as te}from"./VDivider-C3_mW2aC.js";import{V as ae}from"./VSelect-OGtUi-fP.js";import{V as Ae}from"./VSwitch-B0dZCmSL.js";import{V as xe}from"./VSpacer-DBlK3-MQ.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as E}from"./VChip-B073ge14.js";import{V as Re}from"./VDataTableServer-c3CBKmoZ.js";import"./VOverlay-B-ifa8HV.js";import"./forwardRefs-B931MWyl.js";import"./VImg-DLySrD1j.js";import"./VAvatar-DNrvK_hi.js";/* empty css              */import"./VList-CMWkNSZb.js";import"./VMenu-DQxvduMj.js";import"./VCheckboxBtn-BHip714U.js";import"./VDataTable-Q7K1-DRL.js";import"./VTable-CzhKH8et.js";import"./filter-6xoUmEKy.js";class D{static async getDiscounts(l={}){return(await I.get(this.BASE_URL,{params:l})).data.data}static async getDiscount(l){return(await I.get(`${this.BASE_URL}/${l}`)).data.data}static async createDiscount(l){return(await I.post(this.BASE_URL,l)).data.data}static async updateDiscount(l,d){return(await I.put(`${this.BASE_URL}/${l}`,d)).data.data}static async deleteDiscount(l){await I.delete(`${this.BASE_URL}/${l}`)}static async validateDiscountCode(l,d,y){return(await I.post(`${this.BASE_URL}/validate-code`,{code:l,order_total:d,customer_id:y})).data.data}static async getStats(){return(await I.get(`${this.BASE_URL}/stats`)).data.data}static async toggleStatus(l){return(await I.post(`${this.BASE_URL}/${l}/toggle-status`)).data.data}static async duplicate(l){return(await I.post(`${this.BASE_URL}/${l}/duplicate`)).data.data}static formatDiscountValue(l){switch(l.type){case"percentage":return`${l.value}%`;case"fixed_amount":return`Rp ${this.formatCurrency(l.value)}`;default:return l.value.toString()}}static formatCurrency(l){return new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:0}).format(l)}static getDiscountTypeLabel(l){return{percentage:"Persentase",fixed_amount:"Jumlah Tetap",buy_x_get_y:"Beli X Dapat Y"}[l]||l}static getStatusColor(l){return{active:"success",inactive:"secondary",expired:"error",scheduled:"warning",exhausted:"info"}[l]||"primary"}static getStatusLabel(l){return{active:"Aktif",inactive:"Tidak Aktif",expired:"Kadaluarsa",scheduled:"Terjadwal",exhausted:"Habis"}[l]||l}static isDiscountValid(l){if(!l.active)return!1;const d=new Date,y=new Date(l.valid_from),h=new Date(l.valid_until);return d>=y&&d<=h}static canDiscountBeUsed(l,d){return!(!this.isDiscountValid(l)||l.minimum_amount&&d<l.minimum_amount||l.usage_limit&&l.used_count>=l.usage_limit)}static calculateDiscountAmount(l,d){if(!this.canDiscountBeUsed(l,d))return 0;let y=0;switch(l.type){case"percentage":y=d*l.value/100;break;case"fixed_amount":y=l.value;break;case"buy_x_get_y":y=0;break}return l.maximum_discount&&y>l.maximum_discount&&(y=l.maximum_discount),Math.round(y*100)/100}}ce(D,"BASE_URL","/api/discounts");const Le={class:"d-flex align-center"},Fe={class:"text-subtitle-2 mb-2"},Me={key:0,class:"text-body-2"},Ke={class:"ml-4 mt-1"},ze={key:0,class:"text-caption text-info mt-1"},Ie={key:1,class:"text-caption text-error mt-1"},Ne={key:2,class:"text-caption text-success mt-1"},je=ue({__name:"DiscountDialog",props:{modelValue:{type:Boolean},mode:{},discount:{default:null}},emits:["update:modelValue","saved"],setup(R,{emit:l}){const d=R,y=l,h=b(),S=b(!1),K=b(!1),_=b({}),V=b(!1),B=b(""),x=b({loading:!1,available:null}),o=b({name:"",code:"",description:"",type:"percentage",value:0,minimum_amount:void 0,maximum_discount:void 0,usage_limit:void 0,usage_limit_per_customer:void 0,valid_from:"",valid_until:"",active:!0}),j=[{title:"Persentase (%)",value:"percentage"},{title:"Jumlah Tetap (Rp)",value:"fixed_amount"},{title:"Beli X Dapat Y",value:"buy_x_get_y"}],P=H({get:()=>d.modelValue,set:r=>y("update:modelValue",r)}),Y=H(()=>d.mode==="create"?"Tambah Diskon Baru":"Edit Diskon"),Q=[r=>!!r||"Nama diskon wajib diisi",r=>r.length>=3||"Nama minimal 3 karakter"],n=[r=>!!r||"Kode diskon wajib diisi",r=>r.length>=3||"Kode minimal 3 karakter",r=>/^[A-Z0-9_-]+$/.test(r)||"Kode hanya boleh huruf kapital, angka, - dan _"],s=H(()=>[r=>r>0||"Nilai harus lebih dari 0",...o.value.type==="percentage"?[r=>r<=100||"Persentase maksimal 100%"]:[]]),T=[r=>!!r||"Tanggal mulai wajib diisi"],w=H(()=>[r=>!!r||"Tanggal berakhir wajib diisi",r=>{if(!r||!o.value.valid_from)return!0;const i=new Date(o.value.valid_from);return new Date(r)>i||"Tanggal berakhir harus setelah tanggal mulai"}]),q=_e(async r=>{if(!r||r.length<3){x.value={loading:!1,available:null};return}try{x.value.loading=!0,await new Promise(i=>setTimeout(i,500)),x.value={loading:!1,available:!0}}catch(i){x.value={loading:!1,available:null},console.error("Code validation error:",i)}},500),U=()=>{q(o.value.code)},le=()=>{const r="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let i="";for(let c=0;c<8;c++)i+=r.charAt(Math.floor(Math.random()*r.length));o.value.code=i,U()},se=()=>{switch(o.value.type){case"percentage":return"Persentase Diskon";case"fixed_amount":return"Jumlah Diskon";case"buy_x_get_y":return"Persentase/Jumlah Diskon";default:return"Nilai"}},ie=()=>{o.value.type!=="percentage"&&(o.value.maximum_discount=void 0)},oe=()=>{o.value={name:"",code:"",description:"",type:"percentage",value:0,minimum_amount:void 0,maximum_discount:void 0,usage_limit:void 0,usage_limit_per_customer:void 0,valid_from:"",valid_until:"",active:!0},x.value={loading:!1,available:null},_.value={},V.value=!1,B.value=""},W=()=>{if(d.discount){const r=d.discount;o.value={name:r.name,code:r.code,description:r.description||"",type:r.type,value:r.value,minimum_amount:r.minimum_amount,maximum_discount:r.maximum_discount,usage_limit:r.usage_limit,usage_limit_per_customer:r.usage_limit_per_customer,valid_from:r.valid_from?new Date(r.valid_from).toISOString().slice(0,16):"",valid_until:r.valid_until?new Date(r.valid_until).toISOString().slice(0,16):"",active:r.active}}},ne=async()=>{var i,c,z;_.value={},V.value=!1,B.value="";const{valid:r}=await((i=h.value)==null?void 0:i.validate());if(!(!r||x.value.available===!1)){if(o.value.valid_from&&o.value.valid_until){const A=new Date(o.value.valid_from);if(new Date(o.value.valid_until)<=A){B.value="Tanggal berakhir harus setelah tanggal mulai",V.value=!0;return}}try{K.value=!0,d.mode==="create"?await D.createDiscount(o.value):d.discount&&await D.updateDiscount(d.discount.id_discount,o.value),y("saved")}catch(A){console.error("Save error:",A),(z=(c=A.response)==null?void 0:c.data)!=null&&z.errors?(_.value=A.response.data.errors,B.value=A.response.data.message||"Terjadi kesalahan validasi"):B.value=A.message||"Terjadi kesalahan saat menyimpan data",V.value=!0}finally{K.value=!1}}},Z=()=>{P.value=!1};return ee(()=>d.modelValue,r=>{r&&(d.mode==="edit"&&d.discount?W():oe())}),ee(()=>o.value.code,r=>{r&&U()}),ee(()=>o.value.valid_from,()=>{(_.value.valid_from||_.value.valid_until)&&(_.value={},V.value=!1)}),ee(()=>o.value.valid_until,()=>{(_.value.valid_from||_.value.valid_until)&&(_.value={},V.value=!1)}),fe(()=>{d.modelValue&&d.mode==="edit"&&d.discount&&W()}),(r,i)=>(g(),L(ge,{modelValue:P.value,"onUpdate:modelValue":i[14]||(i[14]=c=>P.value=c),"max-width":"800px",persistent:"",scrollable:""},{default:a(()=>[e(O,null,{default:a(()=>[e(ye,{class:"d-flex align-center justify-space-between bg-primary text-white"},{default:a(()=>[t("div",Le,[e(X,{icon:"mdi-tag-outline",size:"24",class:"me-2"}),t("span",null,p(Y.value),1)]),e(C,{icon:"mdi-close",variant:"text",color:"white",onClick:Z})]),_:1}),e(Ce,{ref_key:"formRef",ref:h,modelValue:S.value,"onUpdate:modelValue":i[13]||(i[13]=c=>S.value=c),onSubmit:Te(ne,["prevent"])},{default:a(()=>[e(J,{class:"pa-6"},{default:a(()=>[V.value?(g(),L(Be,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:"","onClick:close":i[0]||(i[0]=c=>V.value=!1)},{default:a(()=>[t("div",Fe,p(B.value),1),Object.keys(_.value).length>0?(g(),$("div",Me,[(g(!0),$(ve,null,pe(_.value,(c,z)=>(g(),$("div",{key:z,class:"mb-1"},[t("strong",null,p(z==="valid_until"?"Tanggal Berakhir":z==="valid_from"?"Tanggal Mulai":z)+":",1),t("ul",Ke,[(g(!0),$(ve,null,pe(c,A=>(g(),$("li",{key:A,class:"text-caption"},p(A),1))),128))])]))),128))])):F("",!0)]),_:1})):F("",!0),e(N,null,{default:a(()=>[e(m,{cols:"12"},{default:a(()=>i[15]||(i[15]=[t("h6",{class:"text-h6 mb-4"},"Informasi Dasar",-1)])),_:1,__:[15]}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:o.value.name,"onUpdate:modelValue":i[1]||(i[1]=c=>o.value.name=c),label:"Nama Diskon",rules:Q,variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:o.value.code,"onUpdate:modelValue":i[2]||(i[2]=c=>o.value.code=c),label:"Kode Diskon",rules:n,variant:"outlined",required:"",onBlur:U},{"append-inner":a(()=>[e(C,{icon:"mdi-dice-multiple",size:"small",variant:"text",onClick:le})]),_:1},8,["modelValue"]),x.value.loading?(g(),$("div",ze,[e(X,{icon:"mdi-loading",size:"14",class:"spin me-1"}),i[16]||(i[16]=k(" Mengecek ketersediaan kode... "))])):x.value.available===!1?(g(),$("div",Ie,[e(X,{icon:"mdi-alert",size:"14",class:"me-1"}),i[17]||(i[17]=k(" Kode sudah digunakan "))])):x.value.available===!0?(g(),$("div",Ne,[e(X,{icon:"mdi-check",size:"14",class:"me-1"}),i[18]||(i[18]=k(" Kode tersedia "))])):F("",!0)]),_:1}),e(m,{cols:"12"},{default:a(()=>[e(Pe,{modelValue:o.value.description,"onUpdate:modelValue":i[3]||(i[3]=c=>o.value.description=c),label:"Deskripsi",variant:"outlined",rows:"3","auto-grow":""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12"},{default:a(()=>[e(te,{class:"my-4"}),i[19]||(i[19]=t("h6",{class:"text-h6 mb-4"},"Konfigurasi Diskon",-1))]),_:1,__:[19]}),e(m,{cols:"12",md:"4"},{default:a(()=>[e(ae,{modelValue:o.value.type,"onUpdate:modelValue":[i[4]||(i[4]=c=>o.value.type=c),ie],items:j,label:"Tipe Diskon",rules:[c=>!!c||"Tipe diskon wajib dipilih"],variant:"outlined",required:""},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",md:"4"},{default:a(()=>[e(M,{modelValue:o.value.value,"onUpdate:modelValue":i[5]||(i[5]=c=>o.value.value=c),modelModifiers:{number:!0},label:se(),rules:s.value,variant:"outlined",type:"number",prefix:o.value.type==="fixed_amount"?"Rp":void 0,suffix:o.value.type==="percentage"?"%":void 0,min:"0",required:""},null,8,["modelValue","label","rules","prefix","suffix"])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:o.value.minimum_amount,"onUpdate:modelValue":i[6]||(i[6]=c=>o.value.minimum_amount=c),modelModifiers:{number:!0},label:"Minimum Pembelian",variant:"outlined",type:"number",prefix:"Rp",min:"0",hint:"Kosongkan jika tidak ada minimum"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:o.value.maximum_discount,"onUpdate:modelValue":i[7]||(i[7]=c=>o.value.maximum_discount=c),modelModifiers:{number:!0},label:"Maksimum Diskon",variant:"outlined",type:"number",prefix:"Rp",min:"0",hint:"Hanya untuk diskon persentase",disabled:o.value.type!=="percentage"},null,8,["modelValue","disabled"])]),_:1}),e(m,{cols:"12"},{default:a(()=>[e(te,{class:"my-4"}),i[20]||(i[20]=t("h6",{class:"text-h6 mb-4"},"Batasan Penggunaan",-1))]),_:1,__:[20]}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:o.value.usage_limit,"onUpdate:modelValue":i[8]||(i[8]=c=>o.value.usage_limit=c),modelModifiers:{number:!0},label:"Batas Total Penggunaan",variant:"outlined",type:"number",min:"1",hint:"Kosongkan untuk unlimited"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:o.value.usage_limit_per_customer,"onUpdate:modelValue":i[9]||(i[9]=c=>o.value.usage_limit_per_customer=c),modelModifiers:{number:!0},label:"Batas Per Pengguna",variant:"outlined",type:"number",min:"1",hint:"Kosongkan untuk unlimited"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12"},{default:a(()=>[e(te,{class:"my-4"}),i[21]||(i[21]=t("h6",{class:"text-h6 mb-4"},"Periode Berlaku",-1))]),_:1,__:[21]}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:o.value.valid_from,"onUpdate:modelValue":i[10]||(i[10]=c=>o.value.valid_from=c),label:"Berlaku Dari",rules:T,variant:"outlined",type:"datetime-local",required:""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[e(M,{modelValue:o.value.valid_until,"onUpdate:modelValue":i[11]||(i[11]=c=>o.value.valid_until=c),label:"Berlaku Sampai",rules:w.value,variant:"outlined",type:"datetime-local",required:""},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12"},{default:a(()=>[e(te,{class:"my-4"}),i[22]||(i[22]=t("h6",{class:"text-h6 mb-4"},"Status",-1))]),_:1,__:[22]}),e(m,{cols:"12"},{default:a(()=>[e(Ae,{modelValue:o.value.active,"onUpdate:modelValue":i[12]||(i[12]=c=>o.value.active=c),label:"Aktifkan diskon ini",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(be,{class:"pa-6 pt-0"},{default:a(()=>[e(xe),e(C,{variant:"outlined",onClick:Z},{default:a(()=>i[23]||(i[23]=[k(" Batal ")])),_:1,__:[23]}),e(C,{type:"submit",color:"primary",loading:K.value,disabled:!S.value||x.value.available===!1},{default:a(()=>[k(p(d.mode==="create"?"Simpan":"Update"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]))}}),Ee=ke(je,[["__scopeId","data-v-ac9c8f11"]]),qe={class:"d-flex align-center"},Oe={class:"mb-6"},Je={class:"mb-3"},Xe={class:"text-body-1 font-weight-medium"},He={class:"mb-3"},Ye={class:"mb-3"},Qe={class:"text-body-1"},We={class:"mb-6"},Ze={class:"mb-3"},Ge={class:"mb-3"},et={class:"text-body-1 font-weight-medium"},tt={class:"mb-3"},at={class:"text-body-1 font-weight-medium"},lt={class:"mb-3"},st={class:"text-body-1 font-weight-medium"},it={class:"mb-3"},ot={class:"text-body-1 font-weight-medium"},nt={class:"mb-3"},ut={class:"text-body-1 font-weight-medium"},dt={class:"mb-6"},rt={class:"mb-3"},mt={class:"text-body-1 font-weight-medium"},ct={key:0,class:"text-medium-emphasis"},vt={key:1,class:"text-medium-emphasis"},pt={class:"mb-3"},ft={class:"text-body-1 font-weight-medium"},_t={class:"mb-3"},gt={class:"text-caption text-medium-emphasis mt-1"},yt={class:"mb-6"},bt={class:"mb-3"},xt={class:"text-body-1 font-weight-medium"},kt={class:"mb-3"},Vt={class:"text-body-1 font-weight-medium"},Dt={class:"mb-3"},ht={class:"mb-6"},wt={class:"mb-3"},St={class:"mb-3"},Tt={class:"mb-3"},Ut={class:"text-body-2"},$t={class:"mb-3"},Ct={class:"text-body-2"},Bt=ue({__name:"DiscountViewDialog",props:{modelValue:{type:Boolean},discount:{}},emits:["update:modelValue"],setup(R,{emit:l}){const d=R,y=l,h=H({get:()=>d.modelValue,set:n=>y("update:modelValue",n)}),S=H(()=>{var n;return(n=d.discount)!=null&&n.usage_limit?d.discount.used_count/d.discount.usage_limit*100:0}),K=()=>{h.value=!1},_=n=>D.formatDiscountValue(n),V=n=>D.getDiscountTypeLabel(n),B=n=>({percentage:"primary",fixed_amount:"success",buy_x_get_y:"warning"})[n]||"secondary",x=n=>D.getStatusColor(n),o=n=>D.getStatusLabel(n),j=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),P=n=>new Date(n).toLocaleString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),Y=()=>{if(!d.discount)return"";const n=new Date,T=new Date(d.discount.valid_until).getTime()-n.getTime();if(T<=0)return"Kadaluarsa";const w=Math.floor(T/(1e3*60*60*24)),q=Math.floor(T%(1e3*60*60*24)/(1e3*60*60)),U=Math.floor(T%(1e3*60*60)/(1e3*60));return w>0?`${w} hari ${q} jam`:q>0?`${q} jam ${U} menit`:U>0?`${U} menit`:"Kurang dari 1 menit"},Q=()=>{if(!d.discount)return"secondary";const n=new Date,T=new Date(d.discount.valid_until).getTime()-n.getTime();if(T<=0)return"error";const w=Math.floor(T/(1e3*60*60*24));return w<=1?"error":w<=7?"warning":"success"};return(n,s)=>(g(),L(ge,{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=T=>h.value=T),"max-width":"600px",scrollable:""},{default:a(()=>[n.discount?(g(),L(O,{key:0},{default:a(()=>[e(ye,{class:"d-flex align-center justify-space-between bg-primary text-white"},{default:a(()=>[t("div",qe,[e(X,{icon:"mdi-eye",size:"24",class:"me-2"}),s[1]||(s[1]=t("span",null,"Detail Diskon",-1))]),e(C,{icon:"mdi-close",variant:"text",color:"white",onClick:K})]),_:1}),e(J,{class:"pa-6"},{default:a(()=>[t("div",Oe,[s[5]||(s[5]=t("h6",{class:"text-h6 mb-4"},"Informasi Dasar",-1)),e(N,null,{default:a(()=>[e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",Je,[s[2]||(s[2]=t("div",{class:"text-caption text-medium-emphasis"},"Nama Diskon",-1)),t("div",Xe,p(n.discount.name),1)])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",He,[s[3]||(s[3]=t("div",{class:"text-caption text-medium-emphasis"},"Kode Diskon",-1)),e(E,{color:"primary",variant:"tonal",size:"small"},{default:a(()=>[k(p(n.discount.code),1)]),_:1})])]),_:1}),n.discount.description?(g(),L(m,{key:0,cols:"12"},{default:a(()=>[t("div",Ye,[s[4]||(s[4]=t("div",{class:"text-caption text-medium-emphasis"},"Deskripsi",-1)),t("div",Qe,p(n.discount.description),1)])]),_:1})):F("",!0)]),_:1})]),t("div",We,[s[12]||(s[12]=t("h6",{class:"text-h6 mb-4"},"Konfigurasi Diskon",-1)),e(N,null,{default:a(()=>[e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",Ze,[s[6]||(s[6]=t("div",{class:"text-caption text-medium-emphasis"},"Tipe Diskon",-1)),e(E,{color:B(n.discount.type),variant:"tonal",size:"small"},{default:a(()=>[k(p(V(n.discount.type)),1)]),_:1},8,["color"])])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",Ge,[s[7]||(s[7]=t("div",{class:"text-caption text-medium-emphasis"},"Nilai Diskon",-1)),t("div",et,p(_(n.discount)),1)])]),_:1}),n.discount.type==="buy_x_get_y"?(g(),L(m,{key:0,cols:"12",md:"6"},{default:a(()=>[t("div",tt,[s[8]||(s[8]=t("div",{class:"text-caption text-medium-emphasis"},"Beli Quantity",-1)),t("div",at,p(n.discount.buy_quantity),1)])]),_:1})):F("",!0),n.discount.type==="buy_x_get_y"?(g(),L(m,{key:1,cols:"12",md:"6"},{default:a(()=>[t("div",lt,[s[9]||(s[9]=t("div",{class:"text-caption text-medium-emphasis"},"Dapat Quantity",-1)),t("div",st,p(n.discount.get_quantity),1)])]),_:1})):F("",!0),n.discount.minimum_amount?(g(),L(m,{key:2,cols:"12",md:"6"},{default:a(()=>[t("div",it,[s[10]||(s[10]=t("div",{class:"text-caption text-medium-emphasis"},"Minimum Pembelian",-1)),t("div",ot,p(j(n.discount.minimum_amount)),1)])]),_:1})):F("",!0),n.discount.maximum_discount_amount?(g(),L(m,{key:3,cols:"12",md:"6"},{default:a(()=>[t("div",nt,[s[11]||(s[11]=t("div",{class:"text-caption text-medium-emphasis"},"Maksimum Diskon",-1)),t("div",ut,p(j(n.discount.maximum_discount_amount)),1)])]),_:1})):F("",!0)]),_:1})]),t("div",dt,[s[16]||(s[16]=t("h6",{class:"text-h6 mb-4"},"Informasi Penggunaan",-1)),e(N,null,{default:a(()=>[e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",rt,[s[13]||(s[13]=t("div",{class:"text-caption text-medium-emphasis"},"Total Digunakan",-1)),t("div",mt,[k(p(n.discount.used_count||0)+" ",1),n.discount.usage_limit?(g(),$("span",ct," / "+p(n.discount.usage_limit),1)):(g(),$("span",vt," / Unlimited "))])])]),_:1}),n.discount.usage_limit_per_user?(g(),L(m,{key:0,cols:"12",md:"6"},{default:a(()=>[t("div",pt,[s[14]||(s[14]=t("div",{class:"text-caption text-medium-emphasis"},"Batas Per Pengguna",-1)),t("div",ft,p(n.discount.usage_limit_per_user),1)])]),_:1})):F("",!0),n.discount.usage_limit?(g(),L(m,{key:1,cols:"12",md:"6"},{default:a(()=>[t("div",_t,[s[15]||(s[15]=t("div",{class:"text-caption text-medium-emphasis"},"Progress Penggunaan",-1)),e(Ue,{"model-value":S.value,color:S.value>=90?"error":S.value>=70?"warning":"success",height:"8",rounded:"",class:"mt-2"},null,8,["model-value","color"]),t("div",gt,p(S.value.toFixed(1))+"% terpakai ",1)])]),_:1})):F("",!0)]),_:1})]),t("div",yt,[s[20]||(s[20]=t("h6",{class:"text-h6 mb-4"},"Periode Berlaku",-1)),e(N,null,{default:a(()=>[e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",bt,[s[17]||(s[17]=t("div",{class:"text-caption text-medium-emphasis"},"Berlaku Dari",-1)),t("div",xt,p(P(n.discount.valid_from)),1)])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",kt,[s[18]||(s[18]=t("div",{class:"text-caption text-medium-emphasis"},"Berlaku Sampai",-1)),t("div",Vt,p(P(n.discount.valid_until)),1)])]),_:1}),e(m,{cols:"12"},{default:a(()=>[t("div",Dt,[s[19]||(s[19]=t("div",{class:"text-caption text-medium-emphasis"},"Sisa Waktu",-1)),e(E,{color:Q(),variant:"tonal",size:"small"},{default:a(()=>[e(X,{icon:"mdi-clock-outline",size:"16",class:"me-1"}),k(" "+p(Y()),1)]),_:1},8,["color"])])]),_:1})]),_:1})]),t("div",ht,[s[23]||(s[23]=t("h6",{class:"text-h6 mb-4"},"Status",-1)),e(N,null,{default:a(()=>[e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",wt,[s[21]||(s[21]=t("div",{class:"text-caption text-medium-emphasis"},"Status Aktif",-1)),e(E,{color:n.discount.active?"success":"error",variant:"tonal",size:"small"},{default:a(()=>[e(X,{icon:n.discount.active?"mdi-check":"mdi-close",size:"16",class:"me-1"},null,8,["icon"]),k(" "+p(n.discount.active?"Aktif":"Tidak Aktif"),1)]),_:1},8,["color"])])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",St,[s[22]||(s[22]=t("div",{class:"text-caption text-medium-emphasis"},"Status Berlaku",-1)),e(E,{color:x(n.discount.status),variant:"tonal",size:"small"},{default:a(()=>[k(p(o(n.discount.status)),1)]),_:1},8,["color"])])]),_:1})]),_:1})]),t("div",null,[s[26]||(s[26]=t("h6",{class:"text-h6 mb-4"},"Informasi Sistem",-1)),e(N,null,{default:a(()=>[e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",Tt,[s[24]||(s[24]=t("div",{class:"text-caption text-medium-emphasis"},"Dibuat Pada",-1)),t("div",Ut,p(P(n.discount.created_at)),1)])]),_:1}),e(m,{cols:"12",md:"6"},{default:a(()=>[t("div",$t,[s[25]||(s[25]=t("div",{class:"text-caption text-medium-emphasis"},"Terakhir Diupdate",-1)),t("div",Ct,p(P(n.discount.updated_at)),1)])]),_:1})]),_:1})])]),_:1}),e(be,{class:"pa-6 pt-0"},{default:a(()=>[e(xe),e(C,{variant:"outlined",onClick:K},{default:a(()=>s[27]||(s[27]=[k(" Tutup ")])),_:1,__:[27]})]),_:1})]),_:1})):F("",!0)]),_:1},8,["modelValue"]))}}),Pt={class:"discount-management"},At={class:"d-flex justify-space-between align-center mb-6"},Rt={class:"d-flex gap-3 align-center"},Lt={class:"text-h3 font-weight-bold"},Ft={class:"text-h3 font-weight-bold"},Mt={class:"text-h3 font-weight-bold"},Kt={class:"text-h3 font-weight-bold"},zt={class:"d-flex align-center"},It={class:"font-weight-medium"},Nt={class:"text-center"},jt={class:"font-weight-medium"},Et={key:0,class:"text-caption text-medium-emphasis"},qt={key:1,class:"text-caption text-medium-emphasis"},Ot={class:"text-sm"},Jt={class:"text-medium-emphasis"},Xt={class:"d-flex align-center gap-2"},Ht=ue({__name:"discounts-management",setup(R){const l=b([]),d=b(!1),y=b(null),h=b(1),S=b(15),K=b(0),_=b({search:"",type:"all",status:"all",sort_by:"created_at",sort_order:"desc"}),V=b(!1),B=b(!1),x=b(!1),o=b(null),j=b("create"),P=b(!1),Y=[{title:"Semua Tipe",value:"all"},{title:"Persentase",value:"percentage"},{title:"Jumlah Tetap",value:"fixed_amount"},{title:"Beli X Dapat Y",value:"buy_x_get_y"}],Q=[{title:"Semua Status",value:"all"},{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"},{title:"Kadaluarsa",value:"expired"},{title:"Terjadwal",value:"scheduled"}],n=[{title:"Tanggal Dibuat",value:"created_at"},{title:"Nama",value:"name"},{title:"Kode",value:"code"},{title:"Nilai",value:"value"},{title:"Penggunaan",value:"used_count"},{title:"Tanggal Berlaku",value:"valid_from"}],s=[{title:"Kode",key:"code",sortable:!1},{title:"Nama",key:"name",sortable:!0},{title:"Tipe",key:"type",sortable:!1},{title:"Nilai",key:"value",sortable:!0},{title:"Penggunaan",key:"usage",sortable:!1},{title:"Periode Berlaku",key:"valid_period",sortable:!1},{title:"Status",key:"status",sortable:!1},{title:"Aksi",key:"actions",sortable:!1,align:"center"}],T=_e(()=>{h.value=1,w()},500),w=async()=>{try{d.value=!0;const f={search:_.value.search||void 0,type:_.value.type==="all"?void 0:_.value.type,status:_.value.status==="all"?void 0:_.value.status,sort_by:_.value.sort_by||"created_at",sort_order:"desc",page:h.value,per_page:S.value},v=await D.getDiscounts(f);l.value=v.data,K.value=v.total}catch(f){console.error("Failed to fetch discounts:",f)}finally{d.value=!1}},q=async()=>{try{y.value=await D.getStats()}catch(f){console.error("Failed to fetch discount stats:",f)}},U=async()=>{await Promise.all([w(),q()])},le=f=>{h.value=f.page,S.value=f.itemsPerPage,w()},se=()=>{o.value=null,j.value="create",V.value=!0},ie=f=>{o.value=f,B.value=!0},oe=f=>{o.value=f,j.value="edit",V.value=!0},W=async f=>{try{await D.duplicate(f.id_discount),await U()}catch(v){console.error("Failed to duplicate discount:",v)}},ne=async f=>{try{await D.toggleStatus(f.id_discount),await w()}catch(v){console.error("Failed to toggle discount status:",v)}},Z=f=>{o.value=f,x.value=!0},r=async()=>{if(o.value)try{P.value=!0,await D.deleteDiscount(o.value.id_discount),await U(),x.value=!1}catch(f){console.error("Failed to delete discount:",f)}finally{P.value=!1}},i=()=>{o.value=null,x.value=!1},c=()=>{V.value=!1,U()},z=f=>D.formatDiscountValue(f),A=f=>D.getDiscountTypeLabel(f),de=f=>({percentage:"primary",fixed_amount:"success",buy_x_get_y:"warning"})[f]||"secondary",Ve=f=>D.getStatusColor(f||"inactive"),De=f=>D.getStatusLabel(f||"inactive"),re=f=>new Date(f).toLocaleDateString("id-ID");return fe(()=>{U()}),(f,v)=>{var me;return g(),$("div",Pt,[t("div",At,[v[10]||(v[10]=t("div",null,[t("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Diskon"),t("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola kode diskon dan potongan harga untuk coffee shop Anda")],-1)),t("div",Rt,[e(C,{color:"primary","prepend-icon":"mdi-plus",onClick:se},{default:a(()=>v[9]||(v[9]=[k(" Tambah Diskon ")])),_:1,__:[9]})])]),e(N,{class:"mb-6"},{default:a(()=>[e(m,{cols:"12",md:"3"},{default:a(()=>[e(O,{color:"primary",variant:"tonal"},{default:a(()=>[e(J,{class:"text-center"},{default:a(()=>{var u;return[t("div",Lt,p(((u=y.value)==null?void 0:u.total_discounts)||0),1),v[11]||(v[11]=t("div",{class:"text-body-2 text-medium-emphasis"},"Total Diskon",-1))]}),_:1,__:[11]})]),_:1})]),_:1}),e(m,{cols:"12",md:"3"},{default:a(()=>[e(O,{color:"success",variant:"tonal"},{default:a(()=>[e(J,{class:"text-center"},{default:a(()=>{var u;return[t("div",Ft,p(((u=y.value)==null?void 0:u.active_discounts)||0),1),v[12]||(v[12]=t("div",{class:"text-body-2 text-medium-emphasis"},"Aktif",-1))]}),_:1,__:[12]})]),_:1})]),_:1}),e(m,{cols:"12",md:"3"},{default:a(()=>[e(O,{color:"warning",variant:"tonal"},{default:a(()=>[e(J,{class:"text-center"},{default:a(()=>{var u;return[t("div",Mt,p(((u=y.value)==null?void 0:u.total_usage)||0),1),v[13]||(v[13]=t("div",{class:"text-body-2 text-medium-emphasis"},"Terpakai",-1))]}),_:1,__:[13]})]),_:1})]),_:1}),e(m,{cols:"12",md:"3"},{default:a(()=>[e(O,{color:"error",variant:"tonal"},{default:a(()=>[e(J,{class:"text-center"},{default:a(()=>{var u;return[t("div",Kt,p(((u=y.value)==null?void 0:u.expired_discounts)||0),1),v[14]||(v[14]=t("div",{class:"text-body-2 text-medium-emphasis"},"Kedaluwarsa",-1))]}),_:1,__:[14]})]),_:1})]),_:1})]),_:1}),e(O,null,{default:a(()=>[e(J,null,{default:a(()=>[e(N,{class:"mb-4"},{default:a(()=>[e(m,{cols:"12",md:"4"},{default:a(()=>[e(M,{modelValue:_.value.search,"onUpdate:modelValue":v[0]||(v[0]=u=>_.value.search=u),label:"Cari diskon...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:$e(T)},null,8,["modelValue","onInput"])]),_:1}),e(m,{cols:"12",md:"2"},{default:a(()=>[e(ae,{modelValue:_.value.type,"onUpdate:modelValue":[v[1]||(v[1]=u=>_.value.type=u),w],items:Y,label:"Tipe",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"2"},{default:a(()=>[e(ae,{modelValue:_.value.status,"onUpdate:modelValue":[v[2]||(v[2]=u=>_.value.status=u),w],items:Q,label:"Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"2"},{default:a(()=>[e(ae,{modelValue:_.value.sort_by,"onUpdate:modelValue":[v[3]||(v[3]=u=>_.value.sort_by=u),w],items:n,label:"Urutkan",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",md:"2",class:"d-flex align-center"},{default:a(()=>[e(C,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:U},{default:a(()=>v[15]||(v[15]=[k(" Refresh ")])),_:1,__:[15]})]),_:1})]),_:1}),e(Re,{"items-per-page":S.value,"onUpdate:itemsPerPage":v[4]||(v[4]=u=>S.value=u),page:h.value,"onUpdate:page":v[5]||(v[5]=u=>h.value=u),headers:s,items:l.value,"items-length":K.value,loading:d.value,class:"discount-table","onUpdate:options":le},{"item.code":a(({item:u})=>[t("div",zt,[e(E,{size:"small",color:"primary",variant:"tonal"},{default:a(()=>[k(p(u.code),1)]),_:2},1024)])]),"item.type":a(({item:u})=>[e(E,{size:"small",color:de(u.type),variant:"tonal"},{default:a(()=>[k(p(A(u.type)),1)]),_:2},1032,["color"])]),"item.value":a(({item:u})=>[t("span",It,p(z(u)),1)]),"item.usage":a(({item:u})=>[t("div",Nt,[t("div",jt,p(u.used_count),1),u.usage_limit?(g(),$("div",Et," / "+p(u.usage_limit),1)):(g(),$("div",qt," Unlimited "))])]),"item.valid_period":a(({item:u})=>[t("div",Ot,[t("div",null,p(re(u.valid_from)),1),t("div",Jt,p(re(u.valid_until)),1)])]),"item.status":a(({item:u})=>[e(E,{size:"small",color:Ve(u.status),variant:"tonal"},{default:a(()=>[k(p(De(u.status)),1)]),_:2},1032,["color"])]),"item.actions":a(({item:u})=>[t("div",Xt,[e(C,{icon:"mdi-eye",size:"small",variant:"text",onClick:G=>ie(u)},null,8,["onClick"]),e(C,{icon:"mdi-pencil",size:"small",variant:"text",onClick:G=>oe(u)},null,8,["onClick"]),e(C,{icon:u.active?"mdi-pause":"mdi-play",size:"small",variant:"text",onClick:G=>ne(u)},null,8,["icon","onClick"]),e(C,{icon:"mdi-content-copy",size:"small",variant:"text",onClick:G=>W(u)},null,8,["onClick"]),e(C,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:G=>Z(u)},null,8,["onClick"])])]),_:1},8,["items-per-page","page","items","items-length","loading"])]),_:1})]),_:1}),e(Ee,{modelValue:V.value,"onUpdate:modelValue":v[6]||(v[6]=u=>V.value=u),discount:o.value,mode:j.value,onSaved:c},null,8,["modelValue","discount","mode"]),e(Bt,{modelValue:B.value,"onUpdate:modelValue":v[7]||(v[7]=u=>B.value=u),discount:o.value},null,8,["modelValue","discount"]),e(Se,{modelValue:x.value,"onUpdate:modelValue":v[8]||(v[8]=u=>x.value=u),loading:P.value,"item-name":((me=o.value)==null?void 0:me.name)||"",title:"Konfirmasi Hapus Diskon",onConfirm:r,onCancel:i},null,8,["modelValue","loading","item-name"])])}}}),ha=ke(Ht,[["__scopeId","data-v-c0ff4379"]]);export{ha as default};
