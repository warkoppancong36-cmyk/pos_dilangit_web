import{d as R,r as f,V as z,w as j,D as G,c as d,l as p,g as h,F as T,i as B,f as n,o as r,e as o,b as i,t as c,a0 as y,X as v,s as u,v as J,$ as K}from"./main-C2v4uIoW.js";import{V as S,b as X}from"./VCard-B1F88_EZ.js";import{V as Q}from"./VAlert-FoMGBYO8.js";import{V as A}from"./VChip-DSWK68Bq.js";import{V as M}from"./VCardText-CsYXoujx.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VAvatar-CEGEgChg.js";import"./VImg-DoogZNtY.js";const W={key:0},Y={key:0,class:"applied-promotions mb-4"},Z={class:"d-flex justify-space-between align-center"},ee={class:"font-weight-medium"},te={class:"text-caption"},ae={class:"text-caption text-success mt-1"},se={class:"promotion-list"},oe={class:"d-flex justify-space-between align-start"},ie={class:"promotion-info"},le={class:"promotion-name font-weight-medium text-body-1"},ne={class:"promotion-description text-caption text-medium-emphasis mb-2"},re={class:"promotion-savings text-success font-weight-medium"},ce={key:0,class:"promotion-validity text-caption mt-1"},de={class:"promotion-action"},ue={key:0,class:"mt-3 text-center"},me=R({__name:"PromotionSuggestions",props:{cartItems:{},subtotal:{}},emits:["promotions-applied","promotions-removed"],setup(q,{expose:F,emit:H}){const N={async calculatePromotions(t){return{success:!1,message:"API belum tersedia - implementasi mock",data:[]}}},_=q,b=H,l=f([]),s=f([]),k=f(!1),x=z(()=>s.value.reduce((t,a)=>t+(a.calculated_discount||0),0)),P=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t).replace("IDR","Rp"),L=t=>new Date(t).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),$=t=>({happy_hour:"orange",bogo:"green",combo_deal:"blue",category_discount:"purple",quantity_discount:"teal"})[t]||"grey",E=t=>({happy_hour:"Happy Hour",bogo:"BOGO",combo_deal:"Combo Deal",category_discount:"Diskon Kategori",quantity_discount:"Diskon Jumlah"})[t]||t,m=t=>s.value.some(a=>a.id===t),g=async()=>{if(_.cartItems.length===0){l.value=[];return}try{k.value=!0;const t={items:_.cartItems.map(e=>({product_id:e.id_product,category_id:e.category_id||null,price:e.selling_price,quantity:e.quantity,subtotal:e.selling_price*e.quantity})),subtotal:_.subtotal,current_time:new Date().toISOString()},a=await N.calculatePromotions(t);a.success&&a.data&&(l.value=a.data.filter(e=>!m(e.id)))}catch(t){console.error("Error loading promotions:",t)}finally{k.value=!1}},C=t=>{m(t.id)?V(t.id):D(t)},D=t=>{s.value.length>0&&!t.can_be_combined&&(s.value=[]),s.value.push(t),l.value=l.value.filter(a=>a.id!==t.id),w()},V=t=>{const a=s.value.find(e=>e.id===t);a&&(s.value=s.value.filter(e=>e.id!==t),l.value.push(a),w())},O=()=>{l.value.forEach(t=>{(t.can_be_combined||s.value.length===0)&&D(t)})},w=()=>{s.value.length>0?b("promotions-applied",s.value,x.value):b("promotions-removed")};return j(()=>[_.cartItems,_.subtotal],()=>{g()},{deep:!0}),G(()=>{g()}),F({loadAvailablePromotions:g,appliedPromotions:z(()=>s.value),totalPromotionDiscount:x}),(t,a)=>l.value.length>0||s.value.length>0?(r(),d("div",W,[s.value.length>0?(r(),d("div",Y,[(r(!0),d(T,null,B(s.value,e=>(r(),h(Q,{key:e.id,type:"success",variant:"tonal",class:"mb-2"},{prepend:n(()=>[i(v,{icon:"mdi-speakerphone"})]),default:n(()=>[o("div",Z,[o("div",null,[o("div",ee,c(e.name),1),o("div",te,c(e.description),1),o("div",ae," Hemat: "+c(P(e.calculated_discount||0)),1)]),i(y,{icon:"mdi-close",variant:"text",size:"small",onClick:I=>V(e.id)},null,8,["onClick"])])]),_:2},1024))),128))])):p("",!0),l.value.length>0?(r(),h(S,{key:1,class:"promotion-suggestions-card mb-4",variant:"tonal",color:"purple-lighten-5"},{default:n(()=>[i(X,{class:"text-h6 pb-2"},{default:n(()=>[i(v,{icon:"mdi-speakerphone",size:"20",class:"me-2"}),a[0]||(a[0]=u(" Promosi Tersedia ")),l.value.length>0?(r(),h(A,{key:0,size:"small",color:"purple",class:"ms-2"},{default:n(()=>[u(c(l.value.length),1)]),_:1})):p("",!0)]),_:1,__:[0]}),i(M,{class:"pt-0"},{default:n(()=>[a[2]||(a[2]=o("div",{class:"text-caption mb-3 text-medium-emphasis"}," Promosi yang bisa diterapkan pada pesanan ini: ",-1)),o("div",se,[(r(!0),d(T,null,B(l.value,e=>(r(),d("div",{key:e.id,class:"promotion-item"},[i(S,{variant:"outlined",class:J(["promotion-card",{"promotion-selected":m(e.id)}]),onClick:I=>C(e)},{default:n(()=>[i(M,{class:"pa-3"},{default:n(()=>[o("div",oe,[o("div",ie,[o("div",le,c(e.name),1),o("div",ne,c(e.description),1),i(A,{size:"x-small",color:$(e.type),variant:"tonal",class:"me-2 mb-2"},{default:n(()=>[u(c(E(e.type)),1)]),_:2},1032,["color"]),o("div",re,[i(v,{icon:"mdi-tag",size:"14",class:"me-1"}),u(" Hemat: "+c(P(e.calculated_discount||0)),1)]),e.valid_until?(r(),d("div",ce,[i(v,{icon:"mdi-clock-outline",size:"12",class:"me-1"}),u(" Berlaku hingga: "+c(L(e.valid_until)),1)])):p("",!0)]),o("div",de,[i(y,{color:m(e.id)?"error":"purple",variant:m(e.id)?"outlined":"flat",size:"small",onClick:K(I=>C(e),["stop"])},{default:n(()=>[u(c(m(e.id)?"Hapus":"Terapkan"),1)]),_:2},1032,["color","variant","onClick"])])])]),_:2},1024)]),_:2},1032,["class","onClick"])]))),128))]),l.value.length>1?(r(),d("div",ue,[i(y,{color:"purple",variant:"outlined",size:"small",onClick:O},{default:n(()=>[i(v,{icon:"mdi-plus-circle",class:"me-1"}),a[1]||(a[1]=u(" Terapkan Semua Promosi "))]),_:1,__:[1]})])):p("",!0)]),_:1,__:[2]})]),_:1})):p("",!0)])):p("",!0)}}),ke=U(me,[["__scopeId","data-v-5c7d09ed"]]);export{ke as default};
