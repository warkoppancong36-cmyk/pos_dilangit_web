import{d as W,ax as Y,r as v,V as g,w as Z,g as p,f as a,o as m,b as e,e as c,X as y,t as i,l as B,c as F,F as ee,i as te,s as _,$ as ae,ap as q,aq as A,v as oe,a0 as D}from"./main-CMNvPLty.js";import{V as re}from"./VDialog-B3yKZNaL.js";import{V as h,b as le,c as se}from"./VCard-CjRRjTgv.js";import{V as M}from"./VDivider-pzN01gXd.js";import{V as U}from"./VCardText-bGyMMsii.js";import{V as ie}from"./VAlert-DIbW89LB.js";import{V as de}from"./VForm-DRTtaeev.js";import{V as N,a as n}from"./VRow-kae_AdaA.js";import{V as L}from"./VAutocomplete-D-iswi9B.js";import{a as T,b as z,d as E}from"./VList-CtHCAvpl.js";import{V as R}from"./VAvatar-CA5skmrX.js";import{V as $}from"./VImg-BDEhD1Jl.js";import{V as j}from"./VTextField-DadgF75n.js";import{V as ne}from"./VSwitch-BvXWPm6o.js";import{V as ue}from"./VTextarea-B8M4lALV.js";import{V as me}from"./VSpacer-BrR20M9D.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VOverlay-Ch6tHIwE.js";import"./forwardRefs-B931MWyl.js";/* empty css              */import"./VSelect-D8eUwfQ_.js";import"./VMenu-DY0lE7x_.js";import"./VCheckboxBtn-B0wsi2Ee.js";import"./VSelectionControl-BBY-XjB4.js";import"./VChip-jknG03ve.js";import"./filter-DBNRixLZ.js";const pe={class:"text-h6 font-weight-bold"},_e={class:"text-h6 font-weight-bold text-primary"},fe=W({__name:"BaseProductCompositionModal",props:{show:{type:Boolean},composition:{},baseProducts:{},baseProductsLoading:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1}},emits:["close","save"],setup(O,{emit:Q}){const f=O,X=Q,r=Y({base_product_id:"",ingredient_base_product_id:"",quantity:0,notes:"",is_active:!0}),b=v(!1),d=v({}),V=v(null),u=v(null),G=g(()=>f.baseProducts.filter(o=>o.id_base_product!==r.base_product_id)),H=g(()=>r.base_product_id&&r.ingredient_base_product_id&&r.quantity>0),w=g(()=>!u.value||!r.quantity?0:parseFloat(u.value.cost_per_unit)*parseFloat(r.quantity)),C=g(()=>{if(!u.value||!r.quantity)return 0;const o=parseFloat(u.value.current_stock)||0,t=parseFloat(r.quantity)||0;return t>0?Math.floor(o/t):0}),J=()=>{Object.keys(r).forEach(o=>{o==="is_active"?r[o]=!0:r[o]=""}),V.value=null,u.value=null,d.value={}},x=()=>{const o=r.base_product_id;o?V.value=f.baseProducts.find(t=>t.id_base_product==o):V.value=null},k=()=>{const o=r.ingredient_base_product_id;o?u.value=f.baseProducts.find(t=>t.id_base_product==o):u.value=null};Z(()=>f.composition,o=>{o?(Object.keys(r).forEach(t=>{r[t]=o[t]||(t==="is_active"?!0:"")}),x(),k()):J(),d.value={}},{immediate:!0});const K=()=>{},P=o=>new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:3}).format(o||0),I=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o||0),S=async()=>{b.value=!0,d.value={};try{const o={base_product_id:r.base_product_id,ingredient_base_product_id:r.ingredient_base_product_id,quantity:r.quantity,notes:r.notes,is_active:r.is_active};X("save",o)}catch(o){console.error("Error submitting composition:",o)}finally{b.value=!1}};return(o,t)=>(m(),p(re,{"model-value":o.show,"max-width":"800px",persistent:"",scrollable:"","onUpdate:modelValue":t[6]||(t[6]=l=>!l&&o.$emit("close"))},{default:a(()=>[e(h,null,{default:a(()=>[e(le,{class:"d-flex align-center gap-2"},{default:a(()=>[e(y,{icon:"tabler-vector-triangle",class:"text-primary"}),c("span",null,i(o.editMode?"Edit":"Add")+" Base Product Composition",1)]),_:1}),e(M),e(U,null,{default:a(()=>[Object.keys(d.value).length>0?(m(),p(ie,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:a(()=>[(m(!0),F(ee,null,te(d.value,(l,s)=>(m(),F("div",{key:s},[c("strong",null,i(s)+":",1),_(" "+i(Array.isArray(l)?l[0]:l),1)]))),128))]),_:1})):B("",!0),e(de,{onSubmit:ae(S,["prevent"])},{default:a(()=>[e(N,null,{default:a(()=>[e(n,{cols:"12",md:"6"},{default:a(()=>[e(L,{modelValue:r.base_product_id,"onUpdate:modelValue":[t[0]||(t[0]=l=>r.base_product_id=l),x],items:o.baseProducts,loading:o.baseProductsLoading,"item-title":"name","item-value":"id_base_product",label:"Main Base Product",placeholder:"Select base product","prepend-inner-icon":"tabler-package",clearable:"","error-messages":d.value.base_product_id},{item:a(({props:l,item:s})=>[e(T,q(A(l)),{prepend:a(()=>[e(R,{size:"30"},{default:a(()=>[s.raw.image_url?(m(),p($,{key:0,src:s.raw.image_url,alt:s.raw.name},null,8,["src","alt"])):(m(),p(y,{key:1,icon:"tabler-package",size:"16"}))]),_:2},1024)]),default:a(()=>[e(z,null,{default:a(()=>[_(i(s.raw.name),1)]),_:2},1024),e(E,null,{default:a(()=>[_(" Stock: "+i(P(s.raw.current_stock))+" "+i(s.raw.unit)+" | "+i(s.raw.formatted_cost),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","error-messages"])]),_:1}),e(n,{cols:"12",md:"6"},{default:a(()=>[e(L,{modelValue:r.ingredient_base_product_id,"onUpdate:modelValue":[t[1]||(t[1]=l=>r.ingredient_base_product_id=l),k],items:G.value,loading:o.baseProductsLoading,"item-title":"name","item-value":"id_base_product",label:"Ingredient Base Product",placeholder:"Select ingredient","prepend-inner-icon":"tabler-bottle",clearable:"","error-messages":d.value.ingredient_base_product_id},{item:a(({props:l,item:s})=>[e(T,q(A(l)),{prepend:a(()=>[e(R,{size:"30"},{default:a(()=>[s.raw.image_url?(m(),p($,{key:0,src:s.raw.image_url,alt:s.raw.name},null,8,["src","alt"])):(m(),p(y,{key:1,icon:"tabler-bottle",size:"16"}))]),_:2},1024)]),default:a(()=>[e(z,null,{default:a(()=>[_(i(s.raw.name),1)]),_:2},1024),e(E,null,{default:a(()=>[_(" Stock: "+i(P(s.raw.current_stock))+" "+i(s.raw.unit)+" | "+i(s.raw.formatted_cost),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","error-messages"])]),_:1}),e(n,{cols:"12",md:"4"},{default:a(()=>[e(j,{modelValue:r.quantity,"onUpdate:modelValue":t[2]||(t[2]=l=>r.quantity=l),modelModifiers:{number:!0},type:"number",label:"Quantity Required",placeholder:"0","prepend-inner-icon":"tabler-hash",step:"0.001",min:"0","error-messages":d.value.quantity,onInput:K},null,8,["modelValue","error-messages"])]),_:1}),e(n,{cols:"12",md:"4"},{default:a(()=>{var l;return[e(j,{"model-value":((l=u.value)==null?void 0:l.unit)||"",label:"Unit",readonly:"","prepend-inner-icon":"tabler-ruler",placeholder:"Select ingredient first"},null,8,["model-value"])]}),_:1}),e(n,{cols:"12",md:"4"},{default:a(()=>[e(ne,{modelValue:r.is_active,"onUpdate:modelValue":t[3]||(t[3]=l=>r.is_active=l),label:"Active",color:"success","error-messages":d.value.is_active},null,8,["modelValue","error-messages"])]),_:1}),w.value>0?(m(),p(n,{key:0,cols:"12"},{default:a(()=>[e(h,{variant:"tonal",color:"info"},{default:a(()=>[e(U,null,{default:a(()=>[t[10]||(t[10]=c("div",{class:"text-subtitle-2 mb-2"},"Cost Calculation",-1)),e(N,null,{default:a(()=>[e(n,{cols:"12",md:"4"},{default:a(()=>{var l;return[t[7]||(t[7]=c("div",{class:"text-caption text-medium-emphasis"},"Cost per Unit:",-1)),c("div",pe,i(I(((l=u.value)==null?void 0:l.cost_per_unit)||0)),1)]}),_:1,__:[7]}),e(n,{cols:"12",md:"4"},{default:a(()=>[t[8]||(t[8]=c("div",{class:"text-caption text-medium-emphasis"},"Total Cost:",-1)),c("div",_e,i(I(w.value)),1)]),_:1,__:[8]}),e(n,{cols:"12",md:"4"},{default:a(()=>[t[9]||(t[9]=c("div",{class:"text-caption text-medium-emphasis"},"Available Stock:",-1)),c("div",{class:oe(["text-h6 font-weight-bold",C.value>0?"text-success":"text-error"])},i(C.value)+" portions ",3)]),_:1,__:[9]})]),_:1})]),_:1,__:[10]})]),_:1})]),_:1})):B("",!0),e(n,{cols:"12"},{default:a(()=>[e(ue,{modelValue:r.notes,"onUpdate:modelValue":t[4]||(t[4]=l=>r.notes=l),label:"Notes",placeholder:"Add any notes about this composition...",rows:"3","error-messages":d.value.notes},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),e(M),e(se,null,{default:a(()=>[e(me),e(D,{variant:"outlined",onClick:t[5]||(t[5]=l=>o.$emit("close")),disabled:b.value},{default:a(()=>t[11]||(t[11]=[_(" Cancel ")])),_:1,__:[11]},8,["disabled"]),e(D,{color:"primary",onClick:S,loading:b.value,disabled:!H.value},{default:a(()=>[_(i(o.editMode?"Update":"Save")+" Composition ",1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),$e=ce(fe,[["__scopeId","data-v-8419a9df"]]);export{$e as default};
