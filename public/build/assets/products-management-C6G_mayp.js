import{D as At}from"./DeleteConfirmationDialog-DU40PGCR.js";import{f as mt}from"./formatters-BD6tdLx_.js";import{P as ct,u as ta}from"./useProductItems-CyK3x3jm.js";import{I as aa}from"./ItemsApi-DNw3HUxS.js";import{H as la,u as oa}from"./HPPBreakdownDialog-RvRG2YkV.js";import{V as Be}from"./VDialog-DA9uXlJL.js";import{V as ie,b as Ve,c as Fe}from"./VCard-CSPvKRXN.js";import{cq as Et,a8 as Ye,a9 as Je,as as na,aF as sa,af as zt,bT as ia,r as F,V as re,aG as Ge,w as be,W as je,b as e,a0 as R,aa as Qe,ak as ra,ab as Ht,ac as Mt,H as Bt,ba as ua,L as da,N as Ft,bZ as ca,b_ as ma,b9 as nt,aJ as gt,I as va,ag as Rt,aM as pt,bj as pa,bt as It,p as he,be as ht,cr as fa,c8 as $t,bh as ga,F as Te,X as $,cp as _a,c9 as ka,aI as ya,s as v,cs as ba,a$ as ha,ad as xa,aH as Va,b3 as wa,b5 as Pa,d as He,D as it,c as de,f as t,e as a,t as d,g as j,l as oe,m as A,v as Xe,i as Ze,o as h,aw as Kt,ax as _t,$ as xt,j as Nt,ct as Ca,aA as Ee,a5 as ft}from"./main-Da4xyuwT.js";import{V as ve}from"./VCardText-D1a_b7Mf.js";import{V as Ie}from"./VAvatar-be4aeiZH.js";import{V as pe,m as Ia,b as St}from"./VChip-j-9rL_Fg.js";import{V as Pe,a as M}from"./VRow-BLch9Uge.js";import{V as qt}from"./VAutocomplete-Dn8PXTem.js";import{u as $a,e as Sa,t as lt,V as Vt,a as et,b as kt,d as yt}from"./VList-BnJA8fj6.js";import{u as Da,V as xe,m as Ta}from"./VTextField-C3l0XiDS.js";import{V as st}from"./VSwitch-B2Q6zfcA.js";import{V as Ne}from"./VSpacer-CKT2YD-I.js";import{V as tt}from"./VSnackbar-Cqz7pAgM.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Ua,m as Aa,a as Ea,V as Ke}from"./VSelect-DlzYwt-f.js";import{V as za}from"./VCheckbox-ComABeBu.js";import{V as Re,a as Dt}from"./VAlert-rn8ajscK.js";import{V as Ce}from"./VDivider-_3vHiK3s.js";import{V as Ha}from"./VContainer-ROe0XFw6.js";import{a as Lt,u as Ma,P as Ba}from"./useProducts-D8fuKskK.js";import{V as wt}from"./VForm-DrI6iExp.js";import{V as Tt}from"./VTextarea-Be2upRm8.js";import{V as Le}from"./VTooltip-D9iRmU8g.js";import{M as Fa,m as Ra,V as Ka}from"./VImg-Cxtrb9TK.js";import{V as Na,u as qa}from"./useCategories-C9PMaHAF.js";import{u as La,m as Oa,h as ja}from"./filter-CXnWnbP4.js";import{f as Ot,a as Ga,s as Wa}from"./forwardRefs-B931MWyl.js";import{V as Xa}from"./VMenu-BKTl6_bP.js";import{V as Ya}from"./VCheckboxBtn-BkGafoDx.js";import{V as Ja}from"./VDataTableServer-DBXSuSsz.js";import{V as Qa}from"./VSkeletonLoader-mxXfDvZU.js";import{V as jt}from"./VDataTable-CTIEARsL.js";import{c as Za,d as el,u as tl}from"./VOverlay-Cf2orVKb.js";import"./ProductsApi-BUgu9KO4.js";import"./api-tslN9hes.js";import"./index-D-EbNoF1.js";/* empty css              */import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-D6DuVvJ2.js";import"./VTable-HCTzw8Tk.js";const al=l=>{const{touchstartX:T,touchendX:i,touchstartY:r,touchendY:C}=l,p=.5,b=16;l.offsetX=i-T,l.offsetY=C-r,Math.abs(l.offsetY)<p*Math.abs(l.offsetX)&&(l.left&&i<T-b&&l.left(l),l.right&&i>T+b&&l.right(l)),Math.abs(l.offsetX)<p*Math.abs(l.offsetY)&&(l.up&&C<r-b&&l.up(l),l.down&&C>r+b&&l.down(l))};function ll(l,T){var r;const i=l.changedTouches[0];T.touchstartX=i.clientX,T.touchstartY=i.clientY,(r=T.start)==null||r.call(T,{originalEvent:l,...T})}function ol(l,T){var r;const i=l.changedTouches[0];T.touchendX=i.clientX,T.touchendY=i.clientY,(r=T.end)==null||r.call(T,{originalEvent:l,...T}),al(T)}function nl(l,T){var r;const i=l.changedTouches[0];T.touchmoveX=i.clientX,T.touchmoveY=i.clientY,(r=T.move)==null||r.call(T,{originalEvent:l,...T})}function sl(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const T={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:l.left,right:l.right,up:l.up,down:l.down,start:l.start,move:l.move,end:l.end};return{touchstart:i=>ll(i,T),touchend:i=>ol(i,T),touchmove:i=>nl(i,T)}}function il(l,T){var u;const i=T.value,r=i!=null&&i.parent?l.parentElement:l,C=(i==null?void 0:i.options)??{passive:!0},p=(u=T.instance)==null?void 0:u.$.uid;if(!r||!p)return;const b=sl(T.value);r._touchHandlers=r._touchHandlers??Object.create(null),r._touchHandlers[p]=b,Et(b).forEach(o=>{r.addEventListener(o,b[o],C)})}function rl(l,T){var p,b;const i=(p=T.value)!=null&&p.parent?l.parentElement:l,r=(b=T.instance)==null?void 0:b.$.uid;if(!(i!=null&&i._touchHandlers)||!r)return;const C=i._touchHandlers[r];Et(C).forEach(u=>{i.removeEventListener(u,C[u])}),delete i._touchHandlers[r]}const Gt={mounted:il,unmounted:rl},Wt=Symbol.for("vuetify:v-window"),Xt=Symbol.for("vuetify:v-window-group"),Yt=Je({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:l=>typeof l=="boolean"||l==="hover"},touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},...Mt(),...Ht(),...ra()},"VWindow"),bt=Ye()({name:"VWindow",directives:{Touch:Gt},props:Yt(),emits:{"update:modelValue":l=>!0},setup(l,T){let{slots:i}=T;const{themeClasses:r}=na(l),{isRtl:C}=sa(),{t:p}=zt(),b=ia(l,Xt),u=F(),o=re(()=>C.value?!l.reverse:l.reverse),n=Ge(!1),Q=re(()=>{const V=l.direction==="vertical"?"y":"x",L=(o.value?!n.value:n.value)?"-reverse":"";return`v-window-${V}${L}-transition`}),x=Ge(0),K=F(void 0),Y=re(()=>b.items.value.findIndex(V=>b.selected.value.includes(V.id)));be(Y,(V,D)=>{const L=b.items.value.length,ne=L-1;L<=2?n.value=V<D:V===ne&&D===0?n.value=!0:V===0&&D===ne?n.value=!1:n.value=V<D}),da(Wt,{transition:Q,isReversed:n,transitionCount:x,transitionHeight:K,rootRef:u});const S=je(()=>l.continuous||Y.value!==0),f=je(()=>l.continuous||Y.value!==b.items.value.length-1);function G(){S.value&&b.prev()}function P(){f.value&&b.next()}const y=re(()=>{const V=[],D={icon:C.value?l.nextIcon:l.prevIcon,class:`v-window__${o.value?"right":"left"}`,onClick:b.prev,"aria-label":p("$vuetify.carousel.prev")};V.push(S.value?i.prev?i.prev({props:D}):e(R,D,null):e("div",null,null));const L={icon:C.value?l.prevIcon:l.nextIcon,class:`v-window__${o.value?"left":"right"}`,onClick:b.next,"aria-label":p("$vuetify.carousel.next")};return V.push(f.value?i.next?i.next({props:L}):e(R,L,null):e("div",null,null)),V}),E=re(()=>l.touch===!1?l.touch:{...{left:()=>{o.value?G():P()},right:()=>{o.value?P():G()},start:D=>{let{originalEvent:L}=D;L.stopPropagation()}},...l.touch===!0?{}:l.touch});return Qe(()=>Bt(e(l.tag,{ref:u,class:["v-window",{"v-window--show-arrows-on-hover":l.showArrows==="hover"},r.value,l.class],style:l.style},{default:()=>{var V,D;return[e("div",{class:"v-window__container",style:{height:K.value}},[(V=i.default)==null?void 0:V.call(i,{group:b}),l.showArrows!==!1&&e("div",{class:"v-window__controls"},[y.value])]),(D=i.additional)==null?void 0:D.call(i,{group:b})]}}),[[ua("touch"),E.value]])),{group:b}}}),Jt=Je({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...Mt(),...ma(),...el()},"VWindowItem"),ot=Ye()({name:"VWindowItem",directives:{Touch:Gt},props:Jt(),emits:{"group:selected":l=>!0},setup(l,T){let{slots:i}=T;const r=Ft(Wt),C=ca(l,Xt),{isBooted:p}=$a();if(!r||!C)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const b=Ge(!1),u=re(()=>p.value&&(r.isReversed.value?l.reverseTransition!==!1:l.transition!==!1));function o(){!b.value||!r||(b.value=!1,r.transitionCount.value>0&&(r.transitionCount.value-=1,r.transitionCount.value===0&&(r.transitionHeight.value=void 0)))}function n(){var S;b.value||!r||(b.value=!0,r.transitionCount.value===0&&(r.transitionHeight.value=gt((S=r.rootRef.value)==null?void 0:S.clientHeight)),r.transitionCount.value+=1)}function Q(){o()}function x(S){b.value&&nt(()=>{!u.value||!b.value||!r||(r.transitionHeight.value=gt(S.clientHeight))})}const K=re(()=>{const S=r.isReversed.value?l.reverseTransition:l.transition;return u.value?{name:typeof S!="string"?r.transition.value:S,onBeforeEnter:n,onAfterEnter:o,onEnterCancelled:Q,onBeforeLeave:n,onAfterLeave:o,onLeaveCancelled:Q,onEnter:x}:!1}),{hasContent:Y}=Za(l,C.isSelected);return Qe(()=>e(Fa,{transition:K.value,disabled:!p.value},{default:()=>{var S;return[Bt(e("div",{class:["v-window-item",C.selectedClass.value,l.class],style:l.style},[Y.value&&((S=i.default)==null?void 0:S.call(i))]),[[va,C.isSelected.value]])]}})),{groupItem:C}}}),ul=Je({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Oa({filterKeys:["title"]}),...Aa({hideNoData:!0,returnObject:!0}),...ht(Ta({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Ra({transition:!1})},"VCombobox"),dl=Ye()({name:"VCombobox",props:ul(),emits:{"update:focused":l=>!0,"update:modelValue":l=>!0,"update:search":l=>!0,"update:menu":l=>!0},setup(l,T){var Z;let{emit:i,slots:r}=T;const{t:C}=zt(),p=F(),b=Ge(!1),u=Ge(!0),o=Ge(!1),n=F(),Q=F(),x=Ge(-1);let K=!1;const{items:Y,transformIn:S,transformOut:f}=Sa(l),{textColorClasses:G,textColorStyles:P}=Rt(()=>{var s;return(s=p.value)==null?void 0:s.color}),y=pt(l,"modelValue",[],s=>S(pa(s)),s=>{const B=f(s);return l.multiple?B:B[0]??null}),E=Da(l),V=re(()=>!!(l.chips||r.chip)),D=re(()=>V.value||!!r.selection),L=Ge(!l.multiple&&!D.value?((Z=y.value[0])==null?void 0:Z.title)??"":""),ne=re({get:()=>L.value,set:s=>{var B;if(L.value=s??"",!l.multiple&&!D.value&&(y.value=[lt(l,s)]),s&&l.multiple&&((B=l.delimiters)!=null&&B.length)){const X=s.split(new RegExp(`(?:${l.delimiters.join("|")})+`));X.length>1&&(X.forEach(te=>{te=te.trim(),te&&ue(lt(l,te))}),L.value="")}s||(x.value=-1),u.value=!s}}),ee=re(()=>typeof l.counterValue=="function"?l.counterValue(y.value):typeof l.counterValue=="number"?l.counterValue:l.multiple?y.value.length:ne.value.length),{filteredItems:w,getMatches:I}=La(l,Y,()=>u.value?"":ne.value),O=re(()=>l.hideSelected?w.value.filter(s=>!y.value.some(B=>B.value===s.value)):w.value),me=re(()=>l.hideNoData&&!O.value.length||E.isReadonly.value||E.isDisabled.value),q=pt(l,"menu"),N=re({get:()=>q.value,set:s=>{var B;q.value&&!s&&((B=n.value)!=null&&B.Î¨openChildren.size)||s&&me.value||(q.value=s)}}),J=je(()=>N.value?l.closeText:l.openText);be(L,s=>{K?nt(()=>K=!1):b.value&&!N.value&&(N.value=!0),i("update:search",s)}),be(y,s=>{var B;!l.multiple&&!D.value&&(L.value=((B=s[0])==null?void 0:B.title)??"")});const g=re(()=>y.value.map(s=>s.value)),z=re(()=>{var B;return(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&ne.value===((B=O.value[0])==null?void 0:B.title))&&O.value.length>0&&!u.value&&!o.value}),k=F(),c=Ua(k,p);function m(s){K=!0,l.openOnClear&&(N.value=!0)}function _(){me.value||(N.value=!0)}function ce(s){me.value||(b.value&&(s.preventDefault(),s.stopPropagation()),N.value=!N.value)}function we(s){var B;s.key!==" "&&$t(s)&&((B=p.value)==null||B.focus())}function ye(s){var te,H,ae,se;if(fa(s)||E.isReadonly.value)return;const B=(te=p.value)==null?void 0:te.selectionStart,X=y.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(s.key)&&s.preventDefault(),["Enter","ArrowDown"].includes(s.key)&&(N.value=!0),["Escape"].includes(s.key)&&(N.value=!1),["Enter","Escape","Tab"].includes(s.key)&&(z.value&&["Enter","Tab"].includes(s.key)&&!y.value.some(U=>{let{value:fe}=U;return fe===O.value[0].value})&&ue(w.value[0]),u.value=!0),s.key==="ArrowDown"&&z.value&&((H=k.value)==null||H.focus("next")),s.key==="Enter"&&ne.value&&(ue(lt(l,ne.value)),D.value&&(L.value="")),["Backspace","Delete"].includes(s.key)){if(!l.multiple&&D.value&&y.value.length>0&&!ne.value)return ue(y.value[0],!1);if(~x.value){s.preventDefault();const U=x.value;ue(y.value[x.value],!1),x.value=U>=X-1?X-2:U}else s.key==="Backspace"&&!ne.value&&(x.value=X-1);return}if(l.multiple)if(s.key==="ArrowLeft"){if(x.value<0&&B&&B>0)return;const U=x.value>-1?x.value-1:X-1;y.value[U]?x.value=U:(x.value=-1,(ae=p.value)==null||ae.setSelectionRange(ne.value.length,ne.value.length))}else if(s.key==="ArrowRight"){if(x.value<0)return;const U=x.value+1;y.value[U]?x.value=U:(x.value=-1,(se=p.value)==null||se.setSelectionRange(0,0))}else~x.value&&$t(s)&&(x.value=-1)}function W(){var s;l.eager&&((s=Q.value)==null||s.calculateVisibleItems())}function ke(){var s;b.value&&(u.value=!0,(s=p.value)==null||s.focus())}function ue(s){let B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!s||s.props.disabled))if(l.multiple){const X=y.value.findIndex(H=>(l.valueComparator||It)(H.value,s.value)),te=B??!~X;if(~X){const H=te?[...y.value,s]:[...y.value];H.splice(X,1),y.value=H}else te&&(y.value=[...y.value,s]);l.clearOnSelect&&(ne.value="")}else{const X=B!==!1;y.value=X?[s]:[],L.value=X&&!D.value?s.title:"",nt(()=>{N.value=!1,u.value=!0})}}function Ue(s){b.value=!0,setTimeout(()=>{o.value=!0})}function $e(s){o.value=!1}function Se(s){(s==null||s===""&&!l.multiple&&!D.value)&&(y.value=[])}return be(b,(s,B)=>{if(!(s||s===B)&&(x.value=-1,N.value=!1,ne.value)){if(l.multiple){ue(lt(l,ne.value));return}if(!D.value)return;y.value.some(X=>{let{title:te}=X;return te===ne.value})?L.value="":ue(lt(l,ne.value))}}),be(N,()=>{if(!l.hideSelected&&N.value&&y.value.length){const s=O.value.findIndex(B=>y.value.some(X=>(l.valueComparator||It)(X.value,B.value)));ga&&window.requestAnimationFrame(()=>{var B;s>=0&&((B=Q.value)==null||B.scrollToIndex(s))})}}),be(()=>l.items,(s,B)=>{N.value||b.value&&!B.length&&s.length&&(N.value=!0)}),Qe(()=>{const s=!!(!l.hideNoData||O.value.length||r["prepend-item"]||r["append-item"]||r["no-data"]),B=y.value.length>0,X=xe.filterProps(l);return e(xe,he({ref:p},X,{modelValue:ne.value,"onUpdate:modelValue":[te=>ne.value=te,Se],focused:b.value,"onUpdate:focused":te=>b.value=te,validationValue:y.externalValue,counterValue:ee.value,dirty:B,class:["v-combobox",{"v-combobox--active-menu":N.value,"v-combobox--chips":!!l.chips,"v-combobox--selection-slot":!!D.value,"v-combobox--selecting-index":x.value>-1,[`v-combobox--${l.multiple?"multiple":"single"}`]:!0},l.class],style:l.style,readonly:E.isReadonly.value,placeholder:B?void 0:l.placeholder,"onClick:clear":m,"onMousedown:control":_,onKeydown:ye}),{...r,default:()=>e(Te,null,[e(Xa,he({ref:n,modelValue:N.value,"onUpdate:modelValue":te=>N.value=te,activator:"parent",contentClass:"v-combobox__content",disabled:me.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:l.transition,onAfterEnter:W,onAfterLeave:ke},l.menuProps),{default:()=>[s&&e(Vt,he({ref:k,selected:g.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:te=>te.preventDefault(),onKeydown:we,onFocusin:Ue,onFocusout:$e,tabindex:"-1","aria-live":"polite",color:l.itemColor??l.color},c,l.listProps),{default:()=>{var te,H,ae;return[(te=r["prepend-item"])==null?void 0:te.call(r),!O.value.length&&!l.hideNoData&&(((H=r["no-data"])==null?void 0:H.call(r))??e(et,{key:"no-data",title:C(l.noDataText)},null)),e(Ea,{ref:Q,renderless:!0,items:O.value,itemKey:"value"},{default:se=>{var Me;let{item:U,index:fe,itemRef:ge}=se;const Ae=he(U.props,{ref:ge,key:U.value,active:z.value&&fe===0?!0:void 0,onClick:()=>ue(U,null)});return((Me=r.item)==null?void 0:Me.call(r,{item:U,index:fe,props:Ae}))??e(et,he(Ae,{role:"option"}),{prepend:ze=>{let{isSelected:qe}=ze;return e(Te,null,[l.multiple&&!l.hideSelected?e(Ya,{key:U.value,modelValue:qe,ripple:!1,tabindex:"-1"},null):void 0,U.props.prependAvatar&&e(Ie,{image:U.props.prependAvatar},null),U.props.prependIcon&&e($,{icon:U.props.prependIcon},null)])},title:()=>{var ze;return u.value?U.title:ja("v-combobox",U.title,(ze=I(U))==null?void 0:ze.title)}})}}),(ae=r["append-item"])==null?void 0:ae.call(r)]}})]}),y.value.map((te,H)=>{function ae(ge){ge.stopPropagation(),ge.preventDefault(),ue(te,!1)}const se={"onClick:close":ae,onKeydown(ge){ge.key!=="Enter"&&ge.key!==" "||(ge.preventDefault(),ge.stopPropagation(),ae(ge))},onMousedown(ge){ge.preventDefault(),ge.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},U=V.value?!!r.chip:!!r.selection,fe=U?ka(V.value?r.chip({item:te,index:H,props:se}):r.selection({item:te,index:H})):void 0;if(!(U&&!fe))return e("div",{key:te.value,class:["v-combobox__selection",H===x.value&&["v-combobox__selection--selected",G.value]],style:H===x.value?P.value:{}},[V.value?r.chip?e(ya,{key:"chip-defaults",defaults:{VChip:{closable:l.closableChips,size:"small",text:te.title}}},{default:()=>[fe]}):e(pe,he({key:"chip",closable:l.closableChips,size:"small",text:te.title,disabled:te.props.disabled},se),null):fe??e("span",{class:"v-combobox__selection-text"},[te.title,l.multiple&&H<y.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[v(",")])])])})]),"append-inner":function(){var se,U;for(var te=arguments.length,H=new Array(te),ae=0;ae<te;ae++)H[ae]=arguments[ae];return e(Te,null,[(se=r["append-inner"])==null?void 0:se.call(r,...H),(!l.hideNoData||l.items.length)&&l.menuIcon?e($,{class:"v-combobox__menu-icon",color:(U=p.value)==null?void 0:U.fieldIconColor,icon:l.menuIcon,onMousedown:ce,onClick:_a,"aria-label":C(J.value),title:C(J.value),tabindex:"-1"},null):void 0])}})}),Ot({isFocused:b,isPristine:u,menu:N,search:ne,selectionIndex:x,filteredItems:w,select:ue},p)}}),Pt=Symbol.for("vuetify:v-tabs"),cl=Je({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...ht(ba({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),vt=Ye()({name:"VTab",props:cl(),setup(l,T){let{slots:i,attrs:r}=T;const{textColorClasses:C,textColorStyles:p}=Rt(()=>l.sliderColor),b=F(),u=F(),o=re(()=>l.direction==="horizontal"),n=re(()=>{var x,K;return((K=(x=b.value)==null?void 0:x.group)==null?void 0:K.isSelected.value)??!1});function Q(x){var Y,S;let{value:K}=x;if(K){const f=(S=(Y=b.value)==null?void 0:Y.$el.parentElement)==null?void 0:S.querySelector(".v-tab--selected .v-tab__slider"),G=u.value;if(!f||!G)return;const P=getComputedStyle(f).color,y=f.getBoundingClientRect(),E=G.getBoundingClientRect(),V=o.value?"x":"y",D=o.value?"X":"Y",L=o.value?"right":"bottom",ne=o.value?"width":"height",ee=y[V],w=E[V],I=ee>w?y[L]-E[L]:y[V]-E[V],O=Math.sign(I)>0?o.value?"right":"bottom":Math.sign(I)<0?o.value?"left":"top":"center",q=(Math.abs(I)+(Math.sign(I)<0?y[ne]:E[ne]))/Math.max(y[ne],E[ne])||0,N=y[ne]/E[ne]||0,J=1.5;Ga(G,{backgroundColor:[P,"currentcolor"],transform:[`translate${D}(${I}px) scale${D}(${N})`,`translate${D}(${I/J}px) scale${D}(${(q-1)/J+1})`,"none"],transformOrigin:Array(3).fill(O)},{duration:225,easing:Wa})}}return Qe(()=>{const x=R.filterProps(l);return e(R,he({symbol:Pt,ref:b,class:["v-tab",l.class],style:l.style,tabindex:n.value?0:-1,role:"tab","aria-selected":String(n.value),active:!1},x,r,{block:l.fixed,maxWidth:l.fixed?300:void 0,"onGroup:selected":Q}),{...i,default:()=>{var K;return e(Te,null,[((K=i.default)==null?void 0:K.call(i))??l.text,!l.hideSlider&&e("div",{ref:u,class:["v-tab__slider",C.value],style:p.value},null)])}})}),Ot({},b)}}),ml=Je({...ht(Yt(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),vl=Ye()({name:"VTabsWindow",props:ml(),emits:{"update:modelValue":l=>!0},setup(l,T){let{slots:i}=T;const r=Ft(Pt,null),C=pt(l,"modelValue"),p=re({get(){var b;return C.value!=null||!r?C.value:(b=r.items.value.find(u=>r.selected.value.includes(u.id)))==null?void 0:b.value},set(b){C.value=b}});return Qe(()=>{const b=bt.filterProps(l);return e(bt,he({_as:"VTabsWindow"},b,{modelValue:p.value,"onUpdate:modelValue":u=>p.value=u,class:["v-tabs-window",l.class],style:l.style,mandatory:!1,touch:!1}),i)}),{}}}),pl=Je({...Jt()},"VTabsWindowItem"),fl=Ye()({name:"VTabsWindowItem",props:pl(),setup(l,T){let{slots:i}=T;return Qe(()=>{const r=ot.filterProps(l);return e(ot,he({_as:"VTabsWindowItem"},r,{class:["v-tabs-window-item",l.class],style:l.style}),i)}),{}}});function gl(l){return l?l.map(T=>Pa(T)?T:{text:T,value:T}):[]}const _l=Je({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...Ia({mandatory:"force",selectedClass:"v-tab-item--selected"}),...wa(),...Ht()},"VTabs"),kl=Ye()({name:"VTabs",props:_l(),emits:{"update:modelValue":l=>!0},setup(l,T){let{attrs:i,slots:r}=T;const C=pt(l,"modelValue"),p=re(()=>gl(l.items)),{densityClasses:b}=ha(l),{backgroundColorClasses:u,backgroundColorStyles:o}=xa(()=>l.bgColor),{scopeId:n}=tl();return Va({VTab:{color:je(()=>l.color),direction:je(()=>l.direction),stacked:je(()=>l.stacked),fixed:je(()=>l.fixedTabs),sliderColor:je(()=>l.sliderColor),hideSlider:je(()=>l.hideSlider)}}),Qe(()=>{const Q=St.filterProps(l),x=!!(r.window||l.items.length>0);return e(Te,null,[e(St,he(Q,{modelValue:C.value,"onUpdate:modelValue":K=>C.value=K,class:["v-tabs",`v-tabs--${l.direction}`,`v-tabs--align-tabs-${l.alignTabs}`,{"v-tabs--fixed-tabs":l.fixedTabs,"v-tabs--grow":l.grow,"v-tabs--stacked":l.stacked},b.value,u.value,l.class],style:[{"--v-tabs-height":gt(l.height)},o.value,l.style],role:"tablist",symbol:Pt},n,i),{default:()=>{var K;return[((K=r.default)==null?void 0:K.call(r))??p.value.map(Y=>{var S;return((S=r.tab)==null?void 0:S.call(r,{item:Y}))??e(vt,he(Y,{key:Y.text,value:Y.value}),{default:r[`tab.${Y.value}`]?()=>{var f;return(f=r[`tab.${Y.value}`])==null?void 0:f.call(r,{item:Y})}:void 0})})]}}),x&&e(vl,he({modelValue:C.value,"onUpdate:modelValue":K=>C.value=K,key:"tabs-window"},n),{default:()=>{var K;return[p.value.map(Y=>{var S;return((S=r.item)==null?void 0:S.call(r,{item:Y}))??e(fl,{value:Y.value},{default:()=>{var f;return(f=r[`item.${Y.value}`])==null?void 0:f.call(r,{item:Y})}})}),(K=r.window)==null?void 0:K.call(r)]}})])}),{}}}),yl={class:"d-flex align-center gap-3"},bl={class:"text-body-2 ma-0 opacity-90"},hl={class:"d-flex align-center gap-4"},xl={class:"flex-grow-1"},Vl={class:"text-h6 font-weight-bold mb-1"},wl={class:"text-body-2 text-medium-emphasis mb-1"},Pl={class:"text-body-2 text-medium-emphasis mb-0"},Cl={class:"d-flex align-center justify-space-between w-100"},Il={class:"d-flex align-center"},$l={key:0,class:"text-error"},Sl={key:1},Dl={key:0,class:"text-center pa-8"},Tl={class:"d-flex align-center gap-4 mt-1"},Ul={key:1,class:"text-primary"},Al={class:"d-flex gap-2"},El=He({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup(l,{emit:T}){const i=l,r=T,C=re({get:()=>i.modelValue,set:m=>r("update:modelValue",m)}),p=F(!1),b=F([]),u=F(!1),o=F(!1),n=F(""),Q=F(""),x=F(!1),K=F(-1),Y=F(!1),S=F({itemId:null,quantity:1,unit:"pcs",isCritical:!1}),f=F([]),G=F(!1),P=async()=>{var m;if(i.product)try{const _=i.product.id_product||i.product.id;console.log("ðŸ”„ Fetching composition for product ID:",_);const ce=await ct.getAll({product_id:_,page:1,per_page:100});ce.success&&((m=ce.data)!=null&&m.data)&&(console.log("ðŸ“¦ Raw composition items from API:",ce.data.data.slice(0,2)),console.log("ðŸ“¦ Sample composition item structure:",JSON.stringify(ce.data.data[0],null,2)),b.value=ce.data.data)}catch(_){console.error("Error fetching product composition:",_)}},y=async()=>{var m;G.value=!0;try{const _=await aa.getAll({page:1,per_page:100,active:!0});_.success&&((m=_.data)!=null&&m.data)&&(console.log("ðŸ“¦ Raw available items from API:",_.data.data.slice(0,3)),f.value=_.data.data.map(ce=>{var we,ye,W;return{id:((we=ce.id_item)==null?void 0:we.toString())||((ye=ce.id)==null?void 0:ye.toString()),name:ce.name,current_stock:((W=ce.inventory)==null?void 0:W.current_stock)||0,unit:ce.unit||"pcs"}}),console.log("ðŸ“¦ Processed available items:",f.value.slice(0,3)))}catch(_){console.error("Error fetching available items:",_),f.value=[{id:"1",name:"Kopi Arabica",current_stock:100,unit:"kg"},{id:"2",name:"Susu Segar",current_stock:50,unit:"liter"},{id:"3",name:"Gula Pasir",current_stock:25,unit:"kg"},{id:"4",name:"Whipped Cream",current_stock:30,unit:"pcs"},{id:"5",name:"Sirup Vanilla",current_stock:20,unit:"botol"},{id:"6",name:"Tepung Terigu",current_stock:15,unit:"kg"},{id:"7",name:"Mentega",current_stock:10,unit:"pack"},{id:"8",name:"Coklat Powder",current_stock:8,unit:"kg"}]}finally{G.value=!1}},E=re(()=>S.value.itemId&&S.value.quantity>0&&S.value.unit.trim().length>0),V=re(()=>{if(!S.value.itemId)return null;const m=f.value.find(_=>_.id===S.value.itemId);return(m==null?void 0:m.unit)||null}),D=re(()=>Array.isArray(f.value)?f.value.filter(m=>L(m)>0):[]),L=m=>m.current_stock||m.stock||0,ne=()=>G.value?"Memuat items...":!f.value||f.value.length===0?"Tidak ada item tersedia":D.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",ee=m=>{const _=L(m);return _>50?"success":_>20?"warning":_>0?"error":"grey"},w=m=>{const _=L(m);return _>50?"Aman":_>20?"Rendah":_>0?"Kritis":"Habis"};be(()=>S.value.itemId,m=>{if(m){const _=f.value.find(ce=>ce.id===m);_!=null&&_.unit&&(S.value.unit=_.unit)}}),be(()=>i.items,m=>{console.log("ðŸ“‹ Props items changed:",m),m&&m.length>0&&console.log("ðŸ“‹ Sample item structure:",m[0]),b.value=[...m]},{immediate:!0}),be(()=>i.modelValue,m=>{m&&i.product&&(console.log("ðŸ”„ Dialog opened, fetching composition..."),P())}),it(()=>{y()});const I=()=>{Y.value=!0},O=()=>b.value.some(_=>{var ce;return((ce=_.item)==null?void 0:ce.inventory)&&_.item.inventory.current_stock<_.quantity_needed})?"error":"success",me=()=>b.value.some(_=>{var ce;return((ce=_.item)==null?void 0:ce.inventory)&&_.item.inventory.current_stock<_.quantity_needed})?"Stok Kritis":"Stok Aman",q=()=>{if(!E.value)return;const m=f.value.find(we=>we.id===S.value.itemId);if(!m)return;if(b.value.find(we=>{var ye;return((ye=we.item)==null?void 0:ye.id)===m.id})){n.value=`Item "${m.name}" sudah ada dalam komposisi produk ini`,u.value=!0;return}const ce={id_product_item:`temp_${Date.now()}`,item:{id:m.id,name:m.name,inventory:{current_stock:m.current_stock}},quantity_needed:S.value.quantity,unit:S.value.unit,is_critical:S.value.isCritical};b.value.push(ce),g()},N=(m,_)=>{var ye;if(console.log("ðŸ” EditItem called with:",m),console.log("ðŸ” Item structure:",JSON.stringify(m,null,2)),f.value.length===0){console.warn("âš ï¸ Available items not loaded yet, fetching..."),y().then(()=>{console.log("âœ… Available items loaded, retrying edit"),N(m,_)});return}x.value=!0,K.value=_;let ce=((ye=m.item)==null?void 0:ye.id)||null;ce!==null&&(ce=ce.toString()),console.log("ðŸŽ¯ Found itemId (converted to string):",ce),console.log("ðŸ” Available items for reference:",f.value.map(W=>({id:W.id,name:W.name}))),S.value={itemId:ce,quantity:m.quantity_needed,unit:m.unit,isCritical:m.is_critical},console.log("ðŸ“ Form data set for edit:",S.value);const we=f.value.find(W=>W.id===ce);if(we)console.log("âœ… Item found in available items:",we.name);else{console.warn("âš ï¸ Item ID not found in available items, trying alternative matching...");const W=f.value.find(ke=>{var ue;return ke.name===((ue=m.item)==null?void 0:ue.name)});W?(console.log("âœ… Found item by name matching, using ID:",W.id),S.value.itemId=W.id):console.error("âŒ Could not find item in available items by ID or name")}},J=()=>{if(!E.value||K.value===-1)return;const m=f.value.find(_=>_.id===S.value.itemId);m&&(b.value[K.value]={...b.value[K.value],item:{id:m.id,name:m.name,inventory:{current_stock:m.current_stock}},quantity_needed:S.value.quantity,unit:S.value.unit,is_critical:S.value.isCritical},g())},g=()=>{x.value=!1,K.value=-1,S.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},z=m=>{b.value.splice(m,1)},k=async()=>{var m,_,ce,we;if(i.product){p.value=!0;try{console.log("ðŸ’¾ Saving composition for product:",i.product.name),console.log("ðŸ“¦ Items to save:",b.value);const ye=i.product.id_product||i.product.id,W=i.items||[],ke=b.value;for(const ue of ke){const Ue=W.find(Se=>Se.id_product_item===ue.id_product_item),$e={product_id:ye,item_id:parseInt(((m=ue.item)==null?void 0:m.id)||"0"),quantity_needed:ue.quantity_needed,unit:ue.unit,is_critical:ue.is_critical,notes:ue.notes||""};console.log("ðŸ“¤ API Data:",$e);try{Ue&&!((_=ue.id_product_item)!=null&&_.toString().startsWith("temp_"))?(console.log("âœï¸ Updating item:",Ue.id_product_item),await ct.update(Ue.id_product_item,$e)):(console.log("âž• Creating new item"),await ct.create($e))}catch(Se){throw console.error("âŒ Error processing item:",Se),(ce=Se.message)!=null&&ce.includes("already assigned")?n.value=`Item "${(we=ue.item)==null?void 0:we.name}" sudah ditambahkan ke produk ini`:n.value=Se.message||"Terjadi kesalahan saat menyimpan item",u.value=!0,Se}}for(const ue of W)if(!ke.find($e=>$e.id_product_item===ue.id_product_item)&&ue.id_product_item)try{console.log("ðŸ—‘ï¸ Deleting item:",ue.id_product_item),await ct.delete(ue.id_product_item)}catch($e){console.error("âŒ Error deleting item:",$e),n.value=`Gagal menghapus item: ${$e.message}`,u.value=!0}console.log("âœ… Composition saved successfully!"),Q.value="Komposisi produk berhasil disimpan!",o.value=!0,r("save",{product:i.product,items:b.value}),r("refresh"),c()}catch(ye){console.error("âŒ Error saving composition:",ye),u.value||(n.value=ye.message||"Terjadi kesalahan saat menyimpan komposisi",u.value=!0)}finally{p.value=!1}}},c=()=>{C.value=!1,setTimeout(()=>{b.value=[...i.items],g()},300)};return(m,_)=>{var ce,we,ye;return h(),de(Te,null,[e(Be,{modelValue:C.value,"onUpdate:modelValue":_[9]||(_[9]=W=>C.value=W),"max-width":"900",persistent:""},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var W;return[a("div",yl,[e($,{icon:"mdi-chef-hat",size:"24"}),a("div",null,[_[13]||(_[13]=a("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),a("p",bl,d(((W=m.product)==null?void 0:W.name)||"Produk"),1)])]),e(R,{icon:"mdi-close",variant:"text",size:"small",onClick:c})]}),_:1}),e(ve,{class:"pa-6"},{default:t(()=>[e(ie,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(ve,{class:"pa-4"},{default:t(()=>{var W,ke,ue,Ue,$e;return[a("div",hl,[e(Ie,{image:(W=m.product)==null?void 0:W.image_url,size:"64"},{default:t(()=>{var Se;return[(Se=m.product)!=null&&Se.image_url?oe("",!0):(h(),j($,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),a("div",xl,[a("h4",Vl,d((ke=m.product)==null?void 0:ke.name),1),a("p",wl," SKU: "+d(((ue=m.product)==null?void 0:ue.sku)||"SKU-"+((Ue=m.product)==null?void 0:Ue.id_product)),1),a("p",Pl," Harga: "+d(A(mt)((($e=m.product)==null?void 0:$e.price)||0)),1)]),e(pe,{color:O(),variant:"tonal"},{default:t(()=>[v(d(me()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e(ie,{class:"mb-6",elevation:"2"},{default:t(()=>[e(Ve,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[a("div",Cl,[a("div",Il,[e($,{icon:x.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),v(" "+d(x.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(ve,{class:"pa-4"},{default:t(()=>[e(Pe,null,{default:t(()=>[e(M,{cols:"12",md:"4"},{default:t(()=>[e(qt,{modelValue:S.value.itemId,"onUpdate:modelValue":_[0]||(_[0]=W=>S.value.itemId=W),items:D.value,loading:G.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item dengan stok...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":ne()},{item:t(({props:W,item:ke})=>[e(et,he(W,{disabled:L(ke.raw)<=0,class:{"text-disabled":L(ke.raw)<=0}}),{prepend:t(()=>[e(Ie,{size:"32",class:"me-3",color:L(ke.raw)<=0?"grey-darken-2":"primary",variant:"tonal"},{default:t(()=>[e($,{icon:"mdi-package-variant",color:L(ke.raw)<=0?"grey-darken-2":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[L(ke.raw)>0?(h(),j(pe,{key:0,size:"x-small",color:ee(ke.raw),variant:"dot"},{default:t(()=>[v(d(w(ke.raw)),1)]),_:2},1032,["color"])):(h(),j(pe,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>_[15]||(_[15]=[v(" Habis ")])),_:1,__:[15]}))]),default:t(()=>[e(kt,null,{default:t(()=>[v(d(ke.raw.name),1)]),_:2},1024),e(yt,{class:Xe(L(ke.raw)<=0?"text-disabled":"text-medium-emphasis")},{default:t(()=>[L(ke.raw)<=0?(h(),de("span",$l,[e($,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),_[14]||(_[14]=v(" Stok Habis "))])):(h(),de("span",Sl," Stok: "+d(L(ke.raw))+" "+d(ke.raw.unit),1))]),_:2},1032,["class"])]),_:2},1040,["disabled","class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:S.value.quantity,"onUpdate:modelValue":_[1]||(_[1]=W=>S.value.quantity=W),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:S.value.unit,"onUpdate:modelValue":_[2]||(_[2]=W=>S.value.unit=W),label:"Satuan",variant:"outlined",placeholder:"kg, pcs, ml",readonly:!!V.value,hint:V.value?`Satuan dari item: ${V.value}`:"","persistent-hint":""},null,8,["modelValue","readonly","hint"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(st,{modelValue:S.value.isCritical,"onUpdate:modelValue":_[3]||(_[3]=W=>S.value.isCritical=W),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(R,{color:x.value?"success":"primary",block:"","prepend-icon":x.value?"mdi-check":"mdi-plus",onClick:_[4]||(_[4]=W=>x.value?J():q()),disabled:!E.value},{default:t(()=>[v(d(x.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),x.value?(h(),j(R,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:g},{default:t(()=>_[16]||(_[16]=[v(" Batal ")])),_:1,__:[16]})):oe("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(ie,{elevation:"2"},{default:t(()=>[e(Ve,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e($,{icon:"mdi-format-list-bulleted",class:"me-2"}),v(" Daftar Item Komposisi ("+d(b.value.length)+") ",1)]),_:1}),e(ve,{class:"pa-0"},{default:t(()=>[b.value.length===0?(h(),de("div",Dl,[e($,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),_[17]||(_[17]=a("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),_[18]||(_[18]=a("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(h(),j(Vt,{key:1},{default:t(()=>[(h(!0),de(Te,null,Ze(b.value,(W,ke)=>(h(),j(et,{key:W.id||ke,class:"border-b"},{prepend:t(()=>[e(Ie,{size:"40",class:"me-3"},{default:t(()=>{var ue,Ue;return[e($,{icon:(ue=W.item)!=null&&ue.inventory&&W.item.inventory.current_stock>=W.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(Ue=W.item)!=null&&Ue.inventory&&W.item.inventory.current_stock>=W.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[a("div",Al,[e(R,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:ue=>N(W,ke)},null,8,["onClick"]),e(R,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:ue=>z(ke)},null,8,["onClick"])])]),default:t(()=>[e(kt,{class:"font-weight-medium"},{default:t(()=>{var ue;return[v(d(((ue=W.item)==null?void 0:ue.name)||"Item tidak ditemukan")+" ",1),W.is_critical?(h(),j(pe,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>_[19]||(_[19]=[v(" Kritis ")])),_:1,__:[19]})):oe("",!0)]}),_:2},1024),e(yt,null,{default:t(()=>{var ue;return[a("div",Tl,[a("span",null,"Dibutuhkan: "+d(W.quantity_needed)+" "+d(W.unit),1),(ue=W.item)!=null&&ue.inventory?(h(),de("span",{key:0,class:Xe(W.item.inventory.current_stock>=W.quantity_needed?"text-success":"text-error")}," Stok: "+d(W.item.inventory.current_stock)+" "+d(W.unit),3)):oe("",!0),W.formatted_total_cost?(h(),de("span",Ul,d(W.formatted_total_cost),1)):oe("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(Fe,{class:"pa-6 pt-0"},{default:t(()=>[e(R,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:I},{default:t(()=>_[20]||(_[20]=[v(" Setting HPP ")])),_:1,__:[20]}),e(Ne),e(R,{variant:"outlined",onClick:c},{default:t(()=>_[21]||(_[21]=[v(" Batal ")])),_:1,__:[21]}),e(R,{color:"primary",onClick:k,loading:p.value},{default:t(()=>_[22]||(_[22]=[v(" Simpan Komposisi ")])),_:1,__:[22]},8,["loading"])]),_:1})]),_:1}),e(tt,{modelValue:u.value,"onUpdate:modelValue":_[6]||(_[6]=W=>u.value=W),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:_[5]||(_[5]=W=>u.value=!1)},{default:t(()=>_[23]||(_[23]=[v(" Tutup ")])),_:1,__:[23]})]),default:t(()=>[v(d(n.value)+" ",1)]),_:1},8,["modelValue"]),e(tt,{modelValue:o.value,"onUpdate:modelValue":_[8]||(_[8]=W=>o.value=W),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:_[7]||(_[7]=W=>o.value=!1)},{default:t(()=>_[24]||(_[24]=[v(" Tutup ")])),_:1,__:[24]})]),default:t(()=>[v(d(Q.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(la,{modelValue:Y.value,"onUpdate:modelValue":_[10]||(_[10]=W=>Y.value=W),"product-id":((ce=m.product)==null?void 0:ce.id_product)||((we=m.product)==null?void 0:we.id),"product-name":(ye=m.product)==null?void 0:ye.product_name,onHppUpdated:_[11]||(_[11]=W=>r("refresh")),onPriceUpdated:_[12]||(_[12]=W=>r("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),Qt=Oe(El,[["__scopeId","data-v-a0d643d6"]]),zl={class:"composition-cards"},Hl={key:1,class:"text-center pa-12"},Ml={key:2,class:"text-center pa-12"},Bl={class:"d-flex align-center gap-3"},Fl={class:"flex-grow-1 min-width-0"},Rl={class:"text-h6 font-weight-bold text-truncate"},Kl={class:"text-caption text-medium-emphasis mb-0"},Nl={class:"d-flex align-center gap-2 mb-3"},ql={class:"text-body-2 font-weight-medium"},Ll={class:"composition-items"},Ol={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},jl={class:"text-body-2 text-truncate"},Gl={class:"text-end flex-shrink-0"},Wl={class:"text-body-2 font-weight-medium"},Xl={key:0,class:"text-caption text-success"},Yl={key:1,class:"text-caption text-primary"},Jl={class:"d-flex justify-between align-center mb-3"},Ql={class:"text-h6 font-weight-bold text-primary"},Zl={class:"d-flex gap-2"},eo={class:"d-flex align-center"},to={class:"d-flex align-center gap-4"},ao={class:"flex-grow-1"},lo={class:"text-h5 font-weight-bold mb-2"},oo={class:"d-flex align-center gap-4 mb-2"},no={class:"text-body-2"},so={class:"text-h6 text-primary font-weight-bold"},io={class:"d-flex align-center mt-1 gap-4"},ro={class:"d-flex align-center"},uo={class:"d-flex align-center"},co={key:0,class:"d-flex align-center"},mo={class:"text-primary font-weight-medium"},vo={key:1,class:"text-center py-8"},po={class:"text-h6 font-weight-bold"},fo={class:"text-h6 font-weight-bold"},go={class:"text-h6 font-weight-bold"},_o=He({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup(l,{emit:T}){const i=l,r=T,C=F(!1),p=F(!1),b=F(null),u=F([]),o=F(null),n=F({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),Q=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],x=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],K=ee=>{b.value=ee,u.value=ee.items||[],C.value=!0},Y=ee=>{o.value=ee,p.value=!0},S=ee=>{console.log("Composition saved:",ee),r("refresh")},f=()=>{n.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},G=re(()=>!!(n.value.search||n.value.stockStatus||n.value.itemType||n.value.criticalOnly||n.value.sortBy!=="name_asc")),P=re(()=>{let ee=0;return n.value.search&&ee++,n.value.stockStatus&&ee++,n.value.itemType&&ee++,n.value.criticalOnly&&ee++,n.value.sortBy!=="name_asc"&&ee++,ee}),y=re(()=>{const ee=new Map;i.productItems.forEach(I=>{if(!I.product)return;const O=I.product.id_product||I.product.id;ee.has(O)||ee.set(O,{...I.product,items:[],totalItems:0}),ee.get(O).items.push(I),ee.get(O).totalItems++});let w=Array.from(ee.values());if(n.value.search){const I=n.value.search.toLowerCase();w=w.filter(O=>O.name.toLowerCase().includes(I)||O.sku&&O.sku.toLowerCase().includes(I)||O.items.some(me=>{var q;return(q=me.item)==null?void 0:q.name.toLowerCase().includes(I)}))}return n.value.stockStatus&&(w=w.filter(I=>{const O=E(I);switch(n.value.stockStatus){case"safe":return O.color==="success";case"critical":return O.color==="warning";case"out":return O.color==="error";default:return!0}})),n.value.criticalOnly&&(w=w.filter(I=>I.items.some(O=>O.is_critical))),w.sort((I,O)=>{switch(n.value.sortBy){case"name_asc":return I.name.localeCompare(O.name);case"name_desc":return O.name.localeCompare(I.name);case"price_asc":return(I.price||0)-(O.price||0);case"price_desc":return(O.price||0)-(I.price||0);case"items_asc":return I.totalItems-O.totalItems;case"items_desc":return O.totalItems-I.totalItems;default:return I.name.localeCompare(O.name)}}),w}),E=ee=>{let w=!1,I=!1;return ee.items.forEach(O=>{var me;if((me=O.item)!=null&&me.inventory){const q=O.item.inventory.current_stock||0,N=O.quantity_needed||0;q<=0?w=!0:(q<N||O.is_critical)&&(I=!0)}}),w?{text:"Stok Habis",color:"error"}:I?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},V=ee=>{if(!(ee!=null&&ee.inventory))return"grey";const w=ee.inventory.current_stock||0;return w<=0?"error":w<=10?"warning":"success"},D=ee=>{if(!(ee!=null&&ee.inventory))return"Tidak ada data";const w=ee.inventory.current_stock||0;return w<=0?"Habis":w<=10?"Rendah":"Aman"},L=ee=>{const w=V(ee);return{"text-error":w==="error","text-warning":w==="warning","text-success":w==="success","text-grey":w==="grey"}},ne=ee=>`Item Komposisi (${ee})`;return(ee,w)=>(h(),de("div",zl,[e(ie,{class:"mb-6"},{default:t(()=>[e(Ve,{class:"d-flex align-center justify-between"},{default:t(()=>[w[12]||(w[12]=a("div",null,[a("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),a("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),e(R,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:w[0]||(w[0]=I=>r("refresh")),loading:ee.loading},{default:t(()=>w[11]||(w[11]=[v(" Refresh ")])),_:1,__:[11]},8,["loading"])]),_:1,__:[12]})]),_:1}),e(ie,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ve,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(M,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:n.value.search,"onUpdate:modelValue":w[1]||(w[1]=I=>n.value.search=I),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(Ke,{modelValue:n.value.stockStatus,"onUpdate:modelValue":w[2]||(w[2]=I=>n.value.stockStatus=I),items:Q,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(Ke,{modelValue:n.value.sortBy,"onUpdate:modelValue":w[3]||(w[3]=I=>n.value.sortBy=I),items:x,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(za,{modelValue:n.value.criticalOnly,"onUpdate:modelValue":w[4]||(w[4]=I=>n.value.criticalOnly=I),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Pe,{class:"mt-3"},{default:t(()=>[e(M,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(R,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:f,disabled:!G.value},{default:t(()=>w[13]||(w[13]=[v(" Reset Filter ")])),_:1,__:[13]},8,["disabled"]),G.value?(h(),j(pe,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[v(d(P.value)+" filter aktif ",1)]),_:1})):oe("",!0)]),_:1}),e(M,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(pe,{color:y.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[v(d(y.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!ee.loading&&y.value.length===0&&G.value?(h(),j(Re,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):oe("",!0),ee.loading?(h(),de("div",Hl,[e(Kt,{color:"primary",indeterminate:"",size:"64"}),w[14]||(w[14]=a("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):y.value.length===0?(h(),de("div",Ml,[e($,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),w[16]||(w[16]=a("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),w[17]||(w[17]=a("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(R,{color:"primary",size:"large","prepend-icon":"mdi-plus"},{default:t(()=>w[15]||(w[15]=[v(" Buat Komposisi Pertama ")])),_:1,__:[15]})])):(h(),j(Pe,{key:3},{default:t(()=>[(h(!0),de(Te,null,Ze(y.value,I=>(h(),j(M,{key:I.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ie,{class:Xe(["composition-card h-100",{"border-error":E(I).color==="error"}]),elevation:"2"},{default:t(()=>[e(Ve,{class:"pa-4 pb-2"},{default:t(()=>[a("div",Bl,[e(Ie,{image:I.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[I.image_url?oe("",!0):(h(),j($,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),a("div",Fl,[a("h3",Rl,d(I.name),1),a("p",Kl,d(I.sku||"SKU-"+I.id_product),1)])])]),_:2},1024),e(ve,{class:"py-2"},{default:t(()=>[e(pe,{color:E(I).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[v(d(E(I).text),1)]),_:2},1032,["color"]),a("div",Nl,[e($,{icon:"mdi-format-list-bulleted",size:"16"}),a("span",ql,d(ne(I.totalItems)),1)]),a("div",Ll,[(h(!0),de(Te,null,Ze(I.items,O=>{var me,q,N,J;return h(),de("div",{key:O.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[a("div",Ol,[e($,{icon:(me=O.item)!=null&&me.inventory&&O.item.inventory.current_stock>=O.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(q=O.item)!=null&&q.inventory&&O.item.inventory.current_stock>=O.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),a("span",jl,d(((N=O.item)==null?void 0:N.name)||"Item tidak ditemukan"),1),O.is_critical?(h(),j(pe,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>w[18]||(w[18]=[v(" Kritis ")])),_:1,__:[18]})):oe("",!0)]),a("div",Gl,[a("div",Wl,d(O.quantity_needed)+" "+d(O.unit),1),(J=O.item)!=null&&J.inventory?(h(),de("div",Xl," Stok: "+d(O.item.inventory.current_stock)+" "+d(O.unit),1)):oe("",!0),O.formatted_total_cost?(h(),de("div",Yl,d(O.formatted_total_cost),1)):oe("",!0)])])}),128))])]),_:2},1024),e(ve,{class:"pt-0"},{default:t(()=>[e(Ce,{class:"mb-3"}),a("div",Jl,[w[19]||(w[19]=a("span",{class:"text-body-2"},"Harga:",-1)),a("span",Ql,d(A(mt)(I.price||0)),1)]),a("div",Zl,[e(R,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:O=>Y(I)},{default:t(()=>w[20]||(w[20]=[v(" Detail ")])),_:2,__:[20]},1032,["onClick"]),e(R,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:O=>K(I)},{default:t(()=>w[21]||(w[21]=[v(" Kelola ")])),_:2,__:[21]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(Qt,{modelValue:C.value,"onUpdate:modelValue":w[5]||(w[5]=I=>C.value=I),product:b.value,items:u.value,onSave:S,onRefresh:w[6]||(w[6]=I=>r("refresh"))},null,8,["modelValue","product","items"]),e(Be,{modelValue:p.value,"onUpdate:modelValue":w[10]||(w[10]=I=>p.value=I),"max-width":"900",scrollable:""},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",eo,[e($,{icon:"mdi-eye",class:"mr-2",color:"primary"}),w[22]||(w[22]=a("span",null,"Detail Komposisi Produk",-1))]),e(R,{icon:"",variant:"text",onClick:w[7]||(w[7]=I=>p.value=!1)},{default:t(()=>[e($,{icon:"mdi-close"})]),_:1})]),_:1}),e(Ce),o.value?(h(),j(ve,{key:0},{default:t(()=>[e(Ha,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(M,{cols:"12"},{default:t(()=>[e(ie,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(ve,null,{default:t(()=>[a("div",to,[e(Ie,{image:o.value.image_url,size:"80"},{default:t(()=>[o.value.image_url?oe("",!0):(h(),j($,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),a("div",ao,[a("h2",lo,d(o.value.name),1),a("div",oo,[e(pe,{color:E(o.value).color,variant:"tonal",size:"small"},{default:t(()=>[v(d(E(o.value).text),1)]),_:1},8,["color"]),a("span",no,"SKU: "+d(o.value.sku||"-"),1)]),a("div",so,d(A(mt)(o.value.price||0)),1)])])]),_:1})]),_:1})]),_:1})]),_:1}),e(Pe,null,{default:t(()=>[e(M,{cols:"12"},{default:t(()=>[e(ie,{variant:"outlined"},{default:t(()=>[e(Ve,{class:"text-h6"},{default:t(()=>[e($,{icon:"mdi-format-list-bulleted",class:"mr-2"}),v(" Komposisi Item ("+d(o.value.totalItems||0)+") ",1)]),_:1}),e(ve,null,{default:t(()=>[o.value.items&&o.value.items.length>0?(h(),j(Vt,{key:0},{default:t(()=>[(h(!0),de(Te,null,Ze(o.value.items,(I,O)=>(h(),j(et,{key:I.id_product_item,class:"px-0"},{prepend:t(()=>[e(Ie,{size:"40",color:V(I.item),variant:"tonal"},{default:t(()=>{var me;return[e($,{icon:(me=I.item)!=null&&me.inventory&&I.item.inventory.current_stock>=I.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(pe,{color:V(I.item),variant:"tonal",size:"small"},{default:t(()=>[v(d(D(I.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(kt,{class:"font-weight-medium"},{default:t(()=>{var me;return[v(d(((me=I.item)==null?void 0:me.name)||"Unknown Item")+" ",1),I.is_critical?(h(),j(pe,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>w[23]||(w[23]=[v(" Kritis ")])),_:1,__:[23]})):oe("",!0)]}),_:2},1024),e(yt,null,{default:t(()=>{var me,q;return[a("div",io,[a("div",ro,[e($,{icon:"mdi-scale",size:"14",class:"mr-1"}),a("span",null," Kebutuhan: "+d(Number(I.quantity_needed||0).toLocaleString("id-ID"))+" "+d(I.unit),1)]),a("div",uo,[e($,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),a("span",{class:Xe(L(I.item))}," Stok: "+d(Number(((q=(me=I.item)==null?void 0:me.inventory)==null?void 0:q.current_stock)||0).toLocaleString("id-ID"))+" "+d(I.unit),3)]),I.formatted_total_cost?(h(),de("div",co,[e($,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),a("span",mo,d(I.formatted_total_cost),1)])):oe("",!0)])]}),_:2},1024),O<o.value.items.length-1?(h(),j(Ce,{key:0,class:"mt-3"})):oe("",!0)]),_:2},1024))),128))]),_:1})):(h(),de("div",vo,[e($,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),w[24]||(w[24]=a("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(Pe,{class:"mt-4"},{default:t(()=>[e(M,{cols:"12",md:"4"},{default:t(()=>[e(ie,{variant:"outlined",color:"primary"},{default:t(()=>[e(ve,{class:"text-center"},{default:t(()=>[e($,{icon:"mdi-format-list-bulleted",size:"32",class:"mb-2"}),a("div",po,d(o.value.totalItems||0),1),w[25]||(w[25]=a("div",{class:"text-body-2"},"Total Item",-1))]),_:1,__:[25]})]),_:1})]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(ie,{variant:"outlined",color:"warning"},{default:t(()=>[e(ve,{class:"text-center"},{default:t(()=>{var I;return[e($,{icon:"mdi-alert",size:"32",class:"mb-2"}),a("div",fo,d(((I=o.value.items)==null?void 0:I.filter(O=>O.is_critical).length)||0),1),w[26]||(w[26]=a("div",{class:"text-body-2"},"Item Kritis",-1))]}),_:1,__:[26]})]),_:1})]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(ie,{variant:"outlined",color:"success"},{default:t(()=>[e(ve,{class:"text-center"},{default:t(()=>[e($,{icon:"mdi-currency-usd",size:"32",class:"mb-2"}),a("div",go,d(A(mt)(o.value.price||0)),1),w[27]||(w[27]=a("div",{class:"text-body-2"},"Harga Jual",-1))]),_:1,__:[27]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):oe("",!0),e(Ce),e(Fe,{class:"pa-4"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",onClick:w[8]||(w[8]=I=>p.value=!1)},{default:t(()=>w[28]||(w[28]=[v(" Tutup ")])),_:1,__:[28]}),e(R,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:w[9]||(w[9]=()=>{p.value=!1,K(o.value)})},{default:t(()=>w[29]||(w[29]=[v(" Kelola Komposisi ")])),_:1,__:[29]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),ko=Oe(_o,[["__scopeId","data-v-8f4d44b6"]]),yo={class:"d-flex align-center gap-2"},bo={class:"text-white"},ho={class:"text-h6 mb-4 d-flex align-center gap-2"},xo={class:"text-h6 mb-4 d-flex align-center gap-2"},Vo={class:"d-flex flex-column gap-2"},wo={key:0,class:"d-flex align-center gap-2"},Po={class:"d-flex align-center gap-2 mb-2"},Co={class:"d-flex gap-2"},Io={class:"d-flex gap-2"},$o={class:"d-flex align-center justify-space-between"},So={class:"d-flex align-center gap-2"},Do={class:"text-end"},To={class:"text-h6 font-weight-bold"},Uo={class:"text-caption"},Ao={class:"text-h6 mb-4 d-flex align-center gap-2"},Eo={class:"text-h6 mb-4 d-flex align-center gap-2"},zo={class:"image-upload-container"},Ho={key:0,class:"mb-4"},Mo={class:"text-center mt-2"},Bo={class:"text-h6 mb-4 d-flex align-center gap-2"},Fo={class:"text-h6 mb-4 d-flex align-center gap-2"},Ro={class:"d-flex align-center"},Ko={class:"text-subtitle-1"},No={class:"text-body-1"},qo={class:"d-flex align-center"},Lo={class:"text-subtitle-1"},Oo=He({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup(l,{emit:T}){var J,g,z;const i=Nt(),{nameRules:r,categoryRules:C}=Lt(),{getProductHPPBreakdown:p}=oa(),b=F(!1),u=F(!1),o=async()=>{if(!(!x.editMode||!f.id))try{const k=await fetch(`/api/products/${f.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(k.ok){const c=await k.json();u.value=c.success&&c.data&&c.data.length>0}}catch(k){console.error("Error checking HPP status:",k)}},n=async()=>{if(f.id)try{b.value=!0;const k=await p(f.id,"latest");k&&(f.cost=k.total_hpp,Y("update-form","cost",k.total_hpp))}catch(k){console.error("Error refreshing HPP:",k)}finally{b.value=!1}},Q=()=>{console.log("Open items setup for product:",f.id)},x=l,K=re(()=>x.errorMessage),Y=T,S=F(),f=_t({...x.formData});be(()=>x.formData,k=>{Object.assign(f,k)},{deep:!0}),be(f,k=>{Object.keys(k).forEach(c=>{Y("update-form",c,k[c])})},{deep:!0}),be(()=>x.modelValue,k=>{k&&x.editMode&&o()});const G=_t({length:((J=x.formData.dimensions)==null?void 0:J.length)||null,width:((g=x.formData.dimensions)==null?void 0:g.width)||null,height:((z=x.formData.dimensions)==null?void 0:z.height)||null});be(G,k=>{const c=k.length!==null||k.width!==null||k.height!==null;f.dimensions=c?{length:k.length!==null?k.length:void 0,width:k.width!==null?k.width:void 0,height:k.height!==null?k.height:void 0}:{}},{deep:!0});const P=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],y=re(()=>{if(!f.price||!f.cost||f.cost<=0)return 0;const k=(f.price-f.cost)/f.cost*100;return Math.ceil(k)}),E=k=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(k),V=k=>k<10?"error":k<25?"warning":k<50?"success":"info",D=k=>k<10?"tabler-trending-down":k<25?"tabler-trending-up":k<50?"tabler-trending-up-2":"tabler-trending-up-3",L=k=>!k||k===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(k),ne=k=>{if(!k||k.trim()===""||k==="Rp 0")return 0;const m=k.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(m)||0},ee=F(!1),w=k=>{const c=ne(k);f.price=c},I=()=>{ee.value=!0},O=()=>{ee.value=!1},me=async()=>{var c;const{valid:k}=await((c=S.value)==null?void 0:c.validate());k&&Y("submit",f)},q=k=>{Y("image-change",k)},N=()=>{Y("remove-image")};return(k,c)=>(h(),j(Be,{"model-value":k.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":c[25]||(c[25]=m=>k.$emit("update:modelValue",m))},{default:t(()=>[e(ie,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[a("div",yo,[e($,{icon:k.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),a("span",bo,d(k.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(R,{icon:"tabler-x",variant:"text",color:"white",onClick:c[0]||(c[0]=m=>k.$emit("close"))})]),_:1}),e(Ce),e(ve,{class:"pa-6"},{default:t(()=>[e(wt,{ref_key:"formRef",ref:S,onSubmit:xt(me,["prevent"])},{default:t(()=>[e(Pe,null,{default:t(()=>[e(M,{cols:"12"},{default:t(()=>[a("h6",ho,[e($,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),c[26]||(c[26]=v(" Informasi Dasar "))])]),_:1}),e(M,{cols:"12",md:"8"},{default:t(()=>[e(xe,{modelValue:f.name,"onUpdate:modelValue":c[1]||(c[1]=m=>f.name=m),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:A(r),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:f.sku,"onUpdate:modelValue":c[2]||(c[2]=m=>f.sku=m),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(Tt,{modelValue:f.description,"onUpdate:modelValue":c[3]||(c[3]=m=>f.description=m),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>[e(Ke,{"model-value":f.category_id,"onUpdate:modelValue":c[4]||(c[4]=m=>f.category_id=m),items:k.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:A(C),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>[e(xe,{modelValue:f.brand,"onUpdate:modelValue":c[5]||(c[5]=m=>f.brand=m),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[a("h6",xo,[e($,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),c[27]||(c[27]=v(" Harga & Biaya "))])]),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>[e(xe,{"model-value":L(f.price),"onUpdate:modelValue":c[6]||(c[6]=m=>w(m)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:I,onBlur:O},null,8,["model-value"])]),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>[a("div",Vo,[e(xe,{"model-value":L(f.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),k.editMode?(h(),de("div",wo,[e(pe,{color:u.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e($,{icon:u.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),v(" "+d(u.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),u.value?(h(),j(R,{key:0,size:"small",variant:"outlined",color:"primary",onClick:n,loading:b.value},{default:t(()=>[e($,{icon:"tabler-refresh",size:"14",class:"me-1"}),c[28]||(c[28]=v(" Update HPP "))]),_:1,__:[28]},8,["loading"])):(h(),j(Le,{key:1},{activator:t(({props:m})=>[e(pe,he(m,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e($,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),c[29]||(c[29]=v(" Belum Ada Resep "))]),_:2,__:[29]},1040)]),default:t(()=>[c[30]||(c[30]=a("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[30]}))])):oe("",!0)])]),_:1}),k.editMode?(h(),j(M,{key:0,cols:"12"},{default:t(()=>[u.value?(h(),j(Re,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(Dt,null,{default:t(()=>[e($,{icon:"tabler-info-circle",class:"me-2"}),c[31]||(c[31]=v(" HPP Otomatis Aktif "))]),_:1,__:[31]}),c[32]||(c[32]=a("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[32]})):(h(),j(Re,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(Dt,null,{default:t(()=>[e($,{icon:"tabler-alert-triangle",class:"me-2"}),c[33]||(c[33]=v(" HPP Manual "))]),_:1,__:[33]}),c[34]||(c[34]=a("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[34]}))]),_:1})):oe("",!0),e(M,{cols:"12"},{default:t(()=>[u.value&&k.editMode?(h(),j(Re,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[a("div",Po,[e($,{icon:"tabler-check-circle"}),c[35]||(c[35]=a("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),c[38]||(c[38]=a("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),a("div",Co,[e(R,{size:"small",color:"primary",variant:"outlined",onClick:Q},{default:t(()=>[e($,{icon:"tabler-edit",size:"14",class:"me-1"}),c[36]||(c[36]=v(" Edit Resep "))]),_:1,__:[36]}),e(R,{size:"small",variant:"outlined",color:"info",onClick:n,loading:b.value},{default:t(()=>[e($,{icon:"tabler-refresh",size:"14",class:"me-1"}),c[37]||(c[37]=v(" Refresh HPP "))]),_:1,__:[37]},8,["loading"])])]),_:1,__:[38]})):!u.value&&k.editMode?(h(),j(Re,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[a("div",Io,[e(R,{size:"small",variant:"outlined",color:"info",onClick:c[7]||(c[7]=m=>A(i).push("/hpp-management"))},{default:t(()=>[e($,{icon:"tabler-calculator",size:"14",class:"me-1"}),c[39]||(c[39]=v(" Lihat HPP Management "))]),_:1,__:[39]})])]),_:1})):oe("",!0)]),_:1}),e(M,{cols:"12"},{default:t(()=>[f.price&&f.cost&&f.cost>0?(h(),j(Re,{key:0,color:V(y.value),variant:"tonal",class:"mb-0"},{default:t(()=>[a("div",$o,[a("div",So,[e($,{icon:D(y.value)},null,8,["icon"]),c[40]||(c[40]=a("span",{class:"font-weight-medium"},"Profit Margin",-1))]),a("div",Do,[a("div",To,d(Math.round(y.value))+"%",1),a("div",Uo," Keuntungan: "+d(E(f.price-f.cost)),1)])])]),_:1},8,["color"])):oe("",!0)]),_:1}),e(M,{cols:"12"},{default:t(()=>[a("h6",Ao,[e($,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),c[41]||(c[41]=v(" Dimensi (cm) "))])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:G.length,"onUpdate:modelValue":c[8]||(c[8]=m=>G.length=m),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:G.width,"onUpdate:modelValue":c[9]||(c[9]=m=>G.width=m),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:G.height,"onUpdate:modelValue":c[10]||(c[10]=m=>G.height=m),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[a("h6",Eo,[e($,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),c[42]||(c[42]=v(" Gambar Produk "))])]),_:1}),e(M,{cols:"12"},{default:t(()=>[a("div",zo,[k.imagePreview?(h(),de("div",Ho,[e(Ka,{src:k.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),a("div",Mo,[e(R,{size:"small",color:"error",variant:"outlined",onClick:N},{default:t(()=>c[43]||(c[43]=[v(" Hapus Gambar ")])),_:1,__:[43]})])])):oe("",!0),e(Na,{"model-value":k.selectedImage,"onUpdate:modelValue":c[11]||(c[11]=m=>q(Array.isArray(m)?m:[m])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),c[44]||(c[44]=a("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e(M,{cols:"12"},{default:t(()=>[a("h6",Bo,[e($,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),c[45]||(c[45]=v(" Pengaturan "))])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(Ke,{"model-value":f.status,"onUpdate:modelValue":c[12]||(c[12]=m=>f.status=m),items:P,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(st,{"model-value":f.active,"onUpdate:modelValue":c[13]||(c[13]=m=>f.active=m??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(st,{"model-value":f.featured,"onUpdate:modelValue":c[14]||(c[14]=m=>f.featured=m??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[a("h6",Fo,[e($,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),c[46]||(c[46]=v(" SEO (Opsional) "))])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(xe,{modelValue:f.meta_title,"onUpdate:modelValue":c[15]||(c[15]=m=>f.meta_title=m),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(Tt,{modelValue:f.meta_description,"onUpdate:modelValue":c[16]||(c[16]=m=>f.meta_description=m),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(dl,{"model-value":f.tags,"onUpdate:modelValue":c[17]||(c[17]=m=>f.tags=m),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Ce),e(Fe,{class:"pa-6"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",class:"coffee-secondary",onClick:c[18]||(c[18]=m=>k.$emit("close"))},{default:t(()=>c[47]||(c[47]=[v(" Batal ")])),_:1,__:[47]}),e(R,{color:"primary",class:"coffee-primary",loading:k.loading,onClick:me},{default:t(()=>[v(d(k.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),k.useDialogError?oe("",!0):(h(),j(tt,{key:0,"model-value":!!K.value,"onUpdate:modelValue":c[20]||(c[20]=m=>!m&&k.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(R,{icon:"tabler-x",size:"small",variant:"text",onClick:c[19]||(c[19]=m=>k.$emit("clear-error"))})]),default:t(()=>[a("div",Ro,[e($,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),a("div",null,[c[48]||(c[48]=a("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),a("div",Ko,d(K.value),1)])])]),_:1},8,["model-value"])),k.useDialogError?(h(),j(Be,{key:1,"model-value":!!K.value,"onUpdate:modelValue":c[22]||(c[22]=m=>!m&&k.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ve,{class:"d-flex align-center text-error"},{default:t(()=>[e($,{icon:"tabler-alert-circle",class:"me-2"}),c[49]||(c[49]=v(" Error Occurred "))]),_:1,__:[49]}),e(Ce),e(ve,{class:"py-4"},{default:t(()=>[a("div",No,d(K.value),1)]),_:1}),e(Ce),e(Fe,{class:"justify-end pa-4"},{default:t(()=>[e(R,{color:"error",variant:"outlined",onClick:c[21]||(c[21]=m=>k.$emit("clear-error"))},{default:t(()=>c[50]||(c[50]=[v(" Close ")])),_:1,__:[50]})]),_:1})]),_:1})]),_:1},8,["model-value"])):oe("",!0),e(tt,{"model-value":!!k.successMessage,"onUpdate:modelValue":c[24]||(c[24]=m=>!m&&k.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(R,{icon:"tabler-x",size:"small",variant:"text",onClick:c[23]||(c[23]=m=>k.$emit("clear-success"))})]),default:t(()=>[a("div",qo,[e($,{icon:"tabler-check-circle",class:"me-3",size:"28"}),a("div",null,[c[51]||(c[51]=a("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),a("div",Lo,d(k.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),jo=Oe(Oo,[["__scopeId","data-v-66fc4b3b"]]),Go={key:0,class:"mt-4"},Wo={class:"d-flex align-center gap-2 mb-2"},Xo={class:"d-flex flex-wrap gap-2"},Yo=He({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup(l,{emit:T}){const i=l,r=T,{categories:C,loading:p,fetchCategories:b}=qa(),u=F(!1),o=F("");it(()=>{b(),o.value=n.search||""});const n=_t({...i.filters});be(()=>i.filters,E=>{Object.assign(n,E),o.value=E.search||""},{deep:!0}),Ca(o,E=>{console.log("ðŸ” Search query changed:",E),n.search=E,E.length>=3||E.length===0?(console.log("âœ… Triggering search with query:",E),u.value=!0,r("search",E),S(),setTimeout(()=>{u.value=!1},500)):console.log("â³ Query too short, waiting for more characters:",E.length)},{debounce:500,maxWait:1e3});const Q=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],x=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],K=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],Y=re(()=>!!(o.value||n.category_id||n.active||n.stock_status||n.featured!==null||n.min_price||n.max_price)),S=()=>{r("update:filters",{...n})},f=()=>{o.value="",Object.assign(n,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),S()},G=E=>{const V=C.value.find(D=>D.id_category===E);return(V==null?void 0:V.name)||"Unknown"},P=E=>{if(!E)return"Semua";const V=Q.find(D=>D.value===E);return(V==null?void 0:V.title)||String(E)},y=E=>{const V=x.find(D=>D.value===E);return(V==null?void 0:V.title)||E};return(E,V)=>(h(),j(ie,{class:"mb-6"},{default:t(()=>[e(Ve,{class:"d-flex align-center gap-2"},{default:t(()=>[e($,{icon:"tabler-filter",class:"coffee-icon"}),V[11]||(V[11]=v(" Filter & Pencarian Produk "))]),_:1,__:[11]}),e(ve,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(M,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:o.value,"onUpdate:modelValue":V[0]||(V[0]=D=>o.value=D),label:"Cari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:u.value,clearable:"",variant:"outlined",hint:o.value.length>0&&o.value.length<3?`Ketik ${3-o.value.length} karakter lagi untuk mencari`:"","persistent-hint":""},null,8,["modelValue","loading","hint"])]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(Ke,{modelValue:n.category_id,"onUpdate:modelValue":[V[1]||(V[1]=D=>n.category_id=D),S],items:A(C),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:A(p),clearable:"",variant:"outlined"},null,8,["modelValue","items","loading"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(Ke,{modelValue:n.active,"onUpdate:modelValue":[V[2]||(V[2]=D=>n.active=D),S],items:Q,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(Ke,{modelValue:n.stock_status,"onUpdate:modelValue":[V[3]||(V[3]=D=>n.stock_status=D),S],items:x,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(R,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:f})]),_:1})]),_:1}),e(Pe,{class:"mt-3"},{default:t(()=>[e(M,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:n.min_price,"onUpdate:modelValue":V[4]||(V[4]=D=>n.min_price=D),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:S},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:n.max_price,"onUpdate:modelValue":V[5]||(V[5]=D=>n.max_price=D),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:S},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(Ke,{modelValue:n.sort_order,"onUpdate:modelValue":[V[6]||(V[6]=D=>n.sort_order=D),S],items:K,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),Y.value?(h(),de("div",Go,[a("div",Wo,[e($,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),V[12]||(V[12]=a("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),a("div",Xo,[o.value?(h(),j(pe,{key:0,closable:"",size:"small",color:"coffee","onClick:close":V[7]||(V[7]=D=>{o.value="",n.search="",S()})},{default:t(()=>[v(" Pencarian: "+d(o.value),1)]),_:1})):oe("",!0),n.category_id?(h(),j(pe,{key:1,closable:"",size:"small",color:"coffee","onClick:close":V[8]||(V[8]=D=>{n.category_id=null,S()})},{default:t(()=>[v(" Kategori: "+d(G(n.category_id)),1)]),_:1})):oe("",!0),n.active?(h(),j(pe,{key:2,closable:"",size:"small",color:"coffee","onClick:close":V[9]||(V[9]=D=>{n.active=null,S()})},{default:t(()=>[v(" Status: "+d(P(n.active)),1)]),_:1})):oe("",!0),n.stock_status?(h(),j(pe,{key:3,closable:"",size:"small",color:"coffee","onClick:close":V[10]||(V[10]=D=>{n.stock_status=null,S()})},{default:t(()=>[v(" Stok: "+d(y(n.stock_status)),1)]),_:1})):oe("",!0)])])):oe("",!0)]),_:1})]),_:1}))}}),Jo=Oe(Yo,[["__scopeId","data-v-1afc3ae3"]]),Qo={class:"d-flex align-center gap-2"},Zo={class:"text-h6"},en={class:"d-flex align-center gap-2"},tn={class:"text-h6"},an={class:"d-flex align-center gap-2"},ln={class:"text-h6"},on={class:"d-flex align-center gap-2"},nn={class:"text-h6"},sn={class:"d-flex align-center gap-2"},rn={class:"text-h6"},un={class:"d-flex align-center gap-2"},dn={class:"text-h6"},cn={class:"d-flex align-center gap-2"},mn={class:"text-h6"},vn={class:"d-flex align-center gap-2"},pn={class:"text-h6"},fn=He({__name:"ProductStatsCards",props:{stats:{}},setup(l){const T=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(r),i=r=>`${r.toFixed(1)}%`;return(r,C)=>(h(),j(Pe,{class:"mb-6"},{default:t(()=>[e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ie,{class:"stats-card"},{default:t(()=>[e(ve,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Ie,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e($,{icon:"tabler-package"})]),_:1}),a("div",null,[C[0]||(C[0]=a("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),a("div",Qo,[a("h6",Zo,d(((p=r.stats)==null?void 0:p.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ie,{class:"stats-card"},{default:t(()=>[e(ve,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Ie,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e($,{icon:"tabler-check"})]),_:1}),a("div",null,[C[1]||(C[1]=a("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),a("div",en,[a("h6",tn,d(((p=r.stats)==null?void 0:p.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ie,{class:"stats-card"},{default:t(()=>[e(ve,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Ie,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e($,{icon:"tabler-star"})]),_:1}),a("div",null,[C[2]||(C[2]=a("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),a("div",an,[a("h6",ln,d(((p=r.stats)==null?void 0:p.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ie,{class:"stats-card"},{default:t(()=>[e(ve,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Ie,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e($,{icon:"tabler-alert-triangle"})]),_:1}),a("div",null,[C[3]||(C[3]=a("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),a("div",on,[a("h6",nn,d(((p=r.stats)==null?void 0:p.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ie,{class:"stats-card"},{default:t(()=>[e(ve,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Ie,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e($,{icon:"tabler-currency-dollar"})]),_:1}),a("div",null,[C[4]||(C[4]=a("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),a("div",sn,[a("h6",rn,d(T(((p=r.stats)==null?void 0:p.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ie,{class:"stats-card"},{default:t(()=>[e(ve,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Ie,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e($,{icon:"tabler-chart-line"})]),_:1}),a("div",null,[C[5]||(C[5]=a("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),a("div",un,[a("h6",dn,d(T(((p=r.stats)==null?void 0:p.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ie,{class:"stats-card"},{default:t(()=>[e(ve,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Ie,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e($,{icon:"tabler-trending-up"})]),_:1}),a("div",null,[C[6]||(C[6]=a("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),a("div",cn,[a("h6",mn,d(i(((p=r.stats)==null?void 0:p.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ie,{class:"stats-card"},{default:t(()=>[e(ve,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Ie,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e($,{icon:"tabler-x-circle"})]),_:1}),a("div",null,[C[7]||(C[7]=a("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),a("div",vn,[a("h6",pn,d(((p=r.stats)==null?void 0:p.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),gn=Oe(fn,[["__scopeId","data-v-124783ae"]]),_n={class:"d-flex align-center gap-2"},kn={class:"d-flex align-center gap-2"},yn={class:"text-center py-8"},bn={class:"d-flex align-center gap-3 py-2"},hn={class:"font-weight-medium"},xn={class:"text-caption text-medium-emphasis"},Vn={class:"text-end"},wn={class:"font-weight-medium"},Pn={key:0,class:"text-caption text-medium-emphasis"},Cn={class:"text-center profit-margin-container"},In={class:"text-center"},$n={key:0,class:"text-caption text-medium-emphasis mt-1"},Sn={class:"d-flex align-center gap-2"},Dn={class:"text-body-2"},Tn={class:"text-caption text-medium-emphasis"},Un={class:"d-flex align-center gap-1"},An=He({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","bulk-delete","update:page","update:items-per-page","update:sort-by","update:selected-products"],setup(l){const T=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],i=u=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(u),r=u=>new Date(u).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),C=u=>new Date(u).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),p=(u,o)=>u<=0?"error":o&&u<=o?"warning":"success",b=u=>u<10?"error":u<25?"warning":u<50?"success":"info";return(u,o)=>(h(),j(ie,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",_n,[e($,{icon:"tabler-list",class:"coffee-icon"}),o[7]||(o[7]=v(" Data Produk ")),u.totalItems?(h(),j(pe,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[v(d(u.totalItems)+" item ",1)]),_:1})):oe("",!0)]),a("div",kn,[u.selectedProducts.length>0?(h(),j(R,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:o[0]||(o[0]=n=>u.$emit("bulk-delete"))},{default:t(()=>[v(" Hapus Terpilih ("+d(u.selectedProducts.length)+") ",1)]),_:1})):oe("",!0),e(R,{"prepend-icon":"tabler-plus",color:"coffee",onClick:o[1]||(o[1]=n=>u.$emit("add-product"))},{default:t(()=>o[8]||(o[8]=[v(" Tambah Produk ")])),_:1,__:[8]})])]),_:1}),e(Ce),e(Ja,{"model-value":u.selectedProducts,"onUpdate:modelValue":o[3]||(o[3]=n=>u.$emit("update:selected-products",n)),headers:T,items:u.products,"items-length":u.totalItems,loading:u.loading,"items-per-page":u.itemsPerPage,page:u.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:page":o[4]||(o[4]=n=>u.$emit("update:page",n)),"onUpdate:itemsPerPage":o[5]||(o[5]=n=>u.$emit("update:items-per-page",n)),"onUpdate:sortBy":o[6]||(o[6]=n=>u.$emit("update:sort-by",n))},{loading:t(()=>[e(Qa,{type:"table-row@10"})]),"no-data":t(()=>[a("div",yn,[e($,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),o[10]||(o[10]=a("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),o[11]||(o[11]=a("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(R,{"prepend-icon":"tabler-plus",color:"coffee",onClick:o[2]||(o[2]=n=>u.$emit("add-product"))},{default:t(()=>o[9]||(o[9]=[v(" Tambah Produk Pertama ")])),_:1,__:[9]})])]),"item.name":t(({item:n})=>[a("div",bn,[e(Ie,{image:n.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[n.image_url?oe("",!0):(h(),j($,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),a("div",null,[a("div",hn,d(n.name),1),a("div",xn," SKU: "+d(n.sku||"-"),1)])])]),"item.category":t(({item:n})=>[e(pe,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var Q;return[v(d(((Q=n.category)==null?void 0:Q.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:n})=>[a("div",Vn,[a("div",wn,d(i(n.price)),1),n.cost?(h(),de("div",Pn," HPP: "+d(i(n.cost)),1)):oe("",!0)])]),"item.profit_margin":t(({item:n})=>[a("div",Cn,[n.cost&&n.cost>0&&n.profit_margin!==void 0?(h(),j(pe,{key:0,color:b(n.profit_margin),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[v(d(Math.round(n.profit_margin))+"% ",1)]),_:2},1032,["color"])):(h(),j(pe,{key:1,color:"grey",size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>o[12]||(o[12]=[v(" - ")])),_:1,__:[12]}))])]),"item.stock":t(({item:n})=>[a("div",In,[e(pe,{color:p(n.stock,n.min_stock),size:"small",variant:"tonal"},{default:t(()=>[v(d(n.stock)+" "+d(n.unit||"pcs"),1)]),_:2},1032,["color"]),n.min_stock?(h(),de("div",$n," Min: "+d(n.min_stock),1)):oe("",!0)])]),"item.active":t(({item:n})=>[a("div",Sn,[e(pe,{color:n.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[v(d(n.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),n.featured?(h(),j(Le,{key:0,text:"Produk Unggulan"},{activator:t(({props:Q})=>[e($,he(Q,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):oe("",!0)])]),"item.created_at":t(({item:n})=>[a("div",Dn,d(r(n.created_at??"")),1),a("div",Tn,d(C((n==null?void 0:n.created_at)??"")),1)]),"item.actions":t(({item:n})=>[a("div",Un,[e(Le,{text:"Kelola Komposisi"},{activator:t(({props:Q})=>[e(R,he(Q,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:x=>u.$emit("open-composition-dialog",n)}),null,16,["onClick"])]),_:2},1024),e(Le,{text:"Kelola Variant"},{activator:t(({props:Q})=>[e(R,he(Q,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:x=>u.$emit("open-variant-dialog",n)}),null,16,["onClick"])]),_:2},1024),e(Le,{text:"Edit Produk"},{activator:t(({props:Q})=>[e(R,he(Q,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:x=>u.$emit("edit-product",n)}),null,16,["onClick"])]),_:2},1024),e(Le,{text:n.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:Q})=>{var x;return[e(R,he(Q,{icon:n.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:n.active?"success":"error",loading:((x=u.toggleLoading)==null?void 0:x[n.id_product])||!1,onClick:K=>u.$emit("toggle-active",n)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Le,{text:n.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:Q})=>[e(R,he(Q,{icon:n.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:n.featured?"warning":"default",onClick:x=>u.$emit("toggle-featured",n)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Le,{text:"Hapus Produk"},{activator:t(({props:Q})=>[e(R,he(Q,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:x=>u.$emit("delete-product",n)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),En=Oe(An,[["__scopeId","data-v-bbf8f372"]]),zn={class:"d-flex align-center gap-2"},Hn={class:"text-caption text-medium-emphasis mt-1"},Mn=He({__name:"VariantFormDialog",props:{modelValue:{type:Boolean},variant:{},products:{},productId:{}},emits:["update:modelValue","save"],setup(l,{emit:T}){const i=l,r=T,C=F(),p=F(!1),b=re({get:()=>i.modelValue,set:P=>r("update:modelValue",P)}),u=()=>{var P,y;return{id:void 0,product_id:i.productId||((y=(P=i.products)==null?void 0:P[0])==null?void 0:y.id)||0,name:"",sku:"",price:0,is_active:!0,attributes:{},variant_values:{}}},o=F(u()),n=re(()=>{var P,y;return!!((P=i.variant)!=null&&P.id)||!!((y=i.variant)!=null&&y.id_variant)}),Q=re(()=>{var E;const P=o.value.product_id,y=(E=i.products)==null?void 0:E.find(V=>V.id===P);return(y==null?void 0:y.name)||"Tidak diketahui"}),x=re(()=>{const P=Q.value;return P&&P!=="Tidak diketahui"?`${P} Manis, ${P} Asam, dll`:"Mangga Manis, Mangga Asam, dll"}),K=()=>{var P;if(console.log("ðŸ” LoadFormData called - Props:",{variant:i.variant,productId:i.productId,products:((P=i.products)==null?void 0:P.length)||0,productsData:i.products}),console.log("ðŸ” Current formData before load:",o.value),console.log("ðŸ” Is Edit Mode:",n.value),i.variant){console.log("ðŸ“ Mode: EDIT - Loading variant data:",i.variant);const y={...i.variant,id:i.variant.id||i.variant.id_variant,attributes:i.variant.attributes||{}};console.log("ðŸ“ New data to assign:",y),Object.assign(o.value,y),console.log("âœ… Edit mode - FormData after assignment:",o.value)}else{console.log("ðŸ†• Mode: CREATE - Setting default values"),G();let y=null;if(i.productId)y=i.productId,console.log("âœ… Got product ID from productId prop:",y);else if(i.products&&i.products.length>0){const E=i.products[0];y=E.id||E.id_product,console.log("âœ… Got product ID from products array:",y,"from product:",E)}y?o.value.product_id=y:(console.error("âŒ No valid product ID found in props!"),console.log("ProductId prop:",i.productId),console.log("Products array:",i.products)),o.value.product_id&&Y(),console.log("âœ… Create mode - FormData initialized:",o.value)}console.log("ðŸŽ¯ Final FormData after load:",o.value),o.value.name&&o.value.product_id&&!n.value&&(console.log("ðŸ”„ Attempting immediate SKU generation..."),Y())},Y=()=>{var D,L,ne;if(console.log("ðŸ”„ GenerateSku called with:",{name:o.value.name,product_id:o.value.product_id,productsLength:((D=i.products)==null?void 0:D.length)||0,isEdit:n.value,products:i.products}),!o.value.name){console.warn("âš ï¸ Cannot generate SKU: No variant name provided");return}if(!o.value.product_id){console.warn("âš ï¸ Cannot generate SKU: No product ID provided");return}const P=(L=i.products)==null?void 0:L.find(ee=>ee.id===o.value.product_id||ee.id_product===o.value.product_id);if(console.log("ðŸ” Found product:",P),!P){console.warn("âš ï¸ Cannot generate SKU: Product not found in products array"),console.log("âš ï¸ Available products:",i.products),console.log("âš ï¸ Looking for product_id:",o.value.product_id);const w=`PRD-${o.value.name.replace(/\s+/g,"").substring(0,6).toUpperCase()}`;console.log("âœ… Generated fallback SKU:",w),o.value.sku=w;return}const y=P.code||((ne=P.name)==null?void 0:ne.substring(0,3).toUpperCase())||"PRD",E=o.value.name.replace(/\s+/g,"").substring(0,3).toUpperCase(),V=`${y}-${E}`;console.log("âœ… Generated SKU:",V,"from productCode:",y,"variantName:",E),o.value.sku=V},S=async()=>{const{valid:P}=await C.value.validate();if(!P)return;console.log("FormData before save:",o.value);let y=o.value.product_id;if(!y&&i.productId&&(y=i.productId),!y&&i.products&&i.products.length>0&&(y=i.products[0].id),!y){console.error("No valid product ID found");return}o.value.product_id=y,p.value=!0;try{const E={Variant:o.value.name},V={id_product:y,name:o.value.name,sku:o.value.sku||"",price:o.value.price||0,variant_values:E,active:o.value.is_active!==!1};if(console.log("Payload that will be sent:",V),n.value){const D={...V,active:o.value.is_active};await Ee.put(`/api/variants/${o.value.id}`,D)}else await Ee.post("/api/variants",V);r("save"),f()}catch(E){console.error("Error saving variant:",E)}finally{p.value=!1}},f=()=>{b.value=!1,nt(()=>{G()})},G=()=>{Object.assign(o.value,u())};return be(()=>i.modelValue,(P,y)=>{console.log("ðŸŸ¡ Watcher modelValue triggered:",{newVal:P,oldVal:y}),P&&K()}),be(()=>i.variant,(P,y)=>{console.log("ðŸŸ¡ Watcher variant triggered:",{newVal:P,oldVal:y}),i.modelValue&&K()}),be(()=>o.value.name,P=>{console.log("ðŸŸ¡ Watcher name triggered:",{newName:P,isEdit:n.value}),!n.value&&P&&Y()}),be(()=>o.value.product_id,P=>{console.log("ðŸŸ¡ Watcher product_id triggered:",{newProductId:P,isEdit:n.value}),!n.value&&P&&o.value.name&&Y()}),(P,y)=>(h(),j(Be,{modelValue:b.value,"onUpdate:modelValue":y[3]||(y[3]=E=>b.value=E),"max-width":"800px",persistent:""},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",zn,[e($,{icon:n.value?"mdi-pencil":"mdi-plus"},null,8,["icon"]),a("span",null,d(n.value?"Edit Variant":"Tambah Variant Baru"),1)]),e(R,{icon:"mdi-close",variant:"text",onClick:f,disabled:p.value},null,8,["disabled"])]),_:1}),e(Ce),e(ve,{class:"pt-4"},{default:t(()=>[e(wt,{ref_key:"form",ref:C,onSubmit:xt(S,["prevent"])},{default:t(()=>[e(Pe,null,{default:t(()=>[e(M,{cols:"12"},{default:t(()=>[e(xe,{modelValue:o.value.name,"onUpdate:modelValue":y[0]||(y[0]=E=>o.value.name=E),label:"Nama Variant *",variant:"outlined",rules:[E=>!!E||"Nama variant wajib diisi"],placeholder:"Contoh: Mangga Manis, Mangga Asam, dll"},null,8,["modelValue","rules"]),a("div",Hn," Contoh: "+d(x.value),1)]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(xe,{modelValue:o.value.sku,"onUpdate:modelValue":y[1]||(y[1]=E=>o.value.sku=E),label:"SKU",variant:"outlined",readonly:"",placeholder:"Auto-generated",hint:"SKU akan digenerate otomatis berdasarkan nama variant","persistent-hint":""},{"append-inner":t(()=>[e(R,{icon:"mdi-refresh",size:"small",variant:"text",onClick:Y,disabled:!o.value.name||n.value,title:"Generate SKU manually"},null,8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(st,{modelValue:o.value.is_active,"onUpdate:modelValue":y[2]||(y[2]=E=>o.value.is_active=E),label:"Status Aktif",color:"primary","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Fe,{class:"px-6 pb-6"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",onClick:f,disabled:p.value},{default:t(()=>y[4]||(y[4]=[v(" Batal ")])),_:1,__:[4]},8,["disabled"]),e(R,{color:"primary",onClick:S,loading:p.value},{default:t(()=>[v(d(n.value?"Update":"Simpan"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Bn={class:"d-flex align-center gap-2"},Fn={key:0},Rn={class:"d-flex align-center"},Kn={class:"text-center py-8"},Nn=He({__name:"VariantCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup(l,{emit:T}){const i=l,r=T,C=re({get:()=>i.modelValue,set:b=>r("update:modelValue",b)}),p=()=>{C.value=!1};return(b,u)=>(h(),j(Be,{modelValue:C.value,"onUpdate:modelValue":u[0]||(u[0]=o=>C.value=o),"max-width":"600px",persistent:""},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",Bn,[e($,{icon:"mdi-puzzle"}),u[1]||(u[1]=a("span",null,"Kelola Komposisi Variant",-1))]),e(R,{icon:"mdi-close",variant:"text",onClick:p})]),_:1}),e(Ce),e(ve,{class:"pt-4"},{default:t(()=>[b.variant?(h(),de("div",Fn,[e(Re,{type:"info",variant:"tonal",class:"mb-4"},{default:t(()=>[a("div",Rn,[e($,{icon:"mdi-package-variant",class:"me-2"}),a("div",null,[u[2]||(u[2]=a("strong",null,"Variant:",-1)),v(" "+d(b.variant.name)+" ",1),u[3]||(u[3]=a("br",null,null,-1)),a("small",null,"SKU: "+d(b.variant.sku),1)])])]),_:1}),a("div",Kn,[e($,{icon:"mdi-wrench",size:"64",color:"grey"}),u[4]||(u[4]=a("h3",{class:"text-h6 mt-4"},"Fitur Komposisi",-1)),u[5]||(u[5]=a("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi item untuk variant ini akan segera tersedia ",-1))])])):oe("",!0)]),_:1}),e(Fe,{class:"px-6 pb-6"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",onClick:p},{default:t(()=>u[6]||(u[6]=[v(" Tutup ")])),_:1,__:[6]})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),qn={class:"d-flex align-center gap-2"},Ln={key:0},On={class:"d-flex align-center gap-3 mb-4"},jn={class:"text-h6"},Gn={class:"text-body-2 text-medium-emphasis"},Wn={class:"text-h6"},Xn={class:"text-h6"},Yn={class:"text-body-1"},Jn=He({__name:"VariantDetailDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue"],setup(l,{emit:T}){const i=l,r=T,C=re({get:()=>i.modelValue,set:u=>r("update:modelValue",u)}),p=u=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(u),b=()=>{C.value=!1};return(u,o)=>(h(),j(Be,{modelValue:C.value,"onUpdate:modelValue":o[0]||(o[0]=n=>C.value=n),"max-width":"600px"},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",qn,[e($,{icon:"mdi-eye"}),o[1]||(o[1]=a("span",null,"Detail Variant",-1))]),e(R,{icon:"mdi-close",variant:"text",onClick:b})]),_:1}),e(Ce),e(ve,{class:"pt-4"},{default:t(()=>[u.variant?(h(),de("div",Ln,[e(Pe,null,{default:t(()=>[e(M,{cols:"12"},{default:t(()=>[e(ie,{variant:"outlined"},{default:t(()=>[e(ve,null,{default:t(()=>[a("div",On,[e(Ie,{size:"48",color:"primary",variant:"tonal"},{default:t(()=>[e($,{icon:"mdi-package-variant"})]),_:1}),a("div",null,[a("h3",jn,d(u.variant.name),1),a("p",Gn,d(u.variant.sku),1)])]),e(Ce,{class:"mb-4"}),e(Pe,null,{default:t(()=>[e(M,{cols:"6"},{default:t(()=>[o[2]||(o[2]=a("div",{class:"text-caption text-medium-emphasis"},"Harga",-1)),a("div",Wn,d(p(u.variant.price||0)),1)]),_:1,__:[2]}),e(M,{cols:"6"},{default:t(()=>[o[3]||(o[3]=a("div",{class:"text-caption text-medium-emphasis"},"Stok Saat Ini",-1)),a("div",Xn,d(u.variant.current_stock||0)+" pcs",1)]),_:1,__:[3]}),e(M,{cols:"6"},{default:t(()=>[o[4]||(o[4]=a("div",{class:"text-caption text-medium-emphasis"},"Stok Minimum",-1)),a("div",Yn,d(u.variant.min_stock||0)+" pcs",1)]),_:1,__:[4]}),e(M,{cols:"6"},{default:t(()=>[o[5]||(o[5]=a("div",{class:"text-caption text-medium-emphasis"},"Status",-1)),e(pe,{color:u.variant.is_active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[v(d(u.variant.is_active?"Aktif":"Nonaktif"),1)]),_:1},8,["color"])]),_:1,__:[5]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])):oe("",!0)]),_:1}),e(Fe,{class:"px-6 pb-6"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",onClick:b},{default:t(()=>o[6]||(o[6]=[v(" Tutup ")])),_:1,__:[6]})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Qn={class:"d-flex align-center gap-2"},Zn={key:0},es={class:"d-flex align-center"},ts={class:"text-center py-8"},as=He({__name:"VariantManagementDialog",props:{modelValue:{type:Boolean},product:{}},emits:["update:modelValue","refresh"],setup(l,{emit:T}){const i=l,r=T,C=re({get:()=>i.modelValue,set:u=>r("update:modelValue",u)}),p=()=>{C.value=!1},b=()=>{r("refresh"),p()};return(u,o)=>(h(),j(Be,{modelValue:C.value,"onUpdate:modelValue":o[0]||(o[0]=n=>C.value=n),"max-width":"1200px",persistent:""},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",Qn,[e($,{icon:"mdi-cog"}),o[1]||(o[1]=a("span",null,"Kelola Variant",-1))]),e(R,{icon:"mdi-close",variant:"text",onClick:p})]),_:1}),e(Ce),e(ve,{class:"pt-4"},{default:t(()=>[u.product?(h(),de("div",Zn,[e(Re,{type:"info",variant:"tonal",class:"mb-4"},{default:t(()=>[a("div",es,[e($,{icon:"mdi-package",class:"me-2"}),a("div",null,[o[2]||(o[2]=a("strong",null,"Produk:",-1)),v(" "+d(u.product.name)+" ",1),o[3]||(o[3]=a("br",null,null,-1)),o[4]||(o[4]=a("small",null,"Kelola semua variant untuk produk ini",-1))])])]),_:1}),a("div",ts,[e($,{icon:"mdi-wrench",size:"64",color:"grey"}),o[5]||(o[5]=a("h3",{class:"text-h6 mt-4"},"Fitur Management",-1)),o[6]||(o[6]=a("p",{class:"text-body-2 text-medium-emphasis"}," Advanced variant management features akan segera tersedia ",-1))])])):oe("",!0)]),_:1}),e(Fe,{class:"px-6 pb-6"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",onClick:p},{default:t(()=>o[7]||(o[7]=[v(" Tutup ")])),_:1,__:[7]}),e(R,{color:"primary",onClick:b},{default:t(()=>o[8]||(o[8]=[v(" Refresh ")])),_:1,__:[8]})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ls=()=>{const l=F(!1),T=F(null),i=F(null),r=F(null),C=F([]),p=re(()=>T.value&&T.value.items&&T.value.items.length>0),b=re(()=>r.value&&r.value.suggestions),u=f=>{const G=typeof f=="string"?parseFloat(f):f;return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(G||0)},o=()=>({Authorization:`Bearer ${localStorage.getItem("token")}`,Accept:"application/json","Content-Type":"application/json"}),n=async(f,G="latest")=>{l.value=!0;try{const P=await Ee.get(`/api/variants/${f}/hpp-breakdown`,{params:{method:G},headers:o()});if(P.data.success)return T.value=P.data.data,P.data.data;throw new Error(P.data.message||"Failed to get HPP breakdown")}catch(P){throw console.error("Error getting variant HPP breakdown:",P),T.value=null,P}finally{l.value=!1}};return{loading:l,currentHPPBreakdown:T,currentHPPComparison:i,currentHPPSuggestion:r,bulkUpdateResults:C,hasHPPData:p,hasSuggestionData:b,getVariantHPPBreakdown:n,updateVariantHPP:async(f,G="latest")=>{l.value=!0;try{const P=await Ee.post(`/api/variants/${f}/hpp-update`,{method:G},{headers:o()});if(P.data.success)return await n(f,G),P.data.data;throw new Error(P.data.message||"Failed to update HPP")}catch(P){throw console.error("Error updating variant HPP:",P),P}finally{l.value=!1}},calculateSuggestedPrice:async(f,G)=>{l.value=!0;try{const P=await Ee.post(`/api/variants/${f}/hpp-suggestion`,{markup_percentage:G},{headers:o()});if(P.data.success)return r.value=P.data.data,P.data.data;throw new Error(P.data.message||"Failed to calculate price suggestion")}catch(P){throw console.error("Error calculating suggested price:",P),P}finally{l.value=!1}},updatePriceFromHPP:async(f,G,P,y=!1,E=!0)=>{l.value=!0;try{const V=await Ee.post(`/api/variants/${f}/hpp-price-update`,{method:G,target_price:P,update_stock:y,use_target_price:E},{headers:o()});if(V.data.success)return V.data;throw new Error(V.data.message||"Failed to update price from HPP")}catch(V){throw console.error("Error updating price from HPP:",V),V}finally{l.value=!1}},getVariantHPPComparison:async f=>{l.value=!0;try{const G=await Ee.get(`/api/variants/${f}/hpp-comparison`,{headers:o()});if(G.data.success)return i.value=G.data.data,G.data.data;throw new Error(G.data.message||"Failed to get HPP comparison")}catch(G){throw console.error("Error getting variant HPP comparison:",G),i.value=null,G}finally{l.value=!1}},bulkUpdateVariantHPP:async(f,G)=>{l.value=!0;try{const P=await Ee.post("/api/variants/bulk-hpp-update",{variant_ids:f,method:G},{headers:o()});if(P.data.success)return C.value=P.data.data.results||[],P.data.data;throw new Error(P.data.message||"Failed to bulk update HPP")}catch(P){throw console.error("Error bulk updating variant HPP:",P),C.value=[],P}finally{l.value=!1}},formatCurrency:u}},os={class:"d-flex align-center gap-3"},ns={class:"text-h5 font-weight-bold"},ss={class:"text-h6"},is={class:"text-body-1"},rs={class:"d-flex flex-column"},us={class:"font-weight-medium"},ds={class:"text-caption text-grey-darken-1"},cs={class:"font-weight-medium"},ms={key:0,class:"text-caption"},vs={key:1,class:"text-grey-lighten-1 text-caption"},ps={class:"v-data-table__footer"},fs={class:"pa-4 d-flex justify-space-between align-center"},gs={class:"text-subtitle-1 font-weight-bold"},_s={class:"text-subtitle-2 text-uppercase"},ks={class:"text-h6 font-weight-bold my-2"},ys={class:"text-caption"},bs=He({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup(l,{emit:T}){const i=l,r=T,{loading:C,currentHPPBreakdown:p,currentHPPSuggestion:b,hasHPPData:u,hasSuggestionData:o,getVariantHPPBreakdown:n,updateVariantHPP:Q,updatePriceFromHPP:x,formatCurrency:K}=ls(),Y=F("latest"),S=F(0),f=F(0),G=F(""),P=F(0),y=F(!1),E=F(!1),V=F(""),D=F(""),L=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],ne=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],ee=J=>!J||J===0?"":new Intl.NumberFormat("id-ID").format(J),w=J=>{if(!J)return 0;const g=J.replace(/[^\d]/g,"");return parseInt(g)||0},I=J=>{var z;const g=w(J);if(f.value=g,G.value=ee(g),(z=p.value)!=null&&z.total_hpp&&g>0){const k=p.value.total_hpp;S.value=k>0?Math.round((g-k)/k*100):0}else S.value=0},O=async()=>{var J,g,z;if(i.variantId)try{const k=localStorage.getItem("token"),c=await Ee.get(`/api/variants/${i.variantId}`,{headers:{Authorization:`Bearer ${k}`,Accept:"application/json"}});if(c.data.success&&c.data.data){const m=c.data.data;if(m.price&&m.price>0)f.value=Number(m.price),G.value=ee(Number(m.price));else if((J=p.value)!=null&&J.total_hpp){const _=Math.round(p.value.total_hpp*1.2);f.value=_,G.value=ee(_)}if((g=p.value)!=null&&g.total_hpp&&f.value>0){const _=p.value.total_hpp;S.value=_>0?Math.round((f.value-_)/_*100):0}P.value+=1}}catch(k){console.warn("Could not load target price, using default:",k),(z=p.value)!=null&&z.total_hpp&&(f.value=Math.round(p.value.total_hpp*1.2))}},me=async()=>{i.variantId&&(await n(i.variantId,Y.value),await O())},q=async()=>{var J,g;if(i.variantId)try{await Q(i.variantId,Y.value),V.value=`HPP successfully updated using ${Y.value} method!`,y.value=!0,r("hpp-updated"),await me()}catch(z){console.error("Error updating HPP:",z),D.value=((g=(J=z==null?void 0:z.response)==null?void 0:J.data)==null?void 0:g.message)||"Failed to update HPP",E.value=!0}},N=async()=>{var J,g,z,k,c,m;if(i.variantId&&((J=p.value)!=null&&J.total_hpp)&&f.value)try{const _=await x(i.variantId,Y.value,f.value,!0,!0);if((g=_==null?void 0:_.data)!=null&&g.new_price){if(f.value=_.data.new_price,G.value=ee(_.data.new_price),((z=_==null?void 0:_.data)==null?void 0:z.markup_percentage)!==void 0)S.value=_.data.markup_percentage;else{const ce=p.value.total_hpp;S.value=ce>0?Math.round((_.data.new_price-ce)/ce*100):0}P.value+=1,await nt()}await me(),V.value=`Price successfully updated to ${K(((k=_==null?void 0:_.data)==null?void 0:k.new_price)||f.value)}!`,y.value=!0,r("price-updated")}catch(_){console.error("Error applying price suggestion:",_),D.value=((m=(c=_==null?void 0:_.response)==null?void 0:c.data)==null?void 0:m.message)||"Failed to update variant price",E.value=!0}};return be(()=>i.modelValue,J=>{J&&i.variantId&&me()}),be(()=>i.variantId,J=>{J&&i.modelValue&&me()}),be(Y,async()=>{i.variantId&&await me()}),be([()=>{var J;return(J=p.value)==null?void 0:J.total_hpp},f],()=>{var J;if((J=p.value)!=null&&J.total_hpp&&f.value>0){const g=p.value.total_hpp;S.value=g>0?Math.round((f.value-g)/g*100):0}else S.value=0}),be(f,J=>{J!==w(G.value)&&(G.value=ee(J))}),(J,g)=>(h(),de(Te,null,[e(Be,{"model-value":J.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":g[6]||(g[6]=z=>J.$emit("update:modelValue",z))},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",os,[e($,{icon:"mdi-calculator-variant",size:"24"}),a("span",null,"HPP Breakdown - "+d(J.variantName||"Variant"),1)]),e(R,{icon:"mdi-close",size:"small",variant:"text",onClick:g[0]||(g[0]=z=>J.$emit("update:modelValue",!1))})]),_:1}),e(ve,null,{default:t(()=>[e(Pe,{class:"mb-4"},{default:t(()=>[e(M,{cols:"12",md:"6"},{default:t(()=>[e(Ke,{modelValue:Y.value,"onUpdate:modelValue":[g[1]||(g[1]=z=>Y.value=z),me],items:L,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>[e(R,{color:"primary",variant:"elevated",loading:A(C),"prepend-icon":"mdi-update",block:"",onClick:q},{default:t(()=>[v(" Update HPP with "+d(Y.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),A(u)?(h(),j(ie,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(ve,null,{default:t(()=>[e(Pe,{align:"center"},{default:t(()=>[e(M,{cols:"12",md:"4"},{default:t(()=>[g[11]||(g[11]=a("div",{class:"text-subtitle-2"}," Total HPP ",-1)),a("div",ns,d(A(K)(A(p).total_hpp)),1)]),_:1,__:[11]}),e(M,{cols:"12",md:"4"},{default:t(()=>{var z;return[g[12]||(g[12]=a("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),a("div",ss,d((z=L.find(k=>k.value===A(p).method))==null?void 0:z.title),1)]}),_:1,__:[12]}),e(M,{cols:"12",md:"4"},{default:t(()=>[g[13]||(g[13]=a("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),a("div",is,d(new Date(A(p).calculated_at).toLocaleString()),1)]),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):oe("",!0),A(u)?(h(),j(ie,{key:1},{default:t(()=>[e(Ve,null,{default:t(()=>[e($,{icon:"mdi-format-list-bulleted",class:"me-2"}),v(" Item Breakdown ("+d(A(p).items.length)+" items) ",1)]),_:1}),e(jt,{headers:ne,items:A(p).items,"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:z})=>[a("div",rs,[a("span",us,d(z.item_name),1),a("span",ds,d(z.item_code),1)])]),"item.quantity_needed":t(({item:z})=>[a("span",cs,d(z.quantity_needed)+" "+d(z.unit),1)]),"item.cost_per_unit":t(({item:z})=>[a("span",null,d(A(K)(z.cost_per_unit)),1)]),"item.total_cost":t(({item:z})=>[e(pe,{color:z.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[v(d(A(K)(z.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:z})=>[e(pe,{color:z.is_critical?"error":"success","prepend-icon":z.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[v(d(z.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:z})=>[z.notes?(h(),de("span",ms,d(z.notes),1)):(h(),de("span",vs,"â€”"))]),bottom:t(()=>[a("div",ps,[e(Ce),a("div",fs,[a("div",gs," Total HPP: "+d(A(K)(A(p).total_hpp)),1),e(pe,{color:"info",variant:"elevated"},{default:t(()=>[v(d(A(p).items.length)+" items ",1)]),_:1})])])]),_:1},8,["items"])]),_:1})):oe("",!0),A(u)?(h(),j(ie,{key:2,class:"mt-4"},{default:t(()=>[e(Ve,null,{default:t(()=>[e($,{icon:"mdi-cash-multiple",class:"me-2"}),g[14]||(g[14]=v(" Price Suggestion "))]),_:1,__:[14]}),e(ve,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(M,{cols:"12",md:"6"},{default:t(()=>[(h(),j(xe,{key:P.value,modelValue:G.value,"onUpdate:modelValue":[g[2]||(g[2]=z=>G.value=z),I],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${A(K)(A(p).total_hpp)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>{var z;return[(h(),j(xe,{key:P.value,modelValue:S.value,"onUpdate:modelValue":g[3]||(g[3]=k=>S.value=k),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${A(K)(f.value-(((z=A(p))==null?void 0:z.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e(Pe,{class:"mt-2"},{default:t(()=>[e(M,{cols:"12",md:"12"},{default:t(()=>[e(R,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:A(C),disabled:!f.value||f.value<=0,block:"",onClick:N},{default:t(()=>g[15]||(g[15]=[v(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):oe("",!0),A(o)?(h(),j(ie,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(Ve,null,{default:t(()=>[e($,{icon:"mdi-lightbulb",class:"me-2"}),g[16]||(g[16]=v(" Price Suggestions "))]),_:1,__:[16]}),e(ve,null,{default:t(()=>[e(Pe,null,{default:t(()=>[(h(!0),de(Te,null,Ze(A(b).suggestions,(z,k)=>(h(),j(M,{key:k,cols:"12",md:"4"},{default:t(()=>[e(ie,{variant:"elevated"},{default:t(()=>[e(ve,{class:"text-center"},{default:t(()=>[a("div",_s,d(k)+" Method ",1),a("div",ks,d(A(K)(z.suggested_price)),1),a("div",ys,[v(" HPP: "+d(A(K)(z.hpp)),1),g[17]||(g[17]=a("br",null,null,-1)),v(" Markup: "+d(z.markup_percentage.toFixed(1))+"%",1),g[18]||(g[18]=a("br",null,null,-1)),v(" Margin: "+d(z.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):oe("",!0),!A(u)&&!A(C)?(h(),j(ie,{key:4,variant:"outlined"},{default:t(()=>[e(ve,{class:"text-center py-8"},{default:t(()=>[e($,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),g[20]||(g[20]=a("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),g[21]||(g[21]=a("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:g[4]||(g[4]=z=>J.$emit("update:modelValue",!1))},{default:t(()=>g[19]||(g[19]=[v(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):oe("",!0)]),_:1}),e(Fe,{class:"pa-4"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:g[5]||(g[5]=z=>J.$emit("update:modelValue",!1))},{default:t(()=>g[22]||(g[22]=[v(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(tt,{modelValue:y.value,"onUpdate:modelValue":g[8]||(g[8]=z=>y.value=z),color:"success",location:"top"},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:g[7]||(g[7]=z=>y.value=!1)},{default:t(()=>g[23]||(g[23]=[v(" Close ")])),_:1,__:[23]})]),default:t(()=>[v(d(V.value)+" ",1)]),_:1},8,["modelValue"]),e(tt,{modelValue:E.value,"onUpdate:modelValue":g[10]||(g[10]=z=>E.value=z),color:"error",location:"top"},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:g[9]||(g[9]=z=>E.value=!1)},{default:t(()=>g[24]||(g[24]=[v(" Close ")])),_:1,__:[24]})]),default:t(()=>[v(d(D.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),hs={class:"d-flex align-center gap-2"},xs={class:"pa-4",style:{"background-color":"#2A2A2A"}},Vs={key:0,class:"d-flex align-center gap-3"},ws={class:"text-h6 text-white font-weight-bold"},Ps={class:"d-flex align-center gap-4 mt-1"},Cs={class:"text-caption text-grey-lighten-1"},Is={class:"text-caption text-grey-lighten-1"},$s={class:"pa-4 add-item-form"},Ss={class:"d-flex align-center justify-space-between mb-4"},Ds={class:"d-flex align-center gap-2"},Ts={class:"text-h6"},Us={key:0,class:"text-error"},As={key:1},Es={class:"d-flex align-center"},zs={class:"pa-4 text-center"},Hs={class:"pa-4 pt-0"},Ms={class:"d-flex align-center justify-between mb-4"},Bs={class:"text-h6"},Fs={key:0,class:"composition-list"},Rs={class:"d-flex align-center justify-between"},Ks={class:"d-flex align-center gap-3"},Ns={class:"font-weight-medium"},qs={class:"text-caption text-medium-emphasis"},Ls={class:"font-weight-medium text-primary"},Os={class:"d-flex align-center gap-2"},js={class:"text-center"},Gs={key:0,class:"text-body-2 text-medium-emphasis"},Ws={class:"text-center"},Xs={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},Ys=He({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup(l,{emit:T}){const i=l,r=T,C=F(),p=F(!1),b=F(!1),u=F([]),o=F([]),n=F(!1),Q=F(null),x=F(!1),K=F(null),Y=F(!1),S=F(!1),f=F(""),G=F(""),P=F("success"),y=F(!1),E=re({get:()=>(console.log("ðŸ”µ [DEBUG] Dialog getter called, props.modelValue:",i.modelValue),i.modelValue),set:Z=>{console.log("ðŸ”µ [DEBUG] Dialog setter called with value:",Z),r("update:modelValue",Z)}}),V=()=>({item_id:null,quantity:1,is_critical:!1}),D=F(V()),L=re(()=>!D.value.item_id||!Array.isArray(u.value)?null:u.value.find(Z=>Z.id_item===D.value.item_id)),ne=re(()=>!L.value||n.value&&Q.value!==null?null:o.value.find(Z=>{var s,B;return Z.name===((s=L.value)==null?void 0:s.name)||Z.id&&((B=L.value)==null?void 0:B.id_item)&&Z.id===L.value.id_item})),ee=re(()=>{if(!L.value)return"";if(n.value&&Q.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(ne.value){const Z=ne.value;return`Item sudah ada dengan quantity ${Z.quantity} ${Z.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${I(L.value)} ${L.value.unit}`}),w=re(()=>Array.isArray(u.value)?u.value.filter(Z=>I(Z)>0):[]),I=Z=>{var s,B;return((s=Z.inventory)==null?void 0:s.current_stock)||((B=Z.inventory)==null?void 0:B.available_stock)||Z.current_stock||0},O=()=>b.value?"Memuat items...":!u.value||u.value.length===0?"Tidak ada item tersedia":w.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",me=Z=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(Z),q=Z=>{switch(Z){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},N=Z=>{switch(Z){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},J=(Z,s,B)=>{var U,fe,ge,Ae,Me,ze,qe,We;if(!s)return!0;const X=s.toLowerCase().trim(),te=((fe=(U=B==null?void 0:B.raw)==null?void 0:U.name)==null?void 0:fe.toLowerCase())||"",H=((Ae=(ge=B==null?void 0:B.raw)==null?void 0:ge.item_code)==null?void 0:Ae.toLowerCase())||"",ae=((ze=(Me=B==null?void 0:B.raw)==null?void 0:Me.unit)==null?void 0:ze.toLowerCase())||"",se=((We=(qe=B==null?void 0:B.raw)==null?void 0:qe.description)==null?void 0:We.toLowerCase())||"";return te.includes(X)||H.includes(X)||ae.includes(X)||se.includes(X)},g=async()=>{var Z,s,B;b.value=!0,console.log("Loading available items...");try{const X=await Ee.get("/api/items?per_page=all&include=inventory");console.log("Items API response:",X.data);const te=((s=(Z=X.data)==null?void 0:Z.data)==null?void 0:s.data)||((B=X.data)==null?void 0:B.data)||X.data||[];u.value=Array.isArray(te)?te:[],console.log("Available items loaded:",u.value.length,"items"),console.log("Sample items with inventory:",u.value.slice(0,3))}catch(X){console.error("Error loading items:",X),X!=null&&X.response&&(console.error("API Error Status:",X.response.status),console.error("API Error Data:",X.response.data)),u.value=[]}finally{b.value=!1}},z=async()=>{var Z,s,B,X,te;if(!(!((Z=i.variant)!=null&&Z.id)&&!((s=i.variant)!=null&&s.id_variant)))try{const H=i.variant.id||i.variant.id_variant;console.log("Loading composition items for variant:",H);const ae=await Ee.get(`/api/variant-items/variant/${H}`);console.log("Composition API response:",ae.data);const se=((X=(B=ae.data)==null?void 0:B.data)==null?void 0:X.composition)||((te=ae.data)==null?void 0:te.composition)||[];if(!Array.isArray(se)){console.warn("API response composition is not an array:",se),o.value=[];return}o.value=se.map(U=>{var fe,ge,Ae,Me,ze,qe,We,rt,ut,dt;return{id:U.id_variant_item||U.id,name:((fe=U.item)==null?void 0:fe.name)||U.name,quantity:parseFloat(U.quantity_needed||U.quantity||U.qty||"1"),unit:U.unit||((ge=U.item)==null?void 0:ge.unit)||"pcs",stock:((Me=(Ae=U.item)==null?void 0:Ae.inventory)==null?void 0:Me.current_stock)||((qe=(ze=U.item)==null?void 0:ze.inventory)==null?void 0:qe.available_stock)||((We=U.item)==null?void 0:We.current_stock)||U.stock||0,price:parseFloat(((rt=U.item)==null?void 0:rt.cost_per_unit)||((ut=U.item)==null?void 0:ut.price)||U.price||"0"),is_critical:U.is_critical||!1,inventory:(dt=U.item)!=null&&dt.inventory?{current_stock:U.item.inventory.current_stock||0,available_stock:U.item.inventory.available_stock||0,stock_status:U.item.inventory.stock_status||"unknown",reorder_level:U.item.inventory.reorder_level||0}:null}}),console.log("Composition items loaded:",o.value)}catch(H){console.error("Error loading composition items:",H),H!=null&&H.response&&(console.error("API Error Status:",H.response.status),console.error("API Error Data:",H.response.data)),o.value=[]}},k=async()=>{var te,H;const{valid:Z}=await C.value.validate();if(!Z||!L.value)return;const s=L.value.name,B=L.value.id_item,X=D.value.quantity;if(console.log("ðŸ” Handle save - Mode:",n.value?"EDIT":"ADD"),console.log("ðŸ” Item:",s,"ID:",B),console.log("ðŸ” Quantity:",X),n.value&&Q.value!==null){console.log("âœï¸ Edit mode: Updating existing item at index",Q.value);const se=o.value[Q.value].quantity;console.log(`ðŸ“ Updating item "${s}":`),console.log(`   - Old quantity: ${se}`),console.log(`   - New quantity: ${X}`),o.value[Q.value].quantity=X,o.value[Q.value].is_critical=D.value.is_critical,console.log("âœ… Item updated successfully in edit mode"),n.value=!1,Q.value=null}else{console.log("âž• Add mode: Checking for existing item");const ae=o.value.findIndex(se=>se.name===s||se.id&&B&&se.id===B);if(ae!==-1){const U=o.value[ae].quantity,fe=U+X;console.log("ðŸ“¦ Item already exists! Accumulating quantity:"),console.log(`   - Item: ${s}`),console.log(`   - Old quantity: ${U}`),console.log(`   - Adding: ${X}`),console.log(`   - New quantity: ${fe}`),o.value[ae].quantity=fe}else{console.log("âž• Adding new item to composition:",s);const se={name:s,quantity:X,unit:L.value.unit,stock:((te=L.value.inventory)==null?void 0:te.current_stock)||((H=L.value.inventory)==null?void 0:H.available_stock)||L.value.current_stock||0,price:L.value.cost_per_unit||0,is_critical:D.value.is_critical,inventory:L.value.inventory?{current_stock:L.value.inventory.current_stock||0,available_stock:L.value.inventory.available_stock||0,stock_status:L.value.inventory.stock_status||"unknown",reorder_level:L.value.inventory.reorder_level||0}:null};o.value.push(se),console.log("âœ… New item added successfully")}}D.value=V(),console.log("ðŸ”„ Form reset")},c=(Z,s)=>{console.log("ðŸ” Edit item called:",Z,s);const B=u.value.find(X=>X.name===Z.name||X.id_item===Z.id);B?(console.log("âœ… Found item in available items:",B),n.value=!0,Q.value=s,D.value={item_id:B.id_item,quantity:Z.quantity,is_critical:Z.is_critical||!1},console.log("ðŸ“ Edit mode activated!"),console.log("ðŸ“ Form data set:",D.value),console.log("ðŸ“ Editing item at index:",s),setTimeout(()=>{const X=document.querySelector(".add-item-form");X&&X.scrollIntoView({behavior:"smooth",block:"start"})},100)):(console.error("âŒ Could not find item in available items"),console.log("Available items:",u.value.map(X=>({id:X.id_item,name:X.name}))),console.log("Looking for item:",{id:Z.id,name:Z.name}))},m=()=>{console.log("âŒ Edit mode cancelled"),n.value=!1,Q.value=null,D.value=V()},_=(Z,s)=>{K.value={item:Z,index:s},x.value=!0},ce=async()=>{var te,H,ae;if(!K.value)return;const{item:Z,index:s}=K.value,B=Z.name,X=Z.id;Y.value=!0,console.log("ðŸš€ Starting delete process for:",B,"ID:",X,"Index:",s);try{X?(console.log("ðŸ—‘ï¸ Deleting item from database:",B,"with ID:",X),await Ee.delete(`/api/variant-items/${X}`),console.log("âœ… Item deleted from database successfully")):console.log("ðŸ“ Item has no ID, removing from local list only"),x.value=!1,K.value=null,console.log("âœ… Delete dialog closed"),console.log("ðŸ”„ Force refreshing composition list..."),await z(),console.log("âœ… Composition list refreshed from server. New count:",o.value.length),console.log("ðŸ“¡ Emitting save event to parent component..."),r("save"),console.log("âœ… Save event emitted to parent component"),console.log("ðŸŽ‰ Item successfully deleted:",B)}catch(se){console.error("âŒ Error deleting item:",se),console.error("âŒ Error details:",(te=se.response)==null?void 0:te.data),alert("Gagal menghapus item: "+(((ae=(H=se.response)==null?void 0:H.data)==null?void 0:ae.message)||se.message))}finally{Y.value=!1,console.log("ðŸ Delete process completed")}},we=()=>{x.value=!1,K.value=null},ye=()=>{switch(P.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},W=()=>{switch(P.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},ke=()=>{switch(P.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},ue=()=>{switch(P.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Ue=async()=>{var Z,s,B,X;if(!((Z=i.variant)!=null&&Z.id)&&!((s=i.variant)!=null&&s.id_variant)){console.error("No variant ID found");return}p.value=!0;try{const te=i.variant.id||i.variant.id_variant;console.log("ðŸ” [DEBUG] Composition items count:",o.value.length),console.log("ðŸ” [DEBUG] Raw composition items:",JSON.stringify(o.value,null,2));const H=o.value.some(ae=>ae.id);if(console.log("ðŸ” [DEBUG] Has existing items:",H),H){console.log("ï¿½ [EDIT MODE] Updating existing composition");const ae={items:o.value.map(U=>{const fe=u.value.find(ge=>ge.name===U.name);return console.log(`Mapping item "${U.name}":`),console.log("  - Found item:",fe==null?void 0:fe.id_item),console.log("  - Original ID (id_variant_item):",U.id),console.log("  - Quantity:",U.quantity),console.log("  - Unit:",U.unit),console.log("  - Is critical:",U.is_critical),{id_variant_item:U.id,quantity_needed:Number(U.quantity),unit:U.unit,is_critical:U.is_critical||!1}}).filter(U=>U.id_variant_item&&U.quantity_needed>0)};console.log("Edit payload:",JSON.stringify(ae,null,2));const se=await Ee.post("/api/variant-items/bulk-update",ae);console.log("Composition updated successfully:",se.data)}else{console.log("âœ¨ [CREATE MODE] Creating new composition");const ae={id_variant:te,items:o.value.map(U=>{const fe=u.value.find(ge=>ge.name===U.name);return console.log(`Mapping item "${U.name}":`),console.log("  - Found item:",fe==null?void 0:fe.id_item),console.log("  - Quantity:",U.quantity),console.log("  - Unit:",U.unit),console.log("  - Is critical:",U.is_critical),{id_item:fe==null?void 0:fe.id_item,quantity_needed:Number(U.quantity),unit:U.unit,is_critical:U.is_critical||!1}}).filter(U=>U.id_item&&U.quantity_needed>0)};console.log("Create payload:",JSON.stringify(ae,null,2));const se=await Ee.post("/api/variant-items/bulk-store",ae);console.log("Composition created successfully:",se.data)}r("save"),Se()}catch(te){console.error("Error saving composition:",te),alert("Gagal menyimpan komposisi: "+(((X=(B=te.response)==null?void 0:B.data)==null?void 0:X.message)||te.message))}finally{p.value=!1}},$e=()=>{y.value=!0},Se=()=>{E.value=!1,D.value=V(),o.value=[],n.value=!1,Q.value=null};return be(()=>i.modelValue,Z=>{Z?(D.value=V(),g(),z()):(n.value=!1,Q.value=null)}),be(()=>D.value.item_id,Z=>{Z&&L.value&&console.log("Item selected:",L.value.name,"Unit:",L.value.unit)}),it(()=>{g()}),(Z,s)=>{var B,X,te;return h(),de(Te,null,[e(Be,{modelValue:E.value,"onUpdate:modelValue":s[3]||(s[3]=H=>E.value=H),"max-width":"1000px",persistent:""},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[a("div",hs,[e($,{icon:"mdi-delete",color:"white"}),s[9]||(s[9]=a("span",null,"Kelola Komposisi Item",-1))]),e(R,{icon:"mdi-close",variant:"text",color:"white",onClick:Se,disabled:p.value},null,8,["disabled"])]),_:1}),e(ve,{class:"pa-0"},{default:t(()=>[a("div",xs,[Z.variant?(h(),de("div",Vs,[e($,{icon:"mdi-coffee",size:"32",color:"white"}),a("div",null,[a("h3",ws,d(Z.variant.name),1),a("div",Ps,[a("span",Cs,"SKU: "+d(Z.variant.sku),1),a("span",Is,"Harga: "+d(me(Z.variant.price||0)),1),e(pe,{color:"success",size:"small",variant:"tonal"},{default:t(()=>s[10]||(s[10]=[v(" Stok Aman ")])),_:1,__:[10]})])])])):oe("",!0)]),a("div",$s,[a("div",Ss,[a("div",Ds,[e($,{icon:"mdi-plus-circle",color:"success"}),a("h4",Ts,d(n.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(wt,{ref_key:"form",ref:C,onSubmit:xt(k,["prevent"])},{default:t(()=>[e(Pe,null,{default:t(()=>[e(M,{cols:"12",md:"4"},{default:t(()=>[e(qt,{modelValue:D.value.item_id,"onUpdate:modelValue":s[0]||(s[0]=H=>D.value.item_id=H),items:w.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[H=>!!H||"Item wajib dipilih"],loading:b.value,disabled:b.value||u.value&&u.value.length===0,"no-data-text":O(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":J},{"prepend-inner":t(()=>[e($,{icon:"mdi-package",size:"16"})]),item:t(({props:H,item:ae})=>[e(et,he(H,{title:ae.raw.name,disabled:I(ae.raw)<=0,class:["pa-3",{"text-disabled":I(ae.raw)<=0}]}),{prepend:t(()=>[e($,{icon:"mdi-package-variant",color:I(ae.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[a("div",{class:Xe(["text-caption",I(ae.raw)<=0?"text-disabled":"text-medium-emphasis"])},[I(ae.raw)<=0?(h(),de("span",Us,[e($,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),s[11]||(s[11]=v(" Stok Habis "))])):(h(),de("span",As," Stok: "+d(I(ae.raw))+" "+d(ae.raw.unit),1))],2)]),append:t(()=>{var se;return[I(ae.raw)>0?(h(),j(pe,{key:0,size:"x-small",color:q(((se=ae.raw.inventory)==null?void 0:se.stock_status)||ae.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var U;return[v(d(N(((U=ae.raw.inventory)==null?void 0:U.stock_status)||ae.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(h(),j(pe,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>s[12]||(s[12]=[v(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:H})=>[a("div",Es,[e($,{icon:"mdi-package-variant",size:"16",class:"me-2"}),a("span",null,d(H.raw.name),1)])]),"no-data":t(()=>[a("div",zs,[e($,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),s[13]||(s[13]=a("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),s[14]||(s[14]=a("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:D.value.quantity,"onUpdate:modelValue":s[1]||(s[1]=H=>D.value.quantity=H),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[H=>!!H||"Jumlah wajib diisi",H=>H>0||"Jumlah harus lebih dari 0"],hint:ee.value,"persistent-hint":"",color:ne.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>{var H;return[e(xe,{"model-value":((H=L.value)==null?void 0:H.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!L.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e($,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e(M,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(st,{modelValue:D.value.is_critical,"onUpdate:modelValue":s[2]||(s[2]=H=>D.value.is_critical=H),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(R,{color:n.value?"primary":ne.value?"warning":"#D4A574",onClick:k,loading:p.value,disabled:!D.value.item_id||!D.value.quantity,block:""},{default:t(()=>[e($,{icon:n.value?"mdi-content-save":ne.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),v(" "+d(n.value?"Update":ne.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),n.value?(h(),j(R,{key:0,color:"grey",variant:"outlined",onClick:m,size:"small",block:""},{default:t(()=>[e($,{icon:"mdi-close",class:"me-1"}),s[15]||(s[15]=v(" Batal "))]),_:1,__:[15]})):oe("",!0)]),_:1})]),_:1})]),_:1},512)]),a("div",Hs,[a("div",Ms,[a("h4",Bs,"Daftar Item Komposisi ("+d(o.value.length)+")",1)]),o.value.length>0?(h(),de("div",Fs,[(h(!0),de(Te,null,Ze(o.value,(H,ae)=>(h(),j(ie,{key:ae,variant:"outlined",class:"mb-3"},{default:t(()=>[e(ve,{class:"pa-3"},{default:t(()=>{var se,U,fe,ge,Ae,Me,ze;return[a("div",Rs,[a("div",Ks,[e($,{icon:"mdi-check-circle",color:"success"}),a("div",null,[a("div",Ns,d(H.name),1),a("div",qs,[a("span",Ls,"Dibutuhkan: "+d(H.quantity)+" "+d(H.unit),1),s[16]||(s[16]=v(" â€¢ ")),a("span",{class:Xe({"text-success":(((se=H.inventory)==null?void 0:se.current_stock)??0)>(((U=H.inventory)==null?void 0:U.reorder_level)??0),"text-warning":(((fe=H.inventory)==null?void 0:fe.current_stock)??0)<=(((ge=H.inventory)==null?void 0:ge.reorder_level)??0)&&(((Ae=H.inventory)==null?void 0:Ae.current_stock)??0)>0,"text-error":(((Me=H.inventory)==null?void 0:Me.current_stock)??0)<=0})}," Stok: "+d(((ze=H.inventory)==null?void 0:ze.current_stock)||H.stock||0)+" "+d(H.unit),3),v(" â€¢ "+d(me(H.price)),1)])])]),a("div",Os,[e(R,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:qe=>c(H,ae)},null,8,["onClick"]),e(R,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:qe=>_(H,ae)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(h(),j(ie,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e($,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),s[17]||(s[17]=a("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(Fe,{class:"px-6 pb-6"},{default:t(()=>[e(R,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:$e},{default:t(()=>s[18]||(s[18]=[v(" Setting HPP ")])),_:1,__:[18]}),e(Ne),e(R,{variant:"outlined",onClick:Se,disabled:p.value},{default:t(()=>s[19]||(s[19]=[v(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(R,{color:"#D4A574",onClick:Ue,loading:p.value,disabled:o.value.length===0},{default:t(()=>s[20]||(s[20]=[v(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(bs,{modelValue:y.value,"onUpdate:modelValue":s[4]||(s[4]=H=>y.value=H),"variant-id":((B=Z.variant)==null?void 0:B.id)||((X=Z.variant)==null?void 0:X.id_variant),"variant-name":(te=Z.variant)==null?void 0:te.name,onHppUpdated:s[5]||(s[5]=H=>r("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Be,{modelValue:x.value,"onUpdate:modelValue":s[6]||(s[6]=H=>x.value=H),"max-width":"400px",persistent:""},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e($,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),s[21]||(s[21]=v(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(Ce),e(ve,{class:"pa-6"},{default:t(()=>[a("div",js,[e($,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),s[24]||(s[24]=a("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),K.value?(h(),de("div",Gs,[a("strong",null,d(K.value.item.name),1),s[22]||(s[22]=a("br",null,null,-1)),v(" Dibutuhkan: "+d(K.value.item.quantity)+" "+d(K.value.item.unit),1)])):oe("",!0),e(Re,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>s[23]||(s[23]=[a("strong",null,"Perhatian:",-1),v(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(Fe,{class:"px-6 pb-6"},{default:t(()=>[e(R,{variant:"outlined",onClick:we,disabled:Y.value,class:"flex-grow-1"},{default:t(()=>s[25]||(s[25]=[v(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(R,{color:"error",onClick:ce,loading:Y.value,class:"flex-grow-1"},{default:t(()=>s[26]||(s[26]=[v(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Be,{modelValue:S.value,"onUpdate:modelValue":s[8]||(s[8]=H=>S.value=H),"max-width":"450px",persistent:""},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ve,{class:Xe(["d-flex align-center justify-center text-h6",ke()])},{default:t(()=>[e($,{icon:ye(),color:W(),class:"me-2",size:"24"},null,8,["icon","color"]),v(" "+d(G.value),1)]),_:1},8,["class"]),e(Ce),e(ve,{class:"pa-6"},{default:t(()=>[a("div",Ws,[e($,{icon:ye(),color:W(),size:"64",class:"mb-4"},null,8,["icon","color"]),a("div",Xs,d(f.value),1),e(Re,{type:P.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[P.value==="success"?(h(),de(Te,{key:0},[s[27]||(s[27]=a("strong",null,"Berhasil!",-1)),s[28]||(s[28]=v(" Perubahan telah disimpan. "))],64)):P.value==="info"?(h(),de(Te,{key:1},[s[29]||(s[29]=a("strong",null,"Informasi:",-1)),s[30]||(s[30]=v(" Item telah diperbarui sesuai permintaan. "))],64)):(h(),de(Te,{key:2},[s[31]||(s[31]=a("strong",null,"Perhatian:",-1)),s[32]||(s[32]=v(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(Fe,{class:"px-6 pb-6"},{default:t(()=>[e(Ne),e(R,{color:ue(),onClick:s[7]||(s[7]=H=>S.value=!1),class:"px-6"},{default:t(()=>[e($,{icon:"mdi-check",class:"me-1"}),s[33]||(s[33]=v(" OK "))]),_:1,__:[33]},8,["color"]),e(Ne)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Js=Oe(Ys,[["__scopeId","data-v-df449ced"]]),Qs={class:"variant-table"},Zs={class:"d-flex align-center gap-2"},ei={class:"text-h5 font-weight-bold"},ti={class:"text-body-2 text-medium-emphasis"},ai={class:"d-flex gap-2"},li={class:"d-flex align-center gap-2"},oi={key:0,class:"text-center pa-12"},ni={class:"text-h5 font-weight-bold mb-4"},si={class:"text-body-1 text-medium-emphasis mb-6"},ii={class:"d-flex align-center gap-3"},ri={class:"text-h6 font-weight-medium"},ui={class:"text-sm text-medium-emphasis"},di={class:"text-high-emphasis font-weight-medium"},ci={class:"d-flex flex-column gap-1"},mi={class:"d-flex gap-1"},vi=He({__name:"ProductVariantTable",props:{variants:{},product:{},loading:{type:Boolean}},emits:["refresh","create-variant","edit-variant","delete-variant"],setup(l,{emit:T}){const i=l,r=T,C=F(!1),p=F(!1),b=F(!1),u=F(!1),o=F(!1),n=F(null),Q=F(!1),x=F({search:"",status:null,stockStatus:"",sortBy:"name_asc"}),K=[{title:"Variant",key:"name",sortable:!0},{title:"Harga",key:"price",sortable:!0},{title:"Status",key:"is_active",sortable:!0},{title:"Komposisi",key:"composition",sortable:!1},{title:"Aksi",key:"actions",sortable:!1}],Y=[{title:"Aktif",value:!0},{title:"Tidak Aktif",value:!1}],S=[{title:"Stok Aman",value:"safe"},{title:"Stok Rendah",value:"low"},{title:"Stok Habis",value:"out"}],f=[{title:"Nama (A-Z)",value:"name_asc"},{title:"Nama (Z-A)",value:"name_desc"},{title:"Harga (Rendah-Tinggi)",value:"price_asc"},{title:"Harga (Tinggi-Rendah)",value:"price_desc"},{title:"Stok (Rendah-Tinggi)",value:"stock_asc"},{title:"Stok (Tinggi-Rendah)",value:"stock_desc"}],G=re(()=>!!(x.value.search||x.value.status!==null||x.value.stockStatus||x.value.sortBy!=="name_asc")),P=re(()=>{let q=0;return x.value.search&&q++,x.value.status!==null&&q++,x.value.stockStatus&&q++,x.value.sortBy!=="name_asc"&&q++,q}),y=re(()=>{let q=[...i.variants];if(x.value.search){const N=x.value.search.toLowerCase();q=q.filter(J=>J.name.toLowerCase().includes(N)||J.sku.toLowerCase().includes(N))}if(x.value.status!==null&&(q=q.filter(N=>N.is_active===x.value.status)),x.value.stockStatus&&(q=q.filter(N=>E(N).value===x.value.stockStatus)),x.value.sortBy){const[N,J]=x.value.sortBy.split("_");q.sort((g,z)=>{let k,c;switch(N){case"name":k=g.name.toLowerCase(),c=z.name.toLowerCase();break;case"price":k=g.price,c=z.price;break;case"stock":k=g.current_stock,c=z.current_stock;break;default:return 0}return J==="asc"?k<c?-1:k>c?1:0:k>c?-1:k<c?1:0})}return q}),E=q=>q.current_stock<=0?{text:"Stok Habis",color:"error",value:"out"}:q.current_stock<=q.min_stock?{text:"Stok Rendah",color:"warning",value:"low"}:{text:"Stok Aman",color:"success",value:"safe"},V=q=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(q),D=q=>{var N,J;return(N=q.composition_summary)!=null&&N.total_items?q.composition_summary.total_items:(J=q.variant_items)!=null&&J.length?q.variant_items.length:q.variant_items_count||0},L=()=>{x.value={search:"",status:null,stockStatus:"",sortBy:"name_asc"}},ne=()=>{n.value=null,Q.value=!1,C.value=!0},ee=q=>{console.log("ðŸ”µ ProductVariantTable - openEditDialog called with variant:",q),n.value={...q},Q.value=!0,C.value=!0,console.log("ðŸ”µ ProductVariantTable - selectedVariant set to:",n.value),console.log("ðŸ”µ ProductVariantTable - editMode:",Q.value),console.log("ðŸ”µ ProductVariantTable - formDialog:",C.value)},w=q=>{console.log("ðŸŸ¢ [DEBUG] Button clicked! Opening Add Item dialog for variant:",q.name),console.log("ðŸŸ¢ [DEBUG] Current addItemDialog state:",o.value),console.log("ðŸŸ¢ [DEBUG] Setting selectedVariant to:",q),n.value=q,o.value=!0,console.log("ðŸŸ¢ [DEBUG] New addItemDialog state:",o.value),console.log("ðŸŸ¢ [DEBUG] New selectedVariant:",n.value)},I=()=>{C.value=!1,r("refresh")},O=()=>{p.value=!1,r("refresh")},me=()=>{console.log("ðŸ”„ handleAddItemSave called - refreshing data..."),o.value=!1,r("refresh"),console.log("âœ… refresh event emitted to parent")};return(q,N)=>{var J;return h(),de("div",Qs,[e(ie,{class:"mb-6"},{default:t(()=>[e(Ve,{class:"d-flex align-center justify-between"},{default:t(()=>{var g,z;return[a("div",Zs,[e($,{icon:"mdi-package-variant",class:"coffee-icon"}),a("div",null,[a("h2",ei,"Variant Produk - "+d((g=q.product)==null?void 0:g.name),1),a("p",ti," Kelola variant dan komposisi untuk produk "+d((z=q.product)==null?void 0:z.name),1)]),q.variants.length?(h(),j(pe,{key:0,size:"small",color:"primary",variant:"tonal"},{default:t(()=>[v(d(q.variants.length)+" variant ",1)]),_:1})):oe("",!0)]),a("div",ai,[e(R,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:N[0]||(N[0]=k=>r("refresh")),loading:q.loading},{default:t(()=>N[11]||(N[11]=[v(" Refresh ")])),_:1,__:[11]},8,["loading"]),e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:ne},{default:t(()=>N[12]||(N[12]=[v(" Tambah Variant ")])),_:1,__:[12]})])]}),_:1})]),_:1}),e(ie,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ve,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(M,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:x.value.search,"onUpdate:modelValue":N[1]||(N[1]=g=>x.value.search=g),label:"Cari Variant",placeholder:"Nama variant atau SKU...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(Ke,{modelValue:x.value.status,"onUpdate:modelValue":N[2]||(N[2]=g=>x.value.status=g),items:Y,label:"Status",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-toggle-switch","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(Ke,{modelValue:x.value.stockStatus,"onUpdate:modelValue":N[3]||(N[3]=g=>x.value.stockStatus=g),items:S,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(Ke,{modelValue:x.value.sortBy,"onUpdate:modelValue":N[4]||(N[4]=g=>x.value.sortBy=g),items:f,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[a("div",li,[G.value?(h(),j(R,{key:0,variant:"outlined",color:"secondary",onClick:L,block:""},{default:t(()=>[v(" Reset ("+d(P.value)+") ",1)]),_:1})):oe("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),q.loading?(h(),de("div",oi,[e(Kt,{indeterminate:"",size:"64",color:"primary"}),N[13]||(N[13]=a("p",{class:"text-h6 mt-4"},"Memuat variant...",-1))])):y.value.length===0?(h(),j(ie,{key:1,class:"text-center pa-12"},{default:t(()=>{var g;return[e($,{icon:"mdi-package-variant-closed",size:"96",class:"text-disabled mb-6"}),a("h3",ni,d(q.variants.length===0?"Belum Ada Variant":"Tidak Ada Variant Ditemukan"),1),a("p",si,d(q.variants.length===0?`Buat variant untuk produk ${(g=q.product)==null?void 0:g.name} agar dapat melihat berbagai varian yang tersedia`:"Coba ubah filter pencarian untuk menemukan variant yang Anda cari"),1),q.variants.length===0?(h(),j(R,{key:0,color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:ne},{default:t(()=>N[14]||(N[14]=[v(" Buat Variant Pertama ")])),_:1,__:[14]})):oe("",!0)]}),_:1})):(h(),j(ie,{key:2},{default:t(()=>[e(jt,{headers:K,items:y.value,loading:q.loading,"item-value":"id","show-select":"",class:"text-no-wrap"},{"item.name":t(({item:g})=>{var z;return[a("div",ii,[e(Ie,{image:(z=q.product)==null?void 0:z.image_url,size:"38",variant:"tonal",color:"primary"},{default:t(()=>{var k;return[(k=q.product)!=null&&k.image_url?oe("",!0):(h(),j($,{key:0,icon:"mdi-package-variant",size:"20"}))]}),_:1},8,["image"]),a("div",null,[a("h6",ri,d(g.name),1),a("span",ui,d(g.sku),1)])])]}),"item.price":t(({item:g})=>[a("span",di,d(V(g.price)),1)]),"item.is_active":t(({item:g})=>[e(pe,{color:g.is_active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[v(d(g.is_active?"Aktif":"Nonaktif"),1)]),_:2},1032,["color"])]),"item.composition":t(({item:g})=>[a("div",ci,[D(g)>0?(h(),j(pe,{key:0,color:"success",size:"small",variant:"tonal",class:"cursor-pointer"},{default:t(()=>[v(d(D(g))+" Item ",1)]),_:2},1024)):(h(),j(pe,{key:1,color:"warning",size:"small",variant:"tonal"},{default:t(()=>N[15]||(N[15]=[v(" Belum ada ")])),_:1,__:[15]}))])]),"item.actions":t(({item:g})=>[a("div",mi,[e(Le,{text:"Tambah Item Komposisi"},{activator:t(({props:z})=>[e(R,he(z,{icon:"mdi-plus-circle",size:"small",variant:"text",color:"success",onClick:k=>w(g)}),null,16,["onClick"])]),_:2},1024),e(Le,{text:"Edit Variant"},{activator:t(({props:z})=>[e(R,he(z,{icon:"mdi-pencil",size:"small",variant:"text",color:"secondary",onClick:k=>ee(g)}),null,16,["onClick"])]),_:2},1024),e(Le,{text:"Hapus Variant"},{activator:t(({props:z})=>[e(R,he(z,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:k=>r("delete-variant",g)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["items","loading"])]),_:1})),e(Mn,{modelValue:C.value,"onUpdate:modelValue":N[5]||(N[5]=g=>C.value=g),variant:Q.value?n.value:null,products:q.product?[q.product]:[],"product-id":(J=q.product)==null?void 0:J.id,onSave:I,ref:"variantFormDialogRef"},null,8,["modelValue","variant","products","product-id"]),e(Nn,{modelValue:p.value,"onUpdate:modelValue":N[6]||(N[6]=g=>p.value=g),variant:n.value,onSave:O},null,8,["modelValue","variant"]),e(Js,{modelValue:o.value,"onUpdate:modelValue":N[7]||(N[7]=g=>o.value=g),variant:n.value,onSave:me},null,8,["modelValue","variant"]),e(Jn,{modelValue:b.value,"onUpdate:modelValue":N[8]||(N[8]=g=>b.value=g),variant:n.value},null,8,["modelValue","variant"]),e(as,{modelValue:u.value,"onUpdate:modelValue":N[9]||(N[9]=g=>u.value=g),product:q.product,onRefresh:N[10]||(N[10]=g=>r("refresh"))},null,8,["modelValue","product"])])}}}),pi=Oe(vi,[["__scopeId","data-v-25ad3730"]]),fi={class:"product-variant-tab"},gi=He({__name:"ProductVariantTab",props:{product:{}},setup(l){const T=l,i=F(!1),r=F([]),C=F(!1),p=F(!1),b=F(null),u=(x,K="success")=>{},o=async()=>{var K,Y,S,f,G;const x=((K=T.product)==null?void 0:K.id_product)||((Y=T.product)==null?void 0:Y.id);if(x){i.value=!0;try{const P={product_id:x,per_page:100,page:1},y=await Ee.get("/api/variants",{params:P});if(y.data.success===!1)throw new Error(y.data.message||"Failed to load variants");const E=((S=y.data.data)==null?void 0:S.data)||y.data.data||y.data||[];r.value=E.map(V=>({...V,is_active:V.active,id:V.id_variant||V.id,product_id:V.id_product||V.product_id}))}catch(P){(G=(f=P.response)==null?void 0:f.data)!=null&&G.message||P.message,r.value=[]}finally{i.value=!1}}},n=x=>{b.value=x,C.value=!0},Q=async()=>{if(b.value){p.value=!0;try{await Ee.delete(`/api/variants/${b.value.id}`),u("Variant berhasil dihapus"),C.value=!1,o()}catch{}finally{p.value=!1}}};return it(()=>{o()}),(x,K)=>{var Y;return h(),de("div",fi,[e(pi,{variants:r.value,product:T.product,loading:i.value,onRefresh:o,onDeleteVariant:n},null,8,["variants","product","loading"]),e(At,{modelValue:C.value,"onUpdate:modelValue":K[0]||(K[0]=S=>C.value=S),title:"Konfirmasi Hapus Variant","item-name":(Y=b.value)==null?void 0:Y.name,loading:p.value,"confirm-text":"Hapus Variant",onConfirm:Q,onCancel:K[1]||(K[1]=S=>C.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),Ut=Oe(gi,[["__scopeId","data-v-7ba763eb"]]),_i={class:"product-management"},ki={class:"d-flex justify-space-between align-center mb-6"},yi={class:"d-flex gap-3 align-center"},bi={key:0,class:"d-flex gap-2"},hi={class:"d-flex align-center"},xi=He({__name:"products-management",setup(l){Nt();const{productsList:T,categories:i,loading:r,saveLoading:C,deleteLoading:p,toggleLoading:b,stats:u,dialog:o,deleteDialog:n,editMode:Q,selectedProduct:x,selectedProducts:K,currentPage:Y,totalItems:S,itemsPerPage:f,filters:G,errorMessage:P,successMessage:y,modalErrorMessage:E,formData:V,selectedImage:D,imagePreview:L,canCreateEdit:ne,hasSelectedProducts:ee,fetchProductsList:w,fetchCategories:I,fetchStats:O,saveProduct:me,deleteProduct:q,bulkDeleteProducts:N,toggleActiveStatus:J,toggleFeaturedStatus:g,openCreateDialog:z,openEditDialog:k,openDeleteDialog:c,closeDialog:m,handleImageUpload:_,clearModalError:ce,onPageChange:we}=Lt(),{dialog:ye,editMode:W,formData:ke,availableItems:ue,saveLoading:Ue,modalErrorMessage:$e,openCreateDialog:Se,closeDialog:Z,saveRecipe:s,clearModalError:B,fetchAvailableItems:X}=Ma(),{productItemsList:te,loading:H,fetchProductItemsForComposition:ae}=ta(),se=F("products"),U=F(!1),fe=F(null),ge=F(!1),Ae=F(null),Me=async()=>{await q()},ze=async()=>{await N()},qe=De=>{const le=De.id_product||De.id;Se(le)},We=async De=>{fe.value=De;try{await ae({page:1,per_page:50,critical_only:!1})}catch{}U.value=!0},rt=De=>{Ae.value=De,ge.value=!0},ut=De=>{if(!De)return[];const le=De.id_product||De.id;return te.value.filter(at=>{var _e;return((_e=at.product)==null?void 0:_e.id_product)===le||at.product_id===le})||[]},dt=De=>{Object.assign(G,De),w()},Zt=De=>{G.search=De,w()},ea=()=>{D.value=null,L.value&&(L.value="")};return be(se,async De=>{De==="compositions"&&await ae({page:1,per_page:15,critical_only:!1})},{immediate:!1}),it(()=>{w(),I(),O(),X()}),(De,le)=>{var at;return h(),de("div",_i,[a("div",ki,[le[19]||(le[19]=a("div",null,[a("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),a("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),a("div",yi,[A(ee)&&se.value==="products"?(h(),de("div",bi,[e(pe,{color:"primary",size:"small"},{default:t(()=>[v(d(A(K).length)+" dipilih ",1)]),_:1}),e(R,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:ze},{default:t(()=>le[17]||(le[17]=[v(" Hapus Terpilih ")])),_:1,__:[17]})])):oe("",!0),A(ne)&&se.value==="products"?(h(),j(R,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:A(z)},{default:t(()=>le[18]||(le[18]=[v(" Tambah Produk ")])),_:1,__:[18]},8,["onClick"])):oe("",!0)])]),e(kl,{modelValue:se.value,"onUpdate:modelValue":le[0]||(le[0]=_e=>se.value=_e),class:"mb-6"},{default:t(()=>[e(vt,{value:"products"},{default:t(()=>[e($,{icon:"mdi-coffee",class:"me-2"}),le[20]||(le[20]=v(" Produk "))]),_:1,__:[20]}),e(vt,{value:"compositions"},{default:t(()=>[e($,{icon:"mdi-chef-hat",class:"me-2"}),le[21]||(le[21]=v(" Komposisi Produk "))]),_:1,__:[21]}),e(vt,{value:"variants"},{default:t(()=>[e($,{icon:"mdi-tune-variant",class:"me-2"}),le[22]||(le[22]=v(" Variant Produk "))]),_:1,__:[22]})]),_:1},8,["modelValue"]),A(P)?(h(),j(Re,{key:0,type:"error",variant:"outlined",class:"mb-4",text:A(P),closable:"","onClick:close":le[1]||(le[1]=_e=>P.value="")},null,8,["text"])):oe("",!0),A(y)?(h(),j(Re,{key:1,type:"success",variant:"outlined",class:"mb-4",text:A(y),closable:"","onClick:close":le[2]||(le[2]=_e=>y.value="")},null,8,["text"])):oe("",!0),e(bt,{modelValue:se.value,"onUpdate:modelValue":le[4]||(le[4]=_e=>se.value=_e)},{default:t(()=>[e(ot,{value:"products"},{default:t(()=>[e(gn,{stats:A(u)},null,8,["stats"]),e(Jo,{filters:A(G),"onUpdate:filters":dt,onSearch:Zt},null,8,["filters"]),e(En,{products:A(T),loading:A(r),"current-page":A(Y),"total-items":A(S),"items-per-page":A(f),"selected-products":A(K),"toggle-loading":A(b),"onUpdate:page":A(we),onAddProduct:A(z),onEditProduct:A(k),onOpenRecipeDialog:qe,onOpenCompositionDialog:We,onOpenVariantDialog:rt,onDeleteProduct:A(c),onToggleActive:A(J),onToggleFeatured:A(g),"onUpdate:selectedProducts":le[3]||(le[3]=_e=>K.value=_e)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:page","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured"])]),_:1}),e(ot,{value:"compositions"},{default:t(()=>[e(ko,{"product-items":A(te),loading:A(H),onRefresh:A(ae)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(ot,{value:"variants"},{default:t(()=>[e(Ut,{loading:A(r),onRefresh:A(w)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(jo,{modelValue:A(o),"onUpdate:modelValue":[le[5]||(le[5]=_e=>ft(o)?o.value=_e:null),le[6]||(le[6]=_e=>o.value=_e)],"edit-mode":A(Q),"form-data":A(V),categories:A(i),loading:A(C),"error-message":A(E),"selected-image":A(D)?[A(D)]:[],"image-preview":A(L),onClose:A(m),onSubmit:A(me),onImageChange:A(_),onRemoveImage:ea,onClearError:A(ce),onUpdateForm:le[7]||(le[7]=(_e,Ct)=>A(V)[_e]=Ct)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(Ba,{modelValue:A(ye),"onUpdate:modelValue":[le[8]||(le[8]=_e=>ft(ye)?ye.value=_e:null),le[9]||(le[9]=_e=>ye.value=_e)],"edit-mode":A(W),"form-data":A(ke),"available-items":A(ue),loading:A(Ue),"error-message":A($e),onClose:A(Z),onSave:A(s),onClearError:A(B)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(At,{modelValue:A(n),"onUpdate:modelValue":le[10]||(le[10]=_e=>ft(n)?n.value=_e:null),title:"Konfirmasi Hapus Produk","item-name":(at=A(x))==null?void 0:at.name,loading:A(p),"confirm-text":"Hapus Produk",onConfirm:Me,onCancel:le[11]||(le[11]=_e=>n.value=!1)},null,8,["modelValue","item-name","loading"]),e(Qt,{modelValue:U.value,"onUpdate:modelValue":le[12]||(le[12]=_e=>U.value=_e),product:fe.value,items:ut(fe.value),onSave:le[13]||(le[13]=()=>{A(w)(),U.value=!1}),onRefresh:A(w)},null,8,["modelValue","product","items","onRefresh"]),e(Be,{modelValue:ge.value,"onUpdate:modelValue":le[16]||(le[16]=_e=>ge.value=_e),"max-width":"1400px",persistent:""},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ve,{class:"d-flex justify-between align-center"},{default:t(()=>{var _e;return[a("div",hi,[e($,{icon:"tabler-versions",class:"me-2"}),v(" Kelola Variant - "+d((_e=Ae.value)==null?void 0:_e.name),1)]),e(R,{icon:"tabler-x",variant:"text",onClick:le[14]||(le[14]=Ct=>ge.value=!1)})]}),_:1}),e(Ce),e(ve,{class:"pa-0"},{default:t(()=>[Ae.value?(h(),j(Ut,{key:0,product:Ae.value},null,8,["product"])):oe("",!0)]),_:1}),e(Ce),e(Fe,null,{default:t(()=>[e(Ne),e(R,{color:"grey-darken-1",variant:"outlined",onClick:le[15]||(le[15]=_e=>ge.value=!1)},{default:t(()=>[e($,{icon:"mdi-close",class:"me-1"}),le[23]||(le[23]=v(" Tutup "))]),_:1,__:[23]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),pr=Oe(xi,[["__scopeId","data-v-8c8b1097"]]);export{pr as default};
