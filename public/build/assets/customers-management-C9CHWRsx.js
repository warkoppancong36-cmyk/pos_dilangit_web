import{D as De}from"./DeleteConfirmationDialog-COQs7A1o.js";import{d as ee,r as h,V as Z,w as he,g as P,f as t,b as e,e as r,t as g,a1 as L,a0 as Ee,l as G,at as _e,s as V,o as C,ao as Se,ap as Te,X as I,aL as Le,H as Pe,I as ze,_ as we,ax as Ue,p as ae,c as X,au as N,D as Me,m as p,a3 as Ae}from"./main-ftV0BV8l.js";import{V as Fe}from"./VDialog-CIm64IzE.js";import{b as Be,V as A,c as Ie}from"./VCard-BoGAdaOW.js";import{V as be}from"./VDivider-DXUnSDtf.js";import{V as Re}from"./VForm-DcJYfAcx.js";import{V as F}from"./VCardText-CyMfpyTK.js";import{V as B,a as v}from"./VRow-CMgwiuSf.js";import{V as O}from"./VTextField-BQM0teX1.js";import{V as q}from"./VSelect-CDhT9_cE.js";import{V as Oe}from"./VSwitch-CxipefWx.js";import{V as fe}from"./VTextarea-Bkhx8Cg4.js";import{V as je,a as Ne}from"./VExpansionPanels-DIKBrF5k.js";import{V as R}from"./VChip-BtgdanD9.js";import{V as xe}from"./VSpacer-BHQRNPFh.js";import{a as le,V as Ke}from"./VList-KThY8eRG.js";import{V as J}from"./VAvatar--z1xC-qv.js";import{V as ye}from"./VTooltip-BTeaRlOI.js";import{V as Ge}from"./VMenu-L3c0hJlO.js";import{V as Je}from"./VDataTable-CUkhDNUD.js";import"./VOverlay-4rsKAMqo.js";import"./forwardRefs-B931MWyl.js";import"./VImg-DIulH_eJ.js";/* empty css              */import"./VCheckboxBtn-4YHPWYip.js";import"./VTable-BWqbm5M7.js";import"./filter-jD9KVOQM.js";const He={class:"text-center"},qe={class:"text-h6 text-primary"},Xe={class:"text-center"},Qe={class:"text-h6 text-success"},We={class:"text-center"},Ye={class:"text-center"},Ze=ee({__name:"CustomerDialog",props:{dialog:{type:Boolean},editMode:{type:Boolean},selectedCustomer:{},formData:{},saveLoading:{type:Boolean},modalErrorMessage:{},nameRules:{},emailRules:{},phoneRules:{},genderOptions:{}},emits:["update:dialog","update:form-data","save","close","clear-modal-error"],setup(z,{emit:d}){const i=z,o=d,m=h(),n=Z({get:()=>i.formData,set:s=>o("update:form-data",s)}),x=h(""),b=h(!1);he(()=>i.selectedCustomer,s=>{if(s!=null&&s.preferences)try{x.value=JSON.stringify(s.preferences,null,2),b.value=!1}catch{x.value="",b.value=!1}else x.value="",b.value=!1},{immediate:!0}),he(x,s=>{if(!s.trim()){n.value.preferences={},b.value=!1;return}try{const a=JSON.parse(s);n.value.preferences=a,b.value=!1}catch{b.value=!0}});const $=async()=>{const{valid:s}=await m.value.validate();s&&!b.value&&o("save")},w=()=>{o("close")},D=()=>{o("clear-modal-error")},E=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),U=s=>{switch(s){case"platinum":return"purple";case"gold":return"amber";case"silver":return"blue-grey";case"bronze":return"orange";case"basic":return"grey";default:return"grey"}},k=s=>{switch(s){case"platinum":return"Platinum";case"gold":return"Gold";case"silver":return"Silver";case"bronze":return"Bronze";case"basic":return"Basic";default:return"-"}},M=s=>{switch(s){case"active":return"success";case"regular":return"info";case"inactive":return"warning";case"dormant":return"error";default:return"grey"}},f=s=>{switch(s){case"active":return"Aktif";case"regular":return"Reguler";case"inactive":return"Tidak Aktif";case"dormant":return"Dorman";default:return"-"}};return(s,a)=>(C(),P(Fe,{"model-value":s.dialog,"max-width":"600px",persistent:"","onUpdate:modelValue":a[11]||(a[11]=u=>s.$emit("update:dialog",u))},{default:t(()=>[e(A,null,{default:t(()=>[e(Be,{class:"d-flex align-center justify-space-between"},{default:t(()=>[r("span",null,g(s.editMode?"Edit Customer":"Tambah Customer Baru"),1),e(L,{icon:"tabler-x",variant:"text",size:"small",onClick:w})]),_:1}),e(be),e(Re,{ref_key:"formRef",ref:m,onSubmit:Ee($,["prevent"])},{default:t(()=>[e(F,null,{default:t(()=>[s.modalErrorMessage?(C(),P(_e,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-4","onClick:close":D},{default:t(()=>[V(g(s.modalErrorMessage),1)]),_:1})):G("",!0),e(B,null,{default:t(()=>[s.editMode?(C(),P(v,{key:0,cols:"12",md:"6"},{default:t(()=>{var u;return[e(O,{"model-value":(u=s.selectedCustomer)==null?void 0:u.customer_code,label:"Kode Customer",readonly:"",variant:"outlined","prepend-inner-icon":"tabler-id"},null,8,["model-value"])]}),_:1})):G("",!0),e(v,{cols:s.editMode?6:12},{default:t(()=>[e(O,{modelValue:n.value.name,"onUpdate:modelValue":a[0]||(a[0]=u=>n.value.name=u),label:"Nama Customer *",placeholder:"Masukkan nama lengkap",rules:s.nameRules,variant:"outlined","prepend-inner-icon":"tabler-user",autofocus:""},null,8,["modelValue","rules"])]),_:1},8,["cols"])]),_:1}),e(B,null,{default:t(()=>[e(v,{cols:"12",md:"6"},{default:t(()=>[e(O,{modelValue:n.value.email,"onUpdate:modelValue":a[1]||(a[1]=u=>n.value.email=u),label:"Email",placeholder:"customer@email.com",type:"email",rules:s.emailRules,variant:"outlined","prepend-inner-icon":"tabler-mail"},null,8,["modelValue","rules"])]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(O,{modelValue:n.value.phone,"onUpdate:modelValue":a[2]||(a[2]=u=>n.value.phone=u),label:"Nomor Telepon",placeholder:"08xxxxxxxxxx",rules:s.phoneRules,variant:"outlined","prepend-inner-icon":"tabler-phone"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(B,null,{default:t(()=>[e(v,{cols:"12",md:"4"},{default:t(()=>[e(O,{modelValue:n.value.birth_date,"onUpdate:modelValue":a[3]||(a[3]=u=>n.value.birth_date=u),label:"Tanggal Lahir",type:"date",variant:"outlined","prepend-inner-icon":"tabler-calendar"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"4"},{default:t(()=>[e(q,{modelValue:n.value.gender,"onUpdate:modelValue":a[4]||(a[4]=u=>n.value.gender=u),label:"Jenis Kelamin",items:s.genderOptions,clearable:"",variant:"outlined","prepend-inner-icon":"tabler-gender-male"},null,8,["modelValue","items"])]),_:1}),e(v,{cols:"12",md:"4"},{default:t(()=>[e(Oe,{modelValue:n.value.active,"onUpdate:modelValue":a[5]||(a[5]=u=>n.value.active=u),label:"Customer Aktif",color:"success",inset:"","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(B,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(fe,{modelValue:n.value.address,"onUpdate:modelValue":a[6]||(a[6]=u=>n.value.address=u),label:"Alamat",placeholder:"Masukkan alamat lengkap",rows:"2","auto-grow":"",variant:"outlined","prepend-inner-icon":"tabler-map-pin"},null,8,["modelValue"])]),_:1})]),_:1}),e(B,null,{default:t(()=>[e(v,{cols:"12",md:"6"},{default:t(()=>[e(O,{modelValue:n.value.city,"onUpdate:modelValue":a[7]||(a[7]=u=>n.value.city=u),label:"Kota",placeholder:"Nama kota",variant:"outlined","prepend-inner-icon":"tabler-building"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"6"},{default:t(()=>[e(O,{modelValue:n.value.postal_code,"onUpdate:modelValue":a[8]||(a[8]=u=>n.value.postal_code=u),label:"Kode Pos",placeholder:"12345",variant:"outlined","prepend-inner-icon":"tabler-mailbox"},null,8,["modelValue"])]),_:1})]),_:1}),e(B,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(fe,{modelValue:n.value.notes,"onUpdate:modelValue":a[9]||(a[9]=u=>n.value.notes=u),label:"Catatan",placeholder:"Catatan tambahan tentang customer",rows:"2","auto-grow":"",variant:"outlined","prepend-inner-icon":"tabler-notes"},null,8,["modelValue"])]),_:1})]),_:1}),s.editMode?(C(),P(je,{key:1,class:"mt-4"},{default:t(()=>[e(Ne,{title:"Preferensi Customer",text:"Atur preferensi dan pengaturan khusus customer"},{text:t(()=>[e(B,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[e(fe,{modelValue:x.value,"onUpdate:modelValue":a[10]||(a[10]=u=>x.value=u),label:"Preferensi (JSON)",placeholder:'{"newsletter": true, "sms_notifications": false}',rows:"3",variant:"outlined",error:b.value,"error-messages":b.value?"Format JSON tidak valid":""},null,8,["modelValue","error","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1})):G("",!0),s.editMode&&s.selectedCustomer?(C(),P(A,{key:2,variant:"tonal",class:"mt-4"},{default:t(()=>[e(F,null,{default:t(()=>[a[16]||(a[16]=r("div",{class:"text-h6 mb-3"},"Statistik Customer",-1)),e(B,null,{default:t(()=>[e(v,{cols:"6",md:"3"},{default:t(()=>[r("div",He,[r("div",qe,g(s.selectedCustomer.total_visits),1),a[12]||(a[12]=r("div",{class:"text-caption text-medium-emphasis"},"Total Kunjungan",-1))])]),_:1}),e(v,{cols:"6",md:"3"},{default:t(()=>[r("div",Xe,[r("div",Qe,g(E(s.selectedCustomer.total_spent)),1),a[13]||(a[13]=r("div",{class:"text-caption text-medium-emphasis"},"Total Belanja",-1))])]),_:1}),e(v,{cols:"6",md:"3"},{default:t(()=>[r("div",We,[e(R,{color:U(s.selectedCustomer.loyalty_level||""),size:"small",variant:"elevated"},{default:t(()=>[V(g(k(s.selectedCustomer.loyalty_level||"")),1)]),_:1},8,["color"]),a[14]||(a[14]=r("div",{class:"text-caption text-medium-emphasis mt-1"},"Level Loyalitas",-1))])]),_:1}),e(v,{cols:"6",md:"3"},{default:t(()=>[r("div",Ye,[e(R,{color:M(s.selectedCustomer.customer_status||""),size:"small",variant:"tonal"},{default:t(()=>[V(g(f(s.selectedCustomer.customer_status||"")),1)]),_:1},8,["color"]),a[15]||(a[15]=r("div",{class:"text-caption text-medium-emphasis mt-1"},"Status Customer",-1))])]),_:1})]),_:1})]),_:1,__:[16]})]),_:1})):G("",!0)]),_:1}),e(be),e(Ie,{class:"pa-4"},{default:t(()=>[e(xe),e(L,{variant:"outlined",onClick:w},{default:t(()=>a[17]||(a[17]=[V(" Batal ")])),_:1,__:[17]}),e(L,{type:"submit",color:"primary",loading:s.saveLoading},{default:t(()=>[V(g(s.editMode?"Perbarui":"Simpan"),1)]),_:1},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),et={class:"d-flex gap-2"},tt=ee({__name:"CustomerSearchFilters",props:{filters:{},genderOptions:{},loyaltyLevelOptions:{}},emits:["update:filters"],setup(z,{emit:d}){const i=z,o=d,m=h(!1),n=h({...i.filters});he(()=>i.filters,f=>{n.value={...f}},{deep:!0});const x=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],b=[{title:"7 hari terakhir",value:7},{title:"30 hari terakhir",value:30},{title:"90 hari terakhir",value:90},{title:"180 hari terakhir",value:180},{title:"1 tahun terakhir",value:365}],$=[{title:"Tanggal Dibuat",value:"created_at"},{title:"Nama",value:"name"},{title:"Kunjungan Terakhir",value:"last_visit"},{title:"Total Kunjungan",value:"total_visits"},{title:"Total Pengeluaran",value:"total_spent"},{title:"Kode Customer",value:"customer_code"}],w=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],D=Z(()=>{let f=0;return n.value.search&&f++,n.value.status&&f++,n.value.gender&&f++,n.value.city&&f++,n.value.loyalty_level&&f++,n.value.recent_days&&f++,n.value.min_visits&&f++,f});let E;const U=()=>{clearTimeout(E),E=setTimeout(()=>{k()},500)},k=()=>{o("update:filters",n.value)},M=()=>{n.value={search:"",status:void 0,gender:void 0,city:"",loyalty_level:void 0,recent_days:void 0,min_visits:void 0,sort_by:"created_at",sort_order:"desc"},m.value=!1,k()};return(f,s)=>(C(),P(A,{class:"mb-6"},{default:t(()=>[e(F,null,{default:t(()=>[e(B,null,{default:t(()=>[e(v,{cols:"12",md:"4"},{default:t(()=>[e(O,{modelValue:n.value.search,"onUpdate:modelValue":[s[0]||(s[0]=a=>n.value.search=a),U],label:"Cari customer...",placeholder:"Nama, email, telepon, atau kode customer","prepend-inner-icon":"tabler-search",clearable:"",variant:"outlined","onClick:clear":s[1]||(s[1]=a=>{n.value.search="",k()})},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"2"},{default:t(()=>[e(q,{modelValue:n.value.status,"onUpdate:modelValue":[s[2]||(s[2]=a=>n.value.status=a),k],label:"Status",items:x,clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"2"},{default:t(()=>[e(q,{modelValue:n.value.gender,"onUpdate:modelValue":[s[3]||(s[3]=a=>n.value.gender=a),k],label:"Jenis Kelamin",items:f.genderOptions,clearable:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),e(v,{cols:"12",md:"2"},{default:t(()=>[e(q,{modelValue:n.value.loyalty_level,"onUpdate:modelValue":[s[4]||(s[4]=a=>n.value.loyalty_level=a),k],label:"Level Loyalitas",items:f.loyaltyLevelOptions,clearable:"",variant:"outlined"},{item:t(({props:a,item:u})=>[e(le,Se(Te(a)),{prepend:t(()=>[e(R,{color:u.raw.color,size:"x-small",class:"me-2"},null,8,["color"])]),_:2},1040)]),_:1},8,["modelValue","items"])]),_:1}),e(v,{cols:"12",md:"2"},{default:t(()=>[e(L,{variant:m.value?"elevated":"outlined",color:m.value?"primary":"default",block:"",onClick:s[5]||(s[5]=a=>m.value=!m.value)},{default:t(()=>[e(I,{icon:m.value?"tabler-filter-minus":"tabler-filter-plus",class:"me-1"},null,8,["icon"]),s[13]||(s[13]=V(" Filter Lanjutan "))]),_:1,__:[13]},8,["variant","color"])]),_:1})]),_:1}),e(Le,null,{default:t(()=>[Pe(r("div",null,[e(be,{class:"my-4"}),e(B,null,{default:t(()=>[e(v,{cols:"12",md:"3"},{default:t(()=>[e(O,{modelValue:n.value.city,"onUpdate:modelValue":[s[6]||(s[6]=a=>n.value.city=a),U],label:"Kota",placeholder:"Filter berdasarkan kota","prepend-inner-icon":"tabler-map-pin",clearable:"",variant:"outlined","onClick:clear":s[7]||(s[7]=a=>{n.value.city="",k()})},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"3"},{default:t(()=>[e(q,{modelValue:n.value.recent_days,"onUpdate:modelValue":[s[8]||(s[8]=a=>n.value.recent_days=a),k],label:"Aktivitas Terakhir",items:b,clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"2"},{default:t(()=>[e(O,{modelValue:n.value.min_visits,"onUpdate:modelValue":[s[9]||(s[9]=a=>n.value.min_visits=a),U],modelModifiers:{number:!0},label:"Min. Kunjungan",type:"number",min:"0",placeholder:"0","prepend-inner-icon":"tabler-user-check",clearable:"",variant:"outlined","onClick:clear":s[10]||(s[10]=a=>{n.value.min_visits=void 0,k()})},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"2"},{default:t(()=>[e(q,{modelValue:n.value.sort_by,"onUpdate:modelValue":[s[11]||(s[11]=a=>n.value.sort_by=a),k],label:"Urutkan",items:$,variant:"outlined"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"2"},{default:t(()=>[e(q,{modelValue:n.value.sort_order,"onUpdate:modelValue":[s[12]||(s[12]=a=>n.value.sort_order=a),k],label:"Urutan",items:w,variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),e(B,{class:"mt-2"},{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[r("div",et,[e(L,{variant:"outlined",color:"secondary","prepend-icon":"tabler-refresh",onClick:M},{default:t(()=>s[14]||(s[14]=[V(" Reset Filter ")])),_:1,__:[14]}),e(xe),D.value>0?(C(),P(R,{key:0,color:"primary",variant:"elevated",size:"small"},{default:t(()=>[V(g(D.value)+" filter aktif ",1)]),_:1})):G("",!0)])]),_:1})]),_:1})],512),[[ze,m.value]])]),_:1})]),_:1})]),_:1}))}}),at={class:"d-flex align-center gap-2"},lt={class:"text-h6"},st={class:"d-flex align-center gap-2"},rt={class:"text-h6"},ot={class:"d-flex align-center gap-2"},nt={class:"text-h6"},it={class:"d-flex align-center gap-2"},ut={class:"text-h6"},dt={class:"d-flex align-center gap-2"},ct={class:"text-h6"},mt={class:"d-flex align-center gap-2"},pt={class:"text-h6"},vt={class:"d-flex align-center gap-2"},gt={class:"text-h6"},ft={class:"d-flex align-center gap-2"},yt={class:"text-h6"},ht=ee({__name:"CustomerStatsCards",props:{stats:{}},setup(z){const d=i=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(i);return(i,o)=>(C(),P(B,{class:"mb-6"},{default:t(()=>[e(v,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(A,{class:"stats-card"},{default:t(()=>[e(F,{class:"d-flex align-center"},{default:t(()=>{var m;return[e(J,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-users"})]),_:1}),r("div",null,[o[0]||(o[0]=r("span",{class:"text-sm text-medium-emphasis"},"Total Customer",-1)),r("div",at,[r("h6",lt,g(((m=i.stats)==null?void 0:m.total_customers)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(v,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(A,{class:"stats-card"},{default:t(()=>[e(F,{class:"d-flex align-center"},{default:t(()=>{var m;return[e(J,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-user-check"})]),_:1}),r("div",null,[o[1]||(o[1]=r("span",{class:"text-sm text-medium-emphasis"},"Customer Aktif",-1)),r("div",st,[r("h6",rt,g(((m=i.stats)==null?void 0:m.active_customers)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(v,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(A,{class:"stats-card"},{default:t(()=>[e(F,{class:"d-flex align-center"},{default:t(()=>{var m;return[e(J,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-currency-dollar"})]),_:1}),r("div",null,[o[2]||(o[2]=r("span",{class:"text-sm text-medium-emphasis"},"Total Pembelian",-1)),r("div",ot,[r("h6",nt,g(d(((m=i.stats)==null?void 0:m.total_spent_all)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(v,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(A,{class:"stats-card"},{default:t(()=>[e(F,{class:"d-flex align-center"},{default:t(()=>{var m;return[e(J,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-user-plus"})]),_:1}),r("div",null,[o[3]||(o[3]=r("span",{class:"text-sm text-medium-emphasis"},"Customer Baru (30 hari)",-1)),r("div",it,[r("h6",ut,g(((m=i.stats)==null?void 0:m.recent_customers)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(v,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(A,{class:"stats-card"},{default:t(()=>[e(F,{class:"d-flex align-center"},{default:t(()=>{var m;return[e(J,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-chart-line"})]),_:1}),r("div",null,[o[4]||(o[4]=r("span",{class:"text-sm text-medium-emphasis"},"Rata-rata Pembelian",-1)),r("div",dt,[r("h6",ct,g(d(((m=i.stats)==null?void 0:m.average_spent_per_customer)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(v,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(A,{class:"stats-card"},{default:t(()=>[e(F,{class:"d-flex align-center"},{default:t(()=>{var m;return[e(J,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-crown"})]),_:1}),r("div",null,[o[5]||(o[5]=r("span",{class:"text-sm text-medium-emphasis"},"Customer Setia",-1)),r("div",mt,[r("h6",pt,g(((m=i.stats)==null?void 0:m.frequent_customers)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(v,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(A,{class:"stats-card"},{default:t(()=>[e(F,{class:"d-flex align-center"},{default:t(()=>{var m;return[e(J,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-calendar-stats"})]),_:1}),r("div",null,[o[6]||(o[6]=r("span",{class:"text-sm text-medium-emphasis"},"Total Kunjungan",-1)),r("div",vt,[r("h6",gt,g(((m=i.stats)==null?void 0:m.total_visits_all)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(v,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(A,{class:"stats-card"},{default:t(()=>[e(F,{class:"d-flex align-center"},{default:t(()=>{var m,n;return[e(J,{size:"44",rounded:"",color:"purple",variant:"tonal",class:"me-3"},{default:t(()=>[e(I,{icon:"tabler-medal"})]),_:1}),r("div",null,[o[7]||(o[7]=r("span",{class:"text-sm text-medium-emphasis"},"Platinum Members",-1)),r("div",ft,[r("h6",yt,g(((n=(m=i.stats)==null?void 0:m.customers_by_loyalty)==null?void 0:n.platinum)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),_t=we(ht,[["__scopeId","data-v-5a375dcf"]]),bt={class:"d-flex align-center justify-space-between"},kt={class:"d-flex align-center gap-2"},Ct={class:"d-flex align-center"},Vt={class:"d-flex flex-column"},wt={class:"font-weight-medium"},xt={class:"text-medium-emphasis"},$t={class:"d-flex flex-column"},Dt={class:"text-medium-emphasis"},Et={key:1,class:"text-medium-emphasis"},St={key:0},Tt={key:1,class:"text-medium-emphasis"},Lt={class:"d-flex align-center"},Pt={class:"font-weight-medium"},zt={class:"text-end"},Ut={class:"font-weight-medium text-success"},Mt={key:0,class:"text-caption"},At={key:1,class:"text-medium-emphasis"},Ft={class:"d-flex align-center gap-1"},Bt={class:"text-center py-8"},It={class:"text-center py-8"},Rt=ee({__name:"CustomerTable",props:{customers:{},loading:{type:Boolean},deleteLoading:{type:Boolean},toggleLoading:{},currentPage:{},totalItems:{},itemsPerPage:{},selectedCustomers:{}},emits:["edit","delete","bulk-delete","toggle-status","view-detail","view-history","view-notes","page-change","items-per-page-change","update:selected-customers"],setup(z,{emit:d}){const i=z,o=d,m=[{title:"Kode",key:"customer_code",sortable:!1,width:120},{title:"Nama",key:"name",sortable:!1,width:200},{title:"Kontak",key:"contact",sortable:!1,width:150},{title:"Gender",key:"gender",sortable:!1,width:100},{title:"Umur",key:"age",sortable:!1,width:80},{title:"Status",key:"active",sortable:!1,width:100},{title:"Customer Status",key:"customer_status",sortable:!1,width:120},{title:"Level",key:"loyalty_level",sortable:!1,width:100},{title:"Kunjungan",key:"total_visits",sortable:!1,width:100},{title:"Total Belanja",key:"total_spent",sortable:!1,width:130},{title:"Terakhir",key:"last_visit",sortable:!1,width:120},{title:"Aksi",key:"actions",sortable:!1,width:150}],n=Z({get:()=>i.selectedCustomers,set:a=>o("update:selected-customers",a)}),x=Z(()=>i.selectedCustomers.length>0),b=a=>{o("page-change",a)},$=a=>{o("items-per-page-change",a)},w=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),D=a=>{const u=new Date(a);return new Intl.DateTimeFormat("id-ID",{day:"2-digit",month:"short",year:"numeric"}).format(u)},E=a=>{switch(a){case"male":return"blue";case"female":return"pink";case"other":return"purple";default:return"grey"}},U=a=>{switch(a){case"male":return"L";case"female":return"P";case"other":return"Lainnya";default:return"-"}},k=a=>{switch(a){case"active":return"success";case"regular":return"info";case"inactive":return"warning";case"dormant":return"error";default:return"grey"}},M=a=>{switch(a){case"active":return"Aktif";case"regular":return"Reguler";case"inactive":return"Tidak Aktif";case"dormant":return"Dorman";default:return"-"}},f=a=>{switch(a){case"platinum":return"purple";case"gold":return"amber";case"silver":return"blue-grey";case"bronze":return"orange";case"basic":return"grey";default:return"grey"}},s=a=>{switch(a){case"platinum":return"Platinum";case"gold":return"Gold";case"silver":return"Silver";case"bronze":return"Bronze";case"basic":return"Basic";default:return"-"}};return(a,u)=>(C(),P(A,null,{default:t(()=>[x.value?(C(),P(F,{key:0,class:"pb-2"},{default:t(()=>[r("div",bt,[r("div",kt,[e(R,{color:"primary",variant:"elevated",size:"small"},{default:t(()=>[V(g(n.value.length)+" dipilih ",1)]),_:1}),e(L,{variant:"outlined",color:"error",size:"small","prepend-icon":"tabler-trash",loading:a.deleteLoading,onClick:u[0]||(u[0]=c=>a.$emit("bulk-delete"))},{default:t(()=>u[3]||(u[3]=[V(" Hapus Terpilih ")])),_:1,__:[3]},8,["loading"])]),e(L,{variant:"text",size:"small",onClick:u[1]||(u[1]=c=>n.value=[])},{default:t(()=>u[4]||(u[4]=[V(" Batal Pilih ")])),_:1,__:[4]})])]),_:1})):G("",!0),e(Je,{modelValue:n.value,"onUpdate:modelValue":u[2]||(u[2]=c=>n.value=c),headers:m,items:a.customers,loading:a.loading,"items-per-page":a.itemsPerPage,page:a.currentPage,"server-items-length":a.totalItems,"show-select":"","item-value":"id_customer",class:"text-no-wrap","onUpdate:page":b,"onUpdate:itemsPerPage":$},{"item.customer_code":t(({item:c})=>[r("div",Ct,[e(R,{color:"primary",variant:"outlined",size:"small",class:"font-weight-medium"},{default:t(()=>[V(g(c.customer_code),1)]),_:2},1024)])]),"item.name":t(({item:c})=>[r("div",Vt,[r("span",wt,g(c.name),1),r("small",xt,g(c.email||"-"),1)])]),"item.contact":t(({item:c})=>[r("div",$t,[r("span",null,g(c.phone||"-"),1),r("small",Dt,g(c.city||"-"),1)])]),"item.gender":t(({item:c})=>[c.gender?(C(),P(R,{key:0,color:E(c.gender),variant:"tonal",size:"small"},{default:t(()=>[V(g(U(c.gender)),1)]),_:2},1032,["color"])):(C(),X("span",Et,"-"))]),"item.age":t(({item:c})=>[c.age?(C(),X("span",St,g(c.age)+" tahun",1)):(C(),X("span",Tt,"-"))]),"item.active":t(({item:c})=>[e(R,{color:c.active?"success":"error",variant:"tonal",size:"small"},{default:t(()=>[V(g(c.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"])]),"item.customer_status":t(({item:c})=>[e(R,{color:k(c.customer_status||""),variant:"tonal",size:"small"},{default:t(()=>[V(g(M(c.customer_status||"")),1)]),_:2},1032,["color"])]),"item.loyalty_level":t(({item:c})=>[e(R,{color:f(c.loyalty_level||""),variant:"elevated",size:"small"},{default:t(()=>[V(g(s(c.loyalty_level||"")),1)]),_:2},1032,["color"])]),"item.total_visits":t(({item:c})=>[r("div",Lt,[e(I,{icon:"tabler-user-check",size:"16",class:"me-1 text-medium-emphasis"}),r("span",Pt,g(c.total_visits),1)])]),"item.total_spent":t(({item:c})=>[r("div",zt,[r("span",Ut,g(w(c.total_spent)),1)])]),"item.last_visit":t(({item:c})=>[c.last_visit?(C(),X("span",Mt,g(D(c.last_visit)),1)):(C(),X("span",At,"Belum pernah"))]),"item.actions":t(({item:c})=>[r("div",Ft,[e(ye,{text:"Toggle Status"},{activator:t(({props:S})=>[e(L,ae(S,{icon:c.active?"tabler-eye-off":"tabler-eye",color:c.active?"warning":"success",variant:"text",size:"small",loading:a.toggleLoading[c.id_customer],onClick:Q=>a.$emit("toggle-status",c)}),null,16,["icon","color","loading","onClick"])]),_:2},1024),e(ye,{text:"Edit Customer"},{activator:t(({props:S})=>[e(L,ae(S,{icon:"tabler-edit",color:"primary",variant:"text",size:"small",onClick:Q=>a.$emit("edit",c)}),null,16,["onClick"])]),_:2},1024),e(ye,{text:"Hapus Customer"},{activator:t(({props:S})=>[e(L,ae(S,{icon:"tabler-trash",color:"error",variant:"text",size:"small",onClick:Q=>a.$emit("delete",c)}),null,16,["onClick"])]),_:2},1024),e(Ge,null,{activator:t(({props:S})=>[e(L,ae(S,{icon:"tabler-dots-vertical",variant:"text",size:"small"}),null,16)]),default:t(()=>[e(Ke,{density:"compact"},{default:t(()=>[e(le,{"prepend-icon":"tabler-eye",title:"Lihat Detail",onClick:S=>a.$emit("view-detail",c)},null,8,["onClick"]),e(le,{"prepend-icon":"tabler-history",title:"Riwayat Transaksi",onClick:S=>a.$emit("view-history",c)},null,8,["onClick"]),e(le,{"prepend-icon":"tabler-notes",title:"Catatan",onClick:S=>a.$emit("view-notes",c)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])]),"no-data":t(()=>[r("div",Bt,[e(I,{icon:"tabler-users-off",size:"48",class:"text-medium-emphasis mb-4"}),u[5]||(u[5]=r("div",{class:"text-h6 text-medium-emphasis mb-2"}," Tidak ada customer ditemukan ",-1)),u[6]||(u[6]=r("div",{class:"text-body-2 text-medium-emphasis"}," Silahkan ubah filter pencarian atau tambah customer baru ",-1))])]),loading:t(()=>[r("div",It,[e(Ue,{indeterminate:"",color:"primary",size:"40"}),u[7]||(u[7]=r("div",{class:"mt-4 text-medium-emphasis"}," Memuat data customer... ",-1))])]),_:1},8,["modelValue","items","loading","items-per-page","page","server-items-length"])]),_:1}))}}),K="/api/customers";class T{static async getAll(d){var i;try{return(await N.get(K,{params:d})).data}catch(o){throw((i=o.response)==null?void 0:i.data)||this.handleError(o)}}static async getById(d){var i;try{return(await N.get(`${K}/${d}`)).data}catch(o){throw((i=o.response)==null?void 0:i.data)||this.handleError(o)}}static async create(d){var i;try{return(await N.post(K,d)).data}catch(o){throw((i=o.response)==null?void 0:i.data)||this.handleError(o)}}static async update(d,i){var o;try{return(await N.put(`${K}/${d}`,i)).data}catch(m){throw((o=m.response)==null?void 0:o.data)||this.handleError(m)}}static async delete(d){var i;try{return(await N.delete(`${K}/${d}`)).data}catch(o){throw((i=o.response)==null?void 0:i.data)||this.handleError(o)}}static async bulkDelete(d){var i;try{return(await N.post(`${K}/bulk-delete`,{ids:d})).data}catch(o){throw((i=o.response)==null?void 0:i.data)||this.handleError(o)}}static async toggleActive(d){var i;try{return(await N.post(`${K}/${d}/toggle-active`)).data}catch(o){throw((i=o.response)==null?void 0:i.data)||this.handleError(o)}}static async getStats(){var d;try{return(await N.get(`${K}/stats`)).data}catch(i){throw((d=i.response)==null?void 0:d.data)||this.handleError(i)}}static async getSearchSuggestions(d){var i;try{return(await N.get(`${K}/search-suggestions`,{params:{q:d}})).data}catch(o){throw((i=o.response)==null?void 0:i.data)||this.handleError(o)}}static handleError(d){var i,o;return d.response?{message:((i=d.response.data)==null?void 0:i.message)||"Terjadi kesalahan pada server",success:!1,errors:(o=d.response.data)==null?void 0:o.errors}:d.request?{message:"Tidak dapat terhubung ke server",success:!1}:{message:d.message||"Terjadi kesalahan yang tidak diketahui",success:!1}}static formatError(d){return d.errors?Object.values(d.errors).flat().join(", "):d.message||"Terjadi kesalahan yang tidak diketahui"}static isValidationError(d){return d.errors&&typeof d.errors=="object"}static getFieldError(d,i){return d.errors&&d.errors[i]?Array.isArray(d.errors[i])?d.errors[i][0]:d.errors[i]:null}}const Ot=()=>{const z=h([]),d=h(!1),i=h(!1),o=h(!1),m=h({}),n=h({total_customers:0,active_customers:0,inactive_customers:0,recent_customers:0,frequent_customers:0,total_spent_all:0,average_spent_per_customer:0,total_visits_all:0,average_visits_per_customer:0,customers_by_loyalty:{platinum:0,gold:0,silver:0,bronze:0,basic:0},customers_by_gender:{male:0,female:0,other:0,unspecified:0},top_cities:[]}),x=h(!1),b=h(!1),$=h(!1),w=h(null),D=h([]),E=h(1),U=h(0),k=h(15),M=h({search:"",status:void 0,gender:void 0,city:"",loyalty_level:void 0,sort_by:"created_at",sort_order:"desc"}),f=h(""),s=h(""),a=h(""),u=h({name:"",email:"",phone:"",birth_date:"",gender:void 0,address:"",city:"",postal_code:"",preferences:{},notes:"",active:!0}),c=Z(()=>D.value.length>0),S=[l=>!!l||"Nama customer wajib diisi",l=>l&&l.length>=2||"Nama minimal 2 karakter"],Q=[l=>!l||/.+@.+\..+/.test(l)||"Email tidak valid"],se=[l=>!l||/^[0-9+\-\s()]+$/.test(l)||"Nomor telepon tidak valid"],re=[{title:"Laki-laki",value:"male"},{title:"Perempuan",value:"female"}],W=[{title:"Basic",value:"basic",color:"grey"},{title:"Bronze",value:"bronze",color:"orange"},{title:"Silver",value:"silver",color:"blue-grey"},{title:"Gold",value:"gold",color:"amber"},{title:"Platinum",value:"platinum",color:"purple"}],j=async()=>{d.value=!0,f.value="";try{const l={...M.value,page:E.value,per_page:k.value};Object.keys(l).forEach(y=>{const Y=l[y];(Y===""||Y===void 0||Y===null)&&delete l[y]});const _=await T.getAll(l);if(_.success)z.value=_.data,U.value=_.total,E.value=_.current_page;else throw new Error(_.message||"Gagal mengambil data customer")}catch(l){console.error("Error fetching customers:",l),f.value=T.formatError(l)||"Gagal mengambil data customer",z.value=[]}finally{d.value=!1}},H=async()=>{try{const l=await T.getStats();l.success&&(n.value=l.data)}catch(l){console.error("Error fetching customer stats:",l)}},oe=async()=>{i.value=!0,a.value="";try{const l=$.value?await T.update(w.value.id_customer,u.value):await T.create(u.value);if(l.success)s.value=$.value?"Customer berhasil diperbarui":"Customer berhasil ditambahkan",te(),await j(),await H();else throw new Error(l.message||"Gagal menyimpan customer")}catch(l){console.error("Error saving customer:",l),a.value=T.formatError(l)||"Gagal menyimpan customer"}finally{i.value=!1}},ne=async()=>{if(w.value){o.value=!0;try{const l=await T.delete(w.value.id_customer);if(l.success)s.value="Customer berhasil dihapus",b.value=!1,w.value=null,await j(),await H();else throw new Error(l.message||"Gagal menghapus customer")}catch(l){console.error("Error deleting customer:",l),f.value=T.formatError(l)||"Gagal menghapus customer"}finally{o.value=!1}}},ie=async()=>{if(D.value.length!==0){o.value=!0;try{const l=await T.bulkDelete(D.value);if(l.success)s.value=`${D.value.length} customer berhasil dihapus`,D.value=[],await j(),await H();else throw new Error(l.message||"Gagal menghapus customer")}catch(l){console.error("Error bulk deleting customers:",l),f.value=T.formatError(l)||"Gagal menghapus customer"}finally{o.value=!1}}},ue=async l=>{const _=l.id_customer;m.value[_]=!0;try{const y=await T.toggleActive(_);if(y.success){const Y=y.data.active?"diaktifkan":"dinonaktifkan";s.value=`Customer berhasil ${Y}`,await j(),await H()}else throw new Error(y.message||"Gagal mengubah status customer")}catch(y){console.error("Error toggling customer status:",y),f.value=T.formatError(y)||"Gagal mengubah status customer"}finally{m.value[_]=!1}},de=async l=>{if(l.length<2)return[];try{const _=await T.getSearchSuggestions(l);return _.success?_.data:[]}catch(_){return console.error("Error fetching customer suggestions:",_),[]}},ce=()=>{$.value=!1,w.value=null,u.value={name:"",email:"",phone:"",birth_date:"",gender:void 0,address:"",city:"",postal_code:"",preferences:{},notes:"",active:!0},a.value="",x.value=!0},me=l=>{$.value=!0,w.value=l,u.value={name:l.name,email:l.email||"",phone:l.phone||"",birth_date:l.birth_date||"",gender:l.gender,address:l.address||"",city:l.city||"",postal_code:l.postal_code||"",preferences:l.preferences||{},notes:l.notes||"",active:l.active},a.value="",x.value=!0},pe=l=>{w.value=l,b.value=!0},te=()=>{x.value=!1,setTimeout(()=>{$.value=!1,w.value=null,a.value=""},300)};return{customersList:z,loading:d,saveLoading:i,deleteLoading:o,toggleLoading:m,stats:n,dialog:x,deleteDialog:b,editMode:$,selectedCustomer:w,selectedCustomers:D,currentPage:E,totalItems:U,itemsPerPage:k,filters:M,errorMessage:f,successMessage:s,modalErrorMessage:a,formData:u,hasSelectedCustomers:c,nameRules:S,emailRules:Q,phoneRules:se,genderOptions:re,loyaltyLevelOptions:W,fetchCustomersList:j,fetchStats:H,saveCustomer:oe,deleteCustomer:ne,bulkDeleteCustomers:ie,toggleActiveStatus:ue,searchSuggestions:de,openCreateDialog:ce,openEditDialog:me,openDeleteDialog:pe,closeDialog:te,clearModalError:()=>{a.value=""},onPageChange:l=>{E.value=l,j()},handleFiltersUpdate:l=>{M.value={...M.value,...l},E.value=1,j()},formatCurrency:l=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),getLoyaltyColor:l=>{const _=W.find(y=>y.value===l);return(_==null?void 0:_.color)||"grey"},getStatusColor:l=>{switch(l){case"active":return"success";case"regular":return"info";case"inactive":return"warning";case"dormant":return"error";default:return"grey"}}}},jt={class:"customer-management"},Nt={class:"d-flex justify-space-between align-center mb-6"},Kt={class:"d-flex gap-3 align-center"},Gt={key:0,class:"d-flex gap-2"},Jt=ee({__name:"customers-management",setup(z){const{customersList:d,loading:i,saveLoading:o,deleteLoading:m,toggleLoading:n,stats:x,dialog:b,deleteDialog:$,editMode:w,selectedCustomer:D,selectedCustomers:E,currentPage:U,totalItems:k,itemsPerPage:M,filters:f,errorMessage:s,successMessage:a,modalErrorMessage:u,formData:c,hasSelectedCustomers:S,nameRules:Q,emailRules:se,phoneRules:re,genderOptions:W,loyaltyLevelOptions:j,fetchCustomersList:H,fetchStats:oe,saveCustomer:ne,deleteCustomer:ie,bulkDeleteCustomers:ue,toggleActiveStatus:de,openCreateDialog:ce,openEditDialog:me,openDeleteDialog:pe,closeDialog:te,clearModalError:ke,onPageChange:Ce,handleFiltersUpdate:ve}=Ot(),Ve=async()=>{await ie()},ge=async()=>{await ue()};return Me(()=>{H(),oe()}),($e,l)=>{var _;return C(),X("div",jt,[r("div",Nt,[l[10]||(l[10]=r("div",null,[r("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Customer"),r("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola data pelanggan dan riwayat transaksi")],-1)),r("div",Kt,[p(S)?(C(),X("div",Gt,[e(R,{color:"primary",size:"small"},{default:t(()=>[V(g(p(E).length)+" dipilih ",1)]),_:1}),e(L,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:ge},{default:t(()=>l[8]||(l[8]=[V(" Hapus Terpilih ")])),_:1,__:[8]})])):G("",!0),e(L,{color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:p(ce)},{default:t(()=>l[9]||(l[9]=[V(" Tambah Customer ")])),_:1,__:[9]},8,["onClick"])])]),p(s)?(C(),P(_e,{key:0,type:"error",variant:"outlined",class:"mb-4",text:p(s),closable:"","onClick:close":l[0]||(l[0]=y=>s.value="")},null,8,["text"])):G("",!0),p(a)?(C(),P(_e,{key:1,type:"success",variant:"outlined",class:"mb-4",text:p(a),closable:"","onClick:close":l[1]||(l[1]=y=>a.value="")},null,8,["text"])):G("",!0),e(_t,{stats:p(x)},null,8,["stats"]),e(tt,{filters:p(f),"gender-options":p(W),"loyalty-level-options":p(j),"onUpdate:filters":p(ve)},null,8,["filters","gender-options","loyalty-level-options","onUpdate:filters"]),e(Rt,{customers:p(d),loading:p(i),"delete-loading":p(m),"toggle-loading":p(n),"current-page":p(U),"total-items":p(k),"items-per-page":p(M),"selected-customers":p(E),onEdit:p(me),onDelete:p(pe),onBulkDelete:ge,onToggleStatus:p(de),onPageChange:p(Ce),onItemsPerPageChange:l[2]||(l[2]=y=>p(ve)({per_page:y})),"onUpdate:selectedCustomers":l[3]||(l[3]=y=>E.value=y)},null,8,["customers","loading","delete-loading","toggle-loading","current-page","total-items","items-per-page","selected-customers","onEdit","onDelete","onToggleStatus","onPageChange"]),e(Ze,{dialog:p(b),"edit-mode":p(w),"selected-customer":p(D),"form-data":p(c),"save-loading":p(o),"modal-error-message":p(u),"name-rules":p(Q),"email-rules":p(se),"phone-rules":p(re),"gender-options":p(W),"onUpdate:dialog":l[4]||(l[4]=y=>b.value=y),"onUpdate:formData":l[5]||(l[5]=y=>Object.assign(p(c),y)),onSave:p(ne),onClose:p(te),onClearModalError:p(ke)},null,8,["dialog","edit-mode","selected-customer","form-data","save-loading","modal-error-message","name-rules","email-rules","phone-rules","gender-options","onSave","onClose","onClearModalError"]),e(De,{modelValue:p($),"onUpdate:modelValue":l[6]||(l[6]=y=>Ae($)?$.value=y:null),title:"Konfirmasi Hapus Customer","item-name":(_=p(D))==null?void 0:_.name,loading:p(m),"confirm-text":"Hapus Customer",onConfirm:Ve,onCancel:l[7]||(l[7]=y=>$.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),ba=we(Jt,[["__scopeId","data-v-2dfb2244"]]);export{ba as default};
