import{au as a,a5 as L}from"./main-DExI6XPI.js";const n="/api/pos";class T{static async getStats(){var t;try{return(await a.get(`${n}/stats`)).data}catch(r){throw((t=r.response)==null?void 0:t.data)||this.handleError(r)}}static async getProducts(t){var r;try{return(await a.get(`${n}/products`,{params:t})).data}catch(e){throw((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async getActiveOrders(t){var r;try{return(await a.get(`${n}/orders`,{params:t})).data}catch(e){throw((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async createOrder(t){var r;try{return(await a.post(`${n}/orders`,t)).data}catch(e){throw((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async getOrder(t){var r;try{return(await a.get(`${n}/orders/${t}`)).data}catch(e){throw((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async updateOrderStatus(t,r){var e;try{return(await a.put(`${n}/orders/${t}/status`,r)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static async editOrder(t,r){var e;try{return(await a.put(`${n}/orders/${t}`,r)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static async cancelOrder(t){var r;try{return(await a.post(`${n}/orders/${t}/cancel`)).data}catch(e){throw((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async addItem(t,r){var e;try{return(await a.post(`${n}/orders/${t}/items`,r)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static async updateItem(t,r,e){var s;try{return(await a.put(`${n}/orders/${t}/items/${r}`,e)).data}catch(c){throw((s=c.response)==null?void 0:s.data)||this.handleError(c)}}static async removeItem(t,r){var e;try{return(await a.delete(`${n}/orders/${t}/items/${r}`)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static async applyDiscount(t,r){var e;try{return(await a.post(`${n}/orders/${t}/discount`,r)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static async applyTax(t,r){var e;try{return(await a.post(`${n}/orders/${t}/tax`,r)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static async processPayment(t,r){var e;try{return(await a.post(`${n}/orders/${t}/payment`,r)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static formatError(t){return t.errors?Object.values(t.errors).flat().join(", "):t.message||"An unexpected error occurred"}static async getOrders(t){var r;try{return(await a.get(`${n}/orders/history`,{params:t})).data}catch(e){throw((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async getCategories(){var t;try{return(await a.get(`${n}/orders/categories`)).data}catch(r){throw((t=r.response)==null?void 0:t.data)||this.handleError(r)}}static async getAllOrdersForExport(t){var r;try{const e={per_page:"all",page:1};return t!=null&&t.search&&(e.search=t.search),t!=null&&t.status&&(e.status=t.status),t!=null&&t.category_id&&(e.category_id=t.category_id),t!=null&&t.payment_status&&(e.payment_status=t.payment_status),e.date_from=(t==null?void 0:t.start_date)||"",e.date_to=(t==null?void 0:t.end_date)||"",console.log("ðŸ” Export API parameters sent to backend:",e),console.log("ðŸ” Original params received:",t),(await a.get(`${n}/orders/history`,{params:e})).data.data||[]}catch(e){throw console.error("Get all orders error:",e),((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async exportOrdersToExcel(t){var r;try{console.log("ðŸš€ Starting POS export to Excel...");const e=await this.getAllOrdersForExport(t);console.log("ðŸ“Š Exporting",e.length,"orders to Excel");const s=await L(()=>import("./xlsx-CfQreh1U.js"),[]),c=e.length,d=e.reduce((o,y)=>o+(parseFloat(y.total_amount)||0),0),l=e.filter(o=>o.payment_status==="paid").length,h=e.filter(o=>o.payment_status==="unpaid"||o.payment_status==="pending").length,D=e.map((o,y)=>{var w,_,$,E,f,x,O,A;return{No:y+1,"ID Order":o.id,Tanggal:o.created_at?new Date(o.created_at).toLocaleDateString("id-ID"):"-",Waktu:o.created_at?new Date(o.created_at).toLocaleTimeString("id-ID"):"-",Customer:((w=o.customer)==null?void 0:w.name)||"Walk-in Customer",Kategori:((f=(E=($=(_=o.order_items)==null?void 0:_[0])==null?void 0:$.product)==null?void 0:E.category)==null?void 0:f.name)||"-","Total Amount":parseFloat(o.total_amount)||0,"Status Pembayaran":o.payment_status==="paid"?"Lunas":o.payment_status==="pending"?"Pending":"Belum Lunas","Metode Pembayaran":((O=(x=o.payments)==null?void 0:x[0])==null?void 0:O.payment_method)||"-","Jumlah Item":((A=o.order_items)==null?void 0:A.length)||0,Catatan:o.notes||"-"}}),g=s.utils.book_new(),i=[];if(t!=null&&t.search&&i.push(`Pencarian: "${t.search}"`),t!=null&&t.category_id&&i.push(`Kategori: ID ${t.category_id}`),t!=null&&t.payment_status&&t.payment_status!=="all"){const o={paid:"Lunas",unpaid:"Belum Lunas",pending:"Pending"};i.push(`Status Pembayaran: ${o[t.payment_status]||t.payment_status}`)}if(t!=null&&t.start_date||t!=null&&t.end_date){const o=[];t.start_date&&o.push(`Dari: ${t.start_date}`),t.end_date&&o.push(`Sampai: ${t.end_date}`),i.push(`Periode: ${o.join(" ")}`)}const S=[["LAPORAN RIWAYAT TRANSAKSI POS"],["Tanggal Export:",new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})],["Total Transaksi:",c],["Total Amount:",`Rp ${d.toLocaleString("id-ID")}`],["Transaksi Lunas:",l],["Transaksi Belum Lunas:",h],["Filter Diterapkan:",i.length>0?i.join(", "):"Semua Data"],[]],u=s.utils.aoa_to_sheet(S);s.utils.sheet_add_json(u,D,{origin:"A9"});const k=[{wch:5},{wch:10},{wch:12},{wch:10},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:10},{wch:20}];u["!cols"]=k,s.utils.book_append_sheet(g,u,"Transaction History");const p=`pos-riwayat-transaksi-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.xlsx`;return s.writeFile(g,p),console.log("âœ… Excel file generated successfully:",p),{success:!0,filename:p,totalRecords:c,totalAmount:d}}catch(e){throw console.error("Export to Excel error:",e),((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async exportOrders(t){var r;try{const e=await a.get(`${n}/orders/export`,{params:t,responseType:"blob"}),s=window.URL.createObjectURL(new Blob([e.data])),c=document.createElement("a");c.href=s;const d=e.headers["content-disposition"];let l="riwayat-transaksi.xlsx";if(d){const h=d.match(/filename="?(.+)"?/);h&&(l=h[1])}c.setAttribute("download",l),document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(s)}catch(e){throw console.error("Export error:",e),((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static handleError(t){var r,e;return t.response?{success:!1,message:((r=t.response.data)==null?void 0:r.message)||"Server error occurred",errors:(e=t.response.data)==null?void 0:e.errors}:t.request?{success:!1,message:"Network error occurred"}:{success:!1,message:t.message||"An unexpected error occurred"}}}export{T as P};
