import{D as St}from"./DeleteConfirmationDialog-i7Tj5gEx.js";import{f as He}from"./formatters-BD6tdLx_.js";import{P as rt,u as Mt}from"./useProductItems-CxAT7Bri.js";import{I as Kt}from"./ItemsApi-CFgaLZqU.js";import{u as _t,H as Bt}from"./HPPBreakdownDialog-1EHfPIr1.js";import{V as Le}from"./VDialog-CdekGksh.js";import{V as Y,b as xe,c as Fe}from"./VCard-Bs34JTtf.js";import{a5 as Ft,a6 as Et,ac as Rt,r as T,aF as lt,ad as qt,aL as wt,bi as Lt,V as pe,W as Nt,w as Ve,bt as Pt,b8 as ft,a7 as Ot,b as e,p as we,bd as jt,cv as Jt,c8 as Vt,bg as Wt,F as ze,X as h,cm as Gt,c9 as Qt,aH as Xt,s as d,d as Ee,D as tt,c as Z,f as t,e as a,t as r,a0 as q,g as R,l as N,m as E,at as dt,i as We,v as Ge,o as f,au as gt,$ as kt,j as It,cw as Zt,aP as Yt,av as qe,am as ea,an as ta,a2 as mt}from"./main-rVPG9Y6J.js";import{V as le}from"./VCardText-DJW1xTS-.js";import{V as Se}from"./VAvatar-BVBQNpw8.js";import{V as ue}from"./VChip-Bt_GlyLI.js";import{V as Pe,a as S}from"./VRow-BEep8PwE.js";import{V as bt}from"./VAutocomplete-DBRMkarj.js";import{e as aa,t as ot,V as ct,a as Je,b as Ye,d as st}from"./VList-Drzc57wc.js";import{u as la,V as he,m as oa}from"./VTextField-DkymYSlP.js";import{V as Ze}from"./VSwitch-CDOPcg83.js";import{a as ut,V as Ke}from"./VAlert-BMDaXJnE.js";import{V as Ne}from"./VSpacer-DRMvaBGf.js";import{V as et}from"./VSnackbar-DkW8pSxx.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as sa,m as ia,a as na,V as Be}from"./VSelect-DmCwjhzr.js";import{V as ra}from"./VCheckbox-BZEwMLDQ.js";import{V as Ue}from"./VDivider-Dxc7vRmj.js";import{V as ua}from"./VContainer-CFJcxLHp.js";import{a as Dt,u as da,P as ca}from"./useProducts-CkdeXayW.js";import{V as yt}from"./VForm-BKtwFqFI.js";import{V as Ct}from"./VTextarea-DG1Ot0jy.js";import{V as Me}from"./VTooltip-Crrh-Y5v.js";import{m as ma,V as va}from"./VImg-8Im_NfCd.js";import{V as pa,u as fa}from"./useCategories-D05pEtNc.js";import{u as ga,m as _a,h as ka}from"./filter-CEUmxeVE.js";import{f as ba}from"./forwardRefs-B931MWyl.js";import{V as ya}from"./VMenu-C58AjvM4.js";import{V as ha}from"./VCheckboxBtn-Cy2-XX9Y.js";import{V as xa}from"./VDataTableServer-6KfcGi5t.js";import{V as wa}from"./VSkeletonLoader-DZjTsmil.js";import{V as Pa}from"./VDataTable-D3LrxtG9.js";import{V as Va,a as Ca,b as vt,c as pt}from"./VTabs-BoZZviS-.js";import"./ProductsApi-Cm5aJOIi.js";import"./api-B5z_137W.js";import"./index-D-EbNoF1.js";import"./VOverlay-VeTeSJLZ.js";/* empty css              */import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-CY1AYXgm.js";import"./VTable-xQIHGJhl.js";const $a=Et({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,..._a({filterKeys:["title"]}),...ia({hideNoData:!0,returnObject:!0}),...jt(oa({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...ma({transition:!1})},"VCombobox"),Sa=Ft()({name:"VCombobox",props:$a(),emits:{"update:focused":I=>!0,"update:modelValue":I=>!0,"update:search":I=>!0,"update:menu":I=>!0},setup(I,be){var n;let{emit:K,slots:M}=be;const{t:j}=Rt(),b=T(),W=lt(!1),A=lt(!0),g=lt(!1),_=T(),ee=T(),y=lt(-1);let X=!1;const{items:me,transformIn:fe,transformOut:$}=aa(I),{textColorClasses:de,textColorStyles:ce}=qt(()=>{var o;return(o=b.value)==null?void 0:o.color}),O=wt(I,"modelValue",[],o=>fe(Lt(o)),o=>{const V=$(o);return I.multiple?V:V[0]??null}),ie=la(I),w=pe(()=>!!(I.chips||M.chip)),c=pe(()=>w.value||!!M.selection),x=lt(!I.multiple&&!c.value?((n=O.value[0])==null?void 0:n.title)??"":""),v=pe({get:()=>x.value,set:o=>{var V;if(x.value=o??"",!I.multiple&&!c.value&&(O.value=[ot(I,o)]),o&&I.multiple&&((V=I.delimiters)!=null&&V.length)){const B=o.split(new RegExp(`(?:${I.delimiters.join("|")})+`));B.length>1&&(B.forEach(F=>{F=F.trim(),F&&Ae(ot(I,F))}),x.value="")}o||(y.value=-1),A.value=!o}}),k=pe(()=>typeof I.counterValue=="function"?I.counterValue(O.value):typeof I.counterValue=="number"?I.counterValue:I.multiple?O.value.length:v.value.length),{filteredItems:s,getMatches:p}=ga(I,me,()=>A.value?"":v.value),U=pe(()=>I.hideSelected?s.value.filter(o=>!O.value.some(V=>V.value===o.value)):s.value),ae=pe(()=>I.hideNoData&&!U.value.length||ie.isReadonly.value||ie.isDisabled.value),oe=wt(I,"menu"),te=pe({get:()=>oe.value,set:o=>{var V;oe.value&&!o&&((V=_.value)!=null&&V.ΨopenChildren.size)||o&&ae.value||(oe.value=o)}}),L=Nt(()=>te.value?I.closeText:I.openText);Ve(x,o=>{X?ft(()=>X=!1):W.value&&!te.value&&(te.value=!0),K("update:search",o)}),Ve(O,o=>{var V;!I.multiple&&!c.value&&(x.value=((V=o[0])==null?void 0:V.title)??"")});const D=pe(()=>O.value.map(o=>o.value)),m=pe(()=>{var V;return(I.autoSelectFirst===!0||I.autoSelectFirst==="exact"&&v.value===((V=U.value[0])==null?void 0:V.title))&&U.value.length>0&&!A.value&&!g.value}),l=T(),i=sa(l,b);function P(o){X=!0,I.openOnClear&&(te.value=!0)}function ge(){ae.value||(te.value=!0)}function J(o){ae.value||(W.value&&(o.preventDefault(),o.stopPropagation()),te.value=!te.value)}function ke(o){var V;o.key!==" "&&Vt(o)&&((V=b.value)==null||V.focus())}function De(o){var F,u,H,G;if(Jt(o)||ie.isReadonly.value)return;const V=(F=b.value)==null?void 0:F.selectionStart,B=O.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(o.key)&&o.preventDefault(),["Enter","ArrowDown"].includes(o.key)&&(te.value=!0),["Escape"].includes(o.key)&&(te.value=!1),["Enter","Escape","Tab"].includes(o.key)&&(m.value&&["Enter","Tab"].includes(o.key)&&!O.value.some(C=>{let{value:ve}=C;return ve===U.value[0].value})&&Ae(s.value[0]),A.value=!0),o.key==="ArrowDown"&&m.value&&((u=l.value)==null||u.focus("next")),o.key==="Enter"&&v.value&&(Ae(ot(I,v.value)),c.value&&(x.value="")),["Backspace","Delete"].includes(o.key)){if(!I.multiple&&c.value&&O.value.length>0&&!v.value)return Ae(O.value[0],!1);if(~y.value){o.preventDefault();const C=y.value;Ae(O.value[y.value],!1),y.value=C>=B-1?B-2:C}else o.key==="Backspace"&&!v.value&&(y.value=B-1);return}if(I.multiple)if(o.key==="ArrowLeft"){if(y.value<0&&V&&V>0)return;const C=y.value>-1?y.value-1:B-1;O.value[C]?y.value=C:(y.value=-1,(H=b.value)==null||H.setSelectionRange(v.value.length,v.value.length))}else if(o.key==="ArrowRight"){if(y.value<0)return;const C=y.value+1;O.value[C]?y.value=C:(y.value=-1,(G=b.value)==null||G.setSelectionRange(0,0))}else~y.value&&Vt(o)&&(y.value=-1)}function se(){var o;I.eager&&((o=ee.value)==null||o.calculateVisibleItems())}function Te(){var o;W.value&&(A.value=!0,(o=b.value)==null||o.focus())}function Ae(o){let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!o||o.props.disabled))if(I.multiple){const B=O.value.findIndex(u=>(I.valueComparator||Pt)(u.value,o.value)),F=V??!~B;if(~B){const u=F?[...O.value,o]:[...O.value];u.splice(B,1),O.value=u}else F&&(O.value=[...O.value,o]);I.clearOnSelect&&(v.value="")}else{const B=V!==!1;O.value=B?[o]:[],x.value=B&&!c.value?o.title:"",ft(()=>{te.value=!1,A.value=!0})}}function Qe(o){W.value=!0,setTimeout(()=>{g.value=!0})}function je(o){g.value=!1}function z(o){(o==null||o===""&&!I.multiple&&!c.value)&&(O.value=[])}return Ve(W,(o,V)=>{if(!(o||o===V)&&(y.value=-1,te.value=!1,v.value)){if(I.multiple){Ae(ot(I,v.value));return}if(!c.value)return;O.value.some(B=>{let{title:F}=B;return F===v.value})?x.value="":Ae(ot(I,v.value))}}),Ve(te,()=>{if(!I.hideSelected&&te.value&&O.value.length){const o=U.value.findIndex(V=>O.value.some(B=>(I.valueComparator||Pt)(B.value,V.value)));Wt&&window.requestAnimationFrame(()=>{var V;o>=0&&((V=ee.value)==null||V.scrollToIndex(o))})}}),Ve(()=>I.items,(o,V)=>{te.value||W.value&&!V.length&&o.length&&(te.value=!0)}),Ot(()=>{const o=!!(!I.hideNoData||U.value.length||M["prepend-item"]||M["append-item"]||M["no-data"]),V=O.value.length>0,B=he.filterProps(I);return e(he,we({ref:b},B,{modelValue:v.value,"onUpdate:modelValue":[F=>v.value=F,z],focused:W.value,"onUpdate:focused":F=>W.value=F,validationValue:O.externalValue,counterValue:k.value,dirty:V,class:["v-combobox",{"v-combobox--active-menu":te.value,"v-combobox--chips":!!I.chips,"v-combobox--selection-slot":!!c.value,"v-combobox--selecting-index":y.value>-1,[`v-combobox--${I.multiple?"multiple":"single"}`]:!0},I.class],style:I.style,readonly:ie.isReadonly.value,placeholder:V?void 0:I.placeholder,"onClick:clear":P,"onMousedown:control":ge,onKeydown:De}),{...M,default:()=>e(ze,null,[e(ya,we({ref:_,modelValue:te.value,"onUpdate:modelValue":F=>te.value=F,activator:"parent",contentClass:"v-combobox__content",disabled:ae.value,eager:I.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:I.transition,onAfterEnter:se,onAfterLeave:Te},I.menuProps),{default:()=>[o&&e(ct,we({ref:l,selected:D.value,selectStrategy:I.multiple?"independent":"single-independent",onMousedown:F=>F.preventDefault(),onKeydown:ke,onFocusin:Qe,onFocusout:je,tabindex:"-1","aria-live":"polite",color:I.itemColor??I.color},i,I.listProps),{default:()=>{var F,u,H;return[(F=M["prepend-item"])==null?void 0:F.call(M),!U.value.length&&!I.hideNoData&&(((u=M["no-data"])==null?void 0:u.call(M))??e(Je,{key:"no-data",title:j(I.noDataText)},null)),e(na,{ref:ee,renderless:!0,items:U.value,itemKey:"value"},{default:G=>{var Ce;let{item:C,index:ve,itemRef:re}=G;const ne=we(C.props,{ref:re,key:C.value,active:m.value&&ve===0?!0:void 0,onClick:()=>Ae(C,null)});return((Ce=M.item)==null?void 0:Ce.call(M,{item:C,index:ve,props:ne}))??e(Je,we(ne,{role:"option"}),{prepend:ye=>{let{isSelected:Ie}=ye;return e(ze,null,[I.multiple&&!I.hideSelected?e(ha,{key:C.value,modelValue:Ie,ripple:!1,tabindex:"-1"},null):void 0,C.props.prependAvatar&&e(Se,{image:C.props.prependAvatar},null),C.props.prependIcon&&e(h,{icon:C.props.prependIcon},null)])},title:()=>{var ye;return A.value?C.title:ka("v-combobox",C.title,(ye=p(C))==null?void 0:ye.title)}})}}),(H=M["append-item"])==null?void 0:H.call(M)]}})]}),O.value.map((F,u)=>{function H(re){re.stopPropagation(),re.preventDefault(),Ae(F,!1)}const G={"onClick:close":H,onKeydown(re){re.key!=="Enter"&&re.key!==" "||(re.preventDefault(),re.stopPropagation(),H(re))},onMousedown(re){re.preventDefault(),re.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},C=w.value?!!M.chip:!!M.selection,ve=C?Qt(w.value?M.chip({item:F,index:u,props:G}):M.selection({item:F,index:u})):void 0;if(!(C&&!ve))return e("div",{key:F.value,class:["v-combobox__selection",u===y.value&&["v-combobox__selection--selected",de.value]],style:u===y.value?ce.value:{}},[w.value?M.chip?e(Xt,{key:"chip-defaults",defaults:{VChip:{closable:I.closableChips,size:"small",text:F.title}}},{default:()=>[ve]}):e(ue,we({key:"chip",closable:I.closableChips,size:"small",text:F.title,disabled:F.props.disabled},G),null):ve??e("span",{class:"v-combobox__selection-text"},[F.title,I.multiple&&u<O.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[d(",")])])])})]),"append-inner":function(){var G,C;for(var F=arguments.length,u=new Array(F),H=0;H<F;H++)u[H]=arguments[H];return e(ze,null,[(G=M["append-inner"])==null?void 0:G.call(M,...u),(!I.hideNoData||I.items.length)&&I.menuIcon?e(h,{class:"v-combobox__menu-icon",color:(C=b.value)==null?void 0:C.fieldIconColor,icon:I.menuIcon,onMousedown:J,onClick:Gt,"aria-label":j(L.value),title:j(L.value),tabindex:"-1"},null):void 0])}})}),ba({isFocused:W,isPristine:A,menu:te,search:v,selectionIndex:y,filteredItems:s,select:Ae},b)}}),Ia={class:"d-flex align-center gap-3"},Da={class:"text-body-2 ma-0 opacity-90"},za={class:"d-flex align-center gap-4"},Ua={class:"flex-grow-1"},Ta={class:"text-h6 font-weight-bold mb-1"},Aa={class:"text-body-2 text-medium-emphasis mb-1"},Ha={class:"d-flex align-center gap-4 mb-0"},Ma={class:"text-body-2 text-medium-emphasis mb-0"},Ka={class:"text-body-2 text-info mb-0 font-weight-medium"},Ba={key:0,class:"text-body-2 text-success mb-0 font-weight-medium"},Fa={class:"text-body-1 font-weight-bold"},Ea={class:"text-body-1 font-weight-bold"},Ra={class:"text-body-1 font-weight-bold"},qa={class:"text-body-1 font-weight-bold"},La={class:"d-flex align-center justify-space-between w-100"},Na={class:"d-flex align-center"},Oa={key:0,class:"text-warning"},ja={key:1},Ja={key:0,class:"text-center pa-8"},Wa={class:"d-flex align-center gap-4 mt-1"},Ga={key:1,class:"text-primary"},Qa={class:"d-flex gap-2"},Xa=Ee({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup(I,{emit:be}){const K=I,M=be,j=pe({get:()=>K.modelValue,set:z=>M("update:modelValue",z)}),b=T(!1),W=T([]),A=T(!1),g=T(!1),_=T(""),ee=T(""),y=T(!1),X=T(-1),me=T(!1),{loading:fe,currentHPPBreakdown:$,getProductHPPBreakdown:de}=_t(),ce=pe(()=>{var z,n,o;return((z=$.value)==null?void 0:z.total_hpp)||((n=K.product)==null?void 0:n.hpp)||((o=K.product)==null?void 0:o.cost)||0}),O=pe(()=>{var o;const z=((o=K.product)==null?void 0:o.price)||0,n=ce.value;return z-n}),ie=pe(()=>{var o;const z=((o=K.product)==null?void 0:o.price)||0,n=ce.value;return z<=0?0:Math.round((z-n)/z*100)}),w=T({itemId:null,quantity:1,isCritical:!1}),c=T([]),x=T(!1),v=T([]),k=async()=>{var z;if(K.product)try{const n=K.product.id_product||K.product.id,o=await rt.getAll({product_id:n,page:1,per_page:1e5});o.success&&((z=o.data)!=null&&z.data)&&(W.value=o.data.data,v.value=JSON.parse(JSON.stringify(o.data.data)))}catch(n){console.error("Error fetching product composition:",n)}},s=async()=>{var z;x.value=!0;try{const n=await Kt.getAll({page:1,per_page:1e5,active:!0});n.success&&((z=n.data)!=null&&z.data)&&(c.value=n.data.data.map(o=>{var V,B,F;return{id:((V=o.id_item)==null?void 0:V.toString())||((B=o.id)==null?void 0:B.toString()),name:o.name,current_stock:((F=o.inventory)==null?void 0:F.current_stock)||0,unit:o.unit||"pcs"}}))}catch(n){console.error("Error fetching available items:",n),c.value=[]}finally{x.value=!1}},p=pe(()=>w.value.itemId&&w.value.quantity>0);pe(()=>{if(!w.value.itemId)return null;const z=c.value.find(n=>n.id===w.value.itemId);return(z==null?void 0:z.unit)||null});const U=pe(()=>{if(!w.value.itemId)return null;const z=c.value.find(n=>n.id===w.value.itemId);return z?te(z):null}),ae=pe(()=>U.value!==null&&U.value<=0),oe=pe(()=>Array.isArray(c.value)?c.value:[]),te=z=>z.current_stock||z.stock||0,L=()=>x.value?"Memuat items...":!c.value||c.value.length===0?"Tidak ada item tersedia":"Tidak ada item yang ditemukan",D=z=>{const n=te(z);return n>50?"success":n>20?"warning":n>0?"error":"grey"},m=z=>{const n=te(z);return n>50?"Aman":n>20?"Rendah":n>0?"Kritis":"Habis"};Ve(()=>K.items,z=>{z&&z.length>0,W.value=[...z]},{immediate:!0}),Ve(()=>K.modelValue,async z=>{z&&K.product&&(k(),await l())});const l=async()=>{if(K.product&&(K.product.id_product||K.product.id))try{const z=parseInt(String(K.product.id_product||K.product.id));await de(z,"latest")}catch(z){console.warn("Could not load HPP data:",z)}};tt(()=>{s()});const i=()=>{me.value=!0},P=async()=>{await l(),M("refresh")},ge=()=>W.value.some(n=>{var o;return((o=n.item)==null?void 0:o.inventory)&&n.item.inventory.current_stock<n.quantity_needed})?"error":"success",J=()=>W.value.some(n=>{var o;return((o=n.item)==null?void 0:o.inventory)&&n.item.inventory.current_stock<n.quantity_needed})?"Stok Kritis":"Stok Aman",ke=()=>{if(!p.value)return;const z=c.value.find(V=>V.id===w.value.itemId);if(!z)return;if(W.value.find(V=>{var B;return((B=V.item)==null?void 0:B.id)===z.id})){_.value=`Item "${z.name}" sudah ada dalam komposisi produk ini`,A.value=!0;return}const o={id_product_item:`temp_${Date.now()}`,item:{id:String(z.id),name:z.name,inventory:{current_stock:z.current_stock||0}},quantity_needed:w.value.quantity,unit:w.value.unit,is_critical:w.value.isCritical};W.value.push(o),Te()},De=(z,n)=>{var B;if(c.value.length===0){console.warn("⚠️ Available items not loaded yet, fetching..."),s().then(()=>{De(z,n)});return}y.value=!0,X.value=n;let o=((B=z.item)==null?void 0:B.id)||null;if(o!==null&&(o=o.toString()),w.value={itemId:o,quantity:parseFloat(z.quantity_needed.toString())||0,unit:z.unit,isCritical:z.is_critical},!c.value.find(F=>F.id===o)){console.warn("⚠️ Item ID not found in available items, trying alternative matching...");const F=c.value.find(u=>{var H;return u.name===((H=z.item)==null?void 0:H.name)});F?w.value.itemId=F.id:console.error("❌ Could not find item in available items by ID or name")}},se=()=>{if(!p.value||X.value===-1)return;const z=c.value.find(n=>n.id===w.value.itemId);z&&(W.value[X.value]={...W.value[X.value],item:{id:String(z.id),name:z.name,inventory:{current_stock:z.current_stock||0}},quantity_needed:w.value.quantity,unit:w.value.unit,is_critical:w.value.isCritical},Te())},Te=()=>{y.value=!1,X.value=-1,w.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},Ae=z=>{W.value.splice(z,1)},Qe=async()=>{var z,n,o,V,B,F,u,H,G;if(K.product){b.value=!0;try{const C=parseInt(String(((z=K.product)==null?void 0:z.id_product)||((n=K.product)==null?void 0:n.id)||"0")),ve=v.value||[],re=W.value;for(const ne of re){const Ce=ve.find(Ie=>{var Re,Xe;return!!(Ie.id_product_item===ne.id_product_item||ne.id_product_item&&!ne.id_product_item.toString().startsWith("temp_")&&((Re=Ie.item)==null?void 0:Re.id)===((Xe=ne.item)==null?void 0:Xe.id))});if(!((o=ne.item)!=null&&o.id)||parseInt(ne.item.id)===0){console.warn("⚠️ Skipping item with invalid item_id:",{item_name:(V=ne.item)==null?void 0:V.name,item_id:(B=ne.item)==null?void 0:B.id,full_item:ne});continue}const ye={product_id:C,item_id:parseInt(((F=ne.item)==null?void 0:F.id)||"0"),quantity_needed:parseFloat(ne.quantity_needed.toString()),is_critical:ne.is_critical,notes:ne.notes||""};try{Ce&&!((u=ne.id_product_item)!=null&&u.toString().startsWith("temp_"))?await rt.update(parseInt(Ce.id_product_item||"0"),ye):await rt.create(ye)}catch(Ie){throw console.error("❌ Error processing item:",Ie),(H=Ie.message)!=null&&H.includes("already assigned")?_.value=`Item "${(G=ne.item)==null?void 0:G.name}" sudah ditambahkan ke produk ini`:_.value=Ie.message||"Terjadi kesalahan saat menyimpan item",A.value=!0,Ie}}for(const ne of ve)if(!re.find(ye=>ye.id_product_item===ne.id_product_item)&&ne.id_product_item)try{await rt.delete(parseInt(ne.id_product_item))}catch(ye){console.error("❌ Error deleting item:",ye),_.value=`Gagal menghapus item: ${ye.message}`,A.value=!0}ee.value="Komposisi produk berhasil disimpan!",g.value=!0,M("save",{product:K.product,items:W.value}),M("refresh"),je()}catch(C){console.error("❌ Error saving composition:",C),A.value||(_.value=C.message||"Terjadi kesalahan saat menyimpan komposisi",A.value=!0)}finally{b.value=!1}}},je=()=>{j.value=!1,setTimeout(()=>{W.value=[...K.items],Te()},300)};return(z,n)=>{var o,V,B,F;return f(),Z(ze,null,[e(Le,{modelValue:j.value,"onUpdate:modelValue":n[8]||(n[8]=u=>j.value=u),"max-width":"900",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var u;return[a("div",Ia,[e(h,{icon:"mdi-chef-hat",size:"24"}),a("div",null,[n[11]||(n[11]=a("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),a("p",Da,r(((u=z.product)==null?void 0:u.name)||"Produk"),1)])]),e(q,{icon:"mdi-close",variant:"text",size:"small",onClick:je})]}),_:1}),e(le,{class:"pa-6"},{default:t(()=>[e(Y,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(le,{class:"pa-4"},{default:t(()=>{var u,H,G,C,ve,re;return[a("div",za,[e(Se,{image:(u=z.product)==null?void 0:u.image_url,size:"64"},{default:t(()=>{var ne;return[(ne=z.product)!=null&&ne.image_url?N("",!0):(f(),R(h,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),a("div",Ua,[a("h4",Ta,r((H=z.product)==null?void 0:H.name),1),a("p",Aa," SKU: "+r(((G=z.product)==null?void 0:G.sku)||"SKU-"+((C=z.product)==null?void 0:C.id_product)),1),a("div",Ha,[a("p",Ma," Harga: "+r(E(He)(((ve=z.product)==null?void 0:ve.price)||0)),1),a("p",Ka," HPP: "+r(E(He)(ce.value)),1),(re=z.product)!=null&&re.price&&ce.value?(f(),Z("p",Ba," Margin: "+r(E(He)(O.value)),1)):N("",!0)])]),e(ue,{color:ge(),variant:"tonal"},{default:t(()=>[d(r(J()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e(Pe,{class:"mb-6"},{default:t(()=>[e(S,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"info"},{default:t(()=>[e(le,{class:"text-center pa-3"},{default:t(()=>[e(h,{icon:"mdi-calculator",size:"20",class:"mb-1"}),a("div",Fa,[d(r(E(He)(ce.value))+" ",1),E(fe)?(f(),R(dt,{key:0,indeterminate:"",size:"12",width:"2",class:"ml-1"})):N("",!0)]),n[12]||(n[12]=a("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[12]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"primary"},{default:t(()=>[e(le,{class:"text-center pa-3"},{default:t(()=>{var u;return[e(h,{icon:"mdi-currency-usd",size:"20",class:"mb-1"}),a("div",Ea,r(E(He)(((u=z.product)==null?void 0:u.price)||0)),1),n[13]||(n[13]=a("div",{class:"text-caption"},"Harga Jual",-1))]}),_:1,__:[13]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"success"},{default:t(()=>[e(le,{class:"text-center pa-3"},{default:t(()=>[e(h,{icon:"mdi-trending-up",size:"20",class:"mb-1"}),a("div",Ra,r(E(He)(O.value)),1),n[14]||(n[14]=a("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[14]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"warning"},{default:t(()=>[e(le,{class:"text-center pa-3"},{default:t(()=>[e(h,{icon:"mdi-percent",size:"20",class:"mb-1"}),a("div",qa,r(ie.value)+"% ",1),n[15]||(n[15]=a("div",{class:"text-caption"},"Margin %",-1))]),_:1,__:[15]})]),_:1})]),_:1})]),_:1}),e(Y,{class:"mb-6",elevation:"2"},{default:t(()=>[e(xe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[a("div",La,[a("div",Na,[e(h,{icon:y.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),d(" "+r(y.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(le,{class:"pa-4"},{default:t(()=>[e(Pe,null,{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>[e(bt,{modelValue:w.value.itemId,"onUpdate:modelValue":n[0]||(n[0]=u=>w.value.itemId=u),items:oe.value,loading:x.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item (termasuk yang stok kosong)...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":L()},{item:t(({props:u,item:H})=>[e(Je,we(u,{class:{"text-medium-emphasis":te(H.raw)<=0}}),{prepend:t(()=>[e(Se,{size:"32",class:"me-3",color:te(H.raw)<=0?"warning":"primary",variant:"tonal"},{default:t(()=>[e(h,{icon:"mdi-package-variant",color:te(H.raw)<=0?"warning":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[te(H.raw)>0?(f(),R(ue,{key:0,size:"x-small",color:D(H.raw),variant:"tonal"},{default:t(()=>[d(r(m(H.raw)),1)]),_:2},1032,["color"])):(f(),R(ue,{key:1,size:"x-small",color:"warning",variant:"tonal","prepend-icon":"mdi-alert"},{default:t(()=>n[17]||(n[17]=[d(" Kosong ")])),_:1,__:[17]}))]),default:t(()=>[e(Ye,null,{default:t(()=>[d(r(H.raw.name),1)]),_:2},1024),e(st,{class:"text-medium-emphasis"},{default:t(()=>[te(H.raw)<=0?(f(),Z("span",Oa,[e(h,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),n[16]||(n[16]=d(" Stok Kosong - Masih bisa digunakan "))])):(f(),Z("span",ja," Stok: "+r(te(H.raw))+" "+r(H.raw.unit),1))]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(he,{modelValue:w.value.quantity,"onUpdate:modelValue":n[1]||(n[1]=u=>w.value.quantity=u),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Ze,{modelValue:w.value.isCritical,"onUpdate:modelValue":n[2]||(n[2]=u=>w.value.isCritical=u),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(q,{color:y.value?"success":"primary",block:"","prepend-icon":y.value?"mdi-check":"mdi-plus",onClick:n[3]||(n[3]=u=>y.value?se():ke()),disabled:!p.value},{default:t(()=>[d(r(y.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),y.value?(f(),R(q,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:Te},{default:t(()=>n[18]||(n[18]=[d(" Batal ")])),_:1,__:[18]})):N("",!0)]),_:1})]),_:1}),ae.value?(f(),R(Ke,{key:0,color:"warning",variant:"tonal",class:"mt-4","prepend-icon":"mdi-alert"},{default:t(()=>[e(ut,null,{default:t(()=>n[19]||(n[19]=[d("Item Stok Kosong")])),_:1,__:[19]}),n[20]||(n[20]=a("div",null,"Item yang dipilih sedang kosong stok, namun masih bisa ditambahkan ke komposisi. Pastikan untuk memperbarui stok sebelum produksi.",-1))]),_:1,__:[20]})):N("",!0)]),_:1})]),_:1}),e(Y,{elevation:"2"},{default:t(()=>[e(xe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e(h,{icon:"mdi-format-list-bulleted",class:"me-2"}),d(" Daftar Item Komposisi ("+r(W.value.length)+") ",1)]),_:1}),e(le,{class:"pa-0"},{default:t(()=>[W.value.length===0?(f(),Z("div",Ja,[e(h,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),n[21]||(n[21]=a("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),n[22]||(n[22]=a("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(f(),R(ct,{key:1},{default:t(()=>[(f(!0),Z(ze,null,We(W.value,(u,H)=>(f(),R(Je,{key:u.id||H,class:"border-b"},{prepend:t(()=>[e(Se,{size:"40",class:"me-3"},{default:t(()=>{var G,C;return[e(h,{icon:(G=u.item)!=null&&G.inventory&&u.item.inventory.current_stock>=u.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(C=u.item)!=null&&C.inventory&&u.item.inventory.current_stock>=u.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[a("div",Qa,[e(q,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:G=>De(u,H)},null,8,["onClick"]),e(q,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:G=>Ae(H)},null,8,["onClick"])])]),default:t(()=>[e(Ye,{class:"font-weight-medium"},{default:t(()=>{var G;return[d(r(((G=u.item)==null?void 0:G.name)||"Item tidak ditemukan")+" ",1),u.is_critical?(f(),R(ue,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>n[23]||(n[23]=[d(" Kritis ")])),_:1,__:[23]})):N("",!0)]}),_:2},1024),e(st,null,{default:t(()=>{var G;return[a("div",Wa,[a("span",null,"Dibutuhkan: "+r(parseFloat(u.quantity_needed))+" "+r(u.unit),1),(G=u.item)!=null&&G.inventory?(f(),Z("span",{key:0,class:Ge(u.item.inventory.current_stock>=u.quantity_needed?"text-success":"text-error")}," Stok: "+r(u.item.inventory.current_stock)+" "+r(u.unit),3)):N("",!0),u.formatted_total_cost?(f(),Z("span",Ga,r(u.formatted_total_cost),1)):N("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(Fe,{class:"pa-6 pt-0"},{default:t(()=>[e(q,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:i},{default:t(()=>n[24]||(n[24]=[d(" Setting HPP ")])),_:1,__:[24]}),e(Ne),e(q,{variant:"outlined",onClick:je},{default:t(()=>n[25]||(n[25]=[d(" Batal ")])),_:1,__:[25]}),e(q,{color:"primary",onClick:Qe,loading:b.value},{default:t(()=>n[26]||(n[26]=[d(" Simpan Komposisi ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1}),e(et,{modelValue:A.value,"onUpdate:modelValue":n[5]||(n[5]=u=>A.value=u),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(q,{color:"white",variant:"text",onClick:n[4]||(n[4]=u=>A.value=!1)},{default:t(()=>n[27]||(n[27]=[d(" Tutup ")])),_:1,__:[27]})]),default:t(()=>[d(r(_.value)+" ",1)]),_:1},8,["modelValue"]),e(et,{modelValue:g.value,"onUpdate:modelValue":n[7]||(n[7]=u=>g.value=u),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(q,{color:"white",variant:"text",onClick:n[6]||(n[6]=u=>g.value=!1)},{default:t(()=>n[28]||(n[28]=[d(" Tutup ")])),_:1,__:[28]})]),default:t(()=>[d(r(ee.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(Bt,{modelValue:me.value,"onUpdate:modelValue":n[9]||(n[9]=u=>me.value=u),"product-id":parseInt(String(((o=z.product)==null?void 0:o.id_product)||((V=z.product)==null?void 0:V.id)||"0")),"product-name":((B=z.product)==null?void 0:B.product_name)||((F=z.product)==null?void 0:F.name),onHppUpdated:P,onPriceUpdated:n[10]||(n[10]=u=>M("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),zt=Oe(Xa,[["__scopeId","data-v-8422e870"]]),Za={class:"composition-cards"},Ya={key:1,class:"text-center pa-12"},el={key:2,class:"text-center pa-12"},tl={class:"d-flex align-center gap-3"},al={class:"flex-grow-1 min-width-0"},ll={class:"text-h6 font-weight-bold text-truncate"},ol={class:"text-caption text-medium-emphasis mb-0"},sl={class:"d-flex align-center gap-2 mb-3"},il={class:"text-body-2 font-weight-medium"},nl={class:"composition-items"},rl={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},ul={class:"text-body-2 text-truncate"},dl={class:"text-end flex-shrink-0"},cl={class:"text-body-2 font-weight-medium"},ml={key:0,class:"text-caption text-success"},vl={key:1,class:"text-caption text-primary"},pl={class:"d-flex justify-between align-center mb-3"},fl={class:"text-h6 font-weight-bold text-primary"},gl={class:"d-flex gap-2"},_l={class:"d-flex align-center"},kl={class:"d-flex align-center gap-4"},bl={class:"flex-grow-1"},yl={class:"text-h5 font-weight-bold mb-2"},hl={class:"d-flex align-center gap-4 mb-2"},xl={class:"text-body-2"},wl={class:"d-flex align-center gap-4"},Pl={class:"text-h6 text-primary font-weight-bold"},Vl={class:"text-body-2 text-info font-weight-medium"},Cl={key:0,class:"text-body-2 text-success font-weight-medium"},$l={class:"d-flex align-center mt-1 gap-4"},Sl={class:"d-flex align-center"},Il={class:"d-flex align-center"},Dl={key:0,class:"d-flex align-center"},zl={class:"text-primary font-weight-medium"},Ul={key:1,class:"text-center py-8"},Tl={class:"text-h6 font-weight-bold"},Al={class:"text-h6 font-weight-bold"},Hl={class:"text-h6 font-weight-bold"},Ml={class:"text-h6 font-weight-bold"},Kl={class:"text-h6 font-weight-bold"},Bl=Ee({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup(I,{emit:be}){const K=I,M=be,j=T(!1),b=T(!1),W=T(null),A=T([]),g=T(null),_=T({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),ee=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],y=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],X=k=>{W.value=k,A.value=k.items||[],j.value=!0},me=k=>{g.value=k,b.value=!0},fe=k=>{M("refresh")},$=()=>{_.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},de=pe(()=>!!(_.value.search||_.value.stockStatus||_.value.itemType||_.value.criticalOnly||_.value.sortBy!=="name_asc")),ce=pe(()=>{let k=0;return _.value.search&&k++,_.value.stockStatus&&k++,_.value.itemType&&k++,_.value.criticalOnly&&k++,_.value.sortBy!=="name_asc"&&k++,k}),O=pe(()=>{const k=new Map;K.productItems.forEach(p=>{if(!p.product)return;const U=p.product.id_product||p.product.id;k.has(U)||k.set(U,{...p.product,items:[],totalItems:0}),k.get(U).items.push(p),k.get(U).totalItems++});let s=Array.from(k.values());if(_.value.search){const p=_.value.search.toLowerCase();s=s.filter(U=>U.name.toLowerCase().includes(p)||U.sku&&U.sku.toLowerCase().includes(p)||U.items.some(ae=>{var oe;return(oe=ae.item)==null?void 0:oe.name.toLowerCase().includes(p)}))}return _.value.stockStatus&&(s=s.filter(p=>{const U=ie(p);switch(_.value.stockStatus){case"safe":return U.color==="success";case"critical":return U.color==="warning";case"out":return U.color==="error";default:return!0}})),_.value.criticalOnly&&(s=s.filter(p=>p.items.some(U=>U.is_critical))),s.sort((p,U)=>{switch(_.value.sortBy){case"name_asc":return p.name.localeCompare(U.name);case"name_desc":return U.name.localeCompare(p.name);case"price_asc":return(p.price||0)-(U.price||0);case"price_desc":return(U.price||0)-(p.price||0);case"items_asc":return p.totalItems-U.totalItems;case"items_desc":return U.totalItems-p.totalItems;default:return p.name.localeCompare(U.name)}}),s}),ie=k=>{let s=!1,p=!1;return k.items.forEach(U=>{var ae;if((ae=U.item)!=null&&ae.inventory){const oe=U.item.inventory.current_stock||0,te=U.quantity_needed||0;oe<=0?s=!0:(oe<te||U.is_critical)&&(p=!0)}}),s?{text:"Stok Habis",color:"error"}:p?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},w=k=>{if(!(k!=null&&k.inventory))return"grey";const s=k.inventory.current_stock||0;return s<=0?"error":s<=10?"warning":"success"},c=k=>{if(!(k!=null&&k.inventory))return"Tidak ada data";const s=k.inventory.current_stock||0;return s<=0?"Habis":s<=10?"Rendah":"Aman"},x=k=>{const s=w(k);return{"text-error":s==="error","text-warning":s==="warning","text-success":s==="success","text-grey":s==="grey"}},v=k=>`Item Komposisi (${k})`;return(k,s)=>(f(),Z("div",Za,[e(Y,{class:"mb-6"},{default:t(()=>[e(xe,{class:"d-flex align-center justify-between"},{default:t(()=>[s[12]||(s[12]=a("div",null,[a("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),a("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),e(q,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:s[0]||(s[0]=p=>M("refresh")),loading:k.loading},{default:t(()=>s[11]||(s[11]=[d(" Refresh ")])),_:1,__:[11]},8,["loading"])]),_:1,__:[12]})]),_:1}),e(Y,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(le,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(S,{cols:"12",md:"3"},{default:t(()=>[e(he,{modelValue:_.value.search,"onUpdate:modelValue":s[1]||(s[1]=p=>_.value.search=p),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:_.value.stockStatus,"onUpdate:modelValue":s[2]||(s[2]=p=>_.value.stockStatus=p),items:ee,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:_.value.sortBy,"onUpdate:modelValue":s[3]||(s[3]=p=>_.value.sortBy=p),items:y,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(ra,{modelValue:_.value.criticalOnly,"onUpdate:modelValue":s[4]||(s[4]=p=>_.value.criticalOnly=p),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Pe,{class:"mt-3"},{default:t(()=>[e(S,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(q,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:$,disabled:!de.value},{default:t(()=>s[13]||(s[13]=[d(" Reset Filter ")])),_:1,__:[13]},8,["disabled"]),de.value?(f(),R(ue,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[d(r(ce.value)+" filter aktif ",1)]),_:1})):N("",!0)]),_:1}),e(S,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(ue,{color:O.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[d(r(O.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!k.loading&&O.value.length===0&&de.value?(f(),R(Ke,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):N("",!0),k.loading?(f(),Z("div",Ya,[e(dt,{color:"primary",indeterminate:"",size:"64"}),s[14]||(s[14]=a("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):O.value.length===0?(f(),Z("div",el,[e(h,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),s[16]||(s[16]=a("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),s[17]||(s[17]=a("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(q,{color:"primary",size:"large","prepend-icon":"mdi-plus"},{default:t(()=>s[15]||(s[15]=[d(" Buat Komposisi Pertama ")])),_:1,__:[15]})])):(f(),R(Pe,{key:3},{default:t(()=>[(f(!0),Z(ze,null,We(O.value,p=>(f(),R(S,{key:p.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(Y,{class:Ge(["composition-card h-100",{"border-error":ie(p).color==="error"}]),elevation:"2"},{default:t(()=>[e(xe,{class:"pa-4 pb-2"},{default:t(()=>[a("div",tl,[e(Se,{image:p.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[p.image_url?N("",!0):(f(),R(h,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),a("div",al,[a("h3",ll,r(p.name),1),a("p",ol,r(p.sku||"SKU-"+p.id_product),1)])])]),_:2},1024),e(le,{class:"py-2"},{default:t(()=>[e(ue,{color:ie(p).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[d(r(ie(p).text),1)]),_:2},1032,["color"]),a("div",sl,[e(h,{icon:"mdi-format-list-bulleted",size:"16"}),a("span",il,r(v(p.totalItems)),1)]),a("div",nl,[(f(!0),Z(ze,null,We(p.items,U=>{var ae,oe,te,L;return f(),Z("div",{key:U.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[a("div",rl,[e(h,{icon:(ae=U.item)!=null&&ae.inventory&&U.item.inventory.current_stock>=U.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(oe=U.item)!=null&&oe.inventory&&U.item.inventory.current_stock>=U.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),a("span",ul,r(((te=U.item)==null?void 0:te.name)||"Item tidak ditemukan"),1),U.is_critical?(f(),R(ue,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>s[18]||(s[18]=[d(" Kritis ")])),_:1,__:[18]})):N("",!0)]),a("div",dl,[a("div",cl,r(parseFloat(U.quantity_needed))+" "+r(U.unit),1),(L=U.item)!=null&&L.inventory?(f(),Z("div",ml," Stok: "+r(U.item.inventory.current_stock)+" "+r(U.unit),1)):N("",!0),U.formatted_total_cost?(f(),Z("div",vl,r(U.formatted_total_cost),1)):N("",!0)])])}),128))])]),_:2},1024),e(le,{class:"pt-0"},{default:t(()=>[e(Ue,{class:"mb-3"}),a("div",pl,[s[19]||(s[19]=a("span",{class:"text-body-2"},"Harga:",-1)),a("span",fl,r(E(He)(p.price||0)),1)]),a("div",gl,[e(q,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:U=>me(p)},{default:t(()=>s[20]||(s[20]=[d(" Detail ")])),_:2,__:[20]},1032,["onClick"]),e(q,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:U=>X(p)},{default:t(()=>s[21]||(s[21]=[d(" Kelola ")])),_:2,__:[21]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(zt,{modelValue:j.value,"onUpdate:modelValue":s[5]||(s[5]=p=>j.value=p),product:W.value,items:A.value,onSave:fe,onRefresh:s[6]||(s[6]=p=>M("refresh"))},null,8,["modelValue","product","items"]),e(Le,{modelValue:b.value,"onUpdate:modelValue":s[10]||(s[10]=p=>b.value=p),"max-width":"900",scrollable:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",_l,[e(h,{icon:"mdi-eye",class:"mr-2",color:"primary"}),s[22]||(s[22]=a("span",null,"Detail Komposisi Produk",-1))]),e(q,{icon:"",variant:"text",onClick:s[7]||(s[7]=p=>b.value=!1)},{default:t(()=>[e(h,{icon:"mdi-close"})]),_:1})]),_:1}),e(Ue),g.value?(f(),R(le,{key:0},{default:t(()=>[e(ua,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(Y,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(le,null,{default:t(()=>[a("div",kl,[e(Se,{image:g.value.image_url,size:"80"},{default:t(()=>[g.value.image_url?N("",!0):(f(),R(h,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),a("div",bl,[a("h2",yl,r(g.value.name),1),a("div",hl,[e(ue,{color:ie(g.value).color,variant:"tonal",size:"small"},{default:t(()=>[d(r(ie(g.value).text),1)]),_:1},8,["color"]),a("span",xl,"SKU: "+r(g.value.sku||"-"),1)]),a("div",wl,[a("div",Pl,r(E(He)(g.value.price||0)),1),a("div",Vl," HPP: "+r(E(He)(g.value.hpp||g.value.cost||0)),1),g.value.price&&(g.value.hpp||g.value.cost)?(f(),Z("div",Cl," Margin: "+r(E(He)((g.value.price||0)-(g.value.hpp||g.value.cost||0))),1)):N("",!0)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e(Pe,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(Y,{variant:"outlined"},{default:t(()=>[e(xe,{class:"text-h6"},{default:t(()=>[e(h,{icon:"mdi-format-list-bulleted",class:"mr-2"}),d(" Komposisi Item ("+r(g.value.totalItems||0)+") ",1)]),_:1}),e(le,null,{default:t(()=>[g.value.items&&g.value.items.length>0?(f(),R(ct,{key:0},{default:t(()=>[(f(!0),Z(ze,null,We(g.value.items,(p,U)=>(f(),R(Je,{key:p.id_product_item,class:"px-0"},{prepend:t(()=>[e(Se,{size:"40",color:w(p.item),variant:"tonal"},{default:t(()=>{var ae;return[e(h,{icon:(ae=p.item)!=null&&ae.inventory&&p.item.inventory.current_stock>=p.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(ue,{color:w(p.item),variant:"tonal",size:"small"},{default:t(()=>[d(r(c(p.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(Ye,{class:"font-weight-medium"},{default:t(()=>{var ae;return[d(r(((ae=p.item)==null?void 0:ae.name)||"Unknown Item")+" ",1),p.is_critical?(f(),R(ue,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>s[23]||(s[23]=[d(" Kritis ")])),_:1,__:[23]})):N("",!0)]}),_:2},1024),e(st,null,{default:t(()=>{var ae,oe;return[a("div",$l,[a("div",Sl,[e(h,{icon:"mdi-scale",size:"14",class:"mr-1"}),a("span",null," Kebutuhan: "+r(Number(p.quantity_needed||0).toLocaleString("id-ID"))+" "+r(p.unit),1)]),a("div",Il,[e(h,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),a("span",{class:Ge(x(p.item))}," Stok: "+r(Number(((oe=(ae=p.item)==null?void 0:ae.inventory)==null?void 0:oe.current_stock)||0).toLocaleString("id-ID"))+" "+r(p.unit),3)]),p.formatted_total_cost?(f(),Z("div",Dl,[e(h,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),a("span",zl,r(p.formatted_total_cost),1)])):N("",!0)])]}),_:2},1024),U<g.value.items.length-1?(f(),R(Ue,{key:0,class:"mt-3"})):N("",!0)]),_:2},1024))),128))]),_:1})):(f(),Z("div",Ul,[e(h,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),s[24]||(s[24]=a("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(Pe,{class:"mt-4"},{default:t(()=>[e(S,{cols:"12",md:"2"},{default:t(()=>[e(Y,{variant:"outlined",color:"primary"},{default:t(()=>[e(le,{class:"text-center"},{default:t(()=>[e(h,{icon:"mdi-format-list-bulleted",size:"24",class:"mb-2"}),a("div",Tl,r(g.value.totalItems||0),1),s[25]||(s[25]=a("div",{class:"text-caption"},"Total Item",-1))]),_:1,__:[25]})]),_:1})]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Y,{variant:"outlined",color:"warning"},{default:t(()=>[e(le,{class:"text-center"},{default:t(()=>{var p;return[e(h,{icon:"mdi-alert",size:"24",class:"mb-2"}),a("div",Al,r(((p=g.value.items)==null?void 0:p.filter(U=>U.is_critical).length)||0),1),s[26]||(s[26]=a("div",{class:"text-caption"},"Item Kritis",-1))]}),_:1,__:[26]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"info"},{default:t(()=>[e(le,{class:"text-center"},{default:t(()=>[e(h,{icon:"mdi-calculator",size:"24",class:"mb-2"}),a("div",Hl,r(E(He)(g.value.hpp||g.value.cost||0)),1),s[27]||(s[27]=a("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[27]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"success"},{default:t(()=>[e(le,{class:"text-center"},{default:t(()=>[e(h,{icon:"mdi-currency-usd",size:"24",class:"mb-2"}),a("div",Ml,r(E(He)(g.value.price||0)),1),s[28]||(s[28]=a("div",{class:"text-caption"},"Harga Jual",-1))]),_:1,__:[28]})]),_:1})]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Y,{variant:"outlined",color:"purple"},{default:t(()=>[e(le,{class:"text-center"},{default:t(()=>[e(h,{icon:"mdi-trending-up",size:"24",class:"mb-2"}),a("div",Kl,r(E(He)((g.value.price||0)-(g.value.hpp||g.value.cost||0))),1),s[29]||(s[29]=a("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[29]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):N("",!0),e(Ue),e(Fe,{class:"pa-4"},{default:t(()=>[e(Ne),e(q,{variant:"outlined",onClick:s[8]||(s[8]=p=>b.value=!1)},{default:t(()=>s[30]||(s[30]=[d(" Tutup ")])),_:1,__:[30]}),e(q,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:s[9]||(s[9]=()=>{b.value=!1,X(g.value)})},{default:t(()=>s[31]||(s[31]=[d(" Kelola Komposisi ")])),_:1,__:[31]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),Fl=Oe(Bl,[["__scopeId","data-v-25f6bef1"]]),El={class:"d-flex align-center gap-2"},Rl={class:"text-white"},ql={class:"text-h6 mb-4 d-flex align-center gap-2"},Ll={class:"text-h6 mb-4 d-flex align-center gap-2"},Nl={class:"d-flex flex-column gap-2"},Ol={key:0,class:"d-flex align-center gap-2"},jl={class:"d-flex align-center gap-2 mb-2"},Jl={class:"d-flex gap-2"},Wl={class:"d-flex gap-2"},Gl={class:"d-flex align-center justify-space-between"},Ql={class:"d-flex align-center gap-2"},Xl={class:"text-end"},Zl={class:"text-h6 font-weight-bold"},Yl={class:"text-caption"},eo={class:"text-h6 mb-4 d-flex align-center gap-2"},to={class:"text-h6 mb-4 d-flex align-center gap-2"},ao={class:"image-upload-container"},lo={key:0,class:"mb-4"},oo={class:"text-center mt-2"},so={class:"text-h6 mb-4 d-flex align-center gap-2"},io={class:"text-h6 mb-4 d-flex align-center gap-2"},no={class:"text-h6 mb-4 d-flex align-center gap-2"},ro={class:"d-flex align-center"},uo={class:"text-subtitle-1"},co={class:"text-body-1"},mo={class:"d-flex align-center"},vo={class:"text-subtitle-1"},po=Ee({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup(I,{emit:be}){var L,D,m;const K=It(),{nameRules:M,categoryRules:j}=Dt(),{getProductHPPBreakdown:b}=_t(),W=T(!1),A=T(!1),g=async()=>{if(!(!y.editMode||!$.id))try{const l=await fetch(`/api/products/${$.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(l.ok){const i=await l.json();A.value=i.success&&i.data&&i.data.length>0}}catch(l){console.error("Error checking HPP status:",l)}},_=async()=>{if($.id)try{W.value=!0;const l=await b($.id,"latest");l&&($.cost=l.total_hpp,me("update-form","cost",l.total_hpp))}catch(l){console.error("Error refreshing HPP:",l)}finally{W.value=!1}},ee=()=>{},y=I,X=pe(()=>y.errorMessage),me=be,fe=T(),$=gt({...y.formData,available_in_kitchen:!!y.formData.available_in_kitchen,available_in_bar:!!y.formData.available_in_bar});Ve(()=>y.formData,l=>{const i={...l,available_in_kitchen:!!l.available_in_kitchen,available_in_bar:!!l.available_in_bar};Object.assign($,i)},{deep:!0}),Ve($,l=>{Object.keys(l).forEach(i=>{me("update-form",i,l[i])})},{deep:!0}),Ve(()=>y.modelValue,l=>{l&&y.editMode&&g()});const de=gt({length:((L=y.formData.dimensions)==null?void 0:L.length)||null,width:((D=y.formData.dimensions)==null?void 0:D.width)||null,height:((m=y.formData.dimensions)==null?void 0:m.height)||null});Ve(de,l=>{const i=l.length!==null||l.width!==null||l.height!==null;$.dimensions=i?{length:l.length!==null?l.length:void 0,width:l.width!==null?l.width:void 0,height:l.height!==null?l.height:void 0}:{}},{deep:!0});const ce=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],O=pe(()=>{if(!$.price||!$.cost||$.cost<=0)return 0;const l=($.price-$.cost)/$.cost*100;return Math.ceil(l)}),ie=l=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),w=l=>l<10?"error":l<25?"warning":l<50?"success":"info",c=l=>l<10?"tabler-trending-down":l<25?"tabler-trending-up":l<50?"tabler-trending-up-2":"tabler-trending-up-3",x=l=>!l||l===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),v=l=>{if(!l||l.trim()===""||l==="Rp 0")return 0;const P=l.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(P)||0},k=T(!1),s=l=>{const i=v(l);$.price=i},p=()=>{k.value=!0},U=()=>{k.value=!1},ae=async()=>{var i;const{valid:l}=await((i=fe.value)==null?void 0:i.validate());l&&me("submit",$)},oe=l=>{me("image-change",l)},te=()=>{me("remove-image")};return(l,i)=>(f(),R(Le,{"model-value":l.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":i[27]||(i[27]=P=>l.$emit("update:modelValue",P))},{default:t(()=>[e(Y,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[a("div",El,[e(h,{icon:l.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),a("span",Rl,r(l.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(q,{icon:"tabler-x",variant:"text",color:"white",onClick:i[0]||(i[0]=P=>l.$emit("close"))})]),_:1}),e(Ue),e(le,{class:"pa-6"},{default:t(()=>[e(yt,{ref_key:"formRef",ref:fe,onSubmit:kt(ae,["prevent"])},{default:t(()=>[e(Pe,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[a("h6",ql,[e(h,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),i[28]||(i[28]=d(" Informasi Dasar "))])]),_:1}),e(S,{cols:"12",md:"8"},{default:t(()=>[e(he,{modelValue:$.name,"onUpdate:modelValue":i[1]||(i[1]=P=>$.name=P),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:E(M),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:$.sku,"onUpdate:modelValue":i[2]||(i[2]=P=>$.sku=P),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(Ct,{modelValue:$.description,"onUpdate:modelValue":i[3]||(i[3]=P=>$.description=P),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(Be,{"model-value":$.category_id,"onUpdate:modelValue":i[4]||(i[4]=P=>$.category_id=P),items:l.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:E(j),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(he,{modelValue:$.brand,"onUpdate:modelValue":i[5]||(i[5]=P=>$.brand=P),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[a("h6",Ll,[e(h,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),i[29]||(i[29]=d(" Harga & Biaya "))])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(he,{"model-value":x($.price),"onUpdate:modelValue":i[6]||(i[6]=P=>s(P)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:p,onBlur:U},null,8,["model-value"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[a("div",Nl,[e(he,{"model-value":x($.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),l.editMode?(f(),Z("div",Ol,[e(ue,{color:A.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e(h,{icon:A.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),d(" "+r(A.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),A.value?(f(),R(q,{key:0,size:"small",variant:"outlined",color:"primary",onClick:_,loading:W.value},{default:t(()=>[e(h,{icon:"tabler-refresh",size:"14",class:"me-1"}),i[30]||(i[30]=d(" Update HPP "))]),_:1,__:[30]},8,["loading"])):(f(),R(Me,{key:1},{activator:t(({props:P})=>[e(ue,we(P,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e(h,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),i[31]||(i[31]=d(" Belum Ada Resep "))]),_:2,__:[31]},1040)]),default:t(()=>[i[32]||(i[32]=a("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[32]}))])):N("",!0)])]),_:1}),l.editMode?(f(),R(S,{key:0,cols:"12"},{default:t(()=>[A.value?(f(),R(Ke,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ut,null,{default:t(()=>[e(h,{icon:"tabler-info-circle",class:"me-2"}),i[33]||(i[33]=d(" HPP Otomatis Aktif "))]),_:1,__:[33]}),i[34]||(i[34]=a("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[34]})):(f(),R(Ke,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ut,null,{default:t(()=>[e(h,{icon:"tabler-alert-triangle",class:"me-2"}),i[35]||(i[35]=d(" HPP Manual "))]),_:1,__:[35]}),i[36]||(i[36]=a("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[36]}))]),_:1})):N("",!0),e(S,{cols:"12"},{default:t(()=>[A.value&&l.editMode?(f(),R(Ke,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[a("div",jl,[e(h,{icon:"tabler-check-circle"}),i[37]||(i[37]=a("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),i[40]||(i[40]=a("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),a("div",Jl,[e(q,{size:"small",color:"primary",variant:"outlined",onClick:ee},{default:t(()=>[e(h,{icon:"tabler-edit",size:"14",class:"me-1"}),i[38]||(i[38]=d(" Edit Resep "))]),_:1,__:[38]}),e(q,{size:"small",variant:"outlined",color:"info",onClick:_,loading:W.value},{default:t(()=>[e(h,{icon:"tabler-refresh",size:"14",class:"me-1"}),i[39]||(i[39]=d(" Refresh HPP "))]),_:1,__:[39]},8,["loading"])])]),_:1,__:[40]})):!A.value&&l.editMode?(f(),R(Ke,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[a("div",Wl,[e(q,{size:"small",variant:"outlined",color:"info",onClick:i[7]||(i[7]=P=>E(K).push("/hpp-management"))},{default:t(()=>[e(h,{icon:"tabler-calculator",size:"14",class:"me-1"}),i[41]||(i[41]=d(" Lihat HPP Management "))]),_:1,__:[41]})])]),_:1})):N("",!0)]),_:1}),e(S,{cols:"12"},{default:t(()=>[$.price&&$.cost&&$.cost>0?(f(),R(Ke,{key:0,color:w(O.value),variant:"tonal",class:"mb-0"},{default:t(()=>[a("div",Gl,[a("div",Ql,[e(h,{icon:c(O.value)},null,8,["icon"]),i[42]||(i[42]=a("span",{class:"font-weight-medium"},"Profit Margin",-1))]),a("div",Xl,[a("div",Zl,r(Math.round(O.value))+"%",1),a("div",Yl," Keuntungan: "+r(ie($.price-$.cost)),1)])])]),_:1},8,["color"])):N("",!0)]),_:1}),e(S,{cols:"12"},{default:t(()=>[a("h6",eo,[e(h,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),i[43]||(i[43]=d(" Dimensi (cm) "))])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:de.length,"onUpdate:modelValue":i[8]||(i[8]=P=>de.length=P),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:de.width,"onUpdate:modelValue":i[9]||(i[9]=P=>de.width=P),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:de.height,"onUpdate:modelValue":i[10]||(i[10]=P=>de.height=P),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[a("h6",to,[e(h,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),i[44]||(i[44]=d(" Gambar Produk "))])]),_:1}),e(S,{cols:"12"},{default:t(()=>[a("div",ao,[l.imagePreview?(f(),Z("div",lo,[e(va,{src:l.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),a("div",oo,[e(q,{size:"small",color:"error",variant:"outlined",onClick:te},{default:t(()=>i[45]||(i[45]=[d(" Hapus Gambar ")])),_:1,__:[45]})])])):N("",!0),e(pa,{"model-value":l.selectedImage,"onUpdate:modelValue":i[11]||(i[11]=P=>oe(Array.isArray(P)?P:[P])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),i[46]||(i[46]=a("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e(S,{cols:"12"},{default:t(()=>[a("h6",so,[e(h,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),i[47]||(i[47]=d(" Pengaturan "))])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(Be,{"model-value":$.status,"onUpdate:modelValue":i[12]||(i[12]=P=>$.status=P),items:ce,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(Ze,{"model-value":$.active,"onUpdate:modelValue":i[13]||(i[13]=P=>$.active=P??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(Ze,{"model-value":$.featured,"onUpdate:modelValue":i[14]||(i[14]=P=>$.featured=P??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[a("h6",io,[e(h,{icon:"tabler-tools-kitchen-2",size:"20",class:"coffee-icon"}),i[48]||(i[48]=d(" Ketersediaan Station "))])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(Ze,{"model-value":$.available_in_kitchen,"onUpdate:modelValue":i[15]||(i[15]=P=>$.available_in_kitchen=!!P),label:"Tersedia di Kitchen",color:"coffee",inset:""},{prepend:t(()=>[e(h,{icon:"tabler-chef-hat",class:"me-2",color:$.available_in_kitchen?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(Ze,{"model-value":$.available_in_bar,"onUpdate:modelValue":i[16]||(i[16]=P=>$.available_in_bar=!!P),label:"Tersedia di Bar",color:"coffee",inset:""},{prepend:t(()=>[e(h,{icon:"tabler-glass-cocktail",class:"me-2",color:$.available_in_bar?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[a("h6",no,[e(h,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),i[49]||(i[49]=d(" SEO (Opsional) "))])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(he,{modelValue:$.meta_title,"onUpdate:modelValue":i[17]||(i[17]=P=>$.meta_title=P),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(Ct,{modelValue:$.meta_description,"onUpdate:modelValue":i[18]||(i[18]=P=>$.meta_description=P),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(Sa,{"model-value":$.tags,"onUpdate:modelValue":i[19]||(i[19]=P=>$.tags=P),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Ue),e(Fe,{class:"pa-6"},{default:t(()=>[e(Ne),e(q,{variant:"outlined",class:"coffee-secondary",onClick:i[20]||(i[20]=P=>l.$emit("close"))},{default:t(()=>i[50]||(i[50]=[d(" Batal ")])),_:1,__:[50]}),e(q,{color:"primary",class:"coffee-primary",loading:l.loading,onClick:ae},{default:t(()=>[d(r(l.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),l.useDialogError?N("",!0):(f(),R(et,{key:0,"model-value":!!X.value,"onUpdate:modelValue":i[22]||(i[22]=P=>!P&&l.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(q,{icon:"tabler-x",size:"small",variant:"text",onClick:i[21]||(i[21]=P=>l.$emit("clear-error"))})]),default:t(()=>[a("div",ro,[e(h,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),a("div",null,[i[51]||(i[51]=a("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),a("div",uo,r(X.value),1)])])]),_:1},8,["model-value"])),l.useDialogError?(f(),R(Le,{key:1,"model-value":!!X.value,"onUpdate:modelValue":i[24]||(i[24]=P=>!P&&l.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center text-error"},{default:t(()=>[e(h,{icon:"tabler-alert-circle",class:"me-2"}),i[52]||(i[52]=d(" Error Occurred "))]),_:1,__:[52]}),e(Ue),e(le,{class:"py-4"},{default:t(()=>[a("div",co,r(X.value),1)]),_:1}),e(Ue),e(Fe,{class:"justify-end pa-4"},{default:t(()=>[e(q,{color:"error",variant:"outlined",onClick:i[23]||(i[23]=P=>l.$emit("clear-error"))},{default:t(()=>i[53]||(i[53]=[d(" Close ")])),_:1,__:[53]})]),_:1})]),_:1})]),_:1},8,["model-value"])):N("",!0),e(et,{"model-value":!!l.successMessage,"onUpdate:modelValue":i[26]||(i[26]=P=>!P&&l.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(q,{icon:"tabler-x",size:"small",variant:"text",onClick:i[25]||(i[25]=P=>l.$emit("clear-success"))})]),default:t(()=>[a("div",mo,[e(h,{icon:"tabler-check-circle",class:"me-3",size:"28"}),a("div",null,[i[54]||(i[54]=a("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),a("div",vo,r(l.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),fo=Oe(po,[["__scopeId","data-v-333cc50b"]]),go={key:0,class:"mt-4"},_o={class:"d-flex align-center gap-2 mb-2"},ko={class:"d-flex flex-wrap gap-2"},bo=Ee({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup(I,{emit:be}){const K=I,M=be,{categories:j,loading:b,fetchAllCategories:W}=fa(),A=T(!1),g=T("");tt(async()=>{await W(),g.value=_.search||""});const _=gt({...K.filters});Ve(()=>K.filters,w=>{Object.assign(_,w),g.value=w.search||""},{deep:!0}),Zt(g,w=>{_.search=w,(w.length>=3||w.length===0)&&(A.value=!0,M("search",w),$(),setTimeout(()=>{A.value=!1},500))},{debounce:500,maxWait:1e3});const ee=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],y=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],X=[{title:"Kitchen Only",value:"kitchen"},{title:"Bar Only",value:"bar"},{title:"Kitchen & Bar",value:"both"}],me=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],fe=pe(()=>!!(g.value||_.category_id||_.active||_.stock_status||_.station||_.featured!==null||_.min_price||_.max_price)),$=()=>{M("update:filters",{..._})},de=()=>{g.value="",Object.assign(_,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),$()},ce=w=>{const c=j.value.find(x=>x.id_category===w);return(c==null?void 0:c.name)||"Unknown"},O=w=>{if(!w)return"Semua";const c=ee.find(x=>x.value===w);return(c==null?void 0:c.title)||String(w)},ie=w=>{const c=y.find(x=>x.value===w);return(c==null?void 0:c.title)||w};return(w,c)=>(f(),R(Y,{class:"mb-6"},{default:t(()=>[e(xe,{class:"d-flex align-center gap-2"},{default:t(()=>[e(h,{icon:"tabler-filter",class:"coffee-icon"}),c[12]||(c[12]=d(" Filter & Pencarian Produk "))]),_:1,__:[12]}),e(le,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:g.value,"onUpdate:modelValue":c[0]||(c[0]=x=>g.value=x),label:"Cari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:A.value,clearable:"",variant:"outlined",hint:g.value.length>0&&g.value.length<3?`Ketik ${3-g.value.length} karakter lagi untuk mencari`:"","persistent-hint":""},null,8,["modelValue","loading","hint"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:_.category_id,"onUpdate:modelValue":[c[1]||(c[1]=x=>_.category_id=x),$],items:E(j),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:E(b),clearable:"",variant:"outlined"},{"no-data":t(()=>[e(Je,null,{default:t(()=>[e(Ye,null,{default:t(()=>[d(r(E(b)?"Memuat kategori...":"Tidak ada kategori"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:_.active,"onUpdate:modelValue":[c[2]||(c[2]=x=>_.active=x),$],items:ee,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:_.stock_status,"onUpdate:modelValue":[c[3]||(c[3]=x=>_.stock_status=x),$],items:y,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:_.station,"onUpdate:modelValue":[c[4]||(c[4]=x=>_.station=x),$],items:X,label:"Station",placeholder:"Semua station","prepend-inner-icon":"tabler-tools-kitchen-2",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(q,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:de})]),_:1})]),_:1}),e(Pe,{class:"mt-3"},{default:t(()=>[e(S,{cols:"12",md:"3"},{default:t(()=>[e(he,{modelValue:_.min_price,"onUpdate:modelValue":c[5]||(c[5]=x=>_.min_price=x),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:$},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(he,{modelValue:_.max_price,"onUpdate:modelValue":c[6]||(c[6]=x=>_.max_price=x),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:$},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:_.sort_order,"onUpdate:modelValue":[c[7]||(c[7]=x=>_.sort_order=x),$],items:me,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),fe.value?(f(),Z("div",go,[a("div",_o,[e(h,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),c[13]||(c[13]=a("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),a("div",ko,[g.value?(f(),R(ue,{key:0,closable:"",size:"small",color:"coffee","onClick:close":c[8]||(c[8]=x=>{g.value="",_.search="",$()})},{default:t(()=>[d(" Pencarian: "+r(g.value),1)]),_:1})):N("",!0),_.category_id?(f(),R(ue,{key:1,closable:"",size:"small",color:"coffee","onClick:close":c[9]||(c[9]=x=>{_.category_id=null,$()})},{default:t(()=>[d(" Kategori: "+r(ce(_.category_id)),1)]),_:1})):N("",!0),_.active?(f(),R(ue,{key:2,closable:"",size:"small",color:"coffee","onClick:close":c[10]||(c[10]=x=>{_.active=null,$()})},{default:t(()=>[d(" Status: "+r(O(_.active)),1)]),_:1})):N("",!0),_.stock_status?(f(),R(ue,{key:3,closable:"",size:"small",color:"coffee","onClick:close":c[11]||(c[11]=x=>{_.stock_status=null,$()})},{default:t(()=>[d(" Stok: "+r(ie(_.stock_status)),1)]),_:1})):N("",!0)])])):N("",!0)]),_:1})]),_:1}))}}),yo=Oe(bo,[["__scopeId","data-v-d597dc7f"]]),ho={class:"d-flex align-center gap-2"},xo={class:"text-h6"},wo={class:"d-flex align-center gap-2"},Po={class:"text-h6"},Vo={class:"d-flex align-center gap-2"},Co={class:"text-h6"},$o={class:"d-flex align-center gap-2"},So={class:"text-h6"},Io={class:"d-flex align-center gap-2"},Do={class:"text-h6"},zo={class:"d-flex align-center gap-2"},Uo={class:"text-h6"},To={class:"d-flex align-center gap-2"},Ao={class:"text-h6"},Ho={class:"d-flex align-center gap-2"},Mo={class:"text-h6"},Ko=Ee({__name:"ProductStatsCards",props:{stats:{}},setup(I){const be=M=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(M),K=M=>`${M.toFixed(1)}%`;return(M,j)=>(f(),R(Pe,{class:"mb-6"},{default:t(()=>[e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var b;return[e(Se,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(h,{icon:"tabler-package"})]),_:1}),a("div",null,[j[0]||(j[0]=a("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),a("div",ho,[a("h6",xo,r(((b=M.stats)==null?void 0:b.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var b;return[e(Se,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(h,{icon:"tabler-check"})]),_:1}),a("div",null,[j[1]||(j[1]=a("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),a("div",wo,[a("h6",Po,r(((b=M.stats)==null?void 0:b.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var b;return[e(Se,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(h,{icon:"tabler-star"})]),_:1}),a("div",null,[j[2]||(j[2]=a("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),a("div",Vo,[a("h6",Co,r(((b=M.stats)==null?void 0:b.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var b;return[e(Se,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(h,{icon:"tabler-alert-triangle"})]),_:1}),a("div",null,[j[3]||(j[3]=a("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),a("div",$o,[a("h6",So,r(((b=M.stats)==null?void 0:b.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var b;return[e(Se,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(h,{icon:"tabler-currency-dollar"})]),_:1}),a("div",null,[j[4]||(j[4]=a("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),a("div",Io,[a("h6",Do,r(be(((b=M.stats)==null?void 0:b.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var b;return[e(Se,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(h,{icon:"tabler-chart-line"})]),_:1}),a("div",null,[j[5]||(j[5]=a("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),a("div",zo,[a("h6",Uo,r(be(((b=M.stats)==null?void 0:b.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var b;return[e(Se,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(h,{icon:"tabler-trending-up"})]),_:1}),a("div",null,[j[6]||(j[6]=a("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),a("div",To,[a("h6",Ao,r(K(((b=M.stats)==null?void 0:b.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var b;return[e(Se,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e(h,{icon:"tabler-x-circle"})]),_:1}),a("div",null,[j[7]||(j[7]=a("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),a("div",Ho,[a("h6",Mo,r(((b=M.stats)==null?void 0:b.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),Bo=Oe(Ko,[["__scopeId","data-v-124783ae"]]),Fo={class:"d-flex align-center gap-2"},Eo={class:"d-flex align-center gap-2"},Ro={class:"text-center py-8"},qo={class:"d-flex align-center gap-3 py-2"},Lo={class:"font-weight-medium"},No={class:"text-caption text-medium-emphasis"},Oo={class:"text-end"},jo={class:"font-weight-medium"},Jo={class:"text-caption text-medium-emphasis d-flex align-center justify-end gap-1"},Wo={class:"text-center profit-margin-container"},Go={class:"text-center"},Qo={key:0,class:"text-caption text-medium-emphasis mt-1"},Xo={class:"d-flex align-center gap-2"},Zo={class:"d-flex flex-column gap-1"},Yo={key:2,class:"text-caption text-medium-emphasis"},es={class:"text-body-2"},ts={class:"text-caption text-medium-emphasis"},as={class:"d-flex align-center gap-1"},ls=300*1e3,os=1e3,ss=Ee({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","bulk-delete","update:page","update:items-per-page","update:sort-by","update:selected-products"],setup(I,{expose:be}){const K=I,{currentHPPBreakdown:M,getProductHPPBreakdown:j}=_t(),b=T({}),W=T({}),A=T({}),g=T(new Set),_=T(new Set);let ee=null;const y=v=>{const k=A.value[v];return k?Date.now()-k.timestamp<ls:!1},X=async()=>{if(_.value.size===0)return;const v=Array.from(_.value);_.value.clear();const k=v.filter(p=>{const U=K.products.find(ae=>(ae.id_product||ae.id)===p);return U&&(U.hpp===void 0||U.hpp===null)});if(k.length===0)return;const s=3;for(let p=0;p<k.length;p+=s){const ae=k.slice(p,p+s).map(async oe=>{var te;if(!(W.value[oe]||y(oe))){W.value[oe]=!0,g.value.add(oe);try{if(await j(oe,"latest"),(te=M.value)!=null&&te.total_hpp){const L=M.value.total_hpp;b.value[oe]=L,A.value[oe]={data:L,timestamp:Date.now(),attempted:!0}}else A.value[oe]={data:0,timestamp:Date.now(),attempted:!0}}catch(L){console.warn(`Could not load HPP for product ${oe}:`,L),A.value[oe]={data:0,timestamp:Date.now(),attempted:!0}}finally{W.value[oe]=!1}}});await Promise.all(ae),p+s<v.length&&await new Promise(oe=>setTimeout(oe,500))}},me=v=>{if(y(v)){b.value[v]=A.value[v].data;return}g.value.has(v)||(_.value.add(v),ee&&clearTimeout(ee),ee=setTimeout(()=>{X()},os))},fe=()=>{for(const v of K.products){const k=v.id_product||v.id;k&&(y(k)?b.value[k]=A.value[k].data:!g.value.has(k)&&!W.value[k]&&me(k))}},$=v=>{const k=v.id_product||v.id;return b.value[k]||v.cost||0},de=v=>{const k=$(v),s=v.price||0;return s<=0||k<=0?0:Math.round((s-k)/s*100)};Yt(()=>{K.products&&K.products.length>0&&fe()}),tt(()=>{K.products&&K.products.length>0&&fe()}),be({refreshHPPData:async v=>{v?(delete A.value[v],delete b.value[v],g.value.delete(v),K.products.find(s=>(s.id_product||s.id)===v)&&me(v)):(A.value={},b.value={},g.value.clear(),_.value.clear(),fe())}});const O=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Station",key:"station_availability",sortable:!1,width:"150px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],ie=v=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(v),w=v=>new Date(v).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),c=v=>new Date(v).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),x=v=>v<10?"error":v<25?"warning":v<50?"success":"info";return(v,k)=>(f(),R(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",Fo,[e(h,{icon:"tabler-list",class:"coffee-icon"}),k[7]||(k[7]=d(" Data Produk ")),v.totalItems?(f(),R(ue,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[d(r(v.totalItems)+" item ",1)]),_:1})):N("",!0)]),a("div",Eo,[v.selectedProducts.length>0?(f(),R(q,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:k[0]||(k[0]=s=>v.$emit("bulk-delete"))},{default:t(()=>[d(" Hapus Terpilih ("+r(v.selectedProducts.length)+") ",1)]),_:1})):N("",!0),e(q,{"prepend-icon":"tabler-plus",color:"coffee",onClick:k[1]||(k[1]=s=>v.$emit("add-product"))},{default:t(()=>k[8]||(k[8]=[d(" Tambah Produk ")])),_:1,__:[8]})])]),_:1}),e(Ue),e(xa,{"model-value":v.selectedProducts,"onUpdate:modelValue":k[3]||(k[3]=s=>v.$emit("update:selected-products",s)),headers:O,items:v.products,"items-length":v.totalItems,loading:v.loading,"items-per-page":v.itemsPerPage,page:v.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:page":k[4]||(k[4]=s=>v.$emit("update:page",s)),"onUpdate:itemsPerPage":k[5]||(k[5]=s=>v.$emit("update:items-per-page",s)),"onUpdate:sortBy":k[6]||(k[6]=s=>v.$emit("update:sort-by",s))},{loading:t(()=>[e(wa,{type:"table-row@10"})]),"no-data":t(()=>[a("div",Ro,[e(h,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),k[10]||(k[10]=a("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),k[11]||(k[11]=a("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(q,{"prepend-icon":"tabler-plus",color:"coffee",onClick:k[2]||(k[2]=s=>v.$emit("add-product"))},{default:t(()=>k[9]||(k[9]=[d(" Tambah Produk Pertama ")])),_:1,__:[9]})])]),"item.name":t(({item:s})=>[a("div",qo,[e(Se,{image:s.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[s.image_url?N("",!0):(f(),R(h,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),a("div",null,[a("div",Lo,r(s.name),1),a("div",No," SKU: "+r(s.sku||"-"),1)])])]),"item.category":t(({item:s})=>[e(ue,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var p;return[d(r(((p=s.category)==null?void 0:p.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:s})=>[a("div",Oo,[a("div",jo,r(ie(s.price)),1),a("div",Jo,[a("span",null,"HPP: "+r(ie($(s))),1),W.value[s.id_product||s.id]&&$(s)>0?(f(),R(dt,{key:0,indeterminate:"",size:"12",width:"2"})):N("",!0)])])]),"item.profit_margin":t(({item:s})=>[a("div",Wo,[e(ue,{color:x(de(s)),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[d(r(de(s))+"% ",1)]),_:2},1032,["color"])])]),"item.stock":t(({item:s})=>[a("div",Go,[e(ue,{color:s.stock_status==="out_of_stock"?"error":s.stock_status==="low_stock"?"warning":"success",size:"small",variant:"tonal"},{default:t(()=>[d(r(s.stock_status==="out_of_stock"?"Habis":s.stock_status==="low_stock"?"Rendah":"Aman"),1)]),_:2},1032,["color"]),s.min_stock?(f(),Z("div",Qo," Min: "+r(s.min_stock),1)):N("",!0)])]),"item.active":t(({item:s})=>[a("div",Xo,[e(ue,{color:s.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[d(r(s.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),s.featured?(f(),R(Me,{key:0,text:"Produk Unggulan"},{activator:t(({props:p})=>[e(h,we(p,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):N("",!0)])]),"item.station_availability":t(({item:s})=>[a("div",Zo,[s.available_in_kitchen?(f(),R(ue,{key:0,color:"orange",size:"x-small",variant:"tonal"},{default:t(()=>[e(h,{icon:"tabler-tools-kitchen-2",size:"12",class:"me-1"}),k[12]||(k[12]=d(" Kitchen "))]),_:1,__:[12]})):N("",!0),s.available_in_bar?(f(),R(ue,{key:1,color:"purple",size:"x-small",variant:"tonal"},{default:t(()=>[e(h,{icon:"tabler-glass-cocktail",size:"12",class:"me-1"}),k[13]||(k[13]=d(" Bar "))]),_:1,__:[13]})):N("",!0),!s.available_in_kitchen&&!s.available_in_bar?(f(),Z("div",Yo," Tidak Tersedia ")):N("",!0)])]),"item.created_at":t(({item:s})=>[a("div",es,r(w(s.created_at??"")),1),a("div",ts,r(c((s==null?void 0:s.created_at)??"")),1)]),"item.actions":t(({item:s})=>[a("div",as,[e(Me,{text:"Kelola Komposisi"},{activator:t(({props:p})=>[e(q,we(p,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:U=>v.$emit("open-composition-dialog",s)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Kelola Variant"},{activator:t(({props:p})=>[e(q,we(p,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:U=>v.$emit("open-variant-dialog",s)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Edit Produk"},{activator:t(({props:p})=>[e(q,we(p,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:U=>v.$emit("edit-product",s)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:s.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:p})=>{var U;return[e(q,we(p,{icon:s.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:s.active?"success":"error",loading:((U=v.toggleLoading)==null?void 0:U[s.id_product])||!1,onClick:ae=>v.$emit("toggle-active",s)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Me,{text:s.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:p})=>[e(q,we(p,{icon:s.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:s.featured?"warning":"default",onClick:U=>v.$emit("toggle-featured",s)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Me,{text:"Hapus Produk"},{activator:t(({props:p})=>[e(q,we(p,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:U=>v.$emit("delete-product",s)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),is=Oe(ss,[["__scopeId","data-v-bfd91747"]]),ns={class:"d-flex align-center gap-3"},rs={class:"text-h5 font-weight-bold"},us={class:"text-h6"},ds={class:"text-body-1"},cs={class:"d-flex flex-column"},ms={class:"font-weight-medium"},vs={class:"text-caption text-grey-darken-1"},ps={class:"font-weight-medium"},fs={key:0,class:"text-caption"},gs={key:1,class:"text-grey-lighten-1 text-caption"},_s={class:"v-data-table__footer"},ks={class:"pa-4 d-flex justify-space-between align-center"},bs={class:"text-subtitle-1 font-weight-bold"},ys={class:"text-subtitle-2 text-uppercase"},hs={class:"text-h6 font-weight-bold my-2"},xs={class:"text-caption"},Ut=Ee({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup(I,{emit:be}){const K=I,M=be,j=T(!1),b=T(null),W=T(null),A=T(!1),g=T(!1),_=T("latest"),ee=T(0),y=T(0),X=T(""),me=T(0),fe=T(!1),$=T(!1),de=T(""),ce=T(""),O=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],ie=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],w=L=>!L||L===0?"":new Intl.NumberFormat("id-ID").format(L),c=L=>{if(!L)return 0;const D=L.replace(/[^\d]/g,"");return parseInt(D)||0},x=L=>{var m;const D=c(L);if(y.value=D,X.value=w(D),(m=b.value)!=null&&m.total_hpp&&D>0){const l=b.value.total_hpp;ee.value=l>0?Math.round((D-l)/l*100):0}else ee.value=0},v=L=>He(L),k=async(L,D)=>{j.value=!0;try{await new Promise(m=>setTimeout(m,500)),b.value={total_hpp:15e4,method:D,calculated_at:new Date().toISOString(),items:[{item_name:"Tepung Terigu",item_code:"TPNG001",quantity_needed:.5,unit:"kg",cost_per_unit:15e3,total_cost:7500,is_critical:!1,notes:null},{item_name:"Gula Pasir",item_code:"GUL001",quantity_needed:.25,unit:"kg",cost_per_unit:12e3,total_cost:3e3,is_critical:!1,notes:null},{item_name:"Telur Ayam",item_code:"TLR001",quantity_needed:3,unit:"pcs",cost_per_unit:3e3,total_cost:9e3,is_critical:!0,notes:"Price volatile"}]},A.value=!0}catch(m){console.error("Error loading HPP breakdown:",m),A.value=!1}finally{j.value=!1}},s=async(L,D)=>{j.value=!0;try{if(await new Promise(m=>setTimeout(m,1e3)),b.value){switch(D){case"latest":b.value.total_hpp=Math.round(b.value.total_hpp*1.1);break;case"average":b.value.total_hpp=Math.round(b.value.total_hpp*1.05);break;default:b.value.total_hpp=Math.round(b.value.total_hpp*1.03)}b.value.calculated_at=new Date().toISOString()}}catch(m){throw m}finally{j.value=!1}},p=async(L,D,m,l,i)=>{j.value=!0;try{return await new Promise(P=>setTimeout(P,1e3)),{data:{new_price:m,markup_percentage:b.value?Math.round((m-b.value.total_hpp)/b.value.total_hpp*100):0}}}catch(P){throw P}finally{j.value=!1}},U=async()=>{var L,D,m;if(K.variantId)try{const l=localStorage.getItem("token"),i=await qe.get(`/api/variants/${K.variantId}`,{headers:{Authorization:`Bearer ${l}`,Accept:"application/json"}});if(i.data.success&&i.data.data){const P=i.data.data;if(P.price&&P.price>0)y.value=Number(P.price),X.value=w(Number(P.price));else if((L=b.value)!=null&&L.total_hpp){const ge=Math.round(b.value.total_hpp*1.2);y.value=ge,X.value=w(ge)}if((D=b.value)!=null&&D.total_hpp&&y.value>0){const ge=b.value.total_hpp;ee.value=ge>0?Math.round((y.value-ge)/ge*100):0}me.value+=1}}catch(l){console.warn("Could not load target price, using default:",l),(m=b.value)!=null&&m.total_hpp&&(y.value=Math.round(b.value.total_hpp*1.2))}},ae=async()=>{K.variantId&&(await k(K.variantId,_.value),await U())},oe=async()=>{var L,D;if(K.variantId)try{await s(K.variantId,_.value),de.value=`HPP successfully updated using ${_.value} method!`,fe.value=!0,M("hpp-updated"),await ae()}catch(m){console.error("Error updating HPP:",m),ce.value=((D=(L=m==null?void 0:m.response)==null?void 0:L.data)==null?void 0:D.message)||"Failed to update HPP",$.value=!0}},te=async()=>{var L,D,m,l,i,P,ge,J,ke,De;if(K.variantId&&((L=b.value)!=null&&L.total_hpp)&&y.value)try{const se=await p(K.variantId,_.value,y.value,!0,!0);if((D=se==null?void 0:se.data)!=null&&D.new_price){if(y.value=se.data.new_price,X.value=w(se.data.new_price),((m=se==null?void 0:se.data)==null?void 0:m.markup_percentage)!==void 0)ee.value=se.data.markup_percentage;else{const Te=b.value.total_hpp;ee.value=Te>0?Math.round((se.data.new_price-Te)/Te*100):0}me.value+=1,await ft()}K.variantId&&await k(K.variantId,_.value),de.value=`Price successfully updated to ${v(((l=se==null?void 0:se.data)==null?void 0:l.new_price)||y.value)}!`,fe.value=!0,M("price-updated",{variantId:K.variantId,oldPrice:(i=se==null?void 0:se.data)==null?void 0:i.old_price,newPrice:(P=se==null?void 0:se.data)==null?void 0:P.new_price,hpp:(ge=se==null?void 0:se.data)==null?void 0:ge.hpp,markupPercentage:(J=se==null?void 0:se.data)==null?void 0:J.markup_percentage})}catch(se){console.error("Error applying price suggestion:",se),ce.value=((De=(ke=se==null?void 0:se.response)==null?void 0:ke.data)==null?void 0:De.message)||"Failed to update variant price",$.value=!0}};return Ve(()=>K.modelValue,L=>{L&&K.variantId&&ae()}),Ve(()=>K.variantId,L=>{L&&K.modelValue&&ae()}),Ve(_,async()=>{K.variantId&&await ae()}),Ve([()=>{var L;return(L=b.value)==null?void 0:L.total_hpp},y],()=>{var L;if((L=b.value)!=null&&L.total_hpp&&y.value>0){const D=b.value.total_hpp;ee.value=D>0?Math.round((y.value-D)/D*100):0}else ee.value=0}),Ve(y,L=>{L!==c(X.value)&&(X.value=w(L))}),(L,D)=>(f(),Z(ze,null,[e(Le,{"model-value":L.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":D[6]||(D[6]=m=>L.$emit("update:modelValue",m))},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",ns,[e(h,{icon:"mdi-calculator-variant",size:"24"}),a("span",null,"HPP Breakdown - "+r(L.variantName||"Variant"),1)]),e(q,{icon:"mdi-close",size:"small",variant:"text",onClick:D[0]||(D[0]=m=>L.$emit("update:modelValue",!1))})]),_:1}),e(le,null,{default:t(()=>[e(Pe,{class:"mb-4"},{default:t(()=>[e(S,{cols:"12",md:"6"},{default:t(()=>[e(Be,{modelValue:_.value,"onUpdate:modelValue":[D[1]||(D[1]=m=>_.value=m),ae],items:O,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(q,{color:"primary",variant:"elevated",loading:j.value,"prepend-icon":"mdi-update",block:"",onClick:oe},{default:t(()=>[d(" Update HPP with "+r(_.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),A.value?(f(),R(Y,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(le,null,{default:t(()=>[e(Pe,{align:"center"},{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>{var m;return[D[11]||(D[11]=a("div",{class:"text-subtitle-2"}," Total HPP ",-1)),a("div",rs,r(v(((m=b.value)==null?void 0:m.total_hpp)||0)),1)]}),_:1,__:[11]}),e(S,{cols:"12",md:"4"},{default:t(()=>{var m;return[D[12]||(D[12]=a("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),a("div",us,r((m=O.find(l=>{var i;return l.value===((i=b.value)==null?void 0:i.method)}))==null?void 0:m.title),1)]}),_:1,__:[12]}),e(S,{cols:"12",md:"4"},{default:t(()=>{var m;return[D[13]||(D[13]=a("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),a("div",ds,r((m=b.value)!=null&&m.calculated_at?new Date(b.value.calculated_at).toLocaleString():"-"),1)]}),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):N("",!0),A.value?(f(),R(Y,{key:1},{default:t(()=>{var m;return[e(xe,null,{default:t(()=>{var l,i;return[e(h,{icon:"mdi-format-list-bulleted",class:"me-2"}),d(" Item Breakdown ("+r(((i=(l=b.value)==null?void 0:l.items)==null?void 0:i.length)||0)+" items) ",1)]}),_:1}),e(Pa,{headers:ie,items:((m=b.value)==null?void 0:m.items)||[],"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:l})=>[a("div",cs,[a("span",ms,r(l.item_name),1),a("span",vs,r(l.item_code),1)])]),"item.quantity_needed":t(({item:l})=>[a("span",ps,r(l.quantity_needed)+" "+r(l.unit),1)]),"item.cost_per_unit":t(({item:l})=>[a("span",null,r(v(l.cost_per_unit)),1)]),"item.total_cost":t(({item:l})=>[e(ue,{color:l.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[d(r(v(l.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:l})=>[e(ue,{color:l.is_critical?"error":"success","prepend-icon":l.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[d(r(l.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:l})=>[l.notes?(f(),Z("span",fs,r(l.notes),1)):(f(),Z("span",gs,"—"))]),bottom:t(()=>{var l;return[a("div",_s,[e(Ue),a("div",ks,[a("div",bs," Total HPP: "+r(v(((l=b.value)==null?void 0:l.total_hpp)||0)),1),e(ue,{color:"info",variant:"elevated"},{default:t(()=>{var i,P;return[d(r(((P=(i=b.value)==null?void 0:i.items)==null?void 0:P.length)||0)+" items ",1)]}),_:1})])])]}),_:1},8,["items"])]}),_:1})):N("",!0),A.value?(f(),R(Y,{key:2,class:"mt-4"},{default:t(()=>[e(xe,null,{default:t(()=>[e(h,{icon:"mdi-cash-multiple",class:"me-2"}),D[14]||(D[14]=d(" Price Suggestion "))]),_:1,__:[14]}),e(le,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(S,{cols:"12",md:"6"},{default:t(()=>{var m;return[(f(),R(he,{key:me.value,modelValue:X.value,"onUpdate:modelValue":[D[2]||(D[2]=l=>X.value=l),x],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${v(((m=b.value)==null?void 0:m.total_hpp)||0)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>{var m;return[(f(),R(he,{key:me.value,modelValue:ee.value,"onUpdate:modelValue":D[3]||(D[3]=l=>ee.value=l),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${v(y.value-(((m=b.value)==null?void 0:m.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e(Pe,{class:"mt-2"},{default:t(()=>[e(S,{cols:"12",md:"12"},{default:t(()=>[e(q,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:j.value,disabled:!y.value||y.value<=0,block:"",onClick:te},{default:t(()=>D[15]||(D[15]=[d(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):N("",!0),g.value?(f(),R(Y,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(xe,null,{default:t(()=>[e(h,{icon:"mdi-lightbulb",class:"me-2"}),D[16]||(D[16]=d(" Price Suggestions "))]),_:1,__:[16]}),e(le,null,{default:t(()=>[e(Pe,null,{default:t(()=>[(f(!0),Z(ze,null,We(W.value.suggestions,(m,l)=>(f(),R(S,{key:l,cols:"12",md:"4"},{default:t(()=>[e(Y,{variant:"elevated"},{default:t(()=>[e(le,{class:"text-center"},{default:t(()=>[a("div",ys,r(l)+" Method ",1),a("div",hs,r(v(m.suggested_price)),1),a("div",xs,[d(" HPP: "+r(v(m.hpp)),1),D[17]||(D[17]=a("br",null,null,-1)),d(" Markup: "+r(m.markup_percentage.toFixed(1))+"%",1),D[18]||(D[18]=a("br",null,null,-1)),d(" Margin: "+r(m.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):N("",!0),!A.value&&!j.value?(f(),R(Y,{key:4,variant:"outlined"},{default:t(()=>[e(le,{class:"text-center py-8"},{default:t(()=>[e(h,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),D[20]||(D[20]=a("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),D[21]||(D[21]=a("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(q,{color:"primary","prepend-icon":"mdi-plus",onClick:D[4]||(D[4]=m=>L.$emit("update:modelValue",!1))},{default:t(()=>D[19]||(D[19]=[d(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):N("",!0)]),_:1}),e(Fe,{class:"pa-4"},{default:t(()=>[e(Ne),e(q,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:D[5]||(D[5]=m=>L.$emit("update:modelValue",!1))},{default:t(()=>D[22]||(D[22]=[d(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(et,{modelValue:fe.value,"onUpdate:modelValue":D[8]||(D[8]=m=>fe.value=m),color:"success",location:"top"},{actions:t(()=>[e(q,{color:"white",variant:"text",onClick:D[7]||(D[7]=m=>fe.value=!1)},{default:t(()=>D[23]||(D[23]=[d(" Close ")])),_:1,__:[23]})]),default:t(()=>[d(r(de.value)+" ",1)]),_:1},8,["modelValue"]),e(et,{modelValue:$.value,"onUpdate:modelValue":D[10]||(D[10]=m=>$.value=m),color:"error",location:"top"},{actions:t(()=>[e(q,{color:"white",variant:"text",onClick:D[9]||(D[9]=m=>$.value=!1)},{default:t(()=>D[24]||(D[24]=[d(" Close ")])),_:1,__:[24]})]),default:t(()=>[d(r(ce.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),ws={class:"d-flex align-center gap-2"},Ps={class:"pa-4",style:{"background-color":"#2A2A2A"}},Vs={key:0,class:"d-flex align-center gap-3"},Cs={class:"text-h6 text-white font-weight-bold"},$s={class:"d-flex align-center gap-4 mt-1"},Ss={class:"text-caption text-grey-lighten-1"},Is={class:"text-caption text-grey-lighten-1"},Ds={class:"pa-4 add-item-form"},zs={class:"d-flex align-center justify-space-between mb-4"},Us={class:"d-flex align-center gap-2"},Ts={class:"text-h6"},As={key:0,class:"text-error"},Hs={key:1},Ms={class:"d-flex align-center"},Ks={class:"pa-4 text-center"},Bs={class:"pa-4 pt-0"},Fs={class:"d-flex align-center justify-between mb-4"},Es={class:"text-h6"},Rs={key:0,class:"composition-list"},qs={class:"d-flex align-center justify-between"},Ls={class:"d-flex align-center gap-3"},Ns={class:"font-weight-medium"},Os={class:"text-caption text-medium-emphasis"},js={class:"font-weight-medium text-primary"},Js={class:"d-flex align-center gap-2"},Ws={class:"text-center"},Gs={key:0,class:"text-body-2 text-medium-emphasis"},Qs={class:"text-center"},Xs={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},Zs=Ee({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup(I,{emit:be}){const K=I,M=be,j=T(),b=T(!1),W=T(!1),A=T([]),g=T([]),_=T(!1),ee=T(null),y=T(!1),X=T(null),me=T(!1),fe=T(!1),$=T(""),de=T(""),ce=T("success"),O=T(!1),ie=pe({get:()=>K.modelValue,set:n=>{M("update:modelValue",n)}}),w=()=>({item_id:null,quantity:1,is_critical:!1}),c=T(w()),x=pe(()=>!c.value.item_id||!Array.isArray(A.value)?null:A.value.find(n=>n.id_item===c.value.item_id)),v=pe(()=>!x.value||_.value&&ee.value!==null?null:g.value.find(n=>{var o,V;return n.name===((o=x.value)==null?void 0:o.name)||n.id&&((V=x.value)==null?void 0:V.id_item)&&n.id===x.value.id_item})),k=pe(()=>{if(!x.value)return"";if(_.value&&ee.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(v.value){const n=v.value;return`Item sudah ada dengan quantity ${n.quantity} ${n.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${p(x.value)} ${x.value.unit}`}),s=pe(()=>Array.isArray(A.value)?A.value.filter(n=>p(n)>0):[]),p=n=>{var o,V;return((o=n.inventory)==null?void 0:o.current_stock)||((V=n.inventory)==null?void 0:V.available_stock)||n.current_stock||0},U=()=>W.value?"Memuat items...":!A.value||A.value.length===0?"Tidak ada item tersedia":s.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",ae=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),oe=n=>{switch(n){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},te=n=>{switch(n){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},L=(n,o,V)=>{var C,ve,re,ne,Ce,ye,Ie,Re;if(!o)return!0;const B=o.toLowerCase().trim(),F=((ve=(C=V==null?void 0:V.raw)==null?void 0:C.name)==null?void 0:ve.toLowerCase())||"",u=((ne=(re=V==null?void 0:V.raw)==null?void 0:re.item_code)==null?void 0:ne.toLowerCase())||"",H=((ye=(Ce=V==null?void 0:V.raw)==null?void 0:Ce.unit)==null?void 0:ye.toLowerCase())||"",G=((Re=(Ie=V==null?void 0:V.raw)==null?void 0:Ie.description)==null?void 0:Re.toLowerCase())||"";return F.includes(B)||u.includes(B)||H.includes(B)||G.includes(B)},D=async()=>{var n,o,V;W.value=!0;try{const B=await qe.get("/api/items?per_page=all&include=inventory"),F=((o=(n=B.data)==null?void 0:n.data)==null?void 0:o.data)||((V=B.data)==null?void 0:V.data)||B.data||[];A.value=Array.isArray(F)?F:[]}catch(B){console.error("Error loading items:",B),B!=null&&B.response&&(console.error("API Error Status:",B.response.status),console.error("API Error Data:",B.response.data)),A.value=[]}finally{W.value=!1}},m=async()=>{var n,o,V,B,F;if(!(!((n=K.variant)!=null&&n.id)&&!((o=K.variant)!=null&&o.id_variant)))try{const u=K.variant.id||K.variant.id_variant,H=await qe.get(`/api/variant-items/variant/${u}`),G=((B=(V=H.data)==null?void 0:V.data)==null?void 0:B.composition)||((F=H.data)==null?void 0:F.composition)||[];if(!Array.isArray(G)){console.warn("API response composition is not an array:",G),g.value=[];return}g.value=G.map(C=>{var ve,re,ne,Ce,ye,Ie,Re,Xe,it,nt;return{id:C.id_variant_item||C.id,name:((ve=C.item)==null?void 0:ve.name)||C.name,quantity:parseFloat(C.quantity_needed||C.quantity||C.qty||"1"),unit:C.unit||((re=C.item)==null?void 0:re.unit)||"pcs",stock:((Ce=(ne=C.item)==null?void 0:ne.inventory)==null?void 0:Ce.current_stock)||((Ie=(ye=C.item)==null?void 0:ye.inventory)==null?void 0:Ie.available_stock)||((Re=C.item)==null?void 0:Re.current_stock)||C.stock||0,price:parseFloat(((Xe=C.item)==null?void 0:Xe.cost_per_unit)||((it=C.item)==null?void 0:it.price)||C.price||"0"),is_critical:C.is_critical||!1,inventory:(nt=C.item)!=null&&nt.inventory?{current_stock:C.item.inventory.current_stock||0,available_stock:C.item.inventory.available_stock||0,stock_status:C.item.inventory.stock_status||"unknown",reorder_level:C.item.inventory.reorder_level||0}:null}})}catch(u){console.error("Error loading composition items:",u),u!=null&&u.response&&(console.error("API Error Status:",u.response.status),console.error("API Error Data:",u.response.data)),g.value=[]}},l=async()=>{var F,u;const{valid:n}=await j.value.validate();if(!n||!x.value)return;const o=x.value.name,V=x.value.id_item,B=c.value.quantity;if(_.value&&ee.value!==null)g.value[ee.value].quantity,g.value[ee.value].quantity=B,g.value[ee.value].is_critical=c.value.is_critical,_.value=!1,ee.value=null;else{const H=g.value.findIndex(G=>G.name===o||G.id&&V&&G.id===V);if(H!==-1){const ve=g.value[H].quantity+B;g.value[H].quantity=ve}else{const G={name:o,quantity:B,unit:x.value.unit,stock:((F=x.value.inventory)==null?void 0:F.current_stock)||((u=x.value.inventory)==null?void 0:u.available_stock)||x.value.current_stock||0,price:x.value.cost_per_unit||0,is_critical:c.value.is_critical,inventory:x.value.inventory?{current_stock:x.value.inventory.current_stock||0,available_stock:x.value.inventory.available_stock||0,stock_status:x.value.inventory.stock_status||"unknown",reorder_level:x.value.inventory.reorder_level||0}:null};g.value.push(G)}}c.value=w()},i=(n,o)=>{const V=A.value.find(B=>B.name===n.name||B.id_item===n.id);V?(_.value=!0,ee.value=o,c.value={item_id:V.id_item,quantity:n.quantity,is_critical:n.is_critical||!1},setTimeout(()=>{const B=document.querySelector(".add-item-form");B&&B.scrollIntoView({behavior:"smooth",block:"start"})},100)):console.error("❌ Could not find item in available items")},P=()=>{_.value=!1,ee.value=null,c.value=w()},ge=(n,o)=>{X.value={item:n,index:o},y.value=!0},J=async()=>{var B,F,u;if(!X.value)return;const{item:n,index:o}=X.value;n.name;const V=n.id;me.value=!0;try{V&&await qe.delete(`/api/variant-items/${V}`),y.value=!1,X.value=null,await m(),M("save")}catch(H){console.error("❌ Error deleting item:",H),console.error("❌ Error details:",(B=H.response)==null?void 0:B.data),alert("Gagal menghapus item: "+(((u=(F=H.response)==null?void 0:F.data)==null?void 0:u.message)||H.message))}finally{me.value=!1}},ke=()=>{y.value=!1,X.value=null},De=()=>{switch(ce.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},se=()=>{switch(ce.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Te=()=>{switch(ce.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},Ae=()=>{switch(ce.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Qe=async()=>{var n,o,V,B;if(!((n=K.variant)!=null&&n.id)&&!((o=K.variant)!=null&&o.id_variant)){console.error("No variant ID found");return}b.value=!0;try{const F=K.variant.id||K.variant.id_variant;if(g.value.some(H=>H.id)){const H={items:g.value.map(C=>{const ve=A.value.find(re=>re.name===C.name);return{id_variant_item:C.id,quantity_needed:Number(C.quantity),unit:C.unit,is_critical:C.is_critical||!1}}).filter(C=>C.id_variant_item&&C.quantity_needed>0)},G=await qe.post("/api/variant-items/bulk-update",H)}else{const H={id_variant:F,items:g.value.map(C=>{const ve=A.value.find(re=>re.name===C.name);return{id_item:ve==null?void 0:ve.id_item,quantity_needed:Number(C.quantity),unit:C.unit,is_critical:C.is_critical||!1}}).filter(C=>C.id_item&&C.quantity_needed>0)},G=await qe.post("/api/variant-items/bulk-store",H)}M("save"),z()}catch(F){console.error("Error saving composition:",F),alert("Gagal menyimpan komposisi: "+(((B=(V=F.response)==null?void 0:V.data)==null?void 0:B.message)||F.message))}finally{b.value=!1}},je=()=>{O.value=!0},z=()=>{ie.value=!1,c.value=w(),g.value=[],_.value=!1,ee.value=null};return Ve(()=>K.modelValue,n=>{n?(c.value=w(),D(),m()):(_.value=!1,ee.value=null)}),Ve(()=>c.value.item_id,n=>{n&&x.value}),tt(()=>{D()}),(n,o)=>{var V,B,F;return f(),Z(ze,null,[e(Le,{modelValue:ie.value,"onUpdate:modelValue":o[3]||(o[3]=u=>ie.value=u),"max-width":"1000px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[a("div",ws,[e(h,{icon:"mdi-delete",color:"white"}),o[9]||(o[9]=a("span",null,"Kelola Komposisi Item",-1))]),e(q,{icon:"mdi-close",variant:"text",color:"white",onClick:z,disabled:b.value},null,8,["disabled"])]),_:1}),e(le,{class:"pa-0"},{default:t(()=>[a("div",Ps,[n.variant?(f(),Z("div",Vs,[e(h,{icon:"mdi-coffee",size:"32",color:"white"}),a("div",null,[a("h3",Cs,r(n.variant.name),1),a("div",$s,[a("span",Ss,"SKU: "+r(n.variant.sku),1),a("span",Is,"Harga: "+r(ae(n.variant.price||0)),1),e(ue,{color:"success",size:"small",variant:"tonal"},{default:t(()=>o[10]||(o[10]=[d(" Stok Aman ")])),_:1,__:[10]})])])])):N("",!0)]),a("div",Ds,[a("div",zs,[a("div",Us,[e(h,{icon:"mdi-plus-circle",color:"success"}),a("h4",Ts,r(_.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(yt,{ref_key:"form",ref:j,onSubmit:kt(l,["prevent"])},{default:t(()=>[e(Pe,null,{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>[e(bt,{modelValue:c.value.item_id,"onUpdate:modelValue":o[0]||(o[0]=u=>c.value.item_id=u),items:s.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[u=>!!u||"Item wajib dipilih"],loading:W.value,disabled:W.value||A.value&&A.value.length===0,"no-data-text":U(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":L},{"prepend-inner":t(()=>[e(h,{icon:"mdi-package",size:"16"})]),item:t(({props:u,item:H})=>[e(Je,we(u,{title:H.raw.name,disabled:p(H.raw)<=0,class:["pa-3",{"text-disabled":p(H.raw)<=0}]}),{prepend:t(()=>[e(h,{icon:"mdi-package-variant",color:p(H.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[a("div",{class:Ge(["text-caption",p(H.raw)<=0?"text-disabled":"text-medium-emphasis"])},[p(H.raw)<=0?(f(),Z("span",As,[e(h,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),o[11]||(o[11]=d(" Stok Habis "))])):(f(),Z("span",Hs," Stok: "+r(p(H.raw))+" "+r(H.raw.unit),1))],2)]),append:t(()=>{var G;return[p(H.raw)>0?(f(),R(ue,{key:0,size:"x-small",color:oe(((G=H.raw.inventory)==null?void 0:G.stock_status)||H.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var C;return[d(r(te(((C=H.raw.inventory)==null?void 0:C.stock_status)||H.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(f(),R(ue,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>o[12]||(o[12]=[d(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:u})=>[a("div",Ms,[e(h,{icon:"mdi-package-variant",size:"16",class:"me-2"}),a("span",null,r(u.raw.name),1)])]),"no-data":t(()=>[a("div",Ks,[e(h,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),o[13]||(o[13]=a("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),o[14]||(o[14]=a("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(he,{modelValue:c.value.quantity,"onUpdate:modelValue":o[1]||(o[1]=u=>c.value.quantity=u),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[u=>!!u||"Jumlah wajib diisi",u=>u>0||"Jumlah harus lebih dari 0"],hint:k.value,"persistent-hint":"",color:v.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>{var u;return[e(he,{"model-value":((u=x.value)==null?void 0:u.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!x.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e(h,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e(S,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(Ze,{modelValue:c.value.is_critical,"onUpdate:modelValue":o[2]||(o[2]=u=>c.value.is_critical=u),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(q,{color:_.value?"primary":v.value?"warning":"#D4A574",onClick:l,loading:b.value,disabled:!c.value.item_id||!c.value.quantity,block:""},{default:t(()=>[e(h,{icon:_.value?"mdi-content-save":v.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),d(" "+r(_.value?"Update":v.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),_.value?(f(),R(q,{key:0,color:"grey",variant:"outlined",onClick:P,size:"small",block:""},{default:t(()=>[e(h,{icon:"mdi-close",class:"me-1"}),o[15]||(o[15]=d(" Batal "))]),_:1,__:[15]})):N("",!0)]),_:1})]),_:1})]),_:1},512)]),a("div",Bs,[a("div",Fs,[a("h4",Es,"Daftar Item Komposisi ("+r(g.value.length)+")",1)]),g.value.length>0?(f(),Z("div",Rs,[(f(!0),Z(ze,null,We(g.value,(u,H)=>(f(),R(Y,{key:H,variant:"outlined",class:"mb-3"},{default:t(()=>[e(le,{class:"pa-3"},{default:t(()=>{var G,C,ve,re,ne,Ce,ye;return[a("div",qs,[a("div",Ls,[e(h,{icon:"mdi-check-circle",color:"success"}),a("div",null,[a("div",Ns,r(u.name),1),a("div",Os,[a("span",js,"Dibutuhkan: "+r(u.quantity)+" "+r(u.unit),1),o[16]||(o[16]=d(" • ")),a("span",{class:Ge({"text-success":(((G=u.inventory)==null?void 0:G.current_stock)??0)>(((C=u.inventory)==null?void 0:C.reorder_level)??0),"text-warning":(((ve=u.inventory)==null?void 0:ve.current_stock)??0)<=(((re=u.inventory)==null?void 0:re.reorder_level)??0)&&(((ne=u.inventory)==null?void 0:ne.current_stock)??0)>0,"text-error":(((Ce=u.inventory)==null?void 0:Ce.current_stock)??0)<=0})}," Stok: "+r(((ye=u.inventory)==null?void 0:ye.current_stock)||u.stock||0)+" "+r(u.unit),3),d(" • "+r(ae(u.price)),1)])])]),a("div",Js,[e(q,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:Ie=>i(u,H)},null,8,["onClick"]),e(q,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Ie=>ge(u,H)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(f(),R(Y,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e(h,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),o[17]||(o[17]=a("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(Fe,{class:"px-6 pb-6"},{default:t(()=>[e(q,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:je},{default:t(()=>o[18]||(o[18]=[d(" Setting HPP ")])),_:1,__:[18]}),e(Ne),e(q,{variant:"outlined",onClick:z,disabled:b.value},{default:t(()=>o[19]||(o[19]=[d(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(q,{color:"#D4A574",onClick:Qe,loading:b.value,disabled:g.value.length===0},{default:t(()=>o[20]||(o[20]=[d(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ut,{modelValue:O.value,"onUpdate:modelValue":o[4]||(o[4]=u=>O.value=u),"variant-id":((V=n.variant)==null?void 0:V.id)||((B=n.variant)==null?void 0:B.id_variant),"variant-name":(F=n.variant)==null?void 0:F.name,onHppUpdated:o[5]||(o[5]=u=>M("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Le,{modelValue:y.value,"onUpdate:modelValue":o[6]||(o[6]=u=>y.value=u),"max-width":"400px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e(h,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),o[21]||(o[21]=d(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(Ue),e(le,{class:"pa-6"},{default:t(()=>[a("div",Ws,[e(h,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),o[24]||(o[24]=a("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),X.value?(f(),Z("div",Gs,[a("strong",null,r(X.value.item.name),1),o[22]||(o[22]=a("br",null,null,-1)),d(" Dibutuhkan: "+r(X.value.item.quantity)+" "+r(X.value.item.unit),1)])):N("",!0),e(Ke,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>o[23]||(o[23]=[a("strong",null,"Perhatian:",-1),d(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(Fe,{class:"px-6 pb-6"},{default:t(()=>[e(q,{variant:"outlined",onClick:ke,disabled:me.value,class:"flex-grow-1"},{default:t(()=>o[25]||(o[25]=[d(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(q,{color:"error",onClick:J,loading:me.value,class:"flex-grow-1"},{default:t(()=>o[26]||(o[26]=[d(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Le,{modelValue:fe.value,"onUpdate:modelValue":o[8]||(o[8]=u=>fe.value=u),"max-width":"450px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:Ge(["d-flex align-center justify-center text-h6",Te()])},{default:t(()=>[e(h,{icon:De(),color:se(),class:"me-2",size:"24"},null,8,["icon","color"]),d(" "+r(de.value),1)]),_:1},8,["class"]),e(Ue),e(le,{class:"pa-6"},{default:t(()=>[a("div",Qs,[e(h,{icon:De(),color:se(),size:"64",class:"mb-4"},null,8,["icon","color"]),a("div",Xs,r($.value),1),e(Ke,{type:ce.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[ce.value==="success"?(f(),Z(ze,{key:0},[o[27]||(o[27]=a("strong",null,"Berhasil!",-1)),o[28]||(o[28]=d(" Perubahan telah disimpan. "))],64)):ce.value==="info"?(f(),Z(ze,{key:1},[o[29]||(o[29]=a("strong",null,"Informasi:",-1)),o[30]||(o[30]=d(" Item telah diperbarui sesuai permintaan. "))],64)):(f(),Z(ze,{key:2},[o[31]||(o[31]=a("strong",null,"Perhatian:",-1)),o[32]||(o[32]=d(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(Fe,{class:"px-6 pb-6"},{default:t(()=>[e(Ne),e(q,{color:Ae(),onClick:o[7]||(o[7]=u=>fe.value=!1),class:"px-6"},{default:t(()=>[e(h,{icon:"mdi-check",class:"me-1"}),o[33]||(o[33]=d(" OK "))]),_:1,__:[33]},8,["color"]),e(Ne)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Ys=Oe(Zs,[["__scopeId","data-v-d2ce0c17"]]),ei={class:"d-flex align-center gap-2"},ti={class:"mt-2"},ai={key:0,class:"mt-1 font-weight-medium"},li={key:1,class:"mt-1 text-warning"},oi=Ee({__name:"CreateVariantDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save"],setup(I,{emit:be}){const K=I,M=be,j=T(),b=T(!1),W=T(!1),A=T([]),g=T({name:"",selectedProduct:null,selectedProductId:null,active:!0}),_=[w=>!!w||"Nama variant wajib diisi",w=>w.length>=3||"Nama variant minimal 3 karakter"],ee=[w=>!!w||"Produk wajib dipilih"],y=(w,c="success")=>{const x=document.createElement("div");x.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${c==="success"?"#4CAF50":"#f44336"};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 9999;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
  `;const v=document.createElement("span");if(v.innerHTML=c==="success"?"✓":"✕",v.style.cssText=`
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    font-weight: bold;
  `,x.appendChild(v),x.appendChild(document.createTextNode(w)),!document.querySelector("#snackbar-styles")){const k=document.createElement("style");k.id="snackbar-styles",k.textContent=`
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `,document.head.appendChild(k)}document.body.appendChild(x),setTimeout(()=>{x.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{x.parentNode&&x.parentNode.removeChild(x)},300)},3e3)},X=async()=>{W.value=!0;try{const w=await qe.get("/api/products");A.value=w.data.data||w.data||[]}catch(w){console.error("Gagal mengambil data produk:",w),A.value=[]}finally{W.value=!1}},me=w=>{!w&&A.value.length===0&&X()},fe=w=>{g.value.selectedProduct=w,w?g.value.selectedProductId=w.id:g.value.selectedProductId=null},$=pe(()=>g.value.selectedProduct?g.value.selectedProduct:g.value.selectedProductId&&A.value.length>0?A.value.find(c=>c.id===g.value.selectedProductId):null),de=()=>{const w=$.value;if(!w||!g.value.name)return"";const c=w.sku||"PROD",x=g.value.name.replace(/\s+/g,"").toUpperCase().substring(0,3),v=Date.now().toString().slice(-4);return`${c}-${x}-${v}`},ce=async()=>{var x,v;if(b.value)return;const{valid:w}=await j.value.validate();if(!w)return;const c=$.value;if(!c){y("Produk tidak ditemukan","error");return}if(!c.id&&!c.id_product){y("ID Produk tidak valid","error"),console.error("Product missing ID:",c);return}b.value=!0;try{const k={id_product:c.id||c.id_product,name:g.value.name,sku:de(),price:0,cost_price:null,barcode:null,variant_values:[],active:g.value.active},s=await qe.post("/api/variants",k);if(s.data.success!==!1&&(s.status===200||s.status===201))y("Variant berhasil dibuat!","success"),M("save"),ie();else throw new Error(s.data.message||"Gagal membuat variant")}catch(k){const s=((v=(x=k.response)==null?void 0:x.data)==null?void 0:v.message)||k.message||"Gagal membuat variant";y(s,"error"),console.error("Save variant error:",k)}finally{b.value=!1}},O=()=>{var w;g.value={name:"",selectedProduct:null,selectedProductId:null,active:!0},(w=j.value)==null||w.resetValidation()},ie=()=>{M("update:modelValue",!1),O()};return Ve(()=>K.modelValue,w=>{w&&(O(),X())}),(w,c)=>(f(),R(Le,{"model-value":w.modelValue,"onUpdate:modelValue":c[3]||(c[3]=x=>w.$emit("update:modelValue",x)),"max-width":"600px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"bg-primary text-white"},{default:t(()=>[e(h,{icon:"mdi-plus-circle",class:"me-2"}),c[4]||(c[4]=d(" Tambah Variant Baru ")),e(Ne),e(q,{icon:"mdi-close",variant:"text",color:"white",onClick:ie})]),_:1,__:[4]}),e(yt,{ref_key:"formRef",ref:j,onSubmit:kt(ce,["prevent"])},{default:t(()=>[e(le,{class:"pa-6"},{default:t(()=>[e(Pe,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(bt,{modelValue:g.value.selectedProduct,"onUpdate:modelValue":[c[0]||(c[0]=x=>g.value.selectedProduct=x),fe],items:A.value,loading:W.value,"item-title":"name","return-object":"",label:"Pilih Produk *",placeholder:"Cari produk...",variant:"outlined",rules:ee,required:"","no-data-text":"Tidak ada produk ditemukan","onUpdate:search":me},{item:t(({props:x,item:v})=>[e(Je,ea(ta(x)),{prepend:t(()=>[e(Se,{image:v.raw.image_url,size:"40"},{default:t(()=>[v.raw.image_url?N("",!0):(f(),R(h,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"])]),default:t(()=>[e(Ye,null,{default:t(()=>[d(r(v.raw.name),1)]),_:2},1024),e(st,null,{default:t(()=>[d("SKU: "+r(v.raw.sku||"-"),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:x})=>[a("div",ei,[e(Se,{image:x.raw.image_url,size:"24"},{default:t(()=>[x.raw.image_url?N("",!0):(f(),R(h,{key:0,icon:"mdi-coffee",size:"16"}))]),_:2},1032,["image"]),a("span",null,r(x.raw.name),1)])]),_:1},8,["modelValue","items","loading"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(he,{modelValue:g.value.name,"onUpdate:modelValue":c[1]||(c[1]=x=>g.value.name=x),label:"Nama Variant *",placeholder:"Contoh: Large Hot, Medium Cold, dll",variant:"outlined",rules:_,required:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(Ke,{color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ut,null,{default:t(()=>[e(h,{icon:"mdi-information",class:"me-2"}),c[5]||(c[5]=d(" SKU Otomatis "))]),_:1,__:[5]}),a("div",ti,[c[6]||(c[6]=d(" SKU variant akan dibuat otomatis berdasarkan nama produk dan variant ")),g.value.name&&(g.value.selectedProduct||g.value.selectedProductId)?(f(),Z("div",ai," Preview SKU: "+r(de()),1)):g.value.name&&!g.value.selectedProduct&&!g.value.selectedProductId?(f(),Z("div",li," Pilih produk terlebih dahulu untuk melihat preview SKU ")):N("",!0)])]),_:1})]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(Ze,{modelValue:g.value.active,"onUpdate:modelValue":c[2]||(c[2]=x=>g.value.active=x),label:"Variant Aktif",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Ue),e(Fe,{class:"pa-6"},{default:t(()=>[e(Ne),e(q,{variant:"outlined",onClick:ie,disabled:b.value},{default:t(()=>c[7]||(c[7]=[d(" Batal ")])),_:1,__:[7]},8,["disabled"]),e(q,{type:"submit",color:"primary",loading:b.value},{default:t(()=>c[8]||(c[8]=[d(" Simpan Variant ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),si=Oe(oi,[["__scopeId","data-v-5477c365"]]),ii={class:"product-variant-tab"},ni={class:"d-flex gap-2"},ri={key:0,class:"mt-4 d-flex align-center gap-2"},ui={key:1,class:"text-center pa-12"},di={key:2,class:"text-center pa-12"},ci={class:"d-flex align-center gap-3"},mi={class:"flex-grow-1 min-width-0"},vi={class:"text-h6 font-weight-bold text-truncate"},pi={class:"text-body-2 text-medium-emphasis mb-0"},fi={class:"d-flex flex-column gap-1"},gi={class:"text-xs"},_i={class:"d-flex align-center gap-2"},ki={class:"text-primary font-weight-medium"},bi={class:"d-flex gap-1"},yi={class:"d-flex align-center justify-space-between w-100"},hi={class:"d-flex gap-1"},xi=Ee({__name:"ProductVariantTab",props:{loading:{type:Boolean}},emits:["refresh"],setup(I,{emit:be}){const K=be,M=T(!1),j=T([]),b=T(!1),W=T(!1),A=T(null),g=T(!1),_=T(!1),ee=T(!1),y=T({search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}),X=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],me=[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Variant Terbanyak",value:"variants_desc"},{title:"Variant Tersedikit",value:"variants_asc"}],fe=pe(()=>!!(y.value.search||y.value.stockStatus||y.value.activeStatus!==null||y.value.sortBy!=="name_asc")),$=pe(()=>{const m={};return j.value.forEach(l=>{const i=l.id_product;m[i]||(m[i]={product:l.product||{id:l.id_product,id_product:l.id_product,name:`Product ${l.id_product}`,sku:""},variants:[]}),m[i].variants.push(l)}),Object.values(m)}),de=pe(()=>{let m=[...$.value];if(y.value.search){const l=y.value.search.toLowerCase();m=m.filter(i=>{var P;return i.product.name.toLowerCase().includes(l)||((P=i.product.sku)==null?void 0:P.toLowerCase().includes(l))||i.variants.some(ge=>ge.name.toLowerCase().includes(l)||ge.sku.toLowerCase().includes(l))})}switch(y.value.stockStatus&&(m=m.filter(l=>l.variants.some(i=>{var ge;return(((ge=i.composition_summary)==null?void 0:ge.stock_status)||"safe")===y.value.stockStatus}))),y.value.activeStatus!==null&&(m=m.filter(l=>l.variants.some(i=>i.is_active===y.value.activeStatus))),y.value.sortBy){case"name_asc":m.sort((l,i)=>l.product.name.localeCompare(i.product.name));break;case"name_desc":m.sort((l,i)=>i.product.name.localeCompare(l.product.name));break;case"variants_desc":m.sort((l,i)=>i.variants.length-l.variants.length);break;case"variants_asc":m.sort((l,i)=>l.variants.length-i.variants.length);break}return m}),ce=(m,l="success")=>{},O=async m=>{try{const l=j.value.findIndex(i=>i.id_variant===m.variantId);l!==-1&&(j.value[l]={...j.value[l],price:m.newPrice,cost:m.hpp}),ce(`Price updated to ${new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(m.newPrice)}`,"success")}catch(l){console.error("Error handling price update:",l),await ie()}},ie=async()=>{var m,l,i;M.value=!0;try{const P=await qe.get("/api/variants",{params:{per_page:1e3,with_product:!0,with_composition:!0}});if(P.data.success===!1)throw new Error(P.data.message||"Failed to load variants");const ge=((m=P.data.data)==null?void 0:m.data)||P.data.data||[];j.value=ge.map(J=>({...J,is_active:J.active!==void 0?J.active:J.is_active,id:J.id_variant||J.id,id_product:J.id_product||J.product_id}))}catch(P){(i=(l=P.response)==null?void 0:l.data)!=null&&i.message||P.message,j.value=[]}finally{M.value=!1}},w=m=>{A.value=m,g.value=!0},c=m=>{m&&(A.value=m,_.value=!0)},x=m=>{A.value=m,b.value=!0},v=()=>{ee.value=!0},k=async()=>{var m,l;if(A.value)try{W.value=!0,await qe.delete(`/api/variants/${A.value.id_variant}`),ce("Variant berhasil dihapus","success"),await ie(),b.value=!1}catch(i){(l=(m=i.response)==null?void 0:m.data)!=null&&l.message}finally{W.value=!1}},s=m=>{switch(m){case"critical":return"error";case"out":return"error";case"safe":return"success";default:return"primary"}},p=m=>{switch(m){case"critical":return"Kritis";case"out":return"Habis";case"safe":return"Aman";default:return"Normal"}},U=m=>{const l=m.filter(i=>i.is_active).length;return l===0?"error":l===m.length?"success":"warning"},ae=m=>m.some(l=>{var P;const i=(P=l.composition_summary)==null?void 0:P.stock_status;return i==="critical"||i==="out"}),oe=m=>{const l=m.filter(P=>P.is_active).length,i=m.filter(P=>{var J;const ge=(J=P.composition_summary)==null?void 0:J.stock_status;return ge==="critical"||ge==="out"}).length;return i>0?{text:`${i} Stok Kritis`,color:"error",icon:"mdi-alert-circle"}:l===m.length?{text:"Semua Aktif",color:"success",icon:"mdi-check-circle"}:l===0?{text:"Semua Nonaktif",color:"error",icon:"mdi-close-circle"}:{text:`${l}/${m.length} Aktif`,color:"warning",icon:"mdi-minus-circle"}},te=()=>{y.value={search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}},L=()=>{ie(),K("refresh")},D=()=>{ie(),K("refresh")};return tt(()=>{ie()}),(m,l)=>{var i,P,ge;return f(),Z("div",ii,[e(Y,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l[14]||(l[14]=a("div",null,[a("h2",{class:"text-h5 font-weight-bold"},"Variant Produk"),a("p",{class:"text-body-2 text-medium-emphasis"}," Kelola variant dan komposisi untuk produk Anda ")],-1)),a("div",ni,[e(q,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:ie,loading:M.value},{default:t(()=>l[12]||(l[12]=[d(" Refresh ")])),_:1,__:[12]},8,["loading"]),e(q,{color:"primary","prepend-icon":"mdi-plus",onClick:v},{default:t(()=>l[13]||(l[13]=[d(" Tambah Variant ")])),_:1,__:[13]})])]),_:1,__:[14]})]),_:1}),e(Y,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(le,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(S,{cols:"12",md:"3"},{default:t(()=>[e(he,{modelValue:y.value.search,"onUpdate:modelValue":l[0]||(l[0]=J=>y.value.search=J),label:"Cari Variant",placeholder:"Nama variant, SKU, atau produk...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:y.value.stockStatus,"onUpdate:modelValue":l[1]||(l[1]=J=>y.value.stockStatus=J),items:X,label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:y.value.activeStatus,"onUpdate:modelValue":l[2]||(l[2]=J=>y.value.activeStatus=J),items:[{title:"Semua Status",value:null},{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Status Aktif",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:y.value.sortBy,"onUpdate:modelValue":l[3]||(l[3]=J=>y.value.sortBy=J),items:me,label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),fe.value?(f(),Z("div",ri,[l[16]||(l[16]=a("span",{class:"text-body-2"},"Filter aktif:",-1)),y.value.search?(f(),R(ue,{key:0,size:"small",closable:"","onClick:close":l[4]||(l[4]=J=>y.value.search="")},{default:t(()=>[d(" Pencarian: "+r(y.value.search),1)]),_:1})):N("",!0),y.value.stockStatus?(f(),R(ue,{key:1,size:"small",closable:"","onClick:close":l[5]||(l[5]=J=>y.value.stockStatus="")},{default:t(()=>{var J;return[d(" Stok: "+r((J=X.find(ke=>ke.value===y.value.stockStatus))==null?void 0:J.title),1)]}),_:1})):N("",!0),y.value.activeStatus!==null?(f(),R(ue,{key:2,size:"small",closable:"","onClick:close":l[6]||(l[6]=J=>y.value.activeStatus=null)},{default:t(()=>[d(" Status: "+r(y.value.activeStatus?"Aktif":"Nonaktif"),1)]),_:1})):N("",!0),e(q,{variant:"text",size:"small",color:"error",onClick:te},{default:t(()=>l[15]||(l[15]=[d(" Hapus Semua Filter ")])),_:1,__:[15]})])):N("",!0)]),_:1})]),_:1}),!M.value&&de.value.length===0&&fe.value?(f(),R(Ke,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada variant yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):N("",!0),M.value?(f(),Z("div",ui,[e(dt,{color:"primary",indeterminate:"",size:"64"}),l[17]||(l[17]=a("div",{class:"mt-4 text-h6"},"Memuat variant...",-1))])):$.value.length===0?(f(),Z("div",di,[e(h,{icon:"mdi-tune-variant",size:"96",class:"text-disabled mb-6"}),l[19]||(l[19]=a("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Variant Produk",-1)),l[20]||(l[20]=a("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat variant untuk produk Anda agar dapat menawarkan pilihan yang beragam ",-1)),e(q,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:v},{default:t(()=>l[18]||(l[18]=[d(" Buat Variant Pertama ")])),_:1,__:[18]})])):(f(),R(Pe,{key:3},{default:t(()=>[(f(!0),Z(ze,null,We(de.value,J=>(f(),R(S,{key:J.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(Y,{class:Ge(["variant-group-card h-100",{"border-error":ae(J.variants)}]),elevation:"2"},{default:t(()=>[e(xe,{class:"pa-4 pb-2"},{default:t(()=>[a("div",ci,[e(Se,{image:J.product.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[J.product.image_url?N("",!0):(f(),R(h,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),a("div",mi,[a("h3",vi,r(J.product.name),1),a("p",pi," SKU: "+r(J.product.sku||"-"),1)]),e(ue,{color:U(J.variants),size:"small",variant:"tonal"},{default:t(()=>[d(r(J.variants.length)+" Variant ",1)]),_:2},1032,["color"])])]),_:2},1024),e(Ue),e(le,{class:"pa-4"},{default:t(()=>[e(ct,{class:"pa-0"},{default:t(()=>[(f(!0),Z(ze,null,We(J.variants,(ke,De)=>(f(),R(Je,{key:ke.id_variant,class:Ge(["pa-2 rounded-lg variant-item",{"mb-2":De<J.variants.length-1}])},{prepend:t(()=>[e(Se,{size:"32",color:ke.is_active?"success":"error",variant:"tonal"},{default:t(()=>[e(h,{icon:ke.is_active?"mdi-check":"mdi-close",size:"16"},null,8,["icon"])]),_:2},1032,["color"])]),append:t(()=>[a("div",bi,[e(Me,{text:"Kelola Komposisi"},{activator:t(({props:se})=>[e(q,we({ref_for:!0},se,{icon:"mdi-chef-hat",size:"small",variant:"text",color:"primary",onClick:Te=>w(ke)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Hapus Variant"},{activator:t(({props:se})=>[e(q,we({ref_for:!0},se,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Te=>x(ke)}),null,16,["onClick"])]),_:2},1024)])]),default:t(()=>[e(Ye,{class:"text-sm font-weight-medium"},{default:t(()=>[d(r(ke.name),1)]),_:2},1024),e(st,null,{default:t(()=>[a("div",fi,[a("span",gi,"SKU: "+r(ke.sku),1),a("div",_i,[a("span",ki,r(E(He)(ke.price||0)),1),ke.composition_summary?(f(),R(ue,{key:0,color:s(ke.composition_summary.stock_status),size:"x-small",variant:"tonal"},{default:t(()=>[d(r(p(ke.composition_summary.stock_status)),1)]),_:2},1032,["color"])):N("",!0)])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:2},1024)]),_:2},1024),e(Ue),e(Fe,{class:"pa-4"},{default:t(()=>[a("div",yi,[a("div",null,[e(ue,{color:oe(J.variants).color,size:"small",variant:"tonal"},{default:t(()=>[e(h,{icon:oe(J.variants).icon,size:"14",class:"me-1"},null,8,["icon"]),d(" "+r(oe(J.variants).text),1)]),_:2},1032,["color"])]),a("div",hi,[e(Me,{text:"Setting HPP Produk"},{activator:t(({props:ke})=>[e(q,we({ref_for:!0},ke,{icon:"mdi-calculator-variant",size:"small",variant:"text",color:"warning",onClick:De=>c(J.variants[0])}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Tambah Variant"},{activator:t(({props:ke})=>[e(q,we({ref_for:!0},ke,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:v}),null,16)]),_:1}),e(Me,{text:"Pengaturan Produk (Coming Soon)"},{activator:t(({props:ke})=>[e(q,we({ref_for:!0},ke,{icon:"mdi-cog",size:"small",variant:"text",color:"secondary",disabled:""}),null,16)]),_:1})])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(Ys,{modelValue:g.value,"onUpdate:modelValue":l[7]||(l[7]=J=>g.value=J),variant:A.value,onSave:L},null,8,["modelValue","variant"]),e(Ut,{modelValue:_.value,"onUpdate:modelValue":l[8]||(l[8]=J=>_.value=J),"variant-id":(i=A.value)==null?void 0:i.id_variant,"variant-name":(P=A.value)==null?void 0:P.name,onHppUpdated:ie,onPriceUpdated:O},null,8,["modelValue","variant-id","variant-name"]),e(si,{modelValue:ee.value,"onUpdate:modelValue":l[9]||(l[9]=J=>ee.value=J),onSave:D},null,8,["modelValue"]),e(St,{modelValue:b.value,"onUpdate:modelValue":l[10]||(l[10]=J=>b.value=J),title:"Konfirmasi Hapus Variant","item-name":(ge=A.value)==null?void 0:ge.name,loading:W.value,"confirm-text":"Hapus Variant",onConfirm:k,onCancel:l[11]||(l[11]=J=>b.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),$t=Oe(xi,[["__scopeId","data-v-22b81d4b"]]),wi={class:"product-management"},Pi={class:"d-flex justify-space-between align-center mb-6"},Vi={class:"d-flex gap-3 align-center"},Ci={key:0,class:"d-flex gap-2"},$i={class:"d-flex align-center"},Si=Ee({__name:"products-management",setup(I){It();const{productsList:be,categories:K,loading:M,saveLoading:j,deleteLoading:b,toggleLoading:W,stats:A,dialog:g,deleteDialog:_,editMode:ee,selectedProduct:y,selectedProducts:X,currentPage:me,totalItems:fe,itemsPerPage:$,filters:de,errorMessage:ce,successMessage:O,modalErrorMessage:ie,formData:w,selectedImage:c,imagePreview:x,canCreateEdit:v,hasSelectedProducts:k,fetchProductsList:s,fetchCategories:p,fetchStats:U,saveProduct:ae,deleteProduct:oe,bulkDeleteProducts:te,toggleActiveStatus:L,toggleFeaturedStatus:D,openCreateDialog:m,openEditDialog:l,openDeleteDialog:i,closeDialog:P,handleImageUpload:ge,clearModalError:J,onPageChange:ke}=Dt(),{dialog:De,editMode:se,formData:Te,availableItems:Ae,saveLoading:Qe,modalErrorMessage:je,openCreateDialog:z,closeDialog:n,saveRecipe:o,clearModalError:V,fetchAvailableItems:B}=da(),{productItemsList:F,loading:u,fetchProductItemsForComposition:H}=Mt(),G=T("products"),C=T(),ve=T(!1),re=T(null),ne=T(!1),Ce=T(null),ye=async()=>{await oe()},Ie=async()=>{await te()},Re=$e=>{const Q=$e.id_product||$e.id;z(Q)},Xe=async $e=>{re.value=$e;try{await H({page:1,per_page:50,critical_only:!1})}catch{}ve.value=!0},it=$e=>{Ce.value=$e,ne.value=!0},nt=$e=>{if(!$e)return[];const Q=$e.id_product||$e.id;return F.value.filter(at=>{var _e;return((_e=at.product)==null?void 0:_e.id_product)===Q||at.product_id===Q})||[]},ht=async()=>{if(await H({page:1,per_page:50,critical_only:!1}),await s(),re.value&&C.value){const $e=re.value.id_product||re.value.id;await C.value.refreshHPPData($e)}},Tt=$e=>{Object.assign(de,$e),s()},At=$e=>{console.log("Search query received:",$e),de.search=$e,console.log("Filters after search update:",de),s()},Ht=()=>{c.value=null,x.value&&(x.value="")};return Ve(G,async $e=>{$e==="compositions"&&await H({page:1,per_page:15,critical_only:!1})},{immediate:!1}),tt(()=>{s(),p(),U(),B()}),($e,Q)=>{var at;return f(),Z("div",wi,[a("div",Pi,[Q[18]||(Q[18]=a("div",null,[a("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),a("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),a("div",Vi,[E(k)&&G.value==="products"?(f(),Z("div",Ci,[e(ue,{color:"primary",size:"small"},{default:t(()=>[d(r(E(X).length)+" dipilih ",1)]),_:1}),e(q,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:Ie},{default:t(()=>Q[16]||(Q[16]=[d(" Hapus Terpilih ")])),_:1,__:[16]})])):N("",!0),E(v)&&G.value==="products"?(f(),R(q,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:E(m)},{default:t(()=>Q[17]||(Q[17]=[d(" Tambah Produk ")])),_:1,__:[17]},8,["onClick"])):N("",!0)])]),e(Va,{modelValue:G.value,"onUpdate:modelValue":Q[0]||(Q[0]=_e=>G.value=_e),class:"mb-6"},{default:t(()=>[e(vt,{value:"products"},{default:t(()=>[e(h,{icon:"mdi-coffee",class:"me-2"}),Q[19]||(Q[19]=d(" Produk "))]),_:1,__:[19]}),e(vt,{value:"compositions"},{default:t(()=>[e(h,{icon:"mdi-chef-hat",class:"me-2"}),Q[20]||(Q[20]=d(" Komposisi Produk "))]),_:1,__:[20]}),e(vt,{value:"variants"},{default:t(()=>[e(h,{icon:"mdi-tune-variant",class:"me-2"}),Q[21]||(Q[21]=d(" Variant Produk "))]),_:1,__:[21]})]),_:1},8,["modelValue"]),E(ce)?(f(),R(Ke,{key:0,type:"error",variant:"outlined",class:"mb-4",text:E(ce),closable:"","onClick:close":Q[1]||(Q[1]=_e=>ce.value="")},null,8,["text"])):N("",!0),E(O)?(f(),R(Ke,{key:1,type:"success",variant:"outlined",class:"mb-4",text:E(O),closable:"","onClick:close":Q[2]||(Q[2]=_e=>O.value="")},null,8,["text"])):N("",!0),e(Ca,{modelValue:G.value,"onUpdate:modelValue":Q[4]||(Q[4]=_e=>G.value=_e)},{default:t(()=>[e(pt,{value:"products"},{default:t(()=>[e(Bo,{stats:E(A)},null,8,["stats"]),e(yo,{filters:E(de),"onUpdate:filters":Tt,onSearch:At},null,8,["filters"]),e(is,{ref_key:"productTableRef",ref:C,products:E(be),loading:E(M),"current-page":E(me),"total-items":E(fe),"items-per-page":E($),"selected-products":E(X),"toggle-loading":E(W),"onUpdate:page":E(ke),onAddProduct:E(m),onEditProduct:E(l),onOpenRecipeDialog:Re,onOpenCompositionDialog:Xe,onOpenVariantDialog:it,onDeleteProduct:E(i),onToggleActive:E(L),onToggleFeatured:E(D),"onUpdate:selectedProducts":Q[3]||(Q[3]=_e=>X.value=_e)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:page","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured"])]),_:1}),e(pt,{value:"compositions"},{default:t(()=>[e(Fl,{"product-items":E(F),loading:E(u),onRefresh:E(H)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(pt,{value:"variants"},{default:t(()=>[e($t,{loading:E(M),onRefresh:E(s)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(fo,{modelValue:E(g),"onUpdate:modelValue":[Q[5]||(Q[5]=_e=>mt(g)?g.value=_e:null),Q[6]||(Q[6]=_e=>g.value=_e)],"edit-mode":E(ee),"form-data":E(w),categories:E(K),loading:E(j),"error-message":E(ie),"selected-image":E(c)?[E(c)]:[],"image-preview":E(x),onClose:E(P),onSubmit:E(ae),onImageChange:E(ge),onRemoveImage:Ht,onClearError:E(J),onUpdateForm:Q[7]||(Q[7]=(_e,xt)=>E(w)[_e]=xt)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(ca,{modelValue:E(De),"onUpdate:modelValue":[Q[8]||(Q[8]=_e=>mt(De)?De.value=_e:null),Q[9]||(Q[9]=_e=>De.value=_e)],"edit-mode":E(se),"form-data":E(Te),"available-items":E(Ae),loading:E(Qe),"error-message":E(je),onClose:E(n),onSave:E(o),onClearError:E(V)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(St,{modelValue:E(_),"onUpdate:modelValue":Q[10]||(Q[10]=_e=>mt(_)?_.value=_e:null),title:"Konfirmasi Hapus Produk","item-name":(at=E(y))==null?void 0:at.name,loading:E(b),"confirm-text":"Hapus Produk",onConfirm:ye,onCancel:Q[11]||(Q[11]=_e=>_.value=!1)},null,8,["modelValue","item-name","loading"]),e(zt,{modelValue:ve.value,"onUpdate:modelValue":Q[12]||(Q[12]=_e=>ve.value=_e),product:re.value,items:nt(re.value),onSave:ht,onRefresh:ht},null,8,["modelValue","product","items"]),e(Le,{modelValue:ne.value,"onUpdate:modelValue":Q[15]||(Q[15]=_e=>ne.value=_e),"max-width":"1400px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex justify-between align-center"},{default:t(()=>{var _e;return[a("div",$i,[e(h,{icon:"tabler-versions",class:"me-2"}),d(" Kelola Variant - "+r((_e=Ce.value)==null?void 0:_e.name),1)]),e(q,{icon:"tabler-x",variant:"text",onClick:Q[13]||(Q[13]=xt=>ne.value=!1)})]}),_:1}),e(Ue),e(le,{class:"pa-0"},{default:t(()=>[Ce.value?(f(),R($t,{key:0,product:Ce.value},null,8,["product"])):N("",!0)]),_:1}),e(Ue),e(Fe,null,{default:t(()=>[e(Ne),e(q,{color:"grey-darken-1",variant:"outlined",onClick:Q[14]||(Q[14]=_e=>ne.value=!1)},{default:t(()=>[e(h,{icon:"mdi-close",class:"me-1"}),Q[22]||(Q[22]=d(" Tutup "))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),xn=Oe(Si,[["__scopeId","data-v-6d6c31f9"]]);export{xn as default};
