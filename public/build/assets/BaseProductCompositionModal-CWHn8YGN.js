import{d as Me,ay as Ue,r as C,V as O,w as pe,g as k,f as r,o as b,b as s,e as l,X as v,l as M,aw as Ke,t as c,s as y,at as ge,c as U,F as fe,i as be,a0 as Le,ao as ve,ap as ye,a1 as G,v as he,au as R,az as Fe,_ as Oe}from"./main-mVb2Zi2r.js";import{g as Ge}from"./auth-CuuXRWj5.js";import{V as Re}from"./VDialog-BhHbwSp-.js";import{V as q,b as te,c as He}from"./VCard-KdKd0_zs.js";import{V as B}from"./VCardText-C6cQ2YPR.js";import{V as Je}from"./VOverlay-Q1I2eFOg.js";import{V as ie}from"./VAvatar-CPl1Rs8l.js";import{V as xe}from"./VImg-DDUr8xsk.js";import{V as ke}from"./VChip-DfcpfFlX.js";import{V as ae,a as x}from"./VRow-BmgHKxKl.js";import{V as se}from"./VDivider-Dg-qwhzs.js";import{V as Qe}from"./VForm-Crx42ANL.js";import{V as we}from"./VAutocomplete-DglK-3Jh.js";import{a as Ve,b as Ie,d as Ne}from"./VList-B7SLC7Gv.js";import{V as Ce}from"./VTextField-BbvOAUmR.js";import{V as Xe}from"./VSwitch-BrRftdBW.js";import{V as qe}from"./VTooltip-DGe7dXvC.js";import{V as We}from"./VSpacer-DKRYQo20.js";import"./forwardRefs-B931MWyl.js";/* empty css              */import"./VSelect-DaQg8yMC.js";import"./VMenu-MXx5zkZ-.js";import"./VCheckboxBtn-Bjfx1eIL.js";import"./filter-BpN1xjbh.js";const Ye={class:"d-flex align-center gap-4"},Ze={class:"flex-grow-1"},et={class:"text-h6 font-weight-bold mb-1"},tt={class:"text-body-2 text-medium-emphasis mb-1"},it={class:"text-body-2 text-medium-emphasis mb-2"},at={class:"text-body-2 font-weight-bold"},st={class:"text-body-1 font-weight-bold"},rt={class:"text-body-1 font-weight-bold"},nt={class:"text-body-1 font-weight-bold"},ot={class:"text-subtitle-1 font-weight-bold"},dt={class:"text-h6 font-weight-bold text-primary"},lt={class:"d-flex align-center gap-2"},ut={key:0,class:"text-center pa-8"},ct={key:1,class:"pa-4"},_t={class:"d-flex align-center gap-3 flex-grow-1"},mt={class:"flex-grow-1"},pt={class:"font-weight-medium text-body-2 mb-1"},gt={class:"text-caption text-medium-emphasis",style:{"font-size":"0.75rem"}},ft={class:"d-flex align-center gap-2"},bt=Me({__name:"BaseProductCompositionModal",props:{show:{type:Boolean},composition:{},baseProducts:{},baseProductsLoading:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1}},emits:["close","saved","notification"],setup($e,{emit:Se}){const Q=$e,w=Se,a=Ue({base_product_id:0,ingredient_base_product_id:0,ingredient_item_id:0,quantity:0,notes:"",is_active:!0,is_critical:!1}),A=C(!1),K=C(!1),re=C(0),f=C({}),p=C(null),m=C(null),_=C([]),V=C([]),E=C(!1),L=C(!1),Ae=O(()=>V.value||[]),ne=O(()=>a.base_product_id&&(a.ingredient_item_id||a.ingredient_base_product_id)&&a.quantity>0&&!X.value),oe=O(()=>{if(!m.value||!a.quantity)return 0;try{const t=m.value.cost_per_unit||0,e=Number(a.quantity)||0;return t*e}catch(t){return console.error("Error calculating cost:",t),0}}),de=O(()=>{if(!m.value||!a.quantity)return 0;try{const t=Number(m.value.current_stock)||0,e=Number(a.quantity)||0;return e>0?Math.floor(t/e):0}catch(t){return console.error("Error calculating max quantity:",t),0}}),X=O(()=>!a.ingredient_item_id&&!a.ingredient_base_product_id?!1:_.value.some(e=>!!(a.ingredient_item_id&&e.ingredient_item_id===a.ingredient_item_id||a.ingredient_base_product_id&&e.ingredient_base_product_id===a.ingredient_base_product_id))),H=t=>{if(t==null)return"0";const e=typeof t=="string"?parseFloat(t):Number(t);return isNaN(e)?"0":e.toLocaleString("id-ID")},j=t=>{if(t==null)return"Rp 0";const e=typeof t=="string"?parseFloat(t):Number(t);return isNaN(e)?"Rp 0":`Rp ${e.toLocaleString("id-ID")}`},P=t=>{var e,i;try{return(e=t.ingredient_item)!=null&&e.name?t.ingredient_item.name:(i=t.ingredient_base_product)!=null&&i.name?t.ingredient_base_product.name:"Unknown Item"}catch{return"Unknown Item"}},Pe=t=>{var e,i;try{return((e=t.ingredient_item)==null?void 0:e.current_stock)!==void 0?t.ingredient_item.current_stock:((i=t.ingredient_base_product)==null?void 0:i.current_stock)!==void 0?t.ingredient_base_product.current_stock:0}catch{return 0}},W=t=>{var e,i;try{return(e=t.ingredient_item)!=null&&e.unit?t.ingredient_item.unit:(i=t.ingredient_base_product)!=null&&i.unit?t.ingredient_base_product.unit:"pcs"}catch{return"pcs"}},ze=()=>{if(!p.value)return 0;const t=p.value.selling_price||0,e=p.value.cost_per_unit||0;return t-e},Te=()=>{Object.keys(a).forEach(t=>{t==="is_active"?a[t]=!0:t==="is_critical"?a[t]=!1:t==="quantity"||t==="base_product_id"||t==="ingredient_item_id"||t==="ingredient_base_product_id"?a[t]=0:a[t]=""}),m.value=null,f.value={}},le=async()=>{const t=Number(a.base_product_id);t?(p.value=Q.baseProducts.find(e=>e.id_base_product===t)||null,await Y()):(p.value=null,_.value=[])},ue=()=>{const t=Number(a.ingredient_item_id);t?m.value=V.value.find(e=>e.id_item===t)||null:m.value=null},ce=async()=>{L.value||await _e()},_e=async()=>{if(!(L.value&&V.value.length>0))try{E.value=!0;const t=await R.get("/api/items?per_page=all&active=true");if(t.data.success&&t.data.data){let e=[];Array.isArray(t.data.data.data)?e=t.data.data.data:Array.isArray(t.data.data)&&(e=t.data.data),V.value=e,L.value=!0}else console.error("API response not successful:",t),V.value=[]}catch(t){console.error("Error loading items with $api:",t);try{const i=await(await fetch("/api/items?per_page=all&active=true",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${Fe("accessToken").value}`}})).json();if(i.success&&i.data){let n=[];Array.isArray(i.data.data)?n=i.data.data:Array.isArray(i.data)&&(n=i.data),V.value=n,L.value=!0}}catch(e){console.error("Items fallback also failed:",e),V.value=[]}V.value=[]}finally{E.value=!1}},Y=async()=>{if(a.base_product_id)try{const t=await R.get(`/api/base-product-compositions/base-product/${a.base_product_id}`);if(t.data.success){const e=t.data.data||[];e.forEach(i=>{if(i.is_temporary=!1,i.ingredient_item_id&&!i.ingredient_item){const n=V.value.find($=>$.id_item===i.ingredient_item_id);n&&(i.ingredient_item=n)}}),_.value=e,e.length>0}else console.error("API response not successful:",t.data),_.value=[]}catch(t){console.error("Error loading compositions:",t),t.response&&console.error("Error response:",t.response.data),_.value=[]}};pe(()=>Q.show,async t=>{t&&(L.value||await _e(),a.base_product_id&&Y())},{immediate:!0}),pe(()=>Q.composition,t=>{t?(Object.keys(a).forEach(e=>{const i=t[e];e==="is_active"?a[e]=i!==void 0?i:!0:e==="is_critical"?a[e]=i!==void 0?i:!1:e==="quantity"||e==="base_product_id"||e==="ingredient_item_id"?a[e]=i!==void 0?Number(i):0:a[e]=i||""}),le(),ue()):Te(),f.value={}},{immediate:!0});const Be=()=>{},me=async()=>{var i,n,$,z,I,T,D,S;if(!ne.value)return;const t=_.value.findIndex(u=>u.is_editing===!0);if(t>-1){const u=_.value[t];if(_.value.some(o=>o.is_editing===!0?!1:!!(a.ingredient_item_id&&o.ingredient_item_id===a.ingredient_item_id||a.ingredient_base_product_id&&o.ingredient_base_product_id===a.ingredient_base_product_id))){const o=a.ingredient_item_id?(i=m.value)==null?void 0:i.name:(n=m.value)==null?void 0:n.name;f.value={general:`Item "${o||"yang dipilih"}" sudah ada dalam daftar komposisi. Silakan pilih item yang berbeda.`};return}u.quantity=Number(a.quantity),u.notes=a.notes||null,u.is_active=a.is_active,u.is_critical=a.is_critical,a.ingredient_item_id>0?(u.ingredient_item_id=Number(a.ingredient_item_id),u.ingredient_base_product_id=null,u.ingredient_item=m.value,u.ingredient_base_product=null):a.ingredient_base_product_id>0&&(u.ingredient_base_product_id=Number(a.ingredient_base_product_id),u.ingredient_item_id=null,u.ingredient_base_product=m.value,u.ingredient_item=null),u.is_modified=!0,u.is_editing=!1,u.edit_mode=!1,a.ingredient_base_product_id=0,a.ingredient_item_id=0,a.quantity=0,a.notes="",a.is_critical=!1,m.value=null;return}if(_.value.some(u=>!!(a.ingredient_item_id&&u.ingredient_item_id===a.ingredient_item_id||a.ingredient_base_product_id&&u.ingredient_base_product_id===a.ingredient_base_product_id))){const u=a.ingredient_item_id?($=m.value)==null?void 0:$.name:(z=m.value)==null?void 0:z.name;f.value={general:`Item "${u||"yang dipilih"}" sudah ada dalam daftar komposisi. Silakan pilih item yang berbeda.`};return}A.value=!0,f.value={};try{const u={id:Date.now(),base_product_id:Number(a.base_product_id),ingredient_base_product_id:a.ingredient_base_product_id>0?Number(a.ingredient_base_product_id):null,ingredient_item_id:a.ingredient_item_id>0?Number(a.ingredient_item_id):null,quantity:Number(a.quantity),notes:a.notes||null,is_active:a.is_active,is_critical:a.is_critical,ingredient_item:a.ingredient_item_id>0?m.value:null,ingredient_base_product:a.ingredient_base_product_id>0?m.value:null,total_cost:oe.value,is_temporary:!0};_.value.unshift(u),a.ingredient_base_product_id=0,a.ingredient_item_id=0,a.quantity=0,a.notes="",a.is_critical=!1,m.value=null}catch(u){console.error("Error adding composition:",u),(T=(I=u.response)==null?void 0:I.data)!=null&&T.errors?f.value=u.response.data.errors:f.value={general:((S=(D=u.response)==null?void 0:D.data)==null?void 0:S.message)||"Failed to add composition"}}finally{A.value=!1}},Ee=async t=>{a.base_product_id=t.base_product_id,a.quantity=t.quantity,a.notes=t.notes||"",a.is_active=t.is_active,a.is_critical=t.is_critical||!1,t.ingredient_item_id?(a.ingredient_item_id=t.ingredient_item_id,a.ingredient_base_product_id=0,m.value=t.ingredient_item):t.ingredient_base_product_id&&(a.ingredient_base_product_id=t.ingredient_base_product_id,a.ingredient_item_id=0,m.value=t.ingredient_base_product);const e=_.value.findIndex(i=>(i.id_base_product_composition||i.id)===(t.id_base_product_composition||t.id));e>-1&&(_.value[e].is_editing=!0,_.value[e].edit_mode=!0),f.value={},setTimeout(()=>{const i=document.querySelector(".composition-modal .v-card-text");i&&i.scrollTo({top:0,behavior:"smooth"})},100)},je=async t=>{var e,i;A.value=!0;try{const n=t.id_base_product_composition||t.id,$=t.is_temporary===!0;if(n&&!$){const I=Ge(),T={"Content-Type":"application/json",Accept:"application/json"};I&&(T.Authorization=`Bearer ${I}`),(await R.delete(`/api/base-product-compositions/${n}`,{headers:T})).data.success?w("notification","Item komposisi berhasil dihapus dari database","success"):w("notification","Gagal menghapus item komposisi","error")}else w("notification","Item komposisi berhasil dihapus","success");const z=_.value.findIndex(I=>I.id===t.id);z>-1&&_.value.splice(z,1)}catch(n){console.error("Error deleting composition:",n),w("notification",((i=(e=n.response)==null?void 0:e.data)==null?void 0:i.message)||"Gagal menghapus item komposisi","error")}finally{A.value=!1}},De=async()=>{var n,$,z,I,T,D;const t=Date.now();if(t-re.value<1e3||(re.value=t,K.value)||_.value.length===0)return;K.value=!0,f.value={};let e=0,i=[];Math.random().toString(36).substr(2,9);try{const S=_.value.filter(d=>d.is_temporary&&d.base_product_id&&d.quantity>0),u=_.value.filter(d=>d.is_modified&&!d.is_temporary&&d.id_base_product_composition);if(S.length===0&&u.length===0)return;for(const d of u)try{if(!d.base_product_id||d.base_product_id<=0){i.push(`${P(d)}: Missing base product ID`);continue}if(!d.quantity||d.quantity<=0){i.push(`${P(d)}: Invalid quantity`);continue}const o={base_product_id:Number(d.base_product_id),quantity:Number(d.quantity),is_active:!!d.is_active,is_critical:!!d.is_critical,notes:d.notes||null};if(d.ingredient_item_id&&Number(d.ingredient_item_id)>0&&(o.ingredient_item_id=Number(d.ingredient_item_id),o.ingredient_base_product_id=null),d.ingredient_base_product_id&&Number(d.ingredient_base_product_id)>0&&(o.ingredient_base_product_id=Number(d.ingredient_base_product_id),o.ingredient_item_id=null),!o.ingredient_item_id&&!o.ingredient_base_product_id){console.error("No ingredient provided for update:",d),i.push(`${P(d)}: No ingredient selected`);continue}const g=d.id_base_product_composition||d.id,h=await R.put(`/api/base-product-compositions/${g}`,o,{headers:{"Content-Type":"application/json",Accept:"application/json"}});h.data&&h.data.success&&h.data.data&&Object.assign(d,h.data.data),e++,d.is_modified=!1}catch(o){console.error("Error updating composition:",o);const g=P(d);i.push(`${g}: ${(($=(n=o.response)==null?void 0:n.data)==null?void 0:$.message)||"Update failed"}`)}for(let d=S.length-1;d>=0;d--){const o=S[d];if(!o.base_product_id||o.quantity<=0){i.push(`Invalid composition data for ${P(o)}`);continue}if(!o.ingredient_item_id&&!o.ingredient_base_product_id){i.push(`No ingredient selected for ${P(o)}`);continue}try{const g={};g.base_product_id=Number(o.base_product_id),g.quantity=Number(o.quantity),g.is_active=!!o.is_active,g.is_critical=!!o.is_critical,g.notes=o.notes||null,o.ingredient_item_id&&Number(o.ingredient_item_id)>0&&(g.ingredient_item_id=Number(o.ingredient_item_id),g.ingredient_base_product_id=null),o.ingredient_base_product_id&&Number(o.ingredient_base_product_id)>0&&(g.ingredient_base_product_id=Number(o.ingredient_base_product_id),g.ingredient_item_id=null);const h=await R.post("/api/base-product-compositions",g,{headers:{"Content-Type":"application/json",Accept:"application/json"}});h.data&&h.data.success&&h.data.data&&Object.assign(o,h.data.data),e++;const N=_.value.findIndex(F=>F.id===o.id);N>-1&&_.value.splice(N,1)}catch(g){console.error("Error saving individual composition:",g);const h=P(o);if(((z=g.response)==null?void 0:z.status)===422){const N=(I=g.response)==null?void 0:I.data,F=(N==null?void 0:N.message)||"";if(N!=null&&N.errors){const J=Object.entries(N.errors).map(([Z,ee])=>`${Z}: ${Array.isArray(ee)?ee.join(", "):ee}`).join("; ");i.push(`${h}: ${J}`)}else if(F.includes("already exists")||F.includes("Composition already exists")){i.push(`${h}: Item sudah ada dalam komposisi database`);const J=_.value.findIndex(Z=>Z.id===o.id);J>-1&&_.value.splice(J,1)}else i.push(`${h}: ${F}`)}else i.push(`${h}: ${((D=(T=g.response)==null?void 0:T.data)==null?void 0:D.message)||"Gagal menyimpan"}`)}}e>0&&i.length===0?(w("saved",{success:!0,message:"Semua komposisi berhasil disimpan"}),w("close")):e>0&&i.length>0?(f.value={general:`${e} item berhasil disimpan. Errors: ${i.join(", ")}`},await Y(),w("saved",{success:!0,message:`${e} komposisi berhasil disimpan dengan beberapa error`})):e===0&&i.length===0?(w("saved",{success:!0,message:"Tidak ada perubahan untuk disimpan"}),w("close")):(f.value={general:`Gagal menyimpan komposisi: ${i.join(", ")}`},w("saved",{success:!1,message:"Gagal menyimpan komposisi"}))}catch(S){console.error("Critical error in save process:",S),f.value={general:"Failed to save compositions: "+(S.message||"Unknown error")}}finally{K.value=!1}};return window.console=console,(t,e)=>(b(),k(Re,{"model-value":t.show,"max-width":"1000px",persistent:"",scrollable:"","onUpdate:modelValue":e[6]||(e[6]=i=>!i&&t.$emit("close"))},{default:r(()=>[s(q,{class:"composition-modal"},{default:r(()=>[s(te,{class:"composition-header"},{default:r(()=>[s(v,{icon:"mdi-chef-hat",class:"me-2"}),e[7]||(e[7]=l("span",null,"Kelola Komposisi Base Product",-1))]),_:1,__:[7]}),s(B,{class:"pa-6"},{default:r(()=>[s(Je,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=i=>E.value=i),contained:"",persistent:"",class:"d-flex align-center justify-center"},{default:r(()=>[s(q,{class:"pa-6 text-center","min-width":"250"},{default:r(()=>[s(Ke,{indeterminate:"",color:"primary",size:"50",class:"mb-4"}),e[8]||(e[8]=l("div",{class:"text-h6 mb-2"},"Memuat Data...",-1)),e[9]||(e[9]=l("div",{class:"text-body-2 text-medium-emphasis"},"Mohon tunggu sebentar",-1))]),_:1,__:[8,9]})]),_:1},8,["modelValue"]),p.value?(b(),k(q,{key:0,variant:"tonal",color:"primary",class:"mb-6"},{default:r(()=>[s(B,{class:"pa-4"},{default:r(()=>{var i;return[l("div",Ye,[s(ie,{size:"60",rounded:""},{default:r(()=>[p.value.image_url?(b(),k(xe,{key:0,src:p.value.image_url,alt:p.value.name},null,8,["src","alt"])):(b(),k(v,{key:1,icon:"tabler-package",size:"30"}))]),_:1}),l("div",Ze,[l("h3",et,c(p.value.name),1),l("div",tt," SKU: "+c(p.value.sku||"No SKU"),1),l("div",it," Kategori: "+c(((i=p.value.category)==null?void 0:i.name)||"Tidak ada kategori"),1),s(ke,{color:p.value.current_stock>p.value.min_stock?"success":"warning",size:"small",variant:"flat",class:"mt-1"},{default:r(()=>[y(c(p.value.current_stock>p.value.min_stock?"Stok Aman":"Stok Menipis"),1)]),_:1},8,["color"])])])]}),_:1})]),_:1})):M("",!0),p.value?(b(),k(ae,{key:1,class:"mb-6"},{default:r(()=>[s(x,{cols:"6",md:"3"},{default:r(()=>[s(q,{variant:"outlined",class:"stats-card"},{default:r(()=>[s(B,{class:"text-center pa-3"},{default:r(()=>{var i;return[s(v,{icon:"mdi-tag",color:"info",class:"mb-1",size:"20"}),l("div",at,c(((i=p.value.category)==null?void 0:i.name)||"No Category"),1),e[10]||(e[10]=l("div",{class:"text-caption text-medium-emphasis"},"Kategori",-1))]}),_:1,__:[10]})]),_:1})]),_:1}),s(x,{cols:"6",md:"3"},{default:r(()=>[s(q,{variant:"outlined",class:"stats-card"},{default:r(()=>[s(B,{class:"text-center pa-3"},{default:r(()=>[s(v,{icon:"mdi-package-variant",color:"primary",class:"mb-1",size:"20"}),l("div",st,c(j(p.value.cost_per_unit||0)),1),e[11]||(e[11]=l("div",{class:"text-caption text-medium-emphasis"},"HPP",-1))]),_:1,__:[11]})]),_:1})]),_:1}),s(x,{cols:"6",md:"3"},{default:r(()=>[s(q,{variant:"outlined",class:"stats-card"},{default:r(()=>[s(B,{class:"text-center pa-3"},{default:r(()=>[s(v,{icon:"mdi-currency-usd",color:"success",class:"mb-1",size:"20"}),l("div",rt,c(j(p.value.selling_price||0)),1),e[12]||(e[12]=l("div",{class:"text-caption text-medium-emphasis"},"Harga Jual",-1))]),_:1,__:[12]})]),_:1})]),_:1}),s(x,{cols:"6",md:"3"},{default:r(()=>[s(q,{variant:"outlined",class:"stats-card"},{default:r(()=>[s(B,{class:"text-center pa-3"},{default:r(()=>[s(v,{icon:"mdi-trending-up",color:"warning",class:"mb-1",size:"20"}),l("div",nt,c(j(ze())),1),e[13]||(e[13]=l("div",{class:"text-caption text-medium-emphasis"},"Margin",-1))]),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):M("",!0),s(q,{class:"mb-6"},{default:r(()=>[s(te,{class:"d-flex align-center gap-2 pa-4"},{default:r(()=>[s(v,{icon:"mdi-plus-circle",color:"primary"}),e[14]||(e[14]=l("span",null,"Tambah Item Komposisi",-1))]),_:1,__:[14]}),s(se),s(B,{class:"pa-4"},{default:r(()=>[Object.keys(f.value).length>0?(b(),k(ge,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:r(()=>[(b(!0),U(fe,null,be(f.value,(i,n)=>(b(),U("div",{key:n},[l("strong",null,c(n)+":",1),y(" "+c(Array.isArray(i)?i[0]:i),1)]))),128))]),_:1})):M("",!0),s(Qe,{onSubmit:Le(me,["prevent"])},{default:r(()=>[s(ae,null,{default:r(()=>[!t.editMode&&!a.base_product_id?(b(),k(x,{key:0,cols:"12",md:"6"},{default:r(()=>[s(we,{modelValue:a.base_product_id,"onUpdate:modelValue":[e[1]||(e[1]=i=>a.base_product_id=i),le],items:t.baseProducts,loading:t.baseProductsLoading,"item-title":"name","item-value":"id_base_product",label:"Pilih Base Product",placeholder:"Pilih base product","prepend-inner-icon":"tabler-package",clearable:"","error-messages":f.value.base_product_id},{item:r(({props:i,item:n})=>[s(Ve,ve(ye(i)),{prepend:r(()=>[s(ie,{size:"30"},{default:r(()=>[n.raw.image_url?(b(),k(xe,{key:0,src:n.raw.image_url,alt:n.raw.name},null,8,["src","alt"])):(b(),k(v,{key:1,icon:"tabler-package",size:"16"}))]),_:2},1024)]),default:r(()=>[s(Ie,null,{default:r(()=>[y(c(n.raw.name),1)]),_:2},1024),s(Ne,null,{default:r(()=>[y(" Stock: "+c(H(n.raw.current_stock))+" "+c(n.raw.unit)+" | "+c(n.raw.formatted_cost),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","error-messages"])]),_:1})):M("",!0),s(x,{cols:"12",md:!t.editMode&&!a.base_product_id?6:4},{default:r(()=>[s(we,{modelValue:a.ingredient_item_id,"onUpdate:modelValue":[e[2]||(e[2]=i=>a.ingredient_item_id=i),ue],items:Ae.value,loading:E.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",placeholder:"Pilih item komposisi","prepend-inner-icon":"tabler-package",clearable:"","error-messages":f.value.ingredient_item_id,color:X.value?"warning":"primary","onClick:prependInner":ce,onFocus:ce,"no-data-text":E.value?"Memuat item...":V.value.length===0?"Tidak ada item tersedia":"Ketik untuk mencari..."},{item:r(({props:i,item:n})=>[s(Ve,ve(ye(i)),{prepend:r(()=>[s(ie,{size:"30"},{default:r(()=>[s(v,{icon:"tabler-package",size:"16"})]),_:1})]),default:r(()=>[s(Ie,null,{default:r(()=>[y(c(n.raw.name),1)]),_:2},1024),s(Ne,null,{default:r(()=>[y(" Stok: "+c(H(n.raw.current_stock||0))+" "+c(n.raw.unit||"pcs")+" | Rp "+c(j(n.raw.cost_per_unit||0)),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","error-messages","color","no-data-text"]),X.value?(b(),k(ge,{key:0,type:"warning",variant:"tonal",density:"compact",class:"mt-2"},{default:r(()=>[s(v,{icon:"mdi-alert",class:"me-2"}),e[15]||(e[15]=y(" Item ini sudah ada dalam daftar komposisi "))]),_:1,__:[15]})):M("",!0)]),_:1},8,["md"]),s(x,{cols:"6",md:!t.editMode&&!a.base_product_id?6:4},{default:r(()=>{var i;return[s(Ce,{modelValue:a.quantity,"onUpdate:modelValue":e[3]||(e[3]=n=>a.quantity=n),type:"number",step:"0.01",min:"0",label:"Jumlah",placeholder:"1",suffix:((i=m.value)==null?void 0:i.unit)||"pcs","prepend-inner-icon":"mdi-numeric","error-messages":f.value.quantity,onInput:Be},null,8,["modelValue","suffix","error-messages"])]}),_:1},8,["md"]),s(x,{cols:"6",md:!t.editMode&&!a.base_product_id?6:2},{default:r(()=>{var i;return[s(Ce,{"model-value":((i=m.value)==null?void 0:i.unit)||"pcs",label:"Satuan",readonly:"","prepend-inner-icon":"mdi-scale-balance"},null,8,["model-value"])]}),_:1},8,["md"]),s(x,{cols:"6",md:"2"},{default:r(()=>[s(Xe,{modelValue:a.is_critical,"onUpdate:modelValue":e[4]||(e[4]=i=>a.is_critical=i),label:"Item Kritis",color:"warning","hide-details":""},null,8,["modelValue"])]),_:1}),s(x,{cols:"6",md:"2",class:"d-flex align-center"},{default:r(()=>[s(G,{color:"primary",loading:A.value,disabled:!ne.value,onClick:me,block:""},{default:r(()=>[s(v,{icon:"mdi-plus",class:"me-1"}),e[16]||(e[16]=y(" Tambah ke List "))]),_:1,__:[16]},8,["loading","disabled"])]),_:1})]),_:1}),m.value&&a.quantity?(b(),k(q,{key:0,variant:"tonal",color:"success",class:"mt-4"},{default:r(()=>[s(B,{class:"pa-3"},{default:r(()=>[s(ae,null,{default:r(()=>[s(x,{cols:"12",md:"4"},{default:r(()=>{var i;return[e[17]||(e[17]=l("div",{class:"text-caption text-medium-emphasis"},"Cost per Unit:",-1)),l("div",ot,c(j(((i=m.value)==null?void 0:i.cost_per_unit)||0)),1)]}),_:1,__:[17]}),s(x,{cols:"12",md:"4"},{default:r(()=>[e[18]||(e[18]=l("div",{class:"text-caption text-medium-emphasis"},"Total Cost:",-1)),l("div",dt,c(j(oe.value)),1)]),_:1,__:[18]}),s(x,{cols:"12",md:"4"},{default:r(()=>[e[19]||(e[19]=l("div",{class:"text-caption text-medium-emphasis"},"Available Stock:",-1)),l("div",{class:he(["text-h6 font-weight-bold",de.value>0?"text-success":"text-error"])},c(de.value)+" portions ",3)]),_:1,__:[19]})]),_:1})]),_:1})]),_:1})):M("",!0)]),_:1})]),_:1})]),_:1}),s(q,null,{default:r(()=>[s(te,{class:"d-flex align-center justify-space-between pa-4"},{default:r(()=>[l("div",lt,[s(v,{icon:"mdi-format-list-bulleted",color:"primary"}),l("span",null,"Daftar Item Komposisi ("+c(_.value.length)+")",1)])]),_:1}),s(se),_.value.length===0?(b(),U("div",ut,[s(v,{icon:"mdi-package-variant-closed",size:"64",color:"grey-lighten-2",class:"mb-4"}),e[20]||(e[20]=l("h3",{class:"text-h6 text-medium-emphasis mb-2"},"Belum ada item komposisi",-1)),e[21]||(e[21]=l("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Tambahkan item yang dibutuhkan untuk membuat base product ini ",-1))])):(b(),U("div",ct,[(b(!0),U(fe,null,be(_.value,i=>(b(),U("div",{key:i.id||i.base_product_id,class:he(["composition-item d-flex align-center justify-space-between pa-3 mb-3 rounded-lg border",{"bg-green-lighten-5 border-success":i.is_temporary}])},[l("div",_t,[s(v,{icon:"mdi-check-circle",color:"success",size:"18"}),l("div",mt,[l("div",pt,c(P(i)),1),l("div",gt,[y(" Dibutuhkan: "+c(H(i.quantity||0))+" "+c(W(i))+" ",1),e[22]||(e[22]=l("span",{class:"mx-2"},"•",-1)),y(" Stok: "+c(H(Pe(i)))+" "+c(W(i)),1)])])]),l("div",ft,[s(ke,{size:"x-small",variant:"outlined",color:"primary"},{default:r(()=>[y(c(W(i)),1)]),_:2},1024),s(G,{icon:"",size:"x-small",variant:"text",color:"primary",onClick:n=>Ee(i),disabled:i.is_temporary||A.value},{default:r(()=>[s(v,{icon:"mdi-pencil",size:"16"}),s(qe,{activator:"parent",location:"top"},{default:r(()=>e[23]||(e[23]=[y(" Edit Komposisi ")])),_:1,__:[23]})]),_:2},1032,["onClick","disabled"]),s(G,{icon:"",size:"x-small",variant:"text",color:"error",disabled:A.value,onClick:n=>je(i)},{default:r(()=>[s(v,{icon:"mdi-delete",size:"16"}),s(qe,{activator:"parent",location:"top"},{default:r(()=>e[24]||(e[24]=[y(" Hapus Komposisi ")])),_:1,__:[24]})]),_:2},1032,["disabled","onClick"])])],2))),128))]))]),_:1})]),_:1}),s(se),s(He,{class:"pa-4"},{default:r(()=>[s(We),s(G,{variant:"outlined",onClick:e[5]||(e[5]=i=>t.$emit("close")),disabled:A.value},{default:r(()=>e[25]||(e[25]=[y(" Batal ")])),_:1,__:[25]},8,["disabled"]),s(G,{color:"primary",onClick:De,loading:K.value,disabled:K.value||_.value.length===0},{default:r(()=>[s(v,{icon:"mdi-content-save",class:"me-1"}),y(" Simpan Komposisi ("+c(_.value.filter(i=>i.is_temporary).length)+") ",1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),Lt=Oe(bt,[["__scopeId","data-v-7fd1bd9d"]]);export{Lt as default};
