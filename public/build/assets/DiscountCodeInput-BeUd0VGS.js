import{d as A,r as m,V as T,w as E,g as h,f as n,o as r,b as l,s as D,X as I,c as _,l as y,aJ as R,a1 as K,e as s,at as H,t as u,F as J,i as L,_ as U}from"./main-yFogiP_i.js";import{V as G,b as Q}from"./VCard-BxSaaMc4.js";import{V as X}from"./VCardText-B7HqBZba.js";import{V as O,a as N}from"./VRow-CLAvlLq8.js";import{V as W}from"./VTextField-C0FXqMcH.js";import{V as Y}from"./VDivider-BjRbex_7.js";import{V as Z}from"./VChip-BQMQVKI9.js";import"./VAvatar-DVns6Nlw.js";import"./VImg-CB0QqOg0.js";/* empty css              */import"./forwardRefs-B931MWyl.js";const ee={key:0,class:"applied-discount-info"},ae={class:"d-flex justify-space-between align-center"},se={class:"font-weight-medium"},te={class:"text-caption"},le={class:"discount-details"},ie={class:"detail-row d-flex justify-space-between py-1"},oe={class:"text-body-2 font-weight-medium"},ne={class:"detail-row d-flex justify-space-between py-1"},ue={class:"text-body-2"},de={class:"detail-row d-flex justify-space-between py-1"},ce={class:"text-body-2 font-weight-medium"},re={key:0,class:"detail-row d-flex justify-space-between py-1"},me={class:"text-body-2"},ve={key:1,class:"detail-row d-flex justify-space-between py-1"},pe={class:"text-body-2"},fe={key:2,class:"detail-row d-flex justify-space-between py-1"},_e={class:"text-body-2"},ye={class:"discount-amount d-flex justify-space-between py-1"},be={class:"text-body-1 font-weight-bold text-success"},ke={key:1,class:"quick-codes mt-3"},ge={class:"d-flex flex-wrap gap-2"},xe=A({__name:"DiscountCodeInput",props:{subtotal:{},quickCodes:{default:()=>[]}},emits:["discount-applied","discount-removed"],setup(B,{expose:F,emit:S}){const P={async validateCode(t,e){return{success:!1,message:"API belum tersedia - implementasi mock",data:null}}},p=B,C=S,d=m(""),a=m(null),f=m(!1),i=m(!1),o=m(""),g=m(""),c=m(!1),V=m(null),x=T(()=>{if(!a.value)return 0;const t=a.value;if(t.type==="percentage"){const e=p.subtotal*t.value/100;return t.maximum_discount>0?Math.min(e,t.maximum_discount):e}return Math.min(t.value,p.subtotal)}),b=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t).replace("IDR","Rp"),$=t=>new Date(t).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"}),q=()=>{i.value=!1,c.value=!1,o.value="",g.value="",V.value&&clearTimeout(V.value),d.value.length>=3&&(V.value=setTimeout(()=>{k()},1e3))},k=async()=>{if(!d.value.trim()){i.value=!0,o.value="Silakan masukkan kode diskon";return}f.value=!0,i.value=!1,o.value="";try{const t=await P.validateCode(d.value.trim(),p.subtotal);if(t.success&&t.data){const e=t.data;if(e.minimum_amount>0&&p.subtotal<e.minimum_amount){i.value=!0,o.value=`Minimum pembelian ${b(e.minimum_amount)}`,c.value=!1;return}if(e.usage_limit&&e.used_count>=e.usage_limit){i.value=!0,o.value="Kode diskon sudah mencapai batas penggunaan",c.value=!1;return}if(e.valid_until){const v=new Date,M=new Date(e.valid_until);if(v>M){i.value=!0,o.value="Kode diskon sudah kedaluwarsa",c.value=!1;return}}a.value=e,c.value=!0,g.value=`Kode diskon "${e.code}" berhasil diterapkan!`,C("discount-applied",e,x.value)}else i.value=!0,o.value=t.message||"Kode diskon tidak valid",c.value=!1}catch(t){console.error("Error validating discount code:",t),i.value=!0,o.value="Gagal memvalidasi kode diskon",c.value=!1}finally{f.value=!1}},j=()=>{d.value="",w()},w=()=>{a.value=null,c.value=!1,i.value=!1,o.value="",g.value="",C("discount-removed")},z=t=>{d.value=t,k()};return E(()=>p.subtotal,()=>{a.value&&(C("discount-applied",a.value,x.value),a.value.minimum_amount>0&&p.subtotal<a.value.minimum_amount&&(i.value=!0,o.value=`Minimum pembelian ${b(a.value.minimum_amount)}`,w()))}),F({validateCode:k,clearCode:j,removeDiscount:w,appliedDiscount:T(()=>a.value),calculatedDiscount:x}),(t,e)=>(r(),h(G,{class:"discount-code-card mb-4",variant:"tonal",color:"success-lighten-5"},{default:n(()=>[l(Q,{class:"text-h6 pb-2"},{default:n(()=>[l(I,{icon:"mdi-ticket-percent",size:"20",class:"me-2"}),e[1]||(e[1]=D(" Kode Diskon "))]),_:1,__:[1]}),l(X,{class:"pt-0"},{default:n(()=>[l(O,{class:"mb-3"},{default:n(()=>[l(N,{cols:"12",md:"8"},{default:n(()=>[l(W,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=v=>d.value=v),label:"Masukkan Kode Diskon",variant:"outlined",placeholder:"Contoh: DISC10, SAVE20","prepend-inner-icon":"mdi-ticket",loading:f.value,error:i.value,"error-messages":o.value,success:c.value&&!i.value,"success-messages":g.value,onInput:q,onKeyup:R(k,["enter"])},{"append-inner":n(()=>[d.value&&!f.value?(r(),h(K,{key:0,icon:"mdi-close",variant:"text",size:"small",onClick:j})):y("",!0)]),_:1},8,["modelValue","loading","error","error-messages","success","success-messages"])]),_:1}),l(N,{cols:"12",md:"4"},{default:n(()=>[l(K,{disabled:!d.value||f.value,loading:f.value,color:"success",variant:"flat",block:"",onClick:k},{default:n(()=>[l(I,{icon:"mdi-check",class:"me-1"}),e[2]||(e[2]=D(" Terapkan "))]),_:1,__:[2]},8,["disabled","loading"])]),_:1})]),_:1}),a.value?(r(),_("div",ee,[l(H,{type:"success",variant:"tonal",class:"mb-3"},{prepend:n(()=>[l(I,{icon:"mdi-check-circle"})]),default:n(()=>[s("div",ae,[s("div",null,[s("div",se,u(a.value.name),1),s("div",te,u(a.value.description),1)]),l(K,{icon:"mdi-close",variant:"text",size:"small",onClick:w})])]),_:1}),s("div",le,[s("div",ie,[e[3]||(e[3]=s("span",{class:"text-body-2"},"Kode Diskon:",-1)),s("span",oe,u(a.value.code),1)]),s("div",ne,[e[4]||(e[4]=s("span",{class:"text-body-2"},"Jenis:",-1)),s("span",ue,u(a.value.type==="percentage"?"Persentase":"Nominal"),1)]),s("div",de,[e[5]||(e[5]=s("span",{class:"text-body-2"},"Nilai:",-1)),s("span",ce,u(a.value.type==="percentage"?`${a.value.value}%`:b(a.value.value)),1)]),a.value.minimum_amount>0?(r(),_("div",re,[e[6]||(e[6]=s("span",{class:"text-body-2"},"Min. Pembelian:",-1)),s("span",me,u(b(a.value.minimum_amount)),1)])):y("",!0),a.value.usage_limit?(r(),_("div",ve,[e[7]||(e[7]=s("span",{class:"text-body-2"},"Sisa Penggunaan:",-1)),s("span",pe,u(a.value.usage_limit-a.value.used_count),1)])):y("",!0),a.value.valid_until?(r(),_("div",fe,[e[8]||(e[8]=s("span",{class:"text-body-2"},"Berlaku Hingga:",-1)),s("span",_e,u($(a.value.valid_until)),1)])):y("",!0),l(Y,{class:"my-2"}),s("div",ye,[e[9]||(e[9]=s("span",{class:"text-body-1 font-weight-medium"},"Potongan Harga:",-1)),s("span",be," -"+u(b(x.value)),1)])])])):y("",!0),t.quickCodes.length>0?(r(),_("div",ke,[e[10]||(e[10]=s("div",{class:"text-caption mb-2 text-medium-emphasis"},"Kode diskon tersedia:",-1)),s("div",ge,[(r(!0),_(J,null,L(t.quickCodes,v=>(r(),h(Z,{key:v,size:"small",variant:"outlined",color:"success",clickable:"",onClick:M=>z(v)},{default:n(()=>[D(u(v),1)]),_:2},1032,["onClick"]))),128))])])):y("",!0)]),_:1})]),_:1}))}}),Be=U(xe,[["__scopeId","data-v-b2d8147d"]]);export{Be as default};
