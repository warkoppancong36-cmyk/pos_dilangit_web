import{r as q,ax as N,w as U,g as v,f as l,o as _,b as t,e as i,X as B,t as m,l as y,s as b,$ as M,a0 as g}from"./main-Cofpy7Pj.js";import{u as F}from"./baseProduct-CBu0O_b8.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as T}from"./VDialog-DqKiqDax.js";import{V as k,b as j,c as Q}from"./VCard-BiA97lVT.js";import{V as C}from"./VDivider-WLAIV-DU.js";import{V as S}from"./VCardText-DoVX-QJd.js";import{V as I}from"./VAlert-yAvAob2o.js";import{V as P,a as c}from"./VRow-UK6HLxDq.js";import{V as O}from"./VForm-BJxoMx6B.js";import{V as A,a as x}from"./VRadioGroup-BnjQuMVa.js";import{V as w}from"./VTextField-DXmaEfZ4.js";import{V as D}from"./VChip-Bj3ACeXx.js";import{V as z}from"./VTextarea-yuhz9gYQ.js";import{V as G}from"./VSpacer-DtkAI9Ug.js";import"./api-ZlW5HooK.js";import"./index-D-EbNoF1.js";import"./VOverlay-g3sGwM6m.js";import"./forwardRefs-B931MWyl.js";import"./VImg-CU4h0KVj.js";import"./VAvatar-BHyF1R0l.js";/* empty css              */import"./VSelectionControl-NuHx7gTk.js";const X={name:"StockUpdateModal",props:{show:{type:Boolean,default:!1},baseProduct:{type:Object,default:null}},emits:["close","updated"],setup(d,{emit:e}){const s=F(),a=q(!1),f=q(""),r=N({movement_type:"",quantity:"",reason:"",notes:"",reference_number:""}),o=()=>{if(!r.quantity||!d.baseProduct)return 0;const u=parseFloat(d.baseProduct.current_stock)||0,p=parseFloat(r.quantity)||0;switch(r.movement_type){case"stock_in":return u+p;case"stock_out":return Math.max(0,u-p);case"adjustment":return p;default:return u}},n=()=>{r.movement_type="",r.quantity="",r.reason="",r.notes="",r.reference_number="",f.value=""},V=async()=>{if(!r.movement_type||!r.quantity){f.value="Please fill in all required fields";return}if(r.quantity<0){f.value="Quantity must be 0 or greater";return}a.value=!0,f.value="";try{const u={movement_type:r.movement_type,quantity:Number(r.quantity),reason:r.reason||null,notes:r.notes||null,reference_number:r.reference_number||null};await s.updateStock(d.baseProduct.id,u),e("updated"),e("close"),n()}catch(u){f.value=u.message||"Failed to update stock"}finally{a.value=!1}};return U(()=>d.show,u=>{u&&n()}),{loading:a,error:f,form:r,calculateNewStock:o,handleSubmit:V,resetForm:n}}},E={class:"text-h6 font-weight-bold"},H={class:"text-h6 font-weight-bold"},J={class:"text-subtitle-1 font-weight-bold"};function K(d,e,s,a,f,r){return _(),v(T,{"model-value":s.show,"max-width":"600px",persistent:"","onUpdate:modelValue":e[7]||(e[7]=o=>!o&&d.$emit("close"))},{default:l(()=>[t(k,null,{default:l(()=>[t(j,{class:"d-flex align-center gap-2"},{default:l(()=>{var o;return[t(B,{icon:"tabler-package",class:"text-primary"}),i("span",null,"Update Stock - "+m((o=s.baseProduct)==null?void 0:o.name),1)]}),_:1}),t(C),t(S,null,{default:l(()=>[a.error?(_(),v(I,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-4","onClick:close":e[0]||(e[0]=o=>a.error="")},{default:l(()=>[b(m(a.error),1)]),_:1})):y("",!0),t(k,{variant:"tonal",color:"info",class:"mb-4"},{default:l(()=>[t(S,null,{default:l(()=>[e[10]||(e[10]=i("div",{class:"text-subtitle-2 mb-2"},"Current Information",-1)),t(P,null,{default:l(()=>[t(c,{cols:"6"},{default:l(()=>{var o,n;return[e[8]||(e[8]=i("div",{class:"text-caption text-medium-emphasis"},"Current Stock:",-1)),i("div",E,m(((o=s.baseProduct)==null?void 0:o.current_stock)||0)+" "+m((n=s.baseProduct)==null?void 0:n.unit),1)]}),_:1,__:[8]}),t(c,{cols:"6"},{default:l(()=>{var o,n;return[e[9]||(e[9]=i("div",{class:"text-caption text-medium-emphasis"},"Min Stock:",-1)),i("div",H,m(((o=s.baseProduct)==null?void 0:o.min_stock)||0)+" "+m((n=s.baseProduct)==null?void 0:n.unit),1)]}),_:1,__:[9]})]),_:1})]),_:1,__:[10]})]),_:1}),t(O,{onSubmit:M(a.handleSubmit,["prevent"])},{default:l(()=>[t(P,null,{default:l(()=>[t(c,{cols:"12"},{default:l(()=>[t(A,{modelValue:a.form.movement_type,"onUpdate:modelValue":e[1]||(e[1]=o=>a.form.movement_type=o),label:"Movement Type",required:"",rules:[o=>!!o||"Movement type is required"]},{default:l(()=>[t(x,{label:"Stock In (+)",value:"stock_in"}),t(x,{label:"Stock Out (-)",value:"stock_out"}),t(x,{label:"Stock Adjustment",value:"adjustment"})]),_:1},8,["modelValue","rules"])]),_:1}),t(c,{cols:"12"},{default:l(()=>{var o;return[t(w,{modelValue:a.form.quantity,"onUpdate:modelValue":e[2]||(e[2]=n=>a.form.quantity=n),label:a.form.movement_type==="adjustment"?"New Stock Quantity":"Quantity",type:"number",step:"0.001",min:"0",variant:"outlined",required:"",suffix:(o=s.baseProduct)==null?void 0:o.unit,rules:[n=>!!n||"Quantity is required",n=>n>=0||"Quantity must be 0 or greater"]},null,8,["modelValue","label","suffix","rules"]),a.form.quantity&&a.form.movement_type?(_(),v(k,{key:0,variant:"tonal",color:"success",class:"mt-2"},{default:l(()=>[t(S,{class:"py-2"},{default:l(()=>{var n,V;return[e[12]||(e[12]=i("div",{class:"text-caption"},"New stock will be:",-1)),i("div",J,[b(m(a.calculateNewStock())+" "+m((n=s.baseProduct)==null?void 0:n.unit)+" ",1),a.calculateNewStock()<(((V=s.baseProduct)==null?void 0:V.min_stock)||0)?(_(),v(D,{key:0,color:"error",size:"small",variant:"tonal",class:"ml-2"},{default:l(()=>e[11]||(e[11]=[b(" Below minimum ")])),_:1,__:[11]})):y("",!0)])]}),_:1,__:[12]})]),_:1})):y("",!0)]}),_:1}),t(c,{cols:"12"},{default:l(()=>[t(w,{modelValue:a.form.reason,"onUpdate:modelValue":e[3]||(e[3]=o=>a.form.reason=o),label:"Reason",variant:"outlined",placeholder:"Reason for stock movement"},null,8,["modelValue"])]),_:1}),t(c,{cols:"12"},{default:l(()=>[t(z,{modelValue:a.form.notes,"onUpdate:modelValue":e[4]||(e[4]=o=>a.form.notes=o),label:"Notes",variant:"outlined",rows:"3",placeholder:"Optional notes for this stock movement"},null,8,["modelValue"])]),_:1}),t(c,{cols:"12"},{default:l(()=>[t(w,{modelValue:a.form.reference_number,"onUpdate:modelValue":e[5]||(e[5]=o=>a.form.reference_number=o),label:"Reference Number",variant:"outlined",placeholder:"Optional reference number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),t(C),t(Q,null,{default:l(()=>[t(G),t(g,{variant:"outlined",onClick:e[6]||(e[6]=o=>d.$emit("close"))},{default:l(()=>e[13]||(e[13]=[b(" Cancel ")])),_:1,__:[13]}),t(g,{color:"primary",loading:a.loading,onClick:a.handleSubmit},{default:l(()=>e[14]||(e[14]=[b(" Update Stock ")])),_:1,__:[14]},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const _e=R(X,[["render",K],["__scopeId","data-v-eb7e9f83"]]);export{_e as default};
