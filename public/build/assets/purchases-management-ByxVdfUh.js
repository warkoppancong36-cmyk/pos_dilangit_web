import{g as H}from"./auth-a9M5ekjn.js";import{d as _e,V as W,r as w,w as pe,D as qe,g as F,o as b,f as t,b as e,e as a,X as K,s as _,c as M,l as D,t as u,a0 as q,ap as Ue,aq as Ne,i as Se,p as Pe,F as Te,aA as Q,b9 as Ce,v as De}from"./main-JzQIkBR4.js";import{V as ye}from"./VDialog-CnInoHBg.js";import{b as X,V as $,c as he}from"./VCard-Cm2ybfyl.js";import{V as U}from"./VCardText-N9WsQ_Cb.js";import{V as je}from"./VForm-D97RjHWQ.js";import{V as Y,a as x}from"./VRow-D-i4BTmq.js";import{V as me}from"./VSelect-BgLsoWpZ.js";import{a as oe,b as ne,d as $e,V as Ae}from"./VList-DNQSp84Q.js";import{V as G}from"./VTextField-NL4CS3vX.js";import{V as Fe}from"./VTextarea-Cjrix0KU.js";import{V as ze}from"./VTable-CHocMsl3.js";import{V as Re}from"./VAutocomplete-ChypIN24.js";import{V as ve}from"./VDivider-CjU0MPRf.js";import{V as be}from"./VSpacer-rbIEEdgT.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ee}from"./VChip-Dr-hGTp_.js";import{V as Be,a as Ee}from"./VDataTable-KoTVohsx.js";import{V as Oe}from"./VContainer-BgOYF5rs.js";import{V as Me}from"./VDataTableServer-CMYhXQr6.js";import{V as Le}from"./VMenu-BUci2k3_.js";import{V as Qe}from"./VSnackbar-oqMQ5bec.js";import"./VOverlay-b1t0bcDS.js";import"./forwardRefs-B931MWyl.js";import"./VImg-gPqfIc_S.js";import"./VAvatar-V-klQw3i.js";/* empty css              */import"./VCheckboxBtn-CCYggzAN.js";import"./filter-DdQI8WPV.js";const He={class:"d-flex align-center gap-2"},Ke={class:"d-flex flex-column"},Ge={key:0,class:"text-caption text-medium-emphasis"},Xe={class:"mt-6"},Je={class:"d-flex justify-space-between align-center mb-4"},We={key:0},Ye={class:"text-center font-weight-medium"},Ze={class:"text-center font-weight-medium"},et={class:"text-end"},tt={class:"d-flex justify-space-between mb-2"},at={class:"font-weight-medium"},lt={class:"d-flex justify-space-between mb-2"},st={class:"text-success"},ot={class:"d-flex justify-space-between"},nt={class:"text-h6 font-weight-bold text-primary"},it=_e({__name:"PurchaseDialog",props:{modelValue:{type:Boolean},purchase:{default:null},mode:{default:"create"}},emits:["update:modelValue","saved"],setup(te,{emit:J}){const p=te,E=J,z=W({get:()=>p.modelValue,set:i=>E("update:modelValue",i)}),S=w(),P=w(!1),I=w(!1),k=w(!1),N=w(!1),R=w([]),T=w([]),v=w({id_supplier:null,purchase_date:new Date().toISOString().split("T")[0],notes:"",discount_amount:0,discount_amount_display:"0",items:[]}),c=W(()=>p.mode==="edit"?"Edit Purchase Order":"Buat Purchase Order Baru"),n=W(()=>{const i=v.value.items.reduce((r,g)=>r+(g.total_cost||0),0),s=Number.parseFloat(String(v.value.discount_amount_display).replace(/\D/g,""))||0,l=0,o=i-s+l;return console.log("ðŸ’° Totals calculation:",{subtotal:i,discount:s,tax:l,total:o}),{subtotal:i,discount:s,tax:l,total:o}}),y=W(()=>P.value&&v.value.items.length>0&&v.value.items.every(i=>i.id_item&&i.quantity>0&&i.unit_cost>0)),j={required:i=>!!i||"Field ini wajib diisi"},C=async()=>{try{k.value=!0;const i=H(),s={"Content-Type":"application/json",Accept:"application/json"};i&&(s.Authorization=`Bearer ${i}`);const l=await Q.get("/api/suppliers",{headers:s});R.value=l.data.data||[],console.log("ðŸ“‹ Suppliers loaded:",R.value.length,"suppliers"),console.log("ðŸ“‹ First supplier sample:",R.value[0])}catch(i){console.error("Error loading suppliers:",i)}finally{k.value=!1}},O=async()=>{var i;try{N.value=!0;const s=H();console.log("Loading items with token:",s?"Token found":"No token");const l={"Content-Type":"application/json",Accept:"application/json"};s&&(l.Authorization=`Bearer ${s}`),console.log("Making request to /api/items");const o=await Q.get("/api/items?per_page=all",{headers:l});console.log("Items response:",o.data);const r=o.data.data;r&&r.data?T.value=r.data||[]:T.value=o.data.data||[],console.log("Items loaded:",T.value.length,"items")}catch(s){console.error("Error loading items:",s),console.error("Error response:",(i=s.response)==null?void 0:i.data)}finally{N.value=!1}},L=i=>{try{const s=v.value.items[i];if(!s){console.warn("Item not found at index:",i);return}s.quantity>0&&s.total_cost>0?(s.unit_cost=s.total_cost/s.quantity,s.unit_cost_display=B(s.unit_cost).replace("Rp ","").replace(/\./g,"")):(s.unit_cost=0,s.unit_cost_display="0"),console.log(`Item ${i} unit cost calculated:`,s.unit_cost)}catch(s){console.error("Error in calculateUnitCost:",s)}},ie=i=>{try{const s=v.value.items[i];if(!s){console.warn("Item not found at index:",i);return}s.quantity>0&&s.unit_cost>0?(s.total_cost=s.quantity*s.unit_cost,s.total_cost_display=new Intl.NumberFormat("id-ID").format(s.total_cost)):(s.total_cost=0,s.total_cost_display="0"),console.log(`Item ${i} total cost calculated:`,s.total_cost)}catch(s){console.error("Error in calculateTotalCost:",s)}},re=(i,s)=>{try{const l=v.value.items[i];if(!l||!s)return;const o=T.value.find(r=>r.id_item===s);o&&(l.unit=o.unit||"",console.log(`Item ${i} unit set to:`,l.unit))}catch(l){console.error("Error in onItemChange:",l)}},ae=()=>{try{console.log("Adding new item..."),console.log("Current items count:",v.value.items.length);const i={id_item:null,quantity:0,unit:"",unit_cost:0,unit_cost_display:"0",total_cost:0,total_cost_display:"0"};v.value.items.push(i),console.log("Item added successfully. New count:",v.value.items.length)}catch(i){console.error("Error in addItem:",i)}},le=i=>{v.value.items.splice(i,1)},f=(i,s)=>{var r;const l=(r=s.target)==null?void 0:r.value,o=v.value.items[i];l===""||l===null||l===void 0?o.quantity=0:o.quantity=Number.parseFloat(l)||1,ie(i)},m=(i,s)=>{var g;const l=(g=s.target)==null?void 0:g.value,o=(l==null?void 0:l.replace(/\D/g,""))||"",r=v.value.items[i];o===""?(r.total_cost=0,r.total_cost_display="0"):(r.total_cost=Number.parseFloat(o),r.total_cost_display=new Intl.NumberFormat("id-ID").format(r.total_cost)),L(i)},d=i=>{var o;const s=(o=i.target)==null?void 0:o.value,l=(s==null?void 0:s.replace(/\D/g,""))||"";l===""?v.value.discount_amount_display="0":v.value.discount_amount_display=new Intl.NumberFormat("id-ID").format(Number.parseInt(l))},h=()=>{},B=i=>Number.isNaN(i)||i===null||i===void 0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(i),Z=()=>{var i,s,l,o;if(console.log("ðŸ” initializeForm called"),console.log("ðŸ“ Mode:",p.mode),console.log("ðŸ’¾ Purchase data:",p.purchase),p.mode==="edit"&&p.purchase){console.log("âœ… Initializing form for edit mode"),console.log("ï¿½ All purchase properties:",Object.keys(p.purchase)),console.log("ï¿½ðŸ‘¤ Supplier ID from purchase:",p.purchase.id_supplier),console.log("ï¿½ Supplier object from purchase:",p.purchase.supplier),console.log("ðŸ‘¤ Supplier_id from purchase:",p.purchase.supplier_id),console.log("ï¿½ðŸ“¦ Items from purchase:",p.purchase.items);const r=p.purchase.supplier_id||p.purchase.id_supplier||((i=p.purchase.supplier)==null?void 0:i.id_supplier)||((s=p.purchase.supplier)==null?void 0:s.id);console.log("ðŸŽ¯ Raw supplier ID:",r,"type:",typeof r);const g=r?Number.parseInt(String(r)):null;if(console.log("ðŸŽ¯ Converted supplier ID:",g),console.log("ðŸ“¦ Items from purchase:",p.purchase.items),p.purchase.items&&p.purchase.items.length>0){const V=p.purchase.items[0];console.log("ï¿½ First item debug:",{quantity:V.quantity,quantity_ordered:V.quantity_ordered,unit_cost:V.unit_cost,total_cost:V.total_cost,item_id:((l=V.item)==null?void 0:l.id_item)||V.id_item})}console.log("ðŸ“… Original purchase_date:",p.purchase.purchase_date),console.log("ðŸ“… Purchase_date type:",typeof p.purchase.purchase_date);const A=p.purchase.purchase_date?new Date(p.purchase.purchase_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0];console.log("ðŸ“… Formatted purchase_date:",A),v.value={id_supplier:g,purchase_date:A,notes:p.purchase.notes||"",discount_amount:p.purchase.discount_amount||0,discount_amount_display:new Intl.NumberFormat("id-ID").format(p.purchase.discount_amount||0),items:((o=p.purchase.items)==null?void 0:o.map(V=>{var we,ke,xe,Ie;console.log("ðŸ”„ Mapping item:",V),console.log("ðŸ“Š Item quantity_ordered:",V.quantity_ordered),console.log("ðŸ“Š Item quantity:",V.quantity);const fe=Number.parseFloat(V.quantity_ordered||V.quantity||0)||0,ce=Number.parseFloat(V.unit_cost||0)||0,ge=fe*ce;return console.log("ðŸ“Š Calculated - quantity:",fe,"unitCost:",ce,"totalCost:",ge),console.log("ðŸ·ï¸ Item unit debug:",{item_unit:(we=V.item)==null?void 0:we.unit,direct_unit:V.unit,item_id:((ke=V.item)==null?void 0:ke.id_item)||V.id_item}),{id_item:((xe=V.item)==null?void 0:xe.id_item)||V.id_item,quantity:fe,unit:((Ie=V.item)==null?void 0:Ie.unit)||V.unit||"",unit_cost:ce,unit_cost_display:new Intl.NumberFormat("id-ID").format(ce),total_cost:ge,total_cost_display:new Intl.NumberFormat("id-ID").format(ge)}}))||[]},console.log("ðŸ“‹ Form data after initialization:",v.value)}else console.log("ðŸ†• Initializing form for create mode"),v.value={id_supplier:null,purchase_date:new Date().toISOString().split("T")[0],notes:"",discount_amount:0,discount_amount_display:"0",items:[]}},se=async()=>{var i,s,l;if((i=S.value)!=null&&i.validate())try{I.value=!0;const o=H(),r={"Content-Type":"application/json",Accept:"application/json"};o&&(r.Authorization=`Bearer ${o}`);const g={supplier_id:v.value.id_supplier,purchase_date:v.value.purchase_date,notes:v.value.notes,discount_amount:Number.parseFloat(v.value.discount_amount_display.replace(/\D/g,""))||0,items:v.value.items.map(A=>({id_item:A.id_item,quantity:A.quantity,unit_cost:A.unit_cost}))};p.mode==="edit"?await Q.put(`/api/purchases/${p.purchase.id_purchase}`,g,{headers:r}):await Q.post("/api/purchases",g,{headers:r}),E("saved")}catch(o){console.error("Error saving purchase:",o),console.error("Error saving purchase:",((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.message)||o.message)}finally{I.value=!1}},ue=()=>{z.value=!1},de=()=>{v.value.items.forEach((i,s)=>{if(i.id_item&&!i.unit){const l=T.value.find(o=>o.id_item===i.id_item);l&&(i.unit=l.unit,console.log(`ðŸ”„ Updated unit for item ${s}:`,i.unit))}})};return pe(()=>p.modelValue,async i=>{i&&(await Promise.all([C(),O()]),await Ce(),Z(),de())}),pe(()=>p.purchase,async i=>{i&&p.mode==="edit"&&(R.value.length===0&&await C(),T.value.length===0&&await O(),await Ce(),Z(),de())},{deep:!0,immediate:!0}),qe(()=>{C(),O()}),(i,s)=>(b(),F(ye,{modelValue:z.value,"onUpdate:modelValue":s[5]||(s[5]=l=>z.value=l),"max-width":"1200",persistent:""},{default:t(()=>[e($,null,{default:t(()=>[e(X,{class:"d-flex align-center justify-space-between"},{default:t(()=>{var l;return[a("div",He,[e(K,null,{default:t(()=>s[6]||(s[6]=[_("mdi-cart-plus")])),_:1,__:[6]}),a("div",Ke,[a("span",null,u(c.value),1),p.mode==="edit"&&((l=p.purchase)!=null&&l.purchase_number)?(b(),M("span",Ge," No. Order: "+u(p.purchase.purchase_number),1)):D("",!0)])]),e(q,{icon:"mdi-close",size:"small",variant:"text",onClick:ue})]}),_:1}),e(U,null,{default:t(()=>[e(je,{ref_key:"form",ref:S,modelValue:P.value,"onUpdate:modelValue":s[3]||(s[3]=l=>P.value=l)},{default:t(()=>[e(Y,null,{default:t(()=>[e(x,{cols:"12",md:"6"},{default:t(()=>[e(me,{modelValue:v.value.id_supplier,"onUpdate:modelValue":s[0]||(s[0]=l=>v.value.id_supplier=l),label:"Supplier *",items:R.value,"item-title":"name","item-value":"id_supplier",variant:"outlined",rules:[j.required],loading:k.value},{item:t(({props:l,item:o})=>[e(oe,Ue(Ne(l)),{default:t(()=>[e(ne,null,{default:t(()=>[_(u(o.raw.name),1)]),_:2},1024),e($e,null,{default:t(()=>[_(u(o.raw.phone)+" - "+u(o.raw.email),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","rules","loading"])]),_:1}),e(x,{cols:"12",md:"3"},{default:t(()=>[e(G,{modelValue:v.value.purchase_date,"onUpdate:modelValue":s[1]||(s[1]=l=>v.value.purchase_date=l),label:"Tanggal Purchase *",type:"date",variant:"outlined",rules:[j.required]},null,8,["modelValue","rules"])]),_:1}),e(x,{cols:"12"},{default:t(()=>[e(Fe,{modelValue:v.value.notes,"onUpdate:modelValue":s[2]||(s[2]=l=>v.value.notes=l),label:"Catatan",variant:"outlined",rows:"2",placeholder:"Catatan tambahan untuk purchase order ini..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a("div",Xe,[a("div",Je,[s[9]||(s[9]=a("h3",{class:"text-h6"}," Items Purchase ",-1)),e(q,{color:"primary",variant:"tonal",onClick:ae},{default:t(()=>[e(K,{start:""},{default:t(()=>s[7]||(s[7]=[_(" mdi-plus ")])),_:1,__:[7]}),s[8]||(s[8]=_(" Tambah Item "))]),_:1,__:[8]})]),e($,{variant:"outlined"},{default:t(()=>[e(ze,null,{default:t(()=>[s[11]||(s[11]=a("thead",null,[a("tr",null,[a("th",{style:{"inline-size":"35%"}}," Item "),a("th",{style:{"inline-size":"12%"}}," Quantity "),a("th",{style:{"inline-size":"10%"}}," Unit "),a("th",{style:{"inline-size":"15%"}}," Total Harga "),a("th",{style:{"inline-size":"15%"}}," Harga Satuan "),a("th",{style:{"inline-size":"13%"}}," Action ")])],-1)),a("tbody",null,[v.value.items.length===0?(b(),M("tr",We,s[10]||(s[10]=[a("td",{colspan:"6",class:"text-center py-8 text-medium-emphasis"},' Belum ada item. Klik "Tambah Item" untuk menambah item purchase. ',-1)]))):D("",!0),(b(!0),M(Te,null,Se(v.value.items,(l,o)=>(b(),M("tr",{key:o},[a("td",null,[e(Re,{modelValue:l.id_item,"onUpdate:modelValue":[r=>l.id_item=r,r=>re(o,r)],label:"Pilih Item",items:T.value,"item-title":"name","item-value":"id_item",variant:"outlined",density:"compact",loading:N.value,clearable:"","no-data-text":"Tidak ada item ditemukan"},{item:t(({props:r,item:g})=>[e(oe,Pe({ref_for:!0},r),{default:t(()=>[e(ne,null,{default:t(()=>[_(u(g.raw.name),1)]),_:2},1024),e($e,null,{default:t(()=>{var A;return[_(u((A=g.raw.category)==null?void 0:A.name)+" - SKU: "+u(g.raw.sku),1)]}),_:2},1024)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","items","loading"])]),a("td",null,[e(G,{modelValue:l.quantity,"onUpdate:modelValue":r=>l.quantity=r,label:"Qty",type:"number",min:"1",step:"1",variant:"outlined",density:"compact",onInput:r=>f(o,r),onBlur:r=>L(o)},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur"])]),a("td",null,[a("div",Ye,u(l.unit||"-"),1)]),a("td",null,[e(G,{modelValue:l.total_cost_display,"onUpdate:modelValue":r=>l.total_cost_display=r,label:"Total Harga",variant:"outlined",density:"compact",prefix:"Rp",onInput:r=>m(o,r),onBlur:r=>L(o)},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur"])]),a("td",null,[a("div",Ze,u(B(l.unit_cost)),1)]),a("td",null,[e(q,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:r=>le(o)},null,8,["onClick"])])]))),128))])]),_:1,__:[11]})]),_:1}),e($,{class:"mt-4",variant:"outlined"},{default:t(()=>[e(U,null,{default:t(()=>[e(Y,null,{default:t(()=>[e(x,{cols:"12",md:"8"},{default:t(()=>[e(G,{modelValue:v.value.discount_amount_display,"onUpdate:modelValue":s[4]||(s[4]=l=>v.value.discount_amount_display=l),label:"Diskon",variant:"outlined",prefix:"Rp",placeholder:"0",onInput:d,onBlur:h},null,8,["modelValue"])]),_:1}),e(x,{cols:"12",md:"4"},{default:t(()=>[a("div",et,[a("div",tt,[s[12]||(s[12]=a("span",null,"Subtotal:",-1)),a("span",at,u(B(n.value.subtotal)),1)]),a("div",lt,[s[13]||(s[13]=a("span",null,"Diskon:",-1)),a("span",st,"-"+u(B(n.value.discount)),1)]),e(ve,{class:"my-2"}),a("div",ot,[s[14]||(s[14]=a("span",{class:"text-h6 font-weight-bold"},"Total:",-1)),a("span",nt,u(B(n.value.total)),1)])])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),e(he,{class:"pa-4"},{default:t(()=>[e(be),e(q,{variant:"text",onClick:ue},{default:t(()=>s[15]||(s[15]=[_(" Batal ")])),_:1,__:[15]}),e(q,{color:"primary",loading:I.value,disabled:!y.value,onClick:se},{default:t(()=>[_(u(i.mode==="edit"?"Update":"Simpan"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),rt=Ve(it,[["__scopeId","data-v-a6bd7924"]]),ut={class:"d-flex align-center gap-3"},dt={class:"d-flex justify-space-between align-center"},ct={class:"text-h6"},pt={class:"text-body-1"},mt={class:"font-weight-medium"},vt={class:"text-caption text-medium-emphasis"},_t={class:"font-weight-medium"},ft={class:"d-flex justify-space-between"},gt={class:"font-weight-medium"},yt=_e({__name:"PurchaseReceiveDialog",props:{modelValue:{type:Boolean},purchase:{}},emits:["update:modelValue","success"],setup(te,{emit:J}){const p=te,E=J,z=w(!1),S=w(!1),P=w(new Date().toISOString().split("T")[0]),I=w([]),k=W({get:()=>p.modelValue,set:f=>E("update:modelValue",f)}),N=W(()=>P.value&&n()>0&&!S.value),R=[{title:"Item",key:"item_name",sortable:!1,width:"250px"},{title:"Ordered",key:"quantity_ordered",sortable:!1,width:"110px"},{title:"Received",key:"quantity_received",sortable:!1,width:"110px"},{title:"Remaining",key:"remaining",sortable:!1,width:"110px"},{title:"Receive Qty",key:"receive_quantity",sortable:!1,width:"140px"},{title:"Quality",key:"quality_check",sortable:!1,width:"140px"},{title:"Notes",key:"notes",sortable:!1,width:"200px"},{title:"Status",key:"status",sortable:!1,width:"120px"}],T=[{title:"âœ… Good",value:"good"},{title:"âŒ Damaged",value:"damaged"},{title:"â° Expired",value:"expired"},{title:"âš ï¸ Issues",value:"partial"}],v=f=>f.quantity_ordered-(f.quantity_received||0),c=f=>{const m=v(f);return m<=0?"text-success":m<f.quantity_ordered*.5?"text-warning":""},n=()=>I.value.filter(f=>f.receive_quantity&&f.receive_quantity>0).length,y=f=>{const m=v(f);f.receive_quantity>m&&(f.receive_quantity=m),f.receive_quantity<0&&(f.receive_quantity=0)},j=f=>({pending:"warning",ordered:"info",partial:"primary",received:"success",completed:"success",cancelled:"error"})[f]||"default",C=f=>({pending:"Pending",ordered:"Ordered",partial:"Partial",received:"Received",completed:"Completed",cancelled:"Cancelled"})[f]||f,O=f=>({pending:"warning",partial:"primary",received:"success"})[f]||"default",L=f=>({pending:"Pending",partial:"Partial",received:"Complete"})[f]||f,ie=f=>new Date(f).toLocaleDateString("id-ID"),re=async()=>{var f,m;if((f=p.purchase)!=null&&f.id_purchase){z.value=!0;try{if(console.log("Purchase props:",p.purchase),p.purchase.items&&p.purchase.items.length>0){console.log("Using items from props:",p.purchase.items),I.value=p.purchase.items.map(h=>({...h,receive_quantity:0,quality_condition:"good",receive_notes:""})),z.value=!1;return}console.log("Fetching items from API...");const d=await Q.get(`/api/purchases/${p.purchase.id_purchase}`,{headers:{Authorization:`Bearer ${H()}`}});console.log("API Response:",d.data),d.data.success&&((m=d.data.data)!=null&&m.items)&&(console.log("Using items from API data.data:",d.data.data.items),I.value=d.data.data.items.map(h=>({...h,receive_quantity:0,quality_condition:"good",receive_notes:""})))}catch(d){console.error("Error loading purchase items:",d)}finally{z.value=!1}}},ae=async()=>{if(!N.value)return;const f=I.value.filter(m=>m.receive_quantity&&m.receive_quantity>0).map(m=>({id_purchase_item:m.id_purchase_item,quantity_received:m.receive_quantity,quality_check:{condition:m.quality_condition,checked_at:new Date().toISOString(),checked_by:"current_user"},notes:m.receive_notes||null}));if(f.length!==0){S.value=!0;try{const m=await Q.post(`/api/purchases/${p.purchase.id_purchase}/receive`,{items:f,delivery_date:P.value},{headers:{Authorization:`Bearer ${H()}`}});m.data.success&&(E("success",m.data),le())}catch(m){console.error("Error receiving items:",m)}finally{S.value=!1}}},le=()=>{k.value=!1,I.value=[],P.value=new Date().toISOString().split("T")[0]};return pe(k,f=>{f&&p.purchase&&re()}),(f,m)=>(b(),F(ye,{modelValue:k.value,"onUpdate:modelValue":m[1]||(m[1]=d=>k.value=d),"max-width":"1400px",persistent:""},{default:t(()=>[e($,null,{default:t(()=>[e(X,{class:"pa-4"},{default:t(()=>{var d;return[a("div",ut,[e(K,{icon:"mdi-package-variant"}),a("span",null,"Receive Items - Purchase #"+u((d=f.purchase)==null?void 0:d.purchase_number),1)])]}),_:1}),e(ve),e(U,{class:"pa-4"},{default:t(()=>[e($,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(U,{class:"pa-3"},{default:t(()=>{var d,h,B,Z;return[a("div",dt,[a("div",null,[m[2]||(m[2]=a("div",{class:"text-body-2 text-medium-emphasis"}," Supplier ",-1)),a("div",ct,u((h=(d=f.purchase)==null?void 0:d.supplier)==null?void 0:h.name),1)]),a("div",null,[m[3]||(m[3]=a("div",{class:"text-body-2 text-medium-emphasis"}," Order Date ",-1)),a("div",pt,u(ie((B=f.purchase)==null?void 0:B.purchase_date)),1)]),a("div",null,[m[4]||(m[4]=a("div",{class:"text-body-2 text-medium-emphasis"}," Status ",-1)),e(ee,{color:j((Z=f.purchase)==null?void 0:Z.status),variant:"tonal",size:"small"},{default:t(()=>{var se;return[_(u(C((se=f.purchase)==null?void 0:se.status)),1)]}),_:1},8,["color"])])])]}),_:1})]),_:1}),e(Y,{class:"mb-4"},{default:t(()=>[e(x,{cols:"12",md:"6"},{default:t(()=>[e(G,{modelValue:P.value,"onUpdate:modelValue":m[0]||(m[0]=d=>P.value=d),label:"Delivery Date",type:"date",variant:"outlined",rules:[d=>!!d||"Delivery date is required"],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),m[7]||(m[7]=a("div",{class:"text-h6 mb-3"}," Items to Receive ",-1)),e(Be,{headers:R,items:I.value,loading:z.value,"item-key":"id_purchase_item",class:"border rounded",density:"compact"},{"item.item_name":t(({item:d})=>{var h,B;return[a("div",null,[a("div",mt,u((h=d.item)==null?void 0:h.name),1),a("div",vt,u((B=d.item)==null?void 0:B.item_code),1)])]}),"item.quantity_ordered":t(({item:d})=>{var h;return[a("span",_t,u(parseInt(d.quantity_ordered))+" "+u((h=d.item)==null?void 0:h.unit),1)]}),"item.quantity_received":t(({item:d})=>{var h;return[a("span",{class:De(d.quantity_received>0?"text-success":"")},u(d.quantity_received||0)+" "+u((h=d.item)==null?void 0:h.unit),3)]}),"item.remaining":t(({item:d})=>{var h;return[a("span",{class:De(["font-weight-medium",c(d)])},u(v(d))+" "+u((h=d.item)==null?void 0:h.unit),3)]}),"item.receive_quantity":t(({item:d})=>[e(G,{modelValue:d.receive_quantity,"onUpdate:modelValue":h=>d.receive_quantity=h,modelModifiers:{number:!0},type:"number",min:0,max:v(d),step:"0.001",density:"compact",variant:"outlined",style:{"inline-size":"140px"},disabled:v(d)<=0,onInput:h=>y(d)},null,8,["modelValue","onUpdate:modelValue","max","disabled","onInput"])]),"item.quality_check":t(({item:d})=>[e(me,{modelValue:d.quality_condition,"onUpdate:modelValue":h=>d.quality_condition=h,items:T,density:"compact",variant:"outlined",style:{"inline-size":"140px"},disabled:!d.receive_quantity||d.receive_quantity<=0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.notes":t(({item:d})=>[e(G,{modelValue:d.receive_notes,"onUpdate:modelValue":h=>d.receive_notes=h,placeholder:"Notes...",density:"compact",variant:"outlined",style:{"inline-size":"200px"},disabled:!d.receive_quantity||d.receive_quantity<=0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.status":t(({item:d})=>[e(ee,{color:O(d.status),variant:"tonal",size:"small"},{default:t(()=>[_(u(L(d.status)),1)]),_:2},1032,["color"])]),_:1},8,["items","loading"]),e($,{variant:"outlined",class:"mt-4"},{default:t(()=>[e(U,{class:"pa-3"},{default:t(()=>[m[6]||(m[6]=a("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Receive Summary ",-1)),a("div",ft,[m[5]||(m[5]=a("span",null,"Items to receive:",-1)),a("span",gt,u(n()),1)])]),_:1,__:[6]})]),_:1})]),_:1,__:[7]}),e(ve),e(he,{class:"pa-4"},{default:t(()=>[e(be),e(q,{variant:"outlined",disabled:S.value,onClick:le},{default:t(()=>m[8]||(m[8]=[_(" Cancel ")])),_:1,__:[8]},8,["disabled"]),e(q,{color:"primary",loading:S.value,disabled:!N.value,onClick:ae},{default:t(()=>[e(K,{start:"",icon:"mdi-check"}),m[9]||(m[9]=_(" Confirm Receipt "))]),_:1,__:[9]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ht={class:"d-flex align-center gap-2"},bt={class:"mb-2"},Vt={class:"text-primary font-weight-medium"},wt={class:"mb-2"},kt={class:"mb-2"},xt={key:0,class:"mb-2"},It={key:1},Ct={class:"mb-2"},Dt={class:"mb-2"},$t={class:"mb-2"},qt={class:"mb-1 font-weight-medium"},St={key:0,class:"text-caption text-medium-emphasis mb-0"},Pt={key:1,class:"text-caption text-medium-emphasis mb-0"},Tt={class:"text-center"},zt={key:0},Ut={class:"text-right font-weight-medium"},Nt={class:"text-right font-weight-medium"},jt={class:"text-center"},At={class:"mb-0"},Ft={class:"mb-2"},Rt={key:0},Bt={class:"d-flex justify-space-between mb-2"},Et={class:"font-weight-medium"},Ot={key:0,class:"d-flex justify-space-between mb-2"},Mt={class:"text-success"},Lt={class:"d-flex justify-space-between"},Qt={class:"text-h6 font-weight-bold text-primary"},Ht=_e({__name:"PurchaseViewDialog",props:{modelValue:{type:Boolean},purchase:{default:null}},emits:["update:modelValue"],setup(te,{emit:J}){const p=te,E=J,z=W({get:()=>p.modelValue,set:c=>E("update:modelValue",c)}),S=W(()=>p.purchase&&p.purchase.status!=="cancelled"),P=()=>{z.value=!1},I=c=>{const n=typeof c=="string"?parseFloat(c):c;return isNaN(n)||n===null||n===void 0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(n)},k=c=>c?new Date(c).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"}):"-",N=c=>c?new Date(c).toLocaleString("id-ID",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",R=c=>({pending:"warning",partial:"info",received:"success",cancelled:"error"})[c]||"default",T=c=>({pending:"Pending",partial:"Sebagian",received:"Diterima",cancelled:"Dibatalkan"})[c]||c,v=()=>{window.print()};return(c,n)=>(b(),F(ye,{modelValue:z.value,"onUpdate:modelValue":n[0]||(n[0]=y=>z.value=y),"max-width":"900",persistent:""},{default:t(()=>[e($,null,{default:t(()=>[e(X,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",ht,[e(K,null,{default:t(()=>n[1]||(n[1]=[_("mdi-file-document-outline")])),_:1,__:[1]}),n[2]||(n[2]=a("span",null,"Purchase Order Detail",-1))]),e(q,{icon:"mdi-close",size:"small",variant:"text",onClick:P})]),_:1}),c.purchase?(b(),F(U,{key:0},{default:t(()=>[e(Y,{class:"mb-6"},{default:t(()=>[e(x,{cols:"12",md:"6"},{default:t(()=>[e($,{variant:"outlined"},{default:t(()=>[e(X,{class:"text-subtitle-1"},{default:t(()=>n[3]||(n[3]=[_("Purchase Information")])),_:1,__:[3]}),e(U,null,{default:t(()=>[a("div",bt,[n[4]||(n[4]=a("strong",null,"Purchase Number:",-1)),n[5]||(n[5]=a("br",null,null,-1)),a("span",Vt,u(c.purchase.purchase_number),1)]),a("div",wt,[n[6]||(n[6]=a("strong",null,"Status:",-1)),n[7]||(n[7]=a("br",null,null,-1)),e(ee,{color:R(c.purchase.status),size:"small",variant:"elevated"},{default:t(()=>[_(u(T(c.purchase.status)),1)]),_:1},8,["color"])]),a("div",kt,[n[8]||(n[8]=a("strong",null,"Tanggal Purchase:",-1)),n[9]||(n[9]=a("br",null,null,-1)),_(" "+u(k(c.purchase.purchase_date)),1)]),c.purchase.expected_delivery_date?(b(),M("div",xt,[n[10]||(n[10]=a("strong",null,"Tanggal Kirim Diharapkan:",-1)),n[11]||(n[11]=a("br",null,null,-1)),_(" "+u(k(c.purchase.expected_delivery_date)),1)])):D("",!0),c.purchase.actual_delivery_date?(b(),M("div",It,[n[12]||(n[12]=a("strong",null,"Tanggal Kirim Aktual:",-1)),n[13]||(n[13]=a("br",null,null,-1)),_(" "+u(k(c.purchase.actual_delivery_date)),1)])):D("",!0)]),_:1})]),_:1})]),_:1}),e(x,{cols:"12",md:"6"},{default:t(()=>[e($,{variant:"outlined"},{default:t(()=>[e(X,{class:"text-subtitle-1"},{default:t(()=>n[14]||(n[14]=[_("Supplier Information")])),_:1,__:[14]}),e(U,null,{default:t(()=>{var y,j,C,O;return[a("div",Ct,[n[15]||(n[15]=a("strong",null,"Nama Supplier:",-1)),n[16]||(n[16]=a("br",null,null,-1)),_(" "+u(((y=c.purchase.supplier)==null?void 0:y.name)||"-"),1)]),a("div",Dt,[n[17]||(n[17]=a("strong",null,"Telepon:",-1)),n[18]||(n[18]=a("br",null,null,-1)),_(" "+u(((j=c.purchase.supplier)==null?void 0:j.phone)||"-"),1)]),a("div",$t,[n[19]||(n[19]=a("strong",null,"Email:",-1)),n[20]||(n[20]=a("br",null,null,-1)),_(" "+u(((C=c.purchase.supplier)==null?void 0:C.email)||"-"),1)]),a("div",null,[n[21]||(n[21]=a("strong",null,"Alamat:",-1)),n[22]||(n[22]=a("br",null,null,-1)),_(" "+u(((O=c.purchase.supplier)==null?void 0:O.address)||"-"),1)])]}),_:1})]),_:1})]),_:1})]),_:1}),e($,{variant:"outlined",class:"mb-6"},{default:t(()=>[e(X,{class:"text-subtitle-1"},{default:t(()=>n[23]||(n[23]=[_("Items Purchase")])),_:1,__:[23]}),e(ze,null,{default:t(()=>[n[24]||(n[24]=a("thead",null,[a("tr",null,[a("th",null,"Item"),a("th",{class:"text-center"},"Qty"),a("th",{class:"text-right"},"Unit Cost"),a("th",{class:"text-right"},"Total Cost"),a("th",{class:"text-center"},"Status")])],-1)),a("tbody",null,[(b(!0),M(Te,null,Se(c.purchase.items,y=>{var j,C,O;return b(),M("tr",{key:y.id_purchase_item},[a("td",null,[a("div",null,[a("p",qt,u(((j=y.item)==null?void 0:j.name)||"-"),1),(C=y.item)!=null&&C.code?(b(),M("p",St," Code: "+u(y.item.code),1)):D("",!0),(O=y.item)!=null&&O.description?(b(),M("p",Pt,u(y.item.description),1)):D("",!0)])]),a("td",Tt,[e(ee,{size:"small",variant:"outlined"},{default:t(()=>[_(u(parseInt(y.quantity_ordered))+" "+u(y.unit||"pcs"),1)]),_:2},1024),y.quantity_received>0?(b(),M("br",zt)):D("",!0),y.quantity_received>0?(b(),F(ee,{key:1,size:"x-small",variant:"tonal",color:"success",class:"mt-1"},{default:t(()=>[_(" Received: "+u(parseInt(y.quantity_received)),1)]),_:2},1024)):D("",!0)]),a("td",Ut,u(I(y.unit_cost)),1),a("td",Nt,u(I(y.total_cost)),1),a("td",jt,[e(ee,{color:R(y.status),size:"small",variant:"tonal"},{default:t(()=>[_(u(T(y.status)),1)]),_:2},1032,["color"])])])}),128))])]),_:1,__:[24]})]),_:1}),e(Y,null,{default:t(()=>[e(x,{cols:"12",md:"6"},{default:t(()=>[c.purchase.notes?(b(),F($,{key:0,variant:"outlined"},{default:t(()=>[e(X,{class:"text-subtitle-1"},{default:t(()=>n[25]||(n[25]=[_("Catatan")])),_:1,__:[25]}),e(U,null,{default:t(()=>[a("p",At,u(c.purchase.notes),1)]),_:1})]),_:1})):D("",!0),e($,{variant:"outlined",class:"mt-4"},{default:t(()=>[e(X,{class:"text-subtitle-1"},{default:t(()=>n[26]||(n[26]=[_("Purchase History")])),_:1,__:[26]}),e(U,null,{default:t(()=>{var y,j;return[a("div",Ft,[n[27]||(n[27]=a("strong",null,"Dibuat oleh:",-1)),n[28]||(n[28]=a("br",null,null,-1)),_(" "+u(((y=c.purchase.creator)==null?void 0:y.name)||"-")+" â€¢ "+u(N(c.purchase.created_at)),1)]),c.purchase.updated_at&&c.purchase.updated_at!==c.purchase.created_at?(b(),M("div",Rt,[n[29]||(n[29]=a("strong",null,"Diupdate oleh:",-1)),n[30]||(n[30]=a("br",null,null,-1)),_(" "+u(((j=c.purchase.updater)==null?void 0:j.name)||"-")+" â€¢ "+u(N(c.purchase.updated_at)),1)])):D("",!0)]}),_:1})]),_:1})]),_:1}),e(x,{cols:"12",md:"6"},{default:t(()=>[e($,{variant:"outlined"},{default:t(()=>[e(X,{class:"text-subtitle-1"},{default:t(()=>n[31]||(n[31]=[_("Total Summary")])),_:1,__:[31]}),e(U,null,{default:t(()=>[a("div",Bt,[n[32]||(n[32]=a("span",null,"Subtotal:",-1)),a("span",Et,u(I(c.purchase.subtotal)),1)]),c.purchase.discount_amount>0?(b(),M("div",Ot,[n[33]||(n[33]=a("span",null,"Diskon:",-1)),a("span",Mt,"-"+u(I(c.purchase.discount_amount)),1)])):D("",!0),e(ve,{class:"my-3"}),a("div",Lt,[n[34]||(n[34]=a("span",{class:"text-h6 font-weight-bold"},"Total:",-1)),a("span",Qt,u(I(c.purchase.total_amount)),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):D("",!0),e(he,{class:"pa-4"},{default:t(()=>[e(be),e(q,{variant:"text",onClick:P},{default:t(()=>n[35]||(n[35]=[_(" Tutup ")])),_:1,__:[35]}),S.value?(b(),F(q,{key:0,color:"primary",variant:"tonal","prepend-icon":"mdi-printer",onClick:v},{default:t(()=>n[36]||(n[36]=[_(" Print ")])),_:1,__:[36]})):D("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Kt=Ve(Ht,[["__scopeId","data-v-da47fee6"]]),Gt={class:"d-flex justify-space-between align-center"},Xt={class:"d-flex justify-space-between align-center"},Jt={class:"text-h4 font-weight-bold text-white"},Wt={class:"d-flex justify-space-between align-center"},Yt={class:"text-h4 font-weight-bold text-white"},Zt={class:"d-flex justify-space-between align-center"},ea={class:"text-h4 font-weight-bold text-white"},ta={class:"d-flex justify-space-between align-center"},aa={class:"text-h4 font-weight-bold text-white"},la={class:"d-flex align-center"},sa={class:"mb-0 font-weight-medium"},oa={class:"text-caption text-medium-emphasis mb-0"},na={class:"font-weight-medium"},ia={class:"d-flex gap-1"},ra={class:"d-flex justify-center pt-2"},ua=_e({__name:"purchases-management",setup(te){const J=w([]),p=w([]),E=w({}),z=w(!1),S=w(1),P=w(15),I=w(0),k=w({show:!1,message:"",color:"success"}),N=w(!1),R=w(!1),T=w(!1),v=w(null),c=w("create"),n=w({search:"",status:"",supplier_id:"",start_date:"",end_date:""}),y=[{title:"Purchase Number",key:"purchase_number",sortable:!0},{title:"Supplier",key:"supplier.name",sortable:!1},{title:"Tanggal",key:"purchase_date",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Total",key:"total_amount",sortable:!0},{title:"Actions",key:"actions",sortable:!1,width:"150px"}],j=[{label:"Semua Status",value:""},{label:"Pending",value:"pending"},{label:"Ordered",value:"ordered"},{label:"Received",value:"received"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}],C=async()=>{var s,l;try{z.value=!0;const o={page:S.value,per_page:P.value};Object.keys(n.value).forEach(V=>{n.value[V]&&n.value[V]!==""&&(o[V]=n.value[V])});const r=H(),g={"Content-Type":"application/json",Accept:"application/json"};r&&(g.Authorization=`Bearer ${r}`);const A=await Q.get("/api/purchases",{params:o,headers:g});J.value=A.data.data.data||[],I.value=A.data.data.total||0}catch(o){console.error("Error loading purchases:",o),k.value={show:!0,message:"Error loading purchases: "+(((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.message)||o.message),color:"error"}}finally{z.value=!1}},O=async()=>{try{const s=H(),l={"Content-Type":"application/json",Accept:"application/json"};s&&(l.Authorization=`Bearer ${s}`);const o=await Q.get("/api/suppliers",{headers:l});p.value=o.data.data||[]}catch(s){console.error("Error loading suppliers:",s)}},L=async()=>{try{const s=H(),l={"Content-Type":"application/json",Accept:"application/json"};s&&(l.Authorization=`Bearer ${s}`);const o=await Q.get("/api/purchases/statistics",{headers:l});E.value=o.data.data||{}}catch(s){console.error("Error loading statistics:",s)}},ie=()=>{v.value=null,c.value="create",N.value=!0},re=s=>{console.log("ðŸ”§ editPurchase called with:",s),console.log("ðŸ‘¤ Purchase supplier ID:",s.id_supplier),console.log("ðŸ“¦ Purchase items:",s.items),v.value=s,c.value="edit",N.value=!0,console.log("ðŸ“‹ selectedPurchase set to:",v.value),console.log("ðŸŽ¯ dialogMode set to:",c.value)},ae=s=>{v.value=s,R.value=!0},le=s=>{v.value=s,T.value=!0},f=async s=>{var l,o;if(confirm(`Apakah Anda yakin ingin menghapus purchase ${s.purchase_number}?`))try{const r=H(),g={"Content-Type":"application/json",Accept:"application/json"};r&&(g.Authorization=`Bearer ${r}`),await Q.delete(`/api/purchases/${s.id_purchase}`,{headers:g}),C(),L()}catch(r){console.error("Error deleting purchase:",r),alert("Error deleting purchase: "+(((o=(l=r.response)==null?void 0:l.data)==null?void 0:o.message)||r.message))}},m=async(s,l)=>{var o,r;try{const g=H(),A={"Content-Type":"application/json",Accept:"application/json"};g&&(A.Authorization=`Bearer ${g}`),await Q.patch(`/api/purchases/${s.id_purchase}/status`,{status:l},{headers:A}),C(),L(),k.value={show:!0,message:`Purchase status berhasil diubah ke ${l}!`,color:"success"}}catch(g){console.error("Error updating purchase status:",g),k.value={show:!0,message:"Error updating status: "+(((r=(o=g.response)==null?void 0:o.data)==null?void 0:r.message)||g.message),color:"error"}}},d=()=>{N.value=!1,C(),L(),k.value={show:!0,message:c.value==="create"?"Purchase order berhasil dibuat!":"Purchase order berhasil diperbarui!",color:"success"}},h=()=>{T.value=!1,C(),L(),k.value={show:!0,message:"Items berhasil diterima!",color:"success"}},B=s=>{const l=typeof s=="string"?parseFloat(s):s;return isNaN(l)?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)},Z=s=>s?new Date(s).toLocaleDateString("id-ID"):"-",se=s=>({pending:"warning",ordered:"info",received:"primary",completed:"success",cancelled:"error"})[s]||"default",ue=s=>({pending:"Pending",ordered:"Dipesan",received:"Diterima",completed:"Selesai",cancelled:"Dibatalkan"})[s]||s,de=s=>["pending","ordered"].includes(s.status),i=s=>s.status==="pending";return pe(n,()=>{S.value=1,C()},{deep:!0}),qe(()=>{C(),O(),L()}),(s,l)=>(b(),F(Oe,{fluid:""},{default:t(()=>[e(Y,{class:"mb-4"},{default:t(()=>[e(x,{cols:"12"},{default:t(()=>[a("div",Gt,[l[15]||(l[15]=a("div",null,[a("h1",{class:"text-h4 font-weight-bold"},"Purchase Management"),a("p",{class:"text-body-1 text-medium-emphasis"},"Kelola pembelian barang dari supplier")],-1)),e(q,{color:"primary",size:"large",onClick:ie},{default:t(()=>[e(K,{start:""},{default:t(()=>l[13]||(l[13]=[_("mdi-plus")])),_:1,__:[13]}),l[14]||(l[14]=_(" Buat Purchase Order "))]),_:1,__:[14]})])]),_:1})]),_:1}),e(Y,{class:"mb-6"},{default:t(()=>[e(x,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e($,{color:"primary"},{default:t(()=>[e(U,null,{default:t(()=>[a("div",Xt,[a("div",null,[l[16]||(l[16]=a("p",{class:"text-caption text-white mb-1"},"Total Purchase",-1)),a("p",Jt,u(E.value.total_purchases||0),1)]),e(K,{size:"40",class:"text-white"},{default:t(()=>l[17]||(l[17]=[_("mdi-cart")])),_:1,__:[17]})])]),_:1})]),_:1})]),_:1}),e(x,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e($,{color:"warning"},{default:t(()=>[e(U,null,{default:t(()=>[a("div",Wt,[a("div",null,[l[18]||(l[18]=a("p",{class:"text-caption text-white mb-1"},"Pending",-1)),a("p",Yt,u(E.value.pending_purchases||0),1)]),e(K,{size:"40",class:"text-white"},{default:t(()=>l[19]||(l[19]=[_("mdi-clock")])),_:1,__:[19]})])]),_:1})]),_:1})]),_:1}),e(x,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e($,{color:"success"},{default:t(()=>[e(U,null,{default:t(()=>[a("div",Zt,[a("div",null,[l[20]||(l[20]=a("p",{class:"text-caption text-white mb-1"},"Completed",-1)),a("p",ea,u(E.value.completed_purchases||0),1)]),e(K,{size:"40",class:"text-white"},{default:t(()=>l[21]||(l[21]=[_("mdi-check-circle")])),_:1,__:[21]})])]),_:1})]),_:1})]),_:1}),e(x,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e($,{color:"info"},{default:t(()=>[e(U,null,{default:t(()=>[a("div",ta,[a("div",null,[l[22]||(l[22]=a("p",{class:"text-caption text-white mb-1"},"Bulan Ini",-1)),a("p",aa,u(B(E.value.total_amount_this_month||0)),1)]),e(K,{size:"40",class:"text-white"},{default:t(()=>l[23]||(l[23]=[_("mdi-currency-usd")])),_:1,__:[23]})])]),_:1})]),_:1})]),_:1})]),_:1}),e($,{class:"mb-6"},{default:t(()=>[e(U,null,{default:t(()=>[e(Y,null,{default:t(()=>[e(x,{cols:"12",md:"3"},{default:t(()=>[e(G,{modelValue:n.value.search,"onUpdate:modelValue":l[0]||(l[0]=o=>n.value.search=o),label:"Cari Purchase Number","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"","onClick:clear":l[1]||(l[1]=o=>n.value.search="")},null,8,["modelValue"])]),_:1}),e(x,{cols:"12",md:"2"},{default:t(()=>[e(me,{modelValue:n.value.status,"onUpdate:modelValue":l[2]||(l[2]=o=>n.value.status=o),label:"Status",items:j,"item-title":"label","item-value":"value",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(x,{cols:"12",md:"2"},{default:t(()=>[e(me,{modelValue:n.value.supplier_id,"onUpdate:modelValue":l[3]||(l[3]=o=>n.value.supplier_id=o),label:"Supplier",items:p.value,"item-title":"name","item-value":"id_supplier",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),e(x,{cols:"12",md:"2"},{default:t(()=>[e(G,{modelValue:n.value.start_date,"onUpdate:modelValue":l[4]||(l[4]=o=>n.value.start_date=o),label:"Tanggal Mulai",type:"date",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(x,{cols:"12",md:"2"},{default:t(()=>[e(G,{modelValue:n.value.end_date,"onUpdate:modelValue":l[5]||(l[5]=o=>n.value.end_date=o),label:"Tanggal Akhir",type:"date",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(x,{cols:"12",md:"1"},{default:t(()=>[e(q,{color:"primary",variant:"tonal",icon:"mdi-refresh",onClick:C})]),_:1})]),_:1})]),_:1})]),_:1}),e($,null,{default:t(()=>[e(Me,{"items-per-page":P.value,"onUpdate:itemsPerPage":l[7]||(l[7]=o=>P.value=o),page:S.value,"onUpdate:page":l[8]||(l[8]=o=>S.value=o),headers:y,items:J.value,"items-length":I.value,loading:z.value,"item-value":"id_purchase","onUpdate:options":C},{"item.purchase_number":t(({item:o})=>[a("div",la,[e(q,{variant:"text",color:"primary",size:"small",onClick:r=>ae(o)},{default:t(()=>[_(u(o.purchase_number),1)]),_:2},1032,["onClick"])])]),"item.supplier.name":t(({item:o})=>{var r,g;return[a("div",null,[a("p",sa,u(((r=o.supplier)==null?void 0:r.name)||"-"),1),a("p",oa,u(((g=o.supplier)==null?void 0:g.phone)||"-"),1)])]}),"item.purchase_date":t(({item:o})=>[_(u(Z(o.purchase_date)),1)]),"item.status":t(({item:o})=>[e(ee,{color:se(o.status),size:"small",variant:"elevated"},{default:t(()=>[_(u(ue(o.status)),1)]),_:2},1032,["color"])]),"item.total_amount":t(({item:o})=>[a("span",na,u(B(o.total_amount)),1)]),"item.actions":t(({item:o})=>[a("div",ia,[e(q,{icon:"mdi-eye",size:"small",variant:"text",color:"info",onClick:r=>ae(o)},null,8,["onClick"]),de(o)?(b(),F(q,{key:0,icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:r=>re(o)},null,8,["onClick"])):D("",!0),["ordered","received"].includes(o.status)?(b(),F(q,{key:1,icon:"mdi-truck-delivery",size:"small",variant:"text",color:"success",onClick:r=>le(o)},null,8,["onClick"])):D("",!0),i(o)?(b(),F(q,{key:2,icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:r=>f(o)},null,8,["onClick"])):D("",!0),e(Le,null,{activator:t(({props:r})=>[e(q,Pe({icon:"mdi-dots-vertical",size:"small",variant:"text"},r),null,16)]),default:t(()=>[e(Ae,null,{default:t(()=>[o.status==="pending"?(b(),F(oe,{key:0,onClick:r=>m(o,"ordered")},{default:t(()=>[e(ne,null,{default:t(()=>l[24]||(l[24]=[_("Mark as Ordered")])),_:1,__:[24]})]),_:2},1032,["onClick"])):D("",!0),o.status==="ordered"?(b(),F(oe,{key:1,onClick:r=>m(o,"received")},{default:t(()=>[e(ne,null,{default:t(()=>l[25]||(l[25]=[_("Mark as Received")])),_:1,__:[25]})]),_:2},1032,["onClick"])):D("",!0),o.status==="received"?(b(),F(oe,{key:2,onClick:r=>m(o,"completed")},{default:t(()=>[e(ne,null,{default:t(()=>l[26]||(l[26]=[_("Mark as Completed")])),_:1,__:[26]})]),_:2},1032,["onClick"])):D("",!0),["pending","ordered"].includes(o.status)?(b(),F(oe,{key:3,onClick:r=>m(o,"cancelled")},{default:t(()=>[e(ne,{class:"text-error"},{default:t(()=>l[27]||(l[27]=[_("Cancel Purchase")])),_:1,__:[27]})]),_:2},1032,["onClick"])):D("",!0)]),_:2},1024)]),_:2},1024)])]),bottom:t(()=>[a("div",ra,[e(Ee,{modelValue:S.value,"onUpdate:modelValue":l[6]||(l[6]=o=>S.value=o),length:Math.ceil(I.value/P.value),"total-visible":5},null,8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","items-length","loading"])]),_:1}),e(rt,{modelValue:N.value,"onUpdate:modelValue":l[9]||(l[9]=o=>N.value=o),purchase:v.value,mode:c.value,onSaved:d},null,8,["modelValue","purchase","mode"]),e(Kt,{modelValue:R.value,"onUpdate:modelValue":l[10]||(l[10]=o=>R.value=o),purchase:v.value},null,8,["modelValue","purchase"]),e(yt,{modelValue:T.value,"onUpdate:modelValue":l[11]||(l[11]=o=>T.value=o),purchase:v.value,onSuccess:h},null,8,["modelValue","purchase"]),e(Qe,{modelValue:k.value.show,"onUpdate:modelValue":l[12]||(l[12]=o=>k.value.show=o),color:k.value.color,timeout:4e3,location:"top right"},{default:t(()=>[_(u(k.value.message),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),Ra=Ve(ua,[["__scopeId","data-v-964b720f"]]);export{Ra as default};
