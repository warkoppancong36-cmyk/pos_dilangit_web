import{d as Ae,V as b,g as ae,f as i,b as o,e as u,X as se,t as L,$ as Fe,c as G,a0 as K,s as J,F as le,i as re,p as Oe,cs as Be,m as oe,l as pe,o as U,r as c,au as ne}from"./main-C0MrzgDC.js";import{f as ie}from"./helpers-B-vn2Qqf.js";import{V as Ee}from"./VDialog-D_xtC1kn.js";import{b as Me,V as ve,c as Ne}from"./VCard-CVYpAEPX.js";import{V as Te}from"./VCardText-Bh-EEvZY.js";import{V as qe}from"./VForm-DZzqbT1h.js";import{V as te,a as x}from"./VRow-COctEW4P.js";import{V as Z}from"./VTextField-W--0PDtM.js";import{V as fe}from"./VSelect-D_dU7gBz.js";import{V as ge}from"./VTextarea-DQl2xKkO.js";import{V as Le}from"./VAutocomplete-w4aoNVO9.js";import{a as $e}from"./VList-DvFL3q_P.js";import{V as je}from"./VDivider-CWh5UJOg.js";import{V as ze}from"./VChip-BDw9wNdp.js";import{V as Ge,a as Ke}from"./VAlert-DUbUrbU6.js";import{V as Je}from"./VSpacer-CYn6GMsj.js";import{V as He}from"./VSnackbar-CsvfihTb.js";import{_ as We}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as Xe}from"./CategoriesApi-6CnEqvXo.js";import{P as N}from"./ProductsApi-BRS-cl-4.js";const Ye={class:"d-flex align-center"},Qe={class:"text-h5 font-weight-bold"},Ze={class:"text-subtitle-1 opacity-90"},et={class:"pa-6 border-b"},tt={class:"pa-6 border-b"},at={class:"d-flex align-center justify-space-between mb-4"},st={key:0,class:"text-center py-8"},ot={key:1},it={class:"text-h6 font-weight-bold"},lt={class:"d-flex justify-space-between align-center mb-2"},rt={class:"text-h6 font-weight-bold"},nt={class:"d-flex justify-space-between align-center"},ut={class:"text-subtitle-1 font-weight-bold text-success"},ct={class:"pa-6"},dt={class:"d-flex align-center justify-space-between mb-4"},mt={key:0,class:"text-center py-8"},pt={key:1},vt={class:"d-flex align-start"},ft={class:"text-body-2"},gt={class:"d-flex align-center"},_t={class:"text-subtitle-1"},bt=Ae({__name:"ProductRecipeDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},loading:{type:Boolean},formData:{},availableItems:{},errorMessage:{},productName:{}},emits:["update:modelValue","close","save","clear-error"],setup(y,{emit:$}){const n=y,w=$,I=b({get:()=>n.modelValue,set:a=>{a||w("close"),w("update:modelValue",a)}}),V=a=>{if(!a||!Array.isArray(n.availableItems))return 0;const t=n.availableItems.find(s=>s.id_item===a);return(t==null?void 0:t.current_stock)||0},v=a=>V(a),D=(a,t)=>!a||!t||t<=0?!1:t>V(a),O=(a,t)=>{if(!a||!t||t<=0)return"primary";const s=V(a),f=t/s*100;return t>s?"error":f>80?"warning":"primary"},h=(a,t)=>{if(!a||!t||t<=0)return"0";const s=V(a);return s<=0?"0":(t/s*100).toFixed(1)},m=a=>new Intl.NumberFormat("id-ID").format(a),_=b(()=>Array.isArray(n.availableItems)?n.availableItems.map(a=>{a.current_stock<=0||a.current_stock<=10||`${a.current_stock}`;const t=a.current_stock<=0;return{id:a.id_item,text:`${a.name} (${m(V(a.id_item))} ${a.unit})`,item:a,disabled:t}}):[]),k=[{title:"Mudah",value:"easy",color:"success"},{title:"Sedang",value:"medium",color:"warning"},{title:"Sulit",value:"hard",color:"error"}],T=["porsi","cup","liter","ml","pcs","pack"],X=b(()=>Array.isArray(n.availableItems)?n.formData.items.reduce((a,t)=>{const s=n.availableItems.find(f=>f.id_item===t.item_id);return s&&t.quantity>0?a+s.cost_per_unit*t.quantity:a},0):0),j=b(()=>{const a=n.formData.portion_size||1;return X.value/a}),S=b(()=>n.formData.items.every(a=>a.item_id&&a.quantity>0?!D(a.item_id,a.quantity):!0)),q=b(()=>{const a=[];return n.formData.items.forEach(t=>{if(t.item_id&&t.quantity>0&&D(t.item_id,t.quantity)){const s=n.availableItems.find(d=>d.id_item===t.item_id),f=V(t.item_id);s&&a.push(`${s.name}: maksimal ${m(f)} ${s.unit}`)}}),a}),C=a=>{if(a.item_id&&Array.isArray(n.availableItems)){const t=n.availableItems.find(s=>s.id_item===a.item_id);t&&(a.unit=t.unit)}},A=()=>{if(w("clear-error"),n.formData.items.filter(t=>t.item_id&&t.quantity>0?D(t.item_id,t.quantity):!1).length>0){w("update:modelValue",!0);return}w("save")},R=()=>{n.formData.items.push({product_id:n.formData.product_id,item_id:0,quantity:1,unit:"",notes:""})},B=a=>{n.formData.items.splice(a,1)},Q=()=>{n.formData.instructions||(n.formData.instructions=[]),n.formData.instructions.push("")},Y=a=>{n.formData.instructions&&n.formData.instructions.length>1&&n.formData.instructions.splice(a,1)};return(a,t)=>(U(),ae(Ee,{modelValue:I.value,"onUpdate:modelValue":t[10]||(t[10]=s=>I.value=s),"max-width":"1000",persistent:"",class:"recipe-dialog"},{default:i(()=>[o(ve,{class:"recipe-card"},{default:i(()=>[o(Me,{class:"bg-primary text-white pa-6"},{default:i(()=>[u("div",Ye,[o(se,{icon:"tabler-chef-hat",class:"me-3",size:"32"}),u("div",null,[u("div",Qe,L(a.editMode?"Edit":"Buat")+" Resep Produk ",1),u("div",Ze,L(a.productName||"Produk Baru"),1)])])]),_:1}),o(Te,{class:"pa-0"},{default:i(()=>[o(qe,{onSubmit:Fe(A,["prevent"])},{default:i(()=>[u("div",et,[o(te,null,{default:i(()=>[o(x,{cols:"12",md:"6"},{default:i(()=>[o(Z,{modelValue:a.formData.name,"onUpdate:modelValue":t[0]||(t[0]=s=>a.formData.name=s),label:"Nama Resep",variant:"outlined",density:"compact",required:"",rules:[s=>!!s||"Nama resep wajib diisi"]},null,8,["modelValue","rules"])]),_:1}),o(x,{cols:"12",md:"3"},{default:i(()=>[o(Z,{modelValue:a.formData.portion_size,"onUpdate:modelValue":t[1]||(t[1]=s=>a.formData.portion_size=s),modelModifiers:{number:!0},label:"Ukuran Porsi",variant:"outlined",density:"compact",type:"number",min:"1",required:"",rules:[s=>s>0||"Ukuran porsi harus lebih dari 0"]},null,8,["modelValue","rules"])]),_:1}),o(x,{cols:"12",md:"3"},{default:i(()=>[o(fe,{modelValue:a.formData.portion_unit,"onUpdate:modelValue":t[2]||(t[2]=s=>a.formData.portion_unit=s),label:"Satuan Porsi",variant:"outlined",density:"compact",items:T,required:""},null,8,["modelValue"])]),_:1})]),_:1}),o(te,null,{default:i(()=>[o(x,{cols:"12",md:"4"},{default:i(()=>[o(fe,{modelValue:a.formData.difficulty_level,"onUpdate:modelValue":t[3]||(t[3]=s=>a.formData.difficulty_level=s),label:"Tingkat Kesulitan",variant:"outlined",density:"compact",items:k,"item-title":"title","item-value":"value",required:""},null,8,["modelValue"])]),_:1}),o(x,{cols:"12",md:"4"},{default:i(()=>[o(Z,{modelValue:a.formData.preparation_time,"onUpdate:modelValue":t[4]||(t[4]=s=>a.formData.preparation_time=s),modelModifiers:{number:!0},label:"Waktu Persiapan (menit)",variant:"outlined",density:"compact",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),o(x,{cols:"12",md:"4"},{default:i(()=>[o(Z,{modelValue:a.formData.notes,"onUpdate:modelValue":t[5]||(t[5]=s=>a.formData.notes=s),label:"Catatan Tambahan",variant:"outlined",density:"compact",placeholder:"Opsional"},null,8,["modelValue"])]),_:1})]),_:1}),o(te,null,{default:i(()=>[o(x,{cols:"12"},{default:i(()=>[o(ge,{modelValue:a.formData.description,"onUpdate:modelValue":t[6]||(t[6]=s=>a.formData.description=s),label:"Deskripsi Resep",variant:"outlined",density:"compact",rows:"3","auto-grow":"",counter:"500",rules:[s=>!s||s.length<=500||"Deskripsi maksimal 500 karakter"]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),u("div",tt,[u("div",at,[t[12]||(t[12]=u("div",null,[u("h3",{class:"text-h6 font-weight-bold"},"Bahan-Bahan"),u("p",{class:"text-body-2 text-medium-emphasis"}," Pilih bahan dan tentukan jumlah yang dibutuhkan ")],-1)),o(K,{color:"primary",variant:"outlined",size:"small",onClick:R,"prepend-icon":"tabler-plus"},{default:i(()=>t[11]||(t[11]=[J(" Tambah Bahan ")])),_:1,__:[11]})]),a.formData.items.length===0?(U(),G("div",st,[o(se,{icon:"tabler-bowl",size:"64",class:"text-grey-lighten-1 mb-4"}),t[14]||(t[14]=u("p",{class:"text-body-1 text-medium-emphasis"}," Belum ada bahan yang ditambahkan ",-1)),o(K,{color:"primary",variant:"outlined",onClick:R,"prepend-icon":"tabler-plus"},{default:i(()=>t[13]||(t[13]=[J(" Tambah Bahan Pertama ")])),_:1,__:[13]})])):(U(),G("div",ot,[(U(!0),G(le,null,re(a.formData.items,(s,f)=>(U(),ae(te,{key:f,class:"mb-4 align-center"},{default:i(()=>[o(x,{cols:"12",md:"4"},{default:i(()=>[o(Le,{modelValue:s.item_id,"onUpdate:modelValue":[d=>s.item_id=d,d=>C(s)],items:_.value,"item-title":"text","item-value":"id",label:"Pilih Bahan",variant:"outlined",density:"compact",required:"",clearable:"",rules:[d=>!!d||"Bahan wajib dipilih"]},{item:i(({props:d,item:E})=>[o($e,Oe({ref_for:!0},d,{disabled:E.raw.disabled}),Be({title:i(()=>[J(L(E.raw.text),1)]),_:2},[E.raw.disabled?{name:"subtitle",fn:i(()=>[t[15]||(t[15]=u("span",{class:"text-error"},"Stok habis",-1))]),key:"0"}:void 0]),1040,["disabled"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","rules"])]),_:2},1024),o(x,{cols:"12",md:"4"},{default:i(()=>[o(Z,{modelValue:s.quantity,"onUpdate:modelValue":d=>s.quantity=d,modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0",max:v(s.item_id),step:"0.01",required:"",color:O(s.item_id,s.quantity),rules:[d=>d>0||"Jumlah harus lebih dari 0",d=>d<=v(s.item_id)||`Jumlah tidak boleh melebihi stok tersedia (${v(s.item_id)})`],error:D(s.item_id,s.quantity),"error-messages":D(s.item_id,s.quantity)?`Stok tidak cukup (${v(s.item_id)} tersedia)`:[],hint:`Stok tersedia: ${v(s.item_id)} | Akan menggunakan: ${h(s.item_id,s.quantity)}%`,"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","max","color","rules","error","error-messages","hint"])]),_:2},1024),o(x,{cols:"12",md:"2"},{default:i(()=>[o(Z,{modelValue:s.unit,"onUpdate:modelValue":d=>s.unit=d,label:"Satuan",variant:"outlined",density:"compact",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(x,{cols:"12",md:"2"},{default:i(()=>{var d;return[t[16]||(t[16]=u("div",{class:"text-caption text-medium-emphasis"},"Biaya",-1)),u("div",it,L(s.item_id&&s.quantity>0&&Array.isArray(a.availableItems)?oe(ie)((((d=a.availableItems.find(E=>E.id_item===s.item_id))==null?void 0:d.cost_per_unit)||0)*s.quantity):oe(ie)(0)),1),o(K,{color:"error",variant:"text",size:"small",icon:"tabler-trash",onClick:E=>B(f)},null,8,["onClick"])]}),_:2,__:[16]},1024)]),_:2},1024))),128)),o(je,{class:"my-4"}),o(te,null,{default:i(()=>[o(x,{cols:"12",md:"6"},{default:i(()=>[o(ve,{variant:"outlined",class:"pa-4"},{default:i(()=>[t[19]||(t[19]=u("div",{class:"text-subtitle-2 text-medium-emphasis mb-2"}," Ringkasan Biaya ",-1)),u("div",lt,[t[17]||(t[17]=u("span",null,"Total Biaya Resep:",-1)),u("span",rt,L(oe(ie)(X.value)),1)]),u("div",nt,[t[18]||(t[18]=u("span",null,"Biaya per Porsi:",-1)),u("span",ut,L(oe(ie)(j.value)),1)])]),_:1,__:[19]})]),_:1})]),_:1})]))]),u("div",ct,[u("div",dt,[t[21]||(t[21]=u("div",null,[u("h3",{class:"text-h6 font-weight-bold"},"Instruksi Pembuatan"),u("p",{class:"text-body-2 text-medium-emphasis"}," Langkah-langkah untuk membuat produk ")],-1)),o(K,{color:"primary",variant:"outlined",size:"small",onClick:Q,"prepend-icon":"tabler-plus"},{default:i(()=>t[20]||(t[20]=[J(" Tambah Langkah ")])),_:1,__:[20]})]),!a.formData.instructions||a.formData.instructions.length===0?(U(),G("div",mt,[o(se,{icon:"tabler-list-numbers",size:"64",class:"text-grey-lighten-1 mb-4"}),t[23]||(t[23]=u("p",{class:"text-body-1 text-medium-emphasis"}," Belum ada instruksi yang ditambahkan ",-1)),o(K,{color:"primary",variant:"outlined",onClick:Q,"prepend-icon":"tabler-plus"},{default:i(()=>t[22]||(t[22]=[J(" Tambah Instruksi Pertama ")])),_:1,__:[22]})])):(U(),G("div",pt,[(U(!0),G(le,null,re(a.formData.instructions,(s,f)=>(U(),G("div",{key:f,class:"mb-4"},[u("div",vt,[o(ze,{color:"primary",size:"small",class:"me-3 mt-3"},{default:i(()=>[J(L(f+1),1)]),_:2},1024),o(ge,{modelValue:a.formData.instructions[f],"onUpdate:modelValue":d=>a.formData.instructions[f]=d,label:`Langkah ${f+1}`,variant:"outlined",density:"compact",rows:"2","auto-grow":"",class:"flex-grow-1",required:"",rules:[d=>!!d||"Instruksi tidak boleh kosong"]},null,8,["modelValue","onUpdate:modelValue","label","rules"]),a.formData.instructions.length>1?(U(),ae(K,{key:0,color:"error",variant:"text",size:"small",icon:"tabler-trash",class:"ms-2 mt-3",onClick:d=>Y(f)},null,8,["onClick"])):pe("",!0)])]))),128))]))])]),_:1})]),_:1}),o(Ne,{class:"pa-6"},{default:i(()=>[q.value.length>0?(U(),ae(x,{key:0,cols:"12",class:"px-0"},{default:i(()=>[o(Ge,{type:"error",variant:"tonal",density:"compact"},{default:i(()=>[o(Ke,{class:"mb-2"},{default:i(()=>t[24]||(t[24]=[J("Stok Tidak Mencukupi")])),_:1,__:[24]}),u("div",ft,[(U(!0),G(le,null,re(q.value,s=>(U(),G("div",{key:s,class:"mb-1"}," • "+L(s),1))),128))])]),_:1})]),_:1})):pe("",!0),o(Je),o(K,{variant:"outlined",class:"coffee-secondary",onClick:t[7]||(t[7]=s=>I.value=!1)},{default:i(()=>t[25]||(t[25]=[J(" Batal ")])),_:1,__:[25]}),o(K,{color:"primary",class:"coffee-primary",loading:a.loading,disabled:!S.value,onClick:A},{default:i(()=>[J(L(a.editMode?"Perbarui":"Simpan")+" Resep ",1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),o(He,{"model-value":!!a.errorMessage,"onUpdate:modelValue":t[9]||(t[9]=s=>!s&&w("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:i(()=>[o(K,{icon:"tabler-x",size:"small",variant:"text",onClick:t[8]||(t[8]=s=>w("clear-error"))})]),default:i(()=>[u("div",gt,[o(se,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),u("div",null,[t[26]||(t[26]=u("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),u("div",_t,L(a.errorMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["modelValue"]))}}),zt=We(bt,[["__scopeId","data-v-7086619c"]]);function Gt(){const y=c([]),$=c([]),n=c(!1),w=c(!1),I=c(!1),V=c({total_recipes:0,active_recipes:0,total_items_used:0,avg_cost_per_recipe:0}),v=c(!1),D=c(!1),O=c(!1),h=c(null),m=ne({product_id:0,name:"",description:"",items:[],portion_size:1,portion_unit:"porsi",preparation_time:30,difficulty_level:"medium",instructions:[],active:!0}),_=c(""),k=c(""),T=c(""),X=b(()=>!n.value),j="product_recipes",S=()=>{try{const l=localStorage.getItem(j);return l?JSON.parse(l):[]}catch(l){return console.error("❌ Failed to load recipes from localStorage:",l),[]}},q=l=>{try{localStorage.setItem(j,JSON.stringify(l))}catch(g){console.error("❌ Failed to save recipes to localStorage:",g)}},C=l=>l.items.reduce((g,p)=>{const P=$.value.find(H=>H.id_item===p.item_id);return g+p.quantity*((P==null?void 0:P.cost_per_unit)||0)},0),A=l=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),R=()=>{Object.assign(m,{id:void 0,product_id:0,name:"",description:"",items:[],portion_size:1,portion_unit:"porsi",preparation_time:30,difficulty_level:"medium",instructions:[],active:!0})},B=async l=>{if(l){n.value=!0,_.value="";try{await new Promise(p=>setTimeout(p,500));const g=S();y.value=g.filter(p=>p.product_id===l),k.value="Resep berhasil dimuat"}catch(g){console.error("Failed to fetch recipes:",g),_.value="Gagal memuat data resep",y.value=[]}finally{n.value=!1}}},Q=async()=>{try{$.value=[{id_item:1,item_code:"KOPI001",name:"Kopi Arabica",unit:"gram",cost_per_unit:50,current_stock:1e3,minimum_stock:100,active:!0},{id_item:2,item_code:"SUSU001",name:"Susu Segar",unit:"ml",cost_per_unit:15,current_stock:2e3,minimum_stock:200,active:!0},{id_item:3,item_code:"GULA001",name:"Gula Pasir",unit:"gram",cost_per_unit:12,current_stock:5e3,minimum_stock:500,active:!0},{id_item:4,item_code:"CHOC001",name:"Cokelat Bubuk",unit:"gram",cost_per_unit:80,current_stock:500,minimum_stock:50,active:!0}]}catch(l){console.error("Failed to fetch available items:",l),$.value=[]}},Y=async()=>{try{const l=m.product_id;if(!l)return;const p=S().filter(z=>z.product_id===l),P=p.filter(z=>z.active),H=new Set(p.flatMap(z=>z.items.map(ee=>ee.item_id))),M=P.reduce((z,ee)=>z+(ee.total_cost||0),0)/(P.length||1);V.value={total_recipes:p.length,active_recipes:P.length,total_items_used:H.size,avg_cost_per_recipe:M}}catch(l){console.error("Failed to fetch stats:",l)}},a=async()=>{var l;w.value=!0,T.value="";try{await new Promise(p=>setTimeout(p,1e3));const g=S();if(O.value&&((l=h.value)!=null&&l.id)){const p=g.findIndex(P=>{var H;return P.id===((H=h.value)==null?void 0:H.id)});p!==-1&&(g[p]={...m,id:h.value.id,total_cost:C(m),updated_at:new Date().toISOString()}),k.value="Resep berhasil diperbarui"}else{const p={...m,id:Date.now(),total_cost:C(m),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};g.unshift(p),k.value="Resep berhasil ditambahkan"}q(g),await B(m.product_id),await Y(),E()}catch(g){console.error("Failed to save recipe:",g),T.value="Gagal menyimpan resep"}finally{w.value=!1}},t=async()=>{if(h.value){I.value=!0;try{await new Promise(p=>setTimeout(p,1e3));const g=S().filter(p=>{var P;return p.id!==((P=h.value)==null?void 0:P.id)});q(g),k.value="Resep berhasil dihapus",await B(m.product_id),await Y(),D.value=!1,h.value=null}catch(l){console.error("Failed to delete recipe:",l),_.value="Gagal menghapus resep"}finally{I.value=!1}}},s=l=>{O.value=!1,R(),m.product_id=l,v.value=!0},f=l=>{O.value=!0,h.value=l,Object.assign(m,{...l,items:[...l.items]}),v.value=!0},d=l=>{h.value=l,D.value=!0},E=()=>{v.value=!1,T.value="",setTimeout(()=>{R(),h.value=null,O.value=!1},200)};return{recipesList:y,availableItems:$,loading:n,saveLoading:w,deleteLoading:I,stats:V,dialog:v,deleteDialog:D,editMode:O,selectedRecipe:h,formData:m,errorMessage:_,successMessage:k,modalErrorMessage:T,canCreateEdit:X,calculateRecipeCost:C,formatCurrency:A,fetchRecipes:B,fetchAvailableItems:Q,fetchStats:Y,saveRecipe:a,deleteRecipe:t,openCreateDialog:s,openEditDialog:f,openDeleteDialog:d,closeDialog:E,clearModalError:()=>{T.value=""}}}const Kt=()=>{const y=c([]),$=c([]),n=c(!1),w=c(!1),I=c(!1),V=c({}),v=c({total_products:0,published_products:0,draft_products:0,archived_products:0,active_products:0,inactive_products:0,featured_products:0,low_stock_products:0,out_of_stock_products:0,total_stock_value:0,average_price:0,total_categories:0,average_margin:0,highest_margin:0,lowest_margin:0,profitable_products:0}),D=c(!1),O=c(!1),h=c(!1),m=c(null),_=c([]),k=c(1),T=c(0),X=c(15),j=ne({search:"",active:"all",category_id:null,stock_status:"all",featured:"all",sortBy:"created_at",sortOrder:"desc"}),S=c(""),q=c(""),C=c(""),A=ne({name:"",description:"",price:0,cost:0,sku:"",barcode:"",min_stock:0,weight:0,dimensions:{length:void 0,width:void 0,height:void 0},category_id:0,brand:"",unit:"pcs",status:"published",active:!0,featured:!1,available_in_kitchen:!0,available_in_bar:!0,tags:[],meta_title:"",meta_description:""}),R=c(null),B=c(""),Q=[e=>!!e||"Nama produk wajib diisi",e=>e.length>=2||"Nama produk minimal 2 karakter",e=>e.length<=255||"Nama produk maksimal 255 karakter"],Y=[e=>!!e||"Kategori wajib dipilih"],a=[e=>{if(!e)return!0;const r=N.validateSKU(e);return r.valid||r.error}],t=b(()=>!0),s=b(()=>!0),f=b(()=>v.value.active_products),d=b(()=>v.value.inactive_products),E=b(()=>v.value.featured_products),ue=b(()=>v.value.low_stock_products),l=b(()=>v.value.out_of_stock_products),g=b(()=>v.value.average_price),p=b(()=>v.value.total_stock_value),P=b(()=>_.value.length>0),H=b(()=>y.value.length),M=async()=>{try{n.value=!0,S.value="";const e={...j,page:k.value,per_page:X.value};Object.keys(e).forEach(F=>{const W=e[F];F!=="search"&&(W===""||W==="all"||W===null||W===void 0)&&delete e[F]}),console.log("Fetching products with params:",e);const r=await N.getAll(e);if(r.success)y.value=r.data,r.pagination&&(T.value=r.pagination.total,k.value=r.pagination.current_page);else throw new Error(r.message)}catch(e){S.value=e.message||"Gagal mengambil data produk",y.value=[]}finally{n.value=!1}},z=async()=>{try{const e=await Xe.getCategories({page:1,per_page:100,status:"active"});e.success&&($.value=e.data)}catch{}},ee=async()=>{try{const e=await N.getStats();e.success&&(v.value=e.data)}catch{}},_e=async()=>{try{w.value=!0,C.value="";const e={...A};e.price&&(e.price=Number(e.price)),e.cost&&(e.cost=Number(e.cost)),e.min_stock&&(e.min_stock=Number(e.min_stock)),e.weight&&(e.weight=Number(e.weight)),e.category_id&&(e.category_id=Number(e.category_id));let r;if(h.value&&m.value?r=await N.update(m.value.id_product,e,R.value||void 0):r=await N.create(e,R.value||void 0),r.success)q.value=r.message||"Product saved successfully",ce(),await M();else throw new Error(r.message)}catch(e){C.value=e.errors||e.message}finally{w.value=!1}},be=async()=>{if(m.value)try{I.value=!0;const e=await N.delete(m.value.id_product);if(e.success)q.value=e.message,O.value=!1,await M();else throw new Error(e.message)}catch(e){S.value=e.message||"Gagal menghapus produk"}finally{I.value=!1}},he=async()=>{if(_.value.length!==0)try{I.value=!0;const e=await N.bulkDelete(_.value);if(e.success)q.value=e.message,_.value=[],await M();else throw new Error(e.message)}catch(e){S.value=e.message||"Gagal menghapus produk"}finally{I.value=!1}},ye=async e=>{try{V.value[e.id_product]=!0;const r=await N.toggleActive(e.id_product);if(r.success){const F=y.value.findIndex(W=>W.id_product===e.id_product);F!==-1&&(y.value[F]=r.data)}else throw new Error(r.message)}catch(r){S.value=r.message||"Gagal mengubah status produk"}finally{V.value[e.id_product]=!1}},ke=async e=>{try{V.value[e.id_product]=!0;const r=await N.toggleFeatured(e.id_product);if(r.success){const F=y.value.findIndex(W=>W.id_product===e.id_product);F!==-1&&(y.value[F]=r.data)}else throw new Error(r.message)}catch(r){S.value=r.message||"Gagal mengubah status produk unggulan"}finally{V.value[e.id_product]=!1}},we=()=>{h.value=!1,m.value=null,de(),D.value=!0},Ve=e=>{h.value=!0,m.value=e,Se(e),D.value=!0},De=e=>{m.value=e,O.value=!0},ce=()=>{D.value=!1,C.value="",de()},de=()=>{Object.assign(A,{name:"",description:"",price:"",cost:"",sku:"",barcode:"",stock:"",min_stock:"",weight:"",dimensions:{length:void 0,width:void 0,height:void 0},category_id:"",brand:"",unit:"pcs",status:"published",active:!0,featured:!1,tags:[],meta_title:"",meta_description:""}),R.value=null,B.value=""},Se=e=>{Object.assign(A,{name:e.name,description:e.description||"",price:e.price,cost:e.cost||"",sku:e.sku||"",barcode:e.barcode||"",min_stock:e.min_stock||"",weight:e.weight||"",dimensions:e.dimensions||{length:void 0,width:void 0,height:void 0},category_id:e.category_id,brand:e.brand||"",unit:e.unit||"pcs",status:e.status,active:e.active,featured:e.featured,available_in_kitchen:e.available_in_kitchen,available_in_bar:e.available_in_bar,tags:e.tags||[],meta_title:e.meta_title||"",meta_description:e.meta_description||""}),R.value=null,B.value=e.image_url||""},Pe=e=>{if(e.length===0)return;const r=e[0],F=N.validateImage(r);if(!F.valid){C.value=F.error||"File tidak valid";return}R.value=r,B.value=URL.createObjectURL(r),C.value=""},Ie=()=>{R.value=null,B.value=""},Ce=()=>{A.name&&(A.sku=N.generateSKU(A.name))},Re=()=>{C.value=""},Ue=e=>{k.value=e,M()},xe=()=>{k.value=1,M()},me=()=>{k.value=1,M()};return{productsList:y,categories:$,loading:n,saveLoading:w,deleteLoading:I,toggleLoading:V,stats:v,dialog:D,deleteDialog:O,editMode:h,selectedProduct:m,selectedProducts:_,currentPage:k,totalItems:T,itemsPerPage:X,filters:j,errorMessage:S,successMessage:q,modalErrorMessage:C,formData:A,selectedImage:R,imagePreview:B,nameRules:Q,categoryRules:Y,skuRules:a,canCreateEdit:t,canDelete:s,totalActiveProducts:f,totalInactiveProducts:d,totalFeaturedProducts:E,totalLowStockProducts:ue,totalOutOfStockProducts:l,averagePrice:g,totalStockValue:p,hasSelectedProducts:P,filteredProductsCount:H,fetchProductsList:M,fetchCategories:z,fetchStats:ee,saveProduct:_e,deleteProduct:be,bulkDeleteProducts:he,toggleActiveStatus:ye,toggleFeaturedStatus:ke,openCreateDialog:we,openEditDialog:Ve,openDeleteDialog:De,closeDialog:ce,handleImageUpload:Pe,removeImage:Ie,generateSKU:Ce,clearModalError:Re,onPageChange:Ue,onSearch:xe,onFilterChange:me,handleFiltersUpdate:e=>{Object.assign(j,e),me()},onSortChange:()=>{k.value=1,M()},resetFilters:()=>{Object.assign(j,{search:"",active:"all",category_id:null,stock_status:"all",featured:"all",sortBy:"created_at",sortOrder:"desc"}),k.value=1,M()},toggleProductSelection:e=>{const r=_.value.indexOf(e);r>-1?_.value.splice(r,1):_.value.push(e)},selectAllProducts:()=>{_.value.length===y.value.length?_.value=[]:_.value=y.value.map(e=>e.id_product)}}};export{zt as P,Kt as a,Gt as u};
