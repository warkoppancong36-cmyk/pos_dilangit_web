import{I as O}from"./ItemsApi-Bkkmq0jO.js";import{aA as f,V as C,ax as T,r as s}from"./main-DiHzm1qV.js";import{P as S}from"./ProductsApi-DhkQ_0Vc.js";const y={async getAll(e={}){var a;try{return(await f.get("/api/product-items",{params:e})).data}catch(t){throw console.error("ProductItemsApi.getAll error:",t),((a=t.response)==null?void 0:a.data)||t}},async getById(e){var a;try{return(await f.get(`/api/product-items/${e}`)).data}catch(t){throw console.error("ProductItemsApi.getById error:",t),((a=t.response)==null?void 0:a.data)||t}},async create(e){var a;try{return(await f.post("/api/product-items",e)).data}catch(t){throw console.error("ProductItemsApi.create error:",t),((a=t.response)==null?void 0:a.data)||t}},async update(e,a){var t;try{return(await f.put(`/api/product-items/${e}`,a)).data}catch(o){throw console.error("ProductItemsApi.update error:",o),((t=o.response)==null?void 0:t.data)||o}},async delete(e){var a;try{return(await f.delete(`/api/product-items/${e}`)).data}catch(t){throw console.error("ProductItemsApi.delete error:",t),((a=t.response)==null?void 0:a.data)||t}},async getProductionCapacity(e){var a;try{return(await f.get(`/api/product-items/production-capacity/${e}`)).data}catch(t){throw console.error("ProductItemsApi.getProductionCapacity error:",t),((a=t.response)==null?void 0:a.data)||t}}},m=s([]),c=s([]),d=s([]),p=s(!1),b=s(!1),I=s(!1),A=s(!1),j=s(!1),q=s(!1),_=s(!1),n=s(null),F=s(null),$=s(null),v=s(1),k=s(0),w=s(15),D=T({search:"",product_id:void 0,item_id:void 0,critical_only:!1,stock_status:null,sort_by:null}),r=s(""),E=s(""),i=s(""),l=T({product_id:0,item_id:0,quantity_needed:0,unit:"",is_critical:!1,notes:""}),U=C(()=>!0),V=C(()=>[{title:"Pilih Produk",value:0},...c.value.map(e=>({title:e.name,value:e.id_product||e.id}))]),z=C(()=>[{title:"Pilih Item",value:0},...d.value.map(e=>({title:`${e.name} (${e.unit})`,value:e.id_item||e.id}))]),h=async()=>{p.value=!0,r.value="";try{const e={page:v.value,per_page:w.value,...D};Object.keys(e).forEach(t=>{const u=e[t];(u===void 0||u===0||typeof u=="string"&&u==="")&&delete e[t]});const a=await y.getAll(e);a.success&&a.data&&(Array.isArray(a.data)?(m.value=a.data,k.value=a.data.length):(m.value=a.data.data||[],k.value=a.data.total||0,v.value=a.data.current_page||1))}catch(e){r.value=e.message||"Failed to fetch product items"}finally{p.value=!1}},M=async()=>{try{const e=await S.getAll({});e.success&&e.data?c.value=Array.isArray(e.data)?e.data:[]:c.value=[]}catch{c.value=[]}},L=async()=>{try{const e=await O.getAll({per_page:"all"});e.success&&e.data&&e.data.data?d.value=Array.isArray(e.data.data)?e.data.data:[]:d.value=[]}catch{d.value=[]}},N=async()=>{if(R()){b.value=!0,i.value="";try{let e;_.value&&n.value?e=await y.update(n.value.id_product_item,l):e=await y.create(l),e.success?(E.value=_.value?"Hubungan produk-item berhasil diperbarui!":"Hubungan produk-item berhasil ditambahkan!",G(),await h()):i.value=e.message||"Terjadi kesalahan saat menyimpan"}catch(e){i.value=e.message||"Terjadi kesalahan saat menyimpan"}finally{b.value=!1}}},Q=async()=>{if(n.value){I.value=!0;try{const e=await y.delete(n.value.id_product_item);e.success?(E.value="Hubungan produk-item berhasil dihapus!",H(),await h()):r.value=e.message||"Gagal menghapus hubungan produk-item"}catch(e){r.value=e.message||"Terjadi kesalahan saat menghapus"}finally{I.value=!1}}},x=async e=>{p.value=!0;try{const a=await y.getProductionCapacity(e);a.success?($.value=a.data,q.value=!0):r.value=a.message||"Gagal menghitung kapasitas produksi"}catch(a){r.value=a.message||"Terjadi kesalahan saat menghitung kapasitas produksi"}finally{p.value=!1}},R=()=>l.product_id<=0?(i.value="Produk harus dipilih",!1):l.item_id<=0?(i.value="Item harus dipilih",!1):l.quantity_needed<=0?(i.value="Jumlah yang dibutuhkan harus lebih besar dari 0",!1):l.unit.trim()?!0:(i.value="Satuan harus diisi",!1),W=()=>{_.value=!1,n.value=null,B(),A.value=!0},X=e=>{_.value=!0,n.value=e,ae(e),A.value=!0},Y=e=>{n.value=e,j.value=!0},Z=e=>{let a,t;if(typeof e=="number"){if(a=e,t=c.value.find(o=>(o.id_product||o.id)===a),!t){r.value="Product tidak ditemukan";return}}else if(e&&typeof e=="object")t=e,a=t.id_product||t.id;else{r.value="Parameter tidak valid";return}if(!a){r.value="Product ID tidak ditemukan";return}F.value=t,x(a)},G=()=>{A.value=!1,K(),B()},H=()=>{j.value=!1,n.value=null},ee=()=>{q.value=!1,F.value=null,$.value=null},B=()=>{Object.assign(l,{product_id:0,item_id:0,quantity_needed:0,unit:"",is_critical:!1,notes:""})},ae=e=>{Object.assign(l,{product_id:e.product_id,item_id:e.item_id,quantity_needed:e.quantity_needed,unit:e.unit,is_critical:e.is_critical,notes:e.notes||""})},K=()=>{i.value=""},te=e=>{const a=d.value.find(t=>(t.id_item||t.id)===e);a&&(l.unit=a.unit)},se=e=>{v.value=e,h()},re=e=>{w.value=e,v.value=1,h()},oe=()=>{v.value=1,h()},ue=()=>({productItemsList:m,products:c,items:d,loading:p,saveLoading:b,deleteLoading:I,dialog:A,deleteDialog:j,capacityDialog:q,editMode:_,selectedProductItem:n,selectedProduct:F,productionCapacity:$,currentPage:v,totalItems:k,itemsPerPage:w,filters:D,errorMessage:r,successMessage:E,modalErrorMessage:i,formData:l,canCreateEdit:U,productOptions:V,itemOptions:z,fetchProductItemsList:h,fetchProductItemsForComposition:async e=>{var a,t,o,u;p.value=!0,r.value="";try{const P={page:(e==null?void 0:e.page)||1,per_page:(e==null?void 0:e.per_page)||15,critical_only:(e==null?void 0:e.critical_only)||!1},g=await y.getAll(P);if(g.success){const J=((a=g.data)==null?void 0:a.data)||g.data||[];m.value=J,v.value=((t=g.data)==null?void 0:t.current_page)||1,k.value=((o=g.data)==null?void 0:o.total)||0,w.value=((u=g.data)==null?void 0:u.per_page)||15,D.critical_only=P.critical_only,c.value.length===0&&await M(),d.value.length===0&&await L()}else m.value=[]}catch(P){r.value=P.message||"Gagal memuat data komposisi produk",m.value=[]}finally{p.value=!1}},fetchProducts:M,fetchItems:L,saveProductItem:N,deleteProductItem:Q,getProductionCapacity:x,openCreateDialog:W,openEditDialog:X,openDeleteDialog:Y,openCapacityDialog:Z,closeDialog:G,closeDeleteDialog:H,closeCapacityDialog:ee,clearModalError:K,onItemChange:te,onPageChange:se,onItemsPerPageChange:re,handleFiltersUpdate:oe});export{y as P,ue as u};
