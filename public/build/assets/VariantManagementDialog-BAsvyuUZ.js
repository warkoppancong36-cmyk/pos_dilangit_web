import{d as oe,r as p,aw as wa,V as ra,w as re,g,f as l,o as c,b as e,l as $,e as i,s as r,X as y,t as s,a0 as _,$ as Ca,ay as Ia,c as M,F as Z,i as $a,p as ue,az as de,av as w,b8 as Sa}from"./main-BDjA8ZE0.js";import{f as me}from"./formatters-BD6tdLx_.js";import{_ as ce}from"./VariantFormDialog.vue_vue_type_script_setup_true_lang-1r2W_LME.js";import ve from"./VariantCompositionDialog-BMlI44YI.js";import{D as Da}from"./DeleteConfirmationDialog-DIkwJ7SA.js";import{V as Aa}from"./VDialog-kKqt15qI.js";import{V as U,b as B,c as Ta}from"./VCard-Af9i-cHC.js";import{V as z}from"./VDivider-CNJRCtTw.js";import{V as S}from"./VCardText-pusdEz6_.js";import{V as ua}from"./VAlert-BUxPj0YW.js";import{V as za}from"./VForm-D-6FADkt.js";import{V as X,a as D}from"./VRow-B_tm1uSD.js";import{V as da}from"./VTextField-BQMuFhOa.js";import{V as q}from"./VChip-DmPw7oBU.js";import{V as Ua,a as ma,b as Ba,d as qa}from"./VList-BUBOvLR6.js";import{V as pe}from"./VSwitch-DvQ6AnPY.js";import{V as fe}from"./VTooltip-Ds7TpE81.js";import{V as ca}from"./VAvatar-BJUFvcQH.js";import{V as va}from"./VImg-DavVY8Sw.js";import{V as Pa}from"./VSpacer-P6zft6lJ.js";import{V as ge}from"./VAutocomplete-X1kKS8Y9.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VSelect-CqUH4kv5.js";import"./forwardRefs-B931MWyl.js";import"./VOverlay-DpeqFwNJ.js";import"./VMenu-BN6MK1Ni.js";import"./VCheckboxBtn-Ml9VaORK.js";import"./helpers-B-vn2Qqf.js";/* empty css              */import"./filter-BTEElEgT.js";const ke={class:"d-flex align-center justify-space-between"},ye={class:"d-flex align-center"},Ve={class:"d-flex justify-between align-center"},be={class:"text-end"},xe={class:"text-h6"},he={class:"d-flex align-center"},we={class:"text-body-2 text-medium-emphasis mb-4"},Ce={key:0},Ie={key:1,class:"text-warning font-weight-medium"},$e={class:"d-flex align-center"},Se={class:"text-end me-4",style:{"min-width":"120px"}},De={class:"d-flex"},Ae={class:"text-body-2 text-medium-emphasis"},Te={class:"text-body-2 text-medium-emphasis"},ze={class:"text-h5 font-weight-bold"},Ue={class:"text-body-2 text-medium-emphasis"},Be={class:"d-flex align-center justify-space-between"},qe={class:"d-flex align-center"},Pe={class:"d-flex justify-between align-center"},je={class:"text-end"},Ne={class:"d-flex align-center"},Me={class:"d-flex align-center me-4"},Ge={class:"text-end me-4",style:{"min-width":"120px"}},Ee={class:"font-weight-medium"},Fe={class:"text-caption text-medium-emphasis"},He={class:"d-flex justify-between align-center"},Ke={class:"text-body-2 text-medium-emphasis"},Le={class:"text-end"},Oe={class:"text-h5 font-weight-bold"},Re=oe({__name:"VariantManagementDialog",props:{modelValue:{type:Boolean},product:{}},emits:["update:modelValue","save"],setup(ja,{emit:Na}){const V=ja,pa=Na,Q=p(!1),W=p(!1),Ma=p(!1),A=p(!1),Y=p(!1),F=p(),v=p([]),H=p(!1),P=p(null),K=p(!1),j=p(null),L=p(!1),O=p(!1),G=p(!1),fa=p(null),b=p(null),aa=p(!1),ea=p(!1),ta=p(!1),Ga=p(!1),la=p(),R=p([]),x=p([]),C=wa({item_id:null,quantity:1}),f=(t,a="success")=>{console.log(`${a.toUpperCase()}: ${t}`)},k=wa({name:"",sku:""}),na=ra({get:()=>V.modelValue,set:t=>pa("update:modelValue",t)}),Ea=ra(()=>v.value.filter(t=>t.is_active).length),Fa=ra(()=>x.value.reduce((t,a)=>t+a.total_cost,0)),J=t=>me(t),ia=t=>t.current_stock<=0?{text:"Stok Habis",color:"error",value:"out"}:t.current_stock<=t.min_stock?{text:"Stok Rendah",color:"warning",value:"low"}:{text:"Stok Aman",color:"success",value:"safe"},Ha=()=>{var t;if(k.name&&V.product){const a=V.product.code||((t=V.product.name)==null?void 0:t.substring(0,3).toUpperCase())||"PRD",u=k.name.replace(/[^a-zA-Z0-9]/g,"").substring(0,8).toUpperCase(),o=Date.now().toString().slice(-4);k.sku=`${a}-${u}-${o}`}else if(k.name){const a=k.name.replace(/[^a-zA-Z0-9]/g,"").substring(0,8).toUpperCase(),u=Date.now().toString().slice(-4);k.sku=`VAR-${a}-${u}`}else k.sku=""},E=async()=>{var t;if((t=V.product)!=null&&t.id){Q.value=!0;try{const a=await w.get(`/api/variants/product/${V.product.id}`);v.value=a.data.data||a.data}catch(a){console.error("Error loading variants:",a),v.value=[]}finally{Q.value=!1}}},ga=async()=>{var a,u,o,d;const{valid:t}=await F.value.validate();if(!(!t||!((a=V.product)!=null&&a.id))){console.log("Adding variant for product:",(u=V.product)==null?void 0:u.id),console.log("New variant data:",k),W.value=!0;try{const I={id_product:V.product.id,name:k.name,sku:k.sku,price:0,variant_values:[{}],is_active:!0,min_stock:0,current_stock:0,description:""};console.log("Payload to be sent:",I);const N=await w.post("/api/variants",I);v.value.push(N.data),Object.assign(k,{name:"",sku:""}),F.value.resetValidation(),f("Variant berhasil dibuat! Sekarang Anda bisa menambahkan item untuk variant ini.")}catch(I){const N=((d=(o=I.response)==null?void 0:o.data)==null?void 0:d.message)||"Gagal menambahkan variant";f(N,"error")}finally{W.value=!1}}},Ka=async t=>{var a,u;try{const o=await w.put(`/api/variants/${t.id}`,{id_product:t.product_id,name:t.name,sku:t.sku,is_active:t.is_active,price:t.price||0,min_stock:t.min_stock||0,current_stock:t.current_stock||0,description:t.description||""});Object.assign(t,o.data),f("Variant berhasil diupdate")}catch(o){const d=((u=(a=o.response)==null?void 0:a.data)==null?void 0:u.message)||"Gagal mengupdate variant";f(d,"error"),E()}},La=t=>{fa.value={...t},L.value=!0},Oa=async t=>{P.value=t,H.value=!0},Ra=async()=>{var a,u;if(!P.value)return;const t=P.value;t.removing=!0;try{await w.delete(`/api/variants/${t.id}`);const o=v.value.findIndex(d=>d.id===t.id);o>-1&&v.value.splice(o,1),f("Variant berhasil dihapus")}catch(o){const d=((u=(a=o.response)==null?void 0:a.data)==null?void 0:u.message)||"Gagal menghapus variant";f(d,"error")}finally{t.removing=!1,H.value=!1,P.value=null}},Ja=t=>{b.value=t,O.value=!0},Za=t=>{b.value=t,G.value=!0,Xa(),_a()},Xa=async()=>{aa.value=!0;try{const t=await w.get("/api/items",{params:{per_page:-1,status:!0,type:"raw_material"}});R.value=t.data.data||t.data}catch(t){console.error("Error loading items:",t),R.value=[]}finally{aa.value=!1}},_a=async()=>{var t;if((t=b.value)!=null&&t.id){ea.value=!0;try{const a=await w.get(`/api/variant-items/variant/${b.value.id}`);x.value=a.data}catch(a){console.error("Error loading variant items:",a),x.value=[]}finally{ea.value=!1}}},ka=async()=>{var a,u,o;const{valid:t}=await la.value.validate();if(!(!t||!((a=b.value)!=null&&a.id))){ta.value=!0;try{const d={variant_id:b.value.id,item_id:C.item_id,quantity:C.quantity},I=await w.post("/api/variant-items",d);x.value.push(I.data),C.item_id=null,C.quantity=1,la.value.resetValidation(),f("Item berhasil ditambahkan ke variant")}catch(d){const I=((o=(u=d.response)==null?void 0:u.data)==null?void 0:o.message)||"Gagal menambahkan item";f(I,"error")}finally{ta.value=!1}}},ya=(t,a)=>{a>0&&(t.quantity=a,sa(t))},sa=async t=>{var a,u;try{const o=await w.put(`/api/variant-items/${t.id}`,{quantity:t.quantity});Object.assign(t,o.data),f("Jumlah item berhasil diupdate")}catch(o){const d=((u=(a=o.response)==null?void 0:a.data)==null?void 0:u.message)||"Gagal mengupdate item";f(d,"error"),_a()}},Qa=async t=>{j.value=t,K.value=!0},Wa=async()=>{var a,u;if(!j.value)return;const t=j.value;t.removing=!0;try{await w.delete(`/api/variant-items/${t.id}`);const o=x.value.findIndex(d=>d.id===t.id);o>-1&&x.value.splice(o,1),f("Item berhasil dihapus dari variant")}catch(o){const d=((u=(a=o.response)==null?void 0:a.data)==null?void 0:u.message)||"Gagal menghapus item";f(d,"error")}finally{t.removing=!1,K.value=!1,j.value=null}},Ya=()=>{G.value=!1,E(),f("Item variant berhasil disimpan")},Va=()=>{G.value=!1,Sa(()=>{x.value=[],R.value=[],C.item_id=null,C.quantity=1})},ae=async()=>{var t;if(confirm("Aktifkan semua variant?")){A.value=!0;try{await w.put(`/api/variants/product/${(t=V.product)==null?void 0:t.id}/bulk-activate`),v.value.forEach(a=>a.is_active=!0),f("Semua variant berhasil diaktifkan")}catch{f("Gagal mengaktifkan variant","error")}finally{A.value=!1}}},ee=async()=>{var t;if(confirm("Nonaktifkan semua variant?")){A.value=!0;try{await w.put(`/api/variants/product/${(t=V.product)==null?void 0:t.id}/bulk-deactivate`),v.value.forEach(a=>a.is_active=!1),f("Semua variant berhasil dinonaktifkan")}catch{f("Gagal menonaktifkan variant","error")}finally{A.value=!1}}},te=async()=>{var t;if(confirm("Hitung ulang HPP semua variant berdasarkan komposisi?")){A.value=!0;try{(await w.post(`/api/variants/product/${(t=V.product)==null?void 0:t.id}/recalculate-costs`)).data.forEach(u=>{const o=v.value.findIndex(d=>d.id===u.id);o>-1&&Object.assign(v.value[o],u)}),f("HPP semua variant berhasil dihitung ulang")}catch{f("Gagal menghitung ulang HPP","error")}finally{A.value=!1}}},le=async()=>{var t,a;Y.value=!0;try{const u=await w.get(`/api/variants/product/${(t=V.product)==null?void 0:t.id}/export`,{responseType:"blob"}),o=window.URL.createObjectURL(new Blob([u.data])),d=document.createElement("a");d.href=o,d.setAttribute("download",`variants_${((a=V.product)==null?void 0:a.code)||"product"}_${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(d),d.click(),d.remove(),f("Data variant berhasil diexport")}catch{f("Gagal mengexport data","error")}finally{Y.value=!1}},ne=()=>{L.value=!1,E(),f("Variant berhasil disimpan")},ie=()=>{O.value=!1,E()},se=()=>{pa("save"),oa()},oa=()=>{na.value=!1,Sa(()=>{v.value=[],Object.assign(k,{name:"",sku:""})})};return re(()=>V.modelValue,t=>{var a;t&&V.product&&(E(),Object.assign(k,{name:"",sku:""}),(a=F.value)==null||a.resetValidation())}),(t,a)=>(c(),g(Aa,{modelValue:na.value,"onUpdate:modelValue":a[9]||(a[9]=u=>na.value=u),"max-width":"1400px",persistent:""},{default:l(()=>{var u,o,d,I,N;return[e(U,null,{default:l(()=>[e(B,{class:"text-h5"},{default:l(()=>{var n;return[i("div",ke,[i("div",ye,[e(y,{icon:"mdi-package-variant",class:"me-2"}),r(" Kelola Variant: "+s((n=t.product)==null?void 0:n.name),1)]),e(_,{icon:"mdi-close",variant:"text",onClick:oa})])]}),_:1}),e(z),e(S,{class:"pt-4"},{default:l(()=>[t.product?(c(),g(ua,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:l(()=>{var n;return[i("div",Ve,[i("div",null,[i("strong",null,s(t.product.name),1),r(" ("+s(t.product.code)+") ",1),a[10]||(a[10]=i("br",null,null,-1)),i("small",null,"Kategori: "+s(((n=t.product.category)==null?void 0:n.name)||"Tidak ada"),1)]),i("div",be,[i("div",xe,s(v.value.length)+" Variant",1),i("small",null,s(v.value.reduce((h,m)=>h+(m.variant_items_count||0),0))+" Total Item",1)])])]}),_:1})):$("",!0),e(U,{variant:"outlined",class:"mb-4"},{default:l(()=>[e(B,{class:"text-h6"},{default:l(()=>[e(y,{icon:"mdi-plus",class:"me-2"}),a[11]||(a[11]=r(" Buat Variant Baru "))]),_:1,__:[11]}),e(S,null,{default:l(()=>[e(za,{ref_key:"addForm",ref:F,onSubmit:Ca(ga,["prevent"])},{default:l(()=>[e(X,null,{default:l(()=>[e(D,{cols:"12",md:"8"},{default:l(()=>[e(da,{modelValue:k.name,"onUpdate:modelValue":a[0]||(a[0]=n=>k.name=n),label:"Nama Variant *",variant:"outlined",rules:[n=>!!n||"Nama variant harus diisi",n=>n&&n.length>=3||"Nama variant minimal 3 karakter"],onInput:Ha,hint:"Contoh: Mangga Manis, Mangga Asam, dll","persistent-hint":"",placeholder:"Masukkan nama variant..."},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12",md:"4"},{default:l(()=>[e(_,{color:"primary",onClick:ga,disabled:!k.name||k.name.length<3,loading:W.value,block:"",size:"large"},{default:l(()=>[e(y,{icon:"mdi-plus",class:"me-1"}),a[12]||(a[12]=r(" Buat Variant "))]),_:1,__:[12]},8,["disabled","loading"])]),_:1})]),_:1}),e(ua,{type:"info",variant:"tonal",class:"mt-4"},{default:l(()=>[i("div",he,[e(y,{icon:"mdi-information",class:"me-2"}),i("div",null,[a[13]||(a[13]=i("strong",null,"SKU otomatis:",-1)),r(" "+s(k.sku||"Akan dibuat setelah Anda mengetik nama variant")+" ",1),a[14]||(a[14]=i("br",null,null,-1)),a[15]||(a[15]=i("strong",null,"Langkah selanjutnya:",-1)),a[16]||(a[16]=r(" Setelah membuat variant, tambahkan item/bahan untuk variant tersebut. "))])])]),_:1})]),_:1},512)]),_:1})]),_:1}),e(U,{variant:"outlined"},{default:l(()=>[e(B,{class:"d-flex justify-between align-center"},{default:l(()=>[a[17]||(a[17]=i("span",{class:"text-h6"},"Daftar Variant",-1)),e(q,{color:"primary",variant:"elevated"},{default:l(()=>[r(s(v.value.length)+" Variant ",1)]),_:1})]),_:1,__:[17]}),Q.value?(c(),g(S,{key:0,class:"text-center py-8"},{default:l(()=>[e(Ia,{indeterminate:""}),a[18]||(a[18]=i("div",{class:"mt-2"},"Memuat variant...",-1))]),_:1,__:[18]})):v.value.length===0?(c(),g(S,{key:1,class:"text-center py-8"},{default:l(()=>{var n;return[e(y,{icon:"mdi-package-variant-closed",size:"64",class:"text-medium-emphasis mb-2"}),a[20]||(a[20]=i("div",{class:"text-h6 text-medium-emphasis"},"Belum ada variant",-1)),i("div",we," Buat variant untuk produk "+s((n=t.product)==null?void 0:n.name)+" agar dapat melihat berbagai varian yang tersedia ",1),e(_,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:a[1]||(a[1]=h=>{var m;return(m=t.$refs.addForm)==null?void 0:m.$el.querySelector("input").focus()})},{default:l(()=>a[19]||(a[19]=[r(" Buat Variant Pertama ")])),_:1,__:[19]})]}),_:1,__:[20]})):(c(),g(Ua,{key:2},{default:l(()=>[(c(!0),M(Z,null,$a(v.value,(n,h)=>(c(),M(Z,{key:n.id},[e(ma,null,{prepend:l(()=>[e(ca,{size:"48"},{default:l(()=>{var m;return[e(va,{src:((m=t.product)==null?void 0:m.image_url)||"/images/default-product.png"},null,8,["src"])]}),_:1})]),append:l(()=>[i("div",$e,[i("div",Se,[n.variant_items_count>0?(c(),g(q,{key:0,color:"success",size:"small",variant:"elevated"},{default:l(()=>[r(s(n.variant_items_count)+" Item ",1)]),_:2},1024)):(c(),g(q,{key:1,color:"warning",size:"small",variant:"outlined"},{default:l(()=>a[21]||(a[21]=[r(" Kosong ")])),_:1,__:[21]}))]),e(pe,{modelValue:n.is_active,"onUpdate:modelValue":m=>n.is_active=m,color:"success",density:"compact","hide-details":"",onChange:m=>Ka(n),class:"me-2"},null,8,["modelValue","onUpdate:modelValue","onChange"]),i("div",De,[e(_,{icon:"mdi-plus-box",size:"small",variant:"text",color:n.variant_items_count>0?"primary":"success",onClick:m=>Za(n),class:"me-1"},{default:l(()=>[e(y,null,{default:l(()=>a[22]||(a[22]=[r("mdi-plus-box")])),_:1,__:[22]}),e(fe,{activator:"parent"},{default:l(()=>[r(s(n.variant_items_count>0?"Kelola Item":"Tambah Item Pertama"),1)]),_:2},1024)]),_:2},1032,["color","onClick"]),e(_,{icon:"mdi-puzzle",size:"small",variant:"text",color:"info",onClick:m=>Ja(n),class:"me-1"},null,8,["onClick"]),e(_,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:m=>La(n),class:"me-1"},null,8,["onClick"]),e(_,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:m=>Oa(n),loading:n.removing},null,8,["onClick","loading"])])])]),default:l(()=>[e(Ba,null,{default:l(()=>[r(s(n.name)+" ",1),e(q,{color:n.is_active?"success":"error",size:"x-small",class:"ml-2"},{default:l(()=>[r(s(n.is_active?"Aktif":"Nonaktif"),1)]),_:2},1032,["color"]),ia(n).color!=="success"?(c(),g(q,{key:0,color:ia(n).color,size:"x-small",class:"ml-2"},{default:l(()=>[r(s(ia(n).text),1)]),_:2},1032,["color"])):$("",!0)]),_:2},1024),e(qa,null,{default:l(()=>[r(s(n.sku)+" | ",1),n.variant_items_count>0?(c(),M("span",Ce,s(n.variant_items_count)+" Item ",1)):(c(),M("span",Ie," Belum ada item - Tambahkan item untuk variant ini "))]),_:2},1024)]),_:2},1024),h<v.value.length-1?(c(),g(z,{key:0})):$("",!0)],64))),128))]),_:1})),v.value.length>0?(c(),g(z,{key:3})):$("",!0),v.value.length>0?(c(),g(S,{key:4},{default:l(()=>[e(X,null,{default:l(()=>[e(D,{cols:"12",md:"6"},{default:l(()=>[a[23]||(a[23]=i("div",{class:"text-h6"},"Ringkasan Variant",-1)),i("div",Ae,s(v.value.length)+" total variant ",1),i("div",Te,s(Ea.value)+" variant aktif ",1)]),_:1,__:[23]}),e(D,{cols:"12",md:"6",class:"text-md-end"},{default:l(()=>[i("div",ze,s(v.value.reduce((n,h)=>n+(h.variant_items_count||0),0)),1),a[24]||(a[24]=i("div",{class:"text-body-2"},"Total Item",-1)),i("div",Ue," Tersebar di "+s(v.value.length)+" variant ",1)]),_:1,__:[24]})]),_:1})]),_:1})):$("",!0)]),_:1}),v.value.length>0?(c(),g(U,{key:1,variant:"outlined",class:"mt-4"},{default:l(()=>[e(B,{class:"text-h6"},{default:l(()=>[e(y,{icon:"mdi-cog",class:"me-2"}),a[25]||(a[25]=r(" Aksi Massal "))]),_:1,__:[25]}),e(S,null,{default:l(()=>[e(X,null,{default:l(()=>[e(D,{cols:"12",md:"3"},{default:l(()=>[e(_,{onClick:ae,loading:A.value,color:"success",variant:"outlined",block:""},{default:l(()=>[e(y,{icon:"mdi-check-all",class:"me-1"}),a[26]||(a[26]=r(" Aktifkan Semua "))]),_:1,__:[26]},8,["loading"])]),_:1}),e(D,{cols:"12",md:"3"},{default:l(()=>[e(_,{onClick:ee,loading:A.value,color:"warning",variant:"outlined",block:""},{default:l(()=>[e(y,{icon:"mdi-close-circle",class:"me-1"}),a[27]||(a[27]=r(" Nonaktifkan Semua "))]),_:1,__:[27]},8,["loading"])]),_:1}),e(D,{cols:"12",md:"3"},{default:l(()=>[e(_,{onClick:te,loading:A.value,color:"info",variant:"outlined",block:""},{default:l(()=>[e(y,{icon:"mdi-calculator",class:"me-1"}),a[28]||(a[28]=r(" Hitung Ulang HPP "))]),_:1,__:[28]},8,["loading"])]),_:1}),e(D,{cols:"12",md:"3"},{default:l(()=>[e(_,{onClick:le,loading:Y.value,color:"primary",variant:"outlined",block:""},{default:l(()=>[e(y,{icon:"mdi-download",class:"me-1"}),a[29]||(a[29]=r(" Export Data "))]),_:1,__:[29]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})):$("",!0)]),_:1}),e(z),e(Ta,null,{default:l(()=>[e(Pa),e(_,{color:"grey-darken-1",variant:"outlined",onClick:oa},{default:l(()=>[e(y,{icon:"mdi-close",class:"me-1"}),a[30]||(a[30]=r(" Tutup "))]),_:1,__:[30]}),e(_,{color:"primary",variant:"elevated",onClick:se,loading:Ma.value},{default:l(()=>[e(y,{icon:"mdi-content-save",class:"me-1"}),a[31]||(a[31]=r(" Simpan Semua "))]),_:1,__:[31]},8,["loading"])]),_:1})]),_:1}),t.product?(c(),g(ce,{key:0,modelValue:L.value,"onUpdate:modelValue":a[2]||(a[2]=n=>L.value=n),variant:fa.value,products:[t.product],"product-id":t.product.id,onSave:ne},null,8,["modelValue","variant","products","product-id"])):$("",!0),e(ve,{modelValue:O.value,"onUpdate:modelValue":a[3]||(a[3]=n=>O.value=n),variant:b.value,onSave:ie},null,8,["modelValue","variant"]),e(Aa,{modelValue:G.value,"onUpdate:modelValue":a[6]||(a[6]=n=>G.value=n),"max-width":"800px",persistent:""},{default:l(()=>[e(U,null,{default:l(()=>[e(B,{class:"text-h5"},{default:l(()=>{var n;return[i("div",Be,[i("div",qe,[e(y,{icon:"mdi-plus-box",class:"me-2"}),r(" Tambah Item ke Variant: "+s((n=b.value)==null?void 0:n.name),1)]),e(_,{icon:"mdi-close",variant:"text",onClick:Va})])]}),_:1}),e(z),e(S,{class:"pt-4"},{default:l(()=>[b.value?(c(),g(ua,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:l(()=>[i("div",Pe,[i("div",null,[i("strong",null,s(b.value.name),1),r(" ("+s(b.value.sku)+") ",1),a[32]||(a[32]=i("br",null,null,-1)),i("small",null,s(b.value.variant_items_count||0)+" Item",1)]),i("div",je,[e(q,{color:b.value.is_active?"success":"default",size:"small"},{default:l(()=>[r(s(b.value.is_active?"Aktif":"Nonaktif"),1)]),_:1},8,["color"])])])]),_:1})):$("",!0),e(U,{variant:"outlined",class:"mb-4"},{default:l(()=>[e(B,{class:"text-h6"},{default:l(()=>a[33]||(a[33]=[r("Tambah Item Baru")])),_:1,__:[33]}),e(S,null,{default:l(()=>[e(za,{ref_key:"addItemForm",ref:la,onSubmit:Ca(ka,["prevent"])},{default:l(()=>[e(X,null,{default:l(()=>[e(D,{cols:"12",md:"6"},{default:l(()=>[e(ge,{modelValue:C.item_id,"onUpdate:modelValue":a[4]||(a[4]=n=>C.item_id=n),items:R.value,loading:aa.value,label:"Pilih Item *",variant:"outlined","item-title":"name","item-value":"id",rules:[n=>!!n||"Item harus dipilih"],clearable:""},{item:l(({props:n,item:h})=>[e(ma,ue(n,{subtitle:`${h.raw.code} | Stok: ${h.raw.current_stock} | ${J(h.raw.cost)}`}),{prepend:l(()=>[e(ca,{size:"40"},{default:l(()=>[e(va,{src:h.raw.image||"/images/default-item.png"},null,8,["src"])]),_:2},1024)]),_:2},1040,["subtitle"])]),_:1},8,["modelValue","items","loading","rules"])]),_:1}),e(D,{cols:"12",md:"3"},{default:l(()=>[e(da,{modelValue:C.quantity,"onUpdate:modelValue":a[5]||(a[5]=n=>C.quantity=n),modelModifiers:{number:!0},label:"Jumlah *",variant:"outlined",type:"number",min:"0.01",step:"0.01",rules:[n=>n>0||"Jumlah harus lebih dari 0"]},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12",md:"3"},{default:l(()=>[e(_,{color:"primary",onClick:ka,disabled:!C.item_id||!C.quantity,loading:ta.value,block:"",size:"large"},{default:l(()=>[e(y,{icon:"mdi-plus",class:"me-1"}),a[34]||(a[34]=r(" Tambah Item "))]),_:1,__:[34]},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),e(U,{variant:"outlined"},{default:l(()=>[e(B,{class:"d-flex justify-between align-center"},{default:l(()=>[a[35]||(a[35]=i("span",{class:"text-h6"},"Item dalam Variant",-1)),e(q,{color:"primary",variant:"elevated"},{default:l(()=>[r(s(x.value.length)+" Item ",1)]),_:1})]),_:1,__:[35]}),ea.value?(c(),g(S,{key:0,class:"text-center py-8"},{default:l(()=>[e(Ia,{indeterminate:""}),a[36]||(a[36]=i("div",{class:"mt-2"},"Memuat item variant...",-1))]),_:1,__:[36]})):x.value.length===0?(c(),g(S,{key:1,class:"text-center py-8"},{default:l(()=>[e(y,{icon:"mdi-package-variant-closed",size:"64",class:"text-medium-emphasis mb-2"}),a[37]||(a[37]=i("div",{class:"text-h6 text-medium-emphasis"},"Belum ada item",-1)),a[38]||(a[38]=i("div",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item untuk variant ini ",-1))]),_:1,__:[37,38]})):(c(),g(Ua,{key:2},{default:l(()=>[(c(!0),M(Z,null,$a(x.value,(n,h)=>(c(),M(Z,{key:n.id},[e(ma,null,{prepend:l(()=>[e(ca,{size:"48"},{default:l(()=>{var m;return[e(va,{src:((m=n.item)==null?void 0:m.image)||"/images/default-item.png"},null,8,["src"])]}),_:2},1024)]),append:l(()=>{var m;return[i("div",Ne,[i("div",Me,[e(_,{icon:"mdi-minus",size:"small",variant:"text",onClick:T=>ya(n,n.quantity-.5),disabled:n.quantity<=.5},null,8,["onClick","disabled"]),e(da,{modelValue:n.quantity,"onUpdate:modelValue":T=>n.quantity=T,modelModifiers:{number:!0},variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",style:{width:"100px"},onBlur:T=>sa(n),onKeydown:de(T=>sa(n),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeydown"]),e(_,{icon:"mdi-plus",size:"small",variant:"text",onClick:T=>ya(n,n.quantity+.5)},null,8,["onClick"])]),i("div",Ge,[i("div",Ee,s(J(n.total_cost)),1),i("div",Fe,s(n.quantity)+" "+s((m=n.item)==null?void 0:m.unit),1)]),e(_,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:T=>Qa(n),loading:n.removing},null,8,["onClick","loading"])])]}),default:l(()=>[e(Ba,null,{default:l(()=>{var m;return[r(s((m=n.item)==null?void 0:m.name),1)]}),_:2},1024),e(qa,null,{default:l(()=>{var m,T,ba,xa,ha;return[r(s((m=n.item)==null?void 0:m.code)+" | Stok: "+s((T=n.item)==null?void 0:T.current_stock)+" "+s((ba=n.item)==null?void 0:ba.unit)+" | "+s(J(((xa=n.item)==null?void 0:xa.cost)||0))+"/"+s((ha=n.item)==null?void 0:ha.unit),1)]}),_:2},1024)]),_:2},1024),h<x.value.length-1?(c(),g(z,{key:0})):$("",!0)],64))),128))]),_:1})),x.value.length>0?(c(),g(z,{key:3})):$("",!0),x.value.length>0?(c(),g(S,{key:4},{default:l(()=>[i("div",He,[i("div",null,[a[39]||(a[39]=i("div",{class:"text-h6"},"Total HPP Item",-1)),i("div",Ke,s(x.value.length)+" item ",1)]),i("div",Le,[i("div",Oe,s(J(Fa.value)),1),a[40]||(a[40]=i("div",{class:"text-body-2"},"Total Biaya",-1))])])]),_:1})):$("",!0)]),_:1})]),_:1}),e(z),e(Ta,null,{default:l(()=>[e(Pa),e(_,{color:"grey-darken-1",variant:"outlined",onClick:Va},{default:l(()=>[e(y,{icon:"mdi-close",class:"me-1"}),a[41]||(a[41]=r(" Tutup "))]),_:1,__:[41]}),e(_,{color:"primary",variant:"elevated",onClick:Ya,loading:Ga.value},{default:l(()=>[e(y,{icon:"mdi-content-save",class:"me-1"}),a[42]||(a[42]=r(" Simpan Item "))]),_:1,__:[42]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Da,{modelValue:H.value,"onUpdate:modelValue":a[7]||(a[7]=n=>H.value=n),"item-name":((u=P.value)==null?void 0:u.name)||"",loading:((o=P.value)==null?void 0:o.removing)||!1,onConfirm:Ra},null,8,["modelValue","item-name","loading"]),e(Da,{modelValue:K.value,"onUpdate:modelValue":a[8]||(a[8]=n=>K.value=n),"item-name":((I=(d=j.value)==null?void 0:d.item)==null?void 0:I.name)||"",loading:((N=j.value)==null?void 0:N.removing)||!1,onConfirm:Wa},null,8,["modelValue","item-name","loading"])]}),_:1},8,["modelValue"]))}}),wt=_e(Re,[["__scopeId","data-v-b82c48fa"]]);export{wt as default};
