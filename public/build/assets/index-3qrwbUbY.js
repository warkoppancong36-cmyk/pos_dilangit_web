import{r as p,V as x,w as se,aX as ee,d as _e,au as ge,D as ke,c as k,e as a,b as l,f as c,t as d,a0 as w,g as Q,l as q,F as oe,i as re,aw as fe,X as S,m as b,o as v,s as m,v as te,$ as ye}from"./main-kWdP1oe5.js";import{P as O}from"./PosApi-DcybiHRJ.js";import he from"./CashDrawerDialog-_4ZdTiuu.js";import be from"./PaymentDialog-BRyBDjc_.js";import Ce from"./TransactionHistoryDialog-DNrgENxV.js";import{V as Ve}from"./VAvatar-3SMEzcUJ.js";import{V as we}from"./VTextField-C-nOen11.js";import{V as xe}from"./VSelect-ClbUUBQH.js";import{V as le}from"./VChip-IxYeBK0i.js";import{V as De}from"./VDialog-DaOkwfi-.js";import{V as Se}from"./VSnackbar-DlL7aoBU.js";import{V as Ie}from"./VImg-C8YwdMDe.js";import{V as Te,b as Pe,c as ze}from"./VCard-CLhZX5BR.js";import{V as Ae}from"./VCardText-f5BLRHhP.js";import{V as Ee}from"./VSpacer-D_6cqm10.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./auth-a9M5ekjn.js";import"./VDivider-D6xYvzqi.js";import"./VRow-C4Q69HFC.js";/* empty css              */import"./VForm-Bvl623Db.js";import"./forwardRefs-B931MWyl.js";import"./VTextarea-CeKmbo1R.js";import"./DiscountCodeInput-BxkHPAeX.js";import"./VAlert-DB7sTYAd.js";import"./PromotionSuggestions-pluuSoy_.js";import"./VCheckboxBtn-DEhhjyie.js";import"./EditOrderDialog-BPbxTLDO.js";import"./OrderDetailDialog-CkKMzabd.js";import"./VTable-BVU2I6xW.js";import"./VDataTable-Cb92UWW1.js";import"./filter-DOfLzxk-.js";import"./VList-CE8XXKXD.js";import"./VOverlay-AYrTMtnA.js";import"./VMenu-DV8UWnSA.js";const $e=()=>{const _=p([]),$=p(null),u=p(0),g=p("amount"),L=p(0),K=p(!1),f=p(null),y=x(()=>_.value.reduce((s,r)=>s+r.selling_price*r.quantity,0)),C=x(()=>u.value?g.value==="percentage"?y.value*u.value/100:u.value:0),I=x(()=>(y.value-C.value)*L.value/100),j=x(()=>Math.max(0,y.value-C.value+I.value)),G=x(()=>_.value.reduce((s,r)=>s+r.quantity,0)),H=x(()=>_.value.length===0),h=x(()=>({subtotal:y.value,discountAmount:C.value,discountType:g.value,taxAmount:I.value,totalAmount:j.value})),B=(s,r=1)=>{try{const n=_.value.find(D=>D.id_product===s.id_product);if(n){const D=n.quantity+r;if(D<=s.stock)n.quantity=D;else throw new Error(`Stok tidak mencukupi. Tersedia: ${s.stock}`)}else if(r<=s.stock)_.value.push({...s,quantity:r});else throw new Error(`Stok tidak mencukupi. Tersedia: ${s.stock}`);return f.value=null,!0}catch(n){return f.value=n instanceof Error?n.message:"Gagal menambahkan ke keranjang",!1}},T=s=>{const r=_.value.findIndex(n=>n.id_product===s);r>-1&&_.value.splice(r,1)},N=(s,r)=>{const n=_.value.find(D=>D.id_product===s);if(n)if(r<=0)T(s);else if(r<=n.stock)n.quantity=r;else return f.value=`Stok tidak mencukupi. Tersedia: ${n.stock}`,!1;return!0},F=()=>{_.value=[],$.value=null,u.value=0,g.value="amount",f.value=null},P=(s,r="amount")=>r==="percentage"&&s>100?(f.value="Diskon persentase tidak boleh lebih dari 100%",!1):r==="amount"&&s>y.value?(f.value="Diskon tidak boleh lebih dari subtotal",!1):(u.value=s,g.value=r,f.value=null,!0),R=()=>{u.value=0,g.value="amount"},X=s=>{$.value=s},z=async(s,r="takeaway")=>{try{if(K.value=!0,f.value=null,H.value)throw new Error("Keranjang kosong");const n={order_type:r,id_customer:$.value||void 0,guest_count:1,notes:s.notes},E=(await O.createOrder(n)).data;for(const U of _.value)await O.addItem(E.id_order,{id_product:U.id_product,id_variant:U.id_variant||void 0,quantity:U.quantity,price:U.selling_price,notes:""});return C.value>0&&await O.applyDiscount(E.id_order,{discount_type:g.value==="percentage"?"percentage":"fixed",discount_value:g.value==="percentage"?u.value:C.value}),await O.processPayment(E.id_order,{payment_method:s.payment_method,amount:s.amount,reference_number:s.reference_number,notes:s.notes}),F(),E}catch(n){throw f.value=n instanceof Error?n.message:"Gagal membuat pesanan",n}finally{K.value=!1}},W=()=>{const s=[];return H.value&&s.push("Keranjang kosong"),_.value.forEach(r=>{r.quantity>r.stock&&s.push(`Stok ${r.name} tidak mencukupi`)}),C.value>y.value&&s.push("Diskon tidak boleh lebih dari subtotal"),{isValid:s.length===0,errors:s}},Y=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),A=s=>_.value.find(r=>r.id_product===s),M=s=>{const r=A(s);return r?r.quantity:0},Z=(s,r=1)=>M(s.id_product)+r<=s.stock;return se([_,u,g],()=>{const s=W();!s.isValid&&s.errors.length>0?f.value=s.errors[0]:f.value=null},{deep:!0}),se([u,g,y],()=>{g.value==="percentage"&&u.value>100&&(u.value=100),C.value>y.value&&(g.value==="amount"?u.value=y.value:u.value=100)}),{cartItems:ee(_),selectedCustomer:$,discountAmount:u,discountType:g,taxRate:L,loading:ee(K),error:ee(f),subtotal:y,discountValue:C,taxValue:I,totalAmount:j,cartCount:G,isEmpty:H,orderSummary:h,addToCart:B,removeFromCart:T,updateQuantity:N,clearCart:F,applyDiscount:P,removeDiscount:R,setCustomer:X,createOrder:z,validateCart:W,formatCurrency:Y,getCartItemById:A,getItemQuantity:M,canAddToCart:Z}},je={class:"pos-layout"},He={class:"pos-header"},Be={class:"header-content"},Fe={class:"header-left"},Ue={class:"logo-section"},Le={class:"header-info"},Ke={class:"header-meta"},Ne={class:"header-actions"},Re={class:"pos-main"},Me={class:"product-panel"},Je={class:"filter-bar"},Qe={class:"search-section"},Oe={class:"filter-section"},Ge={class:"products-container"},Xe={key:0,class:"products-grid"},We=["onClick"],Ye={class:"product-image"},Ze={class:"product-image-wrapper"},et={key:1,class:"product-image-placeholder"},tt={class:"placeholder-text"},at={key:0,class:"status-indicator out-of-stock-indicator"},st={key:1,class:"status-indicator no-price-indicator"},ot={key:2,class:"cart-indicator"},rt={class:"product-info"},lt={class:"product-name"},nt={class:"product-sku"},it={class:"product-footer"},ut={key:1,class:"empty-state"},ct={key:2,class:"empty-state"},dt={class:"empty-title"},mt={class:"empty-text"},vt={class:"cart-panel"},pt={class:"cart-header"},_t={class:"cart-title"},gt={class:"cart-content"},kt={key:0,class:"cart-items"},ft={class:"item-info"},yt={class:"item-name"},ht={class:"item-price"},bt={class:"item-controls"},Ct={class:"quantity-controls"},Vt={class:"quantity"},wt={class:"item-total"},xt={key:1,class:"empty-cart"},Dt={key:0,class:"cart-summary"},St={class:"summary-row"},It={class:"summary-value"},Tt={class:"summary-row"},Pt={class:"summary-value"},zt={class:"summary-row"},At={class:"summary-value summary-total"},Et=_e({__name:"index",setup(_){const $=ge(),{cartItems:u,subtotal:g,cartCount:L,addToCart:K,removeFromCart:f,updateQuantity:y,clearCart:C}=$e(),I=p(!1),j=p([]),G=p([]),H=p([]),h=p(""),B=p(null),T=p(!1),N=p(!1),F=p(!1),P=p(!1),R=p(""),X=p({}),z=p({show:!1,message:"",color:"success"});setInterval(()=>{R.value=new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})},1e3);const W=x(()=>$.user);x(()=>new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));const Y=x(()=>u.value.map(o=>({...o}))),A=x(()=>{let o=j.value;if(h.value){const e=h.value.toLowerCase();o=o.filter(i=>{var t,V;return i.name.toLowerCase().includes(e)||((t=i.sku)==null?void 0:t.toLowerCase().includes(e))||((V=i.barcode)==null?void 0:V.toLowerCase().includes(e))})}return B.value&&(o=o.filter(e=>e.id_category===B.value)),o}),M=async()=>{try{I.value=!0;const o=await O.getProducts();j.value=o.data.map(i=>{var t,V,ae;return{id_product:i.id_product,name:i.name,sku:i.sku,selling_price:parseFloat(i.price),stock:((t=i.stock_info)==null?void 0:t.available_stock)||((V=i.stock_info)==null?void 0:V.current_stock)||i.stock||0,image:i.image_url||i.image,id_category:(ae=i.category)==null?void 0:ae.id_category}});const e=o.data.find(i=>i.name==="TES AJA NIH");e&&console.log("ðŸ–¼ï¸ TES AJA NIH Image Debug:",{image:e.image,image_url:e.image_url,mapped_image:e.image_url||e.image}),console.log("Loaded products with stock:",j.value.map(i=>({name:i.name,stock:i.stock})))}catch(o){console.error("Error loading products:",o)}finally{I.value=!1}},Z=async()=>{try{G.value=[{id_category:1,name:"Minuman"},{id_category:2,name:"Makanan"},{id_category:3,name:"Snack"}]}catch(o){console.error("Error loading categories:",o)}},s=async()=>{try{H.value=[{id_customer:1,name:"John Doe",phone:"0812345678",email:"john@example.com"},{id_customer:2,name:"Jane Smith",phone:"0812345679",email:"jane@example.com"},{id_customer:3,name:"Bob Johnson",phone:"0812345680",email:"bob@example.com"}]}catch(o){console.error("Error loading customers:",o)}},r=o=>{if(!n(o)){o.stock<=0?console.warn("Stok tidak tersedia untuk produk:",o.name):(!o.selling_price||o.selling_price<=0)&&console.warn("Harga tidak tersedia untuk produk:",o.name);return}K(o)&&console.log("Produk berhasil ditambahkan ke keranjang")},n=o=>o.stock>0&&o.selling_price>0,D=o=>o===0?"stock-low":o<10?"stock-medium":"stock-high",E=o=>{const e=u.value.find(i=>i.id_product===o);return e?e.quantity:0},U=()=>{P.value=!0},ne=()=>{C(),P.value=!1},ie=o=>{console.error("ðŸ–¼ï¸ Image error for product ID:",o),X.value[o]=!0},ue=o=>o.split(" ").slice(0,2).map(e=>e.charAt(0)).join("").toUpperCase(),ce=()=>{T.value=!0},de=o=>{console.log("Payment completed:",o),z.value={show:!0,message:"Pembayaran berhasil diproses! ðŸŽ‰",color:"success"},T.value=!1,M()},me=()=>{C()},ve=()=>{F.value=!0},pe=()=>{N.value=!0},J=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o);return ke(async()=>{R.value=new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),await Promise.all([M(),Z(),s()])}),(o,e)=>{var i;return v(),k("div",je,[a("div",He,[a("div",Be,[a("div",Fe,[a("div",Ue,[l(Ve,{size:"40",color:"primary"},{default:c(()=>[l(S,{size:"20"},{default:c(()=>e[9]||(e[9]=[m("tabler-shopping-cart")])),_:1,__:[9]})]),_:1}),a("div",Le,[e[11]||(e[11]=a("h3",{class:"pos-title"},"Point of Sale",-1)),a("div",Ke,[a("span",null,d(((i=W.value)==null?void 0:i.name)||"Administrator"),1),e[10]||(e[10]=a("span",null,"â€¢",-1)),a("span",null,d(R.value),1)])])])]),a("div",Ne,[l(w,{variant:"text",color:"primary","prepend-icon":"tabler-history",onClick:pe},{default:c(()=>e[12]||(e[12]=[m(" Riwayat ")])),_:1,__:[12]}),l(w,{variant:"outlined",color:"success","prepend-icon":"tabler-receipt",onClick:ve},{default:c(()=>e[13]||(e[13]=[m(" Cash Drawer ")])),_:1,__:[13]})])])]),a("div",Re,[a("div",Me,[a("div",Je,[a("div",Qe,[l(we,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),placeholder:"Cari produk, SKU, atau barcode...",density:"comfortable",variant:"solo","prepend-inner-icon":"tabler-search",clearable:"","hide-details":"",class:"search-input"},null,8,["modelValue"])]),a("div",Oe,[l(xe,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=t=>B.value=t),items:G.value,"item-title":"name","item-value":"id_category",placeholder:"Kategori",density:"comfortable",variant:"solo","prepend-inner-icon":"tabler-category",clearable:"","hide-details":"",style:{"min-inline-size":"180px"},class:"category-select"},null,8,["modelValue","items"]),A.value.length>0?(v(),Q(le,{key:0,color:"primary",variant:"tonal",size:"large"},{default:c(()=>[m(d(A.value.length)+" produk ",1)]),_:1})):q("",!0)])]),a("div",Ge,[!I.value&&A.value.length>0?(v(),k("div",Xe,[(v(!0),k(oe,null,re(A.value,t=>(v(),k("div",{key:t.id_product,class:te(["product-item",{"out-of-stock":t.stock===0,"no-price":!t.selling_price||t.selling_price<=0,disabled:t.stock===0||!t.selling_price||t.selling_price<=0}]),onClick:V=>n(t)?r(t):null},[a("div",Ye,[a("div",Ze,[t.image&&!X.value[t.id_product]?(v(),Q(Ie,{key:0,src:t.image,class:"product-image-content",cover:"",onError:V=>ie(t.id_product)},null,8,["src","onError"])):(v(),k("div",et,[l(S,{size:"32",color:"grey-400"},{default:c(()=>e[14]||(e[14]=[m("tabler-package")])),_:1,__:[14]}),a("span",tt,d(ue(t.name)),1)]))]),a("div",{class:te(["stock-badge",D(t.stock)])},[l(S,{icon:t.stock>0?"tabler-package":"tabler-package-off",size:"12",class:"mr-1"},null,8,["icon"]),m(" Stock: "+d(t.stock),1)],2),t.stock===0?(v(),k("div",at,[l(S,{icon:"tabler-alert-circle",size:"14"}),e[15]||(e[15]=m(" Stok Habis "))])):!t.selling_price||t.selling_price<=0?(v(),k("div",st,[l(S,{icon:"tabler-alert-triangle",size:"14"}),e[16]||(e[16]=m(" Harga Kosong "))])):q("",!0),E(t.id_product)>0?(v(),k("div",ot,d(E(t.id_product))+" di keranjang ",1)):q("",!0)]),a("div",rt,[a("h6",lt,d(t.name),1),a("p",nt,d(t.sku),1),a("div",it,[a("span",{class:te(["product-price",{"price-missing":!t.selling_price||t.selling_price<=0}])},d(t.selling_price&&t.selling_price>0?J(t.selling_price):"Harga tidak tersedia"),3),l(w,{size:"small",color:"primary",variant:"flat",icon:"tabler-plus",disabled:!n(t),onClick:ye(V=>n(t)?r(t):null,["stop"])},null,8,["disabled","onClick"])])])],10,We))),128))])):I.value?(v(),k("div",ut,[l(fe,{size:"48",color:"primary",indeterminate:""}),e[17]||(e[17]=a("p",{class:"empty-text"},"Memuat produk...",-1))])):(v(),k("div",ct,[l(S,{size:"64",color:"grey-400"},{default:c(()=>[m(d(h.value?"tabler-search-off":"tabler-package"),1)]),_:1}),a("h4",dt,d(h.value?"Produk Tidak Ditemukan":"Tidak Ada Produk"),1),a("p",mt,d(h.value?`Coba kata kunci lain untuk pencarian "${h.value}"`:"Belum ada produk yang tersedia"),1),h.value?(v(),Q(w,{key:0,variant:"outlined",onClick:e[2]||(e[2]=t=>h.value="")},{default:c(()=>e[18]||(e[18]=[m(" Reset Pencarian ")])),_:1,__:[18]})):q("",!0)]))])]),a("div",vt,[a("div",pt,[a("div",_t,[l(S,{size:"20",color:"success"},{default:c(()=>e[19]||(e[19]=[m("tabler-shopping-cart")])),_:1,__:[19]}),e[20]||(e[20]=a("span",null,"Keranjang",-1)),b(u).length>0?(v(),Q(le,{key:0,color:"success",variant:"tonal",size:"small"},{default:c(()=>[m(d(b(L)),1)]),_:1})):q("",!0)]),b(u).length>0?(v(),Q(w,{key:0,variant:"text",color:"error",size:"small","prepend-icon":"tabler-trash",onClick:U},{default:c(()=>e[21]||(e[21]=[m(" Hapus Semua ")])),_:1,__:[21]})):q("",!0)]),a("div",gt,[b(u).length>0?(v(),k("div",kt,[(v(!0),k(oe,null,re(b(u),t=>(v(),k("div",{key:t.id_product,class:"cart-item"},[a("div",ft,[a("h6",yt,d(t.name),1),a("p",ht,d(J(t.selling_price))+" / item",1)]),a("div",bt,[a("div",Ct,[l(w,{size:"x-small",variant:"text",color:"error",icon:"tabler-minus",disabled:t.quantity<=1,onClick:V=>b(y)(t.id_product,t.quantity-1)},null,8,["disabled","onClick"]),a("span",Vt,d(t.quantity),1),l(w,{size:"x-small",variant:"text",color:"success",icon:"tabler-plus",disabled:t.quantity>=t.stock,onClick:V=>b(y)(t.id_product,t.quantity+1)},null,8,["disabled","onClick"])]),a("div",wt,d(J(t.selling_price*t.quantity)),1),l(w,{size:"x-small",variant:"text",color:"error",icon:"tabler-x",onClick:V=>b(f)(t.id_product)},null,8,["onClick"])])]))),128))])):(v(),k("div",xt,[l(S,{size:"48",color:"grey-400"},{default:c(()=>e[22]||(e[22]=[m("tabler-shopping-cart")])),_:1,__:[22]}),e[23]||(e[23]=a("h4",null,"Keranjang Kosong",-1)),e[24]||(e[24]=a("p",null,"Pilih produk untuk mulai berbelanja",-1))]))]),b(u).length>0?(v(),k("div",Dt,[a("div",St,[e[25]||(e[25]=a("span",{class:"summary-label"},"Subtotal",-1)),a("span",It,d(J(b(g))),1)]),a("div",Tt,[e[26]||(e[26]=a("span",{class:"summary-label"},"Items",-1)),a("span",Pt,d(b(L)),1)]),a("div",zt,[e[27]||(e[27]=a("span",{class:"summary-label summary-total"},"Total",-1)),a("span",At,d(J(b(g))),1)]),l(w,{color:"success",size:"large",block:"",class:"checkout-btn",onClick:ce},{default:c(()=>[l(S,{start:""},{default:c(()=>e[28]||(e[28]=[m("tabler-credit-card")])),_:1,__:[28]}),e[29]||(e[29]=m(" Bayar Sekarang "))]),_:1,__:[29]})])):q("",!0)])]),l(be,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=t=>T.value=t),"cart-items":Y.value,customers:H.value,onPaymentSuccess:de,onClearCart:me},null,8,["modelValue","cart-items","customers"]),l(Ce,{modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=t=>N.value=t)},null,8,["modelValue"]),l(he,{modelValue:F.value,"onUpdate:modelValue":e[5]||(e[5]=t=>F.value=t)},null,8,["modelValue"]),l(De,{modelValue:P.value,"onUpdate:modelValue":e[7]||(e[7]=t=>P.value=t),"max-width":"400",persistent:""},{default:c(()=>[l(Te,null,{default:c(()=>[l(Pe,null,{default:c(()=>e[30]||(e[30]=[m("Hapus Semua Item?")])),_:1,__:[30]}),l(Ae,null,{default:c(()=>e[31]||(e[31]=[m(" Apakah Anda yakin ingin menghapus semua item dari keranjang? ")])),_:1,__:[31]}),l(ze,null,{default:c(()=>[l(Ee),l(w,{variant:"text",onClick:e[6]||(e[6]=t=>P.value=!1)},{default:c(()=>e[32]||(e[32]=[m("Batal")])),_:1,__:[32]}),l(w,{color:"error",variant:"text",onClick:ne},{default:c(()=>e[33]||(e[33]=[m("Hapus")])),_:1,__:[33]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Se,{modelValue:z.value.show,"onUpdate:modelValue":e[8]||(e[8]=t=>z.value.show=t),color:z.value.color,timeout:4e3,location:"top right"},{default:c(()=>[m(d(z.value.message),1)]),_:1},8,["modelValue","color"])])}}}),_a=qe(Et,[["__scopeId","data-v-9211d32a"]]);export{_a as default};
