import{r as v,V as x,w as ae,bl as ee,d as pe,au as _e,D as ge,c as g,e as a,b as l,f as u,t as c,a0 as w,g as J,l as E,F as se,i as oe,aw as fe,X as S,m as h,o as m,s as d,v as te,$ as ke}from"./main-CBieGgt2.js";import{P as O}from"./PosApi-CAWU4C2p.js";import ye from"./CashDrawerDialog-C8Oew_z2.js";import he from"./PaymentDialog-wnXgFKBP.js";import be from"./TransactionHistoryDialog-B8DAWsqp.js";import{V as Ce}from"./VAvatar-SRbocHam.js";import{V as Ve}from"./VTextField-BcAeW67M.js";import{V as we}from"./VSelect-BqpkGD1S.js";import{V as re}from"./VChip-CUvmn3GD.js";import{V as xe}from"./VDialog-05PAAxpz.js";import{V as De}from"./VSnackbar-B-zU94df.js";import{V as Se}from"./VImg-BRSac059.js";import{V as Ie,b as Te,c as ze}from"./VCard-DNMkVA9Y.js";import{V as Pe}from"./VCardText-DH5Ygolj.js";import{V as qe}from"./VSpacer-BqlpQUeG.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./auth-CuuXRWj5.js";import"./VDivider-4cT9G7xT.js";import"./VRow-rILDZYkB.js";/* empty css              */import"./VForm-HvkzlCA2.js";import"./forwardRefs-B931MWyl.js";import"./VTextarea-CA-1XBS9.js";import"./DiscountCodeInput-Dn-Lc6xv.js";import"./VAlert-BxPkO_hf.js";import"./PromotionSuggestions-D2iQPxSU.js";import"./VCheckboxBtn-NWxqozbZ.js";import"./EditOrderDialog-hWgQnjjo.js";import"./OrderDetailDialog-DFpBGggk.js";import"./VTable-CMKDRTDG.js";import"./VDataTable-CP1flFCv.js";import"./filter-C5QUR2us.js";import"./VList-DFzv6ALg.js";import"./VOverlay-BPIdux_c.js";import"./VMenu-PaxLP6h7.js";const Ee=()=>{const p=v([]),$=v(null),i=v(0),_=v("amount"),U=v(0),K=v(!1),f=v(null),k=x(()=>p.value.reduce((s,r)=>s+r.selling_price*r.quantity,0)),b=x(()=>i.value?_.value==="percentage"?k.value*i.value/100:i.value:0),I=x(()=>(k.value-b.value)*U.value/100),L=x(()=>Math.max(0,k.value-b.value+I.value)),G=x(()=>p.value.reduce((s,r)=>s+r.quantity,0)),j=x(()=>p.value.length===0),y=x(()=>({subtotal:k.value,discountAmount:b.value,discountType:_.value,taxAmount:I.value,totalAmount:L.value})),B=(s,r=1)=>{try{const n=p.value.find(D=>D.id_product===s.id_product);if(n){const D=n.quantity+r;if(D<=s.stock)n.quantity=D;else throw new Error(`Stok tidak mencukupi. Tersedia: ${s.stock}`)}else if(r<=s.stock)p.value.push({...s,quantity:r});else throw new Error(`Stok tidak mencukupi. Tersedia: ${s.stock}`);return f.value=null,!0}catch(n){return f.value=n instanceof Error?n.message:"Gagal menambahkan ke keranjang",!1}},T=s=>{const r=p.value.findIndex(n=>n.id_product===s);r>-1&&p.value.splice(r,1)},R=(s,r)=>{const n=p.value.find(D=>D.id_product===s);if(n)if(r<=0)T(s);else if(r<=n.stock)n.quantity=r;else return f.value=`Stok tidak mencukupi. Tersedia: ${n.stock}`,!1;return!0},F=()=>{p.value=[],$.value=null,i.value=0,_.value="amount",f.value=null},z=(s,r="amount")=>r==="percentage"&&s>100?(f.value="Diskon persentase tidak boleh lebih dari 100%",!1):r==="amount"&&s>k.value?(f.value="Diskon tidak boleh lebih dari subtotal",!1):(i.value=s,_.value=r,f.value=null,!0),M=()=>{i.value=0,_.value="amount"},X=s=>{$.value=s},P=async(s,r="takeaway")=>{try{if(K.value=!0,f.value=null,j.value)throw new Error("Keranjang kosong");const n={order_type:r,id_customer:$.value||void 0,guest_count:1,notes:s.notes},A=(await O.createOrder(n)).data;for(const H of p.value)await O.addItem(A.id_order,{id_product:H.id_product,id_variant:H.id_variant||void 0,quantity:H.quantity,price:H.selling_price,notes:""});return b.value>0&&await O.applyDiscount(A.id_order,{discount_type:_.value==="percentage"?"percentage":"fixed",discount_value:_.value==="percentage"?i.value:b.value}),await O.processPayment(A.id_order,{payment_method:s.payment_method,amount:s.amount,reference_number:s.reference_number,notes:s.notes}),F(),A}catch(n){throw f.value=n instanceof Error?n.message:"Gagal membuat pesanan",n}finally{K.value=!1}},W=()=>{const s=[];return j.value&&s.push("Keranjang kosong"),p.value.forEach(r=>{r.quantity>r.stock&&s.push(`Stok ${r.name} tidak mencukupi`)}),b.value>k.value&&s.push("Diskon tidak boleh lebih dari subtotal"),{isValid:s.length===0,errors:s}},Y=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),q=s=>p.value.find(r=>r.id_product===s),N=s=>{const r=q(s);return r?r.quantity:0},Z=(s,r=1)=>N(s.id_product)+r<=s.stock;return ae([p,i,_],()=>{const s=W();!s.isValid&&s.errors.length>0?f.value=s.errors[0]:f.value=null},{deep:!0}),ae([i,_,k],()=>{_.value==="percentage"&&i.value>100&&(i.value=100),b.value>k.value&&(_.value==="amount"?i.value=k.value:i.value=100)}),{cartItems:ee(p),selectedCustomer:$,discountAmount:i,discountType:_,taxRate:U,loading:ee(K),error:ee(f),subtotal:k,discountValue:b,taxValue:I,totalAmount:L,cartCount:G,isEmpty:j,orderSummary:y,addToCart:B,removeFromCart:T,updateQuantity:R,clearCart:F,applyDiscount:z,removeDiscount:M,setCustomer:X,createOrder:P,validateCart:W,formatCurrency:Y,getCartItemById:q,getItemQuantity:N,canAddToCart:Z}},$e={class:"pos-layout"},je={class:"pos-header"},Be={class:"header-content"},Fe={class:"header-left"},He={class:"logo-section"},Ue={class:"header-info"},Ke={class:"header-meta"},Le={class:"header-actions"},Re={class:"pos-main"},Me={class:"product-panel"},Ne={class:"filter-bar"},Qe={class:"search-section"},Je={class:"filter-section"},Oe={class:"products-container"},Ge={key:0,class:"products-grid"},Xe=["onClick"],We={class:"product-image"},Ye={class:"product-image-wrapper"},Ze={key:1,class:"product-image-placeholder"},et={class:"placeholder-text"},tt={key:0,class:"status-indicator out-of-stock-indicator"},at={key:1,class:"status-indicator no-price-indicator"},st={key:2,class:"cart-indicator"},ot={class:"product-info"},rt={class:"product-name"},lt={class:"product-sku"},nt={class:"product-footer"},it={key:1,class:"empty-state"},ut={key:2,class:"empty-state"},ct={class:"empty-title"},dt={class:"empty-text"},mt={class:"cart-panel"},vt={class:"cart-header"},pt={class:"cart-title"},_t={class:"cart-content"},gt={key:0,class:"cart-items"},ft={class:"item-info"},kt={class:"item-name"},yt={class:"item-price"},ht={class:"item-controls"},bt={class:"quantity-controls"},Ct={class:"quantity"},Vt={class:"item-total"},wt={key:1,class:"empty-cart"},xt={key:0,class:"cart-summary"},Dt={class:"summary-row"},St={class:"summary-value"},It={class:"summary-row"},Tt={class:"summary-value"},zt={class:"summary-row"},Pt={class:"summary-value summary-total"},qt=pe({__name:"index",setup(p){const $=_e(),{cartItems:i,subtotal:_,cartCount:U,addToCart:K,removeFromCart:f,updateQuantity:k,clearCart:b}=Ee(),I=v(!1),L=v([]),G=v([]),j=v([]),y=v(""),B=v(null),T=v(!1),R=v(!1),F=v(!1),z=v(!1),M=v(""),X=v({}),P=v({show:!1,message:"",color:"success"});setInterval(()=>{M.value=new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})},1e3);const W=x(()=>$.user);x(()=>new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));const Y=x(()=>i.value.map(o=>({...o}))),q=x(()=>{let o=L.value;if(y.value){const e=y.value.toLowerCase();o=o.filter(C=>{var t,V;return C.name.toLowerCase().includes(e)||((t=C.sku)==null?void 0:t.toLowerCase().includes(e))||((V=C.barcode)==null?void 0:V.toLowerCase().includes(e))})}return B.value&&(o=o.filter(e=>e.id_category===B.value)),o}),N=async()=>{try{I.value=!0;const o=await O.getProducts();L.value=o.data.map(e=>{var C,t,V;return{id_product:e.id_product,name:e.name,sku:e.sku,selling_price:parseFloat(e.price),stock:((C=e.stock_info)==null?void 0:C.available_stock)||((t=e.stock_info)==null?void 0:t.current_stock)||e.stock||0,image:e.image_url||e.image,id_category:(V=e.category)==null?void 0:V.id_category}})}catch(o){console.error("Error loading products:",o)}finally{I.value=!1}},Z=async()=>{try{G.value=[{id_category:1,name:"Minuman"},{id_category:2,name:"Makanan"},{id_category:3,name:"Snack"}]}catch(o){console.error("Error loading categories:",o)}},s=async()=>{try{j.value=[{id_customer:1,name:"John Doe",phone:"0812345678",email:"john@example.com"},{id_customer:2,name:"Jane Smith",phone:"0812345679",email:"jane@example.com"},{id_customer:3,name:"Bob Johnson",phone:"0812345680",email:"bob@example.com"}]}catch(o){console.error("Error loading customers:",o)}},r=o=>{if(!n(o)){o.stock<=0?console.warn("Stok tidak tersedia untuk produk:",o.name):(!o.selling_price||o.selling_price<=0)&&console.warn("Harga tidak tersedia untuk produk:",o.name);return}K(o)},n=o=>o.stock>0&&o.selling_price>0,D=o=>o===0?"stock-low":o<10?"stock-medium":"stock-high",A=o=>{const e=i.value.find(C=>C.id_product===o);return e?e.quantity:0},H=()=>{z.value=!0},le=()=>{b(),z.value=!1},ne=o=>{console.error("ðŸ–¼ï¸ Image error for product ID:",o),X.value[o]=!0},ie=o=>o.split(" ").slice(0,2).map(e=>e.charAt(0)).join("").toUpperCase(),ue=()=>{T.value=!0},ce=o=>{P.value={show:!0,message:"Pembayaran berhasil diproses! ðŸŽ‰",color:"success"},T.value=!1,N()},de=()=>{b()},me=()=>{F.value=!0},ve=()=>{R.value=!0},Q=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o);return ge(async()=>{M.value=new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),await Promise.all([N(),Z(),s()])}),(o,e)=>{var C;return m(),g("div",$e,[a("div",je,[a("div",Be,[a("div",Fe,[a("div",He,[l(Ce,{size:"40",color:"primary"},{default:u(()=>[l(S,{size:"20"},{default:u(()=>e[9]||(e[9]=[d("tabler-shopping-cart")])),_:1,__:[9]})]),_:1}),a("div",Ue,[e[11]||(e[11]=a("h3",{class:"pos-title"},"Point of Sale",-1)),a("div",Ke,[a("span",null,c(((C=W.value)==null?void 0:C.name)||"Administrator"),1),e[10]||(e[10]=a("span",null,"â€¢",-1)),a("span",null,c(M.value),1)])])])]),a("div",Le,[l(w,{variant:"text",color:"primary","prepend-icon":"tabler-history",onClick:ve},{default:u(()=>e[12]||(e[12]=[d(" Riwayat ")])),_:1,__:[12]}),l(w,{variant:"outlined",color:"success","prepend-icon":"tabler-receipt",onClick:me},{default:u(()=>e[13]||(e[13]=[d(" Cash Drawer ")])),_:1,__:[13]})])])]),a("div",Re,[a("div",Me,[a("div",Ne,[a("div",Qe,[l(Ve,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),placeholder:"Cari produk, SKU, atau barcode...",density:"comfortable",variant:"solo","prepend-inner-icon":"tabler-search",clearable:"","hide-details":"",class:"search-input"},null,8,["modelValue"])]),a("div",Je,[l(we,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=t=>B.value=t),items:G.value,"item-title":"name","item-value":"id_category",placeholder:"Kategori",density:"comfortable",variant:"solo","prepend-inner-icon":"tabler-category",clearable:"","hide-details":"",style:{"min-inline-size":"180px"},class:"category-select"},null,8,["modelValue","items"]),q.value.length>0?(m(),J(re,{key:0,color:"primary",variant:"tonal",size:"large"},{default:u(()=>[d(c(q.value.length)+" produk ",1)]),_:1})):E("",!0)])]),a("div",Oe,[!I.value&&q.value.length>0?(m(),g("div",Ge,[(m(!0),g(se,null,oe(q.value,t=>(m(),g("div",{key:t.id_product,class:te(["product-item",{"out-of-stock":t.stock===0,"no-price":!t.selling_price||t.selling_price<=0,disabled:t.stock===0||!t.selling_price||t.selling_price<=0}]),onClick:V=>n(t)?r(t):null},[a("div",We,[a("div",Ye,[t.image&&!X.value[t.id_product]?(m(),J(Se,{key:0,src:t.image,class:"product-image-content",cover:"",onError:V=>ne(t.id_product)},null,8,["src","onError"])):(m(),g("div",Ze,[l(S,{size:"32",color:"grey-400"},{default:u(()=>e[14]||(e[14]=[d("tabler-package")])),_:1,__:[14]}),a("span",et,c(ie(t.name)),1)]))]),a("div",{class:te(["stock-badge",D(t.stock)])},[l(S,{icon:t.stock>0?"tabler-package":"tabler-package-off",size:"12",class:"mr-1"},null,8,["icon"]),d(" Stock: "+c(t.stock),1)],2),t.stock===0?(m(),g("div",tt,[l(S,{icon:"tabler-alert-circle",size:"14"}),e[15]||(e[15]=d(" Stok Habis "))])):!t.selling_price||t.selling_price<=0?(m(),g("div",at,[l(S,{icon:"tabler-alert-triangle",size:"14"}),e[16]||(e[16]=d(" Harga Kosong "))])):E("",!0),A(t.id_product)>0?(m(),g("div",st,c(A(t.id_product))+" di keranjang ",1)):E("",!0)]),a("div",ot,[a("h6",rt,c(t.name),1),a("p",lt,c(t.sku),1),a("div",nt,[a("span",{class:te(["product-price",{"price-missing":!t.selling_price||t.selling_price<=0}])},c(t.selling_price&&t.selling_price>0?Q(t.selling_price):"Harga tidak tersedia"),3),l(w,{size:"small",color:"primary",variant:"flat",icon:"tabler-plus",disabled:!n(t),onClick:ke(V=>n(t)?r(t):null,["stop"])},null,8,["disabled","onClick"])])])],10,Xe))),128))])):I.value?(m(),g("div",it,[l(fe,{size:"48",color:"primary",indeterminate:""}),e[17]||(e[17]=a("p",{class:"empty-text"},"Memuat produk...",-1))])):(m(),g("div",ut,[l(S,{size:"64",color:"grey-400"},{default:u(()=>[d(c(y.value?"tabler-search-off":"tabler-package"),1)]),_:1}),a("h4",ct,c(y.value?"Produk Tidak Ditemukan":"Tidak Ada Produk"),1),a("p",dt,c(y.value?`Coba kata kunci lain untuk pencarian "${y.value}"`:"Belum ada produk yang tersedia"),1),y.value?(m(),J(w,{key:0,variant:"outlined",onClick:e[2]||(e[2]=t=>y.value="")},{default:u(()=>e[18]||(e[18]=[d(" Reset Pencarian ")])),_:1,__:[18]})):E("",!0)]))])]),a("div",mt,[a("div",vt,[a("div",pt,[l(S,{size:"20",color:"success"},{default:u(()=>e[19]||(e[19]=[d("tabler-shopping-cart")])),_:1,__:[19]}),e[20]||(e[20]=a("span",null,"Keranjang",-1)),h(i).length>0?(m(),J(re,{key:0,color:"success",variant:"tonal",size:"small"},{default:u(()=>[d(c(h(U)),1)]),_:1})):E("",!0)]),h(i).length>0?(m(),J(w,{key:0,variant:"text",color:"error",size:"small","prepend-icon":"tabler-trash",onClick:H},{default:u(()=>e[21]||(e[21]=[d(" Hapus Semua ")])),_:1,__:[21]})):E("",!0)]),a("div",_t,[h(i).length>0?(m(),g("div",gt,[(m(!0),g(se,null,oe(h(i),t=>(m(),g("div",{key:t.id_product,class:"cart-item"},[a("div",ft,[a("h6",kt,c(t.name),1),a("p",yt,c(Q(t.selling_price))+" / item",1)]),a("div",ht,[a("div",bt,[l(w,{size:"x-small",variant:"text",color:"error",icon:"tabler-minus",disabled:t.quantity<=1,onClick:V=>h(k)(t.id_product,t.quantity-1)},null,8,["disabled","onClick"]),a("span",Ct,c(t.quantity),1),l(w,{size:"x-small",variant:"text",color:"success",icon:"tabler-plus",disabled:t.quantity>=t.stock,onClick:V=>h(k)(t.id_product,t.quantity+1)},null,8,["disabled","onClick"])]),a("div",Vt,c(Q(t.selling_price*t.quantity)),1),l(w,{size:"x-small",variant:"text",color:"error",icon:"tabler-x",onClick:V=>h(f)(t.id_product)},null,8,["onClick"])])]))),128))])):(m(),g("div",wt,[l(S,{size:"48",color:"grey-400"},{default:u(()=>e[22]||(e[22]=[d("tabler-shopping-cart")])),_:1,__:[22]}),e[23]||(e[23]=a("h4",null,"Keranjang Kosong",-1)),e[24]||(e[24]=a("p",null,"Pilih produk untuk mulai berbelanja",-1))]))]),h(i).length>0?(m(),g("div",xt,[a("div",Dt,[e[25]||(e[25]=a("span",{class:"summary-label"},"Subtotal",-1)),a("span",St,c(Q(h(_))),1)]),a("div",It,[e[26]||(e[26]=a("span",{class:"summary-label"},"Items",-1)),a("span",Tt,c(h(U)),1)]),a("div",zt,[e[27]||(e[27]=a("span",{class:"summary-label summary-total"},"Total",-1)),a("span",Pt,c(Q(h(_))),1)]),l(w,{color:"success",size:"large",block:"",class:"checkout-btn",onClick:ue},{default:u(()=>[l(S,{start:""},{default:u(()=>e[28]||(e[28]=[d("tabler-credit-card")])),_:1,__:[28]}),e[29]||(e[29]=d(" Bayar Sekarang "))]),_:1,__:[29]})])):E("",!0)])]),l(he,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=t=>T.value=t),"cart-items":Y.value,customers:j.value,onPaymentSuccess:ce,onClearCart:de},null,8,["modelValue","cart-items","customers"]),l(be,{modelValue:R.value,"onUpdate:modelValue":e[4]||(e[4]=t=>R.value=t)},null,8,["modelValue"]),l(ye,{modelValue:F.value,"onUpdate:modelValue":e[5]||(e[5]=t=>F.value=t)},null,8,["modelValue"]),l(xe,{modelValue:z.value,"onUpdate:modelValue":e[7]||(e[7]=t=>z.value=t),"max-width":"400",persistent:""},{default:u(()=>[l(Ie,null,{default:u(()=>[l(Te,null,{default:u(()=>e[30]||(e[30]=[d("Hapus Semua Item?")])),_:1,__:[30]}),l(Pe,null,{default:u(()=>e[31]||(e[31]=[d(" Apakah Anda yakin ingin menghapus semua item dari keranjang? ")])),_:1,__:[31]}),l(ze,null,{default:u(()=>[l(qe),l(w,{variant:"text",onClick:e[6]||(e[6]=t=>z.value=!1)},{default:u(()=>e[32]||(e[32]=[d("Batal")])),_:1,__:[32]}),l(w,{color:"error",variant:"text",onClick:le},{default:u(()=>e[33]||(e[33]=[d("Hapus")])),_:1,__:[33]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(De,{modelValue:P.value.show,"onUpdate:modelValue":e[8]||(e[8]=t=>P.value.show=t),color:P.value.color,timeout:4e3,location:"top right"},{default:u(()=>[d(c(P.value.message),1)]),_:1},8,["modelValue","color"])])}}}),pa=Ae(qt,[["__scopeId","data-v-b5144852"]]);export{pa as default};
