import{r as p,V as x,w as oe,a_ as ee,d as _e,au as ge,D as ke,c as k,e as o,b as l,f as c,t as d,a0 as w,g as J,l as E,F as se,i as re,aE as fe,X as S,m as b,o as v,s as m,v as te,$ as ye}from"./main-DjqmDiIz.js";import{P as Q}from"./PosApi-DT2sgX8S.js";import he from"./CashDrawerDialog-CoTx9D2W.js";import be from"./PaymentDialog-Bd9Y1FBi.js";import Ce from"./TransactionHistoryDialog-BdMF5Q5d.js";import{V as Ve}from"./VAvatar-Clbtu_25.js";import{V as we}from"./VTextField-Cr70duVL.js";import{V as xe}from"./VSelect-DlqmIY7r.js";import{V as le}from"./VChip-DjKKKdJh.js";import{V as De}from"./VDialog-CO1Pg2O1.js";import{V as Se}from"./VSnackbar-B3PcGBVZ.js";import{V as Ie}from"./VImg-DDXPFBq2.js";import{V as Te,b as Pe,c as ze}from"./VCard-Dc0kmm9d.js";import{V as Ae}from"./VCardText-R2xf0xyg.js";import{V as Ee}from"./VSpacer-6KgkCcbL.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./auth-a9M5ekjn.js";import"./VDivider-oMNJlvlT.js";import"./VRow-Bd9KaDfF.js";/* empty css              */import"./VForm-BHdjQAko.js";import"./forwardRefs-B931MWyl.js";import"./VTextarea-BUyrZjpa.js";import"./DiscountCodeInput-C7CT7JNS.js";import"./VAlert-Cg4Lq4pq.js";import"./PromotionSuggestions-DWJLc3HS.js";import"./VCheckboxBtn-DRXImS0r.js";import"./EditOrderDialog-BMUbD4Uc.js";import"./OrderDetailDialog-BQMHP9C0.js";import"./VTable-DQqaxhye.js";import"./VDataTable-BVT_g1uz.js";import"./filter-9vv_0SEG.js";import"./VList-DCB4Qb1M.js";import"./VOverlay-CZFIfHxA.js";import"./VMenu-D3ibQp-y.js";const $e=()=>{const g=p([]),q=p(null),u=p(0),_=p("amount"),O=p(0),N=p(!1),f=p(null),y=x(()=>g.value.reduce((a,r)=>a+r.selling_price*r.quantity,0)),C=x(()=>u.value?_.value==="percentage"?y.value*u.value/100:u.value:0),I=x(()=>(y.value-C.value)*O.value/100),$=x(()=>Math.max(0,y.value-C.value+I.value)),G=x(()=>g.value.reduce((a,r)=>a+r.quantity,0)),H=x(()=>g.value.length===0),h=x(()=>({subtotal:y.value,discountAmount:C.value,discountType:_.value,taxAmount:I.value,totalAmount:$.value})),j=(a,r=1)=>{try{const n=g.value.find(D=>D.id_product===a.id_product);if(n){const D=n.quantity+r;if(D<=a.stock)n.quantity=D;else throw new Error(`Stok tidak mencukupi. Tersedia: ${a.stock}`)}else if(r<=a.stock)g.value.push({...a,quantity:r});else throw new Error(`Stok tidak mencukupi. Tersedia: ${a.stock}`);return f.value=null,!0}catch(n){return f.value=n instanceof Error?n.message:"Gagal menambahkan ke keranjang",!1}},T=a=>{const r=g.value.findIndex(n=>n.id_product===a);r>-1&&g.value.splice(r,1)},K=(a,r)=>{const n=g.value.find(D=>D.id_product===a);if(n)if(r<=0)T(a);else if(r<=n.stock)n.quantity=r;else return f.value=`Stok tidak mencukupi. Tersedia: ${n.stock}`,!1;return!0},B=()=>{g.value=[],q.value=null,u.value=0,_.value="amount",f.value=null},P=(a,r="amount")=>r==="percentage"&&a>100?(f.value="Diskon persentase tidak boleh lebih dari 100%",!1):r==="amount"&&a>y.value?(f.value="Diskon tidak boleh lebih dari subtotal",!1):(u.value=a,_.value=r,f.value=null,!0),R=()=>{u.value=0,_.value="amount"},X=a=>{q.value=a},z=async(a,r="takeaway")=>{try{if(N.value=!0,f.value=null,H.value)throw new Error("Keranjang kosong");const n={order_type:r,id_customer:q.value||void 0,guest_count:1,notes:a.notes},F=(await Q.createOrder(n)).data;for(const U of g.value)await Q.addItem(F.id_order,{id_product:U.id_product,id_variant:U.id_variant||void 0,quantity:U.quantity,price:U.selling_price,notes:""});return C.value>0&&await Q.applyDiscount(F.id_order,{discount_type:_.value==="percentage"?"percentage":"fixed",discount_value:_.value==="percentage"?u.value:C.value}),await Q.processPayment(F.id_order,{payment_method:a.payment_method,amount:a.amount,reference_number:a.reference_number,notes:a.notes}),B(),F}catch(n){throw f.value=n instanceof Error?n.message:"Gagal membuat pesanan",n}finally{N.value=!1}},W=()=>{const a=[];return H.value&&a.push("Keranjang kosong"),g.value.forEach(r=>{r.quantity>r.stock&&a.push(`Stok ${r.name} tidak mencukupi`)}),C.value>y.value&&a.push("Diskon tidak boleh lebih dari subtotal"),{isValid:a.length===0,errors:a}},Y=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),A=a=>g.value.find(r=>r.id_product===a),M=a=>{const r=A(a);return r?r.quantity:0},Z=(a,r=1)=>M(a.id_product)+r<=a.stock;return oe([g,u,_],()=>{const a=W();!a.isValid&&a.errors.length>0?f.value=a.errors[0]:f.value=null},{deep:!0}),oe([u,_,y],()=>{_.value==="percentage"&&u.value>100&&(u.value=100),C.value>y.value&&(_.value==="amount"?u.value=y.value:u.value=100)}),{cartItems:ee(g),selectedCustomer:q,discountAmount:u,discountType:_,taxRate:O,loading:ee(N),error:ee(f),subtotal:y,discountValue:C,taxValue:I,totalAmount:$,cartCount:G,isEmpty:H,orderSummary:h,addToCart:j,removeFromCart:T,updateQuantity:K,clearCart:B,applyDiscount:P,removeDiscount:R,setCustomer:X,createOrder:z,validateCart:W,formatCurrency:Y,getCartItemById:A,getItemQuantity:M,canAddToCart:Z}},He={class:"pos-layout"},je={class:"pos-header"},Be={class:"header-content"},Fe={class:"header-left"},Ue={class:"logo-section"},Le={class:"header-info"},Ne={class:"header-meta"},Ke={class:"header-actions"},Re={class:"pos-main"},Me={class:"product-panel"},Je={class:"filter-bar"},Qe={class:"search-section"},Oe={class:"filter-section"},Ge={class:"products-container"},Xe={key:0,class:"products-grid"},We=["onClick"],Ye={class:"product-image"},Ze={class:"product-image-wrapper"},et={key:1,class:"product-image-placeholder"},tt={class:"placeholder-text"},at={key:0,class:"status-indicator out-of-stock-indicator"},ot={key:1,class:"status-indicator no-price-indicator"},st={key:2,class:"cart-indicator"},rt={class:"product-info"},lt={class:"product-name"},nt={class:"product-sku"},it={class:"product-footer"},ut={key:1,class:"empty-state"},ct={key:2,class:"empty-state"},dt={class:"empty-title"},mt={class:"empty-text"},vt={class:"cart-panel"},pt={class:"cart-header"},_t={class:"cart-title"},gt={class:"cart-content"},kt={key:0,class:"cart-items"},ft={class:"item-info"},yt={class:"item-name"},ht={class:"item-price"},bt={class:"item-controls"},Ct={class:"quantity-controls"},Vt={class:"quantity"},wt={class:"item-total"},xt={key:1,class:"empty-cart"},Dt={key:0,class:"cart-summary"},St={class:"summary-details"},It={class:"summary-row"},Tt={class:"summary-row total"},Pt=_e({__name:"index",setup(g){const q=ge(),{cartItems:u,subtotal:_,cartCount:O,addToCart:N,removeFromCart:f,updateQuantity:y,clearCart:C}=$e(),I=p(!1),$=p([]),G=p([]),H=p([]),h=p(""),j=p(null),T=p(!1),K=p(!1),B=p(!1),P=p(!1),R=p(""),X=p({}),z=p({show:!1,message:"",color:"success"});setInterval(()=>{R.value=new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})},1e3);const W=x(()=>q.user);x(()=>new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));const Y=x(()=>u.value.map(s=>({...s}))),A=x(()=>{let s=$.value;if(h.value){const e=h.value.toLowerCase();s=s.filter(i=>{var t,V;return i.name.toLowerCase().includes(e)||((t=i.sku)==null?void 0:t.toLowerCase().includes(e))||((V=i.barcode)==null?void 0:V.toLowerCase().includes(e))})}return j.value&&(s=s.filter(e=>e.id_category===j.value)),s}),M=async()=>{try{I.value=!0;const s=await Q.getProducts();$.value=s.data.map(i=>{var t,V,ae;return{id_product:i.id_product,name:i.name,sku:i.sku,selling_price:parseFloat(i.price),stock:((t=i.stock_info)==null?void 0:t.available_stock)||((V=i.stock_info)==null?void 0:V.current_stock)||i.stock||0,image:i.image_url||i.image,id_category:(ae=i.category)==null?void 0:ae.id_category}});const e=s.data.find(i=>i.name==="TES AJA NIH");e&&console.log("ðŸ–¼ï¸ TES AJA NIH Image Debug:",{image:e.image,image_url:e.image_url,mapped_image:e.image_url||e.image}),console.log("Loaded products with stock:",$.value.map(i=>({name:i.name,stock:i.stock})))}catch(s){console.error("Error loading products:",s)}finally{I.value=!1}},Z=async()=>{try{G.value=[{id_category:1,name:"Minuman"},{id_category:2,name:"Makanan"},{id_category:3,name:"Snack"}]}catch(s){console.error("Error loading categories:",s)}},a=async()=>{try{H.value=[{id_customer:1,name:"John Doe",phone:"0812345678",email:"john@example.com"},{id_customer:2,name:"Jane Smith",phone:"0812345679",email:"jane@example.com"},{id_customer:3,name:"Bob Johnson",phone:"0812345680",email:"bob@example.com"}]}catch(s){console.error("Error loading customers:",s)}},r=s=>{if(!n(s)){s.stock<=0?console.warn("Stok tidak tersedia untuk produk:",s.name):(!s.selling_price||s.selling_price<=0)&&console.warn("Harga tidak tersedia untuk produk:",s.name);return}N(s)&&console.log("Produk berhasil ditambahkan ke keranjang")},n=s=>s.stock>0&&s.selling_price>0,D=s=>{const e=u.value.find(i=>i.id_product===s);return e?e.quantity:0},F=()=>{P.value=!0},U=()=>{C(),P.value=!1},ne=s=>{console.error("ðŸ–¼ï¸ Image error for product ID:",s),X.value[s]=!0},ie=s=>s.split(" ").slice(0,2).map(e=>e.charAt(0)).join("").toUpperCase(),ue=()=>{T.value=!0},ce=s=>{console.log("Payment completed:",s),z.value={show:!0,message:"Pembayaran berhasil diproses! ðŸŽ‰",color:"success"},T.value=!1,M()},de=()=>{C()},me=()=>{B.value=!0},ve=()=>{K.value=!0},pe=s=>s===0?"stock-out":s<10?"stock-low":"stock-good",L=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s);return ke(async()=>{R.value=new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),await Promise.all([M(),Z(),a()])}),(s,e)=>{var i;return v(),k("div",He,[o("div",je,[o("div",Be,[o("div",Fe,[o("div",Ue,[l(Ve,{size:"40",color:"primary"},{default:c(()=>[l(S,{size:"20"},{default:c(()=>e[9]||(e[9]=[m("tabler-shopping-cart")])),_:1,__:[9]})]),_:1}),o("div",Le,[e[11]||(e[11]=o("h3",{class:"pos-title"},"Point of Sale",-1)),o("div",Ne,[o("span",null,d(((i=W.value)==null?void 0:i.name)||"Administrator"),1),e[10]||(e[10]=o("span",null,"â€¢",-1)),o("span",null,d(R.value),1)])])])]),o("div",Ke,[l(w,{variant:"text",color:"primary","prepend-icon":"tabler-history",onClick:ve},{default:c(()=>e[12]||(e[12]=[m(" Riwayat ")])),_:1,__:[12]}),l(w,{variant:"outlined",color:"success","prepend-icon":"tabler-receipt",onClick:me},{default:c(()=>e[13]||(e[13]=[m(" Cash Drawer ")])),_:1,__:[13]})])])]),o("div",Re,[o("div",Me,[o("div",Je,[o("div",Qe,[l(we,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),placeholder:"Cari produk, SKU, atau barcode...",density:"comfortable",variant:"solo","prepend-inner-icon":"tabler-search",clearable:"","hide-details":"",class:"search-input"},null,8,["modelValue"])]),o("div",Oe,[l(xe,{modelValue:j.value,"onUpdate:modelValue":e[1]||(e[1]=t=>j.value=t),items:G.value,"item-title":"name","item-value":"id_category",placeholder:"Kategori",density:"comfortable",variant:"solo","prepend-inner-icon":"tabler-category",clearable:"","hide-details":"",style:{"min-inline-size":"180px"},class:"category-select"},null,8,["modelValue","items"]),A.value.length>0?(v(),J(le,{key:0,color:"primary",variant:"tonal",size:"large"},{default:c(()=>[m(d(A.value.length)+" produk ",1)]),_:1})):E("",!0)])]),o("div",Ge,[!I.value&&A.value.length>0?(v(),k("div",Xe,[(v(!0),k(se,null,re(A.value,t=>(v(),k("div",{key:t.id_product,class:te(["product-item",{"out-of-stock":t.stock===0,"no-price":!t.selling_price||t.selling_price<=0,disabled:t.stock===0||!t.selling_price||t.selling_price<=0}]),onClick:V=>n(t)?r(t):null},[o("div",Ye,[o("div",Ze,[t.image&&!X.value[t.id_product]?(v(),J(Ie,{key:0,src:t.image,class:"product-image-content",cover:"",onError:V=>ne(t.id_product)},null,8,["src","onError"])):(v(),k("div",et,[l(S,{size:"32",color:"grey-400"},{default:c(()=>e[14]||(e[14]=[m("tabler-package")])),_:1,__:[14]}),o("span",tt,d(ie(t.name)),1)]))]),o("div",{class:te(["stock-badge",pe(t.stock)])},[l(S,{icon:t.stock>0?"tabler-package":"tabler-package-off",size:"12",class:"mr-1"},null,8,["icon"]),m(" Stock: "+d(t.stock),1)],2),t.stock===0?(v(),k("div",at,[l(S,{icon:"tabler-alert-circle",size:"14"}),e[15]||(e[15]=m(" Stok Habis "))])):!t.selling_price||t.selling_price<=0?(v(),k("div",ot,[l(S,{icon:"tabler-alert-triangle",size:"14"}),e[16]||(e[16]=m(" Harga Kosong "))])):E("",!0),D(t.id_product)>0?(v(),k("div",st,d(D(t.id_product))+" di keranjang ",1)):E("",!0)]),o("div",rt,[o("h6",lt,d(t.name),1),o("p",nt,d(t.sku),1),o("div",it,[o("span",{class:te(["product-price",{"price-missing":!t.selling_price||t.selling_price<=0}])},d(t.selling_price&&t.selling_price>0?L(t.selling_price):"Harga tidak tersedia"),3),l(w,{size:"small",color:"primary",variant:"flat",icon:"tabler-plus",disabled:!n(t),onClick:ye(V=>n(t)?r(t):null,["stop"])},null,8,["disabled","onClick"])])])],10,We))),128))])):I.value?(v(),k("div",ut,[l(fe,{size:"48",color:"primary",indeterminate:""}),e[17]||(e[17]=o("p",{class:"empty-text"},"Memuat produk...",-1))])):(v(),k("div",ct,[l(S,{size:"64",color:"grey-400"},{default:c(()=>[m(d(h.value?"tabler-search-off":"tabler-package"),1)]),_:1}),o("h4",dt,d(h.value?"Produk Tidak Ditemukan":"Tidak Ada Produk"),1),o("p",mt,d(h.value?`Coba kata kunci lain untuk pencarian "${h.value}"`:"Belum ada produk yang tersedia"),1),h.value?(v(),J(w,{key:0,variant:"outlined",onClick:e[2]||(e[2]=t=>h.value="")},{default:c(()=>e[18]||(e[18]=[m(" Reset Pencarian ")])),_:1,__:[18]})):E("",!0)]))])]),o("div",vt,[o("div",pt,[o("div",_t,[l(S,{size:"20",color:"success"},{default:c(()=>e[19]||(e[19]=[m("tabler-shopping-cart")])),_:1,__:[19]}),e[20]||(e[20]=o("span",null,"Keranjang",-1)),b(u).length>0?(v(),J(le,{key:0,color:"success",variant:"tonal",size:"small"},{default:c(()=>[m(d(b(O)),1)]),_:1})):E("",!0)]),b(u).length>0?(v(),J(w,{key:0,variant:"text",color:"error",size:"small","prepend-icon":"tabler-trash",onClick:F},{default:c(()=>e[21]||(e[21]=[m(" Hapus Semua ")])),_:1,__:[21]})):E("",!0)]),o("div",gt,[b(u).length>0?(v(),k("div",kt,[(v(!0),k(se,null,re(b(u),t=>(v(),k("div",{key:t.id_product,class:"cart-item"},[o("div",ft,[o("h6",yt,d(t.name),1),o("p",ht,d(L(t.selling_price))+" / item",1)]),o("div",bt,[o("div",Ct,[l(w,{size:"x-small",variant:"text",color:"error",icon:"tabler-minus",disabled:t.quantity<=1,onClick:V=>b(y)(t.id_product,t.quantity-1)},null,8,["disabled","onClick"]),o("span",Vt,d(t.quantity),1),l(w,{size:"x-small",variant:"text",color:"success",icon:"tabler-plus",disabled:t.quantity>=t.stock,onClick:V=>b(y)(t.id_product,t.quantity+1)},null,8,["disabled","onClick"])]),o("div",wt,d(L(t.selling_price*t.quantity)),1),l(w,{size:"x-small",variant:"text",color:"error",icon:"tabler-x",onClick:V=>b(f)(t.id_product)},null,8,["onClick"])])]))),128))])):(v(),k("div",xt,[l(S,{size:"48",color:"grey-400"},{default:c(()=>e[22]||(e[22]=[m("tabler-shopping-cart")])),_:1,__:[22]}),e[23]||(e[23]=o("p",{class:"empty-cart-text"},"Keranjang masih kosong",-1))]))]),b(u).length>0?(v(),k("div",Dt,[o("div",St,[o("div",It,[e[24]||(e[24]=o("span",null,"Subtotal:",-1)),o("span",null,d(L(b(_))),1)]),o("div",Tt,[e[25]||(e[25]=o("span",null,"Total:",-1)),o("span",null,d(L(b(_))),1)])]),l(w,{color:"success",size:"large",block:"",class:"checkout-btn",onClick:ue},{default:c(()=>[l(S,{start:""},{default:c(()=>e[26]||(e[26]=[m("tabler-credit-card")])),_:1,__:[26]}),m(" Bayar "+d(L(b(_))),1)]),_:1})])):E("",!0)])]),l(be,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=t=>T.value=t),"cart-items":Y.value,customers:H.value,onPaymentSuccess:ce,onClearCart:de},null,8,["modelValue","cart-items","customers"]),l(Ce,{modelValue:K.value,"onUpdate:modelValue":e[4]||(e[4]=t=>K.value=t)},null,8,["modelValue"]),l(he,{modelValue:B.value,"onUpdate:modelValue":e[5]||(e[5]=t=>B.value=t)},null,8,["modelValue"]),l(De,{modelValue:P.value,"onUpdate:modelValue":e[7]||(e[7]=t=>P.value=t),"max-width":"400",persistent:""},{default:c(()=>[l(Te,null,{default:c(()=>[l(Pe,null,{default:c(()=>e[27]||(e[27]=[m("Hapus Semua Item?")])),_:1,__:[27]}),l(Ae,null,{default:c(()=>e[28]||(e[28]=[m(" Apakah Anda yakin ingin menghapus semua item dari keranjang? ")])),_:1,__:[28]}),l(ze,null,{default:c(()=>[l(Ee),l(w,{variant:"text",onClick:e[6]||(e[6]=t=>P.value=!1)},{default:c(()=>e[29]||(e[29]=[m("Batal")])),_:1,__:[29]}),l(w,{color:"error",variant:"text",onClick:U},{default:c(()=>e[30]||(e[30]=[m("Hapus")])),_:1,__:[30]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Se,{modelValue:z.value.show,"onUpdate:modelValue":e[8]||(e[8]=t=>z.value.show=t),color:z.value.color,timeout:4e3,location:"top right"},{default:c(()=>[m(d(z.value.message),1)]),_:1},8,["modelValue","color"])])}}}),ma=qe(Pt,[["__scopeId","data-v-895e722b"]]);export{ma as default};
