import{d as Se,ax as qe,r as N,V as M,w as le,g as V,f as s,o as p,b as o,e as l,X as g,l as L,aw as De,t as r,s as v,c as z,F as re,i as de,$ as $e,ap as ce,aq as ue,a0 as U,v as me,ay as F,a3 as Le}from"./main-D3qual4m.js";import{$ as ze}from"./api-D4K7B0pi.js";import{V as Be}from"./VDialog-ewO1hyzi.js";import{V as w,b as J,c as Me}from"./VCard-BHrPvDVU.js";import{V as T}from"./VCardText-B6mKMLUi.js";import{V as Ue}from"./VOverlay-3qoIxvRA.js";import{V as Q}from"./VAvatar-CNzqVu-8.js";import{V as _e}from"./VImg-BDQFnPKc.js";import{V as pe}from"./VChip-Dp2du0U6.js";import{V as W,a as h}from"./VRow-C-Gp4AHv.js";import{V as Y}from"./VDivider-CP88Pi7H.js";import{V as ge}from"./VAlert-DpZvISZm.js";import{V as Fe}from"./VForm-BEPpVqhb.js";import{V as fe}from"./VAutocomplete-DmM3PVo1.js";import{a as ve,b as be,d as ye}from"./VList-lgEclvBH.js";import{V as he}from"./VTextField-Pqj_LXrG.js";import{V as Re}from"./VSwitch-Dach4Urw.js";import{V as xe}from"./VTooltip-DeB7XPhb.js";import{V as Ke}from"./VSpacer-z4qf_7hE.js";import{_ as je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D-EbNoF1.js";import"./forwardRefs-B931MWyl.js";/* empty css              */import"./VSelect-BxF6RNrF.js";import"./VMenu-Dwry_UTm.js";import"./VCheckboxBtn-B6nZfzHV.js";import"./filter-CYNG3fOG.js";const Oe={class:"d-flex align-center gap-4"},He={class:"flex-grow-1"},Ge={class:"text-h6 font-weight-bold mb-1"},Xe={class:"text-body-2 text-medium-emphasis mb-1"},Je={class:"text-body-2 text-medium-emphasis mb-2"},Qe={class:"text-body-2 font-weight-bold"},We={class:"text-body-1 font-weight-bold"},Ye={class:"text-body-1 font-weight-bold"},Ze={class:"text-body-1 font-weight-bold"},et={class:"text-subtitle-1 font-weight-bold"},tt={class:"text-h6 font-weight-bold text-primary"},it={class:"d-flex align-center gap-2"},at={key:0,class:"text-center pa-8"},ot={key:1,class:"pa-4"},st={class:"d-flex align-center gap-3 flex-grow-1"},nt={class:"flex-grow-1"},lt={class:"font-weight-medium text-body-2 mb-1"},rt={class:"text-caption text-medium-emphasis",style:{"font-size":"0.75rem"}},dt={class:"d-flex align-center gap-2"},ct=Se({__name:"BaseProductCompositionModal",props:{show:{type:Boolean},composition:{},baseProducts:{},baseProductsLoading:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1}},emits:["close","save","notification"],setup(ke,{emit:Ie}){const O=ke,S=Ie,a=qe({base_product_id:0,ingredient_base_product_id:0,ingredient_item_id:0,quantity:0,notes:"",is_active:!0,is_critical:!1}),x=N(!1),f=N({}),m=N(null),_=N(null),c=N([]),b=N([]),q=N(!1),A=N(!1),Ve=M(()=>b.value||[]),H=M(()=>a.base_product_id&&(a.ingredient_item_id||a.ingredient_base_product_id)&&a.quantity>0&&!R.value),Z=M(()=>{if(!_.value||!a.quantity)return 0;try{const t=_.value.cost_per_unit||0,e=Number(a.quantity)||0;return t*e}catch(t){return console.error("Error calculating cost:",t),0}}),ee=M(()=>{if(!_.value||!a.quantity)return 0;try{const t=Number(_.value.current_stock)||0,e=Number(a.quantity)||0;return e>0?Math.floor(t/e):0}catch(t){return console.error("Error calculating max quantity:",t),0}}),R=M(()=>{if(!a.ingredient_item_id&&!a.ingredient_base_product_id)return!1;const t=c.value.some(e=>a.ingredient_item_id&&e.ingredient_item_id===a.ingredient_item_id?(console.log("Duplicate found - ingredient_item_id:",a.ingredient_item_id,"in composition:",e),!0):a.ingredient_base_product_id&&e.ingredient_base_product_id===a.ingredient_base_product_id?(console.log("Duplicate found - ingredient_base_product_id:",a.ingredient_base_product_id,"in composition:",e),!0):!1);return console.log("Duplicate check:",{ingredient_item_id:a.ingredient_item_id,ingredient_base_product_id:a.ingredient_base_product_id,existingCompositions:c.value.length,isDuplicate:t}),t}),K=t=>{if(t==null)return"0";const e=typeof t=="string"?parseFloat(t):Number(t);return isNaN(e)?"0":e.toLocaleString("id-ID")},D=t=>{if(t==null)return"Rp 0";const e=typeof t=="string"?parseFloat(t):Number(t);return isNaN(e)?"Rp 0":`Rp ${e.toLocaleString("id-ID")}`},j=t=>{var e,i;try{return(e=t.ingredient_item)!=null&&e.name?t.ingredient_item.name:(i=t.ingredient_base_product)!=null&&i.name?t.ingredient_base_product.name:"Unknown Item"}catch{return"Unknown Item"}},we=t=>{var e,i;try{return((e=t.ingredient_item)==null?void 0:e.current_stock)!==void 0?t.ingredient_item.current_stock:((i=t.ingredient_base_product)==null?void 0:i.current_stock)!==void 0?t.ingredient_base_product.current_stock:0}catch{return 0}},G=t=>{var e,i;try{return(e=t.ingredient_item)!=null&&e.unit?t.ingredient_item.unit:(i=t.ingredient_base_product)!=null&&i.unit?t.ingredient_base_product.unit:"pcs"}catch{return"pcs"}},Ce=()=>{if(!m.value)return 0;const t=m.value.selling_price||0,e=m.value.cost_per_unit||0;return t-e},Ee=()=>{Object.keys(a).forEach(t=>{t==="is_active"?a[t]=!0:t==="is_critical"?a[t]=!1:t==="quantity"||t==="base_product_id"||t==="ingredient_item_id"||t==="ingredient_base_product_id"?a[t]=0:a[t]=""}),_.value=null,f.value={}},te=async()=>{const t=Number(a.base_product_id);t?(m.value=O.baseProducts.find(e=>e.id_base_product===t)||null,console.log("Loading compositions for base product:",t),await X(),console.log("Compositions loading completed")):(m.value=null,c.value=[])},ie=()=>{const t=Number(a.ingredient_item_id);t?_.value=b.value.find(e=>e.id_item===t)||null:_.value=null},ae=async()=>{console.log("ensureItemsLoaded called, itemsCached:",A.value,"items length:",b.value.length),A.value?console.log("Items already cached, skipping load"):(console.log("Items not cached, loading..."),await oe())},oe=async()=>{if(A.value&&b.value.length>0){console.log("Using cached items:",b.value.length);return}try{q.value=!0,console.log("Loading items from API...");const t=await F.get("/api/items?per_page=all&active=true");if(console.log("Items API response:",t.data),t.data.success&&t.data.data){let e=[];Array.isArray(t.data.data.data)?e=t.data.data.data:Array.isArray(t.data.data)&&(e=t.data.data),b.value=e,A.value=!0,console.log("Items loaded and cached:",e.length),e.length>0&&console.log("Sample item structure:",e[0])}else console.error("API response not successful:",t),b.value=[]}catch(t){console.error("Error loading items with $api:",t);try{console.log("Trying fallback for items...");const i=await(await fetch("/api/items?per_page=all&active=true",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${Le("accessToken").value}`}})).json();if(console.log("Items fallback response:",i),i.success&&i.data){let n=[];Array.isArray(i.data.data)?n=i.data.data:Array.isArray(i.data)&&(n=i.data),b.value=n,A.value=!0,console.log("Items loaded via fallback:",n.length)}}catch(e){console.error("Items fallback also failed:",e),b.value=[]}b.value=[]}finally{q.value=!1}},X=async()=>{if(a.base_product_id)try{console.log("Loading existing compositions for base_product_id:",a.base_product_id);const t=await F.get(`/api/base-product-compositions/base-product/${a.base_product_id}`);if(console.log("Full API response:",t.data),t.data.success){const e=t.data.data||[];e.forEach(i=>{if(i.is_temporary=!1,i.ingredient_item_id&&!i.ingredient_item){const n=b.value.find(k=>k.id_item===i.ingredient_item_id);n&&(i.ingredient_item=n)}}),c.value=e,console.log("Loaded existing compositions:",e.length),e.length>0&&console.log("Sample composition:",e[0])}else console.error("API response not successful:",t.data),c.value=[]}catch(t){console.error("Error loading compositions:",t),t.response&&console.error("Error response:",t.response.data),c.value=[]}};le(()=>O.show,async t=>{t&&(console.log("Modal opened"),console.log("Current auth headers:",F.defaults.headers.common),console.log("Items cached:",A.value,"Items count:",b.value.length),A.value?console.log("Items already cached, not loading again"):(console.log("Loading items on modal open..."),await oe()),a.base_product_id&&X())},{immediate:!0}),le(()=>O.composition,t=>{t?(Object.keys(a).forEach(e=>{const i=t[e];e==="is_active"?a[e]=i!==void 0?i:!0:e==="is_critical"?a[e]=i!==void 0?i:!1:e==="quantity"||e==="base_product_id"||e==="ingredient_item_id"?a[e]=i!==void 0?Number(i):0:a[e]=i||""}),te(),ie()):Ee(),f.value={}},{immediate:!0});const Ne=()=>{},se=async()=>{var e,i,n,k,I,$;if(console.log("=== HANDLE SUBMIT START ==="),console.log("Form state:",{base_product_id:a.base_product_id,ingredient_item_id:a.ingredient_item_id,ingredient_base_product_id:a.ingredient_base_product_id,quantity:a.quantity}),console.log("Existing compositions count:",c.value.length),console.log("Can submit:",H.value),console.log("Is duplicate:",R.value),!H.value){console.log("Cannot submit - validation failed");return}if(c.value.some(u=>a.ingredient_item_id&&u.ingredient_item_id===a.ingredient_item_id?(console.log("DUPLICATE FOUND - ingredient_item_id match:",a.ingredient_item_id),!0):a.ingredient_base_product_id&&u.ingredient_base_product_id===a.ingredient_base_product_id?(console.log("DUPLICATE FOUND - ingredient_base_product_id match:",a.ingredient_base_product_id),!0):!1)){console.log("Duplicate detected, showing error");const u=a.ingredient_item_id?(e=_.value)==null?void 0:e.name:(i=_.value)==null?void 0:i.name;f.value={general:`Item "${u||"yang dipilih"}" sudah ada dalam daftar komposisi. Silakan pilih item yang berbeda.`};return}x.value=!0,f.value={};try{const u={id:Date.now(),base_product_id:Number(a.base_product_id),ingredient_base_product_id:a.ingredient_base_product_id>0?Number(a.ingredient_base_product_id):null,ingredient_item_id:a.ingredient_item_id>0?Number(a.ingredient_item_id):null,quantity:Number(a.quantity),notes:a.notes||null,is_active:a.is_active,is_critical:a.is_critical,ingredient_item:a.ingredient_item_id>0?_.value:null,ingredient_base_product:a.ingredient_base_product_id>0?_.value:null,total_cost:Z.value,is_temporary:!0};console.log("Adding composition to list:",u),c.value.push(u),console.log("Total compositions:",c.value.length),a.ingredient_base_product_id=0,a.ingredient_item_id=0,a.quantity=0,a.notes="",a.is_critical=!1,_.value=null}catch(u){console.error("Error adding composition:",u),(k=(n=u.response)==null?void 0:n.data)!=null&&k.errors?f.value=u.response.data.errors:f.value={general:(($=(I=u.response)==null?void 0:I.data)==null?void 0:$.message)||"Failed to add composition"}}finally{x.value=!1}},Te=async t=>{a.base_product_id=t.base_product_id,a.quantity=t.quantity,a.notes=t.notes||"",a.is_active=t.is_active,a.is_critical=t.is_critical||!1,t.ingredient_item_id?(a.ingredient_item_id=t.ingredient_item_id,a.ingredient_base_product_id=0,_.value=t.ingredient_item):t.ingredient_base_product_id&&(a.ingredient_base_product_id=t.ingredient_base_product_id,a.ingredient_item_id=0,_.value=t.ingredient_base_product),await ne(t),f.value={},setTimeout(()=>{const e=document.querySelector(".composition-modal .v-card-text");e&&e.scrollTo({top:0,behavior:"smooth"})},100)},ne=async t=>{var e;x.value=!0;try{console.log("Remove composition called:",t),console.log("is_temporary:",t.is_temporary),console.log("id:",t.id),console.log("id_base_product_composition:",t.id_base_product_composition);const i=t.id_base_product_composition||t.id,n=t.is_temporary===!0;if(console.log("compositionId:",i),console.log("isTemporary:",n),console.log("!isTemporary:",!n),console.log("Should call API:",i&&!n),i&&!n){console.log("✅ Calling DELETE API for composition ID:",i);try{console.log("Trying $api first...");const I=await ze(`/base-product-compositions/${i}`,{method:"DELETE"});console.log("DELETE API response ($api):",I),S("notification","Item komposisi berhasil dihapus dari database","success")}catch(I){console.error("$api failed, trying axios fallback:",I);const u=(y=>{var B;const E=("; "+document.cookie).split("; "+y+"=");return E.length===2?(B=E.pop())==null?void 0:B.split(";").shift():null})("accessToken")||localStorage.getItem("accessToken");console.log("Token found for fallback:",u?"YES":"NO");const C={headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}},d=await F.delete(`/api/base-product-compositions/${i}`,C);console.log("DELETE API response (axios fallback):",d.data),S("notification","Item komposisi berhasil dihapus dari database","success")}}else console.log("❌ Skipping API call"),console.log("Reason - compositionId:",i,", isTemporary:",n),S("notification","Item komposisi berhasil dihapus","success");const k=c.value.findIndex(I=>I.id===t.id);k>-1&&(c.value.splice(k,1),console.log("Item removed from composition list at index:",k))}catch(i){console.error("Error deleting composition:",i),S("notification",((e=i.data)==null?void 0:e.message)||"Gagal menghapus item komposisi","error")}finally{x.value=!1}},Ae=async()=>{var i,n,k,I,$;if(c.value.length===0)return;x.value=!0,f.value={};let t=0,e=[];try{const u=c.value.filter(C=>C.is_temporary&&C.base_product_id&&C.quantity>0);if(console.log("Compositions to save:",u.length),console.log("All existing compositions:",c.value.length),u.length===0){console.log("No compositions to save");return}for(let C=u.length-1;C>=0;C--){const d=u[C];if(!d.base_product_id||d.quantity<=0){console.error("Invalid composition data:",d),e.push(`Invalid composition data for ${j(d)}`);continue}try{const y={base_product_id:Number(d.base_product_id),quantity:Number(d.quantity),is_active:!!d.is_active,is_critical:!!d.is_critical,notes:d.notes||null};if(d.ingredient_item_id&&d.ingredient_item_id>0&&(y.ingredient_item_id=Number(d.ingredient_item_id)),d.ingredient_base_product_id&&d.ingredient_base_product_id>0&&(y.ingredient_base_product_id=Number(d.ingredient_base_product_id)),!y.ingredient_item_id&&!y.ingredient_base_product_id){console.error("No ingredient provided for composition:",d),e.push(`${j(d)}: No ingredient selected`);continue}console.log("Saving composition payload:",y),console.log("Original composition data:",{id:d.id,base_product_id:d.base_product_id,quantity:d.quantity,ingredient_item_id:d.ingredient_item_id,ingredient_base_product_id:d.ingredient_base_product_id}),await F.post("/api/base-product-compositions",y),t++;const P=c.value.findIndex(E=>E.id===d.id);P>-1&&c.value.splice(P,1)}catch(y){console.error("Error saving individual composition:",y);const P=j(d);if(((i=y.response)==null?void 0:i.status)===422){const E=((k=(n=y.response)==null?void 0:n.data)==null?void 0:k.message)||"";if(E.includes("already exists")||E.includes("Composition already exists")){e.push(`${P}: Item sudah ada dalam komposisi database`);const B=c.value.findIndex(Pe=>Pe.id===d.id);B>-1&&c.value.splice(B,1)}else e.push(`${P}: ${E}`)}else e.push(`${P}: ${(($=(I=y.response)==null?void 0:I.data)==null?void 0:$.message)||"Gagal menyimpan"}`)}}t>0&&e.length===0?(S("save",{success:!0}),S("close")):t>0&&e.length>0?(f.value={general:`${t} item berhasil disimpan. Errors: ${e.join(", ")}`},await X()):f.value={general:`Gagal menyimpan komposisi: ${e.join(", ")}`}}catch(u){console.error("Error saving compositions:",u),f.value={general:"Failed to save compositions: "+(u.message||"Unknown error")}}finally{x.value=!1}};return window.console=console,(t,e)=>(p(),V(Be,{"model-value":t.show,"max-width":"1000px",persistent:"",scrollable:"","onUpdate:modelValue":e[6]||(e[6]=i=>!i&&t.$emit("close"))},{default:s(()=>[o(w,{class:"composition-modal"},{default:s(()=>[o(J,{class:"composition-header"},{default:s(()=>[o(g,{icon:"mdi-chef-hat",class:"me-2"}),e[7]||(e[7]=l("span",null,"Kelola Komposisi Base Product",-1))]),_:1,__:[7]}),o(T,{class:"pa-6"},{default:s(()=>[o(Ue,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=i=>q.value=i),contained:"",persistent:"",class:"d-flex align-center justify-center"},{default:s(()=>[o(w,{class:"pa-6 text-center","min-width":"250"},{default:s(()=>[o(De,{indeterminate:"",color:"primary",size:"50",class:"mb-4"}),e[8]||(e[8]=l("div",{class:"text-h6 mb-2"},"Memuat Data...",-1)),e[9]||(e[9]=l("div",{class:"text-body-2 text-medium-emphasis"},"Mohon tunggu sebentar",-1))]),_:1,__:[8,9]})]),_:1},8,["modelValue"]),m.value?(p(),V(w,{key:0,variant:"tonal",color:"primary",class:"mb-6"},{default:s(()=>[o(T,{class:"pa-4"},{default:s(()=>{var i;return[l("div",Oe,[o(Q,{size:"60",rounded:""},{default:s(()=>[m.value.image_url?(p(),V(_e,{key:0,src:m.value.image_url,alt:m.value.name},null,8,["src","alt"])):(p(),V(g,{key:1,icon:"tabler-package",size:"30"}))]),_:1}),l("div",He,[l("h3",Ge,r(m.value.name),1),l("div",Xe," SKU: "+r(m.value.sku||"No SKU"),1),l("div",Je," Kategori: "+r(((i=m.value.category)==null?void 0:i.name)||"Tidak ada kategori"),1),o(pe,{color:m.value.current_stock>m.value.min_stock?"success":"warning",size:"small",variant:"flat",class:"mt-1"},{default:s(()=>[v(r(m.value.current_stock>m.value.min_stock?"Stok Aman":"Stok Menipis"),1)]),_:1},8,["color"])])])]}),_:1})]),_:1})):L("",!0),m.value?(p(),V(W,{key:1,class:"mb-6"},{default:s(()=>[o(h,{cols:"6",md:"3"},{default:s(()=>[o(w,{variant:"outlined",class:"stats-card"},{default:s(()=>[o(T,{class:"text-center pa-3"},{default:s(()=>{var i;return[o(g,{icon:"mdi-tag",color:"info",class:"mb-1",size:"20"}),l("div",Qe,r(((i=m.value.category)==null?void 0:i.name)||"No Category"),1),e[10]||(e[10]=l("div",{class:"text-caption text-medium-emphasis"},"Kategori",-1))]}),_:1,__:[10]})]),_:1})]),_:1}),o(h,{cols:"6",md:"3"},{default:s(()=>[o(w,{variant:"outlined",class:"stats-card"},{default:s(()=>[o(T,{class:"text-center pa-3"},{default:s(()=>[o(g,{icon:"mdi-package-variant",color:"primary",class:"mb-1",size:"20"}),l("div",We,r(D(m.value.cost_per_unit||0)),1),e[11]||(e[11]=l("div",{class:"text-caption text-medium-emphasis"},"HPP",-1))]),_:1,__:[11]})]),_:1})]),_:1}),o(h,{cols:"6",md:"3"},{default:s(()=>[o(w,{variant:"outlined",class:"stats-card"},{default:s(()=>[o(T,{class:"text-center pa-3"},{default:s(()=>[o(g,{icon:"mdi-currency-usd",color:"success",class:"mb-1",size:"20"}),l("div",Ye,r(D(m.value.selling_price||0)),1),e[12]||(e[12]=l("div",{class:"text-caption text-medium-emphasis"},"Harga Jual",-1))]),_:1,__:[12]})]),_:1})]),_:1}),o(h,{cols:"6",md:"3"},{default:s(()=>[o(w,{variant:"outlined",class:"stats-card"},{default:s(()=>[o(T,{class:"text-center pa-3"},{default:s(()=>[o(g,{icon:"mdi-trending-up",color:"warning",class:"mb-1",size:"20"}),l("div",Ze,r(D(Ce())),1),e[13]||(e[13]=l("div",{class:"text-caption text-medium-emphasis"},"Margin",-1))]),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):L("",!0),o(w,{class:"mb-6"},{default:s(()=>[o(J,{class:"d-flex align-center gap-2 pa-4"},{default:s(()=>[o(g,{icon:"mdi-plus-circle",color:"primary"}),e[14]||(e[14]=l("span",null,"Tambah Item Komposisi",-1))]),_:1,__:[14]}),o(Y),o(T,{class:"pa-4"},{default:s(()=>[Object.keys(f.value).length>0?(p(),V(ge,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:s(()=>[(p(!0),z(re,null,de(f.value,(i,n)=>(p(),z("div",{key:n},[l("strong",null,r(n)+":",1),v(" "+r(Array.isArray(i)?i[0]:i),1)]))),128))]),_:1})):L("",!0),o(Fe,{onSubmit:$e(se,["prevent"])},{default:s(()=>[o(W,null,{default:s(()=>[!t.editMode&&!a.base_product_id?(p(),V(h,{key:0,cols:"12",md:"6"},{default:s(()=>[o(fe,{modelValue:a.base_product_id,"onUpdate:modelValue":[e[1]||(e[1]=i=>a.base_product_id=i),te],items:t.baseProducts,loading:t.baseProductsLoading,"item-title":"name","item-value":"id_base_product",label:"Pilih Base Product",placeholder:"Pilih base product","prepend-inner-icon":"tabler-package",clearable:"","error-messages":f.value.base_product_id},{item:s(({props:i,item:n})=>[o(ve,ce(ue(i)),{prepend:s(()=>[o(Q,{size:"30"},{default:s(()=>[n.raw.image_url?(p(),V(_e,{key:0,src:n.raw.image_url,alt:n.raw.name},null,8,["src","alt"])):(p(),V(g,{key:1,icon:"tabler-package",size:"16"}))]),_:2},1024)]),default:s(()=>[o(be,null,{default:s(()=>[v(r(n.raw.name),1)]),_:2},1024),o(ye,null,{default:s(()=>[v(" Stock: "+r(K(n.raw.current_stock))+" "+r(n.raw.unit)+" | "+r(n.raw.formatted_cost),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","error-messages"])]),_:1})):L("",!0),o(h,{cols:"12",md:!t.editMode&&!a.base_product_id?6:4},{default:s(()=>[o(fe,{modelValue:a.ingredient_item_id,"onUpdate:modelValue":[e[2]||(e[2]=i=>a.ingredient_item_id=i),ie],items:Ve.value,loading:q.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",placeholder:"Pilih item komposisi","prepend-inner-icon":"tabler-package",clearable:"","error-messages":f.value.ingredient_item_id,color:R.value?"warning":"primary","onClick:prependInner":ae,onFocus:ae,"no-data-text":q.value?"Memuat item...":b.value.length===0?"Tidak ada item tersedia":"Ketik untuk mencari..."},{item:s(({props:i,item:n})=>[o(ve,ce(ue(i)),{prepend:s(()=>[o(Q,{size:"30"},{default:s(()=>[o(g,{icon:"tabler-package",size:"16"})]),_:1})]),default:s(()=>[o(be,null,{default:s(()=>[v(r(n.raw.name),1)]),_:2},1024),o(ye,null,{default:s(()=>[v(" Stok: "+r(K(n.raw.current_stock||0))+" "+r(n.raw.unit||"pcs")+" | Rp "+r(D(n.raw.cost_per_unit||0)),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","error-messages","color","no-data-text"]),R.value?(p(),V(ge,{key:0,type:"warning",variant:"tonal",density:"compact",class:"mt-2"},{default:s(()=>[o(g,{icon:"mdi-alert",class:"me-2"}),e[15]||(e[15]=v(" Item ini sudah ada dalam daftar komposisi "))]),_:1,__:[15]})):L("",!0)]),_:1},8,["md"]),o(h,{cols:"6",md:!t.editMode&&!a.base_product_id?6:4},{default:s(()=>{var i;return[o(he,{modelValue:a.quantity,"onUpdate:modelValue":e[3]||(e[3]=n=>a.quantity=n),type:"number",step:"0.01",min:"0",label:"Jumlah",placeholder:"1",suffix:((i=_.value)==null?void 0:i.unit)||"pcs","prepend-inner-icon":"mdi-numeric","error-messages":f.value.quantity,onInput:Ne},null,8,["modelValue","suffix","error-messages"])]}),_:1},8,["md"]),o(h,{cols:"6",md:!t.editMode&&!a.base_product_id?6:2},{default:s(()=>{var i;return[o(he,{"model-value":((i=_.value)==null?void 0:i.unit)||"pcs",label:"Satuan",readonly:"","prepend-inner-icon":"mdi-scale-balance"},null,8,["model-value"])]}),_:1},8,["md"]),o(h,{cols:"6",md:"2"},{default:s(()=>[o(Re,{modelValue:a.is_critical,"onUpdate:modelValue":e[4]||(e[4]=i=>a.is_critical=i),label:"Item Kritis",color:"warning","hide-details":""},null,8,["modelValue"])]),_:1}),o(h,{cols:"6",md:"2",class:"d-flex align-center"},{default:s(()=>[o(U,{color:"primary",loading:x.value,disabled:!H.value,onClick:se,block:""},{default:s(()=>[o(g,{icon:"mdi-plus",class:"me-1"}),e[16]||(e[16]=v(" Tambah ke List "))]),_:1,__:[16]},8,["loading","disabled"])]),_:1})]),_:1}),_.value&&a.quantity?(p(),V(w,{key:0,variant:"tonal",color:"success",class:"mt-4"},{default:s(()=>[o(T,{class:"pa-3"},{default:s(()=>[o(W,null,{default:s(()=>[o(h,{cols:"12",md:"4"},{default:s(()=>{var i;return[e[17]||(e[17]=l("div",{class:"text-caption text-medium-emphasis"},"Cost per Unit:",-1)),l("div",et,r(D(((i=_.value)==null?void 0:i.cost_per_unit)||0)),1)]}),_:1,__:[17]}),o(h,{cols:"12",md:"4"},{default:s(()=>[e[18]||(e[18]=l("div",{class:"text-caption text-medium-emphasis"},"Total Cost:",-1)),l("div",tt,r(D(Z.value)),1)]),_:1,__:[18]}),o(h,{cols:"12",md:"4"},{default:s(()=>[e[19]||(e[19]=l("div",{class:"text-caption text-medium-emphasis"},"Available Stock:",-1)),l("div",{class:me(["text-h6 font-weight-bold",ee.value>0?"text-success":"text-error"])},r(ee.value)+" portions ",3)]),_:1,__:[19]})]),_:1})]),_:1})]),_:1})):L("",!0)]),_:1})]),_:1})]),_:1}),o(w,null,{default:s(()=>[o(J,{class:"d-flex align-center justify-space-between pa-4"},{default:s(()=>[l("div",it,[o(g,{icon:"mdi-format-list-bulleted",color:"primary"}),l("span",null,"Daftar Item Komposisi ("+r(c.value.length)+")",1)])]),_:1}),o(Y),c.value.length===0?(p(),z("div",at,[o(g,{icon:"mdi-package-variant-closed",size:"64",color:"grey-lighten-2",class:"mb-4"}),e[20]||(e[20]=l("h3",{class:"text-h6 text-medium-emphasis mb-2"},"Belum ada item komposisi",-1)),e[21]||(e[21]=l("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Tambahkan item yang dibutuhkan untuk membuat base product ini ",-1))])):(p(),z("div",ot,[(p(!0),z(re,null,de(c.value,i=>(p(),z("div",{key:i.id||i.base_product_id,class:me(["composition-item d-flex align-center justify-space-between pa-3 mb-3 rounded-lg border",{"bg-green-lighten-5 border-success":i.is_temporary}])},[l("div",st,[o(g,{icon:"mdi-check-circle",color:"success",size:"18"}),l("div",nt,[l("div",lt,r(j(i)),1),l("div",rt,[v(" Dibutuhkan: "+r(K(i.quantity||0))+" "+r(G(i))+" ",1),e[22]||(e[22]=l("span",{class:"mx-2"},"•",-1)),v(" Stok: "+r(K(we(i)))+" "+r(G(i)),1)])])]),l("div",dt,[o(pe,{size:"x-small",variant:"outlined",color:"primary"},{default:s(()=>[v(r(G(i)),1)]),_:2},1024),o(U,{icon:"",size:"x-small",variant:"text",color:"primary",onClick:n=>Te(i),disabled:i.is_temporary||x.value},{default:s(()=>[o(g,{icon:"mdi-pencil",size:"16"}),o(xe,{activator:"parent",location:"top"},{default:s(()=>e[23]||(e[23]=[v(" Edit Komposisi ")])),_:1,__:[23]})]),_:2},1032,["onClick","disabled"]),o(U,{icon:"",size:"x-small",variant:"text",color:"error",disabled:x.value,onClick:n=>ne(i)},{default:s(()=>[o(g,{icon:"mdi-delete",size:"16"}),o(xe,{activator:"parent",location:"top"},{default:s(()=>e[24]||(e[24]=[v(" Hapus Komposisi ")])),_:1,__:[24]})]),_:2},1032,["disabled","onClick"])])],2))),128))]))]),_:1})]),_:1}),o(Y),o(Me,{class:"pa-4"},{default:s(()=>[o(Ke),o(U,{variant:"outlined",onClick:e[5]||(e[5]=i=>t.$emit("close")),disabled:x.value},{default:s(()=>e[25]||(e[25]=[v(" Batal ")])),_:1,__:[25]},8,["disabled"]),o(U,{color:"primary",onClick:Ae,loading:x.value,disabled:c.value.length===0},{default:s(()=>[o(g,{icon:"mdi-content-save",class:"me-1"}),v(" Simpan Komposisi ("+r(c.value.filter(i=>i.is_temporary).length)+") ",1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),Bt=je(ct,[["__scopeId","data-v-4f9acc7f"]]);export{Bt as default};
