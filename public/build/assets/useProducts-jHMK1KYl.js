import{d as Ee,V as k,g as ae,f as o,b as i,e as u,X as se,t as z,a0 as Me,c as K,a1 as J,s as H,F as re,i as ne,p as Ne,ct as Te,m as ie,l as pe,at as $e,cw as qe,o as A,_ as ze,r as c,az as ue}from"./main-CB2I6xMV.js";import{f as le}from"./helpers-B-vn2Qqf.js";import{V as Le}from"./VDialog-B6cC2nlh.js";import{b as je,V as fe,c as Ge}from"./VCard-kftbvHmf.js";import{V as Ke}from"./VCardText-BfCVZfsH.js";import{V as Je}from"./VForm-BZABAsaR.js";import{V as te,a as F}from"./VRow-GRjXWUI7.js";import{V as Z}from"./VTextField-Datxr734.js";import{V as ge}from"./VSelect-hlAyRJts.js";import{V as _e}from"./VTextarea-BROs2Myi.js";import{V as He}from"./VAutocomplete-7YEcgrb6.js";import{a as We}from"./VList-VjqlGNmq.js";import{V as Xe}from"./VDivider-DwA1QPln.js";import{V as Ye}from"./VChip-CXoDuQ6k.js";import{V as Qe}from"./VSpacer-E_xV2pSV.js";import{V as Ze}from"./VSnackbar-CZX9NXb3.js";import{C as et}from"./CategoriesApi-Cw2k85M8.js";import{P as O}from"./ProductsApi-JbunZ9YS.js";const tt={class:"d-flex align-center"},at={class:"text-h5 font-weight-bold"},st={class:"text-subtitle-1 opacity-90"},it={class:"pa-6 border-b"},lt={class:"pa-6 border-b"},ot={class:"d-flex align-center justify-space-between mb-4"},rt={key:0,class:"text-center py-8"},nt={key:1},ut={class:"text-h6 font-weight-bold"},ct={class:"d-flex justify-space-between align-center mb-2"},dt={class:"text-h6 font-weight-bold"},mt={class:"d-flex justify-space-between align-center"},vt={class:"text-subtitle-1 font-weight-bold text-success"},pt={class:"pa-6"},ft={class:"d-flex align-center justify-space-between mb-4"},gt={key:0,class:"text-center py-8"},_t={key:1},bt={class:"d-flex align-start"},ht={class:"text-body-2"},yt={class:"d-flex align-center"},kt={class:"text-subtitle-1"},wt=Ee({__name:"ProductRecipeDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},loading:{type:Boolean},formData:{},availableItems:{},errorMessage:{},productName:{}},emits:["update:modelValue","close","save","clear-error"],setup(f,{emit:L}){const n=f,P=L,R=k({get:()=>n.modelValue,set:a=>{a||P("close"),P("update:modelValue",a)}}),h=a=>{if(!a||!Array.isArray(n.availableItems))return 0;const t=n.availableItems.find(s=>s.id_item===a);return(t==null?void 0:t.current_stock)||0},g=a=>h(a),I=(a,t)=>!a||!t||t<=0?!1:t>h(a),N=(a,t)=>{if(!a||!t||t<=0)return"primary";const s=h(a),_=t/s*100;return t>s?"error":_>80?"warning":"primary"},w=(a,t)=>{if(!a||!t||t<=0)return"0";const s=h(a);return s<=0?"0":(t/s*100).toFixed(1)},v=a=>new Intl.NumberFormat("id-ID").format(a),y=k(()=>Array.isArray(n.availableItems)?n.availableItems.map(a=>{a.current_stock<=0||a.current_stock<=10||`${a.current_stock}`;const t=a.current_stock<=0;return{id:a.id_item,text:`${a.name} (${v(h(a.id_item))} ${a.unit})`,item:a,disabled:t}}):[]),V=[{title:"Mudah",value:"easy",color:"success"},{title:"Sedang",value:"medium",color:"warning"},{title:"Sulit",value:"hard",color:"error"}],q=["porsi","cup","liter","ml","pcs","pack"],W=k(()=>Array.isArray(n.availableItems)?n.formData.items.reduce((a,t)=>{const s=n.availableItems.find(_=>_.id_item===t.item_id);return s&&t.quantity>0?a+s.cost_per_unit*t.quantity:a},0):0),j=k(()=>{const a=n.formData.portion_size||1;return W.value/a}),D=k(()=>n.formData.items.every(a=>a.item_id&&a.quantity>0?!I(a.item_id,a.quantity):!0)),B=k(()=>{const a=[];return n.formData.items.forEach(t=>{if(t.item_id&&t.quantity>0&&I(t.item_id,t.quantity)){const s=n.availableItems.find(d=>d.id_item===t.item_id),_=h(t.item_id);s&&a.push(`${s.name}: maksimal ${v(_)} ${s.unit}`)}}),a}),x=a=>{if(a.item_id&&Array.isArray(n.availableItems)){const t=n.availableItems.find(s=>s.id_item===a.item_id);t&&(a.unit=t.unit)}},E=()=>{if(P("clear-error"),n.formData.items.filter(t=>t.item_id&&t.quantity>0?I(t.item_id,t.quantity):!1).length>0){P("update:modelValue",!0);return}P("save")},U=()=>{n.formData.items.push({product_id:n.formData.product_id,item_id:0,quantity:1,unit:"",notes:""})},T=a=>{n.formData.items.splice(a,1)},Q=()=>{n.formData.instructions||(n.formData.instructions=[]),n.formData.instructions.push("")},Y=a=>{n.formData.instructions&&n.formData.instructions.length>1&&n.formData.instructions.splice(a,1)};return(a,t)=>(A(),ae(Le,{modelValue:R.value,"onUpdate:modelValue":t[10]||(t[10]=s=>R.value=s),"max-width":"1000",persistent:"",class:"recipe-dialog"},{default:o(()=>[i(fe,{class:"recipe-card"},{default:o(()=>[i(je,{class:"bg-primary text-white pa-6"},{default:o(()=>[u("div",tt,[i(se,{icon:"tabler-chef-hat",class:"me-3",size:"32"}),u("div",null,[u("div",at,z(a.editMode?"Edit":"Buat")+" Resep Produk ",1),u("div",st,z(a.productName||"Produk Baru"),1)])])]),_:1}),i(Ke,{class:"pa-0"},{default:o(()=>[i(Je,{onSubmit:Me(E,["prevent"])},{default:o(()=>[u("div",it,[i(te,null,{default:o(()=>[i(F,{cols:"12",md:"6"},{default:o(()=>[i(Z,{modelValue:a.formData.name,"onUpdate:modelValue":t[0]||(t[0]=s=>a.formData.name=s),label:"Nama Resep",variant:"outlined",density:"compact",required:"",rules:[s=>!!s||"Nama resep wajib diisi"]},null,8,["modelValue","rules"])]),_:1}),i(F,{cols:"12",md:"3"},{default:o(()=>[i(Z,{modelValue:a.formData.portion_size,"onUpdate:modelValue":t[1]||(t[1]=s=>a.formData.portion_size=s),modelModifiers:{number:!0},label:"Ukuran Porsi",variant:"outlined",density:"compact",type:"number",min:"1",required:"",rules:[s=>s>0||"Ukuran porsi harus lebih dari 0"]},null,8,["modelValue","rules"])]),_:1}),i(F,{cols:"12",md:"3"},{default:o(()=>[i(ge,{modelValue:a.formData.portion_unit,"onUpdate:modelValue":t[2]||(t[2]=s=>a.formData.portion_unit=s),label:"Satuan Porsi",variant:"outlined",density:"compact",items:q,required:""},null,8,["modelValue"])]),_:1})]),_:1}),i(te,null,{default:o(()=>[i(F,{cols:"12",md:"4"},{default:o(()=>[i(ge,{modelValue:a.formData.difficulty_level,"onUpdate:modelValue":t[3]||(t[3]=s=>a.formData.difficulty_level=s),label:"Tingkat Kesulitan",variant:"outlined",density:"compact",items:V,"item-title":"title","item-value":"value",required:""},null,8,["modelValue"])]),_:1}),i(F,{cols:"12",md:"4"},{default:o(()=>[i(Z,{modelValue:a.formData.preparation_time,"onUpdate:modelValue":t[4]||(t[4]=s=>a.formData.preparation_time=s),modelModifiers:{number:!0},label:"Waktu Persiapan (menit)",variant:"outlined",density:"compact",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),i(F,{cols:"12",md:"4"},{default:o(()=>[i(Z,{modelValue:a.formData.notes,"onUpdate:modelValue":t[5]||(t[5]=s=>a.formData.notes=s),label:"Catatan Tambahan",variant:"outlined",density:"compact",placeholder:"Opsional"},null,8,["modelValue"])]),_:1})]),_:1}),i(te,null,{default:o(()=>[i(F,{cols:"12"},{default:o(()=>[i(_e,{modelValue:a.formData.description,"onUpdate:modelValue":t[6]||(t[6]=s=>a.formData.description=s),label:"Deskripsi Resep",variant:"outlined",density:"compact",rows:"3","auto-grow":"",counter:"500",rules:[s=>!s||s.length<=500||"Deskripsi maksimal 500 karakter"]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),u("div",lt,[u("div",ot,[t[12]||(t[12]=u("div",null,[u("h3",{class:"text-h6 font-weight-bold"},"Bahan-Bahan"),u("p",{class:"text-body-2 text-medium-emphasis"}," Pilih bahan dan tentukan jumlah yang dibutuhkan ")],-1)),i(J,{color:"primary",variant:"outlined",size:"small",onClick:U,"prepend-icon":"tabler-plus"},{default:o(()=>t[11]||(t[11]=[H(" Tambah Bahan ")])),_:1,__:[11]})]),a.formData.items.length===0?(A(),K("div",rt,[i(se,{icon:"tabler-bowl",size:"64",class:"text-grey-lighten-1 mb-4"}),t[14]||(t[14]=u("p",{class:"text-body-1 text-medium-emphasis"}," Belum ada bahan yang ditambahkan ",-1)),i(J,{color:"primary",variant:"outlined",onClick:U,"prepend-icon":"tabler-plus"},{default:o(()=>t[13]||(t[13]=[H(" Tambah Bahan Pertama ")])),_:1,__:[13]})])):(A(),K("div",nt,[(A(!0),K(re,null,ne(a.formData.items,(s,_)=>(A(),ae(te,{key:_,class:"mb-4 align-center"},{default:o(()=>[i(F,{cols:"12",md:"4"},{default:o(()=>[i(He,{modelValue:s.item_id,"onUpdate:modelValue":[d=>s.item_id=d,d=>x(s)],items:y.value,"item-title":"text","item-value":"id",label:"Pilih Bahan",variant:"outlined",density:"compact",required:"",clearable:"",rules:[d=>!!d||"Bahan wajib dipilih"]},{item:o(({props:d,item:$})=>[i(We,Ne({ref_for:!0},d,{disabled:$.raw.disabled}),Te({title:o(()=>[H(z($.raw.text),1)]),_:2},[$.raw.disabled?{name:"subtitle",fn:o(()=>[t[15]||(t[15]=u("span",{class:"text-error"},"Stok habis",-1))]),key:"0"}:void 0]),1040,["disabled"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","rules"])]),_:2},1024),i(F,{cols:"12",md:"4"},{default:o(()=>[i(Z,{modelValue:s.quantity,"onUpdate:modelValue":d=>s.quantity=d,modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0",max:g(s.item_id),step:"0.01",required:"",color:N(s.item_id,s.quantity),rules:[d=>d>0||"Jumlah harus lebih dari 0",d=>d<=g(s.item_id)||`Jumlah tidak boleh melebihi stok tersedia (${g(s.item_id)})`],error:I(s.item_id,s.quantity),"error-messages":I(s.item_id,s.quantity)?`Stok tidak cukup (${g(s.item_id)} tersedia)`:[],hint:`Stok tersedia: ${g(s.item_id)} | Akan menggunakan: ${w(s.item_id,s.quantity)}%`,"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","max","color","rules","error","error-messages","hint"])]),_:2},1024),i(F,{cols:"12",md:"2"},{default:o(()=>[i(Z,{modelValue:s.unit,"onUpdate:modelValue":d=>s.unit=d,label:"Satuan",variant:"outlined",density:"compact",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),i(F,{cols:"12",md:"2"},{default:o(()=>{var d;return[t[16]||(t[16]=u("div",{class:"text-caption text-medium-emphasis"},"Biaya",-1)),u("div",ut,z(s.item_id&&s.quantity>0&&Array.isArray(a.availableItems)?ie(le)((((d=a.availableItems.find($=>$.id_item===s.item_id))==null?void 0:d.cost_per_unit)||0)*s.quantity):ie(le)(0)),1),i(J,{color:"error",variant:"text",size:"small",icon:"tabler-trash",onClick:$=>T(_)},null,8,["onClick"])]}),_:2,__:[16]},1024)]),_:2},1024))),128)),i(Xe,{class:"my-4"}),i(te,null,{default:o(()=>[i(F,{cols:"12",md:"6"},{default:o(()=>[i(fe,{variant:"outlined",class:"pa-4"},{default:o(()=>[t[19]||(t[19]=u("div",{class:"text-subtitle-2 text-medium-emphasis mb-2"}," Ringkasan Biaya ",-1)),u("div",ct,[t[17]||(t[17]=u("span",null,"Total Biaya Resep:",-1)),u("span",dt,z(ie(le)(W.value)),1)]),u("div",mt,[t[18]||(t[18]=u("span",null,"Biaya per Porsi:",-1)),u("span",vt,z(ie(le)(j.value)),1)])]),_:1,__:[19]})]),_:1})]),_:1})]))]),u("div",pt,[u("div",ft,[t[21]||(t[21]=u("div",null,[u("h3",{class:"text-h6 font-weight-bold"},"Instruksi Pembuatan"),u("p",{class:"text-body-2 text-medium-emphasis"}," Langkah-langkah untuk membuat produk ")],-1)),i(J,{color:"primary",variant:"outlined",size:"small",onClick:Q,"prepend-icon":"tabler-plus"},{default:o(()=>t[20]||(t[20]=[H(" Tambah Langkah ")])),_:1,__:[20]})]),!a.formData.instructions||a.formData.instructions.length===0?(A(),K("div",gt,[i(se,{icon:"tabler-list-numbers",size:"64",class:"text-grey-lighten-1 mb-4"}),t[23]||(t[23]=u("p",{class:"text-body-1 text-medium-emphasis"}," Belum ada instruksi yang ditambahkan ",-1)),i(J,{color:"primary",variant:"outlined",onClick:Q,"prepend-icon":"tabler-plus"},{default:o(()=>t[22]||(t[22]=[H(" Tambah Instruksi Pertama ")])),_:1,__:[22]})])):(A(),K("div",_t,[(A(!0),K(re,null,ne(a.formData.instructions,(s,_)=>(A(),K("div",{key:_,class:"mb-4"},[u("div",bt,[i(Ye,{color:"primary",size:"small",class:"me-3 mt-3"},{default:o(()=>[H(z(_+1),1)]),_:2},1024),i(_e,{modelValue:a.formData.instructions[_],"onUpdate:modelValue":d=>a.formData.instructions[_]=d,label:`Langkah ${_+1}`,variant:"outlined",density:"compact",rows:"2","auto-grow":"",class:"flex-grow-1",required:"",rules:[d=>!!d||"Instruksi tidak boleh kosong"]},null,8,["modelValue","onUpdate:modelValue","label","rules"]),a.formData.instructions.length>1?(A(),ae(J,{key:0,color:"error",variant:"text",size:"small",icon:"tabler-trash",class:"ms-2 mt-3",onClick:d=>Y(_)},null,8,["onClick"])):pe("",!0)])]))),128))]))])]),_:1})]),_:1}),i(Ge,{class:"pa-6"},{default:o(()=>[B.value.length>0?(A(),ae(F,{key:0,cols:"12",class:"px-0"},{default:o(()=>[i($e,{type:"error",variant:"tonal",density:"compact"},{default:o(()=>[i(qe,{class:"mb-2"},{default:o(()=>t[24]||(t[24]=[H("Stok Tidak Mencukupi")])),_:1,__:[24]}),u("div",ht,[(A(!0),K(re,null,ne(B.value,s=>(A(),K("div",{key:s,class:"mb-1"}," • "+z(s),1))),128))])]),_:1})]),_:1})):pe("",!0),i(Qe),i(J,{variant:"outlined",class:"coffee-secondary",onClick:t[7]||(t[7]=s=>R.value=!1)},{default:o(()=>t[25]||(t[25]=[H(" Batal ")])),_:1,__:[25]}),i(J,{color:"primary",class:"coffee-primary",loading:a.loading,disabled:!D.value,onClick:E},{default:o(()=>[H(z(a.editMode?"Perbarui":"Simpan")+" Resep ",1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),i(Ze,{"model-value":!!a.errorMessage,"onUpdate:modelValue":t[9]||(t[9]=s=>!s&&P("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:o(()=>[i(J,{icon:"tabler-x",size:"small",variant:"text",onClick:t[8]||(t[8]=s=>P("clear-error"))})]),default:o(()=>[u("div",yt,[i(se,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),u("div",null,[t[26]||(t[26]=u("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),u("div",kt,z(a.errorMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["modelValue"]))}}),Kt=ze(wt,[["__scopeId","data-v-7086619c"]]);function Jt(){const f=c([]),L=c([]),n=c(!1),P=c(!1),R=c(!1),h=c({total_recipes:0,active_recipes:0,total_items_used:0,avg_cost_per_recipe:0}),g=c(!1),I=c(!1),N=c(!1),w=c(null),v=ue({product_id:0,name:"",description:"",items:[],portion_size:1,portion_unit:"porsi",preparation_time:30,difficulty_level:"medium",instructions:[],active:!0}),y=c(""),V=c(""),q=c(""),W=k(()=>!n.value),j="product_recipes",D=()=>{try{const r=localStorage.getItem(j);return r?JSON.parse(r):[]}catch(r){return console.error("❌ Failed to load recipes from localStorage:",r),[]}},B=r=>{try{localStorage.setItem(j,JSON.stringify(r))}catch(b){console.error("❌ Failed to save recipes to localStorage:",b)}},x=r=>r.items.reduce((b,p)=>{const C=L.value.find(X=>X.id_item===p.item_id);return b+p.quantity*((C==null?void 0:C.cost_per_unit)||0)},0),E=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(r),U=()=>{Object.assign(v,{id:void 0,product_id:0,name:"",description:"",items:[],portion_size:1,portion_unit:"porsi",preparation_time:30,difficulty_level:"medium",instructions:[],active:!0})},T=async r=>{if(r){n.value=!0,y.value="";try{await new Promise(p=>setTimeout(p,500));const b=D();f.value=b.filter(p=>p.product_id===r),V.value="Resep berhasil dimuat"}catch(b){console.error("Failed to fetch recipes:",b),y.value="Gagal memuat data resep",f.value=[]}finally{n.value=!1}}},Q=async()=>{try{L.value=[{id_item:1,item_code:"KOPI001",name:"Kopi Arabica",unit:"gram",cost_per_unit:50,current_stock:1e3,minimum_stock:100,active:!0},{id_item:2,item_code:"SUSU001",name:"Susu Segar",unit:"ml",cost_per_unit:15,current_stock:2e3,minimum_stock:200,active:!0},{id_item:3,item_code:"GULA001",name:"Gula Pasir",unit:"gram",cost_per_unit:12,current_stock:5e3,minimum_stock:500,active:!0},{id_item:4,item_code:"CHOC001",name:"Cokelat Bubuk",unit:"gram",cost_per_unit:80,current_stock:500,minimum_stock:50,active:!0}]}catch(r){console.error("Failed to fetch available items:",r),L.value=[]}},Y=async()=>{try{const r=v.product_id;if(!r)return;const p=D().filter(G=>G.product_id===r),C=p.filter(G=>G.active),X=new Set(p.flatMap(G=>G.items.map(ee=>ee.item_id))),M=C.reduce((G,ee)=>G+(ee.total_cost||0),0)/(C.length||1);h.value={total_recipes:p.length,active_recipes:C.length,total_items_used:X.size,avg_cost_per_recipe:M}}catch(r){console.error("Failed to fetch stats:",r)}},a=async()=>{var r;P.value=!0,q.value="";try{await new Promise(p=>setTimeout(p,1e3));const b=D();if(N.value&&((r=w.value)!=null&&r.id)){const p=b.findIndex(C=>{var X;return C.id===((X=w.value)==null?void 0:X.id)});p!==-1&&(b[p]={...v,id:w.value.id,total_cost:x(v),updated_at:new Date().toISOString()}),V.value="Resep berhasil diperbarui"}else{const p={...v,id:Date.now(),total_cost:x(v),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};b.unshift(p),V.value="Resep berhasil ditambahkan"}B(b),await T(v.product_id),await Y(),$()}catch(b){console.error("Failed to save recipe:",b),q.value="Gagal menyimpan resep"}finally{P.value=!1}},t=async()=>{if(w.value){R.value=!0;try{await new Promise(p=>setTimeout(p,1e3));const b=D().filter(p=>{var C;return p.id!==((C=w.value)==null?void 0:C.id)});B(b),V.value="Resep berhasil dihapus",await T(v.product_id),await Y(),I.value=!1,w.value=null}catch(r){console.error("Failed to delete recipe:",r),y.value="Gagal menghapus resep"}finally{R.value=!1}}},s=r=>{N.value=!1,U(),v.product_id=r,g.value=!0},_=r=>{N.value=!0,w.value=r,Object.assign(v,{...r,items:[...r.items]}),g.value=!0},d=r=>{w.value=r,I.value=!0},$=()=>{g.value=!1,q.value="",setTimeout(()=>{U(),w.value=null,N.value=!1},200)};return{recipesList:f,availableItems:L,loading:n,saveLoading:P,deleteLoading:R,stats:h,dialog:g,deleteDialog:I,editMode:N,selectedRecipe:w,formData:v,errorMessage:y,successMessage:V,modalErrorMessage:q,canCreateEdit:W,calculateRecipeCost:x,formatCurrency:E,fetchRecipes:T,fetchAvailableItems:Q,fetchStats:Y,saveRecipe:a,deleteRecipe:t,openCreateDialog:s,openEditDialog:_,openDeleteDialog:d,closeDialog:$,clearModalError:()=>{q.value=""}}}const Ht=()=>{const f=c([]),L=c([]),n=c(!1),P=c(!1),R=c(!1),h=c({}),g=c({total_products:0,published_products:0,draft_products:0,archived_products:0,active_products:0,inactive_products:0,featured_products:0,low_stock_products:0,out_of_stock_products:0,total_stock_value:0,average_price:0,total_categories:0,average_margin:0,highest_margin:0,lowest_margin:0,profitable_products:0}),I=c(!1),N=c(!1),w=c(!1),v=c(null),y=c([]),V=c(1),q=c(0),W=c(15),j=ue({search:"",active:"all",category_id:null,stock_status:"all",featured:"all",sortBy:"created_at",sortOrder:"desc"}),D=c(""),B=c(""),x=c(""),E=ue({name:"",description:"",price:0,cost:0,sku:"",barcode:"",min_stock:0,weight:0,dimensions:{length:void 0,width:void 0,height:void 0},category_id:0,brand:"",unit:"pcs",status:"published",active:!0,featured:!1,available_in_kitchen:!0,available_in_bar:!0,tags:[],meta_title:"",meta_description:""}),U=c(null),T=c(""),Q=[e=>!!e||"Nama produk wajib diisi",e=>e.length>=2||"Nama produk minimal 2 karakter",e=>e.length<=255||"Nama produk maksimal 255 karakter"],Y=[e=>!!e||"Kategori wajib dipilih"],a=[e=>{if(!e)return!0;const l=O.validateSKU(e);return l.valid||l.error}],t=k(()=>!0),s=k(()=>!0),_=k(()=>g.value.active_products),d=k(()=>g.value.inactive_products),$=k(()=>g.value.featured_products),ce=k(()=>g.value.low_stock_products),r=k(()=>g.value.out_of_stock_products),b=k(()=>g.value.average_price),p=k(()=>g.value.total_stock_value),C=k(()=>y.value.length>0),X=k(()=>f.value.length),M=async()=>{try{n.value=!0,D.value="";const e={...j,page:V.value,per_page:W.value};Object.keys(e).forEach(m=>{const S=e[m];m!=="search"&&(S===""||S==="all"||S===null||S===void 0)&&delete e[m]}),console.log("Fetching products with params:",e);const l=await O.getAll(e);if(l.success)f.value=l.data,l.pagination&&(q.value=l.pagination.total,V.value=l.pagination.current_page);else throw new Error(l.message)}catch(e){D.value=e.message||"Gagal mengambil data produk",f.value=[]}finally{n.value=!1}},G=async()=>{try{const e=await et.getCategories({page:1,per_page:100,status:"active"});e.success&&(L.value=e.data)}catch{}},ee=async()=>{try{const e=await O.getStats();e.success&&(g.value=e.data)}catch{}},be=async()=>{try{P.value=!0,x.value="";const e={...E};e.price&&(e.price=Number(e.price)),e.cost&&(e.cost=Number(e.cost)),e.min_stock&&(e.min_stock=Number(e.min_stock)),e.weight&&(e.weight=Number(e.weight)),e.category_id&&(e.category_id=Number(e.category_id));let l;if(w.value&&v.value?l=await O.update(v.value.id_product,e,U.value||void 0):l=await O.create(e,U.value||void 0),l.success)B.value=l.message||"Product saved successfully",de(),await M();else throw new Error(l.message)}catch(e){x.value=e.errors||e.message}finally{P.value=!1}},he=async()=>{if(v.value)try{R.value=!0;const e=await O.delete(v.value.id_product);if(e.success)B.value=e.message,N.value=!1,await M();else throw new Error(e.message)}catch(e){D.value=e.message||"Gagal menghapus produk"}finally{R.value=!1}},ye=async()=>{if(y.value.length!==0)try{R.value=!0;const e=await O.bulkDelete(y.value);if(e.success)B.value=e.message,y.value=[],await M();else throw new Error(e.message)}catch(e){D.value=e.message||"Gagal menghapus produk"}finally{R.value=!1}},ke=async e=>{try{h.value[e.id_product]=!0;const l=await O.toggleActive(e.id_product);if(l.success){const m=f.value.findIndex(S=>S.id_product===e.id_product);m!==-1&&(f.value[m]=l.data)}else throw new Error(l.message)}catch(l){D.value=l.message||"Gagal mengubah status produk"}finally{h.value[e.id_product]=!1}},we=async e=>{try{h.value[e.id_product]=!0;const l=await O.toggleFeatured(e.id_product);if(l.success){const m=f.value.findIndex(S=>S.id_product===e.id_product);m!==-1&&(f.value[m]=l.data)}else throw new Error(l.message)}catch(l){D.value=l.message||"Gagal mengubah status produk unggulan"}finally{h.value[e.id_product]=!1}},Ve=()=>{w.value=!1,v.value=null,me(),I.value=!0},De=e=>{w.value=!0,v.value=e,Pe(e),I.value=!0},Se=e=>{v.value=e,N.value=!0},de=()=>{I.value=!1,x.value="",me()},me=()=>{Object.assign(E,{name:"",description:"",price:"",cost:"",sku:"",barcode:"",stock:"",min_stock:"",weight:"",dimensions:{length:void 0,width:void 0,height:void 0},category_id:"",brand:"",unit:"pcs",status:"published",active:!0,featured:!1,tags:[],meta_title:"",meta_description:""}),U.value=null,T.value=""},Pe=e=>{Object.assign(E,{name:e.name,description:e.description||"",price:e.price,cost:e.cost||"",sku:e.sku||"",barcode:e.barcode||"",min_stock:e.min_stock||"",weight:e.weight||"",dimensions:e.dimensions||{length:void 0,width:void 0,height:void 0},category_id:e.category_id,brand:e.brand||"",unit:e.unit||"pcs",status:e.status,active:e.active,featured:e.featured,available_in_kitchen:e.available_in_kitchen,available_in_bar:e.available_in_bar,tags:e.tags||[],meta_title:e.meta_title||"",meta_description:e.meta_description||""}),U.value=null,T.value=e.image_url||""},Ie=e=>{if(e.length===0)return;const l=e[0],m=O.validateImage(l);if(!m.valid){x.value=m.error||"File tidak valid";return}U.value=l,T.value=URL.createObjectURL(l),x.value=""},Ce=()=>{U.value=null,T.value=""},Re=()=>{E.name&&(E.sku=O.generateSKU(E.name))},xe=()=>{x.value=""},Ue=e=>{V.value=e,M()},Ae=e=>{console.log("updateOptions called with:",e),V.value=e.page,W.value=e.itemsPerPage,M()},Fe=async e=>{const l=e.id_product;h.value[l]=!0;try{const m=await O.update(l,{name:e.name,category_id:e.category_id,status:e.status,active:e.active,featured:e.featured,available_in_kitchen:!e.available_in_kitchen,available_in_bar:e.available_in_bar}),S=f.value.findIndex(oe=>oe.id_product===l);S!==-1&&(f.value[S]={...f.value[S],...m.data}),B.value=`Kitchen availability ${m.data.available_in_kitchen?"enabled":"disabled"} for ${e.name}`}catch(m){console.error("Error toggling kitchen availability:",m),D.value=m.message||"Failed to update kitchen availability"}finally{h.value[l]=!1}},Oe=async e=>{const l=e.id_product;h.value[l]=!0;try{const m=await O.update(l,{name:e.name,category_id:e.category_id,status:e.status,active:e.active,featured:e.featured,available_in_kitchen:e.available_in_kitchen,available_in_bar:!e.available_in_bar}),S=f.value.findIndex(oe=>oe.id_product===l);S!==-1&&(f.value[S]={...f.value[S],...m.data}),B.value=`Bar availability ${m.data.available_in_bar?"enabled":"disabled"} for ${e.name}`}catch(m){console.error("Error toggling bar availability:",m),D.value=m.message||"Failed to update bar availability"}finally{h.value[l]=!1}},Be=()=>{V.value=1,M()},ve=()=>{V.value=1,M()};return{productsList:f,categories:L,loading:n,saveLoading:P,deleteLoading:R,toggleLoading:h,stats:g,dialog:I,deleteDialog:N,editMode:w,selectedProduct:v,selectedProducts:y,currentPage:V,totalItems:q,itemsPerPage:W,filters:j,errorMessage:D,successMessage:B,modalErrorMessage:x,formData:E,selectedImage:U,imagePreview:T,nameRules:Q,categoryRules:Y,skuRules:a,canCreateEdit:t,canDelete:s,totalActiveProducts:_,totalInactiveProducts:d,totalFeaturedProducts:$,totalLowStockProducts:ce,totalOutOfStockProducts:r,averagePrice:b,totalStockValue:p,hasSelectedProducts:C,filteredProductsCount:X,fetchProductsList:M,fetchCategories:G,fetchStats:ee,saveProduct:be,deleteProduct:he,bulkDeleteProducts:ye,toggleActiveStatus:ke,toggleFeaturedStatus:we,openCreateDialog:Ve,openEditDialog:De,openDeleteDialog:Se,closeDialog:de,handleImageUpload:Ie,removeImage:Ce,generateSKU:Re,clearModalError:xe,onPageChange:Ue,updateOptions:Ae,toggleKitchenAvailability:Fe,toggleBarAvailability:Oe,onSearch:Be,onFilterChange:ve,handleFiltersUpdate:e=>{Object.assign(j,e),ve()},onSortChange:()=>{V.value=1,M()},resetFilters:()=>{Object.assign(j,{search:"",active:"all",category_id:null,stock_status:"all",featured:"all",sortBy:"created_at",sortOrder:"desc"}),V.value=1,M()},toggleProductSelection:e=>{const l=y.value.indexOf(e);l>-1?y.value.splice(l,1):y.value.push(e)},selectAllProducts:()=>{y.value.length===f.value.length?y.value=[]:y.value=f.value.map(e=>e.id_product)}}};export{Kt as P,Ht as a,Jt as u};
