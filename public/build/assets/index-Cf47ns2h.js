import{r as v,V as T,w as ne,bl as le,d as ge,au as ke,D as ye,c as p,e as s,b as r,f as c,t as m,a0 as S,g as G,l as z,F as ie,i as ue,aw as be,X as I,m as h,o as d,s as i,v as re,$ as he}from"./main-CZcwCq2A.js";import{P as X}from"./PosApi-K7-YlgoP.js";import Ce from"./CashDrawerDialog-DKp-4Qai.js";import Ve from"./PaymentDialog-Cv8h3VtB.js";import we from"./TransactionHistoryDialog-BFZT9BuY.js";import{V as xe}from"./VAvatar-BbKgxYq2.js";import{V as De}from"./VTextField-Bvm9lZm4.js";import{V as ce}from"./VSelect-6RgSElTF.js";import{V as de}from"./VChip-B31-cFI4.js";import{V as Se}from"./VDialog-Xtnr8Lep.js";import{V as Ie}from"./VSnackbar-Dvr6hg5A.js";import{V as Te}from"./VImg-CZiu-0Tn.js";import{V as ze,b as Pe,c as Ae}from"./VCard-VRKN42a8.js";import{V as qe}from"./VCardText-DzUTjxq1.js";import{V as Ee}from"./VSpacer-sLc4wLMc.js";import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./auth-CuuXRWj5.js";import"./VDivider-Dq1xcEti.js";import"./VRow-BB9Qagf4.js";/* empty css              */import"./VForm-zOcARJKp.js";import"./forwardRefs-B931MWyl.js";import"./VTextarea-BNfScnPD.js";import"./DiscountCodeInput-CQ_H71GC.js";import"./VAlert-DIu0Fd8I.js";import"./PromotionSuggestions-BQwtvcAC.js";import"./VCheckboxBtn-C1Q7S_mX.js";import"./EditOrderDialog-CHyIUmKJ.js";import"./OrderDetailDialog-Db5AS7RA.js";import"./VTable-BqGA11K6.js";import"./VDataTable-BtTiFNkt.js";import"./filter-C2q_maaW.js";import"./VList-CTLcdq0w.js";import"./VOverlay-BnNPRBSW.js";import"./VMenu-CbT1ZBp4.js";const $e=()=>{const _=v([]),B=v(null),u=v(0),f=v("amount"),L=v(0),R=v(!1),g=v(null),k=T(()=>_.value.reduce((a,o)=>a+o.selling_price*o.quantity,0)),C=T(()=>u.value?f.value==="percentage"?k.value*u.value/100:u.value:0),P=T(()=>(k.value-C.value)*L.value/100),M=T(()=>Math.max(0,k.value-C.value+P.value)),W=T(()=>_.value.reduce((a,o)=>a+o.quantity,0)),$=T(()=>_.value.length===0),y=T(()=>({subtotal:k.value,discountAmount:C.value,discountType:f.value,taxAmount:P.value,totalAmount:M.value})),j=(a,o=1)=>{try{const n=_.value.find(b=>b.id_product===a.id_product);if(n){const b=n.quantity+o;if(b<=a.stock)n.quantity=b;else throw new Error(`Stok tidak mencukupi. Tersedia: ${a.stock}`)}else if(o<=a.stock)_.value.push({...a,quantity:o});else throw new Error(`Stok tidak mencukupi. Tersedia: ${a.stock}`);return g.value=null,!0}catch(n){return g.value=n instanceof Error?n.message:"Gagal menambahkan ke keranjang",!1}},A=a=>{const o=_.value.findIndex(n=>n.id_product===a);o>-1&&_.value.splice(o,1)},F=(a,o)=>{const n=_.value.find(b=>b.id_product===a);if(n)if(o<=0)A(a);else if(o<=n.stock)n.quantity=o;else return g.value=`Stok tidak mencukupi. Tersedia: ${n.stock}`,!1;return!0},K=()=>{_.value=[],B.value=null,u.value=0,f.value="amount",g.value=null},N=(a,o="amount")=>o==="percentage"&&a>100?(g.value="Diskon persentase tidak boleh lebih dari 100%",!1):o==="amount"&&a>k.value?(g.value="Diskon tidak boleh lebih dari subtotal",!1):(u.value=a,f.value=o,g.value=null,!0),E=()=>{u.value=0,f.value="amount"},O=a=>{B.value=a},Y=async(a,o="takeaway")=>{try{if(R.value=!0,g.value=null,$.value)throw new Error("Keranjang kosong");const n={order_type:o,id_customer:B.value||void 0,guest_count:1,notes:a.notes},V=(await X.createOrder(n)).data;for(const w of _.value)await X.addItem(V.id_order,{id_product:w.id_product,id_variant:w.id_variant||void 0,quantity:w.quantity,price:w.selling_price,notes:""});return C.value>0&&await X.applyDiscount(V.id_order,{discount_type:f.value==="percentage"?"percentage":"fixed",discount_value:f.value==="percentage"?u.value:C.value}),await X.processPayment(V.id_order,{payment_method:a.payment_method,amount:a.amount,reference_number:a.reference_number,notes:a.notes}),K(),V}catch(n){throw g.value=n instanceof Error?n.message:"Gagal membuat pesanan",n}finally{R.value=!1}},q=()=>{const a=[];return $.value&&a.push("Keranjang kosong"),_.value.forEach(o=>{o.quantity>o.stock&&a.push(`Stok ${o.name} tidak mencukupi`)}),C.value>k.value&&a.push("Diskon tidak boleh lebih dari subtotal"),{isValid:a.length===0,errors:a}},se=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),Z=a=>_.value.find(o=>o.id_product===a),ee=a=>{const o=Z(a);return o?o.quantity:0},U=(a,o=1)=>ee(a.id_product)+o<=a.stock;ne([_,u,f],()=>{const a=q();!a.isValid&&a.errors.length>0?g.value=a.errors[0]:g.value=null},{deep:!0}),ne([u,f,k],()=>{f.value==="percentage"&&u.value>100&&(u.value=100),C.value>k.value&&(f.value==="amount"?u.value=k.value:u.value=100)});const Q=(a,o)=>o==="kitchen"?a.available_in_kitchen!==!1:o==="bar"?a.available_in_bar!==!1:!1,oe=a=>a.available_in_kitchen!==!1&&a.available_in_bar!==!1,te=a=>{const o=[];return a.available_in_kitchen!==!1&&o.push("kitchen"),a.available_in_bar!==!1&&o.push("bar"),o},ae=(a,o)=>a.every(n=>Q(n,o)),H=a=>{const o=[],n=[],b=[];return a.forEach(V=>{const w=te(V);w.length===1?w[0]==="kitchen"?o.push(V):w[0]==="bar"&&n.push(V):w.length===2&&b.push(V)}),{kitchen:o,bar:n,both:b}};return{cartItems:le(_),selectedCustomer:B,discountAmount:u,discountType:f,taxRate:L,loading:le(R),error:le(g),subtotal:k,discountValue:C,taxValue:P,totalAmount:M,cartCount:W,isEmpty:$,orderSummary:y,addToCart:j,removeFromCart:A,updateQuantity:F,clearCart:K,applyDiscount:N,removeDiscount:E,setCustomer:O,createOrder:Y,validateCart:q,formatCurrency:se,getCartItemById:Z,getItemQuantity:ee,canAddToCart:U,isAvailableInStation:Q,isAvailableInBothStations:oe,getAvailableStations:te,canProcessOrderInStation:ae,getStationRequirements:H}},je={class:"pos-layout"},Fe={class:"pos-header"},Ke={class:"header-content"},Ue={class:"header-left"},He={class:"logo-section"},Le={class:"header-info"},Re={class:"header-meta"},Me={class:"header-actions"},Ne={class:"pos-main"},Oe={class:"product-panel"},Qe={class:"filter-bar"},Je={class:"search-section"},Ge={class:"filter-section"},Xe={class:"products-container"},We={key:0,class:"products-grid"},Ye=["onClick"],Ze={class:"product-image"},et={class:"product-image-wrapper"},tt={key:1,class:"product-image-placeholder"},at={class:"placeholder-text"},st={class:"station-badges"},ot={key:0,class:"station-badge kitchen-badge",title:"Tersedia di Kitchen"},lt={key:1,class:"station-badge bar-badge",title:"Tersedia di Bar"},rt={key:0,class:"status-indicator out-of-stock-indicator"},nt={key:1,class:"status-indicator no-price-indicator"},it={key:2,class:"cart-indicator"},ut={class:"product-info"},ct={class:"product-name"},dt={class:"product-sku"},mt={class:"product-footer"},vt={key:1,class:"empty-state"},pt={key:2,class:"empty-state"},_t={class:"empty-title"},ft={class:"empty-text"},gt={class:"cart-panel"},kt={class:"cart-header"},yt={class:"cart-title"},bt={class:"cart-content"},ht={key:0,class:"cart-items"},Ct={class:"item-info"},Vt={class:"item-name"},wt={class:"item-price"},xt={class:"item-controls"},Dt={class:"quantity-controls"},St={class:"quantity"},It={class:"item-total"},Tt={key:1,class:"empty-cart"},zt={key:0,class:"cart-summary"},Pt={class:"summary-row"},At={class:"summary-value"},qt={class:"summary-row"},Et={class:"summary-value"},Bt={class:"summary-row"},$t={class:"summary-value summary-total"},jt=ge({__name:"index",setup(_){const B=ke(),{cartItems:u,subtotal:f,cartCount:L,addToCart:R,removeFromCart:g,updateQuantity:k,clearCart:C}=$e(),P=v(!1),M=v([]),W=v([]),$=v([]),y=v(""),j=v(null),A=v(null),F=v(!1),K=v(!1),N=v(!1),E=v(!1),O=v(""),Y=v({}),q=v({show:!1,message:"",color:"success"});setInterval(()=>{O.value=new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})},1e3);const se=T(()=>B.user);T(()=>new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));const Z=T(()=>u.value.map(l=>({...l}))),ee=[{title:"Kitchen",value:"kitchen"},{title:"Bar",value:"bar"}],U=T(()=>{let l=M.value;if(y.value){const e=y.value.toLowerCase();l=l.filter(x=>{var t,D;return x.name.toLowerCase().includes(e)||((t=x.sku)==null?void 0:t.toLowerCase().includes(e))||((D=x.barcode)==null?void 0:D.toLowerCase().includes(e))})}return j.value&&(l=l.filter(e=>e.id_category===j.value)),A.value&&(l=l.filter(e=>A.value==="kitchen"?e.available_in_kitchen!==!1:A.value==="bar"?e.available_in_bar!==!1:!0)),l}),Q=async()=>{try{P.value=!0;const l=await X.getProducts();M.value=l.data.map(e=>{var x,t,D;return{id_product:e.id_product,name:e.name,sku:e.sku,selling_price:parseFloat(e.price),stock:((x=e.stock_info)==null?void 0:x.available_stock)||((t=e.stock_info)==null?void 0:t.current_stock)||e.stock||0,image:e.image_url||e.image,id_category:(D=e.category)==null?void 0:D.id_category,available_in_kitchen:e.available_in_kitchen??!0,available_in_bar:e.available_in_bar??!0}})}catch(l){console.error("Error loading products:",l)}finally{P.value=!1}},oe=async()=>{try{W.value=[{id_category:1,name:"Minuman"},{id_category:2,name:"Makanan"},{id_category:3,name:"Snack"}]}catch(l){console.error("Error loading categories:",l)}},te=async()=>{try{$.value=[{id_customer:1,name:"John Doe",phone:"0812345678",email:"john@example.com"},{id_customer:2,name:"Jane Smith",phone:"0812345679",email:"jane@example.com"},{id_customer:3,name:"Bob Johnson",phone:"0812345680",email:"bob@example.com"}]}catch(l){console.error("Error loading customers:",l)}},ae=l=>{if(!H(l)){l.stock<=0?console.warn("Stok tidak tersedia untuk produk:",l.name):(!l.selling_price||l.selling_price<=0)&&console.warn("Harga tidak tersedia untuk produk:",l.name);return}R(l)},H=l=>l.stock>0&&l.selling_price>0,a=l=>l===0?"stock-low":l<10?"stock-medium":"stock-high",o=l=>{const e=u.value.find(x=>x.id_product===l);return e?e.quantity:0},n=()=>{E.value=!0},b=()=>{C(),E.value=!1},V=l=>{console.error("🖼️ Image error for product ID:",l),Y.value[l]=!0},w=l=>l.split(" ").slice(0,2).map(e=>e.charAt(0)).join("").toUpperCase(),me=()=>{F.value=!0},ve=l=>{q.value={show:!0,message:"Pembayaran berhasil diproses! 🎉",color:"success"},F.value=!1,Q()},pe=()=>{C()},_e=()=>{N.value=!0},fe=()=>{K.value=!0},J=l=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l);return ye(async()=>{O.value=new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),await Promise.all([Q(),oe(),te()])}),(l,e)=>{var x;return d(),p("div",je,[s("div",Fe,[s("div",Ke,[s("div",Ue,[s("div",He,[r(xe,{size:"40",color:"primary"},{default:c(()=>[r(I,{size:"20"},{default:c(()=>e[10]||(e[10]=[i("tabler-shopping-cart")])),_:1,__:[10]})]),_:1}),s("div",Le,[e[12]||(e[12]=s("h3",{class:"pos-title"},"Point of Sale",-1)),s("div",Re,[s("span",null,m(((x=se.value)==null?void 0:x.name)||"Administrator"),1),e[11]||(e[11]=s("span",null,"•",-1)),s("span",null,m(O.value),1)])])])]),s("div",Me,[r(S,{variant:"text",color:"primary","prepend-icon":"tabler-history",onClick:fe},{default:c(()=>e[13]||(e[13]=[i(" Riwayat ")])),_:1,__:[13]}),r(S,{variant:"outlined",color:"success","prepend-icon":"tabler-receipt",onClick:_e},{default:c(()=>e[14]||(e[14]=[i(" Cash Drawer ")])),_:1,__:[14]})])])]),s("div",Ne,[s("div",Oe,[s("div",Qe,[s("div",Je,[r(De,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),placeholder:"Cari produk, SKU, atau barcode...",density:"comfortable",variant:"solo","prepend-inner-icon":"tabler-search",clearable:"","hide-details":"",class:"search-input"},null,8,["modelValue"])]),s("div",Ge,[r(ce,{modelValue:j.value,"onUpdate:modelValue":e[1]||(e[1]=t=>j.value=t),items:W.value,"item-title":"name","item-value":"id_category",placeholder:"Kategori",density:"comfortable",variant:"solo","prepend-inner-icon":"tabler-category",clearable:"","hide-details":"",style:{"min-inline-size":"180px"},class:"category-select"},null,8,["modelValue","items"]),r(ce,{modelValue:A.value,"onUpdate:modelValue":e[2]||(e[2]=t=>A.value=t),items:ee,"item-title":"title","item-value":"value",placeholder:"Station",density:"comfortable",variant:"solo","prepend-inner-icon":"tabler-tools-kitchen-2",clearable:"","hide-details":"",style:{"min-inline-size":"150px"},class:"station-select"},null,8,["modelValue"]),U.value.length>0?(d(),G(de,{key:0,color:"primary",variant:"tonal",size:"large"},{default:c(()=>[i(m(U.value.length)+" produk ",1)]),_:1})):z("",!0)])]),s("div",Xe,[!P.value&&U.value.length>0?(d(),p("div",We,[(d(!0),p(ie,null,ue(U.value,t=>(d(),p("div",{key:t.id_product,class:re(["product-item",{"out-of-stock":t.stock===0,"no-price":!t.selling_price||t.selling_price<=0,disabled:t.stock===0||!t.selling_price||t.selling_price<=0}]),onClick:D=>H(t)?ae(t):null},[s("div",Ze,[s("div",et,[t.image&&!Y.value[t.id_product]?(d(),G(Te,{key:0,src:t.image,class:"product-image-content",cover:"",onError:D=>V(t.id_product)},null,8,["src","onError"])):(d(),p("div",tt,[r(I,{size:"32",color:"grey-400"},{default:c(()=>e[15]||(e[15]=[i("tabler-package")])),_:1,__:[15]}),s("span",at,m(w(t.name)),1)]))]),s("div",{class:re(["stock-badge",a(t.stock)])},[r(I,{icon:t.stock>0?"tabler-package":"tabler-package-off",size:"12",class:"mr-1"},null,8,["icon"]),i(" Stock: "+m(t.stock),1)],2),s("div",st,[t.available_in_kitchen?(d(),p("div",ot,[r(I,{icon:"tabler-chef-hat",size:"10"}),e[16]||(e[16]=i(" Kitchen "))])):z("",!0),t.available_in_bar?(d(),p("div",lt,[r(I,{icon:"tabler-glass-cocktail",size:"10"}),e[17]||(e[17]=i(" Bar "))])):z("",!0)]),t.stock===0?(d(),p("div",rt,[r(I,{icon:"tabler-alert-circle",size:"14"}),e[18]||(e[18]=i(" Stok Habis "))])):!t.selling_price||t.selling_price<=0?(d(),p("div",nt,[r(I,{icon:"tabler-alert-triangle",size:"14"}),e[19]||(e[19]=i(" Harga Kosong "))])):z("",!0),o(t.id_product)>0?(d(),p("div",it,m(o(t.id_product))+" di keranjang ",1)):z("",!0)]),s("div",ut,[s("h6",ct,m(t.name),1),s("p",dt,m(t.sku),1),s("div",mt,[s("span",{class:re(["product-price",{"price-missing":!t.selling_price||t.selling_price<=0}])},m(t.selling_price&&t.selling_price>0?J(t.selling_price):"Harga tidak tersedia"),3),r(S,{size:"small",color:"primary",variant:"flat",icon:"tabler-plus",disabled:!H(t),onClick:he(D=>H(t)?ae(t):null,["stop"])},null,8,["disabled","onClick"])])])],10,Ye))),128))])):P.value?(d(),p("div",vt,[r(be,{size:"48",color:"primary",indeterminate:""}),e[20]||(e[20]=s("p",{class:"empty-text"},"Memuat produk...",-1))])):(d(),p("div",pt,[r(I,{size:"64",color:"grey-400"},{default:c(()=>[i(m(y.value?"tabler-search-off":"tabler-package"),1)]),_:1}),s("h4",_t,m(y.value?"Produk Tidak Ditemukan":"Tidak Ada Produk"),1),s("p",ft,m(y.value?`Coba kata kunci lain untuk pencarian "${y.value}"`:"Belum ada produk yang tersedia"),1),y.value?(d(),G(S,{key:0,variant:"outlined",onClick:e[3]||(e[3]=t=>y.value="")},{default:c(()=>e[21]||(e[21]=[i(" Reset Pencarian ")])),_:1,__:[21]})):z("",!0)]))])]),s("div",gt,[s("div",kt,[s("div",yt,[r(I,{size:"20",color:"success"},{default:c(()=>e[22]||(e[22]=[i("tabler-shopping-cart")])),_:1,__:[22]}),e[23]||(e[23]=s("span",null,"Keranjang",-1)),h(u).length>0?(d(),G(de,{key:0,color:"success",variant:"tonal",size:"small"},{default:c(()=>[i(m(h(L)),1)]),_:1})):z("",!0)]),h(u).length>0?(d(),G(S,{key:0,variant:"text",color:"error",size:"small","prepend-icon":"tabler-trash",onClick:n},{default:c(()=>e[24]||(e[24]=[i(" Hapus Semua ")])),_:1,__:[24]})):z("",!0)]),s("div",bt,[h(u).length>0?(d(),p("div",ht,[(d(!0),p(ie,null,ue(h(u),t=>(d(),p("div",{key:t.id_product,class:"cart-item"},[s("div",Ct,[s("h6",Vt,m(t.name),1),s("p",wt,m(J(t.selling_price))+" / item",1)]),s("div",xt,[s("div",Dt,[r(S,{size:"x-small",variant:"text",color:"error",icon:"tabler-minus",disabled:t.quantity<=1,onClick:D=>h(k)(t.id_product,t.quantity-1)},null,8,["disabled","onClick"]),s("span",St,m(t.quantity),1),r(S,{size:"x-small",variant:"text",color:"success",icon:"tabler-plus",disabled:t.quantity>=t.stock,onClick:D=>h(k)(t.id_product,t.quantity+1)},null,8,["disabled","onClick"])]),s("div",It,m(J(t.selling_price*t.quantity)),1),r(S,{size:"x-small",variant:"text",color:"error",icon:"tabler-x",onClick:D=>h(g)(t.id_product)},null,8,["onClick"])])]))),128))])):(d(),p("div",Tt,[r(I,{size:"48",color:"grey-400"},{default:c(()=>e[25]||(e[25]=[i("tabler-shopping-cart")])),_:1,__:[25]}),e[26]||(e[26]=s("h4",null,"Keranjang Kosong",-1)),e[27]||(e[27]=s("p",null,"Pilih produk untuk mulai berbelanja",-1))]))]),h(u).length>0?(d(),p("div",zt,[s("div",Pt,[e[28]||(e[28]=s("span",{class:"summary-label"},"Subtotal",-1)),s("span",At,m(J(h(f))),1)]),s("div",qt,[e[29]||(e[29]=s("span",{class:"summary-label"},"Items",-1)),s("span",Et,m(h(L)),1)]),s("div",Bt,[e[30]||(e[30]=s("span",{class:"summary-label summary-total"},"Total",-1)),s("span",$t,m(J(h(f))),1)]),r(S,{color:"success",size:"large",block:"",class:"checkout-btn",onClick:me},{default:c(()=>[r(I,{start:""},{default:c(()=>e[31]||(e[31]=[i("tabler-credit-card")])),_:1,__:[31]}),e[32]||(e[32]=i(" Bayar Sekarang "))]),_:1,__:[32]})])):z("",!0)])]),r(Ve,{modelValue:F.value,"onUpdate:modelValue":e[4]||(e[4]=t=>F.value=t),"cart-items":Z.value,customers:$.value,onPaymentSuccess:ve,onClearCart:pe},null,8,["modelValue","cart-items","customers"]),r(we,{modelValue:K.value,"onUpdate:modelValue":e[5]||(e[5]=t=>K.value=t)},null,8,["modelValue"]),r(Ce,{modelValue:N.value,"onUpdate:modelValue":e[6]||(e[6]=t=>N.value=t)},null,8,["modelValue"]),r(Se,{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=t=>E.value=t),"max-width":"400",persistent:""},{default:c(()=>[r(ze,null,{default:c(()=>[r(Pe,null,{default:c(()=>e[33]||(e[33]=[i("Hapus Semua Item?")])),_:1,__:[33]}),r(qe,null,{default:c(()=>e[34]||(e[34]=[i(" Apakah Anda yakin ingin menghapus semua item dari keranjang? ")])),_:1,__:[34]}),r(Ae,null,{default:c(()=>[r(Ee),r(S,{variant:"text",onClick:e[7]||(e[7]=t=>E.value=!1)},{default:c(()=>e[35]||(e[35]=[i("Batal")])),_:1,__:[35]}),r(S,{color:"error",variant:"text",onClick:b},{default:c(()=>e[36]||(e[36]=[i("Hapus")])),_:1,__:[36]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(Ie,{modelValue:q.value.show,"onUpdate:modelValue":e[9]||(e[9]=t=>q.value.show=t),color:q.value.color,timeout:4e3,location:"top right"},{default:c(()=>[i(m(q.value.message),1)]),_:1},8,["modelValue","color"])])}}}),ya=Be(jt,[["__scopeId","data-v-3fe15b1a"]]);export{ya as default};
