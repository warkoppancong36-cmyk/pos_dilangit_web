import{g as W}from"./auth-a9M5ekjn.js";import{d as ye,V as ae,r as x,w as _e,D as Pe,g as E,o as w,f as a,b as e,e as t,X as Q,s as p,c as R,l as $,t as i,a0 as P,ap as Ue,aq as je,i as we,p as Te,F as ke,ay as G,b8 as $e,v as qe}from"./main-BeYChyqE.js";import{V as he}from"./VDialog-DB-_06qg.js";import{b as J,V as T,c as be}from"./VCard-BE4J-KWK.js";import{V as A}from"./VCardText-CiCmkOkk.js";import{V as Ae}from"./VForm-B2b_Armc.js";import{V as se,a as q}from"./VRow-BIUD78Be.js";import{V as ge}from"./VSelect-CxNmxtHk.js";import{a as ce,b as pe,d as Se,V as Ne}from"./VList-C_4ZD0s3.js";import{V as Y}from"./VTextField-DjRwf3lZ.js";import{V as Fe}from"./VTextarea-CtOkH5XM.js";import{V as ze}from"./VTable-oigA70NC.js";import{V as Re}from"./VAutocomplete-eTggAw5l.js";import{V as ve}from"./VDivider-C4pCokCc.js";import{V as Ve}from"./VSpacer-DgnnU6eh.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as le}from"./VChip-Q4c6Slz2.js";import{V as Be,a as Ee}from"./VDataTable-BD3pYhAj.js";import{V as Oe}from"./VContainer-Br7687FR.js";import{V as Me}from"./VDataTableServer-D9oLdqE_.js";import{V as Le}from"./VMenu-CMH2fMN5.js";import{V as He,a as Qe}from"./VAlert-BeNH_8Ij.js";import{V as Ke}from"./VSnackbar-CelyaIKg.js";import"./VOverlay-BeIaK0FG.js";import"./forwardRefs-B931MWyl.js";import"./VImg-Byrj7t-L.js";import"./VAvatar-CNQQSkfG.js";/* empty css              */import"./VCheckboxBtn-CXIxfrKE.js";import"./filter-DBt9VDVE.js";const Ge={class:"d-flex align-center gap-2"},Xe={class:"d-flex flex-column"},Je={key:0,class:"text-caption text-medium-emphasis"},We={class:"mt-6"},Ye={class:"d-flex justify-space-between align-center mb-4"},Ze={key:0},et={class:"text-center font-weight-medium"},tt={class:"text-center font-weight-medium"},at={class:"text-end"},lt={class:"d-flex justify-space-between mb-2"},st={class:"font-weight-medium"},ot={class:"d-flex justify-space-between mb-2"},nt={class:"text-success"},it={class:"d-flex justify-space-between"},ut={class:"text-h6 font-weight-bold text-primary"},rt=ye({__name:"PurchaseDialog",props:{modelValue:{type:Boolean},purchase:{default:null},mode:{default:"create"}},emits:["update:modelValue","saved"],setup(ue,{emit:ee}){const v=ue,M=ee,N=ae({get:()=>v.modelValue,set:u=>M("update:modelValue",u)}),U=x(),j=x(!1),S=x(!1),D=x(!1),B=x(!1),O=x([]),F=x([]),_=x({id_supplier:null,purchase_date:new Date().toISOString().split("T")[0],notes:"",discount_amount:0,discount_amount_display:"0",items:[]}),c=ae(()=>v.mode==="edit"?"Edit Purchase Order":"Buat Purchase Order Baru"),o=ae(()=>{const u=_.value.items.reduce((h,r)=>h+(r.total_cost||0),0),n=Number.parseFloat(String(_.value.discount_amount_display).replace(/\D/g,""))||0,d=0,y=u-n+d;return console.log("ðŸ’° Totals calculation:",{subtotal:u,discount:n,tax:d,total:y}),{subtotal:u,discount:n,tax:d,total:y}}),V=ae(()=>j.value&&(_.value.items.length===0||_.value.items.every(u=>u.id_item&&u.quantity>0&&u.unit_cost>0))),z={required:u=>!!u||"Field ini wajib diisi"},I=async()=>{try{D.value=!0;const u=W(),n={"Content-Type":"application/json",Accept:"application/json"};u&&(n.Authorization=`Bearer ${u}`);const d=await G.get("/api/suppliers",{headers:n});O.value=d.data.data||[],console.log("ðŸ“‹ Suppliers loaded:",O.value.length,"suppliers"),console.log("ðŸ“‹ First supplier sample:",O.value[0])}catch(u){console.error("Error loading suppliers:",u)}finally{D.value=!1}},L=async()=>{var u;try{B.value=!0;const n=W();console.log("Loading items with token:",n?"Token found":"No token");const d={"Content-Type":"application/json",Accept:"application/json"};n&&(d.Authorization=`Bearer ${n}`),console.log("Making request to /api/items");const y=await G.get("/api/items?per_page=all",{headers:d});console.log("Items response:",y.data);const h=y.data.data;h&&h.data?F.value=h.data||[]:F.value=y.data.data||[],console.log("Items loaded:",F.value.length,"items")}catch(n){console.error("Error loading items:",n),console.error("Error response:",(u=n.response)==null?void 0:u.data)}finally{B.value=!1}},oe=u=>{try{const n=_.value.items[u];if(!n){console.warn("Item not found at index:",u);return}n.quantity>0&&n.total_cost>0?(n.unit_cost=n.total_cost/n.quantity,n.unit_cost_display=H(n.unit_cost).replace("Rp ","").replace(/\./g,"")):(n.unit_cost=0,n.unit_cost_display="0"),console.log(`Item ${u} unit cost calculated:`,n.unit_cost)}catch(n){console.error("Error in calculateUnitCost:",n)}},K=u=>{try{const n=_.value.items[u];if(!n){console.warn("Item not found at index:",u);return}n.quantity>0&&n.unit_cost>0?(n.total_cost=n.quantity*n.unit_cost,n.total_cost_display=new Intl.NumberFormat("id-ID").format(n.total_cost)):(n.total_cost=0,n.total_cost_display="0"),console.log(`Item ${u} total cost calculated:`,n.total_cost)}catch(n){console.error("Error in calculateTotalCost:",n)}},me=(u,n)=>{try{const d=_.value.items[u];if(!d||!n)return;const y=F.value.find(h=>h.id_item===n);y&&(d.unit=y.unit||"",console.log(`Item ${u} unit set to:`,d.unit))}catch(d){console.error("Error in onItemChange:",d)}},te=()=>{try{console.log("Adding new item..."),console.log("Current items count:",_.value.items.length);const u={id_item:null,quantity:0,unit:"",unit_cost:0,unit_cost_display:"0",total_cost:0,total_cost_display:"0"};_.value.items.push(u),console.log("Item added successfully. New count:",_.value.items.length)}catch(u){console.error("Error in addItem:",u)}},re=u=>{_.value.items.splice(u,1)},g=(u,n)=>{var h;const d=(h=n.target)==null?void 0:h.value,y=_.value.items[u];d===""||d===null||d===void 0?y.quantity=0:y.quantity=Number.parseFloat(d)||1,K(u)},f=(u,n)=>{var r;const d=(r=n.target)==null?void 0:r.value,y=(d==null?void 0:d.replace(/\D/g,""))||"",h=_.value.items[u];y===""?(h.total_cost=0,h.total_cost_display="0"):(h.total_cost=Number.parseFloat(y),h.total_cost_display=new Intl.NumberFormat("id-ID").format(h.total_cost)),oe(u)},m=u=>{var y;const n=(y=u.target)==null?void 0:y.value,d=(n==null?void 0:n.replace(/\D/g,""))||"";d===""?_.value.discount_amount_display="0":_.value.discount_amount_display=new Intl.NumberFormat("id-ID").format(Number.parseInt(d))},k=()=>{},H=u=>Number.isNaN(u)||u===null||u===void 0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(u),X=()=>{var u,n,d,y;if(console.log("ðŸ” initializeForm called"),console.log("ðŸ“ Mode:",v.mode),console.log("ðŸ’¾ Purchase data:",v.purchase),v.mode==="edit"&&v.purchase){console.log("âœ… Initializing form for edit mode"),console.log("ï¿½ All purchase properties:",Object.keys(v.purchase)),console.log("ï¿½ðŸ‘¤ Supplier ID from purchase:",v.purchase.id_supplier),console.log("ï¿½ Supplier object from purchase:",v.purchase.supplier),console.log("ðŸ‘¤ Supplier_id from purchase:",v.purchase.supplier_id),console.log("ï¿½ðŸ“¦ Items from purchase:",v.purchase.items);const h=v.purchase.supplier_id||v.purchase.id_supplier||((u=v.purchase.supplier)==null?void 0:u.id_supplier)||((n=v.purchase.supplier)==null?void 0:n.id);console.log("ðŸŽ¯ Raw supplier ID:",h,"type:",typeof h);const r=h?Number.parseInt(String(h)):null;if(console.log("ðŸŽ¯ Converted supplier ID:",r),console.log("ðŸ“¦ Items from purchase:",v.purchase.items),v.purchase.items&&v.purchase.items.length>0){const s=v.purchase.items[0];console.log("ï¿½ First item debug:",{quantity:s.quantity,quantity_ordered:s.quantity_ordered,unit_cost:s.unit_cost,total_cost:s.total_cost,item_id:((d=s.item)==null?void 0:d.id_item)||s.id_item})}console.log("ðŸ“… Original purchase_date:",v.purchase.purchase_date),console.log("ðŸ“… Purchase_date type:",typeof v.purchase.purchase_date);const l=v.purchase.purchase_date?new Date(v.purchase.purchase_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0];console.log("ðŸ“… Formatted purchase_date:",l),_.value={id_supplier:r,purchase_date:l,notes:v.purchase.notes||"",discount_amount:v.purchase.discount_amount||0,discount_amount_display:new Intl.NumberFormat("id-ID").format(v.purchase.discount_amount||0),items:((y=v.purchase.items)==null?void 0:y.map(s=>{var ie,Ie,De,Ce;console.log("ðŸ”„ Mapping item:",s),console.log("ðŸ“Š Item quantity_ordered:",s.quantity_ordered),console.log("ðŸ“Š Item quantity:",s.quantity);const b=Number.parseFloat(s.quantity_ordered||s.quantity||0)||0,C=Number.parseFloat(s.unit_cost||0)||0,Z=b*C;return console.log("ðŸ“Š Calculated - quantity:",b,"unitCost:",C,"totalCost:",Z),console.log("ðŸ·ï¸ Item unit debug:",{item_unit:(ie=s.item)==null?void 0:ie.unit,direct_unit:s.unit,item_id:((Ie=s.item)==null?void 0:Ie.id_item)||s.id_item}),{id_item:((De=s.item)==null?void 0:De.id_item)||s.id_item,quantity:b,unit:((Ce=s.item)==null?void 0:Ce.unit)||s.unit||"",unit_cost:C,unit_cost_display:new Intl.NumberFormat("id-ID").format(C),total_cost:Z,total_cost_display:new Intl.NumberFormat("id-ID").format(Z)}}))||[]},console.log("ðŸ“‹ Form data after initialization:",_.value)}else console.log("ðŸ†• Initializing form for create mode"),_.value={id_supplier:null,purchase_date:new Date().toISOString().split("T")[0],notes:"",discount_amount:0,discount_amount_display:"0",items:[]}},de=async()=>{var u,n,d;if((u=U.value)!=null&&u.validate())try{S.value=!0;const y=W(),h={"Content-Type":"application/json",Accept:"application/json"};y&&(h.Authorization=`Bearer ${y}`);const r={supplier_id:_.value.id_supplier,purchase_date:_.value.purchase_date,notes:_.value.notes,discount_amount:Number.parseFloat(_.value.discount_amount_display.replace(/\D/g,""))||0,items:_.value.items.map(l=>({id_item:l.id_item,quantity:l.quantity,unit_cost:l.unit_cost}))};v.mode==="edit"?await G.put(`/api/purchases/${v.purchase.id_purchase}`,r,{headers:h}):await G.post("/api/purchases",r,{headers:h}),M("saved")}catch(y){console.error("Error saving purchase:",y),console.error("Error saving purchase:",((d=(n=y.response)==null?void 0:n.data)==null?void 0:d.message)||y.message)}finally{S.value=!1}},ne=()=>{N.value=!1},fe=()=>{_.value.items.forEach((u,n)=>{if(u.id_item&&!u.unit){const d=F.value.find(y=>y.id_item===u.id_item);d&&(u.unit=d.unit,console.log(`ðŸ”„ Updated unit for item ${n}:`,u.unit))}})};return _e(()=>v.modelValue,async u=>{u&&(await Promise.all([I(),L()]),await $e(),X(),fe())}),_e(()=>v.purchase,async u=>{u&&v.mode==="edit"&&(O.value.length===0&&await I(),F.value.length===0&&await L(),await $e(),X(),fe())},{deep:!0,immediate:!0}),Pe(()=>{I(),L()}),(u,n)=>(w(),E(he,{modelValue:N.value,"onUpdate:modelValue":n[5]||(n[5]=d=>N.value=d),"max-width":"1200",persistent:""},{default:a(()=>[e(T,null,{default:a(()=>[e(J,{class:"d-flex align-center justify-space-between"},{default:a(()=>{var d;return[t("div",Ge,[e(Q,null,{default:a(()=>n[6]||(n[6]=[p("mdi-cart-plus")])),_:1,__:[6]}),t("div",Xe,[t("span",null,i(c.value),1),v.mode==="edit"&&((d=v.purchase)!=null&&d.purchase_number)?(w(),R("span",Je," No. Order: "+i(v.purchase.purchase_number),1)):$("",!0)])]),e(P,{icon:"mdi-close",size:"small",variant:"text",onClick:ne})]}),_:1}),e(A,null,{default:a(()=>[e(Ae,{ref_key:"form",ref:U,modelValue:j.value,"onUpdate:modelValue":n[3]||(n[3]=d=>j.value=d)},{default:a(()=>[e(se,null,{default:a(()=>[e(q,{cols:"12",md:"6"},{default:a(()=>[e(ge,{modelValue:_.value.id_supplier,"onUpdate:modelValue":n[0]||(n[0]=d=>_.value.id_supplier=d),label:"Supplier *",items:O.value,"item-title":"name","item-value":"id_supplier",variant:"outlined",rules:[z.required],loading:D.value},{item:a(({props:d,item:y})=>[e(ce,Ue(je(d)),{default:a(()=>[e(pe,null,{default:a(()=>[p(i(y.raw.name),1)]),_:2},1024),e(Se,null,{default:a(()=>[p(i(y.raw.phone)+" - "+i(y.raw.email),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","rules","loading"])]),_:1}),e(q,{cols:"12",md:"3"},{default:a(()=>[e(Y,{modelValue:_.value.purchase_date,"onUpdate:modelValue":n[1]||(n[1]=d=>_.value.purchase_date=d),label:"Tanggal Purchase *",type:"date",variant:"outlined",rules:[z.required]},null,8,["modelValue","rules"])]),_:1}),e(q,{cols:"12"},{default:a(()=>[e(Fe,{modelValue:_.value.notes,"onUpdate:modelValue":n[2]||(n[2]=d=>_.value.notes=d),label:"Catatan",variant:"outlined",rows:"2",placeholder:"Catatan tambahan untuk purchase order ini..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t("div",We,[t("div",Ye,[n[9]||(n[9]=t("h3",{class:"text-h6"}," Items Purchase ",-1)),e(P,{color:"primary",variant:"tonal",onClick:te},{default:a(()=>[e(Q,{start:""},{default:a(()=>n[7]||(n[7]=[p(" mdi-plus ")])),_:1,__:[7]}),n[8]||(n[8]=p(" Tambah Item "))]),_:1,__:[8]})]),e(T,{variant:"outlined"},{default:a(()=>[e(ze,null,{default:a(()=>[n[11]||(n[11]=t("thead",null,[t("tr",null,[t("th",{style:{"inline-size":"35%"}}," Item "),t("th",{style:{"inline-size":"12%"}}," Quantity "),t("th",{style:{"inline-size":"10%"}}," Unit "),t("th",{style:{"inline-size":"15%"}}," Total Harga "),t("th",{style:{"inline-size":"15%"}}," Harga Satuan "),t("th",{style:{"inline-size":"13%"}}," Action ")])],-1)),t("tbody",null,[_.value.items.length===0?(w(),R("tr",Ze,n[10]||(n[10]=[t("td",{colspan:"6",class:"text-center py-8 text-medium-emphasis"},' Belum ada item. Klik "Tambah Item" untuk menambah item purchase. ',-1)]))):$("",!0),(w(!0),R(ke,null,we(_.value.items,(d,y)=>(w(),R("tr",{key:y},[t("td",null,[e(Re,{modelValue:d.id_item,"onUpdate:modelValue":[h=>d.id_item=h,h=>me(y,h)],label:"Pilih Item",items:F.value,"item-title":"name","item-value":"id_item",variant:"outlined",density:"compact",loading:B.value,clearable:"","no-data-text":"Tidak ada item ditemukan"},{item:a(({props:h,item:r})=>[e(ce,Te({ref_for:!0},h),{default:a(()=>[e(pe,null,{default:a(()=>[p(i(r.raw.name),1)]),_:2},1024),e(Se,null,{default:a(()=>{var l;return[p(i((l=r.raw.category)==null?void 0:l.name)+" - SKU: "+i(r.raw.sku),1)]}),_:2},1024)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","items","loading"])]),t("td",null,[e(Y,{modelValue:d.quantity,"onUpdate:modelValue":h=>d.quantity=h,label:"Qty",type:"number",min:"1",step:"1",variant:"outlined",density:"compact",onInput:h=>g(y,h),onBlur:h=>oe(y)},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur"])]),t("td",null,[t("div",et,i(d.unit||"-"),1)]),t("td",null,[e(Y,{modelValue:d.total_cost_display,"onUpdate:modelValue":h=>d.total_cost_display=h,label:"Total Harga",variant:"outlined",density:"compact",prefix:"Rp",onInput:h=>f(y,h),onBlur:h=>oe(y)},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur"])]),t("td",null,[t("div",tt,i(H(d.unit_cost)),1)]),t("td",null,[e(P,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:h=>re(y)},null,8,["onClick"])])]))),128))])]),_:1,__:[11]})]),_:1}),e(T,{class:"mt-4",variant:"outlined"},{default:a(()=>[e(A,null,{default:a(()=>[e(se,null,{default:a(()=>[e(q,{cols:"12",md:"8"},{default:a(()=>[e(Y,{modelValue:_.value.discount_amount_display,"onUpdate:modelValue":n[4]||(n[4]=d=>_.value.discount_amount_display=d),label:"Diskon",variant:"outlined",prefix:"Rp",placeholder:"0",onInput:m,onBlur:k},null,8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"4"},{default:a(()=>[t("div",at,[t("div",lt,[n[12]||(n[12]=t("span",null,"Subtotal:",-1)),t("span",st,i(H(o.value.subtotal)),1)]),t("div",ot,[n[13]||(n[13]=t("span",null,"Diskon:",-1)),t("span",nt,"-"+i(H(o.value.discount)),1)]),e(ve,{class:"my-2"}),t("div",it,[n[14]||(n[14]=t("span",{class:"text-h6 font-weight-bold"},"Total:",-1)),t("span",ut,i(H(o.value.total)),1)])])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),e(be,{class:"pa-4"},{default:a(()=>[e(Ve),e(P,{variant:"text",onClick:ne},{default:a(()=>n[15]||(n[15]=[p(" Batal ")])),_:1,__:[15]}),e(P,{color:"primary",loading:S.value,disabled:!V.value,onClick:de},{default:a(()=>[p(i(u.mode==="edit"?"Update":"Simpan"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),dt=xe(rt,[["__scopeId","data-v-e0e9ed7d"]]),ct={class:"d-flex align-center gap-3"},pt={class:"d-flex justify-space-between align-center"},mt={class:"text-h6"},vt={class:"text-body-1"},ft={class:"font-weight-medium"},_t={class:"text-caption text-medium-emphasis"},gt={class:"font-weight-medium"},yt={class:"d-flex justify-space-between"},ht={class:"font-weight-medium"},bt=ye({__name:"PurchaseReceiveDialog",props:{modelValue:{type:Boolean},purchase:{}},emits:["update:modelValue","success"],setup(ue,{emit:ee}){const v=ue,M=ee,N=x(!1),U=x(!1),j=x(new Date().toISOString().split("T")[0]),S=x([]),D=ae({get:()=>v.modelValue,set:g=>M("update:modelValue",g)}),B=ae(()=>j.value&&o()>0&&!U.value),O=[{title:"Item",key:"item_name",sortable:!1,width:"250px"},{title:"Ordered",key:"quantity_ordered",sortable:!1,width:"110px"},{title:"Received",key:"quantity_received",sortable:!1,width:"110px"},{title:"Remaining",key:"remaining",sortable:!1,width:"110px"},{title:"Receive Qty",key:"receive_quantity",sortable:!1,width:"140px"},{title:"Quality",key:"quality_check",sortable:!1,width:"140px"},{title:"Notes",key:"notes",sortable:!1,width:"200px"},{title:"Status",key:"status",sortable:!1,width:"120px"}],F=[{title:"âœ… Good",value:"good"},{title:"âŒ Damaged",value:"damaged"},{title:"â° Expired",value:"expired"},{title:"âš ï¸ Issues",value:"partial"}],_=g=>g.quantity_ordered-(g.quantity_received||0),c=g=>{const f=_(g);return f<=0?"text-success":f<g.quantity_ordered*.5?"text-warning":""},o=()=>S.value.filter(g=>g.receive_quantity&&g.receive_quantity>0).length,V=g=>{const f=_(g);g.receive_quantity>f&&(g.receive_quantity=f),g.receive_quantity<0&&(g.receive_quantity=0)},z=g=>({pending:"warning",ordered:"info",partial:"primary",received:"success",completed:"success",cancelled:"error"})[g]||"default",I=g=>({pending:"Pending",ordered:"Ordered",partial:"Partial",received:"Received",completed:"Completed",cancelled:"Cancelled"})[g]||g,L=g=>({pending:"warning",partial:"primary",received:"success"})[g]||"default",oe=g=>({pending:"Pending",partial:"Partial",received:"Complete"})[g]||g,K=g=>new Date(g).toLocaleDateString("id-ID"),me=async()=>{var g,f;if((g=v.purchase)!=null&&g.id_purchase){N.value=!0;try{if(console.log("Purchase props:",v.purchase),v.purchase.items&&v.purchase.items.length>0){console.log("Using items from props:",v.purchase.items),S.value=v.purchase.items.map(k=>({...k,receive_quantity:0,quality_condition:"good",receive_notes:""})),N.value=!1;return}console.log("Fetching items from API...");const m=await G.get(`/api/purchases/${v.purchase.id_purchase}`,{headers:{Authorization:`Bearer ${W()}`}});console.log("API Response:",m.data),m.data.success&&((f=m.data.data)!=null&&f.items)&&(console.log("Using items from API data.data:",m.data.data.items),S.value=m.data.data.items.map(k=>({...k,receive_quantity:0,quality_condition:"good",receive_notes:""})))}catch(m){console.error("Error loading purchase items:",m)}finally{N.value=!1}}},te=async()=>{if(!B.value)return;const g=S.value.filter(f=>f.receive_quantity&&f.receive_quantity>0).map(f=>({id_purchase_item:f.id_purchase_item,quantity_received:f.receive_quantity,quality_check:{condition:f.quality_condition,checked_at:new Date().toISOString(),checked_by:"current_user"},notes:f.receive_notes||null}));if(g.length!==0){U.value=!0;try{const f=await G.post(`/api/purchases/${v.purchase.id_purchase}/receive`,{items:g,delivery_date:j.value},{headers:{Authorization:`Bearer ${W()}`}});f.data.success&&(M("success",f.data),re())}catch(f){console.error("Error receiving items:",f)}finally{U.value=!1}}},re=()=>{D.value=!1,S.value=[],j.value=new Date().toISOString().split("T")[0]};return _e(D,g=>{g&&v.purchase&&me()}),(g,f)=>(w(),E(he,{modelValue:D.value,"onUpdate:modelValue":f[1]||(f[1]=m=>D.value=m),"max-width":"1400px",persistent:""},{default:a(()=>[e(T,null,{default:a(()=>[e(J,{class:"pa-4"},{default:a(()=>{var m;return[t("div",ct,[e(Q,{icon:"mdi-package-variant"}),t("span",null,"Receive Items - Purchase #"+i((m=g.purchase)==null?void 0:m.purchase_number),1)])]}),_:1}),e(ve),e(A,{class:"pa-4"},{default:a(()=>[e(T,{variant:"outlined",class:"mb-4"},{default:a(()=>[e(A,{class:"pa-3"},{default:a(()=>{var m,k,H,X;return[t("div",pt,[t("div",null,[f[2]||(f[2]=t("div",{class:"text-body-2 text-medium-emphasis"}," Supplier ",-1)),t("div",mt,i((k=(m=g.purchase)==null?void 0:m.supplier)==null?void 0:k.name),1)]),t("div",null,[f[3]||(f[3]=t("div",{class:"text-body-2 text-medium-emphasis"}," Order Date ",-1)),t("div",vt,i(K((H=g.purchase)==null?void 0:H.purchase_date)),1)]),t("div",null,[f[4]||(f[4]=t("div",{class:"text-body-2 text-medium-emphasis"}," Status ",-1)),e(le,{color:z((X=g.purchase)==null?void 0:X.status),variant:"tonal",size:"small"},{default:a(()=>{var de;return[p(i(I((de=g.purchase)==null?void 0:de.status)),1)]}),_:1},8,["color"])])])]}),_:1})]),_:1}),e(se,{class:"mb-4"},{default:a(()=>[e(q,{cols:"12",md:"6"},{default:a(()=>[e(Y,{modelValue:j.value,"onUpdate:modelValue":f[0]||(f[0]=m=>j.value=m),label:"Delivery Date",type:"date",variant:"outlined",rules:[m=>!!m||"Delivery date is required"],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),f[7]||(f[7]=t("div",{class:"text-h6 mb-3"}," Items to Receive ",-1)),e(Be,{headers:O,items:S.value,loading:N.value,"item-key":"id_purchase_item",class:"border rounded",density:"compact"},{"item.item_name":a(({item:m})=>{var k,H;return[t("div",null,[t("div",ft,i((k=m.item)==null?void 0:k.name),1),t("div",_t,i((H=m.item)==null?void 0:H.item_code),1)])]}),"item.quantity_ordered":a(({item:m})=>{var k;return[t("span",gt,i(parseInt(m.quantity_ordered))+" "+i((k=m.item)==null?void 0:k.unit),1)]}),"item.quantity_received":a(({item:m})=>{var k;return[t("span",{class:qe(m.quantity_received>0?"text-success":"")},i(m.quantity_received||0)+" "+i((k=m.item)==null?void 0:k.unit),3)]}),"item.remaining":a(({item:m})=>{var k;return[t("span",{class:qe(["font-weight-medium",c(m)])},i(_(m))+" "+i((k=m.item)==null?void 0:k.unit),3)]}),"item.receive_quantity":a(({item:m})=>[e(Y,{modelValue:m.receive_quantity,"onUpdate:modelValue":k=>m.receive_quantity=k,modelModifiers:{number:!0},type:"number",min:0,max:_(m),step:"0.001",density:"compact",variant:"outlined",style:{"inline-size":"140px"},disabled:_(m)<=0,onInput:k=>V(m)},null,8,["modelValue","onUpdate:modelValue","max","disabled","onInput"])]),"item.quality_check":a(({item:m})=>[e(ge,{modelValue:m.quality_condition,"onUpdate:modelValue":k=>m.quality_condition=k,items:F,density:"compact",variant:"outlined",style:{"inline-size":"140px"},disabled:!m.receive_quantity||m.receive_quantity<=0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.notes":a(({item:m})=>[e(Y,{modelValue:m.receive_notes,"onUpdate:modelValue":k=>m.receive_notes=k,placeholder:"Notes...",density:"compact",variant:"outlined",style:{"inline-size":"200px"},disabled:!m.receive_quantity||m.receive_quantity<=0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.status":a(({item:m})=>[e(le,{color:L(m.status),variant:"tonal",size:"small"},{default:a(()=>[p(i(oe(m.status)),1)]),_:2},1032,["color"])]),_:1},8,["items","loading"]),e(T,{variant:"outlined",class:"mt-4"},{default:a(()=>[e(A,{class:"pa-3"},{default:a(()=>[f[6]||(f[6]=t("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Receive Summary ",-1)),t("div",yt,[f[5]||(f[5]=t("span",null,"Items to receive:",-1)),t("span",ht,i(o()),1)])]),_:1,__:[6]})]),_:1})]),_:1,__:[7]}),e(ve),e(be,{class:"pa-4"},{default:a(()=>[e(Ve),e(P,{variant:"outlined",disabled:U.value,onClick:re},{default:a(()=>f[8]||(f[8]=[p(" Cancel ")])),_:1,__:[8]},8,["disabled"]),e(P,{color:"primary",loading:U.value,disabled:!B.value,onClick:te},{default:a(()=>[e(Q,{start:"",icon:"mdi-check"}),f[9]||(f[9]=p(" Confirm Receipt "))]),_:1,__:[9]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Vt={class:"d-flex align-center gap-2"},wt={class:"mb-2"},kt={class:"text-primary font-weight-medium"},xt={class:"mb-2"},It={class:"mb-2"},Dt={key:0,class:"mb-2"},Ct={key:1},$t={class:"mb-2"},qt={class:"mb-2"},St={class:"mb-2"},Pt={class:"mb-1 font-weight-medium"},Tt={key:0,class:"text-caption text-medium-emphasis mb-0"},zt={key:1,class:"text-caption text-medium-emphasis mb-0"},Ut={class:"text-center"},jt={key:0},At={class:"text-right font-weight-medium"},Nt={class:"text-right font-weight-medium"},Ft={class:"text-center"},Rt={class:"mb-0"},Bt={class:"mb-2"},Et={key:0},Ot={class:"d-flex justify-space-between mb-2"},Mt={class:"font-weight-medium"},Lt={key:0,class:"d-flex justify-space-between mb-2"},Ht={class:"text-success"},Qt={class:"d-flex justify-space-between"},Kt={class:"text-h6 font-weight-bold text-primary"},Gt=ye({__name:"PurchaseViewDialog",props:{modelValue:{type:Boolean},purchase:{default:null}},emits:["update:modelValue"],setup(ue,{emit:ee}){const v=ue,M=ee,N=ae({get:()=>v.modelValue,set:c=>M("update:modelValue",c)}),U=ae(()=>v.purchase&&v.purchase.status!=="cancelled"),j=()=>{N.value=!1},S=c=>{const o=typeof c=="string"?parseFloat(c):c;return isNaN(o)||o===null||o===void 0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o)},D=c=>c?new Date(c).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"}):"-",B=c=>c?new Date(c).toLocaleString("id-ID",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",O=c=>({pending:"warning",partial:"info",received:"success",cancelled:"error"})[c]||"default",F=c=>({pending:"Pending",partial:"Sebagian",received:"Diterima",cancelled:"Dibatalkan"})[c]||c,_=()=>{window.print()};return(c,o)=>(w(),E(he,{modelValue:N.value,"onUpdate:modelValue":o[0]||(o[0]=V=>N.value=V),"max-width":"900",persistent:""},{default:a(()=>[e(T,null,{default:a(()=>[e(J,{class:"d-flex align-center justify-space-between"},{default:a(()=>[t("div",Vt,[e(Q,null,{default:a(()=>o[1]||(o[1]=[p("mdi-file-document-outline")])),_:1,__:[1]}),o[2]||(o[2]=t("span",null,"Purchase Order Detail",-1))]),e(P,{icon:"mdi-close",size:"small",variant:"text",onClick:j})]),_:1}),c.purchase?(w(),E(A,{key:0},{default:a(()=>[e(se,{class:"mb-6"},{default:a(()=>[e(q,{cols:"12",md:"6"},{default:a(()=>[e(T,{variant:"outlined"},{default:a(()=>[e(J,{class:"text-subtitle-1"},{default:a(()=>o[3]||(o[3]=[p("Purchase Information")])),_:1,__:[3]}),e(A,null,{default:a(()=>[t("div",wt,[o[4]||(o[4]=t("strong",null,"Purchase Number:",-1)),o[5]||(o[5]=t("br",null,null,-1)),t("span",kt,i(c.purchase.purchase_number),1)]),t("div",xt,[o[6]||(o[6]=t("strong",null,"Status:",-1)),o[7]||(o[7]=t("br",null,null,-1)),e(le,{color:O(c.purchase.status),size:"small",variant:"elevated"},{default:a(()=>[p(i(F(c.purchase.status)),1)]),_:1},8,["color"])]),t("div",It,[o[8]||(o[8]=t("strong",null,"Tanggal Purchase:",-1)),o[9]||(o[9]=t("br",null,null,-1)),p(" "+i(D(c.purchase.purchase_date)),1)]),c.purchase.expected_delivery_date?(w(),R("div",Dt,[o[10]||(o[10]=t("strong",null,"Tanggal Kirim Diharapkan:",-1)),o[11]||(o[11]=t("br",null,null,-1)),p(" "+i(D(c.purchase.expected_delivery_date)),1)])):$("",!0),c.purchase.actual_delivery_date?(w(),R("div",Ct,[o[12]||(o[12]=t("strong",null,"Tanggal Kirim Aktual:",-1)),o[13]||(o[13]=t("br",null,null,-1)),p(" "+i(D(c.purchase.actual_delivery_date)),1)])):$("",!0)]),_:1})]),_:1})]),_:1}),e(q,{cols:"12",md:"6"},{default:a(()=>[e(T,{variant:"outlined"},{default:a(()=>[e(J,{class:"text-subtitle-1"},{default:a(()=>o[14]||(o[14]=[p("Supplier Information")])),_:1,__:[14]}),e(A,null,{default:a(()=>{var V,z,I,L;return[t("div",$t,[o[15]||(o[15]=t("strong",null,"Nama Supplier:",-1)),o[16]||(o[16]=t("br",null,null,-1)),p(" "+i(((V=c.purchase.supplier)==null?void 0:V.name)||"-"),1)]),t("div",qt,[o[17]||(o[17]=t("strong",null,"Telepon:",-1)),o[18]||(o[18]=t("br",null,null,-1)),p(" "+i(((z=c.purchase.supplier)==null?void 0:z.phone)||"-"),1)]),t("div",St,[o[19]||(o[19]=t("strong",null,"Email:",-1)),o[20]||(o[20]=t("br",null,null,-1)),p(" "+i(((I=c.purchase.supplier)==null?void 0:I.email)||"-"),1)]),t("div",null,[o[21]||(o[21]=t("strong",null,"Alamat:",-1)),o[22]||(o[22]=t("br",null,null,-1)),p(" "+i(((L=c.purchase.supplier)==null?void 0:L.address)||"-"),1)])]}),_:1})]),_:1})]),_:1})]),_:1}),e(T,{variant:"outlined",class:"mb-6"},{default:a(()=>[e(J,{class:"text-subtitle-1"},{default:a(()=>o[23]||(o[23]=[p("Items Purchase")])),_:1,__:[23]}),e(ze,null,{default:a(()=>[o[24]||(o[24]=t("thead",null,[t("tr",null,[t("th",null,"Item"),t("th",{class:"text-center"},"Qty"),t("th",{class:"text-right"},"Unit Cost"),t("th",{class:"text-right"},"Total Cost"),t("th",{class:"text-center"},"Status")])],-1)),t("tbody",null,[(w(!0),R(ke,null,we(c.purchase.items,V=>{var z,I,L;return w(),R("tr",{key:V.id_purchase_item},[t("td",null,[t("div",null,[t("p",Pt,i(((z=V.item)==null?void 0:z.name)||"-"),1),(I=V.item)!=null&&I.code?(w(),R("p",Tt," Code: "+i(V.item.code),1)):$("",!0),(L=V.item)!=null&&L.description?(w(),R("p",zt,i(V.item.description),1)):$("",!0)])]),t("td",Ut,[e(le,{size:"small",variant:"outlined"},{default:a(()=>[p(i(parseInt(V.quantity_ordered))+" "+i(V.unit||"pcs"),1)]),_:2},1024),V.quantity_received>0?(w(),R("br",jt)):$("",!0),V.quantity_received>0?(w(),E(le,{key:1,size:"x-small",variant:"tonal",color:"success",class:"mt-1"},{default:a(()=>[p(" Received: "+i(parseInt(V.quantity_received)),1)]),_:2},1024)):$("",!0)]),t("td",At,i(S(V.unit_cost)),1),t("td",Nt,i(S(V.total_cost)),1),t("td",Ft,[e(le,{color:O(V.status),size:"small",variant:"tonal"},{default:a(()=>[p(i(F(V.status)),1)]),_:2},1032,["color"])])])}),128))])]),_:1,__:[24]})]),_:1}),e(se,null,{default:a(()=>[e(q,{cols:"12",md:"6"},{default:a(()=>[c.purchase.notes?(w(),E(T,{key:0,variant:"outlined"},{default:a(()=>[e(J,{class:"text-subtitle-1"},{default:a(()=>o[25]||(o[25]=[p("Catatan")])),_:1,__:[25]}),e(A,null,{default:a(()=>[t("p",Rt,i(c.purchase.notes),1)]),_:1})]),_:1})):$("",!0),e(T,{variant:"outlined",class:"mt-4"},{default:a(()=>[e(J,{class:"text-subtitle-1"},{default:a(()=>o[26]||(o[26]=[p("Purchase History")])),_:1,__:[26]}),e(A,null,{default:a(()=>{var V,z;return[t("div",Bt,[o[27]||(o[27]=t("strong",null,"Dibuat oleh:",-1)),o[28]||(o[28]=t("br",null,null,-1)),p(" "+i(((V=c.purchase.creator)==null?void 0:V.name)||"-")+" â€¢ "+i(B(c.purchase.created_at)),1)]),c.purchase.updated_at&&c.purchase.updated_at!==c.purchase.created_at?(w(),R("div",Et,[o[29]||(o[29]=t("strong",null,"Diupdate oleh:",-1)),o[30]||(o[30]=t("br",null,null,-1)),p(" "+i(((z=c.purchase.updater)==null?void 0:z.name)||"-")+" â€¢ "+i(B(c.purchase.updated_at)),1)])):$("",!0)]}),_:1})]),_:1})]),_:1}),e(q,{cols:"12",md:"6"},{default:a(()=>[e(T,{variant:"outlined"},{default:a(()=>[e(J,{class:"text-subtitle-1"},{default:a(()=>o[31]||(o[31]=[p("Total Summary")])),_:1,__:[31]}),e(A,null,{default:a(()=>[t("div",Ot,[o[32]||(o[32]=t("span",null,"Subtotal:",-1)),t("span",Mt,i(S(c.purchase.subtotal)),1)]),c.purchase.discount_amount>0?(w(),R("div",Lt,[o[33]||(o[33]=t("span",null,"Diskon:",-1)),t("span",Ht,"-"+i(S(c.purchase.discount_amount)),1)])):$("",!0),e(ve,{class:"my-3"}),t("div",Qt,[o[34]||(o[34]=t("span",{class:"text-h6 font-weight-bold"},"Total:",-1)),t("span",Kt,i(S(c.purchase.total_amount)),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):$("",!0),e(be,{class:"pa-4"},{default:a(()=>[e(Ve),e(P,{variant:"text",onClick:j},{default:a(()=>o[35]||(o[35]=[p(" Tutup ")])),_:1,__:[35]}),U.value?(w(),E(P,{key:0,color:"primary",variant:"tonal","prepend-icon":"mdi-printer",onClick:_},{default:a(()=>o[36]||(o[36]=[p(" Print ")])),_:1,__:[36]})):$("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Xt=xe(Gt,[["__scopeId","data-v-da47fee6"]]),Jt={class:"d-flex justify-space-between align-center"},Wt={class:"d-flex justify-space-between align-center"},Yt={class:"text-h4 font-weight-bold text-white"},Zt={class:"d-flex justify-space-between align-center"},ea={class:"text-h4 font-weight-bold text-white"},ta={class:"d-flex justify-space-between align-center"},aa={class:"text-h4 font-weight-bold text-white"},la={class:"d-flex justify-space-between align-center"},sa={class:"text-h4 font-weight-bold text-white"},oa={class:"d-flex align-center"},na={class:"mb-0 font-weight-medium"},ia={class:"text-caption text-medium-emphasis mb-0"},ua={class:"font-weight-medium"},ra={class:"d-flex gap-1"},da={class:"d-flex justify-center pt-2"},ca={key:0,class:"bg-grey-lighten-4 pa-3 rounded mt-3"},pa={class:"d-flex justify-space-between mb-2"},ma={class:"d-flex justify-space-between mb-2"},va={class:"d-flex justify-space-between mb-2"},fa={class:"d-flex justify-space-between mb-2"},_a={class:"d-flex justify-space-between"},ga={class:"max-height-150 overflow-y-auto"},ya=ye({__name:"purchases-management",setup(ue){const ee=x([]),v=x([]),M=x({}),N=x(!1),U=x(1),j=x(15),S=x(0),D=x({show:!1,message:"",color:"success"}),B=x(!1),O=x(!1),F=x(!1),_=x(!1),c=x(null),o=x(null),V=x(!1),z=x("create"),I=x({search:"",status:"",supplier_id:"",start_date:"",end_date:""}),L=[{title:"Purchase Number",key:"purchase_number",sortable:!0},{title:"Supplier",key:"supplier.name",sortable:!1},{title:"Tanggal",key:"purchase_date",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Total",key:"total_amount",sortable:!0},{title:"Actions",key:"actions",sortable:!1,width:"150px"}],oe=[{label:"Semua Status",value:""},{label:"Pending",value:"pending"},{label:"Ordered",value:"ordered"},{label:"Received",value:"received"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}],K=async()=>{var r,l;try{N.value=!0;const s={page:U.value,per_page:j.value};Object.keys(I.value).forEach(ie=>{I.value[ie]&&I.value[ie]!==""&&(s[ie]=I.value[ie])});const b=W(),C={"Content-Type":"application/json",Accept:"application/json"};b&&(C.Authorization=`Bearer ${b}`);const Z=await G.get("/api/purchases",{params:s,headers:C});ee.value=Z.data.data.data||[],S.value=Z.data.data.total||0}catch(s){console.error("Error loading purchases:",s),D.value={show:!0,message:"Error loading purchases: "+(((l=(r=s.response)==null?void 0:r.data)==null?void 0:l.message)||s.message),color:"error"}}finally{N.value=!1}},me=async()=>{try{const r=W(),l={"Content-Type":"application/json",Accept:"application/json"};r&&(l.Authorization=`Bearer ${r}`);const s=await G.get("/api/suppliers",{headers:l});v.value=s.data.data||[]}catch(r){console.error("Error loading suppliers:",r)}},te=async()=>{try{const r=W(),l={"Content-Type":"application/json",Accept:"application/json"};r&&(l.Authorization=`Bearer ${r}`);const s=await G.get("/api/purchases/statistics",{headers:l});M.value=s.data.data||{}}catch(r){console.error("Error loading statistics:",r)}},re=()=>{c.value=null,z.value="create",B.value=!0},g=r=>{console.log("ðŸ”§ editPurchase called with:",r),console.log("ðŸ‘¤ Purchase supplier ID:",r.id_supplier),console.log("ðŸ“¦ Purchase items:",r.items),c.value=r,z.value="edit",B.value=!0,console.log("ðŸ“‹ selectedPurchase set to:",c.value),console.log("ðŸŽ¯ dialogMode set to:",z.value)},f=r=>{c.value=r,O.value=!0},m=r=>{c.value=r,F.value=!0},k=r=>{o.value=r,_.value=!0},H=async()=>{var r,l;if(o.value){V.value=!0;try{const s=W(),b={"Content-Type":"application/json",Accept:"application/json"};s&&(b.Authorization=`Bearer ${s}`),await G.delete(`/api/purchases/${o.value.id_purchase}`,{headers:b}),D.value={show:!0,message:`Purchase ${o.value.purchase_number} berhasil dihapus`,color:"success"},_.value=!1,o.value=null,K(),te()}catch(s){console.error("Error deleting purchase:",s),D.value={show:!0,message:"Error menghapus purchase: "+(((l=(r=s.response)==null?void 0:r.data)==null?void 0:l.message)||s.message),color:"error"}}finally{V.value=!1}}},X=async(r,l)=>{var s,b;try{const C=W(),Z={"Content-Type":"application/json",Accept:"application/json"};C&&(Z.Authorization=`Bearer ${C}`),await G.patch(`/api/purchases/${r.id_purchase}/status`,{status:l},{headers:Z}),K(),te(),D.value={show:!0,message:`Purchase status berhasil diubah ke ${l}!`,color:"success"}}catch(C){console.error("Error updating purchase status:",C),D.value={show:!0,message:"Error updating status: "+(((b=(s=C.response)==null?void 0:s.data)==null?void 0:b.message)||C.message),color:"error"}}},de=()=>{B.value=!1,K(),te(),D.value={show:!0,message:z.value==="create"?"Purchase order berhasil dibuat!":"Purchase order berhasil diperbarui!",color:"success"}},ne=r=>{const l=typeof r=="string"?parseFloat(r):r;return isNaN(l)?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)},fe=r=>r?new Date(r).toLocaleDateString("id-ID"):"-",u=r=>!r.items||!Array.isArray(r.items)?0:r.items.reduce((s,b)=>{const C=parseInt(b.quantity_ordered)||0;return s+C},0),n=r=>({pending:"warning",ordered:"info",received:"primary",completed:"success",cancelled:"error"})[r]||"default",d=r=>({pending:"Pending",ordered:"Dipesan",received:"Diterima",completed:"Selesai",cancelled:"Dibatalkan"})[r]||r,y=r=>{console.log("ðŸ” canEdit check for purchase:",r.purchase_number,"status:",r.status);const l=["pending","ordered","received","completed"].includes(r.status);return console.log("âœ… canEdit result:",l),l},h=r=>{console.log("ðŸ” canDelete check for purchase:",r.purchase_number,"status:",r.status);const l=["pending","received","completed"].includes(r.status);return console.log("âœ… canDelete result:",l),l};return _e(I,()=>{U.value=1,K()},{deep:!0}),Pe(()=>{K(),me(),te()}),(r,l)=>(w(),E(Oe,{fluid:""},{default:a(()=>[e(se,{class:"mb-4"},{default:a(()=>[e(q,{cols:"12"},{default:a(()=>[t("div",Jt,[l[17]||(l[17]=t("div",null,[t("h1",{class:"text-h4 font-weight-bold"},"Purchase Management"),t("p",{class:"text-body-1 text-medium-emphasis"},"Kelola pembelian barang dari supplier")],-1)),e(P,{color:"primary",size:"large",onClick:re},{default:a(()=>[e(Q,{start:""},{default:a(()=>l[15]||(l[15]=[p("mdi-plus")])),_:1,__:[15]}),l[16]||(l[16]=p(" Buat Purchase Order "))]),_:1,__:[16]})])]),_:1})]),_:1}),e(se,{class:"mb-6"},{default:a(()=>[e(q,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(T,{color:"primary"},{default:a(()=>[e(A,null,{default:a(()=>[t("div",Wt,[t("div",null,[l[18]||(l[18]=t("p",{class:"text-caption text-white mb-1"},"Total Purchase",-1)),t("p",Yt,i(M.value.total_purchases||0),1)]),e(Q,{size:"40",class:"text-white"},{default:a(()=>l[19]||(l[19]=[p("mdi-cart")])),_:1,__:[19]})])]),_:1})]),_:1})]),_:1}),e(q,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(T,{color:"warning"},{default:a(()=>[e(A,null,{default:a(()=>[t("div",Zt,[t("div",null,[l[20]||(l[20]=t("p",{class:"text-caption text-white mb-1"},"Pending",-1)),t("p",ea,i(M.value.pending_purchases||0),1)]),e(Q,{size:"40",class:"text-white"},{default:a(()=>l[21]||(l[21]=[p("mdi-clock")])),_:1,__:[21]})])]),_:1})]),_:1})]),_:1}),e(q,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(T,{color:"success"},{default:a(()=>[e(A,null,{default:a(()=>[t("div",ta,[t("div",null,[l[22]||(l[22]=t("p",{class:"text-caption text-white mb-1"},"Completed",-1)),t("p",aa,i(M.value.completed_purchases||0),1)]),e(Q,{size:"40",class:"text-white"},{default:a(()=>l[23]||(l[23]=[p("mdi-check-circle")])),_:1,__:[23]})])]),_:1})]),_:1})]),_:1}),e(q,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(T,{color:"info"},{default:a(()=>[e(A,null,{default:a(()=>[t("div",la,[t("div",null,[l[24]||(l[24]=t("p",{class:"text-caption text-white mb-1"},"Bulan Ini",-1)),t("p",sa,i(ne(M.value.total_amount_this_month||0)),1)]),e(Q,{size:"40",class:"text-white"},{default:a(()=>l[25]||(l[25]=[p("mdi-currency-usd")])),_:1,__:[25]})])]),_:1})]),_:1})]),_:1})]),_:1}),e(T,{class:"mb-6"},{default:a(()=>[e(A,null,{default:a(()=>[e(se,null,{default:a(()=>[e(q,{cols:"12",md:"3"},{default:a(()=>[e(Y,{modelValue:I.value.search,"onUpdate:modelValue":l[0]||(l[0]=s=>I.value.search=s),label:"Cari Purchase Number atau Supplier",placeholder:"Masukkan nomor purchase atau nama supplier","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"","onClick:clear":l[1]||(l[1]=s=>I.value.search="")},null,8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"2"},{default:a(()=>[e(ge,{modelValue:I.value.status,"onUpdate:modelValue":l[2]||(l[2]=s=>I.value.status=s),label:"Status",items:oe,"item-title":"label","item-value":"value",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"2"},{default:a(()=>[e(ge,{modelValue:I.value.supplier_id,"onUpdate:modelValue":l[3]||(l[3]=s=>I.value.supplier_id=s),label:"Supplier",items:v.value,"item-title":"name","item-value":"id_supplier",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),e(q,{cols:"12",md:"2"},{default:a(()=>[e(Y,{modelValue:I.value.start_date,"onUpdate:modelValue":l[4]||(l[4]=s=>I.value.start_date=s),label:"Tanggal Mulai",type:"date",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"2"},{default:a(()=>[e(Y,{modelValue:I.value.end_date,"onUpdate:modelValue":l[5]||(l[5]=s=>I.value.end_date=s),label:"Tanggal Akhir",type:"date",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"1"},{default:a(()=>[e(P,{color:"primary",variant:"tonal",icon:"mdi-refresh",onClick:K})]),_:1})]),_:1})]),_:1})]),_:1}),e(T,null,{default:a(()=>[e(Me,{"items-per-page":j.value,"onUpdate:itemsPerPage":l[7]||(l[7]=s=>j.value=s),page:U.value,"onUpdate:page":l[8]||(l[8]=s=>U.value=s),headers:L,items:ee.value,"items-length":S.value,loading:N.value,"item-value":"id_purchase","onUpdate:options":K},{"item.purchase_number":a(({item:s})=>[t("div",oa,[e(P,{variant:"text",color:"primary",size:"small",onClick:b=>f(s)},{default:a(()=>[p(i(s.purchase_number),1)]),_:2},1032,["onClick"])])]),"item.supplier.name":a(({item:s})=>{var b,C;return[t("div",null,[t("p",na,i(((b=s.supplier)==null?void 0:b.name)||"-"),1),t("p",ia,i(((C=s.supplier)==null?void 0:C.phone)||"-"),1)])]}),"item.purchase_date":a(({item:s})=>[p(i(fe(s.purchase_date)),1)]),"item.status":a(({item:s})=>[e(le,{color:n(s.status),size:"small",variant:"elevated"},{default:a(()=>[p(i(d(s.status)),1)]),_:2},1032,["color"])]),"item.total_amount":a(({item:s})=>[t("span",ua,i(ne(s.total_amount)),1)]),"item.actions":a(({item:s})=>[t("div",ra,[e(P,{icon:"mdi-eye",size:"small",variant:"text",color:"info",onClick:b=>f(s)},null,8,["onClick"]),y(s)?(w(),E(P,{key:0,icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:b=>g(s)},null,8,["onClick"])):$("",!0),["ordered","received","completed"].includes(s.status)?(w(),E(P,{key:1,icon:"mdi-truck-delivery",size:"small",variant:"text",color:"success",onClick:b=>m(s)},null,8,["onClick"])):$("",!0),h(s)?(w(),E(P,{key:2,icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:b=>k(s)},null,8,["onClick"])):$("",!0),e(Le,null,{activator:a(({props:b})=>[e(P,Te({icon:"mdi-dots-vertical",size:"small",variant:"text"},b),null,16)]),default:a(()=>[e(Ne,null,{default:a(()=>[s.status==="pending"?(w(),E(ce,{key:0,onClick:b=>X(s,"ordered")},{default:a(()=>[e(pe,null,{default:a(()=>l[26]||(l[26]=[p("Mark as Ordered")])),_:1,__:[26]})]),_:2},1032,["onClick"])):$("",!0),s.status==="ordered"?(w(),E(ce,{key:1,onClick:b=>X(s,"received")},{default:a(()=>[e(pe,null,{default:a(()=>l[27]||(l[27]=[p("Mark as Received")])),_:1,__:[27]})]),_:2},1032,["onClick"])):$("",!0),s.status==="received"?(w(),E(ce,{key:2,onClick:b=>X(s,"completed")},{default:a(()=>[e(pe,null,{default:a(()=>l[28]||(l[28]=[p("Mark as Completed")])),_:1,__:[28]})]),_:2},1032,["onClick"])):$("",!0),["pending","ordered"].includes(s.status)?(w(),E(ce,{key:3,onClick:b=>X(s,"cancelled")},{default:a(()=>[e(pe,{class:"text-error"},{default:a(()=>l[29]||(l[29]=[p("Cancel Purchase")])),_:1,__:[29]})]),_:2},1032,["onClick"])):$("",!0)]),_:2},1024)]),_:2},1024)])]),bottom:a(()=>[t("div",da,[e(Ee,{modelValue:U.value,"onUpdate:modelValue":l[6]||(l[6]=s=>U.value=s),length:Math.ceil(S.value/j.value),"total-visible":5},null,8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","items-length","loading"])]),_:1}),e(dt,{modelValue:B.value,"onUpdate:modelValue":l[9]||(l[9]=s=>B.value=s),purchase:c.value,mode:z.value,onSaved:de},null,8,["modelValue","purchase","mode"]),e(Xt,{modelValue:O.value,"onUpdate:modelValue":l[10]||(l[10]=s=>O.value=s),purchase:c.value},null,8,["modelValue","purchase"]),e(bt,{modelValue:F.value,"onUpdate:modelValue":l[11]||(l[11]=s=>F.value=s),purchase:c.value,onSuccess:r.onReceiveSuccess},null,8,["modelValue","purchase","onSuccess"]),e(he,{modelValue:_.value,"onUpdate:modelValue":l[13]||(l[13]=s=>_.value=s),"max-width":"500"},{default:a(()=>[e(T,null,{default:a(()=>[e(J,{class:"text-h5 d-flex align-center"},{default:a(()=>[e(Q,{color:"error",class:"me-2"},{default:a(()=>l[30]||(l[30]=[p("mdi-delete-alert")])),_:1,__:[30]}),l[31]||(l[31]=p(" Konfirmasi Hapus Purchase "))]),_:1,__:[31]}),e(A,null,{default:a(()=>{var s;return[e(He,{type:"warning",variant:"tonal",class:"mb-4"},{default:a(()=>[e(Qe,null,{default:a(()=>l[32]||(l[32]=[p("Peringatan!")])),_:1,__:[32]}),l[33]||(l[33]=p(" Tindakan ini tidak dapat dibatalkan. Purchase yang sudah dihapus tidak dapat dikembalikan. "))]),_:1,__:[33]}),l[40]||(l[40]=t("p",{class:"text-body-1"}," Apakah Anda yakin ingin menghapus purchase berikut? ",-1)),o.value?(w(),R("div",ca,[t("div",pa,[l[34]||(l[34]=t("span",{class:"font-weight-medium"},"Purchase Number:",-1)),t("span",null,i(o.value.purchase_number),1)]),t("div",ma,[l[35]||(l[35]=t("span",{class:"font-weight-medium"},"Supplier:",-1)),t("span",null,i((s=o.value.supplier)==null?void 0:s.name),1)]),t("div",va,[l[36]||(l[36]=t("span",{class:"font-weight-medium"},"Total Item:",-1)),t("span",null,i(u(o.value))+" item",1)]),t("div",fa,[l[37]||(l[37]=t("span",{class:"font-weight-medium"},"Total Harga:",-1)),t("span",null,i(ne(o.value.total_amount)),1)]),t("div",_a,[l[38]||(l[38]=t("span",{class:"font-weight-medium"},"Status:",-1)),e(le,{color:n(o.value.status),size:"small"},{default:a(()=>[p(i(d(o.value.status)),1)]),_:1},8,["color"])]),e(ve,{class:"my-3"}),l[39]||(l[39]=t("div",{class:"text-caption text-medium-emphasis mb-2"},"Detail Items:",-1)),t("div",ga,[(w(!0),R(ke,null,we(o.value.items,b=>{var C;return w(),R("div",{key:b.id_purchase_item,class:"d-flex justify-space-between text-caption mb-1"},[t("span",null,i(((C=b.item)==null?void 0:C.name)||"Unknown Item"),1),t("span",null,i(b.quantity_ordered)+" x "+i(ne(b.unit_cost)),1)])}),128))])])):$("",!0)]}),_:1,__:[40]}),e(be,null,{default:a(()=>[e(Ve),e(P,{color:"grey",variant:"text",onClick:l[12]||(l[12]=s=>_.value=!1)},{default:a(()=>l[41]||(l[41]=[p(" Batal ")])),_:1,__:[41]}),e(P,{color:"error",variant:"flat",loading:V.value,onClick:H},{default:a(()=>[e(Q,{start:""},{default:a(()=>l[42]||(l[42]=[p("mdi-delete")])),_:1,__:[42]}),l[43]||(l[43]=p(" Hapus Purchase "))]),_:1,__:[43]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ke,{modelValue:D.value.show,"onUpdate:modelValue":l[14]||(l[14]=s=>D.value.show=s),color:D.value.color,timeout:4e3,location:"top right"},{default:a(()=>[p(i(D.value.message),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),Xa=xe(ya,[["__scopeId","data-v-970c5dae"]]);export{Xa as default};
