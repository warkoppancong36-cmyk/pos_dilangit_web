import{au as o,a5 as I}from"./main-CJg0EYCp.js";const a="/api/pos";class R{static async getStats(){var t;try{return(await o.get(`${a}/stats`)).data}catch(r){throw((t=r.response)==null?void 0:t.data)||this.handleError(r)}}static async getProducts(t){var r;try{return(await o.get(`${a}/products`,{params:t})).data}catch(e){throw((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async getActiveOrders(t){var r;try{return(await o.get(`${a}/orders`,{params:t})).data}catch(e){throw((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async createOrder(t){var r;try{return(await o.post(`${a}/orders`,t)).data}catch(e){throw((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async getOrder(t){var r;try{return(await o.get(`${a}/orders/${t}`)).data}catch(e){throw((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async updateOrderStatus(t,r){var e;try{return(await o.put(`${a}/orders/${t}/status`,r)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static async editOrder(t,r){var e;try{return(await o.put(`${a}/orders/${t}`,r)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static async cancelOrder(t){var r;try{return(await o.post(`${a}/orders/${t}/cancel`)).data}catch(e){throw((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async addItem(t,r){var e;try{return(await o.post(`${a}/orders/${t}/items`,r)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static async updateItem(t,r,e){var s;try{return(await o.put(`${a}/orders/${t}/items/${r}`,e)).data}catch(i){throw((s=i.response)==null?void 0:s.data)||this.handleError(i)}}static async removeItem(t,r){var e;try{return(await o.delete(`${a}/orders/${t}/items/${r}`)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static async applyDiscount(t,r){var e;try{return(await o.post(`${a}/orders/${t}/discount`,r)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static async applyTax(t,r){var e;try{return(await o.post(`${a}/orders/${t}/tax`,r)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static async processPayment(t,r){var e;try{return(await o.post(`${a}/orders/${t}/payment`,r)).data}catch(s){throw((e=s.response)==null?void 0:e.data)||this.handleError(s)}}static formatError(t){return t.errors?Object.values(t.errors).flat().join(", "):t.message||"An unexpected error occurred"}static async getOrders(t){var r;try{return(await o.get(`${a}/orders/history`,{params:t})).data}catch(e){throw((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async getCategories(){var t;try{return(await o.get(`${a}/orders/categories`)).data}catch(r){throw((t=r.response)==null?void 0:t.data)||this.handleError(r)}}static async getAllOrdersForExport(t){var r;try{const e={per_page:"all",page:1};return t!=null&&t.search&&(e.search=t.search),t!=null&&t.status&&(e.status=t.status),t!=null&&t.category_id&&(e.category_id=t.category_id),t!=null&&t.payment_status&&(e.payment_status=t.payment_status),e.date_from=(t==null?void 0:t.start_date)||"",e.date_to=(t==null?void 0:t.end_date)||"",console.log("ðŸ” Export API parameters sent to backend:",e),console.log("ðŸ” Original params received:",t),(await o.get(`${a}/orders/history`,{params:e})).data.data||[]}catch(e){throw console.error("Get all orders error:",e),((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static async exportOrdersToExcel(t){var r,e,s,i,u,p,y;try{console.log("ðŸš€ Starting POS export to Excel...");const d=await this.getAllOrdersForExport(t);console.log("ðŸ“Š Exporting",d.length,"orders to Excel");const g=await I(()=>import("./xlsx-CfQreh1U.js"),[]),E=d.length,f=d.reduce((n,c)=>n+(parseFloat(c.total_amount)||0),0),L=d.filter(n=>n.payment_status==="paid").length,S=d.filter(n=>n.payment_status==="unpaid"||n.payment_status==="pending").length,x=[];for(let n=0;n<d.length;n++){const c=d[n],l=c.order_items||c.orderItems||[],A=l.map($=>{var D;return`${$.quantity}x ${((D=$.product)==null?void 0:D.name)||$.product_name||""}`}).join(", ");x.push({No:n+1,"ID Order":c.id,Tanggal:c.created_at?new Date(c.created_at).toLocaleDateString("id-ID"):"-",Waktu:c.created_at?new Date(c.created_at).toLocaleTimeString("id-ID"):"-",Customer:((r=c.customer)==null?void 0:r.name)||"Walk-in Customer",Kategori:((i=(s=(e=l==null?void 0:l[0])==null?void 0:e.product)==null?void 0:s.category)==null?void 0:i.name)||"-","List Barang":A,"Total Amount":parseFloat(c.total_amount)||0,"Status Pembayaran":c.payment_status==="paid"?"Lunas":c.payment_status==="pending"?"Pending":"Belum Lunas","Metode Pembayaran":((p=(u=c.payments)==null?void 0:u[0])==null?void 0:p.payment_method)||"-","Jumlah Item":(l==null?void 0:l.length)||0,Catatan:c.notes||"-"})}const O=g.utils.book_new(),h=[];if(t!=null&&t.search&&h.push(`Pencarian: "${t.search}"`),t!=null&&t.category_id&&h.push(`Kategori: ID ${t.category_id}`),t!=null&&t.payment_status&&t.payment_status!=="all"){const n={paid:"Lunas",unpaid:"Belum Lunas",pending:"Pending"};h.push(`Status Pembayaran: ${n[t.payment_status]||t.payment_status}`)}if(t!=null&&t.start_date||t!=null&&t.end_date){const n=[];t.start_date&&n.push(`Dari: ${t.start_date}`),t.end_date&&n.push(`Sampai: ${t.end_date}`),h.push(`Periode: ${n.join(" ")}`)}const k=[["LAPORAN RIWAYAT TRANSAKSI POS"],["Tanggal Export:",new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})],["Total Transaksi:",E],["Total Amount:",`Rp ${f.toLocaleString("id-ID")}`],["Transaksi Lunas:",L],["Transaksi Belum Lunas:",S],["Filter Diterapkan:",h.length>0?h.join(", "):"Semua Data"],[]],w=g.utils.aoa_to_sheet(k);g.utils.sheet_add_json(w,x,{origin:"A9"});const P=[{wch:5},{wch:10},{wch:12},{wch:10},{wch:20},{wch:15},{wch:30},{wch:15},{wch:15},{wch:15},{wch:10},{wch:20}];w["!cols"]=P,g.utils.book_append_sheet(O,w,"Transaction History");const _=`pos-riwayat-transaksi-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.xlsx`;return g.writeFile(O,_),console.log("âœ… Excel file generated successfully:",_),{success:!0,filename:_,totalRecords:E,totalAmount:f}}catch(d){throw console.error("Export to Excel error:",d),((y=d.response)==null?void 0:y.data)||this.handleError(d)}}static async exportOrders(t){var r;try{const e=await o.get(`${a}/orders/export`,{params:t,responseType:"blob"}),s=window.URL.createObjectURL(new Blob([e.data])),i=document.createElement("a");i.href=s;const u=e.headers["content-disposition"];let p="riwayat-transaksi.xlsx";if(u){const y=u.match(/filename="?(.+)"?/);y&&(p=y[1])}i.setAttribute("download",p),document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(s)}catch(e){throw console.error("Export error:",e),((r=e.response)==null?void 0:r.data)||this.handleError(e)}}static handleError(t){var r,e;return t.response?{success:!1,message:((r=t.response.data)==null?void 0:r.message)||"Server error occurred",errors:(e=t.response.data)==null?void 0:e.errors}:t.request?{success:!1,message:"Network error occurred"}:{success:!1,message:t.message||"An unexpected error occurred"}}}export{R as P};
