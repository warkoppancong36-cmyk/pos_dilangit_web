import{g as K}from"./auth-a9M5ekjn.js";import{d as ve,V as W,r as w,w as ce,D as we,g as R,o as V,f as t,b as e,e as a,X as H,s as _,t as r,a0 as S,ap as Ce,aq as $e,c as M,l as C,i as ke,p as xe,F as Ie,av as Q,b8 as he,v as be}from"./main-BDjA8ZE0.js";import{V as fe}from"./VDialog-kKqt15qI.js";import{b as X,V as $,c as _e}from"./VCard-Af9i-cHC.js";import{V as U}from"./VCardText-pusdEz6_.js";import{V as qe}from"./VForm-D-6FADkt.js";import{V as Y,a as I}from"./VRow-B_tm1uSD.js";import{V as pe}from"./VSelect-CqUH4kv5.js";import{a as oe,b as ne,d as Ve,V as Se}from"./VList-BUBOvLR6.js";import{V as G}from"./VTextField-BQMuFhOa.js";import{V as Pe}from"./VTextarea-BZXiLEZc.js";import{V as De}from"./VTable-CQyojuSP.js";import{V as Te}from"./VAutocomplete-X1kKS8Y9.js";import{V as me}from"./VDivider-CNJRCtTw.js";import{V as ge}from"./VSpacer-P6zft6lJ.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ee}from"./VChip-DmPw7oBU.js";import{V as ze,a as Ue}from"./VDataTable-BxIs7bLB.js";import{V as je}from"./VContainer-DGv6bNpU.js";import{V as Ae}from"./VDataTableServer-Di72ajGe.js";import{V as Ne}from"./VMenu-BN6MK1Ni.js";import{V as Re}from"./VSnackbar-CrTM_ZJk.js";import"./VOverlay-DpeqFwNJ.js";import"./forwardRefs-B931MWyl.js";import"./VImg-DavVY8Sw.js";import"./VAvatar-BJUFvcQH.js";/* empty css              */import"./VCheckboxBtn-Ml9VaORK.js";import"./filter-BTEElEgT.js";const Be={class:"d-flex align-center gap-2"},Fe={class:"mt-6"},Oe={class:"d-flex justify-space-between align-center mb-4"},Ee={key:0},Me={class:"font-weight-medium"},Le={class:"text-end"},Qe={class:"d-flex justify-space-between mb-2"},Ke={class:"font-weight-medium"},He={class:"d-flex justify-space-between mb-2"},Ge={class:"text-success"},Xe={class:"d-flex justify-space-between"},Je={class:"text-h6 font-weight-bold text-primary"},We=ve({__name:"PurchaseDialog",props:{modelValue:{type:Boolean},purchase:{default:null},mode:{default:"create"}},emits:["update:modelValue","saved"],setup(te,{emit:J}){const v=te,B=J,z=W({get:()=>v.modelValue,set:d=>B("update:modelValue",d)}),P=w(),T=w(!1),x=w(!1),k=w(!1),j=w(!1),F=w([]),A=w([]),g=w({id_supplier:null,purchase_date:new Date().toISOString().split("T")[0],notes:"",discount_amount:0,discount_amount_display:"0",items:[]}),c=W(()=>v.mode==="edit"?"Edit Purchase Order":"Buat Purchase Order Baru"),s=W(()=>{const d=g.value.items.reduce((l,o)=>l+(o.total_cost||0),0),i=Number.parseFloat(g.value.discount_amount_display.replace(/\D/g,""))||0,f=0,n=d-i+f;return{subtotal:d,discount:i,tax:f,total:n}}),b=W(()=>T.value&&g.value.items.length>0&&g.value.items.every(d=>d.id_item&&d.quantity>0&&d.unit_cost>0)),N={required:d=>!!d||"Field ini wajib diisi"},D=async()=>{try{k.value=!0;const d=K(),i={"Content-Type":"application/json",Accept:"application/json"};d&&(i.Authorization=`Bearer ${d}`);const f=await Q.get("/api/suppliers",{headers:i});F.value=f.data.data||[],console.log("📋 Suppliers loaded:",F.value.length,"suppliers")}catch(d){console.error("Error loading suppliers:",d)}finally{k.value=!1}},O=async()=>{var d;try{j.value=!0;const i=K();console.log("Loading items with token:",i?"Token found":"No token");const f={"Content-Type":"application/json",Accept:"application/json"};i&&(f.Authorization=`Bearer ${i}`),console.log("Making request to /api/items");const n=await Q.get("/api/items",{headers:f});console.log("Items response:",n.data);const l=n.data.data;l&&l.data?A.value=l.data||[]:A.value=n.data.data||[],console.log("Items loaded:",A.value.length,"items")}catch(i){console.error("Error loading items:",i),console.error("Error response:",(d=i.response)==null?void 0:d.data)}finally{j.value=!1}},E=d=>{try{const i=g.value.items[d];if(!i){console.warn("Item not found at index:",d);return}i.total_cost=(i.quantity||0)*(i.unit_cost||0),console.log(`Item ${d} total calculated:`,i.total_cost)}catch(i){console.error("Error in calculateItemTotal:",i)}},ie=()=>{try{console.log("Adding new item..."),console.log("Current items count:",g.value.items.length);const d={id_item:null,quantity:0,unit_cost:0,unit_cost_display:"0",total_cost:0};g.value.items.push(d),console.log("Item added successfully. New count:",g.value.items.length)}catch(d){console.error("Error in addItem:",d)}},re=d=>{g.value.items.splice(d,1)},ae=(d,i)=>{E(d)},le=(d,i)=>{var l;const f=(l=i.target)==null?void 0:l.value,n=g.value.items[d];f===""||f===null||f===void 0?n.quantity="":n.quantity=Number.parseInt(f)||1,E(d)},y=(d,i)=>{var o;const f=(o=i.target)==null?void 0:o.value,n=(f==null?void 0:f.replace(/\D/g,""))||"",l=g.value.items[d];n===""?(l.unit_cost=0,l.unit_cost_display="0"):(l.unit_cost=Number.parseInt(n),l.unit_cost_display=new Intl.NumberFormat("id-ID").format(l.unit_cost))},p=d=>{var n;const i=(n=d.target)==null?void 0:n.value,f=(i==null?void 0:i.replace(/\D/g,""))||"";f===""?g.value.discount_amount_display="0":g.value.discount_amount_display=new Intl.NumberFormat("id-ID").format(Number.parseInt(f))},u=()=>{},h=d=>Number.isNaN(d)||d===null||d===void 0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(d),L=()=>{var d,i,f,n;if(console.log("🔍 initializeForm called"),console.log("📝 Mode:",v.mode),console.log("💾 Purchase data:",v.purchase),v.mode==="edit"&&v.purchase){console.log("✅ Initializing form for edit mode"),console.log("� All purchase properties:",Object.keys(v.purchase)),console.log("�👤 Supplier ID from purchase:",v.purchase.id_supplier),console.log("� Supplier object from purchase:",v.purchase.supplier),console.log("👤 Supplier_id from purchase:",v.purchase.supplier_id),console.log("�📦 Items from purchase:",v.purchase.items);const l=v.purchase.supplier_id||v.purchase.id_supplier||((d=v.purchase.supplier)==null?void 0:d.id_supplier)||((i=v.purchase.supplier)==null?void 0:i.id);if(console.log("📦 Items from purchase:",v.purchase.items),v.purchase.items&&v.purchase.items.length>0){const m=v.purchase.items[0];console.log("� First item debug:",{quantity:m.quantity,quantity_ordered:m.quantity_ordered,unit_cost:m.unit_cost,total_cost:m.total_cost,item_id:((f=m.item)==null?void 0:f.id_item)||m.id_item})}console.log("🎯 Resolved supplier ID:",l),console.log("📅 Original purchase_date:",v.purchase.purchase_date),console.log("📅 Purchase_date type:",typeof v.purchase.purchase_date);const o=v.purchase.purchase_date?new Date(v.purchase.purchase_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0];console.log("📅 Formatted purchase_date:",o),g.value={id_supplier:l,purchase_date:o,notes:v.purchase.notes||"",discount_amount:v.purchase.discount_amount||0,discount_amount_display:new Intl.NumberFormat("id-ID").format(v.purchase.discount_amount||0),items:((n=v.purchase.items)==null?void 0:n.map(m=>{var q;return console.log("🔄 Mapping item:",m),console.log("📊 Item quantity_ordered:",m.quantity_ordered),console.log("📊 Item quantity:",m.quantity),{id_item:((q=m.item)==null?void 0:q.id_item)||m.id_item,quantity:Number.parseInt(m.quantity_ordered||m.quantity||0)||0,unit_cost:m.unit_cost,unit_cost_display:new Intl.NumberFormat("id-ID").format(m.unit_cost),total_cost:m.total_cost}}))||[]},console.log("📋 Form data after initialization:",g.value)}else console.log("🆕 Initializing form for create mode"),g.value={id_supplier:null,purchase_date:new Date().toISOString().split("T")[0],notes:"",discount_amount:0,discount_amount_display:"0",items:[]}},se=async()=>{var d,i,f;if((d=P.value)!=null&&d.validate())try{x.value=!0;const n=K(),l={"Content-Type":"application/json",Accept:"application/json"};n&&(l.Authorization=`Bearer ${n}`);const o={supplier_id:g.value.id_supplier,purchase_date:g.value.purchase_date,notes:g.value.notes,discount_amount:Number.parseFloat(g.value.discount_amount_display.replace(/\D/g,""))||0,items:g.value.items.map(m=>({id_item:m.id_item,quantity:m.quantity,unit_cost:m.unit_cost}))};v.mode==="edit"?await Q.put(`/api/purchases/${v.purchase.id_purchase}`,o,{headers:l}):await Q.post("/api/purchases",o,{headers:l}),B("saved")}catch(n){console.error("Error saving purchase:",n),console.error("Error saving purchase:",((f=(i=n.response)==null?void 0:i.data)==null?void 0:f.message)||n.message)}finally{x.value=!1}},Z=()=>{z.value=!1};return ce(()=>v.modelValue,async d=>{d&&(await Promise.all([D(),O()]),await he(),L())}),ce(()=>v.purchase,async d=>{d&&v.mode==="edit"&&(F.value.length===0&&await D(),A.value.length===0&&await O(),await he(),L())},{deep:!0,immediate:!0}),we(()=>{D(),O()}),(d,i)=>(V(),R(fe,{modelValue:z.value,"onUpdate:modelValue":i[5]||(i[5]=f=>z.value=f),"max-width":"1200",persistent:""},{default:t(()=>[e($,null,{default:t(()=>[e(X,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",Be,[e(H,null,{default:t(()=>i[6]||(i[6]=[_("mdi-cart-plus")])),_:1,__:[6]}),a("span",null,r(c.value),1)]),e(S,{icon:"mdi-close",size:"small",variant:"text",onClick:Z})]),_:1}),e(U,null,{default:t(()=>[e(qe,{ref_key:"form",ref:P,modelValue:T.value,"onUpdate:modelValue":i[3]||(i[3]=f=>T.value=f)},{default:t(()=>[e(Y,null,{default:t(()=>[e(I,{cols:"12",md:"6"},{default:t(()=>[e(pe,{modelValue:g.value.id_supplier,"onUpdate:modelValue":i[0]||(i[0]=f=>g.value.id_supplier=f),label:"Supplier *",items:F.value,"item-title":"name","item-value":"id_supplier",variant:"outlined",rules:[N.required],loading:k.value},{item:t(({props:f,item:n})=>[e(oe,Ce($e(f)),{default:t(()=>[e(ne,null,{default:t(()=>[_(r(n.raw.name),1)]),_:2},1024),e(Ve,null,{default:t(()=>[_(r(n.raw.phone)+" - "+r(n.raw.email),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","rules","loading"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(G,{modelValue:g.value.purchase_date,"onUpdate:modelValue":i[1]||(i[1]=f=>g.value.purchase_date=f),label:"Tanggal Purchase *",type:"date",variant:"outlined",rules:[N.required]},null,8,["modelValue","rules"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(Pe,{modelValue:g.value.notes,"onUpdate:modelValue":i[2]||(i[2]=f=>g.value.notes=f),label:"Catatan",variant:"outlined",rows:"2",placeholder:"Catatan tambahan untuk purchase order ini..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a("div",Fe,[a("div",Oe,[i[9]||(i[9]=a("h3",{class:"text-h6"}," Items Purchase ",-1)),e(S,{color:"primary",variant:"tonal",onClick:ie},{default:t(()=>[e(H,{start:""},{default:t(()=>i[7]||(i[7]=[_(" mdi-plus ")])),_:1,__:[7]}),i[8]||(i[8]=_(" Tambah Item "))]),_:1,__:[8]})]),e($,{variant:"outlined"},{default:t(()=>[e(De,null,{default:t(()=>[i[11]||(i[11]=a("thead",null,[a("tr",null,[a("th",{style:{"inline-size":"45%"}}," Item "),a("th",{style:{"inline-size":"15%"}}," Quantity "),a("th",{style:{"inline-size":"15%"}}," Unit Cost "),a("th",{style:{"inline-size":"15%"}}," Total "),a("th",{style:{"inline-size":"10%"}}," Action ")])],-1)),a("tbody",null,[g.value.items.length===0?(V(),M("tr",Ee,i[10]||(i[10]=[a("td",{colspan:"6",class:"text-center py-8 text-medium-emphasis"},' Belum ada item. Klik "Tambah Item" untuk menambah item purchase. ',-1)]))):C("",!0),(V(!0),M(Ie,null,ke(g.value.items,(f,n)=>(V(),M("tr",{key:n},[a("td",null,[e(Te,{modelValue:f.id_item,"onUpdate:modelValue":[l=>f.id_item=l,l=>ae(n,l)],label:"Pilih Item",items:A.value,"item-title":"name","item-value":"id_item",variant:"outlined",density:"compact",loading:j.value,clearable:"","no-data-text":"Tidak ada item ditemukan"},{item:t(({props:l,item:o})=>[e(oe,xe({ref_for:!0},l),{default:t(()=>[e(ne,null,{default:t(()=>[_(r(o.raw.name),1)]),_:2},1024),e(Ve,null,{default:t(()=>{var m;return[_(r((m=o.raw.category)==null?void 0:m.name)+" - SKU: "+r(o.raw.sku),1)]}),_:2},1024)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","items","loading"])]),a("td",null,[e(G,{modelValue:f.quantity,"onUpdate:modelValue":l=>f.quantity=l,label:"Qty",type:"number",min:"1",step:"1",variant:"outlined",density:"compact",onInput:l=>le(n,l),onBlur:l=>E(n)},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur"])]),a("td",null,[e(G,{modelValue:f.unit_cost_display,"onUpdate:modelValue":l=>f.unit_cost_display=l,label:"Harga Satuan",variant:"outlined",density:"compact",prefix:"Rp",onInput:l=>y(n,l),onBlur:l=>E(n)},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur"])]),a("td",null,[a("span",Me,r(h(f.total_cost)),1)]),a("td",null,[e(S,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:l=>re(n)},null,8,["onClick"])])]))),128))])]),_:1,__:[11]})]),_:1}),e($,{class:"mt-4",variant:"outlined"},{default:t(()=>[e(U,null,{default:t(()=>[e(Y,null,{default:t(()=>[e(I,{cols:"12",md:"8"},{default:t(()=>[e(G,{modelValue:g.value.discount_amount_display,"onUpdate:modelValue":i[4]||(i[4]=f=>g.value.discount_amount_display=f),label:"Diskon",variant:"outlined",prefix:"Rp",placeholder:"0",onInput:p,onBlur:u},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[a("div",Le,[a("div",Qe,[i[12]||(i[12]=a("span",null,"Subtotal:",-1)),a("span",Ke,r(h(s.value.subtotal)),1)]),a("div",He,[i[13]||(i[13]=a("span",null,"Diskon:",-1)),a("span",Ge,"-"+r(h(s.value.discount)),1)]),e(me,{class:"my-2"}),a("div",Xe,[i[14]||(i[14]=a("span",{class:"text-h6 font-weight-bold"},"Total:",-1)),a("span",Je,r(h(s.value.total)),1)])])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),e(_e,{class:"pa-4"},{default:t(()=>[e(ge),e(S,{variant:"text",onClick:Z},{default:t(()=>i[15]||(i[15]=[_(" Batal ")])),_:1,__:[15]}),e(S,{color:"primary",loading:x.value,disabled:!b.value,onClick:se},{default:t(()=>[_(r(d.mode==="edit"?"Update":"Simpan"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ye=ye(We,[["__scopeId","data-v-5161bb8d"]]),Ze={class:"d-flex align-center gap-3"},et={class:"d-flex justify-space-between align-center"},tt={class:"text-h6"},at={class:"text-body-1"},lt={class:"font-weight-medium"},st={class:"text-caption text-medium-emphasis"},ot={class:"font-weight-medium"},nt={class:"d-flex justify-space-between"},it={class:"font-weight-medium"},rt=ve({__name:"PurchaseReceiveDialog",props:{modelValue:{type:Boolean},purchase:{}},emits:["update:modelValue","success"],setup(te,{emit:J}){const v=te,B=J,z=w(!1),P=w(!1),T=w(new Date().toISOString().split("T")[0]),x=w([]),k=W({get:()=>v.modelValue,set:y=>B("update:modelValue",y)}),j=W(()=>T.value&&s()>0&&!P.value),F=[{title:"Item",key:"item_name",sortable:!1,width:"250px"},{title:"Ordered",key:"quantity_ordered",sortable:!1,width:"110px"},{title:"Received",key:"quantity_received",sortable:!1,width:"110px"},{title:"Remaining",key:"remaining",sortable:!1,width:"110px"},{title:"Receive Qty",key:"receive_quantity",sortable:!1,width:"140px"},{title:"Quality",key:"quality_check",sortable:!1,width:"140px"},{title:"Notes",key:"notes",sortable:!1,width:"200px"},{title:"Status",key:"status",sortable:!1,width:"120px"}],A=[{title:"✅ Good",value:"good"},{title:"❌ Damaged",value:"damaged"},{title:"⏰ Expired",value:"expired"},{title:"⚠️ Issues",value:"partial"}],g=y=>y.quantity_ordered-(y.quantity_received||0),c=y=>{const p=g(y);return p<=0?"text-success":p<y.quantity_ordered*.5?"text-warning":""},s=()=>x.value.filter(y=>y.receive_quantity&&y.receive_quantity>0).length,b=y=>{const p=g(y);y.receive_quantity>p&&(y.receive_quantity=p),y.receive_quantity<0&&(y.receive_quantity=0)},N=y=>({pending:"warning",ordered:"info",partial:"primary",received:"success",completed:"success",cancelled:"error"})[y]||"default",D=y=>({pending:"Pending",ordered:"Ordered",partial:"Partial",received:"Received",completed:"Completed",cancelled:"Cancelled"})[y]||y,O=y=>({pending:"warning",partial:"primary",received:"success"})[y]||"default",E=y=>({pending:"Pending",partial:"Partial",received:"Complete"})[y]||y,ie=y=>new Date(y).toLocaleDateString("id-ID"),re=async()=>{var y,p;if((y=v.purchase)!=null&&y.id_purchase){z.value=!0;try{if(console.log("Purchase props:",v.purchase),v.purchase.items&&v.purchase.items.length>0){console.log("Using items from props:",v.purchase.items),x.value=v.purchase.items.map(h=>({...h,receive_quantity:0,quality_condition:"good",receive_notes:""})),z.value=!1;return}console.log("Fetching items from API...");const u=await Q.get(`/api/purchases/${v.purchase.id_purchase}`,{headers:{Authorization:`Bearer ${K()}`}});console.log("API Response:",u.data),u.data.success&&((p=u.data.data)!=null&&p.items)&&(console.log("Using items from API data.data:",u.data.data.items),x.value=u.data.data.items.map(h=>({...h,receive_quantity:0,quality_condition:"good",receive_notes:""})))}catch(u){console.error("Error loading purchase items:",u)}finally{z.value=!1}}},ae=async()=>{if(!j.value)return;const y=x.value.filter(p=>p.receive_quantity&&p.receive_quantity>0).map(p=>({id_purchase_item:p.id_purchase_item,quantity_received:p.receive_quantity,quality_check:{condition:p.quality_condition,checked_at:new Date().toISOString(),checked_by:"current_user"},notes:p.receive_notes||null}));if(y.length!==0){P.value=!0;try{const p=await Q.post(`/api/purchases/${v.purchase.id_purchase}/receive`,{items:y,delivery_date:T.value},{headers:{Authorization:`Bearer ${K()}`}});p.data.success&&(B("success",p.data),le())}catch(p){console.error("Error receiving items:",p)}finally{P.value=!1}}},le=()=>{k.value=!1,x.value=[],T.value=new Date().toISOString().split("T")[0]};return ce(k,y=>{y&&v.purchase&&re()}),(y,p)=>(V(),R(fe,{modelValue:k.value,"onUpdate:modelValue":p[1]||(p[1]=u=>k.value=u),"max-width":"1400px",persistent:""},{default:t(()=>[e($,null,{default:t(()=>[e(X,{class:"pa-4"},{default:t(()=>{var u;return[a("div",Ze,[e(H,{icon:"mdi-package-variant"}),a("span",null,"Receive Items - Purchase #"+r((u=y.purchase)==null?void 0:u.purchase_number),1)])]}),_:1}),e(me),e(U,{class:"pa-4"},{default:t(()=>[e($,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(U,{class:"pa-3"},{default:t(()=>{var u,h,L,se;return[a("div",et,[a("div",null,[p[2]||(p[2]=a("div",{class:"text-body-2 text-medium-emphasis"}," Supplier ",-1)),a("div",tt,r((h=(u=y.purchase)==null?void 0:u.supplier)==null?void 0:h.name),1)]),a("div",null,[p[3]||(p[3]=a("div",{class:"text-body-2 text-medium-emphasis"}," Order Date ",-1)),a("div",at,r(ie((L=y.purchase)==null?void 0:L.purchase_date)),1)]),a("div",null,[p[4]||(p[4]=a("div",{class:"text-body-2 text-medium-emphasis"}," Status ",-1)),e(ee,{color:N((se=y.purchase)==null?void 0:se.status),variant:"tonal",size:"small"},{default:t(()=>{var Z;return[_(r(D((Z=y.purchase)==null?void 0:Z.status)),1)]}),_:1},8,["color"])])])]}),_:1})]),_:1}),e(Y,{class:"mb-4"},{default:t(()=>[e(I,{cols:"12",md:"6"},{default:t(()=>[e(G,{modelValue:T.value,"onUpdate:modelValue":p[0]||(p[0]=u=>T.value=u),label:"Delivery Date",type:"date",variant:"outlined",rules:[u=>!!u||"Delivery date is required"],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),p[7]||(p[7]=a("div",{class:"text-h6 mb-3"}," Items to Receive ",-1)),e(ze,{headers:F,items:x.value,loading:z.value,"item-key":"id_purchase_item",class:"border rounded",density:"compact"},{"item.item_name":t(({item:u})=>{var h,L;return[a("div",null,[a("div",lt,r((h=u.item)==null?void 0:h.name),1),a("div",st,r((L=u.item)==null?void 0:L.item_code),1)])]}),"item.quantity_ordered":t(({item:u})=>{var h;return[a("span",ot,r(parseInt(u.quantity_ordered))+" "+r((h=u.item)==null?void 0:h.unit),1)]}),"item.quantity_received":t(({item:u})=>{var h;return[a("span",{class:be(u.quantity_received>0?"text-success":"")},r(u.quantity_received||0)+" "+r((h=u.item)==null?void 0:h.unit),3)]}),"item.remaining":t(({item:u})=>{var h;return[a("span",{class:be(["font-weight-medium",c(u)])},r(g(u))+" "+r((h=u.item)==null?void 0:h.unit),3)]}),"item.receive_quantity":t(({item:u})=>[e(G,{modelValue:u.receive_quantity,"onUpdate:modelValue":h=>u.receive_quantity=h,modelModifiers:{number:!0},type:"number",min:0,max:g(u),step:"0.001",density:"compact",variant:"outlined",style:{"inline-size":"140px"},disabled:g(u)<=0,onInput:h=>b(u)},null,8,["modelValue","onUpdate:modelValue","max","disabled","onInput"])]),"item.quality_check":t(({item:u})=>[e(pe,{modelValue:u.quality_condition,"onUpdate:modelValue":h=>u.quality_condition=h,items:A,density:"compact",variant:"outlined",style:{"inline-size":"140px"},disabled:!u.receive_quantity||u.receive_quantity<=0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.notes":t(({item:u})=>[e(G,{modelValue:u.receive_notes,"onUpdate:modelValue":h=>u.receive_notes=h,placeholder:"Notes...",density:"compact",variant:"outlined",style:{"inline-size":"200px"},disabled:!u.receive_quantity||u.receive_quantity<=0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.status":t(({item:u})=>[e(ee,{color:O(u.status),variant:"tonal",size:"small"},{default:t(()=>[_(r(E(u.status)),1)]),_:2},1032,["color"])]),_:1},8,["items","loading"]),e($,{variant:"outlined",class:"mt-4"},{default:t(()=>[e(U,{class:"pa-3"},{default:t(()=>[p[6]||(p[6]=a("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Receive Summary ",-1)),a("div",nt,[p[5]||(p[5]=a("span",null,"Items to receive:",-1)),a("span",it,r(s()),1)])]),_:1,__:[6]})]),_:1})]),_:1,__:[7]}),e(me),e(_e,{class:"pa-4"},{default:t(()=>[e(ge),e(S,{variant:"outlined",disabled:P.value,onClick:le},{default:t(()=>p[8]||(p[8]=[_(" Cancel ")])),_:1,__:[8]},8,["disabled"]),e(S,{color:"primary",loading:P.value,disabled:!j.value,onClick:ae},{default:t(()=>[e(H,{start:"",icon:"mdi-check"}),p[9]||(p[9]=_(" Confirm Receipt "))]),_:1,__:[9]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ut={class:"d-flex align-center gap-2"},dt={class:"mb-2"},ct={class:"text-primary font-weight-medium"},pt={class:"mb-2"},mt={class:"mb-2"},vt={key:0,class:"mb-2"},ft={key:1},_t={class:"mb-2"},gt={class:"mb-2"},yt={class:"mb-2"},ht={class:"mb-1 font-weight-medium"},bt={key:0,class:"text-caption text-medium-emphasis mb-0"},Vt={key:1,class:"text-caption text-medium-emphasis mb-0"},wt={class:"text-center"},kt={key:0},xt={class:"text-right font-weight-medium"},It={class:"text-right font-weight-medium"},Dt={class:"text-center"},Ct={class:"mb-0"},$t={class:"mb-2"},qt={key:0},St={class:"d-flex justify-space-between mb-2"},Pt={class:"font-weight-medium"},Tt={key:0,class:"d-flex justify-space-between mb-2"},zt={class:"text-success"},Ut={class:"d-flex justify-space-between mb-2"},jt={class:"d-flex justify-space-between"},At={class:"text-h6 font-weight-bold text-primary"},Nt=ve({__name:"PurchaseViewDialog",props:{modelValue:{type:Boolean},purchase:{default:null}},emits:["update:modelValue"],setup(te,{emit:J}){const v=te,B=J,z=W({get:()=>v.modelValue,set:c=>B("update:modelValue",c)}),P=W(()=>v.purchase&&v.purchase.status!=="cancelled"),T=()=>{z.value=!1},x=c=>{const s=typeof c=="string"?parseFloat(c):c;return isNaN(s)||s===null||s===void 0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)},k=c=>c?new Date(c).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"}):"-",j=c=>c?new Date(c).toLocaleString("id-ID",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",F=c=>({pending:"warning",partial:"info",received:"success",cancelled:"error"})[c]||"default",A=c=>({pending:"Pending",partial:"Sebagian",received:"Diterima",cancelled:"Dibatalkan"})[c]||c,g=()=>{window.print()};return(c,s)=>(V(),R(fe,{modelValue:z.value,"onUpdate:modelValue":s[0]||(s[0]=b=>z.value=b),"max-width":"900",persistent:""},{default:t(()=>[e($,null,{default:t(()=>[e(X,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a("div",ut,[e(H,null,{default:t(()=>s[1]||(s[1]=[_("mdi-file-document-outline")])),_:1,__:[1]}),s[2]||(s[2]=a("span",null,"Purchase Order Detail",-1))]),e(S,{icon:"mdi-close",size:"small",variant:"text",onClick:T})]),_:1}),c.purchase?(V(),R(U,{key:0},{default:t(()=>[e(Y,{class:"mb-6"},{default:t(()=>[e(I,{cols:"12",md:"6"},{default:t(()=>[e($,{variant:"outlined"},{default:t(()=>[e(X,{class:"text-subtitle-1"},{default:t(()=>s[3]||(s[3]=[_("Purchase Information")])),_:1,__:[3]}),e(U,null,{default:t(()=>[a("div",dt,[s[4]||(s[4]=a("strong",null,"Purchase Number:",-1)),s[5]||(s[5]=a("br",null,null,-1)),a("span",ct,r(c.purchase.purchase_number),1)]),a("div",pt,[s[6]||(s[6]=a("strong",null,"Status:",-1)),s[7]||(s[7]=a("br",null,null,-1)),e(ee,{color:F(c.purchase.status),size:"small",variant:"elevated"},{default:t(()=>[_(r(A(c.purchase.status)),1)]),_:1},8,["color"])]),a("div",mt,[s[8]||(s[8]=a("strong",null,"Tanggal Purchase:",-1)),s[9]||(s[9]=a("br",null,null,-1)),_(" "+r(k(c.purchase.purchase_date)),1)]),c.purchase.expected_delivery_date?(V(),M("div",vt,[s[10]||(s[10]=a("strong",null,"Tanggal Kirim Diharapkan:",-1)),s[11]||(s[11]=a("br",null,null,-1)),_(" "+r(k(c.purchase.expected_delivery_date)),1)])):C("",!0),c.purchase.actual_delivery_date?(V(),M("div",ft,[s[12]||(s[12]=a("strong",null,"Tanggal Kirim Aktual:",-1)),s[13]||(s[13]=a("br",null,null,-1)),_(" "+r(k(c.purchase.actual_delivery_date)),1)])):C("",!0)]),_:1})]),_:1})]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[e($,{variant:"outlined"},{default:t(()=>[e(X,{class:"text-subtitle-1"},{default:t(()=>s[14]||(s[14]=[_("Supplier Information")])),_:1,__:[14]}),e(U,null,{default:t(()=>{var b,N,D,O;return[a("div",_t,[s[15]||(s[15]=a("strong",null,"Nama Supplier:",-1)),s[16]||(s[16]=a("br",null,null,-1)),_(" "+r(((b=c.purchase.supplier)==null?void 0:b.name)||"-"),1)]),a("div",gt,[s[17]||(s[17]=a("strong",null,"Telepon:",-1)),s[18]||(s[18]=a("br",null,null,-1)),_(" "+r(((N=c.purchase.supplier)==null?void 0:N.phone)||"-"),1)]),a("div",yt,[s[19]||(s[19]=a("strong",null,"Email:",-1)),s[20]||(s[20]=a("br",null,null,-1)),_(" "+r(((D=c.purchase.supplier)==null?void 0:D.email)||"-"),1)]),a("div",null,[s[21]||(s[21]=a("strong",null,"Alamat:",-1)),s[22]||(s[22]=a("br",null,null,-1)),_(" "+r(((O=c.purchase.supplier)==null?void 0:O.address)||"-"),1)])]}),_:1})]),_:1})]),_:1})]),_:1}),e($,{variant:"outlined",class:"mb-6"},{default:t(()=>[e(X,{class:"text-subtitle-1"},{default:t(()=>s[23]||(s[23]=[_("Items Purchase")])),_:1,__:[23]}),e(De,null,{default:t(()=>[s[24]||(s[24]=a("thead",null,[a("tr",null,[a("th",null,"Item"),a("th",{class:"text-center"},"Qty"),a("th",{class:"text-right"},"Unit Cost"),a("th",{class:"text-right"},"Total Cost"),a("th",{class:"text-center"},"Status")])],-1)),a("tbody",null,[(V(!0),M(Ie,null,ke(c.purchase.items,b=>{var N,D,O;return V(),M("tr",{key:b.id_purchase_item},[a("td",null,[a("div",null,[a("p",ht,r(((N=b.item)==null?void 0:N.name)||"-"),1),(D=b.item)!=null&&D.code?(V(),M("p",bt," Code: "+r(b.item.code),1)):C("",!0),(O=b.item)!=null&&O.description?(V(),M("p",Vt,r(b.item.description),1)):C("",!0)])]),a("td",wt,[e(ee,{size:"small",variant:"outlined"},{default:t(()=>[_(r(parseInt(b.quantity_ordered))+" "+r(b.unit||"pcs"),1)]),_:2},1024),b.quantity_received>0?(V(),M("br",kt)):C("",!0),b.quantity_received>0?(V(),R(ee,{key:1,size:"x-small",variant:"tonal",color:"success",class:"mt-1"},{default:t(()=>[_(" Received: "+r(parseInt(b.quantity_received)),1)]),_:2},1024)):C("",!0)]),a("td",xt,r(x(b.unit_cost)),1),a("td",It,r(x(b.total_cost)),1),a("td",Dt,[e(ee,{color:F(b.status),size:"small",variant:"tonal"},{default:t(()=>[_(r(A(b.status)),1)]),_:2},1032,["color"])])])}),128))])]),_:1,__:[24]})]),_:1}),e(Y,null,{default:t(()=>[e(I,{cols:"12",md:"6"},{default:t(()=>[c.purchase.notes?(V(),R($,{key:0,variant:"outlined"},{default:t(()=>[e(X,{class:"text-subtitle-1"},{default:t(()=>s[25]||(s[25]=[_("Catatan")])),_:1,__:[25]}),e(U,null,{default:t(()=>[a("p",Ct,r(c.purchase.notes),1)]),_:1})]),_:1})):C("",!0),e($,{variant:"outlined",class:"mt-4"},{default:t(()=>[e(X,{class:"text-subtitle-1"},{default:t(()=>s[26]||(s[26]=[_("Purchase History")])),_:1,__:[26]}),e(U,null,{default:t(()=>{var b,N;return[a("div",$t,[s[27]||(s[27]=a("strong",null,"Dibuat oleh:",-1)),s[28]||(s[28]=a("br",null,null,-1)),_(" "+r(((b=c.purchase.creator)==null?void 0:b.name)||"-")+" • "+r(j(c.purchase.created_at)),1)]),c.purchase.updated_at&&c.purchase.updated_at!==c.purchase.created_at?(V(),M("div",qt,[s[29]||(s[29]=a("strong",null,"Diupdate oleh:",-1)),s[30]||(s[30]=a("br",null,null,-1)),_(" "+r(((N=c.purchase.updater)==null?void 0:N.name)||"-")+" • "+r(j(c.purchase.updated_at)),1)])):C("",!0)]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[e($,{variant:"outlined"},{default:t(()=>[e(X,{class:"text-subtitle-1"},{default:t(()=>s[31]||(s[31]=[_("Total Summary")])),_:1,__:[31]}),e(U,null,{default:t(()=>[a("div",St,[s[32]||(s[32]=a("span",null,"Subtotal:",-1)),a("span",Pt,r(x(c.purchase.subtotal)),1)]),c.purchase.discount_amount>0?(V(),M("div",Tt,[s[33]||(s[33]=a("span",null,"Diskon:",-1)),a("span",zt,"-"+r(x(c.purchase.discount_amount)),1)])):C("",!0),a("div",Ut,[s[34]||(s[34]=a("span",null,"PPN (11%):",-1)),a("span",null,r(x(c.purchase.tax_amount)),1)]),e(me,{class:"my-3"}),a("div",jt,[s[35]||(s[35]=a("span",{class:"text-h6 font-weight-bold"},"Total:",-1)),a("span",At,r(x(c.purchase.total_amount)),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):C("",!0),e(_e,{class:"pa-4"},{default:t(()=>[e(ge),e(S,{variant:"text",onClick:T},{default:t(()=>s[36]||(s[36]=[_(" Tutup ")])),_:1,__:[36]}),P.value?(V(),R(S,{key:0,color:"primary",variant:"tonal","prepend-icon":"mdi-printer",onClick:g},{default:t(()=>s[37]||(s[37]=[_(" Print ")])),_:1,__:[37]})):C("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Rt=ye(Nt,[["__scopeId","data-v-9531ec00"]]),Bt={class:"d-flex justify-space-between align-center"},Ft={class:"d-flex justify-space-between align-center"},Ot={class:"text-h4 font-weight-bold text-white"},Et={class:"d-flex justify-space-between align-center"},Mt={class:"text-h4 font-weight-bold text-white"},Lt={class:"d-flex justify-space-between align-center"},Qt={class:"text-h4 font-weight-bold text-white"},Kt={class:"d-flex justify-space-between align-center"},Ht={class:"text-h4 font-weight-bold text-white"},Gt={class:"d-flex align-center"},Xt={class:"mb-0 font-weight-medium"},Jt={class:"text-caption text-medium-emphasis mb-0"},Wt={class:"font-weight-medium"},Yt={class:"d-flex gap-1"},Zt={class:"d-flex justify-center pt-2"},ea=ve({__name:"purchases-management",setup(te){const J=w([]),v=w([]),B=w({}),z=w(!1),P=w(1),T=w(15),x=w(0),k=w({show:!1,message:"",color:"success"}),j=w(!1),F=w(!1),A=w(!1),g=w(null),c=w("create"),s=w({search:"",status:"",supplier_id:"",start_date:"",end_date:""}),b=[{title:"Purchase Number",key:"purchase_number",sortable:!0},{title:"Supplier",key:"supplier.name",sortable:!1},{title:"Tanggal",key:"purchase_date",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Total",key:"total_amount",sortable:!0},{title:"Actions",key:"actions",sortable:!1,width:"150px"}],N=[{label:"Semua Status",value:""},{label:"Pending",value:"pending"},{label:"Ordered",value:"ordered"},{label:"Received",value:"received"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}],D=async()=>{var n,l;try{z.value=!0;const o={page:P.value,per_page:T.value};Object.keys(s.value).forEach(de=>{s.value[de]&&s.value[de]!==""&&(o[de]=s.value[de])});const m=K(),q={"Content-Type":"application/json",Accept:"application/json"};m&&(q.Authorization=`Bearer ${m}`);const ue=await Q.get("/api/purchases",{params:o,headers:q});J.value=ue.data.data.data||[],x.value=ue.data.data.total||0}catch(o){console.error("Error loading purchases:",o),k.value={show:!0,message:"Error loading purchases: "+(((l=(n=o.response)==null?void 0:n.data)==null?void 0:l.message)||o.message),color:"error"}}finally{z.value=!1}},O=async()=>{try{const n=K(),l={"Content-Type":"application/json",Accept:"application/json"};n&&(l.Authorization=`Bearer ${n}`);const o=await Q.get("/api/suppliers",{headers:l});v.value=o.data.data||[]}catch(n){console.error("Error loading suppliers:",n)}},E=async()=>{try{const n=K(),l={"Content-Type":"application/json",Accept:"application/json"};n&&(l.Authorization=`Bearer ${n}`);const o=await Q.get("/api/purchases/statistics",{headers:l});B.value=o.data.data||{}}catch(n){console.error("Error loading statistics:",n)}},ie=()=>{g.value=null,c.value="create",j.value=!0},re=n=>{console.log("🔧 editPurchase called with:",n),console.log("👤 Purchase supplier ID:",n.id_supplier),console.log("📦 Purchase items:",n.items),g.value=n,c.value="edit",j.value=!0,console.log("📋 selectedPurchase set to:",g.value),console.log("🎯 dialogMode set to:",c.value)},ae=n=>{g.value=n,F.value=!0},le=n=>{g.value=n,A.value=!0},y=async n=>{var l,o;if(confirm(`Apakah Anda yakin ingin menghapus purchase ${n.purchase_number}?`))try{const m=K(),q={"Content-Type":"application/json",Accept:"application/json"};m&&(q.Authorization=`Bearer ${m}`),await Q.delete(`/api/purchases/${n.id_purchase}`,{headers:q}),D(),E()}catch(m){console.error("Error deleting purchase:",m),alert("Error deleting purchase: "+(((o=(l=m.response)==null?void 0:l.data)==null?void 0:o.message)||m.message))}},p=async(n,l)=>{var o,m;try{const q=K(),ue={"Content-Type":"application/json",Accept:"application/json"};q&&(ue.Authorization=`Bearer ${q}`),await Q.patch(`/api/purchases/${n.id_purchase}/status`,{status:l},{headers:ue}),D(),E(),k.value={show:!0,message:`Purchase status berhasil diubah ke ${l}!`,color:"success"}}catch(q){console.error("Error updating purchase status:",q),k.value={show:!0,message:"Error updating status: "+(((m=(o=q.response)==null?void 0:o.data)==null?void 0:m.message)||q.message),color:"error"}}},u=()=>{j.value=!1,D(),E(),k.value={show:!0,message:c.value==="create"?"Purchase order berhasil dibuat!":"Purchase order berhasil diperbarui!",color:"success"}},h=()=>{A.value=!1,D(),E(),k.value={show:!0,message:"Items berhasil diterima!",color:"success"}},L=n=>{const l=typeof n=="string"?parseFloat(n):n;return isNaN(l)?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)},se=n=>n?new Date(n).toLocaleDateString("id-ID"):"-",Z=n=>({pending:"warning",ordered:"info",received:"primary",completed:"success",cancelled:"error"})[n]||"default",d=n=>({pending:"Pending",ordered:"Dipesan",received:"Diterima",completed:"Selesai",cancelled:"Dibatalkan"})[n]||n,i=n=>["pending","ordered"].includes(n.status),f=n=>n.status==="pending";return ce(s,()=>{P.value=1,D()},{deep:!0}),we(()=>{D(),O(),E()}),(n,l)=>(V(),R(je,{fluid:""},{default:t(()=>[e(Y,{class:"mb-4"},{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[a("div",Bt,[l[15]||(l[15]=a("div",null,[a("h1",{class:"text-h4 font-weight-bold"},"Purchase Management"),a("p",{class:"text-body-1 text-medium-emphasis"},"Kelola pembelian barang dari supplier")],-1)),e(S,{color:"primary",size:"large",onClick:ie},{default:t(()=>[e(H,{start:""},{default:t(()=>l[13]||(l[13]=[_("mdi-plus")])),_:1,__:[13]}),l[14]||(l[14]=_(" Buat Purchase Order "))]),_:1,__:[14]})])]),_:1})]),_:1}),e(Y,{class:"mb-6"},{default:t(()=>[e(I,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e($,{color:"primary"},{default:t(()=>[e(U,null,{default:t(()=>[a("div",Ft,[a("div",null,[l[16]||(l[16]=a("p",{class:"text-caption text-white mb-1"},"Total Purchase",-1)),a("p",Ot,r(B.value.total_purchases||0),1)]),e(H,{size:"40",class:"text-white"},{default:t(()=>l[17]||(l[17]=[_("mdi-cart")])),_:1,__:[17]})])]),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e($,{color:"warning"},{default:t(()=>[e(U,null,{default:t(()=>[a("div",Et,[a("div",null,[l[18]||(l[18]=a("p",{class:"text-caption text-white mb-1"},"Pending",-1)),a("p",Mt,r(B.value.pending_purchases||0),1)]),e(H,{size:"40",class:"text-white"},{default:t(()=>l[19]||(l[19]=[_("mdi-clock")])),_:1,__:[19]})])]),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e($,{color:"success"},{default:t(()=>[e(U,null,{default:t(()=>[a("div",Lt,[a("div",null,[l[20]||(l[20]=a("p",{class:"text-caption text-white mb-1"},"Completed",-1)),a("p",Qt,r(B.value.completed_purchases||0),1)]),e(H,{size:"40",class:"text-white"},{default:t(()=>l[21]||(l[21]=[_("mdi-check-circle")])),_:1,__:[21]})])]),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",md:"3"},{default:t(()=>[e($,{color:"info"},{default:t(()=>[e(U,null,{default:t(()=>[a("div",Kt,[a("div",null,[l[22]||(l[22]=a("p",{class:"text-caption text-white mb-1"},"Bulan Ini",-1)),a("p",Ht,r(L(B.value.total_amount_this_month||0)),1)]),e(H,{size:"40",class:"text-white"},{default:t(()=>l[23]||(l[23]=[_("mdi-currency-usd")])),_:1,__:[23]})])]),_:1})]),_:1})]),_:1})]),_:1}),e($,{class:"mb-6"},{default:t(()=>[e(U,null,{default:t(()=>[e(Y,null,{default:t(()=>[e(I,{cols:"12",md:"3"},{default:t(()=>[e(G,{modelValue:s.value.search,"onUpdate:modelValue":l[0]||(l[0]=o=>s.value.search=o),label:"Cari Purchase Number","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"","onClick:clear":l[1]||(l[1]=o=>s.value.search="")},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(pe,{modelValue:s.value.status,"onUpdate:modelValue":l[2]||(l[2]=o=>s.value.status=o),label:"Status",items:N,"item-title":"label","item-value":"value",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(pe,{modelValue:s.value.supplier_id,"onUpdate:modelValue":l[3]||(l[3]=o=>s.value.supplier_id=o),label:"Supplier",items:v.value,"item-title":"name","item-value":"id_supplier",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(G,{modelValue:s.value.start_date,"onUpdate:modelValue":l[4]||(l[4]=o=>s.value.start_date=o),label:"Tanggal Mulai",type:"date",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(G,{modelValue:s.value.end_date,"onUpdate:modelValue":l[5]||(l[5]=o=>s.value.end_date=o),label:"Tanggal Akhir",type:"date",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"1"},{default:t(()=>[e(S,{color:"primary",variant:"tonal",icon:"mdi-refresh",onClick:D})]),_:1})]),_:1})]),_:1})]),_:1}),e($,null,{default:t(()=>[e(Ae,{"items-per-page":T.value,"onUpdate:itemsPerPage":l[7]||(l[7]=o=>T.value=o),page:P.value,"onUpdate:page":l[8]||(l[8]=o=>P.value=o),headers:b,items:J.value,"items-length":x.value,loading:z.value,"item-value":"id_purchase","onUpdate:options":D},{"item.purchase_number":t(({item:o})=>[a("div",Gt,[e(S,{variant:"text",color:"primary",size:"small",onClick:m=>ae(o)},{default:t(()=>[_(r(o.purchase_number),1)]),_:2},1032,["onClick"])])]),"item.supplier.name":t(({item:o})=>{var m,q;return[a("div",null,[a("p",Xt,r(((m=o.supplier)==null?void 0:m.name)||"-"),1),a("p",Jt,r(((q=o.supplier)==null?void 0:q.phone)||"-"),1)])]}),"item.purchase_date":t(({item:o})=>[_(r(se(o.purchase_date)),1)]),"item.status":t(({item:o})=>[e(ee,{color:Z(o.status),size:"small",variant:"elevated"},{default:t(()=>[_(r(d(o.status)),1)]),_:2},1032,["color"])]),"item.total_amount":t(({item:o})=>[a("span",Wt,r(L(o.total_amount)),1)]),"item.actions":t(({item:o})=>[a("div",Yt,[e(S,{icon:"mdi-eye",size:"small",variant:"text",color:"info",onClick:m=>ae(o)},null,8,["onClick"]),i(o)?(V(),R(S,{key:0,icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:m=>re(o)},null,8,["onClick"])):C("",!0),["ordered","received"].includes(o.status)?(V(),R(S,{key:1,icon:"mdi-truck-delivery",size:"small",variant:"text",color:"success",onClick:m=>le(o)},null,8,["onClick"])):C("",!0),f(o)?(V(),R(S,{key:2,icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:m=>y(o)},null,8,["onClick"])):C("",!0),e(Ne,null,{activator:t(({props:m})=>[e(S,xe({icon:"mdi-dots-vertical",size:"small",variant:"text"},m),null,16)]),default:t(()=>[e(Se,null,{default:t(()=>[o.status==="pending"?(V(),R(oe,{key:0,onClick:m=>p(o,"ordered")},{default:t(()=>[e(ne,null,{default:t(()=>l[24]||(l[24]=[_("Mark as Ordered")])),_:1,__:[24]})]),_:2},1032,["onClick"])):C("",!0),o.status==="ordered"?(V(),R(oe,{key:1,onClick:m=>p(o,"received")},{default:t(()=>[e(ne,null,{default:t(()=>l[25]||(l[25]=[_("Mark as Received")])),_:1,__:[25]})]),_:2},1032,["onClick"])):C("",!0),o.status==="received"?(V(),R(oe,{key:2,onClick:m=>p(o,"completed")},{default:t(()=>[e(ne,null,{default:t(()=>l[26]||(l[26]=[_("Mark as Completed")])),_:1,__:[26]})]),_:2},1032,["onClick"])):C("",!0),["pending","ordered"].includes(o.status)?(V(),R(oe,{key:3,onClick:m=>p(o,"cancelled")},{default:t(()=>[e(ne,{class:"text-error"},{default:t(()=>l[27]||(l[27]=[_("Cancel Purchase")])),_:1,__:[27]})]),_:2},1032,["onClick"])):C("",!0)]),_:2},1024)]),_:2},1024)])]),bottom:t(()=>[a("div",Zt,[e(Ue,{modelValue:P.value,"onUpdate:modelValue":l[6]||(l[6]=o=>P.value=o),length:Math.ceil(x.value/T.value),"total-visible":5},null,8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","items-length","loading"])]),_:1}),e(Ye,{modelValue:j.value,"onUpdate:modelValue":l[9]||(l[9]=o=>j.value=o),purchase:g.value,mode:c.value,onSaved:u},null,8,["modelValue","purchase","mode"]),e(Rt,{modelValue:F.value,"onUpdate:modelValue":l[10]||(l[10]=o=>F.value=o),purchase:g.value},null,8,["modelValue","purchase"]),e(rt,{modelValue:A.value,"onUpdate:modelValue":l[11]||(l[11]=o=>A.value=o),purchase:g.value,onSuccess:h},null,8,["modelValue","purchase"]),e(Re,{modelValue:k.value.show,"onUpdate:modelValue":l[12]||(l[12]=o=>k.value.show=o),color:k.value.color,timeout:4e3,location:"top right"},{default:t(()=>[_(r(k.value.message),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),Sa=ye(ea,[["__scopeId","data-v-964b720f"]]);export{Sa as default};
