import{P as re}from"./PosApi-CQ7s3AQ2.js";import ie from"./EditOrderDialog-stAuzZeK.js";import de from"./OrderDetailDialog-CKhdk5Id.js";import{V as ue}from"./VDialog-EPqZ9Ecc.js";import{V as x,b as ce}from"./VCard-5KwXaSxV.js";import{d as me,r as c,V as pe,D as ge,w as M,g as U,f as o,o as m,b as l,e as r,X as $,a1 as k,c as v,l as E,t as d,F as _e,i as ve,s as T,_ as fe}from"./main-7LmwCxHk.js";import{V as f}from"./VCardText-mtvQnQdf.js";import{V as L,a as p}from"./VRow-4T2ATmuP.js";import{V as A}from"./VTextField-D8WfafXE.js";import{V as ye}from"./VSelect-KhMV_GWi.js";import{V as he}from"./VDataTable-Bz4SA_CT.js";import{V as N}from"./VChip-DeudqFou.js";import"./VForm-DN1G8yat.js";import"./forwardRefs-B931MWyl.js";import"./VTextarea-Btet1qOr.js";import"./VImg-Cx5t_sn9.js";import"./VDivider-opcr7_hL.js";import"./VSpacer-B5xRgDBc.js";/* empty css              */import"./VTable-Bvbv_Nxj.js";import"./VOverlay-CMX9Jgp1.js";import"./VAvatar-DU4UmpPt.js";import"./VList-CRuSjyLR.js";import"./VMenu-DLoVgwAC.js";import"./VCheckboxBtn--x9NTbuo.js";import"./filter-z0NPVyZs.js";const Ve={class:"d-flex align-items-center gap-2"},be={class:"text-h4"},xe={class:"text-h4"},ke={class:"text-h4"},De={class:"text-h4"},we={key:0},Te={class:"font-weight-medium"},Ce={class:"text-caption text-medium-emphasis"},Se={key:1,class:"text-medium-emphasis"},Ie={class:"font-weight-medium"},Oe={key:0},Pe={key:1,class:"text-medium-emphasis"},Fe={class:"text-body-2"},Ue={class:"text-caption text-medium-emphasis"},Ae={key:0,class:"pa-4 text-center border-t"},Ne=me({__name:"TransactionHistoryDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(j,{emit:H}){const Q=j,q=H,C=c(!1),u=c([]),y=c(""),h=c(""),g=c(""),_=c(""),S=c(!1),I=c(!1),D=c(null),i=c({current_page:1,per_page:15,total:0,last_page:1}),V=c({total_orders:0,total_revenue:0,average_order:0,pending_orders:0}),K=[{title:"No. Pesanan",key:"order_number",sortable:!0},{title:"Pelanggan",key:"customer",sortable:!1},{title:"Status",key:"status",sortable:!0},{title:"Total",key:"total_amount",sortable:!0},{title:"Pembayaran",key:"payment_method",sortable:!1},{title:"Tanggal",key:"created_at",sortable:!0},{title:"Aksi",key:"actions",sortable:!1,width:"120px"}],W=[{title:"Pending",value:"pending"},{title:"Diproses",value:"preparing"},{title:"Selesai",value:"completed"},{title:"Dibatalkan",value:"cancelled"}],X=[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],w=pe({get:()=>Q.modelValue,set:a=>q("update:modelValue",a)}),b=async(a=1,e=15)=>{var t;try{C.value=!0;const n={page:a,per_page:e>=999999?"all":e};y.value&&(n.search=y.value),h.value&&(n.status=h.value),g.value&&(n.date_from=g.value),_.value&&(n.date_to=_.value);const s=await re.getOrders(n);console.log("API Response:",s),console.log("Response data:",s.data),console.log("Response pagination:",s.pagination),s.success?s.data&&s.pagination?(u.value=s.data,i.value={current_page:s.pagination.current_page||1,per_page:e>=999999?-1:s.pagination.per_page||15,total:s.pagination.total||0,last_page:s.pagination.last_page||1}):(t=s.data)!=null&&t.data&&Array.isArray(s.data.data)?(u.value=s.data.data,i.value={current_page:s.data.current_page||1,per_page:e>=999999?-1:s.data.per_page||15,total:s.data.total||0,last_page:s.data.last_page||1}):Array.isArray(s.data)?(u.value=s.data,i.value={current_page:1,per_page:e>=999999?-1:s.data.length,total:s.data.length,last_page:1}):(console.warn("Unexpected response structure:",s),u.value=[],i.value={current_page:1,per_page:15,total:0,last_page:1}):(u.value=[],i.value={current_page:1,per_page:15,total:0,last_page:1}),R()}catch(n){console.error("Error loading transactions:",n),u.value=[],i.value={current_page:1,per_page:15,total:0,last_page:1}}finally{C.value=!1}},Y=a=>{b(a,i.value.per_page)},G=async a=>{if(a===-1){const e=i.value.total;if(e>1e3&&!window.confirm(`Anda akan memuat semua ${e} transaksi. Ini mungkin memakan waktu lama. Lanjutkan?`))return;await b(1,999999)}else await b(1,a)},R=()=>{const a=u.value,e=a.reduce((n,s)=>{const F=typeof s.total_amount=="string"?parseFloat(s.total_amount):s.total_amount;return n+(isNaN(F)||!isFinite(F)?0:F)},0),t=a.length>0&&e>0?e/a.length:0;V.value={total_orders:i.value.total,total_revenue:e,average_order:t,pending_orders:a.filter(n=>n.status==="pending").length}},z=a=>{D.value=a,S.value=!0},J=a=>{},Z=a=>{D.value=a,I.value=!0},B=a=>{const e=u.value.findIndex(t=>t.id_order===a.id_order);e!==-1&&(u.value[e]=a),R()},ee=a=>({pending:"warning",preparing:"info",completed:"success",cancelled:"error"})[a]||"default",te=a=>({pending:"Pending",preparing:"Diproses",completed:"Selesai",cancelled:"Dibatalkan"})[a]||a,ae=a=>({cash:"Tunai",card:"Kartu",digital_wallet:"E-Wallet",qris:"QRIS",bank_transfer:"Transfer"})[a]||a,O=a=>{const e=typeof a=="string"?parseFloat(a):a;return isNaN(e)||!isFinite(e)?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e)},le=a=>new Date(a).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}),oe=a=>new Date(a).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),se=()=>{w.value=!1},ne=()=>{const a=new Date().toISOString().split("T")[0],e=new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0];g.value=e,_.value=a};ge(()=>{ne()}),M(w,a=>{a&&b()});let P=null;return M([y,h,g,_],()=>{P&&clearTimeout(P),P=setTimeout(()=>{b(1,i.value.per_page)},500)}),(a,e)=>(m(),U(ue,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=t=>w.value=t),"max-width":"1200",scrollable:""},{default:o(()=>[l(x,{class:"coffee-dialog"},{default:o(()=>[l(ce,{class:"d-flex align-center justify-space-between coffee-header"},{default:o(()=>[r("div",Ve,[l($,{icon:"tabler-history",class:"text-white"}),e[7]||(e[7]=r("div",null,[r("div",{class:"coffee-title"},"Riwayat Transaksi"),r("div",{class:"coffee-subtitle"},"Daftar transaksi dan pembayaran")],-1))]),l(k,{icon:"tabler-x",variant:"text",color:"white",onClick:se})]),_:1}),l(f,{class:"pb-0 px-6"},{default:o(()=>[l(L,null,{default:o(()=>[l(p,{cols:"12",md:"4"},{default:o(()=>[l(A,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),label:"Cari transaksi...",variant:"outlined",density:"compact","prepend-inner-icon":"tabler-search",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",md:"2"},{default:o(()=>[l(ye,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),items:W,label:"Status",variant:"outlined",density:"compact",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",md:"3"},{default:o(()=>[l(A,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=t=>g.value=t),label:"Dari Tanggal",type:"date",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",md:"3"},{default:o(()=>[l(A,{modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=t=>_.value=t),label:"Sampai Tanggal",type:"date",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(f,{class:"px-6"},{default:o(()=>[l(L,{class:"mb-4"},{default:o(()=>[l(p,{cols:"12",md:"3"},{default:o(()=>[l(x,{variant:"tonal",color:"primary"},{default:o(()=>[l(f,{class:"text-center"},{default:o(()=>[r("h3",be,d(V.value.total_orders),1),e[8]||(e[8]=r("p",{class:"text-body-2 mb-0"},"Total Transaksi",-1))]),_:1,__:[8]})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:o(()=>[l(x,{variant:"tonal",color:"success"},{default:o(()=>[l(f,{class:"text-center"},{default:o(()=>[r("h3",xe,d(O(V.value.total_revenue)),1),e[9]||(e[9]=r("p",{class:"text-body-2 mb-0"},"Total Pendapatan",-1))]),_:1,__:[9]})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:o(()=>[l(x,{variant:"tonal",color:"info"},{default:o(()=>[l(f,{class:"text-center"},{default:o(()=>[r("h3",ke,d(O(V.value.average_order)),1),e[10]||(e[10]=r("p",{class:"text-body-2 mb-0"},"Rata-rata per Transaksi",-1))]),_:1,__:[10]})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:o(()=>[l(x,{variant:"tonal",color:"warning"},{default:o(()=>[l(f,{class:"text-center"},{default:o(()=>[r("h3",De,d(V.value.pending_orders),1),e[11]||(e[11]=r("p",{class:"text-body-2 mb-0"},"Transaksi Pending",-1))]),_:1,__:[11]})]),_:1})]),_:1})]),_:1}),l(he,{headers:K,items:u.value,loading:C.value,"items-per-page":i.value.per_page===-1?u.value.length:i.value.per_page,page:i.value.current_page,"items-length":i.value.total,"server-items-length":i.value.total,"items-per-page-options":X,"show-select":!1,class:"elevation-1","onUpdate:page":Y,"onUpdate:itemsPerPage":G},{"item.order_number":o(({item:t})=>[l(k,{variant:"text",color:"primary",size:"small",onClick:n=>z(t)},{default:o(()=>[T(d(t.order_number),1)]),_:2},1032,["onClick"])]),"item.customer":o(({item:t})=>[t.customer?(m(),v("div",we,[r("div",Te,d(t.customer.name),1),r("div",Ce,d(t.customer.phone),1)])):(m(),v("span",Se,"-"))]),"item.status":o(({item:t})=>[l(N,{color:ee(t.status),size:"small",variant:"tonal"},{default:o(()=>[T(d(te(t.status)),1)]),_:2},1032,["color"])]),"item.total_amount":o(({item:t})=>[r("span",Ie,d(O(t.total_amount)),1)]),"item.payment_method":o(({item:t})=>[t.payments&&t.payments.length>0?(m(),v("div",Oe,[(m(!0),v(_e,null,ve(t.payments,n=>(m(),U(N,{key:n.id_payment,size:"small",variant:"outlined",class:"ma-1"},{default:o(()=>[T(d(ae(n.payment_method)),1)]),_:2},1024))),128))])):(m(),v("span",Pe,"-"))]),"item.created_at":o(({item:t})=>[r("div",null,[r("div",Fe,d(le(t.created_at)),1),r("div",Ue,d(oe(t.created_at)),1)])]),"item.actions":o(({item:t})=>[l(k,{icon:"tabler-eye",variant:"text",size:"small",onClick:n=>z(t)},null,8,["onClick"]),l(k,{icon:"tabler-printer",variant:"text",size:"small",onClick:n=>J(t)},null,8,["onClick"]),t.status==="pending"?(m(),U(k,{key:0,icon:"tabler-edit",variant:"text",size:"small",color:"primary",onClick:n=>Z(t)},null,8,["onClick"])):E("",!0)]),_:1},8,["items","loading","items-per-page","page","items-length","server-items-length"]),i.value.per_page===-1?(m(),v("div",Ae,[l(N,{color:"success",variant:"tonal",size:"large"},{default:o(()=>[l($,{start:"",icon:"tabler-check-circle"}),T(" Menampilkan semua "+d(u.value.length)+" transaksi ",1)]),_:1})])):E("",!0)]),_:1})]),_:1}),l(de,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=t=>S.value=t),order:D.value,onOrderUpdated:B},null,8,["modelValue","order"]),l(ie,{modelValue:I.value,"onUpdate:modelValue":e[5]||(e[5]=t=>I.value=t),order:D.value,onOrderUpdated:B},null,8,["modelValue","order"])]),_:1},8,["modelValue"]))}}),it=fe(Ne,[["__scopeId","data-v-f610ebb9"]]);export{it as default};
