import{_ as j,g as S,f as i,r as C,az as k,V as E,w as R,o as V,b as o,e as c,X as A,t as g,a0 as T,l as D,c as U,a1 as w,s as P}from"./main-CB2I6xMV.js";import{u as O}from"./baseProduct-Bg6YhvSY.js";import{V as G}from"./VDialog-B6cC2nlh.js";import{V as F,b as q,c as J}from"./VCard-kftbvHmf.js";import{V as z}from"./VAvatar-D5c5G9iR.js";import{V as M}from"./VDivider-DwA1QPln.js";import{V as K}from"./VCardText-BfCVZfsH.js";import{V as L}from"./VForm-BZABAsaR.js";import{V as X,a as d}from"./VRow-GRjXWUI7.js";import{V as p}from"./VTextField-Datxr734.js";import{V as H}from"./VSelect-hlAyRJts.js";import{V as Q}from"./VTextarea-BROs2Myi.js";import{V as W}from"./VImg-DwwCzJBL.js";import{V as Y}from"./VCheckbox-CET2lmpw.js";import{V as Z}from"./VSpacer-E_xV2pSV.js";import"./api-BAsWjeCp.js";import"./index-D-EbNoF1.js";import"./CategoriesApi-Cw2k85M8.js";import"./VOverlay-3Ss5mR2i.js";import"./forwardRefs-B931MWyl.js";/* empty css              */import"./VList-VjqlGNmq.js";import"./VMenu-DDyD7LK0.js";import"./VCheckboxBtn-BKcWcRAi.js";import"./VChip-CXoDuQ6k.js";const $={name:"BaseProductModal",props:{show:{type:Boolean,default:!1},baseProduct:{type:Object,default:null},categories:{type:Array,default:()=>[]}},emits:["close","saved"],setup(u,{emit:a}){const b=O(),e=C(!1),_=C(null),f=C(null),t=C({}),r=k({name:"",sku:"",description:"",category_id:"",unit:"",cost_per_unit:"",min_stock:"",initial_stock:0,image:null,is_active:!0}),y=E(()=>!!u.baseProduct),N=E(()=>!u.categories||!Array.isArray(u.categories)?[]:u.categories.map(s=>({title:s.name,value:s.id_category}))),B=()=>{Object.keys(r).forEach(n=>{n==="is_active"?r[n]=!0:n==="initial_stock"?r[n]=0:r[n]=""}),f.value=null,t.value={}};return R(()=>u.baseProduct,n=>{n?Object.keys(r).forEach(s=>{s==="image"?(r[s]=null,f.value=n.image_url||null):s==="initial_stock"?r[s]=0:r[s]=n[s]||""}):B(),t.value={}},{immediate:!0}),{loading:e,imageInput:_,imagePreview:f,errors:t,form:r,isEdit:y,categoryItems:N,handleImageUpload:n=>{const s=n.target.files[0];if(s){if(s.size>2*1024*1024){t.value={...t.value,image:["Image size must be less than 2MB"]};return}r.image=s;const v=new FileReader;v.onload=x=>{f.value=x.target.result},v.readAsDataURL(s),t.value.image&&delete t.value.image}},removeImage:()=>{r.image=null,f.value=null,_.value&&(_.value.value="")},handleSubmit:async()=>{var n,s,v,x;e.value=!0,t.value={};try{const m=new FormData;Object.keys(r).forEach(l=>{if(l==="image"&&r[l])m.append("image",r[l]);else if(l!=="image")if(l==="is_active"||l==="is_perishable")m.append(l,r[l]?"1":"0");else if(l==="min_stock"||l==="cost_per_unit"||l==="initial_stock"){const I=r[l]===""||r[l]===null||r[l]===void 0?"0":r[l];m.append(l,I)}else if(l==="unit"){const I=r[l]===""||r[l]===null||r[l]===void 0?"pcs":r[l];m.append(l,I)}else r[l]!==""&&r[l]!==null&&r[l]!==void 0&&m.append(l,r[l])});let h;y.value?h=await b.updateBaseProduct(u.baseProduct.id_base_product,m):h=await b.createBaseProduct(m),a("saved",h.data)}catch(m){console.error("Error saving base product:",m),(s=(n=m.response)==null?void 0:n.data)!=null&&s.errors?t.value=m.response.data.errors:t.value={general:[((x=(v=m.response)==null?void 0:v.data)==null?void 0:x.message)||"An error occurred"]}}finally{e.value=!1}},resetForm:B}}},ee={class:"text-h6 font-weight-bold"},ae={class:"text-body-2 text-medium-emphasis mb-0"},oe={key:0,class:"text-center"},te={key:1,class:"text-center"},re={class:"text-body-1 mb-2"},le={key:0,class:"text-error text-body-2 mt-2"};function ie(u,a,b,e,_,f){return V(),S(G,{"model-value":b.show,"max-width":"800px",persistent:"","onUpdate:modelValue":a[12]||(a[12]=t=>!t&&u.$emit("close"))},{default:i(()=>[o(F,null,{default:i(()=>[o(q,{class:"d-flex align-center gap-3 pa-6"},{default:i(()=>[o(z,{color:"primary",variant:"tonal"},{default:i(()=>[o(A,{icon:"mdi-package-variant"})]),_:1}),c("div",null,[c("h3",ee,g(e.isEdit?"Edit Base Product":"Create Base Product"),1),c("p",ae,g(e.isEdit?"Update the base product information.":"Add a new base product for compositions."),1)])]),_:1}),o(M),o(K,{class:"pa-6"},{default:i(()=>[o(L,{onSubmit:T(e.handleSubmit,["prevent"])},{default:i(()=>[o(X,null,{default:i(()=>[o(d,{cols:"12"},{default:i(()=>a[13]||(a[13]=[c("h4",{class:"text-subtitle-1 font-weight-medium mb-4"},"Basic Information",-1)])),_:1,__:[13]}),o(d,{cols:"12"},{default:i(()=>[o(p,{modelValue:e.form.name,"onUpdate:modelValue":a[0]||(a[0]=t=>e.form.name=t),label:"Name",placeholder:"Enter product name",required:"","error-messages":e.errors.name,variant:"outlined",density:"comfortable"},null,8,["modelValue","error-messages"])]),_:1}),o(d,{cols:"12",md:"6"},{default:i(()=>[o(p,{modelValue:e.form.sku,"onUpdate:modelValue":a[1]||(a[1]=t=>e.form.sku=t),label:"SKU",placeholder:"Auto-generated if empty","error-messages":e.errors.sku,variant:"outlined",density:"comfortable"},null,8,["modelValue","error-messages"])]),_:1}),o(d,{cols:"12",md:"6"},{default:i(()=>[o(H,{modelValue:e.form.category_id,"onUpdate:modelValue":a[2]||(a[2]=t=>e.form.category_id=t),items:e.categoryItems,label:"Category",placeholder:"Select Category","error-messages":e.errors.category_id,variant:"outlined",density:"comfortable"},null,8,["modelValue","items","error-messages"])]),_:1}),o(d,{cols:"12"},{default:i(()=>[o(Q,{modelValue:e.form.description,"onUpdate:modelValue":a[3]||(a[3]=t=>e.form.description=t),label:"Description",placeholder:"Enter product description","error-messages":e.errors.description,variant:"outlined",density:"comfortable",rows:"3"},null,8,["modelValue","error-messages"])]),_:1}),o(d,{cols:"12"},{default:i(()=>a[14]||(a[14]=[c("h4",{class:"text-subtitle-1 font-weight-medium mb-4"},"Pricing & Stock",-1)])),_:1,__:[14]}),o(d,{cols:"12",md:"4"},{default:i(()=>[o(p,{modelValue:e.form.unit,"onUpdate:modelValue":a[4]||(a[4]=t=>e.form.unit=t),label:"Unit",placeholder:"e.g., kg, pcs, liter","error-messages":e.errors.unit,variant:"outlined",density:"comfortable"},null,8,["modelValue","error-messages"])]),_:1}),o(d,{cols:"12",md:"4"},{default:i(()=>[o(p,{modelValue:e.form.cost_per_unit,"onUpdate:modelValue":a[5]||(a[5]=t=>e.form.cost_per_unit=t),label:"Cost per Unit",placeholder:"0",type:"number",step:"0.01",min:"0","error-messages":e.errors.cost_per_unit,variant:"outlined",density:"comfortable",prefix:"Rp"},null,8,["modelValue","error-messages"])]),_:1}),o(d,{cols:"12",md:"4"},{default:i(()=>[o(p,{modelValue:e.form.min_stock,"onUpdate:modelValue":a[6]||(a[6]=t=>e.form.min_stock=t),label:"Min Stock",placeholder:"0",type:"number",step:"0.001",min:"0","error-messages":e.errors.min_stock,variant:"outlined",density:"comfortable"},null,8,["modelValue","error-messages"])]),_:1}),e.isEdit?D("",!0):(V(),S(d,{key:0,cols:"12"},{default:i(()=>[o(p,{modelValue:e.form.initial_stock,"onUpdate:modelValue":a[7]||(a[7]=t=>e.form.initial_stock=t),label:"Initial Stock",placeholder:"0",type:"number",step:"0.001",min:"0","error-messages":e.errors.initial_stock,variant:"outlined",density:"comfortable",hint:"Enter initial stock quantity for this base product","persistent-hint":""},null,8,["modelValue","error-messages"])]),_:1})),o(d,{cols:"12"},{default:i(()=>[a[17]||(a[17]=c("h4",{class:"text-subtitle-1 font-weight-medium mb-4"},"Product Image",-1)),o(F,{variant:"outlined",class:"d-flex flex-column align-center justify-center pa-6",style:{"min-height":"200px","border-style":"dashed"}},{default:i(()=>[e.imagePreview?(V(),U("div",oe,[o(z,{size:"120",rounded:"lg",class:"mb-4"},{default:i(()=>[o(W,{src:e.imagePreview,alt:"Preview"},null,8,["src"])]),_:1}),o(w,{color:"error",variant:"text",size:"small",onClick:e.removeImage},{default:i(()=>a[15]||(a[15]=[P(" Remove Image ")])),_:1,__:[15]},8,["onClick"])])):(V(),U("div",te,[o(A,{icon:"mdi-camera-plus",size:"48",class:"text-medium-emphasis mb-4"}),c("p",re,g(e.imagePreview?"Change image":"Upload a file"),1),a[16]||(a[16]=c("p",{class:"text-body-2 text-medium-emphasis"},"PNG, JPG, GIF up to 2MB",-1))])),o(w,{color:"primary",variant:"tonal",class:"mt-4",onClick:a[8]||(a[8]=t=>{var r;return(r=u.$refs.imageInput)==null?void 0:r.click()})},{default:i(()=>[P(g(e.imagePreview?"Change Image":"Choose File"),1)]),_:1}),c("input",{ref:"imageInput",type:"file",accept:"image/*",style:{display:"none"},onChange:a[9]||(a[9]=(...t)=>e.handleImageUpload&&e.handleImageUpload(...t))},null,544)]),_:1}),e.errors.image?(V(),U("div",le,g(e.errors.image[0]),1)):D("",!0)]),_:1,__:[17]}),o(d,{cols:"12"},{default:i(()=>[o(Y,{modelValue:e.form.is_active,"onUpdate:modelValue":a[10]||(a[10]=t=>e.form.is_active=t),label:"Active","error-messages":e.errors.is_active},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),o(M),o(J,{class:"pa-6"},{default:i(()=>[o(Z),o(w,{variant:"outlined",onClick:a[11]||(a[11]=t=>u.$emit("close"))},{default:i(()=>a[18]||(a[18]=[P(" Cancel ")])),_:1,__:[18]}),o(w,{color:"primary",loading:e.loading,onClick:e.handleSubmit},{default:i(()=>[P(g(e.isEdit?"Update":"Create"),1)]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Me=j($,[["render",ie]]);export{Me as default};
