import{D as Lt}from"./DeleteConfirmationDialog-pXepQ3z7.js";import{f as Ae}from"./formatters-BD6tdLx_.js";import{P as yt,u as ia}from"./useProductItems-CfgdJ4oE.js";import{I as ra}from"./ItemsApi-BngRiE6W.js";import{u as Dt,H as ua}from"./HPPBreakdownDialog-JenGdzj_.js";import{V as Oe}from"./VDialog-Dwjn1zMK.js";import{V as se,b as Ve,c as Ke}from"./VCard-DZV7czgN.js";import{cq as Nt,a8 as st,a9 as nt,as as da,aF as ca,af as Ot,bT as ma,r as E,V as ce,aG as Xe,w as we,W as Ge,b as e,a0 as K,aa as it,ak as va,ab as jt,ac as Wt,H as Gt,ba as fa,L as pa,N as Xt,bZ as ga,b_ as _a,b9 as ht,aJ as St,I as ka,ag as Jt,aM as xt,bj as ya,bt as Bt,p as ye,be as Tt,cr as ba,c8 as Ft,bh as ha,F as $e,X as D,cp as xa,c9 as wa,aI as Pa,s as _,cs as Va,a$ as Ca,ad as Sa,aH as Ia,b3 as $a,b5 as Da,d as qe,D as dt,c as oe,f as t,e as l,t as d,g as j,l as Y,m as N,aw as Pt,i as Je,v as Ye,o as w,ax as It,$ as Ut,j as Yt,ct as Ta,aQ as Ua,aA as Ne,ap as za,aq as Aa,a5 as Ct}from"./main-5j-NPNqe.js";import{V as de}from"./VCardText-BO7PEcsJ.js";import{V as Se}from"./VAvatar-ocA34gaI.js";import{V as ge,m as Ha,b as Rt}from"./VChip-BZNUaXEd.js";import{V as Ce,a as M}from"./VRow-CiuQE0fJ.js";import{V as zt}from"./VAutocomplete-C-sDOUir.js";import{u as Ma,e as Ea,t as mt,V as Vt,a as Qe,b as ft,d as pt}from"./VList-CVU4l0qM.js";import{u as Ba,V as xe,m as Fa}from"./VTextField-BX2YQ-DT.js";import{V as gt}from"./VSwitch-C-kqQfUt.js";import{a as wt,V as Be}from"./VAlert-Dt55nFgT.js";import{V as je}from"./VSpacer-etvweEhJ.js";import{V as ut}from"./VSnackbar-DDmTBNl-.js";import{_ as We}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Ra,m as Ka,a as qa,V as Fe}from"./VSelect-wwd2IxOK.js";import{V as La}from"./VCheckbox-C3MsEH-e.js";import{V as ze}from"./VDivider-I43DfcHK.js";import{V as Na}from"./VContainer-C2vNNs2Q.js";import{a as Qt,u as Oa,P as ja}from"./useProducts-CqJeMKIF.js";import{V as At}from"./VForm-CtN8Pofe.js";import{V as Kt}from"./VTextarea-BFopyHzV.js";import{V as Ee}from"./VTooltip-DN3d0WQ-.js";import{M as Wa,m as Ga,V as Xa}from"./VImg-1y1TvuVC.js";import{V as Ja,u as Ya}from"./useCategories-qeD1wxnd.js";import{u as Qa,m as Za,h as el}from"./filter-CDevsKrv.js";import{f as Zt,a as tl,s as al}from"./forwardRefs-B931MWyl.js";import{V as ll}from"./VMenu-DJJHDhlq.js";import{V as ol}from"./VCheckboxBtn-Br2ucrKl.js";import{V as sl}from"./VDataTableServer-CtifNVK1.js";import{V as nl}from"./VSkeletonLoader-Bl6vT-NZ.js";import{V as il}from"./VDataTable-gXZjXxjW.js";import{c as rl,d as ul,u as dl}from"./VOverlay-DAQ_Tfis.js";import"./ProductsApi-CjEYi_f1.js";import"./api-DVE_RO57.js";import"./index-D-EbNoF1.js";/* empty css              */import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-DAH2Qh6d.js";import"./VTable-CnHvN7qb.js";const cl=s=>{const{touchstartX:R,touchendX:f,touchstartY:m,touchendY:z}=s,p=.5,I=16;s.offsetX=f-R,s.offsetY=z-m,Math.abs(s.offsetY)<p*Math.abs(s.offsetX)&&(s.left&&f<R-I&&s.left(s),s.right&&f>R+I&&s.right(s)),Math.abs(s.offsetX)<p*Math.abs(s.offsetY)&&(s.up&&z<m-I&&s.up(s),s.down&&z>m+I&&s.down(s))};function ml(s,R){var m;const f=s.changedTouches[0];R.touchstartX=f.clientX,R.touchstartY=f.clientY,(m=R.start)==null||m.call(R,{originalEvent:s,...R})}function vl(s,R){var m;const f=s.changedTouches[0];R.touchendX=f.clientX,R.touchendY=f.clientY,(m=R.end)==null||m.call(R,{originalEvent:s,...R}),cl(R)}function fl(s,R){var m;const f=s.changedTouches[0];R.touchmoveX=f.clientX,R.touchmoveY=f.clientY,(m=R.move)==null||m.call(R,{originalEvent:s,...R})}function pl(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const R={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:s.left,right:s.right,up:s.up,down:s.down,start:s.start,move:s.move,end:s.end};return{touchstart:f=>ml(f,R),touchend:f=>vl(f,R),touchmove:f=>fl(f,R)}}function gl(s,R){var S;const f=R.value,m=f!=null&&f.parent?s.parentElement:s,z=(f==null?void 0:f.options)??{passive:!0},p=(S=R.instance)==null?void 0:S.$.uid;if(!m||!p)return;const I=pl(R.value);m._touchHandlers=m._touchHandlers??Object.create(null),m._touchHandlers[p]=I,Nt(I).forEach(c=>{m.addEventListener(c,I[c],z)})}function _l(s,R){var p,I;const f=(p=R.value)!=null&&p.parent?s.parentElement:s,m=(I=R.instance)==null?void 0:I.$.uid;if(!(f!=null&&f._touchHandlers)||!m)return;const z=f._touchHandlers[m];Nt(z).forEach(S=>{f.removeEventListener(S,z[S])}),delete f._touchHandlers[m]}const ea={mounted:gl,unmounted:_l},ta=Symbol.for("vuetify:v-window"),aa=Symbol.for("vuetify:v-window-group"),la=nt({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:s=>typeof s=="boolean"||s==="hover"},touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},...Wt(),...jt(),...va()},"VWindow"),$t=st()({name:"VWindow",directives:{Touch:ea},props:la(),emits:{"update:modelValue":s=>!0},setup(s,R){let{slots:f}=R;const{themeClasses:m}=da(s),{isRtl:z}=ca(),{t:p}=Ot(),I=ma(s,aa),S=E(),c=ce(()=>z.value?!s.reverse:s.reverse),k=Xe(!1),ee=ce(()=>{const r=s.direction==="vertical"?"y":"x",U=(c.value?!k.value:k.value)?"-reverse":"";return`v-window-${r}${U}-transition`}),x=Xe(0),O=E(void 0),te=ce(()=>I.items.value.findIndex(r=>I.selected.value.includes(r.id)));we(te,(r,v)=>{const U=I.items.value.length,g=U-1;U<=2?k.value=r<v:r===g&&v===0?k.value=!0:r===0&&v===g?k.value=!1:k.value=r<v}),pa(ta,{transition:ee,isReversed:k,transitionCount:x,transitionHeight:O,rootRef:S});const J=Ge(()=>s.continuous||te.value!==0),B=Ge(()=>s.continuous||te.value!==I.items.value.length-1);function me(){J.value&&I.prev()}function fe(){B.value&&I.next()}const G=ce(()=>{const r=[],v={icon:z.value?s.nextIcon:s.prevIcon,class:`v-window__${c.value?"right":"left"}`,onClick:I.prev,"aria-label":p("$vuetify.carousel.prev")};r.push(J.value?f.prev?f.prev({props:v}):e(K,v,null):e("div",null,null));const U={icon:z.value?s.prevIcon:s.nextIcon,class:`v-window__${c.value?"left":"right"}`,onClick:I.next,"aria-label":p("$vuetify.carousel.next")};return r.push(B.value?f.next?f.next({props:U}):e(K,U,null):e("div",null,null)),r}),X=ce(()=>s.touch===!1?s.touch:{...{left:()=>{c.value?me():fe()},right:()=>{c.value?fe():me()},start:v=>{let{originalEvent:U}=v;U.stopPropagation()}},...s.touch===!0?{}:s.touch});return it(()=>Gt(e(s.tag,{ref:S,class:["v-window",{"v-window--show-arrows-on-hover":s.showArrows==="hover"},m.value,s.class],style:s.style},{default:()=>{var r,v;return[e("div",{class:"v-window__container",style:{height:O.value}},[(r=f.default)==null?void 0:r.call(f,{group:I}),s.showArrows!==!1&&e("div",{class:"v-window__controls"},[G.value])]),(v=f.additional)==null?void 0:v.call(f,{group:I})]}}),[[fa("touch"),X.value]])),{group:I}}}),oa=nt({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...Wt(),..._a(),...ul()},"VWindowItem"),vt=st()({name:"VWindowItem",directives:{Touch:ea},props:oa(),emits:{"group:selected":s=>!0},setup(s,R){let{slots:f}=R;const m=Xt(ta),z=ga(s,aa),{isBooted:p}=Ma();if(!m||!z)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const I=Xe(!1),S=ce(()=>p.value&&(m.isReversed.value?s.reverseTransition!==!1:s.transition!==!1));function c(){!I.value||!m||(I.value=!1,m.transitionCount.value>0&&(m.transitionCount.value-=1,m.transitionCount.value===0&&(m.transitionHeight.value=void 0)))}function k(){var J;I.value||!m||(I.value=!0,m.transitionCount.value===0&&(m.transitionHeight.value=St((J=m.rootRef.value)==null?void 0:J.clientHeight)),m.transitionCount.value+=1)}function ee(){c()}function x(J){I.value&&ht(()=>{!S.value||!I.value||!m||(m.transitionHeight.value=St(J.clientHeight))})}const O=ce(()=>{const J=m.isReversed.value?s.reverseTransition:s.transition;return S.value?{name:typeof J!="string"?m.transition.value:J,onBeforeEnter:k,onAfterEnter:c,onEnterCancelled:ee,onBeforeLeave:k,onAfterLeave:c,onLeaveCancelled:ee,onEnter:x}:!1}),{hasContent:te}=rl(s,z.isSelected);return it(()=>e(Wa,{transition:O.value,disabled:!p.value},{default:()=>{var J;return[Gt(e("div",{class:["v-window-item",z.selectedClass.value,s.class],style:s.style},[te.value&&((J=f.default)==null?void 0:J.call(f))]),[[ka,z.isSelected.value]])]}})),{groupItem:z}}}),kl=nt({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Za({filterKeys:["title"]}),...Ka({hideNoData:!0,returnObject:!0}),...Tt(Fa({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Ga({transition:!1})},"VCombobox"),yl=st()({name:"VCombobox",props:kl(),emits:{"update:focused":s=>!0,"update:modelValue":s=>!0,"update:search":s=>!0,"update:menu":s=>!0},setup(s,R){var u;let{emit:f,slots:m}=R;const{t:z}=Ot(),p=E(),I=Xe(!1),S=Xe(!0),c=Xe(!1),k=E(),ee=E(),x=Xe(-1);let O=!1;const{items:te,transformIn:J,transformOut:B}=Ea(s),{textColorClasses:me,textColorStyles:fe}=Jt(()=>{var a;return(a=p.value)==null?void 0:a.color}),G=xt(s,"modelValue",[],a=>J(ya(a)),a=>{const h=B(a);return s.multiple?h:h[0]??null}),X=Ba(s),r=ce(()=>!!(s.chips||m.chip)),v=ce(()=>r.value||!!m.selection),U=Xe(!s.multiple&&!v.value?((u=G.value[0])==null?void 0:u.title)??"":""),g=ce({get:()=>U.value,set:a=>{var h;if(U.value=a??"",!s.multiple&&!v.value&&(G.value=[mt(s,a)]),a&&s.multiple&&((h=s.delimiters)!=null&&h.length)){const F=a.split(new RegExp(`(?:${s.delimiters.join("|")})+`));F.length>1&&(F.forEach(q=>{q=q.trim(),q&&Ie(mt(s,q))}),U.value="")}a||(x.value=-1),S.value=!a}}),P=ce(()=>typeof s.counterValue=="function"?s.counterValue(G.value):typeof s.counterValue=="number"?s.counterValue:s.multiple?G.value.length:g.value.length),{filteredItems:n,getMatches:y}=Qa(s,te,()=>S.value?"":g.value),A=ce(()=>s.hideSelected?n.value.filter(a=>!G.value.some(h=>h.value===a.value)):n.value),ne=ce(()=>s.hideNoData&&!A.value.length||X.isReadonly.value||X.isDisabled.value),ie=xt(s,"menu"),ve=ce({get:()=>ie.value,set:a=>{var h;ie.value&&!a&&((h=k.value)!=null&&h.Î¨openChildren.size)||a&&ne.value||(ie.value=a)}}),L=Ge(()=>ve.value?s.closeText:s.openText);we(U,a=>{O?ht(()=>O=!1):I.value&&!ve.value&&(ve.value=!0),f("update:search",a)}),we(G,a=>{var h;!s.multiple&&!v.value&&(U.value=((h=a[0])==null?void 0:h.title)??"")});const H=ce(()=>G.value.map(a=>a.value)),b=ce(()=>{var h;return(s.autoSelectFirst===!0||s.autoSelectFirst==="exact"&&g.value===((h=A.value[0])==null?void 0:h.title))&&A.value.length>0&&!S.value&&!c.value}),o=E(),i=Ra(o,p);function T(a){O=!0,s.openOnClear&&(ve.value=!0)}function _e(){ne.value||(ve.value=!0)}function Q(a){ne.value||(I.value&&(a.preventDefault(),a.stopPropagation()),ve.value=!ve.value)}function ke(a){var h;a.key!==" "&&Ft(a)&&((h=p.value)==null||h.focus())}function Te(a){var q,$,V,W;if(ba(a)||X.isReadonly.value)return;const h=(q=p.value)==null?void 0:q.selectionStart,F=G.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(a.key)&&a.preventDefault(),["Enter","ArrowDown"].includes(a.key)&&(ve.value=!0),["Escape"].includes(a.key)&&(ve.value=!1),["Enter","Escape","Tab"].includes(a.key)&&(b.value&&["Enter","Tab"].includes(a.key)&&!G.value.some(C=>{let{value:ue}=C;return ue===A.value[0].value})&&Ie(n.value[0]),S.value=!0),a.key==="ArrowDown"&&b.value&&(($=o.value)==null||$.focus("next")),a.key==="Enter"&&g.value&&(Ie(mt(s,g.value)),v.value&&(U.value="")),["Backspace","Delete"].includes(a.key)){if(!s.multiple&&v.value&&G.value.length>0&&!g.value)return Ie(G.value[0],!1);if(~x.value){a.preventDefault();const C=x.value;Ie(G.value[x.value],!1),x.value=C>=F-1?F-2:C}else a.key==="Backspace"&&!g.value&&(x.value=F-1);return}if(s.multiple)if(a.key==="ArrowLeft"){if(x.value<0&&h&&h>0)return;const C=x.value>-1?x.value-1:F-1;G.value[C]?x.value=C:(x.value=-1,(V=p.value)==null||V.setSelectionRange(g.value.length,g.value.length))}else if(a.key==="ArrowRight"){if(x.value<0)return;const C=x.value+1;G.value[C]?x.value=C:(x.value=-1,(W=p.value)==null||W.setSelectionRange(0,0))}else~x.value&&Ft(a)&&(x.value=-1)}function re(){var a;s.eager&&((a=ee.value)==null||a.calculateVisibleItems())}function Me(){var a;I.value&&(S.value=!0,(a=p.value)==null||a.focus())}function Ie(a){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!a||a.props.disabled))if(s.multiple){const F=G.value.findIndex($=>(s.valueComparator||Bt)($.value,a.value)),q=h??!~F;if(~F){const $=q?[...G.value,a]:[...G.value];$.splice(F,1),G.value=$}else q&&(G.value=[...G.value,a]);s.clearOnSelect&&(g.value="")}else{const F=h!==!1;G.value=F?[a]:[],U.value=F&&!v.value?a.title:"",ht(()=>{ve.value=!1,S.value=!0})}}function Ze(a){I.value=!0,setTimeout(()=>{c.value=!0})}function et(a){c.value=!1}function Re(a){(a==null||a===""&&!s.multiple&&!v.value)&&(G.value=[])}return we(I,(a,h)=>{if(!(a||a===h)&&(x.value=-1,ve.value=!1,g.value)){if(s.multiple){Ie(mt(s,g.value));return}if(!v.value)return;G.value.some(F=>{let{title:q}=F;return q===g.value})?U.value="":Ie(mt(s,g.value))}}),we(ve,()=>{if(!s.hideSelected&&ve.value&&G.value.length){const a=A.value.findIndex(h=>G.value.some(F=>(s.valueComparator||Bt)(F.value,h.value)));ha&&window.requestAnimationFrame(()=>{var h;a>=0&&((h=ee.value)==null||h.scrollToIndex(a))})}}),we(()=>s.items,(a,h)=>{ve.value||I.value&&!h.length&&a.length&&(ve.value=!0)}),it(()=>{const a=!!(!s.hideNoData||A.value.length||m["prepend-item"]||m["append-item"]||m["no-data"]),h=G.value.length>0,F=xe.filterProps(s);return e(xe,ye({ref:p},F,{modelValue:g.value,"onUpdate:modelValue":[q=>g.value=q,Re],focused:I.value,"onUpdate:focused":q=>I.value=q,validationValue:G.externalValue,counterValue:P.value,dirty:h,class:["v-combobox",{"v-combobox--active-menu":ve.value,"v-combobox--chips":!!s.chips,"v-combobox--selection-slot":!!v.value,"v-combobox--selecting-index":x.value>-1,[`v-combobox--${s.multiple?"multiple":"single"}`]:!0},s.class],style:s.style,readonly:X.isReadonly.value,placeholder:h?void 0:s.placeholder,"onClick:clear":T,"onMousedown:control":_e,onKeydown:Te}),{...m,default:()=>e($e,null,[e(ll,ye({ref:k,modelValue:ve.value,"onUpdate:modelValue":q=>ve.value=q,activator:"parent",contentClass:"v-combobox__content",disabled:ne.value,eager:s.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:s.transition,onAfterEnter:re,onAfterLeave:Me},s.menuProps),{default:()=>[a&&e(Vt,ye({ref:o,selected:H.value,selectStrategy:s.multiple?"independent":"single-independent",onMousedown:q=>q.preventDefault(),onKeydown:ke,onFocusin:Ze,onFocusout:et,tabindex:"-1","aria-live":"polite",color:s.itemColor??s.color},i,s.listProps),{default:()=>{var q,$,V;return[(q=m["prepend-item"])==null?void 0:q.call(m),!A.value.length&&!s.hideNoData&&((($=m["no-data"])==null?void 0:$.call(m))??e(Qe,{key:"no-data",title:z(s.noDataText)},null)),e(qa,{ref:ee,renderless:!0,items:A.value,itemKey:"value"},{default:W=>{var Pe;let{item:C,index:ue,itemRef:pe}=W;const he=ye(C.props,{ref:pe,key:C.value,active:b.value&&ue===0?!0:void 0,onClick:()=>Ie(C,null)});return((Pe=m.item)==null?void 0:Pe.call(m,{item:C,index:ue,props:he}))??e(Qe,ye(he,{role:"option"}),{prepend:De=>{let{isSelected:He}=De;return e($e,null,[s.multiple&&!s.hideSelected?e(ol,{key:C.value,modelValue:He,ripple:!1,tabindex:"-1"},null):void 0,C.props.prependAvatar&&e(Se,{image:C.props.prependAvatar},null),C.props.prependIcon&&e(D,{icon:C.props.prependIcon},null)])},title:()=>{var De;return S.value?C.title:el("v-combobox",C.title,(De=y(C))==null?void 0:De.title)}})}}),(V=m["append-item"])==null?void 0:V.call(m)]}})]}),G.value.map((q,$)=>{function V(pe){pe.stopPropagation(),pe.preventDefault(),Ie(q,!1)}const W={"onClick:close":V,onKeydown(pe){pe.key!=="Enter"&&pe.key!==" "||(pe.preventDefault(),pe.stopPropagation(),V(pe))},onMousedown(pe){pe.preventDefault(),pe.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},C=r.value?!!m.chip:!!m.selection,ue=C?wa(r.value?m.chip({item:q,index:$,props:W}):m.selection({item:q,index:$})):void 0;if(!(C&&!ue))return e("div",{key:q.value,class:["v-combobox__selection",$===x.value&&["v-combobox__selection--selected",me.value]],style:$===x.value?fe.value:{}},[r.value?m.chip?e(Pa,{key:"chip-defaults",defaults:{VChip:{closable:s.closableChips,size:"small",text:q.title}}},{default:()=>[ue]}):e(ge,ye({key:"chip",closable:s.closableChips,size:"small",text:q.title,disabled:q.props.disabled},W),null):ue??e("span",{class:"v-combobox__selection-text"},[q.title,s.multiple&&$<G.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[_(",")])])])})]),"append-inner":function(){var W,C;for(var q=arguments.length,$=new Array(q),V=0;V<q;V++)$[V]=arguments[V];return e($e,null,[(W=m["append-inner"])==null?void 0:W.call(m,...$),(!s.hideNoData||s.items.length)&&s.menuIcon?e(D,{class:"v-combobox__menu-icon",color:(C=p.value)==null?void 0:C.fieldIconColor,icon:s.menuIcon,onMousedown:Q,onClick:xa,"aria-label":z(L.value),title:z(L.value),tabindex:"-1"},null):void 0])}})}),Zt({isFocused:I,isPristine:S,menu:ve,search:g,selectionIndex:x,filteredItems:n,select:Ie},p)}}),Ht=Symbol.for("vuetify:v-tabs"),bl=nt({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...Tt(Va({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),bt=st()({name:"VTab",props:bl(),setup(s,R){let{slots:f,attrs:m}=R;const{textColorClasses:z,textColorStyles:p}=Jt(()=>s.sliderColor),I=E(),S=E(),c=ce(()=>s.direction==="horizontal"),k=ce(()=>{var x,O;return((O=(x=I.value)==null?void 0:x.group)==null?void 0:O.isSelected.value)??!1});function ee(x){var te,J;let{value:O}=x;if(O){const B=(J=(te=I.value)==null?void 0:te.$el.parentElement)==null?void 0:J.querySelector(".v-tab--selected .v-tab__slider"),me=S.value;if(!B||!me)return;const fe=getComputedStyle(B).color,G=B.getBoundingClientRect(),X=me.getBoundingClientRect(),r=c.value?"x":"y",v=c.value?"X":"Y",U=c.value?"right":"bottom",g=c.value?"width":"height",P=G[r],n=X[r],y=P>n?G[U]-X[U]:G[r]-X[r],A=Math.sign(y)>0?c.value?"right":"bottom":Math.sign(y)<0?c.value?"left":"top":"center",ie=(Math.abs(y)+(Math.sign(y)<0?G[g]:X[g]))/Math.max(G[g],X[g])||0,ve=G[g]/X[g]||0,L=1.5;tl(me,{backgroundColor:[fe,"currentcolor"],transform:[`translate${v}(${y}px) scale${v}(${ve})`,`translate${v}(${y/L}px) scale${v}(${(ie-1)/L+1})`,"none"],transformOrigin:Array(3).fill(A)},{duration:225,easing:al})}}return it(()=>{const x=K.filterProps(s);return e(K,ye({symbol:Ht,ref:I,class:["v-tab",s.class],style:s.style,tabindex:k.value?0:-1,role:"tab","aria-selected":String(k.value),active:!1},x,m,{block:s.fixed,maxWidth:s.fixed?300:void 0,"onGroup:selected":ee}),{...f,default:()=>{var O;return e($e,null,[((O=f.default)==null?void 0:O.call(f))??s.text,!s.hideSlider&&e("div",{ref:S,class:["v-tab__slider",z.value],style:p.value},null)])}})}),Zt({},I)}}),hl=nt({...Tt(la(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),xl=st()({name:"VTabsWindow",props:hl(),emits:{"update:modelValue":s=>!0},setup(s,R){let{slots:f}=R;const m=Xt(Ht,null),z=xt(s,"modelValue"),p=ce({get(){var I;return z.value!=null||!m?z.value:(I=m.items.value.find(S=>m.selected.value.includes(S.id)))==null?void 0:I.value},set(I){z.value=I}});return it(()=>{const I=$t.filterProps(s);return e($t,ye({_as:"VTabsWindow"},I,{modelValue:p.value,"onUpdate:modelValue":S=>p.value=S,class:["v-tabs-window",s.class],style:s.style,mandatory:!1,touch:!1}),f)}),{}}}),wl=nt({...oa()},"VTabsWindowItem"),Pl=st()({name:"VTabsWindowItem",props:wl(),setup(s,R){let{slots:f}=R;return it(()=>{const m=vt.filterProps(s);return e(vt,ye({_as:"VTabsWindowItem"},m,{class:["v-tabs-window-item",s.class],style:s.style}),f)}),{}}});function Vl(s){return s?s.map(R=>Da(R)?R:{text:R,value:R}):[]}const Cl=nt({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...Ha({mandatory:"force",selectedClass:"v-tab-item--selected"}),...$a(),...jt()},"VTabs"),Sl=st()({name:"VTabs",props:Cl(),emits:{"update:modelValue":s=>!0},setup(s,R){let{attrs:f,slots:m}=R;const z=xt(s,"modelValue"),p=ce(()=>Vl(s.items)),{densityClasses:I}=Ca(s),{backgroundColorClasses:S,backgroundColorStyles:c}=Sa(()=>s.bgColor),{scopeId:k}=dl();return Ia({VTab:{color:Ge(()=>s.color),direction:Ge(()=>s.direction),stacked:Ge(()=>s.stacked),fixed:Ge(()=>s.fixedTabs),sliderColor:Ge(()=>s.sliderColor),hideSlider:Ge(()=>s.hideSlider)}}),it(()=>{const ee=Rt.filterProps(s),x=!!(m.window||s.items.length>0);return e($e,null,[e(Rt,ye(ee,{modelValue:z.value,"onUpdate:modelValue":O=>z.value=O,class:["v-tabs",`v-tabs--${s.direction}`,`v-tabs--align-tabs-${s.alignTabs}`,{"v-tabs--fixed-tabs":s.fixedTabs,"v-tabs--grow":s.grow,"v-tabs--stacked":s.stacked},I.value,S.value,s.class],style:[{"--v-tabs-height":St(s.height)},c.value,s.style],role:"tablist",symbol:Ht},k,f),{default:()=>{var O;return[((O=m.default)==null?void 0:O.call(m))??p.value.map(te=>{var J;return((J=m.tab)==null?void 0:J.call(m,{item:te}))??e(bt,ye(te,{key:te.text,value:te.value}),{default:m[`tab.${te.value}`]?()=>{var B;return(B=m[`tab.${te.value}`])==null?void 0:B.call(m,{item:te})}:void 0})})]}}),x&&e(xl,ye({modelValue:z.value,"onUpdate:modelValue":O=>z.value=O,key:"tabs-window"},k),{default:()=>{var O;return[p.value.map(te=>{var J;return((J=m.item)==null?void 0:J.call(m,{item:te}))??e(Pl,{value:te.value},{default:()=>{var B;return(B=m[`item.${te.value}`])==null?void 0:B.call(m,{item:te})}})}),(O=m.window)==null?void 0:O.call(m)]}})])}),{}}}),Il={class:"d-flex align-center gap-3"},$l={class:"text-body-2 ma-0 opacity-90"},Dl={class:"d-flex align-center gap-4"},Tl={class:"flex-grow-1"},Ul={class:"text-h6 font-weight-bold mb-1"},zl={class:"text-body-2 text-medium-emphasis mb-1"},Al={class:"d-flex align-center gap-4 mb-0"},Hl={class:"text-body-2 text-medium-emphasis mb-0"},Ml={class:"text-body-2 text-info mb-0 font-weight-medium"},El={key:0,class:"text-body-2 text-success mb-0 font-weight-medium"},Bl={class:"text-body-1 font-weight-bold"},Fl={class:"text-body-1 font-weight-bold"},Rl={class:"text-body-1 font-weight-bold"},Kl={class:"text-body-1 font-weight-bold"},ql={class:"d-flex align-center justify-space-between w-100"},Ll={class:"d-flex align-center"},Nl={key:0,class:"text-warning"},Ol={key:1},jl={key:0,class:"text-center pa-8"},Wl={class:"d-flex align-center gap-4 mt-1"},Gl={key:1,class:"text-primary"},Xl={class:"d-flex gap-2"},Jl=qe({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup(s,{emit:R}){const f=s,m=R,z=ce({get:()=>f.modelValue,set:u=>m("update:modelValue",u)}),p=E(!1),I=E([]),S=E(!1),c=E(!1),k=E(""),ee=E(""),x=E(!1),O=E(-1),te=E(!1),{loading:J,currentHPPBreakdown:B,getProductHPPBreakdown:me}=Dt(),fe=ce(()=>{var u,a,h;return((u=B.value)==null?void 0:u.total_hpp)||((a=f.product)==null?void 0:a.hpp)||((h=f.product)==null?void 0:h.cost)||0}),G=ce(()=>{var h;const u=((h=f.product)==null?void 0:h.price)||0,a=fe.value;return u-a}),X=ce(()=>{var h;const u=((h=f.product)==null?void 0:h.price)||0,a=fe.value;return u<=0?0:Math.round((u-a)/u*100)}),r=E({itemId:null,quantity:1,unit:"pcs",isCritical:!1}),v=E([]),U=E(!1),g=E([]),P=async()=>{var u;if(f.product)try{const a=f.product.id_product||f.product.id;console.log("ðŸ”„ Fetching composition for product ID:",a);const h=await yt.getAll({product_id:a,page:1,per_page:1e5});h.success&&((u=h.data)!=null&&u.data)&&(I.value=h.data.data,g.value=JSON.parse(JSON.stringify(h.data.data)),console.log("âœ… Initial composition loaded:",g.value.length,"items"))}catch(a){console.error("Error fetching product composition:",a)}},n=async()=>{var u;U.value=!0;try{const a=await ra.getAll({page:1,per_page:1e5,active:!0});a.success&&((u=a.data)!=null&&u.data)&&(v.value=a.data.data.map(h=>{var F,q,$;return{id:((F=h.id_item)==null?void 0:F.toString())||((q=h.id)==null?void 0:q.toString()),name:h.name,current_stock:(($=h.inventory)==null?void 0:$.current_stock)||0,unit:h.unit||"pcs"}}))}catch(a){console.error("Error fetching available items:",a),v.value=[]}finally{U.value=!1}},y=ce(()=>r.value.itemId&&r.value.quantity>0&&r.value.unit.trim().length>0),A=ce(()=>{if(!r.value.itemId)return null;const u=v.value.find(a=>a.id===r.value.itemId);return(u==null?void 0:u.unit)||null}),ne=ce(()=>{if(!r.value.itemId)return null;const u=v.value.find(a=>a.id===r.value.itemId);return u?L(u):null}),ie=ce(()=>ne.value!==null&&ne.value<=0),ve=ce(()=>Array.isArray(v.value)?v.value:[]),L=u=>u.current_stock||u.stock||0,H=()=>U.value?"Memuat items...":!v.value||v.value.length===0?"Tidak ada item tersedia":"Tidak ada item yang ditemukan",b=u=>{const a=L(u);return a>50?"success":a>20?"warning":a>0?"error":"grey"},o=u=>{const a=L(u);return a>50?"Aman":a>20?"Rendah":a>0?"Kritis":"Habis"};we(()=>r.value.itemId,u=>{if(u){const a=v.value.find(h=>h.id===u);a!=null&&a.unit&&(r.value.unit=a.unit)}}),we(()=>f.items,u=>{u&&u.length>0,I.value=[...u]},{immediate:!0}),we(()=>f.modelValue,async u=>{u&&f.product&&(P(),await i())});const i=async()=>{if(f.product&&(f.product.id_product||f.product.id))try{const u=parseInt(String(f.product.id_product||f.product.id));await me(u,"latest")}catch(u){console.warn("Could not load HPP data:",u)}};dt(()=>{n()});const T=()=>{te.value=!0},_e=async()=>{await i(),m("refresh")},Q=()=>I.value.some(a=>{var h;return((h=a.item)==null?void 0:h.inventory)&&a.item.inventory.current_stock<a.quantity_needed})?"error":"success",ke=()=>I.value.some(a=>{var h;return((h=a.item)==null?void 0:h.inventory)&&a.item.inventory.current_stock<a.quantity_needed})?"Stok Kritis":"Stok Aman",Te=()=>{if(!y.value)return;const u=v.value.find(F=>F.id===r.value.itemId);if(!u)return;if(I.value.find(F=>{var q;return((q=F.item)==null?void 0:q.id)===u.id})){k.value=`Item "${u.name}" sudah ada dalam komposisi produk ini`,S.value=!0;return}const h={id_product_item:`temp_${Date.now()}`,item:{id:String(u.id),name:u.name,inventory:{current_stock:u.current_stock||0}},quantity_needed:r.value.quantity,unit:r.value.unit,is_critical:r.value.isCritical};I.value.push(h),Ie()},re=(u,a)=>{var q;if(console.log("ðŸ” EditItem called with:",u),console.log("ðŸ” Item structure:",JSON.stringify(u,null,2)),v.value.length===0){console.warn("âš ï¸ Available items not loaded yet, fetching..."),n().then(()=>{console.log("âœ… Available items loaded, retrying edit"),re(u,a)});return}x.value=!0,O.value=a;let h=((q=u.item)==null?void 0:q.id)||null;h!==null&&(h=h.toString()),console.log("ðŸŽ¯ Found itemId (converted to string):",h),console.log("ðŸ” Available items for reference:",v.value.map($=>({id:$.id,name:$.name}))),r.value={itemId:h,quantity:parseFloat(u.quantity_needed.toString())||0,unit:u.unit,isCritical:u.is_critical},console.log("ðŸ“ Form data set for edit:",{original_quantity:u.quantity_needed,parsed_quantity:parseFloat(u.quantity_needed.toString()),form_data:r.value});const F=v.value.find($=>$.id===h);if(F)console.log("âœ… Item found in available items:",F.name);else{console.warn("âš ï¸ Item ID not found in available items, trying alternative matching...");const $=v.value.find(V=>{var W;return V.name===((W=u.item)==null?void 0:W.name)});$?(console.log("âœ… Found item by name matching, using ID:",$.id),r.value.itemId=$.id):console.error("âŒ Could not find item in available items by ID or name")}},Me=()=>{if(!y.value||O.value===-1)return;const u=v.value.find(a=>a.id===r.value.itemId);u&&(I.value[O.value]={...I.value[O.value],item:{id:String(u.id),name:u.name,inventory:{current_stock:u.current_stock||0}},quantity_needed:r.value.quantity,unit:r.value.unit,is_critical:r.value.isCritical},Ie())},Ie=()=>{x.value=!1,O.value=-1,r.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},Ze=u=>{I.value.splice(u,1)},et=async()=>{var u,a,h,F,q,$,V,W,C,ue,pe,he,Pe,De,He,Le,tt,at,lt,ct,_t,kt;if(f.product){p.value=!0;try{console.log("ðŸ’¾ Saving composition for product:",f.product.name),console.log("ðŸ“¦ Items to save:",I.value);const rt=parseInt(String(((u=f.product)==null?void 0:u.id_product)||((a=f.product)==null?void 0:a.id)||"0")),be=g.value||[],Z=I.value;console.log("ðŸ”„ Comparing items for save:",{existing_count:be.length,current_count:Z.length,existing_items:be.map(ae=>{var le,Ue;return{id:ae.id_product_item,item_id:(le=ae.item)==null?void 0:le.id,item_name:(Ue=ae.item)==null?void 0:Ue.name}}),current_items:Z.map(ae=>{var le,Ue;return{id:ae.id_product_item,item_id:(le=ae.item)==null?void 0:le.id,item_name:(Ue=ae.item)==null?void 0:Ue.name,quantity:ae.quantity_needed,unit:ae.unit}})}),console.log("ðŸ”„ Starting to process",Z.length,"items for save...");for(const ae of Z){const le=be.find(ot=>{var Mt,Et;return!!(ot.id_product_item===ae.id_product_item||ae.id_product_item&&!ae.id_product_item.toString().startsWith("temp_")&&((Mt=ot.item)==null?void 0:Mt.id)===((Et=ae.item)==null?void 0:Et.id))});if(console.log("ðŸ” Processing item:",{item_name:(h=ae.item)==null?void 0:h.name,item_id_product_item:ae.id_product_item,existing_found:!!le,existing_id:le==null?void 0:le.id_product_item,is_temp:(F=ae.id_product_item)==null?void 0:F.toString().startsWith("temp_"),matching_strategy:le?le.id_product_item===ae.id_product_item?"exact_id":"item_product_match":"no_match"}),!((q=ae.item)!=null&&q.id)||parseInt(ae.item.id)===0){console.warn("âš ï¸ Skipping item with invalid item_id:",{item_name:($=ae.item)==null?void 0:$.name,item_id:(V=ae.item)==null?void 0:V.id,full_item:ae});continue}const Ue={product_id:rt,item_id:parseInt(((W=ae.item)==null?void 0:W.id)||"0"),quantity_needed:parseFloat(ae.quantity_needed.toString()),unit:ae.unit,is_critical:ae.is_critical,notes:ae.notes||""};console.log("ðŸ“¤ API Data for item:",(C=ae.item)==null?void 0:C.name,{raw_item_id:(ue=ae.item)==null?void 0:ue.id,parsed_item_id:parseInt(((pe=ae.item)==null?void 0:pe.id)||"0"),api_data:Ue,full_item_data:{id_product_item:ae.id_product_item,item_name:(he=ae.item)==null?void 0:he.name,quantity:ae.quantity_needed,unit:ae.unit}});try{le&&!((Pe=ae.id_product_item)!=null&&Pe.toString().startsWith("temp_"))?(console.log("âœï¸ Updating existing item:",{id:le.id_product_item,item_name:(De=ae.item)==null?void 0:De.name,current_stock:(Le=(He=ae.item)==null?void 0:He.inventory)==null?void 0:Le.current_stock}),await yt.update(parseInt(le.id_product_item||"0"),Ue)):(console.log("âž• Creating new item:",{item_name:(tt=ae.item)==null?void 0:tt.name,current_stock:(lt=(at=ae.item)==null?void 0:at.inventory)==null?void 0:lt.current_stock,id_product_item:ae.id_product_item,is_temp:(ct=ae.id_product_item)==null?void 0:ct.toString().startsWith("temp_"),existing_item_found:!!le}),await yt.create(Ue))}catch(ot){throw console.error("âŒ Error processing item:",ot),(_t=ot.message)!=null&&_t.includes("already assigned")?k.value=`Item "${(kt=ae.item)==null?void 0:kt.name}" sudah ditambahkan ke produk ini`:k.value=ot.message||"Terjadi kesalahan saat menyimpan item",S.value=!0,ot}}for(const ae of be)if(!Z.find(Ue=>Ue.id_product_item===ae.id_product_item)&&ae.id_product_item)try{console.log("ðŸ—‘ï¸ Deleting item:",ae.id_product_item),await yt.delete(parseInt(ae.id_product_item))}catch(Ue){console.error("âŒ Error deleting item:",Ue),k.value=`Gagal menghapus item: ${Ue.message}`,S.value=!0}console.log("âœ… Composition saved successfully!"),ee.value="Komposisi produk berhasil disimpan!",c.value=!0,m("save",{product:f.product,items:I.value}),m("refresh"),Re()}catch(rt){console.error("âŒ Error saving composition:",rt),S.value||(k.value=rt.message||"Terjadi kesalahan saat menyimpan komposisi",S.value=!0)}finally{p.value=!1}}},Re=()=>{z.value=!1,setTimeout(()=>{I.value=[...f.items],Ie()},300)};return(u,a)=>{var h,F,q,$;return w(),oe($e,null,[e(Oe,{modelValue:z.value,"onUpdate:modelValue":a[9]||(a[9]=V=>z.value=V),"max-width":"900",persistent:""},{default:t(()=>[e(se,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var V;return[l("div",Il,[e(D,{icon:"mdi-chef-hat",size:"24"}),l("div",null,[a[12]||(a[12]=l("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),l("p",$l,d(((V=u.product)==null?void 0:V.name)||"Produk"),1)])]),e(K,{icon:"mdi-close",variant:"text",size:"small",onClick:Re})]}),_:1}),e(de,{class:"pa-6"},{default:t(()=>[e(se,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(de,{class:"pa-4"},{default:t(()=>{var V,W,C,ue,pe,he;return[l("div",Dl,[e(Se,{image:(V=u.product)==null?void 0:V.image_url,size:"64"},{default:t(()=>{var Pe;return[(Pe=u.product)!=null&&Pe.image_url?Y("",!0):(w(),j(D,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),l("div",Tl,[l("h4",Ul,d((W=u.product)==null?void 0:W.name),1),l("p",zl," SKU: "+d(((C=u.product)==null?void 0:C.sku)||"SKU-"+((ue=u.product)==null?void 0:ue.id_product)),1),l("div",Al,[l("p",Hl," Harga: "+d(N(Ae)(((pe=u.product)==null?void 0:pe.price)||0)),1),l("p",Ml," HPP: "+d(N(Ae)(fe.value)),1),(he=u.product)!=null&&he.price&&fe.value?(w(),oe("p",El," Margin: "+d(N(Ae)(G.value)),1)):Y("",!0)])]),e(ge,{color:Q(),variant:"tonal"},{default:t(()=>[_(d(ke()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e(Ce,{class:"mb-6"},{default:t(()=>[e(M,{cols:"12",md:"3"},{default:t(()=>[e(se,{variant:"outlined",color:"info"},{default:t(()=>[e(de,{class:"text-center pa-3"},{default:t(()=>[e(D,{icon:"mdi-calculator",size:"20",class:"mb-1"}),l("div",Bl,[_(d(N(Ae)(fe.value))+" ",1),N(J)?(w(),j(Pt,{key:0,indeterminate:"",size:"12",width:"2",class:"ml-1"})):Y("",!0)]),a[13]||(a[13]=l("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[13]})]),_:1})]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(se,{variant:"outlined",color:"primary"},{default:t(()=>[e(de,{class:"text-center pa-3"},{default:t(()=>{var V;return[e(D,{icon:"mdi-currency-usd",size:"20",class:"mb-1"}),l("div",Fl,d(N(Ae)(((V=u.product)==null?void 0:V.price)||0)),1),a[14]||(a[14]=l("div",{class:"text-caption"},"Harga Jual",-1))]}),_:1,__:[14]})]),_:1})]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(se,{variant:"outlined",color:"success"},{default:t(()=>[e(de,{class:"text-center pa-3"},{default:t(()=>[e(D,{icon:"mdi-trending-up",size:"20",class:"mb-1"}),l("div",Rl,d(N(Ae)(G.value)),1),a[15]||(a[15]=l("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[15]})]),_:1})]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(se,{variant:"outlined",color:"warning"},{default:t(()=>[e(de,{class:"text-center pa-3"},{default:t(()=>[e(D,{icon:"mdi-percent",size:"20",class:"mb-1"}),l("div",Kl,d(X.value)+"% ",1),a[16]||(a[16]=l("div",{class:"text-caption"},"Margin %",-1))]),_:1,__:[16]})]),_:1})]),_:1})]),_:1}),e(se,{class:"mb-6",elevation:"2"},{default:t(()=>[e(Ve,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[l("div",ql,[l("div",Ll,[e(D,{icon:x.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),_(" "+d(x.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(de,{class:"pa-4"},{default:t(()=>[e(Ce,null,{default:t(()=>[e(M,{cols:"12",md:"4"},{default:t(()=>[e(zt,{modelValue:r.value.itemId,"onUpdate:modelValue":a[0]||(a[0]=V=>r.value.itemId=V),items:ve.value,loading:U.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item (termasuk yang stok kosong)...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":H()},{item:t(({props:V,item:W})=>[e(Qe,ye(V,{class:{"text-medium-emphasis":L(W.raw)<=0}}),{prepend:t(()=>[e(Se,{size:"32",class:"me-3",color:L(W.raw)<=0?"warning":"primary",variant:"tonal"},{default:t(()=>[e(D,{icon:"mdi-package-variant",color:L(W.raw)<=0?"warning":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[L(W.raw)>0?(w(),j(ge,{key:0,size:"x-small",color:b(W.raw),variant:"tonal"},{default:t(()=>[_(d(o(W.raw)),1)]),_:2},1032,["color"])):(w(),j(ge,{key:1,size:"x-small",color:"warning",variant:"tonal","prepend-icon":"mdi-alert"},{default:t(()=>a[18]||(a[18]=[_(" Kosong ")])),_:1,__:[18]}))]),default:t(()=>[e(ft,null,{default:t(()=>[_(d(W.raw.name),1)]),_:2},1024),e(pt,{class:"text-medium-emphasis"},{default:t(()=>[L(W.raw)<=0?(w(),oe("span",Nl,[e(D,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),a[17]||(a[17]=_(" Stok Kosong - Masih bisa digunakan "))])):(w(),oe("span",Ol," Stok: "+d(L(W.raw))+" "+d(W.raw.unit),1))]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:r.value.quantity,"onUpdate:modelValue":a[1]||(a[1]=V=>r.value.quantity=V),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:r.value.unit,"onUpdate:modelValue":a[2]||(a[2]=V=>r.value.unit=V),label:"Satuan",variant:"outlined",placeholder:"kg, pcs, ml",readonly:!!A.value,hint:A.value?`Satuan dari item: ${A.value}`:"","persistent-hint":""},null,8,["modelValue","readonly","hint"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(gt,{modelValue:r.value.isCritical,"onUpdate:modelValue":a[3]||(a[3]=V=>r.value.isCritical=V),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(K,{color:x.value?"success":"primary",block:"","prepend-icon":x.value?"mdi-check":"mdi-plus",onClick:a[4]||(a[4]=V=>x.value?Me():Te()),disabled:!y.value},{default:t(()=>[_(d(x.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),x.value?(w(),j(K,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:Ie},{default:t(()=>a[19]||(a[19]=[_(" Batal ")])),_:1,__:[19]})):Y("",!0)]),_:1})]),_:1}),ie.value?(w(),j(Be,{key:0,color:"warning",variant:"tonal",class:"mt-4","prepend-icon":"mdi-alert"},{default:t(()=>[e(wt,null,{default:t(()=>a[20]||(a[20]=[_("Item Stok Kosong")])),_:1,__:[20]}),a[21]||(a[21]=l("div",null,"Item yang dipilih sedang kosong stok, namun masih bisa ditambahkan ke komposisi. Pastikan untuk memperbarui stok sebelum produksi.",-1))]),_:1,__:[21]})):Y("",!0)]),_:1})]),_:1}),e(se,{elevation:"2"},{default:t(()=>[e(Ve,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e(D,{icon:"mdi-format-list-bulleted",class:"me-2"}),_(" Daftar Item Komposisi ("+d(I.value.length)+") ",1)]),_:1}),e(de,{class:"pa-0"},{default:t(()=>[I.value.length===0?(w(),oe("div",jl,[e(D,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),a[22]||(a[22]=l("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),a[23]||(a[23]=l("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(w(),j(Vt,{key:1},{default:t(()=>[(w(!0),oe($e,null,Je(I.value,(V,W)=>(w(),j(Qe,{key:V.id||W,class:"border-b"},{prepend:t(()=>[e(Se,{size:"40",class:"me-3"},{default:t(()=>{var C,ue;return[e(D,{icon:(C=V.item)!=null&&C.inventory&&V.item.inventory.current_stock>=V.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(ue=V.item)!=null&&ue.inventory&&V.item.inventory.current_stock>=V.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[l("div",Xl,[e(K,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:C=>re(V,W)},null,8,["onClick"]),e(K,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:C=>Ze(W)},null,8,["onClick"])])]),default:t(()=>[e(ft,{class:"font-weight-medium"},{default:t(()=>{var C;return[_(d(((C=V.item)==null?void 0:C.name)||"Item tidak ditemukan")+" ",1),V.is_critical?(w(),j(ge,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>a[24]||(a[24]=[_(" Kritis ")])),_:1,__:[24]})):Y("",!0)]}),_:2},1024),e(pt,null,{default:t(()=>{var C;return[l("div",Wl,[l("span",null,"Dibutuhkan: "+d(parseFloat(V.quantity_needed))+" "+d(V.unit),1),(C=V.item)!=null&&C.inventory?(w(),oe("span",{key:0,class:Ye(V.item.inventory.current_stock>=V.quantity_needed?"text-success":"text-error")}," Stok: "+d(V.item.inventory.current_stock)+" "+d(V.unit),3)):Y("",!0),V.formatted_total_cost?(w(),oe("span",Gl,d(V.formatted_total_cost),1)):Y("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(Ke,{class:"pa-6 pt-0"},{default:t(()=>[e(K,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:T},{default:t(()=>a[25]||(a[25]=[_(" Setting HPP ")])),_:1,__:[25]}),e(je),e(K,{variant:"outlined",onClick:Re},{default:t(()=>a[26]||(a[26]=[_(" Batal ")])),_:1,__:[26]}),e(K,{color:"primary",onClick:et,loading:p.value},{default:t(()=>a[27]||(a[27]=[_(" Simpan Komposisi ")])),_:1,__:[27]},8,["loading"])]),_:1})]),_:1}),e(ut,{modelValue:S.value,"onUpdate:modelValue":a[6]||(a[6]=V=>S.value=V),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(K,{color:"white",variant:"text",onClick:a[5]||(a[5]=V=>S.value=!1)},{default:t(()=>a[28]||(a[28]=[_(" Tutup ")])),_:1,__:[28]})]),default:t(()=>[_(d(k.value)+" ",1)]),_:1},8,["modelValue"]),e(ut,{modelValue:c.value,"onUpdate:modelValue":a[8]||(a[8]=V=>c.value=V),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(K,{color:"white",variant:"text",onClick:a[7]||(a[7]=V=>c.value=!1)},{default:t(()=>a[29]||(a[29]=[_(" Tutup ")])),_:1,__:[29]})]),default:t(()=>[_(d(ee.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(ua,{modelValue:te.value,"onUpdate:modelValue":a[10]||(a[10]=V=>te.value=V),"product-id":parseInt(String(((h=u.product)==null?void 0:h.id_product)||((F=u.product)==null?void 0:F.id)||"0")),"product-name":((q=u.product)==null?void 0:q.product_name)||(($=u.product)==null?void 0:$.name),onHppUpdated:_e,onPriceUpdated:a[11]||(a[11]=V=>m("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),sa=We(Jl,[["__scopeId","data-v-9c392eac"]]),Yl={class:"composition-cards"},Ql={key:1,class:"text-center pa-12"},Zl={key:2,class:"text-center pa-12"},eo={class:"d-flex align-center gap-3"},to={class:"flex-grow-1 min-width-0"},ao={class:"text-h6 font-weight-bold text-truncate"},lo={class:"text-caption text-medium-emphasis mb-0"},oo={class:"d-flex align-center gap-2 mb-3"},so={class:"text-body-2 font-weight-medium"},no={class:"composition-items"},io={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},ro={class:"text-body-2 text-truncate"},uo={class:"text-end flex-shrink-0"},co={class:"text-body-2 font-weight-medium"},mo={key:0,class:"text-caption text-success"},vo={key:1,class:"text-caption text-primary"},fo={class:"d-flex justify-between align-center mb-3"},po={class:"text-h6 font-weight-bold text-primary"},go={class:"d-flex gap-2"},_o={class:"d-flex align-center"},ko={class:"d-flex align-center gap-4"},yo={class:"flex-grow-1"},bo={class:"text-h5 font-weight-bold mb-2"},ho={class:"d-flex align-center gap-4 mb-2"},xo={class:"text-body-2"},wo={class:"d-flex align-center gap-4"},Po={class:"text-h6 text-primary font-weight-bold"},Vo={class:"text-body-2 text-info font-weight-medium"},Co={key:0,class:"text-body-2 text-success font-weight-medium"},So={class:"d-flex align-center mt-1 gap-4"},Io={class:"d-flex align-center"},$o={class:"d-flex align-center"},Do={key:0,class:"d-flex align-center"},To={class:"text-primary font-weight-medium"},Uo={key:1,class:"text-center py-8"},zo={class:"text-h6 font-weight-bold"},Ao={class:"text-h6 font-weight-bold"},Ho={class:"text-h6 font-weight-bold"},Mo={class:"text-h6 font-weight-bold"},Eo={class:"text-h6 font-weight-bold"},Bo=qe({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup(s,{emit:R}){const f=s,m=R,z=E(!1),p=E(!1),I=E(null),S=E([]),c=E(null),k=E({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),ee=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],x=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],O=P=>{I.value=P,S.value=P.items||[],z.value=!0},te=P=>{c.value=P,p.value=!0},J=P=>{console.log("Composition saved:",P),m("refresh")},B=()=>{k.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},me=ce(()=>!!(k.value.search||k.value.stockStatus||k.value.itemType||k.value.criticalOnly||k.value.sortBy!=="name_asc")),fe=ce(()=>{let P=0;return k.value.search&&P++,k.value.stockStatus&&P++,k.value.itemType&&P++,k.value.criticalOnly&&P++,k.value.sortBy!=="name_asc"&&P++,P}),G=ce(()=>{const P=new Map;f.productItems.forEach(y=>{if(!y.product)return;const A=y.product.id_product||y.product.id;P.has(A)||P.set(A,{...y.product,items:[],totalItems:0}),P.get(A).items.push(y),P.get(A).totalItems++});let n=Array.from(P.values());if(k.value.search){const y=k.value.search.toLowerCase();n=n.filter(A=>A.name.toLowerCase().includes(y)||A.sku&&A.sku.toLowerCase().includes(y)||A.items.some(ne=>{var ie;return(ie=ne.item)==null?void 0:ie.name.toLowerCase().includes(y)}))}return k.value.stockStatus&&(n=n.filter(y=>{const A=X(y);switch(k.value.stockStatus){case"safe":return A.color==="success";case"critical":return A.color==="warning";case"out":return A.color==="error";default:return!0}})),k.value.criticalOnly&&(n=n.filter(y=>y.items.some(A=>A.is_critical))),n.sort((y,A)=>{switch(k.value.sortBy){case"name_asc":return y.name.localeCompare(A.name);case"name_desc":return A.name.localeCompare(y.name);case"price_asc":return(y.price||0)-(A.price||0);case"price_desc":return(A.price||0)-(y.price||0);case"items_asc":return y.totalItems-A.totalItems;case"items_desc":return A.totalItems-y.totalItems;default:return y.name.localeCompare(A.name)}}),n}),X=P=>{let n=!1,y=!1;return P.items.forEach(A=>{var ne;if((ne=A.item)!=null&&ne.inventory){const ie=A.item.inventory.current_stock||0,ve=A.quantity_needed||0;ie<=0?n=!0:(ie<ve||A.is_critical)&&(y=!0)}}),n?{text:"Stok Habis",color:"error"}:y?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},r=P=>{if(!(P!=null&&P.inventory))return"grey";const n=P.inventory.current_stock||0;return n<=0?"error":n<=10?"warning":"success"},v=P=>{if(!(P!=null&&P.inventory))return"Tidak ada data";const n=P.inventory.current_stock||0;return n<=0?"Habis":n<=10?"Rendah":"Aman"},U=P=>{const n=r(P);return{"text-error":n==="error","text-warning":n==="warning","text-success":n==="success","text-grey":n==="grey"}},g=P=>`Item Komposisi (${P})`;return(P,n)=>(w(),oe("div",Yl,[e(se,{class:"mb-6"},{default:t(()=>[e(Ve,{class:"d-flex align-center justify-between"},{default:t(()=>[n[12]||(n[12]=l("div",null,[l("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),l("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),e(K,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:n[0]||(n[0]=y=>m("refresh")),loading:P.loading},{default:t(()=>n[11]||(n[11]=[_(" Refresh ")])),_:1,__:[11]},8,["loading"])]),_:1,__:[12]})]),_:1}),e(se,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(de,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(M,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:k.value.search,"onUpdate:modelValue":n[1]||(n[1]=y=>k.value.search=y),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:k.value.stockStatus,"onUpdate:modelValue":n[2]||(n[2]=y=>k.value.stockStatus=y),items:ee,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:k.value.sortBy,"onUpdate:modelValue":n[3]||(n[3]=y=>k.value.sortBy=y),items:x,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(La,{modelValue:k.value.criticalOnly,"onUpdate:modelValue":n[4]||(n[4]=y=>k.value.criticalOnly=y),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Ce,{class:"mt-3"},{default:t(()=>[e(M,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(K,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:B,disabled:!me.value},{default:t(()=>n[13]||(n[13]=[_(" Reset Filter ")])),_:1,__:[13]},8,["disabled"]),me.value?(w(),j(ge,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[_(d(fe.value)+" filter aktif ",1)]),_:1})):Y("",!0)]),_:1}),e(M,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(ge,{color:G.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[_(d(G.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!P.loading&&G.value.length===0&&me.value?(w(),j(Be,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):Y("",!0),P.loading?(w(),oe("div",Ql,[e(Pt,{color:"primary",indeterminate:"",size:"64"}),n[14]||(n[14]=l("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):G.value.length===0?(w(),oe("div",Zl,[e(D,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),n[16]||(n[16]=l("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),n[17]||(n[17]=l("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(K,{color:"primary",size:"large","prepend-icon":"mdi-plus"},{default:t(()=>n[15]||(n[15]=[_(" Buat Komposisi Pertama ")])),_:1,__:[15]})])):(w(),j(Ce,{key:3},{default:t(()=>[(w(!0),oe($e,null,Je(G.value,y=>(w(),j(M,{key:y.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(se,{class:Ye(["composition-card h-100",{"border-error":X(y).color==="error"}]),elevation:"2"},{default:t(()=>[e(Ve,{class:"pa-4 pb-2"},{default:t(()=>[l("div",eo,[e(Se,{image:y.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[y.image_url?Y("",!0):(w(),j(D,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),l("div",to,[l("h3",ao,d(y.name),1),l("p",lo,d(y.sku||"SKU-"+y.id_product),1)])])]),_:2},1024),e(de,{class:"py-2"},{default:t(()=>[e(ge,{color:X(y).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[_(d(X(y).text),1)]),_:2},1032,["color"]),l("div",oo,[e(D,{icon:"mdi-format-list-bulleted",size:"16"}),l("span",so,d(g(y.totalItems)),1)]),l("div",no,[(w(!0),oe($e,null,Je(y.items,A=>{var ne,ie,ve,L;return w(),oe("div",{key:A.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[l("div",io,[e(D,{icon:(ne=A.item)!=null&&ne.inventory&&A.item.inventory.current_stock>=A.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(ie=A.item)!=null&&ie.inventory&&A.item.inventory.current_stock>=A.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),l("span",ro,d(((ve=A.item)==null?void 0:ve.name)||"Item tidak ditemukan"),1),A.is_critical?(w(),j(ge,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>n[18]||(n[18]=[_(" Kritis ")])),_:1,__:[18]})):Y("",!0)]),l("div",uo,[l("div",co,d(parseFloat(A.quantity_needed))+" "+d(A.unit),1),(L=A.item)!=null&&L.inventory?(w(),oe("div",mo," Stok: "+d(A.item.inventory.current_stock)+" "+d(A.unit),1)):Y("",!0),A.formatted_total_cost?(w(),oe("div",vo,d(A.formatted_total_cost),1)):Y("",!0)])])}),128))])]),_:2},1024),e(de,{class:"pt-0"},{default:t(()=>[e(ze,{class:"mb-3"}),l("div",fo,[n[19]||(n[19]=l("span",{class:"text-body-2"},"Harga:",-1)),l("span",po,d(N(Ae)(y.price||0)),1)]),l("div",go,[e(K,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:A=>te(y)},{default:t(()=>n[20]||(n[20]=[_(" Detail ")])),_:2,__:[20]},1032,["onClick"]),e(K,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:A=>O(y)},{default:t(()=>n[21]||(n[21]=[_(" Kelola ")])),_:2,__:[21]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(sa,{modelValue:z.value,"onUpdate:modelValue":n[5]||(n[5]=y=>z.value=y),product:I.value,items:S.value,onSave:J,onRefresh:n[6]||(n[6]=y=>m("refresh"))},null,8,["modelValue","product","items"]),e(Oe,{modelValue:p.value,"onUpdate:modelValue":n[10]||(n[10]=y=>p.value=y),"max-width":"900",scrollable:""},{default:t(()=>[e(se,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",_o,[e(D,{icon:"mdi-eye",class:"mr-2",color:"primary"}),n[22]||(n[22]=l("span",null,"Detail Komposisi Produk",-1))]),e(K,{icon:"",variant:"text",onClick:n[7]||(n[7]=y=>p.value=!1)},{default:t(()=>[e(D,{icon:"mdi-close"})]),_:1})]),_:1}),e(ze),c.value?(w(),j(de,{key:0},{default:t(()=>[e(Na,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(M,{cols:"12"},{default:t(()=>[e(se,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(de,null,{default:t(()=>[l("div",ko,[e(Se,{image:c.value.image_url,size:"80"},{default:t(()=>[c.value.image_url?Y("",!0):(w(),j(D,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),l("div",yo,[l("h2",bo,d(c.value.name),1),l("div",ho,[e(ge,{color:X(c.value).color,variant:"tonal",size:"small"},{default:t(()=>[_(d(X(c.value).text),1)]),_:1},8,["color"]),l("span",xo,"SKU: "+d(c.value.sku||"-"),1)]),l("div",wo,[l("div",Po,d(N(Ae)(c.value.price||0)),1),l("div",Vo," HPP: "+d(N(Ae)(c.value.hpp||c.value.cost||0)),1),c.value.price&&(c.value.hpp||c.value.cost)?(w(),oe("div",Co," Margin: "+d(N(Ae)((c.value.price||0)-(c.value.hpp||c.value.cost||0))),1)):Y("",!0)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e(Ce,null,{default:t(()=>[e(M,{cols:"12"},{default:t(()=>[e(se,{variant:"outlined"},{default:t(()=>[e(Ve,{class:"text-h6"},{default:t(()=>[e(D,{icon:"mdi-format-list-bulleted",class:"mr-2"}),_(" Komposisi Item ("+d(c.value.totalItems||0)+") ",1)]),_:1}),e(de,null,{default:t(()=>[c.value.items&&c.value.items.length>0?(w(),j(Vt,{key:0},{default:t(()=>[(w(!0),oe($e,null,Je(c.value.items,(y,A)=>(w(),j(Qe,{key:y.id_product_item,class:"px-0"},{prepend:t(()=>[e(Se,{size:"40",color:r(y.item),variant:"tonal"},{default:t(()=>{var ne;return[e(D,{icon:(ne=y.item)!=null&&ne.inventory&&y.item.inventory.current_stock>=y.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(ge,{color:r(y.item),variant:"tonal",size:"small"},{default:t(()=>[_(d(v(y.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(ft,{class:"font-weight-medium"},{default:t(()=>{var ne;return[_(d(((ne=y.item)==null?void 0:ne.name)||"Unknown Item")+" ",1),y.is_critical?(w(),j(ge,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>n[23]||(n[23]=[_(" Kritis ")])),_:1,__:[23]})):Y("",!0)]}),_:2},1024),e(pt,null,{default:t(()=>{var ne,ie;return[l("div",So,[l("div",Io,[e(D,{icon:"mdi-scale",size:"14",class:"mr-1"}),l("span",null," Kebutuhan: "+d(Number(y.quantity_needed||0).toLocaleString("id-ID"))+" "+d(y.unit),1)]),l("div",$o,[e(D,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),l("span",{class:Ye(U(y.item))}," Stok: "+d(Number(((ie=(ne=y.item)==null?void 0:ne.inventory)==null?void 0:ie.current_stock)||0).toLocaleString("id-ID"))+" "+d(y.unit),3)]),y.formatted_total_cost?(w(),oe("div",Do,[e(D,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),l("span",To,d(y.formatted_total_cost),1)])):Y("",!0)])]}),_:2},1024),A<c.value.items.length-1?(w(),j(ze,{key:0,class:"mt-3"})):Y("",!0)]),_:2},1024))),128))]),_:1})):(w(),oe("div",Uo,[e(D,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),n[24]||(n[24]=l("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(Ce,{class:"mt-4"},{default:t(()=>[e(M,{cols:"12",md:"2"},{default:t(()=>[e(se,{variant:"outlined",color:"primary"},{default:t(()=>[e(de,{class:"text-center"},{default:t(()=>[e(D,{icon:"mdi-format-list-bulleted",size:"24",class:"mb-2"}),l("div",zo,d(c.value.totalItems||0),1),n[25]||(n[25]=l("div",{class:"text-caption"},"Total Item",-1))]),_:1,__:[25]})]),_:1})]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(se,{variant:"outlined",color:"warning"},{default:t(()=>[e(de,{class:"text-center"},{default:t(()=>{var y;return[e(D,{icon:"mdi-alert",size:"24",class:"mb-2"}),l("div",Ao,d(((y=c.value.items)==null?void 0:y.filter(A=>A.is_critical).length)||0),1),n[26]||(n[26]=l("div",{class:"text-caption"},"Item Kritis",-1))]}),_:1,__:[26]})]),_:1})]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(se,{variant:"outlined",color:"info"},{default:t(()=>[e(de,{class:"text-center"},{default:t(()=>[e(D,{icon:"mdi-calculator",size:"24",class:"mb-2"}),l("div",Ho,d(N(Ae)(c.value.hpp||c.value.cost||0)),1),n[27]||(n[27]=l("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[27]})]),_:1})]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(se,{variant:"outlined",color:"success"},{default:t(()=>[e(de,{class:"text-center"},{default:t(()=>[e(D,{icon:"mdi-currency-usd",size:"24",class:"mb-2"}),l("div",Mo,d(N(Ae)(c.value.price||0)),1),n[28]||(n[28]=l("div",{class:"text-caption"},"Harga Jual",-1))]),_:1,__:[28]})]),_:1})]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(se,{variant:"outlined",color:"purple"},{default:t(()=>[e(de,{class:"text-center"},{default:t(()=>[e(D,{icon:"mdi-trending-up",size:"24",class:"mb-2"}),l("div",Eo,d(N(Ae)((c.value.price||0)-(c.value.hpp||c.value.cost||0))),1),n[29]||(n[29]=l("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[29]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):Y("",!0),e(ze),e(Ke,{class:"pa-4"},{default:t(()=>[e(je),e(K,{variant:"outlined",onClick:n[8]||(n[8]=y=>p.value=!1)},{default:t(()=>n[30]||(n[30]=[_(" Tutup ")])),_:1,__:[30]}),e(K,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:n[9]||(n[9]=()=>{p.value=!1,O(c.value)})},{default:t(()=>n[31]||(n[31]=[_(" Kelola Komposisi ")])),_:1,__:[31]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),Fo=We(Bo,[["__scopeId","data-v-4b5ad2d5"]]),Ro={class:"d-flex align-center gap-2"},Ko={class:"text-white"},qo={class:"text-h6 mb-4 d-flex align-center gap-2"},Lo={class:"text-h6 mb-4 d-flex align-center gap-2"},No={class:"d-flex flex-column gap-2"},Oo={key:0,class:"d-flex align-center gap-2"},jo={class:"d-flex align-center gap-2 mb-2"},Wo={class:"d-flex gap-2"},Go={class:"d-flex gap-2"},Xo={class:"d-flex align-center justify-space-between"},Jo={class:"d-flex align-center gap-2"},Yo={class:"text-end"},Qo={class:"text-h6 font-weight-bold"},Zo={class:"text-caption"},es={class:"text-h6 mb-4 d-flex align-center gap-2"},ts={class:"text-h6 mb-4 d-flex align-center gap-2"},as={class:"image-upload-container"},ls={key:0,class:"mb-4"},os={class:"text-center mt-2"},ss={class:"text-h6 mb-4 d-flex align-center gap-2"},ns={class:"text-h6 mb-4 d-flex align-center gap-2"},is={class:"d-flex align-center"},rs={class:"text-subtitle-1"},us={class:"text-body-1"},ds={class:"d-flex align-center"},cs={class:"text-subtitle-1"},ms=qe({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup(s,{emit:R}){var L,H,b;const f=Yt(),{nameRules:m,categoryRules:z}=Qt(),{getProductHPPBreakdown:p}=Dt(),I=E(!1),S=E(!1),c=async()=>{if(!(!x.editMode||!B.id))try{const o=await fetch(`/api/products/${B.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(o.ok){const i=await o.json();S.value=i.success&&i.data&&i.data.length>0}}catch(o){console.error("Error checking HPP status:",o)}},k=async()=>{if(B.id)try{I.value=!0;const o=await p(B.id,"latest");o&&(B.cost=o.total_hpp,te("update-form","cost",o.total_hpp))}catch(o){console.error("Error refreshing HPP:",o)}finally{I.value=!1}},ee=()=>{console.log("Open items setup for product:",B.id)},x=s,O=ce(()=>x.errorMessage),te=R,J=E(),B=It({...x.formData});we(()=>x.formData,o=>{Object.assign(B,o)},{deep:!0}),we(B,o=>{Object.keys(o).forEach(i=>{te("update-form",i,o[i])})},{deep:!0}),we(()=>x.modelValue,o=>{o&&x.editMode&&c()});const me=It({length:((L=x.formData.dimensions)==null?void 0:L.length)||null,width:((H=x.formData.dimensions)==null?void 0:H.width)||null,height:((b=x.formData.dimensions)==null?void 0:b.height)||null});we(me,o=>{const i=o.length!==null||o.width!==null||o.height!==null;B.dimensions=i?{length:o.length!==null?o.length:void 0,width:o.width!==null?o.width:void 0,height:o.height!==null?o.height:void 0}:{}},{deep:!0});const fe=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],G=ce(()=>{if(!B.price||!B.cost||B.cost<=0)return 0;const o=(B.price-B.cost)/B.cost*100;return Math.ceil(o)}),X=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),r=o=>o<10?"error":o<25?"warning":o<50?"success":"info",v=o=>o<10?"tabler-trending-down":o<25?"tabler-trending-up":o<50?"tabler-trending-up-2":"tabler-trending-up-3",U=o=>!o||o===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),g=o=>{if(!o||o.trim()===""||o==="Rp 0")return 0;const T=o.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(T)||0},P=E(!1),n=o=>{const i=g(o);B.price=i},y=()=>{P.value=!0},A=()=>{P.value=!1},ne=async()=>{var i;const{valid:o}=await((i=J.value)==null?void 0:i.validate());o&&te("submit",B)},ie=o=>{te("image-change",o)},ve=()=>{te("remove-image")};return(o,i)=>(w(),j(Oe,{"model-value":o.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":i[25]||(i[25]=T=>o.$emit("update:modelValue",T))},{default:t(()=>[e(se,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[l("div",Ro,[e(D,{icon:o.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),l("span",Ko,d(o.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(K,{icon:"tabler-x",variant:"text",color:"white",onClick:i[0]||(i[0]=T=>o.$emit("close"))})]),_:1}),e(ze),e(de,{class:"pa-6"},{default:t(()=>[e(At,{ref_key:"formRef",ref:J,onSubmit:Ut(ne,["prevent"])},{default:t(()=>[e(Ce,null,{default:t(()=>[e(M,{cols:"12"},{default:t(()=>[l("h6",qo,[e(D,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),i[26]||(i[26]=_(" Informasi Dasar "))])]),_:1}),e(M,{cols:"12",md:"8"},{default:t(()=>[e(xe,{modelValue:B.name,"onUpdate:modelValue":i[1]||(i[1]=T=>B.name=T),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:N(m),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:B.sku,"onUpdate:modelValue":i[2]||(i[2]=T=>B.sku=T),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(Kt,{modelValue:B.description,"onUpdate:modelValue":i[3]||(i[3]=T=>B.description=T),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>[e(Fe,{"model-value":B.category_id,"onUpdate:modelValue":i[4]||(i[4]=T=>B.category_id=T),items:o.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:N(z),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>[e(xe,{modelValue:B.brand,"onUpdate:modelValue":i[5]||(i[5]=T=>B.brand=T),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[l("h6",Lo,[e(D,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),i[27]||(i[27]=_(" Harga & Biaya "))])]),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>[e(xe,{"model-value":U(B.price),"onUpdate:modelValue":i[6]||(i[6]=T=>n(T)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:y,onBlur:A},null,8,["model-value"])]),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>[l("div",No,[e(xe,{"model-value":U(B.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),o.editMode?(w(),oe("div",Oo,[e(ge,{color:S.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e(D,{icon:S.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),_(" "+d(S.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),S.value?(w(),j(K,{key:0,size:"small",variant:"outlined",color:"primary",onClick:k,loading:I.value},{default:t(()=>[e(D,{icon:"tabler-refresh",size:"14",class:"me-1"}),i[28]||(i[28]=_(" Update HPP "))]),_:1,__:[28]},8,["loading"])):(w(),j(Ee,{key:1},{activator:t(({props:T})=>[e(ge,ye(T,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e(D,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),i[29]||(i[29]=_(" Belum Ada Resep "))]),_:2,__:[29]},1040)]),default:t(()=>[i[30]||(i[30]=l("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[30]}))])):Y("",!0)])]),_:1}),o.editMode?(w(),j(M,{key:0,cols:"12"},{default:t(()=>[S.value?(w(),j(Be,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(wt,null,{default:t(()=>[e(D,{icon:"tabler-info-circle",class:"me-2"}),i[31]||(i[31]=_(" HPP Otomatis Aktif "))]),_:1,__:[31]}),i[32]||(i[32]=l("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[32]})):(w(),j(Be,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(wt,null,{default:t(()=>[e(D,{icon:"tabler-alert-triangle",class:"me-2"}),i[33]||(i[33]=_(" HPP Manual "))]),_:1,__:[33]}),i[34]||(i[34]=l("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[34]}))]),_:1})):Y("",!0),e(M,{cols:"12"},{default:t(()=>[S.value&&o.editMode?(w(),j(Be,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[l("div",jo,[e(D,{icon:"tabler-check-circle"}),i[35]||(i[35]=l("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),i[38]||(i[38]=l("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),l("div",Wo,[e(K,{size:"small",color:"primary",variant:"outlined",onClick:ee},{default:t(()=>[e(D,{icon:"tabler-edit",size:"14",class:"me-1"}),i[36]||(i[36]=_(" Edit Resep "))]),_:1,__:[36]}),e(K,{size:"small",variant:"outlined",color:"info",onClick:k,loading:I.value},{default:t(()=>[e(D,{icon:"tabler-refresh",size:"14",class:"me-1"}),i[37]||(i[37]=_(" Refresh HPP "))]),_:1,__:[37]},8,["loading"])])]),_:1,__:[38]})):!S.value&&o.editMode?(w(),j(Be,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[l("div",Go,[e(K,{size:"small",variant:"outlined",color:"info",onClick:i[7]||(i[7]=T=>N(f).push("/hpp-management"))},{default:t(()=>[e(D,{icon:"tabler-calculator",size:"14",class:"me-1"}),i[39]||(i[39]=_(" Lihat HPP Management "))]),_:1,__:[39]})])]),_:1})):Y("",!0)]),_:1}),e(M,{cols:"12"},{default:t(()=>[B.price&&B.cost&&B.cost>0?(w(),j(Be,{key:0,color:r(G.value),variant:"tonal",class:"mb-0"},{default:t(()=>[l("div",Xo,[l("div",Jo,[e(D,{icon:v(G.value)},null,8,["icon"]),i[40]||(i[40]=l("span",{class:"font-weight-medium"},"Profit Margin",-1))]),l("div",Yo,[l("div",Qo,d(Math.round(G.value))+"%",1),l("div",Zo," Keuntungan: "+d(X(B.price-B.cost)),1)])])]),_:1},8,["color"])):Y("",!0)]),_:1}),e(M,{cols:"12"},{default:t(()=>[l("h6",es,[e(D,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),i[41]||(i[41]=_(" Dimensi (cm) "))])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:me.length,"onUpdate:modelValue":i[8]||(i[8]=T=>me.length=T),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:me.width,"onUpdate:modelValue":i[9]||(i[9]=T=>me.width=T),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:me.height,"onUpdate:modelValue":i[10]||(i[10]=T=>me.height=T),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[l("h6",ts,[e(D,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),i[42]||(i[42]=_(" Gambar Produk "))])]),_:1}),e(M,{cols:"12"},{default:t(()=>[l("div",as,[o.imagePreview?(w(),oe("div",ls,[e(Xa,{src:o.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),l("div",os,[e(K,{size:"small",color:"error",variant:"outlined",onClick:ve},{default:t(()=>i[43]||(i[43]=[_(" Hapus Gambar ")])),_:1,__:[43]})])])):Y("",!0),e(Ja,{"model-value":o.selectedImage,"onUpdate:modelValue":i[11]||(i[11]=T=>ie(Array.isArray(T)?T:[T])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),i[44]||(i[44]=l("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e(M,{cols:"12"},{default:t(()=>[l("h6",ss,[e(D,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),i[45]||(i[45]=_(" Pengaturan "))])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(Fe,{"model-value":B.status,"onUpdate:modelValue":i[12]||(i[12]=T=>B.status=T),items:fe,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(gt,{"model-value":B.active,"onUpdate:modelValue":i[13]||(i[13]=T=>B.active=T??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(M,{cols:"12",md:"4"},{default:t(()=>[e(gt,{"model-value":B.featured,"onUpdate:modelValue":i[14]||(i[14]=T=>B.featured=T??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[l("h6",ns,[e(D,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),i[46]||(i[46]=_(" SEO (Opsional) "))])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(xe,{modelValue:B.meta_title,"onUpdate:modelValue":i[15]||(i[15]=T=>B.meta_title=T),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(Kt,{modelValue:B.meta_description,"onUpdate:modelValue":i[16]||(i[16]=T=>B.meta_description=T),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(yl,{"model-value":B.tags,"onUpdate:modelValue":i[17]||(i[17]=T=>B.tags=T),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(ze),e(Ke,{class:"pa-6"},{default:t(()=>[e(je),e(K,{variant:"outlined",class:"coffee-secondary",onClick:i[18]||(i[18]=T=>o.$emit("close"))},{default:t(()=>i[47]||(i[47]=[_(" Batal ")])),_:1,__:[47]}),e(K,{color:"primary",class:"coffee-primary",loading:o.loading,onClick:ne},{default:t(()=>[_(d(o.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),o.useDialogError?Y("",!0):(w(),j(ut,{key:0,"model-value":!!O.value,"onUpdate:modelValue":i[20]||(i[20]=T=>!T&&o.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(K,{icon:"tabler-x",size:"small",variant:"text",onClick:i[19]||(i[19]=T=>o.$emit("clear-error"))})]),default:t(()=>[l("div",is,[e(D,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),l("div",null,[i[48]||(i[48]=l("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),l("div",rs,d(O.value),1)])])]),_:1},8,["model-value"])),o.useDialogError?(w(),j(Oe,{key:1,"model-value":!!O.value,"onUpdate:modelValue":i[22]||(i[22]=T=>!T&&o.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(se,null,{default:t(()=>[e(Ve,{class:"d-flex align-center text-error"},{default:t(()=>[e(D,{icon:"tabler-alert-circle",class:"me-2"}),i[49]||(i[49]=_(" Error Occurred "))]),_:1,__:[49]}),e(ze),e(de,{class:"py-4"},{default:t(()=>[l("div",us,d(O.value),1)]),_:1}),e(ze),e(Ke,{class:"justify-end pa-4"},{default:t(()=>[e(K,{color:"error",variant:"outlined",onClick:i[21]||(i[21]=T=>o.$emit("clear-error"))},{default:t(()=>i[50]||(i[50]=[_(" Close ")])),_:1,__:[50]})]),_:1})]),_:1})]),_:1},8,["model-value"])):Y("",!0),e(ut,{"model-value":!!o.successMessage,"onUpdate:modelValue":i[24]||(i[24]=T=>!T&&o.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(K,{icon:"tabler-x",size:"small",variant:"text",onClick:i[23]||(i[23]=T=>o.$emit("clear-success"))})]),default:t(()=>[l("div",ds,[e(D,{icon:"tabler-check-circle",class:"me-3",size:"28"}),l("div",null,[i[51]||(i[51]=l("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),l("div",cs,d(o.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),vs=We(ms,[["__scopeId","data-v-66fc4b3b"]]),fs={key:0,class:"mt-4"},ps={class:"d-flex align-center gap-2 mb-2"},gs={class:"d-flex flex-wrap gap-2"},_s=qe({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup(s,{emit:R}){const f=s,m=R,{categories:z,loading:p,fetchCategories:I}=Ya(),S=E(!1),c=E("");dt(()=>{I(),c.value=k.search||""});const k=It({...f.filters});we(()=>f.filters,X=>{Object.assign(k,X),c.value=X.search||""},{deep:!0}),Ta(c,X=>{console.log("ðŸ” Search query changed:",X),k.search=X,X.length>=3||X.length===0?(console.log("âœ… Triggering search with query:",X),S.value=!0,m("search",X),J(),setTimeout(()=>{S.value=!1},500)):console.log("â³ Query too short, waiting for more characters:",X.length)},{debounce:500,maxWait:1e3});const ee=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],x=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],O=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],te=ce(()=>!!(c.value||k.category_id||k.active||k.stock_status||k.featured!==null||k.min_price||k.max_price)),J=()=>{m("update:filters",{...k})},B=()=>{c.value="",Object.assign(k,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),J()},me=X=>{const r=z.value.find(v=>v.id_category===X);return(r==null?void 0:r.name)||"Unknown"},fe=X=>{if(!X)return"Semua";const r=ee.find(v=>v.value===X);return(r==null?void 0:r.title)||String(X)},G=X=>{const r=x.find(v=>v.value===X);return(r==null?void 0:r.title)||X};return(X,r)=>(w(),j(se,{class:"mb-6"},{default:t(()=>[e(Ve,{class:"d-flex align-center gap-2"},{default:t(()=>[e(D,{icon:"tabler-filter",class:"coffee-icon"}),r[11]||(r[11]=_(" Filter & Pencarian Produk "))]),_:1,__:[11]}),e(de,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(M,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:c.value,"onUpdate:modelValue":r[0]||(r[0]=v=>c.value=v),label:"Cari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:S.value,clearable:"",variant:"outlined",hint:c.value.length>0&&c.value.length<3?`Ketik ${3-c.value.length} karakter lagi untuk mencari`:"","persistent-hint":""},null,8,["modelValue","loading","hint"])]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:k.category_id,"onUpdate:modelValue":[r[1]||(r[1]=v=>k.category_id=v),J],items:N(z),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:N(p),clearable:"",variant:"outlined"},null,8,["modelValue","items","loading"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(Fe,{modelValue:k.active,"onUpdate:modelValue":[r[2]||(r[2]=v=>k.active=v),J],items:ee,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(Fe,{modelValue:k.stock_status,"onUpdate:modelValue":[r[3]||(r[3]=v=>k.stock_status=v),J],items:x,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(K,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:B})]),_:1})]),_:1}),e(Ce,{class:"mt-3"},{default:t(()=>[e(M,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:k.min_price,"onUpdate:modelValue":r[4]||(r[4]=v=>k.min_price=v),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:J},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:k.max_price,"onUpdate:modelValue":r[5]||(r[5]=v=>k.max_price=v),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:J},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(Fe,{modelValue:k.sort_order,"onUpdate:modelValue":[r[6]||(r[6]=v=>k.sort_order=v),J],items:O,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),te.value?(w(),oe("div",fs,[l("div",ps,[e(D,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),r[12]||(r[12]=l("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),l("div",gs,[c.value?(w(),j(ge,{key:0,closable:"",size:"small",color:"coffee","onClick:close":r[7]||(r[7]=v=>{c.value="",k.search="",J()})},{default:t(()=>[_(" Pencarian: "+d(c.value),1)]),_:1})):Y("",!0),k.category_id?(w(),j(ge,{key:1,closable:"",size:"small",color:"coffee","onClick:close":r[8]||(r[8]=v=>{k.category_id=null,J()})},{default:t(()=>[_(" Kategori: "+d(me(k.category_id)),1)]),_:1})):Y("",!0),k.active?(w(),j(ge,{key:2,closable:"",size:"small",color:"coffee","onClick:close":r[9]||(r[9]=v=>{k.active=null,J()})},{default:t(()=>[_(" Status: "+d(fe(k.active)),1)]),_:1})):Y("",!0),k.stock_status?(w(),j(ge,{key:3,closable:"",size:"small",color:"coffee","onClick:close":r[10]||(r[10]=v=>{k.stock_status=null,J()})},{default:t(()=>[_(" Stok: "+d(G(k.stock_status)),1)]),_:1})):Y("",!0)])])):Y("",!0)]),_:1})]),_:1}))}}),ks=We(_s,[["__scopeId","data-v-1afc3ae3"]]),ys={class:"d-flex align-center gap-2"},bs={class:"text-h6"},hs={class:"d-flex align-center gap-2"},xs={class:"text-h6"},ws={class:"d-flex align-center gap-2"},Ps={class:"text-h6"},Vs={class:"d-flex align-center gap-2"},Cs={class:"text-h6"},Ss={class:"d-flex align-center gap-2"},Is={class:"text-h6"},$s={class:"d-flex align-center gap-2"},Ds={class:"text-h6"},Ts={class:"d-flex align-center gap-2"},Us={class:"text-h6"},zs={class:"d-flex align-center gap-2"},As={class:"text-h6"},Hs=qe({__name:"ProductStatsCards",props:{stats:{}},setup(s){const R=m=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),f=m=>`${m.toFixed(1)}%`;return(m,z)=>(w(),j(Ce,{class:"mb-6"},{default:t(()=>[e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(se,{class:"stats-card"},{default:t(()=>[e(de,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-package"})]),_:1}),l("div",null,[z[0]||(z[0]=l("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),l("div",ys,[l("h6",bs,d(((p=m.stats)==null?void 0:p.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(se,{class:"stats-card"},{default:t(()=>[e(de,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-check"})]),_:1}),l("div",null,[z[1]||(z[1]=l("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),l("div",hs,[l("h6",xs,d(((p=m.stats)==null?void 0:p.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(se,{class:"stats-card"},{default:t(()=>[e(de,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-star"})]),_:1}),l("div",null,[z[2]||(z[2]=l("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),l("div",ws,[l("h6",Ps,d(((p=m.stats)==null?void 0:p.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(se,{class:"stats-card"},{default:t(()=>[e(de,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-alert-triangle"})]),_:1}),l("div",null,[z[3]||(z[3]=l("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),l("div",Vs,[l("h6",Cs,d(((p=m.stats)==null?void 0:p.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(se,{class:"stats-card"},{default:t(()=>[e(de,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-currency-dollar"})]),_:1}),l("div",null,[z[4]||(z[4]=l("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),l("div",Ss,[l("h6",Is,d(R(((p=m.stats)==null?void 0:p.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(se,{class:"stats-card"},{default:t(()=>[e(de,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-chart-line"})]),_:1}),l("div",null,[z[5]||(z[5]=l("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),l("div",$s,[l("h6",Ds,d(R(((p=m.stats)==null?void 0:p.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(se,{class:"stats-card"},{default:t(()=>[e(de,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-trending-up"})]),_:1}),l("div",null,[z[6]||(z[6]=l("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),l("div",Ts,[l("h6",Us,d(f(((p=m.stats)==null?void 0:p.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(M,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(se,{class:"stats-card"},{default:t(()=>[e(de,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-x-circle"})]),_:1}),l("div",null,[z[7]||(z[7]=l("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),l("div",zs,[l("h6",As,d(((p=m.stats)==null?void 0:p.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),Ms=We(Hs,[["__scopeId","data-v-124783ae"]]),Es={class:"d-flex align-center gap-2"},Bs={class:"d-flex align-center gap-2"},Fs={class:"text-center py-8"},Rs={class:"d-flex align-center gap-3 py-2"},Ks={class:"font-weight-medium"},qs={class:"text-caption text-medium-emphasis"},Ls={class:"text-end"},Ns={class:"font-weight-medium"},Os={class:"text-caption text-medium-emphasis d-flex align-center justify-end gap-1"},js={class:"text-center profit-margin-container"},Ws={class:"text-center"},Gs={key:0,class:"text-caption text-medium-emphasis mt-1"},Xs={class:"d-flex align-center gap-2"},Js={class:"text-body-2"},Ys={class:"text-caption text-medium-emphasis"},Qs={class:"d-flex align-center gap-1"},Zs=300*1e3,en=1e3,tn=qe({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","bulk-delete","update:page","update:items-per-page","update:sort-by","update:selected-products"],setup(s,{expose:R}){const f=s,{currentHPPBreakdown:m,getProductHPPBreakdown:z}=Dt(),p=E({}),I=E({}),S=E({}),c=E(new Set),k=E(new Set);let ee=null;const x=g=>{const P=S.value[g];return P?Date.now()-P.timestamp<Zs:!1},O=async()=>{if(k.value.size===0)return;const g=Array.from(k.value);k.value.clear();const P=g.filter(y=>{const A=f.products.find(ne=>(ne.id_product||ne.id)===y);return A&&(A.hpp===void 0||A.hpp===null)});if(P.length===0){console.log("All products have HPP from backend, skipping API calls");return}console.log(`Loading HPP for ${P.length}/${g.length} products (others have backend HPP)`);const n=3;for(let y=0;y<P.length;y+=n){const ne=P.slice(y,y+n).map(async ie=>{var ve;if(!(I.value[ie]||x(ie))){I.value[ie]=!0,c.value.add(ie);try{if(await z(ie,"latest"),(ve=m.value)!=null&&ve.total_hpp){const L=m.value.total_hpp;p.value[ie]=L,S.value[ie]={data:L,timestamp:Date.now(),attempted:!0}}else S.value[ie]={data:0,timestamp:Date.now(),attempted:!0}}catch(L){console.warn(`Could not load HPP for product ${ie}:`,L),S.value[ie]={data:0,timestamp:Date.now(),attempted:!0}}finally{I.value[ie]=!1}}});await Promise.all(ne),y+n<g.length&&await new Promise(ie=>setTimeout(ie,500))}},te=g=>{if(x(g)){p.value[g]=S.value[g].data;return}c.value.has(g)||(k.value.add(g),ee&&clearTimeout(ee),ee=setTimeout(()=>{O()},en))},J=()=>{for(const g of f.products){const P=g.id_product||g.id;P&&(x(P)?p.value[P]=S.value[P].data:!c.value.has(P)&&!I.value[P]&&te(P))}},B=g=>{const P=g.id_product||g.id;return p.value[P]||g.cost||0},me=g=>{const P=B(g),n=g.price||0;return n<=0||P<=0?0:Math.round((n-P)/n*100)};Ua(()=>{f.products&&f.products.length>0&&J()}),dt(()=>{f.products&&f.products.length>0&&J()}),R({refreshHPPData:async g=>{g?(delete S.value[g],delete p.value[g],c.value.delete(g),f.products.find(n=>(n.id_product||n.id)===g)&&te(g)):(S.value={},p.value={},c.value.clear(),k.value.clear(),J())}});const G=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],X=g=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(g),r=g=>new Date(g).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),v=g=>new Date(g).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),U=g=>g<10?"error":g<25?"warning":g<50?"success":"info";return(g,P)=>(w(),j(se,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",Es,[e(D,{icon:"tabler-list",class:"coffee-icon"}),P[7]||(P[7]=_(" Data Produk ")),g.totalItems?(w(),j(ge,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[_(d(g.totalItems)+" item ",1)]),_:1})):Y("",!0)]),l("div",Bs,[g.selectedProducts.length>0?(w(),j(K,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:P[0]||(P[0]=n=>g.$emit("bulk-delete"))},{default:t(()=>[_(" Hapus Terpilih ("+d(g.selectedProducts.length)+") ",1)]),_:1})):Y("",!0),e(K,{"prepend-icon":"tabler-plus",color:"coffee",onClick:P[1]||(P[1]=n=>g.$emit("add-product"))},{default:t(()=>P[8]||(P[8]=[_(" Tambah Produk ")])),_:1,__:[8]})])]),_:1}),e(ze),e(sl,{"model-value":g.selectedProducts,"onUpdate:modelValue":P[3]||(P[3]=n=>g.$emit("update:selected-products",n)),headers:G,items:g.products,"items-length":g.totalItems,loading:g.loading,"items-per-page":g.itemsPerPage,page:g.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:page":P[4]||(P[4]=n=>g.$emit("update:page",n)),"onUpdate:itemsPerPage":P[5]||(P[5]=n=>g.$emit("update:items-per-page",n)),"onUpdate:sortBy":P[6]||(P[6]=n=>g.$emit("update:sort-by",n))},{loading:t(()=>[e(nl,{type:"table-row@10"})]),"no-data":t(()=>[l("div",Fs,[e(D,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),P[10]||(P[10]=l("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),P[11]||(P[11]=l("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(K,{"prepend-icon":"tabler-plus",color:"coffee",onClick:P[2]||(P[2]=n=>g.$emit("add-product"))},{default:t(()=>P[9]||(P[9]=[_(" Tambah Produk Pertama ")])),_:1,__:[9]})])]),"item.name":t(({item:n})=>[l("div",Rs,[e(Se,{image:n.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[n.image_url?Y("",!0):(w(),j(D,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),l("div",null,[l("div",Ks,d(n.name),1),l("div",qs," SKU: "+d(n.sku||"-"),1)])])]),"item.category":t(({item:n})=>[e(ge,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var y;return[_(d(((y=n.category)==null?void 0:y.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:n})=>[l("div",Ls,[l("div",Ns,d(X(n.price)),1),l("div",Os,[l("span",null,"HPP: "+d(X(B(n))),1),I.value[n.id_product||n.id]&&B(n)>0?(w(),j(Pt,{key:0,indeterminate:"",size:"12",width:"2"})):Y("",!0)])])]),"item.profit_margin":t(({item:n})=>[l("div",js,[e(ge,{color:U(me(n)),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[_(d(me(n))+"% ",1)]),_:2},1032,["color"])])]),"item.stock":t(({item:n})=>[l("div",Ws,[e(ge,{color:n.stock_status==="out_of_stock"?"error":n.stock_status==="low_stock"?"warning":"success",size:"small",variant:"tonal"},{default:t(()=>[_(d(n.stock_status==="out_of_stock"?"Habis":n.stock_status==="low_stock"?"Rendah":"Aman"),1)]),_:2},1032,["color"]),n.min_stock?(w(),oe("div",Gs," Min: "+d(n.min_stock),1)):Y("",!0)])]),"item.active":t(({item:n})=>[l("div",Xs,[e(ge,{color:n.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[_(d(n.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),n.featured?(w(),j(Ee,{key:0,text:"Produk Unggulan"},{activator:t(({props:y})=>[e(D,ye(y,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):Y("",!0)])]),"item.created_at":t(({item:n})=>[l("div",Js,d(r(n.created_at??"")),1),l("div",Ys,d(v((n==null?void 0:n.created_at)??"")),1)]),"item.actions":t(({item:n})=>[l("div",Qs,[e(Ee,{text:"Kelola Komposisi"},{activator:t(({props:y})=>[e(K,ye(y,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:A=>g.$emit("open-composition-dialog",n)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Kelola Variant"},{activator:t(({props:y})=>[e(K,ye(y,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:A=>g.$emit("open-variant-dialog",n)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Edit Produk"},{activator:t(({props:y})=>[e(K,ye(y,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:A=>g.$emit("edit-product",n)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:n.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:y})=>{var A;return[e(K,ye(y,{icon:n.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:n.active?"success":"error",loading:((A=g.toggleLoading)==null?void 0:A[n.id_product])||!1,onClick:ne=>g.$emit("toggle-active",n)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Ee,{text:n.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:y})=>[e(K,ye(y,{icon:n.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:n.featured?"warning":"default",onClick:A=>g.$emit("toggle-featured",n)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Ee,{text:"Hapus Produk"},{activator:t(({props:y})=>[e(K,ye(y,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:A=>g.$emit("delete-product",n)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),an=We(tn,[["__scopeId","data-v-f1645e56"]]),ln={class:"d-flex align-center gap-3"},on={class:"text-h5 font-weight-bold"},sn={class:"text-h6"},nn={class:"text-body-1"},rn={class:"d-flex flex-column"},un={class:"font-weight-medium"},dn={class:"text-caption text-grey-darken-1"},cn={class:"font-weight-medium"},mn={key:0,class:"text-caption"},vn={key:1,class:"text-grey-lighten-1 text-caption"},fn={class:"v-data-table__footer"},pn={class:"pa-4 d-flex justify-space-between align-center"},gn={class:"text-subtitle-1 font-weight-bold"},_n={class:"text-subtitle-2 text-uppercase"},kn={class:"text-h6 font-weight-bold my-2"},yn={class:"text-caption"},na=qe({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup(s,{emit:R}){const f=s,m=R,z=E(!1),p=E(null),I=E(null),S=E(!1),c=E(!1),k=E("latest"),ee=E(0),x=E(0),O=E(""),te=E(0),J=E(!1),B=E(!1),me=E(""),fe=E(""),G=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],X=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],r=L=>!L||L===0?"":new Intl.NumberFormat("id-ID").format(L),v=L=>{if(!L)return 0;const H=L.replace(/[^\d]/g,"");return parseInt(H)||0},U=L=>{var b;const H=v(L);if(x.value=H,O.value=r(H),(b=p.value)!=null&&b.total_hpp&&H>0){const o=p.value.total_hpp;ee.value=o>0?Math.round((H-o)/o*100):0}else ee.value=0},g=L=>Ae(L),P=async(L,H)=>{z.value=!0;try{await new Promise(b=>setTimeout(b,500)),p.value={total_hpp:15e4,method:H,calculated_at:new Date().toISOString(),items:[{item_name:"Tepung Terigu",item_code:"TPNG001",quantity_needed:.5,unit:"kg",cost_per_unit:15e3,total_cost:7500,is_critical:!1,notes:null},{item_name:"Gula Pasir",item_code:"GUL001",quantity_needed:.25,unit:"kg",cost_per_unit:12e3,total_cost:3e3,is_critical:!1,notes:null},{item_name:"Telur Ayam",item_code:"TLR001",quantity_needed:3,unit:"pcs",cost_per_unit:3e3,total_cost:9e3,is_critical:!0,notes:"Price volatile"}]},S.value=!0}catch(b){console.error("Error loading HPP breakdown:",b),S.value=!1}finally{z.value=!1}},n=async(L,H)=>{z.value=!0;try{if(await new Promise(b=>setTimeout(b,1e3)),p.value){switch(H){case"latest":p.value.total_hpp=Math.round(p.value.total_hpp*1.1);break;case"average":p.value.total_hpp=Math.round(p.value.total_hpp*1.05);break;default:p.value.total_hpp=Math.round(p.value.total_hpp*1.03)}p.value.calculated_at=new Date().toISOString()}}catch(b){throw b}finally{z.value=!1}},y=async(L,H,b,o,i)=>{z.value=!0;try{return await new Promise(T=>setTimeout(T,1e3)),{data:{new_price:b,markup_percentage:p.value?Math.round((b-p.value.total_hpp)/p.value.total_hpp*100):0}}}catch(T){throw T}finally{z.value=!1}},A=async()=>{var L,H,b;if(f.variantId)try{const o=localStorage.getItem("token"),i=await Ne.get(`/api/variants/${f.variantId}`,{headers:{Authorization:`Bearer ${o}`,Accept:"application/json"}});if(i.data.success&&i.data.data){const T=i.data.data;if(T.price&&T.price>0)x.value=Number(T.price),O.value=r(Number(T.price));else if((L=p.value)!=null&&L.total_hpp){const _e=Math.round(p.value.total_hpp*1.2);x.value=_e,O.value=r(_e)}if((H=p.value)!=null&&H.total_hpp&&x.value>0){const _e=p.value.total_hpp;ee.value=_e>0?Math.round((x.value-_e)/_e*100):0}te.value+=1}}catch(o){console.warn("Could not load target price, using default:",o),(b=p.value)!=null&&b.total_hpp&&(x.value=Math.round(p.value.total_hpp*1.2))}},ne=async()=>{f.variantId&&(await P(f.variantId,k.value),await A())},ie=async()=>{var L,H;if(f.variantId)try{await n(f.variantId,k.value),me.value=`HPP successfully updated using ${k.value} method!`,J.value=!0,m("hpp-updated"),await ne()}catch(b){console.error("Error updating HPP:",b),fe.value=((H=(L=b==null?void 0:b.response)==null?void 0:L.data)==null?void 0:H.message)||"Failed to update HPP",B.value=!0}},ve=async()=>{var L,H,b,o,i,T,_e,Q,ke,Te;if(f.variantId&&((L=p.value)!=null&&L.total_hpp)&&x.value)try{const re=await y(f.variantId,k.value,x.value,!0,!0);if((H=re==null?void 0:re.data)!=null&&H.new_price){if(x.value=re.data.new_price,O.value=r(re.data.new_price),((b=re==null?void 0:re.data)==null?void 0:b.markup_percentage)!==void 0)ee.value=re.data.markup_percentage;else{const Me=p.value.total_hpp;ee.value=Me>0?Math.round((re.data.new_price-Me)/Me*100):0}te.value+=1,await ht()}f.variantId&&await P(f.variantId,k.value),me.value=`Price successfully updated to ${g(((o=re==null?void 0:re.data)==null?void 0:o.new_price)||x.value)}!`,J.value=!0,m("price-updated",{variantId:f.variantId,oldPrice:(i=re==null?void 0:re.data)==null?void 0:i.old_price,newPrice:(T=re==null?void 0:re.data)==null?void 0:T.new_price,hpp:(_e=re==null?void 0:re.data)==null?void 0:_e.hpp,markupPercentage:(Q=re==null?void 0:re.data)==null?void 0:Q.markup_percentage}),console.log("âœ… Price update successful - dialog remains open for user confirmation")}catch(re){console.error("Error applying price suggestion:",re),fe.value=((Te=(ke=re==null?void 0:re.response)==null?void 0:ke.data)==null?void 0:Te.message)||"Failed to update variant price",B.value=!0}};return we(()=>f.modelValue,L=>{L&&f.variantId&&ne()}),we(()=>f.variantId,L=>{L&&f.modelValue&&ne()}),we(k,async()=>{f.variantId&&await ne()}),we([()=>{var L;return(L=p.value)==null?void 0:L.total_hpp},x],()=>{var L;if((L=p.value)!=null&&L.total_hpp&&x.value>0){const H=p.value.total_hpp;ee.value=H>0?Math.round((x.value-H)/H*100):0}else ee.value=0}),we(x,L=>{L!==v(O.value)&&(O.value=r(L))}),(L,H)=>(w(),oe($e,null,[e(Oe,{"model-value":L.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":H[6]||(H[6]=b=>L.$emit("update:modelValue",b))},{default:t(()=>[e(se,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",ln,[e(D,{icon:"mdi-calculator-variant",size:"24"}),l("span",null,"HPP Breakdown - "+d(L.variantName||"Variant"),1)]),e(K,{icon:"mdi-close",size:"small",variant:"text",onClick:H[0]||(H[0]=b=>L.$emit("update:modelValue",!1))})]),_:1}),e(de,null,{default:t(()=>[e(Ce,{class:"mb-4"},{default:t(()=>[e(M,{cols:"12",md:"6"},{default:t(()=>[e(Fe,{modelValue:k.value,"onUpdate:modelValue":[H[1]||(H[1]=b=>k.value=b),ne],items:G,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>[e(K,{color:"primary",variant:"elevated",loading:z.value,"prepend-icon":"mdi-update",block:"",onClick:ie},{default:t(()=>[_(" Update HPP with "+d(k.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),S.value?(w(),j(se,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(de,null,{default:t(()=>[e(Ce,{align:"center"},{default:t(()=>[e(M,{cols:"12",md:"4"},{default:t(()=>{var b;return[H[11]||(H[11]=l("div",{class:"text-subtitle-2"}," Total HPP ",-1)),l("div",on,d(g(((b=p.value)==null?void 0:b.total_hpp)||0)),1)]}),_:1,__:[11]}),e(M,{cols:"12",md:"4"},{default:t(()=>{var b;return[H[12]||(H[12]=l("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),l("div",sn,d((b=G.find(o=>{var i;return o.value===((i=p.value)==null?void 0:i.method)}))==null?void 0:b.title),1)]}),_:1,__:[12]}),e(M,{cols:"12",md:"4"},{default:t(()=>{var b;return[H[13]||(H[13]=l("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),l("div",nn,d((b=p.value)!=null&&b.calculated_at?new Date(p.value.calculated_at).toLocaleString():"-"),1)]}),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):Y("",!0),S.value?(w(),j(se,{key:1},{default:t(()=>{var b;return[e(Ve,null,{default:t(()=>{var o,i;return[e(D,{icon:"mdi-format-list-bulleted",class:"me-2"}),_(" Item Breakdown ("+d(((i=(o=p.value)==null?void 0:o.items)==null?void 0:i.length)||0)+" items) ",1)]}),_:1}),e(il,{headers:X,items:((b=p.value)==null?void 0:b.items)||[],"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:o})=>[l("div",rn,[l("span",un,d(o.item_name),1),l("span",dn,d(o.item_code),1)])]),"item.quantity_needed":t(({item:o})=>[l("span",cn,d(o.quantity_needed)+" "+d(o.unit),1)]),"item.cost_per_unit":t(({item:o})=>[l("span",null,d(g(o.cost_per_unit)),1)]),"item.total_cost":t(({item:o})=>[e(ge,{color:o.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[_(d(g(o.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:o})=>[e(ge,{color:o.is_critical?"error":"success","prepend-icon":o.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[_(d(o.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:o})=>[o.notes?(w(),oe("span",mn,d(o.notes),1)):(w(),oe("span",vn,"â€”"))]),bottom:t(()=>{var o;return[l("div",fn,[e(ze),l("div",pn,[l("div",gn," Total HPP: "+d(g(((o=p.value)==null?void 0:o.total_hpp)||0)),1),e(ge,{color:"info",variant:"elevated"},{default:t(()=>{var i,T;return[_(d(((T=(i=p.value)==null?void 0:i.items)==null?void 0:T.length)||0)+" items ",1)]}),_:1})])])]}),_:1},8,["items"])]}),_:1})):Y("",!0),S.value?(w(),j(se,{key:2,class:"mt-4"},{default:t(()=>[e(Ve,null,{default:t(()=>[e(D,{icon:"mdi-cash-multiple",class:"me-2"}),H[14]||(H[14]=_(" Price Suggestion "))]),_:1,__:[14]}),e(de,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(M,{cols:"12",md:"6"},{default:t(()=>{var b;return[(w(),j(xe,{key:te.value,modelValue:O.value,"onUpdate:modelValue":[H[2]||(H[2]=o=>O.value=o),U],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${g(((b=p.value)==null?void 0:b.total_hpp)||0)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>{var b;return[(w(),j(xe,{key:te.value,modelValue:ee.value,"onUpdate:modelValue":H[3]||(H[3]=o=>ee.value=o),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${g(x.value-(((b=p.value)==null?void 0:b.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e(Ce,{class:"mt-2"},{default:t(()=>[e(M,{cols:"12",md:"12"},{default:t(()=>[e(K,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:z.value,disabled:!x.value||x.value<=0,block:"",onClick:ve},{default:t(()=>H[15]||(H[15]=[_(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):Y("",!0),c.value?(w(),j(se,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(Ve,null,{default:t(()=>[e(D,{icon:"mdi-lightbulb",class:"me-2"}),H[16]||(H[16]=_(" Price Suggestions "))]),_:1,__:[16]}),e(de,null,{default:t(()=>[e(Ce,null,{default:t(()=>[(w(!0),oe($e,null,Je(I.value.suggestions,(b,o)=>(w(),j(M,{key:o,cols:"12",md:"4"},{default:t(()=>[e(se,{variant:"elevated"},{default:t(()=>[e(de,{class:"text-center"},{default:t(()=>[l("div",_n,d(o)+" Method ",1),l("div",kn,d(g(b.suggested_price)),1),l("div",yn,[_(" HPP: "+d(g(b.hpp)),1),H[17]||(H[17]=l("br",null,null,-1)),_(" Markup: "+d(b.markup_percentage.toFixed(1))+"%",1),H[18]||(H[18]=l("br",null,null,-1)),_(" Margin: "+d(b.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):Y("",!0),!S.value&&!z.value?(w(),j(se,{key:4,variant:"outlined"},{default:t(()=>[e(de,{class:"text-center py-8"},{default:t(()=>[e(D,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),H[20]||(H[20]=l("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),H[21]||(H[21]=l("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(K,{color:"primary","prepend-icon":"mdi-plus",onClick:H[4]||(H[4]=b=>L.$emit("update:modelValue",!1))},{default:t(()=>H[19]||(H[19]=[_(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):Y("",!0)]),_:1}),e(Ke,{class:"pa-4"},{default:t(()=>[e(je),e(K,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:H[5]||(H[5]=b=>L.$emit("update:modelValue",!1))},{default:t(()=>H[22]||(H[22]=[_(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(ut,{modelValue:J.value,"onUpdate:modelValue":H[8]||(H[8]=b=>J.value=b),color:"success",location:"top"},{actions:t(()=>[e(K,{color:"white",variant:"text",onClick:H[7]||(H[7]=b=>J.value=!1)},{default:t(()=>H[23]||(H[23]=[_(" Close ")])),_:1,__:[23]})]),default:t(()=>[_(d(me.value)+" ",1)]),_:1},8,["modelValue"]),e(ut,{modelValue:B.value,"onUpdate:modelValue":H[10]||(H[10]=b=>B.value=b),color:"error",location:"top"},{actions:t(()=>[e(K,{color:"white",variant:"text",onClick:H[9]||(H[9]=b=>B.value=!1)},{default:t(()=>H[24]||(H[24]=[_(" Close ")])),_:1,__:[24]})]),default:t(()=>[_(d(fe.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),bn={class:"d-flex align-center gap-2"},hn={class:"pa-4",style:{"background-color":"#2A2A2A"}},xn={key:0,class:"d-flex align-center gap-3"},wn={class:"text-h6 text-white font-weight-bold"},Pn={class:"d-flex align-center gap-4 mt-1"},Vn={class:"text-caption text-grey-lighten-1"},Cn={class:"text-caption text-grey-lighten-1"},Sn={class:"pa-4 add-item-form"},In={class:"d-flex align-center justify-space-between mb-4"},$n={class:"d-flex align-center gap-2"},Dn={class:"text-h6"},Tn={key:0,class:"text-error"},Un={key:1},zn={class:"d-flex align-center"},An={class:"pa-4 text-center"},Hn={class:"pa-4 pt-0"},Mn={class:"d-flex align-center justify-between mb-4"},En={class:"text-h6"},Bn={key:0,class:"composition-list"},Fn={class:"d-flex align-center justify-between"},Rn={class:"d-flex align-center gap-3"},Kn={class:"font-weight-medium"},qn={class:"text-caption text-medium-emphasis"},Ln={class:"font-weight-medium text-primary"},Nn={class:"d-flex align-center gap-2"},On={class:"text-center"},jn={key:0,class:"text-body-2 text-medium-emphasis"},Wn={class:"text-center"},Gn={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},Xn=qe({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup(s,{emit:R}){const f=s,m=R,z=E(),p=E(!1),I=E(!1),S=E([]),c=E([]),k=E(!1),ee=E(null),x=E(!1),O=E(null),te=E(!1),J=E(!1),B=E(""),me=E(""),fe=E("success"),G=E(!1),X=ce({get:()=>(console.log("ðŸ”µ [DEBUG] Dialog getter called, props.modelValue:",f.modelValue),f.modelValue),set:u=>{console.log("ðŸ”µ [DEBUG] Dialog setter called with value:",u),m("update:modelValue",u)}}),r=()=>({item_id:null,quantity:1,is_critical:!1}),v=E(r()),U=ce(()=>!v.value.item_id||!Array.isArray(S.value)?null:S.value.find(u=>u.id_item===v.value.item_id)),g=ce(()=>!U.value||k.value&&ee.value!==null?null:c.value.find(u=>{var a,h;return u.name===((a=U.value)==null?void 0:a.name)||u.id&&((h=U.value)==null?void 0:h.id_item)&&u.id===U.value.id_item})),P=ce(()=>{if(!U.value)return"";if(k.value&&ee.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(g.value){const u=g.value;return`Item sudah ada dengan quantity ${u.quantity} ${u.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${y(U.value)} ${U.value.unit}`}),n=ce(()=>Array.isArray(S.value)?S.value.filter(u=>y(u)>0):[]),y=u=>{var a,h;return((a=u.inventory)==null?void 0:a.current_stock)||((h=u.inventory)==null?void 0:h.available_stock)||u.current_stock||0},A=()=>I.value?"Memuat items...":!S.value||S.value.length===0?"Tidak ada item tersedia":n.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",ne=u=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(u),ie=u=>{switch(u){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},ve=u=>{switch(u){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},L=(u,a,h)=>{var C,ue,pe,he,Pe,De,He,Le;if(!a)return!0;const F=a.toLowerCase().trim(),q=((ue=(C=h==null?void 0:h.raw)==null?void 0:C.name)==null?void 0:ue.toLowerCase())||"",$=((he=(pe=h==null?void 0:h.raw)==null?void 0:pe.item_code)==null?void 0:he.toLowerCase())||"",V=((De=(Pe=h==null?void 0:h.raw)==null?void 0:Pe.unit)==null?void 0:De.toLowerCase())||"",W=((Le=(He=h==null?void 0:h.raw)==null?void 0:He.description)==null?void 0:Le.toLowerCase())||"";return q.includes(F)||$.includes(F)||V.includes(F)||W.includes(F)},H=async()=>{var u,a,h;I.value=!0,console.log("Loading available items...");try{const F=await Ne.get("/api/items?per_page=all&include=inventory");console.log("Items API response:",F.data);const q=((a=(u=F.data)==null?void 0:u.data)==null?void 0:a.data)||((h=F.data)==null?void 0:h.data)||F.data||[];S.value=Array.isArray(q)?q:[],console.log("Available items loaded:",S.value.length,"items"),console.log("Sample items with inventory:",S.value.slice(0,3))}catch(F){console.error("Error loading items:",F),F!=null&&F.response&&(console.error("API Error Status:",F.response.status),console.error("API Error Data:",F.response.data)),S.value=[]}finally{I.value=!1}},b=async()=>{var u,a,h,F,q;if(!(!((u=f.variant)!=null&&u.id)&&!((a=f.variant)!=null&&a.id_variant)))try{const $=f.variant.id||f.variant.id_variant;console.log("Loading composition items for variant:",$);const V=await Ne.get(`/api/variant-items/variant/${$}`);console.log("Composition API response:",V.data);const W=((F=(h=V.data)==null?void 0:h.data)==null?void 0:F.composition)||((q=V.data)==null?void 0:q.composition)||[];if(!Array.isArray(W)){console.warn("API response composition is not an array:",W),c.value=[];return}c.value=W.map(C=>{var ue,pe,he,Pe,De,He,Le,tt,at,lt;return{id:C.id_variant_item||C.id,name:((ue=C.item)==null?void 0:ue.name)||C.name,quantity:parseFloat(C.quantity_needed||C.quantity||C.qty||"1"),unit:C.unit||((pe=C.item)==null?void 0:pe.unit)||"pcs",stock:((Pe=(he=C.item)==null?void 0:he.inventory)==null?void 0:Pe.current_stock)||((He=(De=C.item)==null?void 0:De.inventory)==null?void 0:He.available_stock)||((Le=C.item)==null?void 0:Le.current_stock)||C.stock||0,price:parseFloat(((tt=C.item)==null?void 0:tt.cost_per_unit)||((at=C.item)==null?void 0:at.price)||C.price||"0"),is_critical:C.is_critical||!1,inventory:(lt=C.item)!=null&&lt.inventory?{current_stock:C.item.inventory.current_stock||0,available_stock:C.item.inventory.available_stock||0,stock_status:C.item.inventory.stock_status||"unknown",reorder_level:C.item.inventory.reorder_level||0}:null}}),console.log("Composition items loaded:",c.value)}catch($){console.error("Error loading composition items:",$),$!=null&&$.response&&(console.error("API Error Status:",$.response.status),console.error("API Error Data:",$.response.data)),c.value=[]}},o=async()=>{var q,$;const{valid:u}=await z.value.validate();if(!u||!U.value)return;const a=U.value.name,h=U.value.id_item,F=v.value.quantity;if(console.log("ðŸ” Handle save - Mode:",k.value?"EDIT":"ADD"),console.log("ðŸ” Item:",a,"ID:",h),console.log("ðŸ” Quantity:",F),k.value&&ee.value!==null){console.log("âœï¸ Edit mode: Updating existing item at index",ee.value);const W=c.value[ee.value].quantity;console.log(`ðŸ“ Updating item "${a}":`),console.log(`   - Old quantity: ${W}`),console.log(`   - New quantity: ${F}`),c.value[ee.value].quantity=F,c.value[ee.value].is_critical=v.value.is_critical,console.log("âœ… Item updated successfully in edit mode"),k.value=!1,ee.value=null}else{console.log("âž• Add mode: Checking for existing item");const V=c.value.findIndex(W=>W.name===a||W.id&&h&&W.id===h);if(V!==-1){const C=c.value[V].quantity,ue=C+F;console.log("ðŸ“¦ Item already exists! Accumulating quantity:"),console.log(`   - Item: ${a}`),console.log(`   - Old quantity: ${C}`),console.log(`   - Adding: ${F}`),console.log(`   - New quantity: ${ue}`),c.value[V].quantity=ue}else{console.log("âž• Adding new item to composition:",a);const W={name:a,quantity:F,unit:U.value.unit,stock:((q=U.value.inventory)==null?void 0:q.current_stock)||(($=U.value.inventory)==null?void 0:$.available_stock)||U.value.current_stock||0,price:U.value.cost_per_unit||0,is_critical:v.value.is_critical,inventory:U.value.inventory?{current_stock:U.value.inventory.current_stock||0,available_stock:U.value.inventory.available_stock||0,stock_status:U.value.inventory.stock_status||"unknown",reorder_level:U.value.inventory.reorder_level||0}:null};c.value.push(W),console.log("âœ… New item added successfully")}}v.value=r(),console.log("ðŸ”„ Form reset")},i=(u,a)=>{console.log("ðŸ” Edit item called:",u,a);const h=S.value.find(F=>F.name===u.name||F.id_item===u.id);h?(console.log("âœ… Found item in available items:",h),k.value=!0,ee.value=a,v.value={item_id:h.id_item,quantity:u.quantity,is_critical:u.is_critical||!1},console.log("ðŸ“ Edit mode activated!"),console.log("ðŸ“ Form data set:",v.value),console.log("ðŸ“ Editing item at index:",a),setTimeout(()=>{const F=document.querySelector(".add-item-form");F&&F.scrollIntoView({behavior:"smooth",block:"start"})},100)):(console.error("âŒ Could not find item in available items"),console.log("Available items:",S.value.map(F=>({id:F.id_item,name:F.name}))),console.log("Looking for item:",{id:u.id,name:u.name}))},T=()=>{console.log("âŒ Edit mode cancelled"),k.value=!1,ee.value=null,v.value=r()},_e=(u,a)=>{O.value={item:u,index:a},x.value=!0},Q=async()=>{var q,$,V;if(!O.value)return;const{item:u,index:a}=O.value,h=u.name,F=u.id;te.value=!0,console.log("ðŸš€ Starting delete process for:",h,"ID:",F,"Index:",a);try{F?(console.log("ðŸ—‘ï¸ Deleting item from database:",h,"with ID:",F),await Ne.delete(`/api/variant-items/${F}`),console.log("âœ… Item deleted from database successfully")):console.log("ðŸ“ Item has no ID, removing from local list only"),x.value=!1,O.value=null,console.log("âœ… Delete dialog closed"),console.log("ðŸ”„ Force refreshing composition list..."),await b(),console.log("âœ… Composition list refreshed from server. New count:",c.value.length),console.log("ðŸ“¡ Emitting save event to parent component..."),m("save"),console.log("âœ… Save event emitted to parent component"),console.log("ðŸŽ‰ Item successfully deleted:",h)}catch(W){console.error("âŒ Error deleting item:",W),console.error("âŒ Error details:",(q=W.response)==null?void 0:q.data),alert("Gagal menghapus item: "+(((V=($=W.response)==null?void 0:$.data)==null?void 0:V.message)||W.message))}finally{te.value=!1,console.log("ðŸ Delete process completed")}},ke=()=>{x.value=!1,O.value=null},Te=()=>{switch(fe.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},re=()=>{switch(fe.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Me=()=>{switch(fe.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},Ie=()=>{switch(fe.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Ze=async()=>{var u,a,h,F;if(!((u=f.variant)!=null&&u.id)&&!((a=f.variant)!=null&&a.id_variant)){console.error("No variant ID found");return}p.value=!0;try{const q=f.variant.id||f.variant.id_variant;console.log("ðŸ” [DEBUG] Composition items count:",c.value.length),console.log("ðŸ” [DEBUG] Raw composition items:",JSON.stringify(c.value,null,2));const $=c.value.some(V=>V.id);if(console.log("ðŸ” [DEBUG] Has existing items:",$),$){console.log("ï¿½ [EDIT MODE] Updating existing composition");const V={items:c.value.map(C=>{const ue=S.value.find(pe=>pe.name===C.name);return console.log(`Mapping item "${C.name}":`),console.log("  - Found item:",ue==null?void 0:ue.id_item),console.log("  - Original ID (id_variant_item):",C.id),console.log("  - Quantity:",C.quantity),console.log("  - Unit:",C.unit),console.log("  - Is critical:",C.is_critical),{id_variant_item:C.id,quantity_needed:Number(C.quantity),unit:C.unit,is_critical:C.is_critical||!1}}).filter(C=>C.id_variant_item&&C.quantity_needed>0)};console.log("Edit payload:",JSON.stringify(V,null,2));const W=await Ne.post("/api/variant-items/bulk-update",V);console.log("Composition updated successfully:",W.data)}else{console.log("âœ¨ [CREATE MODE] Creating new composition");const V={id_variant:q,items:c.value.map(C=>{const ue=S.value.find(pe=>pe.name===C.name);return console.log(`Mapping item "${C.name}":`),console.log("  - Found item:",ue==null?void 0:ue.id_item),console.log("  - Quantity:",C.quantity),console.log("  - Unit:",C.unit),console.log("  - Is critical:",C.is_critical),{id_item:ue==null?void 0:ue.id_item,quantity_needed:Number(C.quantity),unit:C.unit,is_critical:C.is_critical||!1}}).filter(C=>C.id_item&&C.quantity_needed>0)};console.log("Create payload:",JSON.stringify(V,null,2));const W=await Ne.post("/api/variant-items/bulk-store",V);console.log("Composition created successfully:",W.data)}m("save"),Re()}catch(q){console.error("Error saving composition:",q),alert("Gagal menyimpan komposisi: "+(((F=(h=q.response)==null?void 0:h.data)==null?void 0:F.message)||q.message))}finally{p.value=!1}},et=()=>{G.value=!0},Re=()=>{X.value=!1,v.value=r(),c.value=[],k.value=!1,ee.value=null};return we(()=>f.modelValue,u=>{u?(v.value=r(),H(),b()):(k.value=!1,ee.value=null)}),we(()=>v.value.item_id,u=>{u&&U.value&&console.log("Item selected:",U.value.name,"Unit:",U.value.unit)}),dt(()=>{H()}),(u,a)=>{var h,F,q;return w(),oe($e,null,[e(Oe,{modelValue:X.value,"onUpdate:modelValue":a[3]||(a[3]=$=>X.value=$),"max-width":"1000px",persistent:""},{default:t(()=>[e(se,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[l("div",bn,[e(D,{icon:"mdi-delete",color:"white"}),a[9]||(a[9]=l("span",null,"Kelola Komposisi Item",-1))]),e(K,{icon:"mdi-close",variant:"text",color:"white",onClick:Re,disabled:p.value},null,8,["disabled"])]),_:1}),e(de,{class:"pa-0"},{default:t(()=>[l("div",hn,[u.variant?(w(),oe("div",xn,[e(D,{icon:"mdi-coffee",size:"32",color:"white"}),l("div",null,[l("h3",wn,d(u.variant.name),1),l("div",Pn,[l("span",Vn,"SKU: "+d(u.variant.sku),1),l("span",Cn,"Harga: "+d(ne(u.variant.price||0)),1),e(ge,{color:"success",size:"small",variant:"tonal"},{default:t(()=>a[10]||(a[10]=[_(" Stok Aman ")])),_:1,__:[10]})])])])):Y("",!0)]),l("div",Sn,[l("div",In,[l("div",$n,[e(D,{icon:"mdi-plus-circle",color:"success"}),l("h4",Dn,d(k.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(At,{ref_key:"form",ref:z,onSubmit:Ut(o,["prevent"])},{default:t(()=>[e(Ce,null,{default:t(()=>[e(M,{cols:"12",md:"4"},{default:t(()=>[e(zt,{modelValue:v.value.item_id,"onUpdate:modelValue":a[0]||(a[0]=$=>v.value.item_id=$),items:n.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[$=>!!$||"Item wajib dipilih"],loading:I.value,disabled:I.value||S.value&&S.value.length===0,"no-data-text":A(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":L},{"prepend-inner":t(()=>[e(D,{icon:"mdi-package",size:"16"})]),item:t(({props:$,item:V})=>[e(Qe,ye($,{title:V.raw.name,disabled:y(V.raw)<=0,class:["pa-3",{"text-disabled":y(V.raw)<=0}]}),{prepend:t(()=>[e(D,{icon:"mdi-package-variant",color:y(V.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[l("div",{class:Ye(["text-caption",y(V.raw)<=0?"text-disabled":"text-medium-emphasis"])},[y(V.raw)<=0?(w(),oe("span",Tn,[e(D,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),a[11]||(a[11]=_(" Stok Habis "))])):(w(),oe("span",Un," Stok: "+d(y(V.raw))+" "+d(V.raw.unit),1))],2)]),append:t(()=>{var W;return[y(V.raw)>0?(w(),j(ge,{key:0,size:"x-small",color:ie(((W=V.raw.inventory)==null?void 0:W.stock_status)||V.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var C;return[_(d(ve(((C=V.raw.inventory)==null?void 0:C.stock_status)||V.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(w(),j(ge,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>a[12]||(a[12]=[_(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:$})=>[l("div",zn,[e(D,{icon:"mdi-package-variant",size:"16",class:"me-2"}),l("span",null,d($.raw.name),1)])]),"no-data":t(()=>[l("div",An,[e(D,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),a[13]||(a[13]=l("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),a[14]||(a[14]=l("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:v.value.quantity,"onUpdate:modelValue":a[1]||(a[1]=$=>v.value.quantity=$),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[$=>!!$||"Jumlah wajib diisi",$=>$>0||"Jumlah harus lebih dari 0"],hint:P.value,"persistent-hint":"",color:g.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e(M,{cols:"12",md:"2"},{default:t(()=>{var $;return[e(xe,{"model-value":(($=U.value)==null?void 0:$.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!U.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e(D,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e(M,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(gt,{modelValue:v.value.is_critical,"onUpdate:modelValue":a[2]||(a[2]=$=>v.value.is_critical=$),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(K,{color:k.value?"primary":g.value?"warning":"#D4A574",onClick:o,loading:p.value,disabled:!v.value.item_id||!v.value.quantity,block:""},{default:t(()=>[e(D,{icon:k.value?"mdi-content-save":g.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),_(" "+d(k.value?"Update":g.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),k.value?(w(),j(K,{key:0,color:"grey",variant:"outlined",onClick:T,size:"small",block:""},{default:t(()=>[e(D,{icon:"mdi-close",class:"me-1"}),a[15]||(a[15]=_(" Batal "))]),_:1,__:[15]})):Y("",!0)]),_:1})]),_:1})]),_:1},512)]),l("div",Hn,[l("div",Mn,[l("h4",En,"Daftar Item Komposisi ("+d(c.value.length)+")",1)]),c.value.length>0?(w(),oe("div",Bn,[(w(!0),oe($e,null,Je(c.value,($,V)=>(w(),j(se,{key:V,variant:"outlined",class:"mb-3"},{default:t(()=>[e(de,{class:"pa-3"},{default:t(()=>{var W,C,ue,pe,he,Pe,De;return[l("div",Fn,[l("div",Rn,[e(D,{icon:"mdi-check-circle",color:"success"}),l("div",null,[l("div",Kn,d($.name),1),l("div",qn,[l("span",Ln,"Dibutuhkan: "+d($.quantity)+" "+d($.unit),1),a[16]||(a[16]=_(" â€¢ ")),l("span",{class:Ye({"text-success":(((W=$.inventory)==null?void 0:W.current_stock)??0)>(((C=$.inventory)==null?void 0:C.reorder_level)??0),"text-warning":(((ue=$.inventory)==null?void 0:ue.current_stock)??0)<=(((pe=$.inventory)==null?void 0:pe.reorder_level)??0)&&(((he=$.inventory)==null?void 0:he.current_stock)??0)>0,"text-error":(((Pe=$.inventory)==null?void 0:Pe.current_stock)??0)<=0})}," Stok: "+d(((De=$.inventory)==null?void 0:De.current_stock)||$.stock||0)+" "+d($.unit),3),_(" â€¢ "+d(ne($.price)),1)])])]),l("div",Nn,[e(K,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:He=>i($,V)},null,8,["onClick"]),e(K,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:He=>_e($,V)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(w(),j(se,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e(D,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),a[17]||(a[17]=l("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(Ke,{class:"px-6 pb-6"},{default:t(()=>[e(K,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:et},{default:t(()=>a[18]||(a[18]=[_(" Setting HPP ")])),_:1,__:[18]}),e(je),e(K,{variant:"outlined",onClick:Re,disabled:p.value},{default:t(()=>a[19]||(a[19]=[_(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(K,{color:"#D4A574",onClick:Ze,loading:p.value,disabled:c.value.length===0},{default:t(()=>a[20]||(a[20]=[_(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(na,{modelValue:G.value,"onUpdate:modelValue":a[4]||(a[4]=$=>G.value=$),"variant-id":((h=u.variant)==null?void 0:h.id)||((F=u.variant)==null?void 0:F.id_variant),"variant-name":(q=u.variant)==null?void 0:q.name,onHppUpdated:a[5]||(a[5]=$=>m("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Oe,{modelValue:x.value,"onUpdate:modelValue":a[6]||(a[6]=$=>x.value=$),"max-width":"400px",persistent:""},{default:t(()=>[e(se,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e(D,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),a[21]||(a[21]=_(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(ze),e(de,{class:"pa-6"},{default:t(()=>[l("div",On,[e(D,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),a[24]||(a[24]=l("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),O.value?(w(),oe("div",jn,[l("strong",null,d(O.value.item.name),1),a[22]||(a[22]=l("br",null,null,-1)),_(" Dibutuhkan: "+d(O.value.item.quantity)+" "+d(O.value.item.unit),1)])):Y("",!0),e(Be,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>a[23]||(a[23]=[l("strong",null,"Perhatian:",-1),_(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(Ke,{class:"px-6 pb-6"},{default:t(()=>[e(K,{variant:"outlined",onClick:ke,disabled:te.value,class:"flex-grow-1"},{default:t(()=>a[25]||(a[25]=[_(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(K,{color:"error",onClick:Q,loading:te.value,class:"flex-grow-1"},{default:t(()=>a[26]||(a[26]=[_(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Oe,{modelValue:J.value,"onUpdate:modelValue":a[8]||(a[8]=$=>J.value=$),"max-width":"450px",persistent:""},{default:t(()=>[e(se,null,{default:t(()=>[e(Ve,{class:Ye(["d-flex align-center justify-center text-h6",Me()])},{default:t(()=>[e(D,{icon:Te(),color:re(),class:"me-2",size:"24"},null,8,["icon","color"]),_(" "+d(me.value),1)]),_:1},8,["class"]),e(ze),e(de,{class:"pa-6"},{default:t(()=>[l("div",Wn,[e(D,{icon:Te(),color:re(),size:"64",class:"mb-4"},null,8,["icon","color"]),l("div",Gn,d(B.value),1),e(Be,{type:fe.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[fe.value==="success"?(w(),oe($e,{key:0},[a[27]||(a[27]=l("strong",null,"Berhasil!",-1)),a[28]||(a[28]=_(" Perubahan telah disimpan. "))],64)):fe.value==="info"?(w(),oe($e,{key:1},[a[29]||(a[29]=l("strong",null,"Informasi:",-1)),a[30]||(a[30]=_(" Item telah diperbarui sesuai permintaan. "))],64)):(w(),oe($e,{key:2},[a[31]||(a[31]=l("strong",null,"Perhatian:",-1)),a[32]||(a[32]=_(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(Ke,{class:"px-6 pb-6"},{default:t(()=>[e(je),e(K,{color:Ie(),onClick:a[7]||(a[7]=$=>J.value=!1),class:"px-6"},{default:t(()=>[e(D,{icon:"mdi-check",class:"me-1"}),a[33]||(a[33]=_(" OK "))]),_:1,__:[33]},8,["color"]),e(je)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Jn=We(Xn,[["__scopeId","data-v-df449ced"]]),Yn={class:"d-flex align-center gap-2"},Qn={class:"mt-2"},Zn={key:0,class:"mt-1 font-weight-medium"},ei={key:1,class:"mt-1 text-warning"},ti=qe({__name:"CreateVariantDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save"],setup(s,{emit:R}){const f=s,m=R,z=E(),p=E(!1),I=E(!1),S=E([]),c=E({name:"",selectedProduct:null,selectedProductId:null,active:!0}),k=[r=>!!r||"Nama variant wajib diisi",r=>r.length>=3||"Nama variant minimal 3 karakter"],ee=[r=>!!r||"Produk wajib dipilih"],x=(r,v="success")=>{const U=document.createElement("div");U.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${v==="success"?"#4CAF50":"#f44336"};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 9999;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
  `;const g=document.createElement("span");if(g.innerHTML=v==="success"?"âœ“":"âœ•",g.style.cssText=`
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    font-weight: bold;
  `,U.appendChild(g),U.appendChild(document.createTextNode(r)),!document.querySelector("#snackbar-styles")){const P=document.createElement("style");P.id="snackbar-styles",P.textContent=`
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `,document.head.appendChild(P)}document.body.appendChild(U),setTimeout(()=>{U.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{U.parentNode&&U.parentNode.removeChild(U)},300)},3e3),console.log(`${v}: ${r}`)},O=async()=>{I.value=!0;try{const r=await Ne.get("/api/products");S.value=r.data.data||r.data||[],console.log("Fetched products:",S.value),console.log("First product structure:",S.value[0])}catch(r){console.error("Gagal mengambil data produk:",r),S.value=[]}finally{I.value=!1}},te=r=>{!r&&S.value.length===0&&O()},J=r=>{console.log("Product object changed:",r),c.value.selectedProduct=r,r?c.value.selectedProductId=r.id:c.value.selectedProductId=null},B=ce(()=>{if(console.log("Computing selected product info..."),console.log("form.selectedProduct:",c.value.selectedProduct),console.log("form.selectedProductId:",c.value.selectedProductId),c.value.selectedProduct)return console.log("Using selectedProduct object:",c.value.selectedProduct),c.value.selectedProduct;if(c.value.selectedProductId&&S.value.length>0){console.log("Searching for product with ID:",c.value.selectedProductId),console.log("Product IDs available:",S.value.map(v=>({id:v.id,name:v.name})));const r=S.value.find(v=>v.id===c.value.selectedProductId);return console.log("Found selected product by ID:",r),r}return console.log("No product selected or no products available"),null}),me=()=>{console.log("Generating SKU...");const r=B.value;if(console.log("Product info for SKU:",r),console.log("Form name:",c.value.name),console.log("Form selectedProductId:",c.value.selectedProductId),!r||!c.value.name)return console.log("Missing productInfo or name, returning empty SKU"),"";const v=r.sku||"PROD",U=c.value.name.replace(/\s+/g,"").toUpperCase().substring(0,3),g=Date.now().toString().slice(-4),P=`${v}-${U}-${g}`;return console.log("Generated SKU:",P),P},fe=async()=>{var U,g;if(p.value)return;const{valid:r}=await z.value.validate();if(!r)return;const v=B.value;if(console.log("Product info in saveVariant:",v),!v){x("Produk tidak ditemukan","error");return}if(!v.id&&!v.id_product){x("ID Produk tidak valid","error"),console.error("Product missing ID:",v);return}p.value=!0;try{const P={id_product:v.id||v.id_product,name:c.value.name,sku:me(),price:0,cost_price:null,barcode:null,variant_values:[],active:c.value.active};console.log("Payload being sent:",P),console.log("Payload JSON:",JSON.stringify(P));const n=await Ne.post("/api/variants",P);if(console.log("API Response:",n.data),console.log("Response Status:",n.status),n.data.success!==!1&&(n.status===200||n.status===201))x("Variant berhasil dibuat!","success"),console.log("Created variant data:",n.data.data),m("save"),X();else throw new Error(n.data.message||"Gagal membuat variant")}catch(P){const n=((g=(U=P.response)==null?void 0:U.data)==null?void 0:g.message)||P.message||"Gagal membuat variant";x(n,"error"),console.error("Save variant error:",P)}finally{p.value=!1}},G=()=>{var r;c.value={name:"",selectedProduct:null,selectedProductId:null,active:!0},(r=z.value)==null||r.resetValidation()},X=()=>{m("update:modelValue",!1),G()};return we(()=>f.modelValue,r=>{r&&(G(),O())}),(r,v)=>(w(),j(Oe,{"model-value":r.modelValue,"onUpdate:modelValue":v[3]||(v[3]=U=>r.$emit("update:modelValue",U)),"max-width":"600px",persistent:""},{default:t(()=>[e(se,null,{default:t(()=>[e(Ve,{class:"bg-primary text-white"},{default:t(()=>[e(D,{icon:"mdi-plus-circle",class:"me-2"}),v[4]||(v[4]=_(" Tambah Variant Baru ")),e(je),e(K,{icon:"mdi-close",variant:"text",color:"white",onClick:X})]),_:1,__:[4]}),e(At,{ref_key:"formRef",ref:z,onSubmit:Ut(fe,["prevent"])},{default:t(()=>[e(de,{class:"pa-6"},{default:t(()=>[e(Ce,null,{default:t(()=>[e(M,{cols:"12"},{default:t(()=>[e(zt,{modelValue:c.value.selectedProduct,"onUpdate:modelValue":[v[0]||(v[0]=U=>c.value.selectedProduct=U),J],items:S.value,loading:I.value,"item-title":"name","return-object":"",label:"Pilih Produk *",placeholder:"Cari produk...",variant:"outlined",rules:ee,required:"","no-data-text":"Tidak ada produk ditemukan","onUpdate:search":te},{item:t(({props:U,item:g})=>[e(Qe,za(Aa(U)),{prepend:t(()=>[e(Se,{image:g.raw.image_url,size:"40"},{default:t(()=>[g.raw.image_url?Y("",!0):(w(),j(D,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"])]),default:t(()=>[e(ft,null,{default:t(()=>[_(d(g.raw.name),1)]),_:2},1024),e(pt,null,{default:t(()=>[_("SKU: "+d(g.raw.sku||"-"),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:U})=>[l("div",Yn,[e(Se,{image:U.raw.image_url,size:"24"},{default:t(()=>[U.raw.image_url?Y("",!0):(w(),j(D,{key:0,icon:"mdi-coffee",size:"16"}))]),_:2},1032,["image"]),l("span",null,d(U.raw.name),1)])]),_:1},8,["modelValue","items","loading"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(xe,{modelValue:c.value.name,"onUpdate:modelValue":v[1]||(v[1]=U=>c.value.name=U),label:"Nama Variant *",placeholder:"Contoh: Large Hot, Medium Cold, dll",variant:"outlined",rules:k,required:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(Be,{color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(wt,null,{default:t(()=>[e(D,{icon:"mdi-information",class:"me-2"}),v[5]||(v[5]=_(" SKU Otomatis "))]),_:1,__:[5]}),l("div",Qn,[v[6]||(v[6]=_(" SKU variant akan dibuat otomatis berdasarkan nama produk dan variant ")),c.value.name&&(c.value.selectedProduct||c.value.selectedProductId)?(w(),oe("div",Zn," Preview SKU: "+d(me()),1)):c.value.name&&!c.value.selectedProduct&&!c.value.selectedProductId?(w(),oe("div",ei," Pilih produk terlebih dahulu untuk melihat preview SKU ")):Y("",!0)])]),_:1})]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(gt,{modelValue:c.value.active,"onUpdate:modelValue":v[2]||(v[2]=U=>c.value.active=U),label:"Variant Aktif",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ze),e(Ke,{class:"pa-6"},{default:t(()=>[e(je),e(K,{variant:"outlined",onClick:X,disabled:p.value},{default:t(()=>v[7]||(v[7]=[_(" Batal ")])),_:1,__:[7]},8,["disabled"]),e(K,{type:"submit",color:"primary",loading:p.value},{default:t(()=>v[8]||(v[8]=[_(" Simpan Variant ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),ai=We(ti,[["__scopeId","data-v-6f78bbf1"]]),li={class:"product-variant-tab"},oi={class:"d-flex gap-2"},si={key:0,class:"mt-4 d-flex align-center gap-2"},ni={key:1,class:"text-center pa-12"},ii={key:2,class:"text-center pa-12"},ri={class:"d-flex align-center gap-3"},ui={class:"flex-grow-1 min-width-0"},di={class:"text-h6 font-weight-bold text-truncate"},ci={class:"text-body-2 text-medium-emphasis mb-0"},mi={class:"d-flex flex-column gap-1"},vi={class:"text-xs"},fi={class:"d-flex align-center gap-2"},pi={class:"text-primary font-weight-medium"},gi={class:"d-flex gap-1"},_i={class:"d-flex align-center justify-space-between w-100"},ki={class:"d-flex gap-1"},yi=qe({__name:"ProductVariantTab",props:{loading:{type:Boolean}},emits:["refresh"],setup(s,{emit:R}){const f=R,m=E(!1),z=E([]),p=E(!1),I=E(!1),S=E(null),c=E(!1),k=E(!1),ee=E(!1),x=E({search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}),O=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],te=[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Variant Terbanyak",value:"variants_desc"},{title:"Variant Tersedikit",value:"variants_asc"}],J=ce(()=>!!(x.value.search||x.value.stockStatus||x.value.activeStatus!==null||x.value.sortBy!=="name_asc")),B=ce(()=>{const b={};return z.value.forEach(o=>{const i=o.id_product;b[i]||(b[i]={product:o.product||{id:o.id_product,id_product:o.id_product,name:`Product ${o.id_product}`,sku:""},variants:[]}),b[i].variants.push(o)}),Object.values(b)}),me=ce(()=>{let b=[...B.value];if(x.value.search){const o=x.value.search.toLowerCase();b=b.filter(i=>{var T;return i.product.name.toLowerCase().includes(o)||((T=i.product.sku)==null?void 0:T.toLowerCase().includes(o))||i.variants.some(_e=>_e.name.toLowerCase().includes(o)||_e.sku.toLowerCase().includes(o))})}switch(x.value.stockStatus&&(b=b.filter(o=>o.variants.some(i=>{var _e;return(((_e=i.composition_summary)==null?void 0:_e.stock_status)||"safe")===x.value.stockStatus}))),x.value.activeStatus!==null&&(b=b.filter(o=>o.variants.some(i=>i.is_active===x.value.activeStatus))),x.value.sortBy){case"name_asc":b.sort((o,i)=>o.product.name.localeCompare(i.product.name));break;case"name_desc":b.sort((o,i)=>i.product.name.localeCompare(o.product.name));break;case"variants_desc":b.sort((o,i)=>i.variants.length-o.variants.length);break;case"variants_asc":b.sort((o,i)=>o.variants.length-i.variants.length);break}return b}),fe=(b,o="success")=>{},G=async b=>{try{console.log("ðŸ”„ Updating variant price from HPP dialog:",b);const o=z.value.findIndex(i=>i.id_variant===b.variantId);o!==-1&&(z.value[o]={...z.value[o],price:b.newPrice,cost:b.hpp},console.log("âœ… Variant price updated locally without reloading")),fe(`Price updated to ${new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(b.newPrice)}`,"success")}catch(o){console.error("Error handling price update:",o),await X()}},X=async()=>{var b,o,i;m.value=!0;try{const T=await Ne.get("/api/variants",{params:{per_page:1e3,with_product:!0,with_composition:!0}});if(T.data.success===!1)throw new Error(T.data.message||"Failed to load variants");const _e=((b=T.data.data)==null?void 0:b.data)||T.data.data||[];z.value=_e.map(Q=>({...Q,is_active:Q.active!==void 0?Q.active:Q.is_active,id:Q.id_variant||Q.id,id_product:Q.id_product||Q.product_id}))}catch(T){(i=(o=T.response)==null?void 0:o.data)!=null&&i.message||T.message,z.value=[]}finally{m.value=!1}},r=b=>{S.value=b,c.value=!0},v=b=>{b&&(S.value=b,k.value=!0)},U=b=>{S.value=b,p.value=!0},g=()=>{ee.value=!0},P=async()=>{var b,o;if(S.value)try{I.value=!0,await Ne.delete(`/api/variants/${S.value.id_variant}`),fe("Variant berhasil dihapus","success"),await X(),p.value=!1}catch(i){(o=(b=i.response)==null?void 0:b.data)!=null&&o.message}finally{I.value=!1}},n=b=>{switch(b){case"critical":return"error";case"out":return"error";case"safe":return"success";default:return"primary"}},y=b=>{switch(b){case"critical":return"Kritis";case"out":return"Habis";case"safe":return"Aman";default:return"Normal"}},A=b=>{const o=b.filter(i=>i.is_active).length;return o===0?"error":o===b.length?"success":"warning"},ne=b=>b.some(o=>{var T;const i=(T=o.composition_summary)==null?void 0:T.stock_status;return i==="critical"||i==="out"}),ie=b=>{const o=b.filter(T=>T.is_active).length,i=b.filter(T=>{var Q;const _e=(Q=T.composition_summary)==null?void 0:Q.stock_status;return _e==="critical"||_e==="out"}).length;return i>0?{text:`${i} Stok Kritis`,color:"error",icon:"mdi-alert-circle"}:o===b.length?{text:"Semua Aktif",color:"success",icon:"mdi-check-circle"}:o===0?{text:"Semua Nonaktif",color:"error",icon:"mdi-close-circle"}:{text:`${o}/${b.length} Aktif`,color:"warning",icon:"mdi-minus-circle"}},ve=()=>{x.value={search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}},L=()=>{X(),f("refresh")},H=()=>{console.log("Variant created, refreshing data..."),X(),f("refresh")};return dt(()=>{X()}),(b,o)=>{var i,T,_e;return w(),oe("div",li,[e(se,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o[14]||(o[14]=l("div",null,[l("h2",{class:"text-h5 font-weight-bold"},"Variant Produk"),l("p",{class:"text-body-2 text-medium-emphasis"}," Kelola variant dan komposisi untuk produk Anda ")],-1)),l("div",oi,[e(K,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:X,loading:m.value},{default:t(()=>o[12]||(o[12]=[_(" Refresh ")])),_:1,__:[12]},8,["loading"]),e(K,{color:"primary","prepend-icon":"mdi-plus",onClick:g},{default:t(()=>o[13]||(o[13]=[_(" Tambah Variant ")])),_:1,__:[13]})])]),_:1,__:[14]})]),_:1}),e(se,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(de,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(M,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:x.value.search,"onUpdate:modelValue":o[0]||(o[0]=Q=>x.value.search=Q),label:"Cari Variant",placeholder:"Nama variant, SKU, atau produk...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:x.value.stockStatus,"onUpdate:modelValue":o[1]||(o[1]=Q=>x.value.stockStatus=Q),items:O,label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:x.value.activeStatus,"onUpdate:modelValue":o[2]||(o[2]=Q=>x.value.activeStatus=Q),items:[{title:"Semua Status",value:null},{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Status Aktif",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:x.value.sortBy,"onUpdate:modelValue":o[3]||(o[3]=Q=>x.value.sortBy=Q),items:te,label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),J.value?(w(),oe("div",si,[o[16]||(o[16]=l("span",{class:"text-body-2"},"Filter aktif:",-1)),x.value.search?(w(),j(ge,{key:0,size:"small",closable:"","onClick:close":o[4]||(o[4]=Q=>x.value.search="")},{default:t(()=>[_(" Pencarian: "+d(x.value.search),1)]),_:1})):Y("",!0),x.value.stockStatus?(w(),j(ge,{key:1,size:"small",closable:"","onClick:close":o[5]||(o[5]=Q=>x.value.stockStatus="")},{default:t(()=>{var Q;return[_(" Stok: "+d((Q=O.find(ke=>ke.value===x.value.stockStatus))==null?void 0:Q.title),1)]}),_:1})):Y("",!0),x.value.activeStatus!==null?(w(),j(ge,{key:2,size:"small",closable:"","onClick:close":o[6]||(o[6]=Q=>x.value.activeStatus=null)},{default:t(()=>[_(" Status: "+d(x.value.activeStatus?"Aktif":"Nonaktif"),1)]),_:1})):Y("",!0),e(K,{variant:"text",size:"small",color:"error",onClick:ve},{default:t(()=>o[15]||(o[15]=[_(" Hapus Semua Filter ")])),_:1,__:[15]})])):Y("",!0)]),_:1})]),_:1}),!m.value&&me.value.length===0&&J.value?(w(),j(Be,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada variant yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):Y("",!0),m.value?(w(),oe("div",ni,[e(Pt,{color:"primary",indeterminate:"",size:"64"}),o[17]||(o[17]=l("div",{class:"mt-4 text-h6"},"Memuat variant...",-1))])):B.value.length===0?(w(),oe("div",ii,[e(D,{icon:"mdi-tune-variant",size:"96",class:"text-disabled mb-6"}),o[19]||(o[19]=l("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Variant Produk",-1)),o[20]||(o[20]=l("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat variant untuk produk Anda agar dapat menawarkan pilihan yang beragam ",-1)),e(K,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:g},{default:t(()=>o[18]||(o[18]=[_(" Buat Variant Pertama ")])),_:1,__:[18]})])):(w(),j(Ce,{key:3},{default:t(()=>[(w(!0),oe($e,null,Je(me.value,Q=>(w(),j(M,{key:Q.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(se,{class:Ye(["variant-group-card h-100",{"border-error":ne(Q.variants)}]),elevation:"2"},{default:t(()=>[e(Ve,{class:"pa-4 pb-2"},{default:t(()=>[l("div",ri,[e(Se,{image:Q.product.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[Q.product.image_url?Y("",!0):(w(),j(D,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),l("div",ui,[l("h3",di,d(Q.product.name),1),l("p",ci," SKU: "+d(Q.product.sku||"-"),1)]),e(ge,{color:A(Q.variants),size:"small",variant:"tonal"},{default:t(()=>[_(d(Q.variants.length)+" Variant ",1)]),_:2},1032,["color"])])]),_:2},1024),e(ze),e(de,{class:"pa-4"},{default:t(()=>[e(Vt,{class:"pa-0"},{default:t(()=>[(w(!0),oe($e,null,Je(Q.variants,(ke,Te)=>(w(),j(Qe,{key:ke.id_variant,class:Ye(["pa-2 rounded-lg variant-item",{"mb-2":Te<Q.variants.length-1}])},{prepend:t(()=>[e(Se,{size:"32",color:ke.is_active?"success":"error",variant:"tonal"},{default:t(()=>[e(D,{icon:ke.is_active?"mdi-check":"mdi-close",size:"16"},null,8,["icon"])]),_:2},1032,["color"])]),append:t(()=>[l("div",gi,[e(Ee,{text:"Kelola Komposisi"},{activator:t(({props:re})=>[e(K,ye({ref_for:!0},re,{icon:"mdi-chef-hat",size:"small",variant:"text",color:"primary",onClick:Me=>r(ke)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Hapus Variant"},{activator:t(({props:re})=>[e(K,ye({ref_for:!0},re,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Me=>U(ke)}),null,16,["onClick"])]),_:2},1024)])]),default:t(()=>[e(ft,{class:"text-sm font-weight-medium"},{default:t(()=>[_(d(ke.name),1)]),_:2},1024),e(pt,null,{default:t(()=>[l("div",mi,[l("span",vi,"SKU: "+d(ke.sku),1),l("div",fi,[l("span",pi,d(N(Ae)(ke.price||0)),1),ke.composition_summary?(w(),j(ge,{key:0,color:n(ke.composition_summary.stock_status),size:"x-small",variant:"tonal"},{default:t(()=>[_(d(y(ke.composition_summary.stock_status)),1)]),_:2},1032,["color"])):Y("",!0)])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:2},1024)]),_:2},1024),e(ze),e(Ke,{class:"pa-4"},{default:t(()=>[l("div",_i,[l("div",null,[e(ge,{color:ie(Q.variants).color,size:"small",variant:"tonal"},{default:t(()=>[e(D,{icon:ie(Q.variants).icon,size:"14",class:"me-1"},null,8,["icon"]),_(" "+d(ie(Q.variants).text),1)]),_:2},1032,["color"])]),l("div",ki,[e(Ee,{text:"Setting HPP Produk"},{activator:t(({props:ke})=>[e(K,ye({ref_for:!0},ke,{icon:"mdi-calculator-variant",size:"small",variant:"text",color:"warning",onClick:Te=>v(Q.variants[0])}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Tambah Variant"},{activator:t(({props:ke})=>[e(K,ye({ref_for:!0},ke,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:g}),null,16)]),_:1}),e(Ee,{text:"Pengaturan Produk (Coming Soon)"},{activator:t(({props:ke})=>[e(K,ye({ref_for:!0},ke,{icon:"mdi-cog",size:"small",variant:"text",color:"secondary",disabled:""}),null,16)]),_:1})])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(Jn,{modelValue:c.value,"onUpdate:modelValue":o[7]||(o[7]=Q=>c.value=Q),variant:S.value,onSave:L},null,8,["modelValue","variant"]),e(na,{modelValue:k.value,"onUpdate:modelValue":o[8]||(o[8]=Q=>k.value=Q),"variant-id":(i=S.value)==null?void 0:i.id_variant,"variant-name":(T=S.value)==null?void 0:T.name,onHppUpdated:X,onPriceUpdated:G},null,8,["modelValue","variant-id","variant-name"]),e(ai,{modelValue:ee.value,"onUpdate:modelValue":o[9]||(o[9]=Q=>ee.value=Q),onSave:H},null,8,["modelValue"]),e(Lt,{modelValue:p.value,"onUpdate:modelValue":o[10]||(o[10]=Q=>p.value=Q),title:"Konfirmasi Hapus Variant","item-name":(_e=S.value)==null?void 0:_e.name,loading:I.value,"confirm-text":"Hapus Variant",onConfirm:P,onCancel:o[11]||(o[11]=Q=>p.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),qt=We(yi,[["__scopeId","data-v-edd5278d"]]),bi={class:"product-management"},hi={class:"d-flex justify-space-between align-center mb-6"},xi={class:"d-flex gap-3 align-center"},wi={key:0,class:"d-flex gap-2"},Pi={class:"d-flex align-center"},Vi=qe({__name:"products-management",setup(s){Yt();const{productsList:R,categories:f,loading:m,saveLoading:z,deleteLoading:p,toggleLoading:I,stats:S,dialog:c,deleteDialog:k,editMode:ee,selectedProduct:x,selectedProducts:O,currentPage:te,totalItems:J,itemsPerPage:B,filters:me,errorMessage:fe,successMessage:G,modalErrorMessage:X,formData:r,selectedImage:v,imagePreview:U,canCreateEdit:g,hasSelectedProducts:P,fetchProductsList:n,fetchCategories:y,fetchStats:A,saveProduct:ne,deleteProduct:ie,bulkDeleteProducts:ve,toggleActiveStatus:L,toggleFeaturedStatus:H,openCreateDialog:b,openEditDialog:o,openDeleteDialog:i,closeDialog:T,handleImageUpload:_e,clearModalError:Q,onPageChange:ke}=Qt(),{dialog:Te,editMode:re,formData:Me,availableItems:Ie,saveLoading:Ze,modalErrorMessage:et,openCreateDialog:Re,closeDialog:u,saveRecipe:a,clearModalError:h,fetchAvailableItems:F}=Oa(),{productItemsList:q,loading:$,fetchProductItemsForComposition:V}=ia(),W=E("products"),C=E(),ue=E(!1),pe=E(null),he=E(!1),Pe=E(null),De=async()=>{await ie()},He=async()=>{await ve()},Le=be=>{const Z=be.id_product||be.id;Re(Z)},tt=async be=>{pe.value=be;try{await V({page:1,per_page:50,critical_only:!1})}catch{}ue.value=!0},at=be=>{Pe.value=be,he.value=!0},lt=be=>{if(!be)return[];const Z=be.id_product||be.id;return q.value.filter(ae=>{var le;return((le=ae.product)==null?void 0:le.id_product)===Z||ae.product_id===Z})||[]},ct=async()=>{if(await V({page:1,per_page:50,critical_only:!1}),await n(),pe.value&&C.value){const be=pe.value.id_product||pe.value.id;await C.value.refreshHPPData(be)}},_t=be=>{Object.assign(me,be),n()},kt=be=>{me.search=be,n()},rt=()=>{v.value=null,U.value&&(U.value="")};return we(W,async be=>{be==="compositions"&&await V({page:1,per_page:15,critical_only:!1})},{immediate:!1}),dt(()=>{n(),y(),A(),F()}),(be,Z)=>{var ae;return w(),oe("div",bi,[l("div",hi,[Z[18]||(Z[18]=l("div",null,[l("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),l("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),l("div",xi,[N(P)&&W.value==="products"?(w(),oe("div",wi,[e(ge,{color:"primary",size:"small"},{default:t(()=>[_(d(N(O).length)+" dipilih ",1)]),_:1}),e(K,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:He},{default:t(()=>Z[16]||(Z[16]=[_(" Hapus Terpilih ")])),_:1,__:[16]})])):Y("",!0),N(g)&&W.value==="products"?(w(),j(K,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:N(b)},{default:t(()=>Z[17]||(Z[17]=[_(" Tambah Produk ")])),_:1,__:[17]},8,["onClick"])):Y("",!0)])]),e(Sl,{modelValue:W.value,"onUpdate:modelValue":Z[0]||(Z[0]=le=>W.value=le),class:"mb-6"},{default:t(()=>[e(bt,{value:"products"},{default:t(()=>[e(D,{icon:"mdi-coffee",class:"me-2"}),Z[19]||(Z[19]=_(" Produk "))]),_:1,__:[19]}),e(bt,{value:"compositions"},{default:t(()=>[e(D,{icon:"mdi-chef-hat",class:"me-2"}),Z[20]||(Z[20]=_(" Komposisi Produk "))]),_:1,__:[20]}),e(bt,{value:"variants"},{default:t(()=>[e(D,{icon:"mdi-tune-variant",class:"me-2"}),Z[21]||(Z[21]=_(" Variant Produk "))]),_:1,__:[21]})]),_:1},8,["modelValue"]),N(fe)?(w(),j(Be,{key:0,type:"error",variant:"outlined",class:"mb-4",text:N(fe),closable:"","onClick:close":Z[1]||(Z[1]=le=>fe.value="")},null,8,["text"])):Y("",!0),N(G)?(w(),j(Be,{key:1,type:"success",variant:"outlined",class:"mb-4",text:N(G),closable:"","onClick:close":Z[2]||(Z[2]=le=>G.value="")},null,8,["text"])):Y("",!0),e($t,{modelValue:W.value,"onUpdate:modelValue":Z[4]||(Z[4]=le=>W.value=le)},{default:t(()=>[e(vt,{value:"products"},{default:t(()=>[e(Ms,{stats:N(S)},null,8,["stats"]),e(ks,{filters:N(me),"onUpdate:filters":_t,onSearch:kt},null,8,["filters"]),e(an,{ref_key:"productTableRef",ref:C,products:N(R),loading:N(m),"current-page":N(te),"total-items":N(J),"items-per-page":N(B),"selected-products":N(O),"toggle-loading":N(I),"onUpdate:page":N(ke),onAddProduct:N(b),onEditProduct:N(o),onOpenRecipeDialog:Le,onOpenCompositionDialog:tt,onOpenVariantDialog:at,onDeleteProduct:N(i),onToggleActive:N(L),onToggleFeatured:N(H),"onUpdate:selectedProducts":Z[3]||(Z[3]=le=>O.value=le)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:page","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured"])]),_:1}),e(vt,{value:"compositions"},{default:t(()=>[e(Fo,{"product-items":N(q),loading:N($),onRefresh:N(V)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(vt,{value:"variants"},{default:t(()=>[e(qt,{loading:N(m),onRefresh:N(n)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(vs,{modelValue:N(c),"onUpdate:modelValue":[Z[5]||(Z[5]=le=>Ct(c)?c.value=le:null),Z[6]||(Z[6]=le=>c.value=le)],"edit-mode":N(ee),"form-data":N(r),categories:N(f),loading:N(z),"error-message":N(X),"selected-image":N(v)?[N(v)]:[],"image-preview":N(U),onClose:N(T),onSubmit:N(ne),onImageChange:N(_e),onRemoveImage:rt,onClearError:N(Q),onUpdateForm:Z[7]||(Z[7]=(le,Ue)=>N(r)[le]=Ue)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(ja,{modelValue:N(Te),"onUpdate:modelValue":[Z[8]||(Z[8]=le=>Ct(Te)?Te.value=le:null),Z[9]||(Z[9]=le=>Te.value=le)],"edit-mode":N(re),"form-data":N(Me),"available-items":N(Ie),loading:N(Ze),"error-message":N(et),onClose:N(u),onSave:N(a),onClearError:N(h)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(Lt,{modelValue:N(k),"onUpdate:modelValue":Z[10]||(Z[10]=le=>Ct(k)?k.value=le:null),title:"Konfirmasi Hapus Produk","item-name":(ae=N(x))==null?void 0:ae.name,loading:N(p),"confirm-text":"Hapus Produk",onConfirm:De,onCancel:Z[11]||(Z[11]=le=>k.value=!1)},null,8,["modelValue","item-name","loading"]),e(sa,{modelValue:ue.value,"onUpdate:modelValue":Z[12]||(Z[12]=le=>ue.value=le),product:pe.value,items:lt(pe.value),onSave:ct,onRefresh:ct},null,8,["modelValue","product","items"]),e(Oe,{modelValue:he.value,"onUpdate:modelValue":Z[15]||(Z[15]=le=>he.value=le),"max-width":"1400px",persistent:""},{default:t(()=>[e(se,null,{default:t(()=>[e(Ve,{class:"d-flex justify-between align-center"},{default:t(()=>{var le;return[l("div",Pi,[e(D,{icon:"tabler-versions",class:"me-2"}),_(" Kelola Variant - "+d((le=Pe.value)==null?void 0:le.name),1)]),e(K,{icon:"tabler-x",variant:"text",onClick:Z[13]||(Z[13]=Ue=>he.value=!1)})]}),_:1}),e(ze),e(de,{class:"pa-0"},{default:t(()=>[Pe.value?(w(),j(qt,{key:0,product:Pe.value},null,8,["product"])):Y("",!0)]),_:1}),e(ze),e(Ke,null,{default:t(()=>[e(je),e(K,{color:"grey-darken-1",variant:"outlined",onClick:Z[14]||(Z[14]=le=>he.value=!1)},{default:t(()=>[e(D,{icon:"mdi-close",class:"me-1"}),Z[22]||(Z[22]=_(" Tutup "))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),_r=We(Vi,[["__scopeId","data-v-9db14e64"]]);export{_r as default};
