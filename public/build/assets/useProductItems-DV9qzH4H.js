import{I as O}from"./ItemsApi-CUVhNWnH.js";import{aA as c,V as C,ax as T,r as s}from"./main-D7EKKSaU.js";import{P as S}from"./ProductsApi-BIzUmP9k.js";const y={async getAll(e={}){var t;try{return(await c.get("/api/product-items",{params:e})).data}catch(a){throw console.error("ProductItemsApi.getAll error:",a),((t=a.response)==null?void 0:t.data)||a}},async getById(e){var t;try{return(await c.get(`/api/product-items/${e}`)).data}catch(a){throw console.error("ProductItemsApi.getById error:",a),((t=a.response)==null?void 0:t.data)||a}},async create(e,t=!1){var a;try{const r={...e,is_edit_mode:t};return(await c.post("/api/product-items",r)).data}catch(r){throw console.error("ProductItemsApi.create error:",r),((a=r.response)==null?void 0:a.data)||r}},async upsert(e){var t;try{return(await c.post("/api/product-items/upsert",e)).data}catch(a){throw console.error("ProductItemsApi.upsert error:",a),((t=a.response)==null?void 0:t.data)||a}},async update(e,t){var a;try{return(await c.put(`/api/product-items/${e}`,t)).data}catch(r){throw console.error("ProductItemsApi.update error:",r),((a=r.response)==null?void 0:a.data)||r}},async delete(e){var t;try{return(await c.delete(`/api/product-items/${e}`)).data}catch(a){throw console.error("ProductItemsApi.delete error:",a),((t=a.response)==null?void 0:t.data)||a}},async getProductionCapacity(e){var t;try{return(await c.get(`/api/product-items/production-capacity/${e}`)).data}catch(a){throw console.error("ProductItemsApi.getProductionCapacity error:",a),((t=a.response)==null?void 0:t.data)||a}}},f=s([]),d=s([]),p=s([]),v=s(!1),b=s(!1),I=s(!1),A=s(!1),j=s(!1),q=s(!1),_=s(!1),n=s(null),F=s(null),$=s(null),g=s(1),w=s(0),k=s(15),D=T({search:"",product_id:void 0,item_id:void 0,critical_only:!1,stock_status:null,sort_by:null}),o=s(""),E=s(""),i=s(""),l=T({product_id:0,item_id:0,quantity_needed:0,unit:"",is_critical:!1,notes:""}),U=C(()=>!0),V=C(()=>[{title:"Pilih Produk",value:0},...d.value.map(e=>({title:e.name,value:e.id_product||e.id}))]),z=C(()=>[{title:"Pilih Item",value:0},...p.value.map(e=>({title:`${e.name} (${e.unit})`,value:e.id_item||e.id}))]),h=async()=>{v.value=!0,o.value="";try{const e={page:g.value,per_page:k.value,...D};Object.keys(e).forEach(a=>{const u=e[a];(u===void 0||u===0||typeof u=="string"&&u==="")&&delete e[a]});const t=await y.getAll(e);t.success&&t.data&&(Array.isArray(t.data)?(f.value=t.data,w.value=t.data.length):(f.value=t.data.data||[],w.value=t.data.total||0,g.value=t.data.current_page||1))}catch(e){o.value=e.message||"Failed to fetch product items"}finally{v.value=!1}},M=async()=>{try{const e=await S.getAll({});e.success&&e.data?d.value=Array.isArray(e.data)?e.data:[]:d.value=[]}catch{d.value=[]}},L=async()=>{try{const e=await O.getAll({per_page:"all"});e.success&&e.data&&e.data.data?p.value=Array.isArray(e.data.data)?e.data.data:[]:p.value=[]}catch{p.value=[]}},N=async()=>{if(R()){b.value=!0,i.value="";try{let e;_.value&&n.value?e=await y.update(n.value.id_product_item,l):e=await y.upsert(l),e.success?(E.value=_.value?"Hubungan produk-item berhasil diperbarui!":"Hubungan produk-item berhasil ditambahkan!",G(),await h()):i.value=e.message||"Terjadi kesalahan saat menyimpan"}catch(e){i.value=e.message||"Terjadi kesalahan saat menyimpan"}finally{b.value=!1}}},Q=async()=>{if(n.value){I.value=!0;try{const e=await y.delete(n.value.id_product_item);e.success?(E.value="Hubungan produk-item berhasil dihapus!",H(),await h()):o.value=e.message||"Gagal menghapus hubungan produk-item"}catch(e){o.value=e.message||"Terjadi kesalahan saat menghapus"}finally{I.value=!1}}},x=async e=>{v.value=!0;try{const t=await y.getProductionCapacity(e);t.success?($.value=t.data,q.value=!0):o.value=t.message||"Gagal menghitung kapasitas produksi"}catch(t){o.value=t.message||"Terjadi kesalahan saat menghitung kapasitas produksi"}finally{v.value=!1}},R=()=>l.product_id<=0?(i.value="Produk harus dipilih",!1):l.item_id<=0?(i.value="Item harus dipilih",!1):l.quantity_needed<=0?(i.value="Jumlah yang dibutuhkan harus lebih besar dari 0",!1):l.unit.trim()?!0:(i.value="Satuan harus diisi",!1),W=()=>{_.value=!1,n.value=null,B(),A.value=!0},X=e=>{_.value=!0,n.value=e,ae(e),A.value=!0},Y=e=>{n.value=e,j.value=!0},Z=e=>{let t,a;if(typeof e=="number"){if(t=e,a=d.value.find(r=>(r.id_product||r.id)===t),!a){o.value="Product tidak ditemukan";return}}else if(e&&typeof e=="object")a=e,t=a.id_product||a.id;else{o.value="Parameter tidak valid";return}if(!t){o.value="Product ID tidak ditemukan";return}F.value=a,x(t)},G=()=>{A.value=!1,K(),B()},H=()=>{j.value=!1,n.value=null},ee=()=>{q.value=!1,F.value=null,$.value=null},B=()=>{Object.assign(l,{product_id:0,item_id:0,quantity_needed:0,unit:"",is_critical:!1,notes:""})},ae=e=>{Object.assign(l,{product_id:e.product_id,item_id:e.item_id,quantity_needed:e.quantity_needed,unit:e.unit,is_critical:e.is_critical,notes:e.notes||""})},K=()=>{i.value=""},te=e=>{const t=p.value.find(a=>(a.id_item||a.id)===e);t&&(l.unit=t.unit)},se=e=>{g.value=e,h()},re=e=>{k.value=e,g.value=1,h()},oe=()=>{g.value=1,h()},ue=()=>({productItemsList:f,products:d,items:p,loading:v,saveLoading:b,deleteLoading:I,dialog:A,deleteDialog:j,capacityDialog:q,editMode:_,selectedProductItem:n,selectedProduct:F,productionCapacity:$,currentPage:g,totalItems:w,itemsPerPage:k,filters:D,errorMessage:o,successMessage:E,modalErrorMessage:i,formData:l,canCreateEdit:U,productOptions:V,itemOptions:z,fetchProductItemsList:h,fetchProductItemsForComposition:async e=>{var t,a,r,u;v.value=!0,o.value="";try{const P={page:(e==null?void 0:e.page)||1,per_page:(e==null?void 0:e.per_page)||15,critical_only:(e==null?void 0:e.critical_only)||!1},m=await y.getAll(P);if(m.success){const J=((t=m.data)==null?void 0:t.data)||m.data||[];f.value=J,g.value=((a=m.data)==null?void 0:a.current_page)||1,w.value=((r=m.data)==null?void 0:r.total)||0,k.value=((u=m.data)==null?void 0:u.per_page)||15,D.critical_only=P.critical_only,d.value.length===0&&await M(),p.value.length===0&&await L()}else f.value=[]}catch(P){o.value=P.message||"Gagal memuat data komposisi produk",f.value=[]}finally{v.value=!1}},fetchProducts:M,fetchItems:L,saveProductItem:N,deleteProductItem:Q,getProductionCapacity:x,openCreateDialog:W,openEditDialog:X,openDeleteDialog:Y,openCapacityDialog:Z,closeDialog:G,closeDeleteDialog:H,closeCapacityDialog:ee,clearModalError:K,onItemChange:te,onPageChange:se,onItemsPerPageChange:re,handleFiltersUpdate:oe});export{y as P,ue as u};
