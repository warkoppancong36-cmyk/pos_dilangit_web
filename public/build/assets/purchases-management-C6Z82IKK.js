import{g as Y}from"./auth-CuuXRWj5.js";import{d as Ve,V as ne,r as C,w as ge,D as qe,g as O,o as b,f as a,b as e,e as t,X as K,s as d,c as P,l as $,t as i,a1 as S,ao as ze,ap as Ue,i as ye,p as Pe,F as he,au as J,av as De,_ as Ce,v as Ie,at as $e,cw as je}from"./main-l8Zi8A50.js";import{V as xe}from"./VDialog-DYAQGxH1.js";import{b as W,V as z,c as we}from"./VCard-B80elx7E.js";import{V as N}from"./VCardText-BPi2Iy10.js";import{V as Ae}from"./VForm-Dz1nuN24.js";import{V as te,a as q}from"./VRow-DDBVNEM2.js";import{V as be}from"./VSelect-BaoN9uK2.js";import{a as pe,b as me,d as Se,V as Ne}from"./VList-BhQfh3yK.js";import{V as Z}from"./VTextField-BGm3d7HA.js";import{V as Fe}from"./VTextarea-mGjTw0i3.js";import{V as Te}from"./VTable-Eeu4cyAU.js";import{V as Re}from"./VAutocomplete-D_Fgnud1.js";import{V as fe}from"./VDivider-j9GK0eK6.js";import{V as ke}from"./VSpacer-Cyn05D7k.js";import{V as ae}from"./VChip-Du4c8qsc.js";import{V as Be,a as Ee}from"./VDataTable-DUjMRVtp.js";import{V as Oe}from"./VContainer-bTONlHOE.js";import{V as Me}from"./VDataTableServer-B8pWy51D.js";import{V as Le}from"./VMenu-BQ9xgK0C.js";import{V as He}from"./VSnackbar-DHw1CR8v.js";import"./VOverlay-nC_It03B.js";import"./forwardRefs-B931MWyl.js";import"./VImg-DSOJICNe.js";import"./VAvatar-BMYyudiA.js";/* empty css              */import"./VCheckboxBtn-DlffD0dx.js";import"./filter-CtZEku-b.js";const Qe={class:"d-flex align-center gap-2"},Ke={class:"d-flex flex-column"},Ge={key:0,class:"text-caption text-medium-emphasis"},Xe={class:"mt-6"},Je={class:"d-flex justify-space-between align-center mb-4"},We={key:0},Ye={class:"text-center font-weight-medium"},Ze={class:"text-center font-weight-medium"},et={class:"text-end"},tt={class:"d-flex justify-space-between mb-2"},at={class:"font-weight-medium"},lt={class:"d-flex justify-space-between mb-2"},st={class:"text-success"},nt={class:"d-flex justify-space-between"},ot={class:"text-h6 font-weight-bold text-primary"},it=Ve({__name:"PurchaseDialog",props:{modelValue:{type:Boolean},purchase:{default:null},mode:{default:"create"}},emits:["update:modelValue","saved"],setup(de,{emit:le}){const h=de,L=le,F=ne({get:()=>h.modelValue,set:u=>L("update:modelValue",u)}),j=C(),A=C(!1),T=C(!1),D=C(!1),R=C(!1),M=C([]),B=C([]),f=C({id_supplier:null,purchase_date:new Date().toISOString().split("T")[0],notes:"",discount_amount:0,discount_amount_display:"0",items:[]}),c=ne(()=>h.mode==="edit"?"Edit Purchase Order":"Buat Purchase Order Baru"),s=ne(()=>{const u=f.value.items.reduce((y,E)=>y+(E.total_cost||0),0),n=Number.parseFloat(String(f.value.discount_amount_display).replace(/\D/g,""))||0,r=0,g=u-n+r;return{subtotal:u,discount:n,tax:r,total:g}}),x=ne(()=>A.value&&(f.value.items.length===0||f.value.items.every(u=>u.id_item&&u.quantity>0&&u.unit_cost>0))),U={required:u=>!!u||"Field ini wajib diisi"},w=async()=>{try{D.value=!0;const u=Y(),n={"Content-Type":"application/json",Accept:"application/json"};u&&(n.Authorization=`Bearer ${u}`);const r=await J.get("/api/suppliers",{headers:n});M.value=r.data.data||[]}catch(u){console.error("Error loading suppliers:",u)}finally{D.value=!1}},H=async()=>{var u;try{R.value=!0;const n=Y(),r={"Content-Type":"application/json",Accept:"application/json"};n&&(r.Authorization=`Bearer ${n}`);const g=await J.get("/api/items?per_page=all",{headers:r}),y=g.data.data;y&&y.data?B.value=y.data||[]:B.value=g.data.data||[]}catch(n){console.error("Error loading items:",n),console.error("Error response:",(u=n.response)==null?void 0:u.data)}finally{R.value=!1}},oe=u=>{try{const n=f.value.items[u];if(!n){console.warn("Item not found at index:",u);return}n.quantity>0&&n.total_cost>0?(n.unit_cost=n.total_cost/n.quantity,n.unit_cost_display=Q(n.unit_cost).replace("Rp ","").replace(/\./g,"")):(n.unit_cost=0,n.unit_cost_display="0")}catch(n){console.error("Error in calculateUnitCost:",n)}},G=u=>{try{const n=f.value.items[u];if(!n){console.warn("Item not found at index:",u);return}n.quantity>0&&n.unit_cost>0?(n.total_cost=n.quantity*n.unit_cost,n.total_cost_display=new Intl.NumberFormat("id-ID").format(n.total_cost)):(n.total_cost=0,n.total_cost_display="0")}catch(n){console.error("Error in calculateTotalCost:",n)}},ve=(u,n)=>{try{const r=f.value.items[u];if(!r||!n)return;const g=B.value.find(y=>y.id_item===n);g&&(r.unit=g.unit||"")}catch(r){console.error("Error in onItemChange:",r)}},se=()=>{try{const u={id_item:null,quantity:0,unit:"",unit_cost:0,unit_cost_display:"0",total_cost:0,total_cost_display:"0"};f.value.items.push(u)}catch(u){console.error("Error in addItem:",u)}},ce=u=>{f.value.items.splice(u,1)},_=(u,n)=>{var y;const r=(y=n.target)==null?void 0:y.value,g=f.value.items[u];r===""||r===null||r===void 0?g.quantity=0:g.quantity=Number.parseFloat(r)||1,G(u)},v=(u,n)=>{var E;const r=(E=n.target)==null?void 0:E.value,g=(r==null?void 0:r.replace(/\D/g,""))||"",y=f.value.items[u];g===""?(y.total_cost=0,y.total_cost_display="0"):(y.total_cost=Number.parseFloat(g),y.total_cost_display=new Intl.NumberFormat("id-ID").format(y.total_cost)),oe(u)},m=u=>{var g;const n=(g=u.target)==null?void 0:g.value,r=(n==null?void 0:n.replace(/\D/g,""))||"";r===""?f.value.discount_amount_display="0":f.value.discount_amount_display=new Intl.NumberFormat("id-ID").format(Number.parseInt(r))},k=()=>{},Q=u=>Number.isNaN(u)||u===null||u===void 0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(u),ie=()=>{var u,n,r;if(console.log("=== Initializing form ==="),console.log("Mode:",h.mode),console.log("Purchase data:",h.purchase),console.log("Available suppliers:",M.value),h.mode==="edit"&&h.purchase){const g=h.purchase.supplier_id||h.purchase.id_supplier||((u=h.purchase.supplier)==null?void 0:u.id_supplier)||((n=h.purchase.supplier)==null?void 0:n.id);console.log("Found supplier ID:",g);const y=g?Number.parseInt(String(g)):null;console.log("Converted supplier ID to number:",y);const E=M.value.find(l=>l.id_supplier===y);console.log("Supplier exists in list:",E);const p=h.purchase.purchase_date?new Date(h.purchase.purchase_date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0];f.value={id_supplier:y,purchase_date:p,notes:h.purchase.notes||"",discount_amount:h.purchase.discount_amount||0,discount_amount_display:new Intl.NumberFormat("id-ID").format(h.purchase.discount_amount||0),items:((r=h.purchase.items)==null?void 0:r.map(l=>{var X,re;const o=Number.parseFloat(l.quantity_ordered||l.quantity||0)||0,V=Number.parseFloat(l.unit_cost||0)||0,I=o*V;return{id_item:((X=l.item)==null?void 0:X.id_item)||l.id_item,quantity:o,unit:((re=l.item)==null?void 0:re.unit)||l.unit||"",unit_cost:V,unit_cost_display:new Intl.NumberFormat("id-ID").format(V),total_cost:I,total_cost_display:new Intl.NumberFormat("id-ID").format(I)}}))||[]},console.log("Final form data:",f.value)}else f.value={id_supplier:null,purchase_date:new Date().toISOString().split("T")[0],notes:"",discount_amount:0,discount_amount_display:"0",items:[]}},ee=async()=>{var u,n,r;if((u=j.value)!=null&&u.validate())try{T.value=!0;const g=Y(),y={"Content-Type":"application/json",Accept:"application/json"};g&&(y.Authorization=`Bearer ${g}`);const E={supplier_id:f.value.id_supplier,purchase_date:f.value.purchase_date,notes:f.value.notes,discount_amount:Number.parseFloat(f.value.discount_amount_display.replace(/\D/g,""))||0,items:f.value.items.map(p=>({id_item:p.id_item,quantity:p.quantity,unit_cost:p.unit_cost}))};h.mode==="edit"?await J.put(`/api/purchases/${h.purchase.id_purchase}`,E,{headers:y}):await J.post("/api/purchases",E,{headers:y}),L("saved")}catch(g){console.error("Error saving purchase:",g),console.error("Error saving purchase:",((r=(n=g.response)==null?void 0:n.data)==null?void 0:r.message)||g.message)}finally{T.value=!1}},_e=()=>{F.value=!1},ue=()=>{f.value.items.forEach((u,n)=>{if(u.id_item&&!u.unit){const r=B.value.find(g=>g.id_item===u.id_item);r&&(u.unit=r.unit)}})};return ge(()=>h.modelValue,async u=>{u&&(await Promise.all([w(),H()]),await De(),ie(),ue())}),ge(()=>h.purchase,async u=>{u&&h.mode==="edit"&&(M.value.length===0&&await w(),B.value.length===0&&await H(),await De(),ie(),ue())},{deep:!0,immediate:!0}),qe(()=>{w(),H()}),(u,n)=>(b(),O(xe,{modelValue:F.value,"onUpdate:modelValue":n[5]||(n[5]=r=>F.value=r),"max-width":"1200",persistent:""},{default:a(()=>[e(z,null,{default:a(()=>[e(W,{class:"d-flex align-center justify-space-between"},{default:a(()=>{var r;return[t("div",Qe,[e(K,null,{default:a(()=>n[6]||(n[6]=[d("mdi-cart-plus")])),_:1,__:[6]}),t("div",Ke,[t("span",null,i(c.value),1),h.mode==="edit"&&((r=h.purchase)!=null&&r.purchase_number)?(b(),P("span",Ge," No. Order: "+i(h.purchase.purchase_number),1)):$("",!0)])]),e(S,{icon:"mdi-close",size:"small",variant:"text",onClick:_e})]}),_:1}),e(N,null,{default:a(()=>[e(Ae,{ref_key:"form",ref:j,modelValue:A.value,"onUpdate:modelValue":n[3]||(n[3]=r=>A.value=r)},{default:a(()=>[e(te,null,{default:a(()=>[e(q,{cols:"12",md:"6"},{default:a(()=>[e(be,{modelValue:f.value.id_supplier,"onUpdate:modelValue":n[0]||(n[0]=r=>f.value.id_supplier=r),label:"Supplier *",items:M.value,"item-title":"name","item-value":"id_supplier",variant:"outlined",rules:[U.required],loading:D.value},{item:a(({props:r,item:g})=>[e(pe,ze(Ue(r)),{default:a(()=>[e(me,null,{default:a(()=>[d(i(g.raw.name),1)]),_:2},1024),e(Se,null,{default:a(()=>[d(i(g.raw.phone)+" - "+i(g.raw.email),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","rules","loading"])]),_:1}),e(q,{cols:"12",md:"3"},{default:a(()=>[e(Z,{modelValue:f.value.purchase_date,"onUpdate:modelValue":n[1]||(n[1]=r=>f.value.purchase_date=r),label:"Tanggal Purchase *",type:"date",variant:"outlined",rules:[U.required]},null,8,["modelValue","rules"])]),_:1}),e(q,{cols:"12"},{default:a(()=>[e(Fe,{modelValue:f.value.notes,"onUpdate:modelValue":n[2]||(n[2]=r=>f.value.notes=r),label:"Catatan",variant:"outlined",rows:"2",placeholder:"Catatan tambahan untuk purchase order ini..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t("div",Xe,[t("div",Je,[n[9]||(n[9]=t("h3",{class:"text-h6"}," Items Purchase ",-1)),e(S,{color:"primary",variant:"tonal",onClick:se},{default:a(()=>[e(K,{start:""},{default:a(()=>n[7]||(n[7]=[d(" mdi-plus ")])),_:1,__:[7]}),n[8]||(n[8]=d(" Tambah Item "))]),_:1,__:[8]})]),e(z,{variant:"outlined"},{default:a(()=>[e(Te,null,{default:a(()=>[n[11]||(n[11]=t("thead",null,[t("tr",null,[t("th",{style:{"inline-size":"35%"}}," Item "),t("th",{style:{"inline-size":"12%"}}," Quantity "),t("th",{style:{"inline-size":"10%"}}," Unit "),t("th",{style:{"inline-size":"15%"}}," Total Harga "),t("th",{style:{"inline-size":"15%"}}," Harga Satuan "),t("th",{style:{"inline-size":"13%"}}," Action ")])],-1)),t("tbody",null,[f.value.items.length===0?(b(),P("tr",We,n[10]||(n[10]=[t("td",{colspan:"6",class:"text-center py-8 text-medium-emphasis"},' Belum ada item. Klik "Tambah Item" untuk menambah item purchase. ',-1)]))):$("",!0),(b(!0),P(he,null,ye(f.value.items,(r,g)=>(b(),P("tr",{key:g},[t("td",null,[e(Re,{modelValue:r.id_item,"onUpdate:modelValue":[y=>r.id_item=y,y=>ve(g,y)],label:"Pilih Item",items:B.value,"item-title":"name","item-value":"id_item",variant:"outlined",density:"compact",loading:R.value,clearable:"","no-data-text":"Tidak ada item ditemukan"},{item:a(({props:y,item:E})=>[e(pe,Pe({ref_for:!0},y),{default:a(()=>[e(me,null,{default:a(()=>[d(i(E.raw.name),1)]),_:2},1024),e(Se,null,{default:a(()=>{var p;return[d(i((p=E.raw.category)==null?void 0:p.name)+" - SKU: "+i(E.raw.sku),1)]}),_:2},1024)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","items","loading"])]),t("td",null,[e(Z,{modelValue:r.quantity,"onUpdate:modelValue":y=>r.quantity=y,label:"Qty",type:"number",min:"1",step:"1",variant:"outlined",density:"compact",onInput:y=>_(g,y),onBlur:y=>oe(g)},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur"])]),t("td",null,[t("div",Ye,i(r.unit||"-"),1)]),t("td",null,[e(Z,{modelValue:r.total_cost_display,"onUpdate:modelValue":y=>r.total_cost_display=y,label:"Total Harga",variant:"outlined",density:"compact",prefix:"Rp",onInput:y=>v(g,y),onBlur:y=>oe(g)},null,8,["modelValue","onUpdate:modelValue","onInput","onBlur"])]),t("td",null,[t("div",Ze,i(Q(r.unit_cost)),1)]),t("td",null,[e(S,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:y=>ce(g)},null,8,["onClick"])])]))),128))])]),_:1,__:[11]})]),_:1}),e(z,{class:"mt-4",variant:"outlined"},{default:a(()=>[e(N,null,{default:a(()=>[e(te,null,{default:a(()=>[e(q,{cols:"12",md:"8"},{default:a(()=>[e(Z,{modelValue:f.value.discount_amount_display,"onUpdate:modelValue":n[4]||(n[4]=r=>f.value.discount_amount_display=r),label:"Diskon",variant:"outlined",prefix:"Rp",placeholder:"0",onInput:m,onBlur:k},null,8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"4"},{default:a(()=>[t("div",et,[t("div",tt,[n[12]||(n[12]=t("span",null,"Subtotal:",-1)),t("span",at,i(Q(s.value.subtotal)),1)]),t("div",lt,[n[13]||(n[13]=t("span",null,"Diskon:",-1)),t("span",st,"-"+i(Q(s.value.discount)),1)]),e(fe,{class:"my-2"}),t("div",nt,[n[14]||(n[14]=t("span",{class:"text-h6 font-weight-bold"},"Total:",-1)),t("span",ot,i(Q(s.value.total)),1)])])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}),e(we,{class:"pa-4"},{default:a(()=>[e(ke),e(S,{variant:"text",onClick:_e},{default:a(()=>n[15]||(n[15]=[d(" Batal ")])),_:1,__:[15]}),e(S,{color:"primary",loading:T.value,disabled:!x.value,onClick:ee},{default:a(()=>[d(i(u.mode==="edit"?"Update":"Simpan"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ut=Ce(it,[["__scopeId","data-v-a9b5ffa4"]]),rt={class:"d-flex align-center gap-3"},dt={class:"d-flex justify-space-between align-center"},ct={class:"text-h6"},pt={class:"text-body-1"},mt={class:"font-weight-medium"},vt={class:"text-caption text-medium-emphasis"},ft={class:"font-weight-medium"},_t={class:"d-flex justify-space-between"},gt={class:"font-weight-medium"},yt=Ve({__name:"PurchaseReceiveDialog",props:{modelValue:{type:Boolean},purchase:{}},emits:["update:modelValue","success"],setup(de,{emit:le}){const h=de,L=le,F=C(!1),j=C(!1),A=C(new Date().toISOString().split("T")[0]),T=C([]),D=ne({get:()=>h.modelValue,set:_=>L("update:modelValue",_)}),R=ne(()=>A.value&&s()>0&&!j.value),M=[{title:"Item",key:"item_name",sortable:!1,width:"250px"},{title:"Ordered",key:"quantity_ordered",sortable:!1,width:"110px"},{title:"Received",key:"quantity_received",sortable:!1,width:"110px"},{title:"Remaining",key:"remaining",sortable:!1,width:"110px"},{title:"Receive Qty",key:"receive_quantity",sortable:!1,width:"140px"},{title:"Quality",key:"quality_check",sortable:!1,width:"140px"},{title:"Notes",key:"notes",sortable:!1,width:"200px"},{title:"Status",key:"status",sortable:!1,width:"120px"}],B=[{title:"✅ Good",value:"good"},{title:"❌ Damaged",value:"damaged"},{title:"⏰ Expired",value:"expired"},{title:"⚠️ Issues",value:"partial"}],f=_=>_.quantity_ordered-(_.quantity_received||0),c=_=>{const v=f(_);return v<=0?"text-success":v<_.quantity_ordered*.5?"text-warning":""},s=()=>T.value.filter(_=>_.receive_quantity&&_.receive_quantity>0).length,x=_=>{const v=f(_);_.receive_quantity>v&&(_.receive_quantity=v),_.receive_quantity<0&&(_.receive_quantity=0)},U=_=>({pending:"warning",ordered:"info",partial:"primary",received:"success",completed:"success",cancelled:"error"})[_]||"default",w=_=>({pending:"Pending",ordered:"Ordered",partial:"Partial",received:"Received",completed:"Completed",cancelled:"Cancelled"})[_]||_,H=_=>({pending:"warning",partial:"primary",received:"success"})[_]||"default",oe=_=>({pending:"Pending",partial:"Partial",received:"Complete"})[_]||_,G=_=>new Date(_).toLocaleDateString("id-ID"),ve=async()=>{var _,v;if((_=h.purchase)!=null&&_.id_purchase){F.value=!0;try{if(h.purchase.items&&h.purchase.items.length>0){T.value=h.purchase.items.map(k=>({...k,receive_quantity:0,quality_condition:"good",receive_notes:""})),F.value=!1;return}const m=await J.get(`/api/purchases/${h.purchase.id_purchase}`,{headers:{Authorization:`Bearer ${Y()}`}});m.data.success&&((v=m.data.data)!=null&&v.items)&&(T.value=m.data.data.items.map(k=>({...k,receive_quantity:0,quality_condition:"good",receive_notes:""})))}catch(m){console.error("Error loading purchase items:",m)}finally{F.value=!1}}},se=async()=>{if(!R.value)return;const _=T.value.filter(v=>v.receive_quantity&&v.receive_quantity>0).map(v=>({id_purchase_item:v.id_purchase_item,quantity_received:v.receive_quantity,quality_check:{condition:v.quality_condition,checked_at:new Date().toISOString(),checked_by:"current_user"},notes:v.receive_notes||null}));if(_.length!==0){j.value=!0;try{const v=await J.post(`/api/purchases/${h.purchase.id_purchase}/receive`,{items:_,delivery_date:A.value},{headers:{Authorization:`Bearer ${Y()}`}});v.data.success&&(L("success",v.data),ce())}catch(v){console.error("Error receiving items:",v)}finally{j.value=!1}}},ce=()=>{D.value=!1,T.value=[],A.value=new Date().toISOString().split("T")[0]};return ge(D,_=>{_&&h.purchase&&ve()}),(_,v)=>(b(),O(xe,{modelValue:D.value,"onUpdate:modelValue":v[1]||(v[1]=m=>D.value=m),"max-width":"1400px",persistent:""},{default:a(()=>[e(z,null,{default:a(()=>[e(W,{class:"pa-4"},{default:a(()=>{var m;return[t("div",rt,[e(K,{icon:"mdi-package-variant"}),t("span",null,"Receive Items - Purchase #"+i((m=_.purchase)==null?void 0:m.purchase_number),1)])]}),_:1}),e(fe),e(N,{class:"pa-4"},{default:a(()=>[e(z,{variant:"outlined",class:"mb-4"},{default:a(()=>[e(N,{class:"pa-3"},{default:a(()=>{var m,k,Q,ie;return[t("div",dt,[t("div",null,[v[2]||(v[2]=t("div",{class:"text-body-2 text-medium-emphasis"}," Supplier ",-1)),t("div",ct,i((k=(m=_.purchase)==null?void 0:m.supplier)==null?void 0:k.name),1)]),t("div",null,[v[3]||(v[3]=t("div",{class:"text-body-2 text-medium-emphasis"}," Order Date ",-1)),t("div",pt,i(G((Q=_.purchase)==null?void 0:Q.purchase_date)),1)]),t("div",null,[v[4]||(v[4]=t("div",{class:"text-body-2 text-medium-emphasis"}," Status ",-1)),e(ae,{color:U((ie=_.purchase)==null?void 0:ie.status),variant:"tonal",size:"small"},{default:a(()=>{var ee;return[d(i(w((ee=_.purchase)==null?void 0:ee.status)),1)]}),_:1},8,["color"])])])]}),_:1})]),_:1}),e(te,{class:"mb-4"},{default:a(()=>[e(q,{cols:"12",md:"6"},{default:a(()=>[e(Z,{modelValue:A.value,"onUpdate:modelValue":v[0]||(v[0]=m=>A.value=m),label:"Delivery Date",type:"date",variant:"outlined",rules:[m=>!!m||"Delivery date is required"],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1}),v[7]||(v[7]=t("div",{class:"text-h6 mb-3"}," Items to Receive ",-1)),e(Be,{headers:M,items:T.value,loading:F.value,"item-key":"id_purchase_item",class:"border rounded",density:"compact"},{"item.item_name":a(({item:m})=>{var k,Q;return[t("div",null,[t("div",mt,i((k=m.item)==null?void 0:k.name),1),t("div",vt,i((Q=m.item)==null?void 0:Q.item_code),1)])]}),"item.quantity_ordered":a(({item:m})=>{var k;return[t("span",ft,i(parseInt(m.quantity_ordered))+" "+i((k=m.item)==null?void 0:k.unit),1)]}),"item.quantity_received":a(({item:m})=>{var k;return[t("span",{class:Ie(m.quantity_received>0?"text-success":"")},i(m.quantity_received||0)+" "+i((k=m.item)==null?void 0:k.unit),3)]}),"item.remaining":a(({item:m})=>{var k;return[t("span",{class:Ie(["font-weight-medium",c(m)])},i(f(m))+" "+i((k=m.item)==null?void 0:k.unit),3)]}),"item.receive_quantity":a(({item:m})=>[e(Z,{modelValue:m.receive_quantity,"onUpdate:modelValue":k=>m.receive_quantity=k,modelModifiers:{number:!0},type:"number",min:0,max:f(m),step:"0.001",density:"compact",variant:"outlined",style:{"inline-size":"140px"},disabled:f(m)<=0,onInput:k=>x(m)},null,8,["modelValue","onUpdate:modelValue","max","disabled","onInput"])]),"item.quality_check":a(({item:m})=>[e(be,{modelValue:m.quality_condition,"onUpdate:modelValue":k=>m.quality_condition=k,items:B,density:"compact",variant:"outlined",style:{"inline-size":"140px"},disabled:!m.receive_quantity||m.receive_quantity<=0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.notes":a(({item:m})=>[e(Z,{modelValue:m.receive_notes,"onUpdate:modelValue":k=>m.receive_notes=k,placeholder:"Notes...",density:"compact",variant:"outlined",style:{"inline-size":"200px"},disabled:!m.receive_quantity||m.receive_quantity<=0},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.status":a(({item:m})=>[e(ae,{color:H(m.status),variant:"tonal",size:"small"},{default:a(()=>[d(i(oe(m.status)),1)]),_:2},1032,["color"])]),_:1},8,["items","loading"]),e(z,{variant:"outlined",class:"mt-4"},{default:a(()=>[e(N,{class:"pa-3"},{default:a(()=>[v[6]||(v[6]=t("div",{class:"text-body-2 text-medium-emphasis mb-2"}," Receive Summary ",-1)),t("div",_t,[v[5]||(v[5]=t("span",null,"Items to receive:",-1)),t("span",gt,i(s()),1)])]),_:1,__:[6]})]),_:1})]),_:1,__:[7]}),e(fe),e(we,{class:"pa-4"},{default:a(()=>[e(ke),e(S,{variant:"outlined",disabled:j.value,onClick:ce},{default:a(()=>v[8]||(v[8]=[d(" Cancel ")])),_:1,__:[8]},8,["disabled"]),e(S,{color:"primary",loading:j.value,disabled:!R.value,onClick:se},{default:a(()=>[e(K,{start:"",icon:"mdi-check"}),v[9]||(v[9]=d(" Confirm Receipt "))]),_:1,__:[9]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ht={class:"d-flex align-center gap-2"},bt={class:"mb-2"},Vt={class:"text-primary font-weight-medium"},xt={class:"mb-2"},wt={class:"mb-2"},kt={key:0,class:"mb-2"},Ct={key:1},Dt={class:"mb-2"},It={class:"mb-2"},$t={class:"mb-2"},St={class:"mb-1 font-weight-medium"},qt={key:0,class:"text-caption text-medium-emphasis mb-0"},Pt={key:1,class:"text-caption text-medium-emphasis mb-0"},Tt={class:"text-center"},zt={key:0},Ut={class:"text-right font-weight-medium"},jt={class:"text-right font-weight-medium"},At={class:"text-center"},Nt={class:"mb-0"},Ft={class:"mb-2"},Rt={key:0},Bt={class:"d-flex justify-space-between mb-2"},Et={class:"font-weight-medium"},Ot={key:0,class:"d-flex justify-space-between mb-2"},Mt={class:"text-success"},Lt={class:"d-flex justify-space-between"},Ht={class:"text-h6 font-weight-bold text-primary"},Qt=Ve({__name:"PurchaseViewDialog",props:{modelValue:{type:Boolean},purchase:{default:null}},emits:["update:modelValue"],setup(de,{emit:le}){const h=de,L=le,F=ne({get:()=>h.modelValue,set:c=>L("update:modelValue",c)}),j=ne(()=>h.purchase&&h.purchase.status!=="cancelled"),A=()=>{F.value=!1},T=c=>{const s=typeof c=="string"?parseFloat(c):c;return isNaN(s)||s===null||s===void 0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)},D=c=>c?new Date(c).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"}):"-",R=c=>c?new Date(c).toLocaleString("id-ID",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",M=c=>({pending:"warning",partial:"info",received:"success",cancelled:"error"})[c]||"default",B=c=>({pending:"Pending",partial:"Sebagian",received:"Diterima",cancelled:"Dibatalkan"})[c]||c,f=()=>{window.print()};return(c,s)=>(b(),O(xe,{modelValue:F.value,"onUpdate:modelValue":s[0]||(s[0]=x=>F.value=x),"max-width":"900",persistent:""},{default:a(()=>[e(z,null,{default:a(()=>[e(W,{class:"d-flex align-center justify-space-between"},{default:a(()=>[t("div",ht,[e(K,null,{default:a(()=>s[1]||(s[1]=[d("mdi-file-document-outline")])),_:1,__:[1]}),s[2]||(s[2]=t("span",null,"Purchase Order Detail",-1))]),e(S,{icon:"mdi-close",size:"small",variant:"text",onClick:A})]),_:1}),c.purchase?(b(),O(N,{key:0},{default:a(()=>[e(te,{class:"mb-6"},{default:a(()=>[e(q,{cols:"12",md:"6"},{default:a(()=>[e(z,{variant:"outlined"},{default:a(()=>[e(W,{class:"text-subtitle-1"},{default:a(()=>s[3]||(s[3]=[d("Purchase Information")])),_:1,__:[3]}),e(N,null,{default:a(()=>[t("div",bt,[s[4]||(s[4]=t("strong",null,"Purchase Number:",-1)),s[5]||(s[5]=t("br",null,null,-1)),t("span",Vt,i(c.purchase.purchase_number),1)]),t("div",xt,[s[6]||(s[6]=t("strong",null,"Status:",-1)),s[7]||(s[7]=t("br",null,null,-1)),e(ae,{color:M(c.purchase.status),size:"small",variant:"elevated"},{default:a(()=>[d(i(B(c.purchase.status)),1)]),_:1},8,["color"])]),t("div",wt,[s[8]||(s[8]=t("strong",null,"Tanggal Purchase:",-1)),s[9]||(s[9]=t("br",null,null,-1)),d(" "+i(D(c.purchase.purchase_date)),1)]),c.purchase.expected_delivery_date?(b(),P("div",kt,[s[10]||(s[10]=t("strong",null,"Tanggal Kirim Diharapkan:",-1)),s[11]||(s[11]=t("br",null,null,-1)),d(" "+i(D(c.purchase.expected_delivery_date)),1)])):$("",!0),c.purchase.actual_delivery_date?(b(),P("div",Ct,[s[12]||(s[12]=t("strong",null,"Tanggal Kirim Aktual:",-1)),s[13]||(s[13]=t("br",null,null,-1)),d(" "+i(D(c.purchase.actual_delivery_date)),1)])):$("",!0)]),_:1})]),_:1})]),_:1}),e(q,{cols:"12",md:"6"},{default:a(()=>[e(z,{variant:"outlined"},{default:a(()=>[e(W,{class:"text-subtitle-1"},{default:a(()=>s[14]||(s[14]=[d("Supplier Information")])),_:1,__:[14]}),e(N,null,{default:a(()=>{var x,U,w,H;return[t("div",Dt,[s[15]||(s[15]=t("strong",null,"Nama Supplier:",-1)),s[16]||(s[16]=t("br",null,null,-1)),d(" "+i(((x=c.purchase.supplier)==null?void 0:x.name)||"-"),1)]),t("div",It,[s[17]||(s[17]=t("strong",null,"Telepon:",-1)),s[18]||(s[18]=t("br",null,null,-1)),d(" "+i(((U=c.purchase.supplier)==null?void 0:U.phone)||"-"),1)]),t("div",$t,[s[19]||(s[19]=t("strong",null,"Email:",-1)),s[20]||(s[20]=t("br",null,null,-1)),d(" "+i(((w=c.purchase.supplier)==null?void 0:w.email)||"-"),1)]),t("div",null,[s[21]||(s[21]=t("strong",null,"Alamat:",-1)),s[22]||(s[22]=t("br",null,null,-1)),d(" "+i(((H=c.purchase.supplier)==null?void 0:H.address)||"-"),1)])]}),_:1})]),_:1})]),_:1})]),_:1}),e(z,{variant:"outlined",class:"mb-6"},{default:a(()=>[e(W,{class:"text-subtitle-1"},{default:a(()=>s[23]||(s[23]=[d("Items Purchase")])),_:1,__:[23]}),e(Te,null,{default:a(()=>[s[24]||(s[24]=t("thead",null,[t("tr",null,[t("th",null,"Item"),t("th",{class:"text-center"},"Qty"),t("th",{class:"text-right"},"Unit Cost"),t("th",{class:"text-right"},"Total Cost"),t("th",{class:"text-center"},"Status")])],-1)),t("tbody",null,[(b(!0),P(he,null,ye(c.purchase.items,x=>{var U,w,H;return b(),P("tr",{key:x.id_purchase_item},[t("td",null,[t("div",null,[t("p",St,i(((U=x.item)==null?void 0:U.name)||"-"),1),(w=x.item)!=null&&w.code?(b(),P("p",qt," Code: "+i(x.item.code),1)):$("",!0),(H=x.item)!=null&&H.description?(b(),P("p",Pt,i(x.item.description),1)):$("",!0)])]),t("td",Tt,[e(ae,{size:"small",variant:"outlined"},{default:a(()=>[d(i(parseInt(x.quantity_ordered))+" "+i(x.unit||"pcs"),1)]),_:2},1024),x.quantity_received>0?(b(),P("br",zt)):$("",!0),x.quantity_received>0?(b(),O(ae,{key:1,size:"x-small",variant:"tonal",color:"success",class:"mt-1"},{default:a(()=>[d(" Received: "+i(parseInt(x.quantity_received)),1)]),_:2},1024)):$("",!0)]),t("td",Ut,i(T(x.unit_cost)),1),t("td",jt,i(T(x.total_cost)),1),t("td",At,[e(ae,{color:M(x.status),size:"small",variant:"tonal"},{default:a(()=>[d(i(B(x.status)),1)]),_:2},1032,["color"])])])}),128))])]),_:1,__:[24]})]),_:1}),e(te,null,{default:a(()=>[e(q,{cols:"12",md:"6"},{default:a(()=>[c.purchase.notes?(b(),O(z,{key:0,variant:"outlined"},{default:a(()=>[e(W,{class:"text-subtitle-1"},{default:a(()=>s[25]||(s[25]=[d("Catatan")])),_:1,__:[25]}),e(N,null,{default:a(()=>[t("p",Nt,i(c.purchase.notes),1)]),_:1})]),_:1})):$("",!0),e(z,{variant:"outlined",class:"mt-4"},{default:a(()=>[e(W,{class:"text-subtitle-1"},{default:a(()=>s[26]||(s[26]=[d("Purchase History")])),_:1,__:[26]}),e(N,null,{default:a(()=>{var x,U;return[t("div",Ft,[s[27]||(s[27]=t("strong",null,"Dibuat oleh:",-1)),s[28]||(s[28]=t("br",null,null,-1)),d(" "+i(((x=c.purchase.creator)==null?void 0:x.name)||"-")+" • "+i(R(c.purchase.created_at)),1)]),c.purchase.updated_at&&c.purchase.updated_at!==c.purchase.created_at?(b(),P("div",Rt,[s[29]||(s[29]=t("strong",null,"Diupdate oleh:",-1)),s[30]||(s[30]=t("br",null,null,-1)),d(" "+i(((U=c.purchase.updater)==null?void 0:U.name)||"-")+" • "+i(R(c.purchase.updated_at)),1)])):$("",!0)]}),_:1})]),_:1})]),_:1}),e(q,{cols:"12",md:"6"},{default:a(()=>[e(z,{variant:"outlined"},{default:a(()=>[e(W,{class:"text-subtitle-1"},{default:a(()=>s[31]||(s[31]=[d("Total Summary")])),_:1,__:[31]}),e(N,null,{default:a(()=>[t("div",Bt,[s[32]||(s[32]=t("span",null,"Subtotal:",-1)),t("span",Et,i(T(c.purchase.subtotal)),1)]),c.purchase.discount_amount>0?(b(),P("div",Ot,[s[33]||(s[33]=t("span",null,"Diskon:",-1)),t("span",Mt,"-"+i(T(c.purchase.discount_amount)),1)])):$("",!0),e(fe,{class:"my-3"}),t("div",Lt,[s[34]||(s[34]=t("span",{class:"text-h6 font-weight-bold"},"Total:",-1)),t("span",Ht,i(T(c.purchase.total_amount)),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):$("",!0),e(we,{class:"pa-4"},{default:a(()=>[e(ke),e(S,{variant:"text",onClick:A},{default:a(()=>s[35]||(s[35]=[d(" Tutup ")])),_:1,__:[35]}),j.value?(b(),O(S,{key:0,color:"primary",variant:"tonal","prepend-icon":"mdi-printer",onClick:f},{default:a(()=>s[36]||(s[36]=[d(" Print ")])),_:1,__:[36]})):$("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Kt=Ce(Qt,[["__scopeId","data-v-da47fee6"]]),Gt={class:"d-flex justify-space-between align-center"},Xt={class:"d-flex justify-space-between align-center"},Jt={class:"text-h4 font-weight-bold text-white"},Wt={class:"d-flex justify-space-between align-center"},Yt={class:"text-h4 font-weight-bold text-white"},Zt={class:"d-flex justify-space-between align-center"},ea={class:"text-h4 font-weight-bold text-white"},ta={class:"d-flex justify-space-between align-center"},aa={class:"text-h4 font-weight-bold text-white"},la={class:"d-flex align-center gap-2"},sa={class:"d-flex flex-column"},na={class:"mt-1"},oa={class:"mb-0 font-weight-medium text-body-2"},ia={class:"text-caption text-medium-emphasis mb-0"},ua={class:"max-width-200"},ra={key:0,class:"d-flex flex-column ga-1"},da={class:"text-caption"},ca={key:0,class:"text-caption text-medium-emphasis"},pa={key:1,class:"text-caption text-medium-emphasis"},ma={class:"font-weight-medium"},va={class:"d-flex gap-1"},fa={class:"d-flex justify-center pt-2"},_a={key:0,class:"bg-grey-lighten-4 pa-3 rounded mt-3"},ga={class:"d-flex justify-space-between mb-2"},ya={class:"d-flex justify-space-between mb-2"},ha={class:"d-flex justify-space-between mb-2"},ba={class:"d-flex justify-space-between mb-2"},Va={class:"d-flex justify-space-between"},xa={class:"max-height-150 overflow-y-auto"},wa=Ve({__name:"purchases-management",setup(de){const le=C([]),h=C([]),L=C({}),F=C(!1),j=C(1),A=C(15),T=C(0),D=C({show:!1,message:"",color:"success"}),R=C(!1),M=C(!1),B=C(!1),f=C(!1),c=C(null),s=C(null),x=C(!1),U=C("create"),w=C({search:"",status:"",supplier_id:"",start_date:"",end_date:""}),H=[{title:"Purchase & Supplier",key:"purchase_info",sortable:!1},{title:"Items",key:"items",sortable:!1},{title:"Tanggal",key:"purchase_date",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Total",key:"total_amount",sortable:!0},{title:"Actions",key:"actions",sortable:!1,width:"150px"}],oe=[{label:"Semua Status",value:""},{label:"Pending",value:"pending"},{label:"Ordered",value:"ordered"},{label:"Received",value:"received"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}],G=async()=>{var p,l;try{F.value=!0;const o={page:j.value,per_page:A.value};Object.keys(w.value).forEach(re=>{w.value[re]&&w.value[re]!==""&&(o[re]=w.value[re])});const V=Y(),I={"Content-Type":"application/json",Accept:"application/json"};V&&(I.Authorization=`Bearer ${V}`);const X=await J.get("/api/purchases",{params:o,headers:I});le.value=X.data.data.data||[],T.value=X.data.data.total||0}catch(o){console.error("Error loading purchases:",o),D.value={show:!0,message:"Error loading purchases: "+(((l=(p=o.response)==null?void 0:p.data)==null?void 0:l.message)||o.message),color:"error"}}finally{F.value=!1}},ve=async()=>{try{const p=Y(),l={"Content-Type":"application/json",Accept:"application/json"};p&&(l.Authorization=`Bearer ${p}`);const o=await J.get("/api/suppliers?per_page=all",{headers:l});h.value=o.data.data||[]}catch(p){console.error("Error loading suppliers:",p)}},se=async()=>{try{const p=Y(),l={"Content-Type":"application/json",Accept:"application/json"};p&&(l.Authorization=`Bearer ${p}`);const o=await J.get("/api/purchases/statistics",{headers:l});L.value=o.data.data||{}}catch(p){console.error("Error loading statistics:",p)}},ce=()=>{w.value={search:"",status:"",supplier_id:"",start_date:"",end_date:""},G()},_=()=>{c.value=null,U.value="create",R.value=!0},v=p=>{c.value=p,U.value="edit",R.value=!0},m=p=>{c.value=p,M.value=!0},k=p=>{c.value=p,B.value=!0},Q=p=>{s.value=p,f.value=!0},ie=async()=>{var p,l;if(s.value){x.value=!0;try{const o=Y(),V={"Content-Type":"application/json",Accept:"application/json"};o&&(V.Authorization=`Bearer ${o}`),await J.delete(`/api/purchases/${s.value.id_purchase}`,{headers:V}),D.value={show:!0,message:`Purchase ${s.value.purchase_number} berhasil dihapus`,color:"success"},f.value=!1,s.value=null,G(),se()}catch(o){console.error("Error deleting purchase:",o),D.value={show:!0,message:"Error menghapus purchase: "+(((l=(p=o.response)==null?void 0:p.data)==null?void 0:l.message)||o.message),color:"error"}}finally{x.value=!1}}},ee=async(p,l)=>{var o,V;try{const I=Y(),X={"Content-Type":"application/json",Accept:"application/json"};I&&(X.Authorization=`Bearer ${I}`),await J.patch(`/api/purchases/${p.id_purchase}/status`,{status:l},{headers:X}),G(),se(),D.value={show:!0,message:`Purchase status berhasil diubah ke ${l}!`,color:"success"}}catch(I){console.error("Error updating purchase status:",I),D.value={show:!0,message:"Error updating status: "+(((V=(o=I.response)==null?void 0:o.data)==null?void 0:V.message)||I.message),color:"error"}}},_e=()=>{R.value=!1,G(),se(),D.value={show:!0,message:U.value==="create"?"Purchase order berhasil dibuat!":"Purchase order berhasil diperbarui!",color:"success"}},ue=p=>{const l=typeof p=="string"?parseFloat(p):p;return isNaN(l)?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)},u=p=>p?new Date(p).toLocaleDateString("id-ID"):"-",n=p=>!p.items||!Array.isArray(p.items)?0:p.items.reduce((o,V)=>{const I=parseInt(V.quantity_ordered)||0;return o+I},0),r=p=>({pending:"warning",ordered:"info",received:"primary",completed:"success",cancelled:"error"})[p]||"default",g=p=>({pending:"Pending",ordered:"Dipesan",received:"Diterima",completed:"Selesai",cancelled:"Dibatalkan"})[p]||p,y=p=>["pending","ordered","received","completed"].includes(p.status),E=p=>["pending","received","completed"].includes(p.status);return ge(w,()=>{j.value=1,G()},{deep:!0}),qe(()=>{G(),ve(),se()}),(p,l)=>(b(),O(Oe,{fluid:""},{default:a(()=>[e(te,{class:"mb-4"},{default:a(()=>[e(q,{cols:"12"},{default:a(()=>[t("div",Gt,[l[17]||(l[17]=t("div",null,[t("h1",{class:"text-h4 font-weight-bold"},"Purchase Management"),t("p",{class:"text-body-1 text-medium-emphasis"},"Kelola pembelian barang dari supplier")],-1)),e(S,{color:"primary",size:"large",onClick:_},{default:a(()=>[e(K,{start:""},{default:a(()=>l[15]||(l[15]=[d("mdi-plus")])),_:1,__:[15]}),l[16]||(l[16]=d(" Buat Purchase Order "))]),_:1,__:[16]})])]),_:1})]),_:1}),e(te,{class:"mb-6"},{default:a(()=>[e(q,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(z,{color:"primary"},{default:a(()=>[e(N,null,{default:a(()=>[t("div",Xt,[t("div",null,[l[18]||(l[18]=t("p",{class:"text-caption text-white mb-1"},"Total Purchase",-1)),t("p",Jt,i(L.value.total_purchases||0),1)]),e(K,{size:"40",class:"text-white"},{default:a(()=>l[19]||(l[19]=[d("mdi-cart")])),_:1,__:[19]})])]),_:1})]),_:1})]),_:1}),e(q,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(z,{color:"warning"},{default:a(()=>[e(N,null,{default:a(()=>[t("div",Wt,[t("div",null,[l[20]||(l[20]=t("p",{class:"text-caption text-white mb-1"},"Pending",-1)),t("p",Yt,i(L.value.pending_purchases||0),1)]),e(K,{size:"40",class:"text-white"},{default:a(()=>l[21]||(l[21]=[d("mdi-clock")])),_:1,__:[21]})])]),_:1})]),_:1})]),_:1}),e(q,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(z,{color:"success"},{default:a(()=>[e(N,null,{default:a(()=>[t("div",Zt,[t("div",null,[l[22]||(l[22]=t("p",{class:"text-caption text-white mb-1"},"Completed",-1)),t("p",ea,i(L.value.completed_purchases||0),1)]),e(K,{size:"40",class:"text-white"},{default:a(()=>l[23]||(l[23]=[d("mdi-check-circle")])),_:1,__:[23]})])]),_:1})]),_:1})]),_:1}),e(q,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(z,{color:"info"},{default:a(()=>[e(N,null,{default:a(()=>[t("div",ta,[t("div",null,[l[24]||(l[24]=t("p",{class:"text-caption text-white mb-1"},"Bulan Ini",-1)),t("p",aa,i(ue(L.value.total_amount_this_month||0)),1)]),e(K,{size:"40",class:"text-white"},{default:a(()=>l[25]||(l[25]=[d("mdi-currency-usd")])),_:1,__:[25]})])]),_:1})]),_:1})]),_:1})]),_:1}),e(z,{class:"mb-6"},{default:a(()=>[e(N,null,{default:a(()=>[e(te,null,{default:a(()=>[e(q,{cols:"12",md:"4"},{default:a(()=>[e(Z,{modelValue:w.value.search,"onUpdate:modelValue":l[0]||(l[0]=o=>w.value.search=o),label:"Cari Purchase, Supplier, atau Item",placeholder:"Masukkan nomor purchase, nama supplier, atau nama item","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"","onClick:clear":l[1]||(l[1]=o=>w.value.search="")},null,8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"2"},{default:a(()=>[e(be,{modelValue:w.value.status,"onUpdate:modelValue":l[2]||(l[2]=o=>w.value.status=o),label:"Status",items:oe,"item-title":"label","item-value":"value",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"3"},{default:a(()=>[e(be,{modelValue:w.value.supplier_id,"onUpdate:modelValue":l[3]||(l[3]=o=>w.value.supplier_id=o),label:"Supplier",items:h.value,"item-title":"name","item-value":"id_supplier",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(te,null,{default:a(()=>[e(q,{cols:"12",md:"3"},{default:a(()=>[e(Z,{modelValue:w.value.start_date,"onUpdate:modelValue":l[4]||(l[4]=o=>w.value.start_date=o),label:"Tanggal Mulai",type:"date",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"3"},{default:a(()=>[e(Z,{modelValue:w.value.end_date,"onUpdate:modelValue":l[5]||(l[5]=o=>w.value.end_date=o),label:"Tanggal Akhir",type:"date",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(q,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:a(()=>[e(S,{color:"primary",variant:"tonal","prepend-icon":"mdi-refresh",onClick:G},{default:a(()=>l[26]||(l[26]=[d(" Refresh ")])),_:1,__:[26]}),e(S,{color:"secondary",variant:"outlined","prepend-icon":"mdi-filter-off",onClick:ce},{default:a(()=>l[27]||(l[27]=[d(" Clear Filters ")])),_:1,__:[27]})]),_:1})]),_:1})]),_:1})]),_:1}),e($e,{type:"info",variant:"tonal",class:"mb-4",density:"compact"},{text:a(()=>[t("div",la,[e(K,{icon:"mdi-information",size:"16"}),l[28]||(l[28]=t("span",{class:"text-caption"},[t("strong",null,"Tips:"),d(" Gunakan kotak pencarian untuk mencari purchase berdasarkan nomor purchase, nama supplier, atau nama item yang dibeli. ")],-1))])]),_:1}),e(z,null,{default:a(()=>[e(Me,{"items-per-page":A.value,"onUpdate:itemsPerPage":l[7]||(l[7]=o=>A.value=o),page:j.value,"onUpdate:page":l[8]||(l[8]=o=>j.value=o),headers:H,items:le.value,"items-length":T.value,loading:F.value,"item-value":"id_purchase","onUpdate:options":G},{"item.purchase_info":a(({item:o})=>{var V,I;return[t("div",sa,[e(S,{variant:"text",color:"primary",size:"small",class:"justify-start pa-0",onClick:X=>m(o)},{default:a(()=>[d(i(o.purchase_number),1)]),_:2},1032,["onClick"]),t("div",na,[t("p",oa,i(((V=o.supplier)==null?void 0:V.name)||"-"),1),t("p",ia,i(((I=o.supplier)==null?void 0:I.phone)||"-"),1)])])]}),"item.items":a(({item:o})=>[t("div",ua,[o.items&&o.items.length>0?(b(),P("div",ra,[(b(!0),P(he,null,ye(o.items.slice(0,2),(V,I)=>(b(),P("div",{key:I,class:"d-flex align-center ga-1"},[e(ae,{size:"x-small",color:"primary",variant:"tonal"},{default:a(()=>{var X;return[d(i(((X=V.item)==null?void 0:X.name)||"Unknown Item"),1)]}),_:2},1024),t("span",da,"x"+i(V.quantity_ordered),1)]))),128)),o.items.length>2?(b(),P("div",ca," +"+i(o.items.length-2)+" item lainnya ",1)):$("",!0)])):(b(),P("span",pa,"Tidak ada item"))])]),"item.purchase_date":a(({item:o})=>[d(i(u(o.purchase_date)),1)]),"item.status":a(({item:o})=>[e(ae,{color:r(o.status),size:"small",variant:"elevated"},{default:a(()=>[d(i(g(o.status)),1)]),_:2},1032,["color"])]),"item.total_amount":a(({item:o})=>[t("span",ma,i(ue(o.total_amount)),1)]),"item.actions":a(({item:o})=>[t("div",va,[e(S,{icon:"mdi-eye",size:"small",variant:"text",color:"info",onClick:V=>m(o)},null,8,["onClick"]),y(o)?(b(),O(S,{key:0,icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:V=>v(o)},null,8,["onClick"])):$("",!0),["ordered","received","completed"].includes(o.status)?(b(),O(S,{key:1,icon:"mdi-truck-delivery",size:"small",variant:"text",color:"success",onClick:V=>k(o)},null,8,["onClick"])):$("",!0),E(o)?(b(),O(S,{key:2,icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:V=>Q(o)},null,8,["onClick"])):$("",!0),e(Le,null,{activator:a(({props:V})=>[e(S,Pe({icon:"mdi-dots-vertical",size:"small",variant:"text"},V),null,16)]),default:a(()=>[e(Ne,null,{default:a(()=>[o.status==="pending"?(b(),O(pe,{key:0,onClick:V=>ee(o,"ordered")},{default:a(()=>[e(me,null,{default:a(()=>l[29]||(l[29]=[d("Mark as Ordered")])),_:1,__:[29]})]),_:2},1032,["onClick"])):$("",!0),o.status==="ordered"?(b(),O(pe,{key:1,onClick:V=>ee(o,"received")},{default:a(()=>[e(me,null,{default:a(()=>l[30]||(l[30]=[d("Mark as Received")])),_:1,__:[30]})]),_:2},1032,["onClick"])):$("",!0),o.status==="received"?(b(),O(pe,{key:2,onClick:V=>ee(o,"completed")},{default:a(()=>[e(me,null,{default:a(()=>l[31]||(l[31]=[d("Mark as Completed")])),_:1,__:[31]})]),_:2},1032,["onClick"])):$("",!0),["pending","ordered"].includes(o.status)?(b(),O(pe,{key:3,onClick:V=>ee(o,"cancelled")},{default:a(()=>[e(me,{class:"text-error"},{default:a(()=>l[32]||(l[32]=[d("Cancel Purchase")])),_:1,__:[32]})]),_:2},1032,["onClick"])):$("",!0)]),_:2},1024)]),_:2},1024)])]),bottom:a(()=>[t("div",fa,[e(Ee,{modelValue:j.value,"onUpdate:modelValue":l[6]||(l[6]=o=>j.value=o),length:Math.ceil(T.value/A.value),"total-visible":5},null,8,["modelValue","length"])])]),_:1},8,["items-per-page","page","items","items-length","loading"])]),_:1}),e(ut,{modelValue:R.value,"onUpdate:modelValue":l[9]||(l[9]=o=>R.value=o),purchase:c.value,mode:U.value,onSaved:_e},null,8,["modelValue","purchase","mode"]),e(Kt,{modelValue:M.value,"onUpdate:modelValue":l[10]||(l[10]=o=>M.value=o),purchase:c.value},null,8,["modelValue","purchase"]),e(yt,{modelValue:B.value,"onUpdate:modelValue":l[11]||(l[11]=o=>B.value=o),purchase:c.value,onSuccess:p.onReceiveSuccess},null,8,["modelValue","purchase","onSuccess"]),e(xe,{modelValue:f.value,"onUpdate:modelValue":l[13]||(l[13]=o=>f.value=o),"max-width":"500"},{default:a(()=>[e(z,null,{default:a(()=>[e(W,{class:"text-h5 d-flex align-center"},{default:a(()=>[e(K,{color:"error",class:"me-2"},{default:a(()=>l[33]||(l[33]=[d("mdi-delete-alert")])),_:1,__:[33]}),l[34]||(l[34]=d(" Konfirmasi Hapus Purchase "))]),_:1,__:[34]}),e(N,null,{default:a(()=>{var o;return[e($e,{type:"warning",variant:"tonal",class:"mb-4"},{default:a(()=>[e(je,null,{default:a(()=>l[35]||(l[35]=[d("Peringatan!")])),_:1,__:[35]}),l[36]||(l[36]=d(" Tindakan ini tidak dapat dibatalkan. Purchase yang sudah dihapus tidak dapat dikembalikan. "))]),_:1,__:[36]}),l[43]||(l[43]=t("p",{class:"text-body-1"}," Apakah Anda yakin ingin menghapus purchase berikut? ",-1)),s.value?(b(),P("div",_a,[t("div",ga,[l[37]||(l[37]=t("span",{class:"font-weight-medium"},"Purchase Number:",-1)),t("span",null,i(s.value.purchase_number),1)]),t("div",ya,[l[38]||(l[38]=t("span",{class:"font-weight-medium"},"Supplier:",-1)),t("span",null,i((o=s.value.supplier)==null?void 0:o.name),1)]),t("div",ha,[l[39]||(l[39]=t("span",{class:"font-weight-medium"},"Total Item:",-1)),t("span",null,i(n(s.value))+" item",1)]),t("div",ba,[l[40]||(l[40]=t("span",{class:"font-weight-medium"},"Total Harga:",-1)),t("span",null,i(ue(s.value.total_amount)),1)]),t("div",Va,[l[41]||(l[41]=t("span",{class:"font-weight-medium"},"Status:",-1)),e(ae,{color:r(s.value.status),size:"small"},{default:a(()=>[d(i(g(s.value.status)),1)]),_:1},8,["color"])]),e(fe,{class:"my-3"}),l[42]||(l[42]=t("div",{class:"text-caption text-medium-emphasis mb-2"},"Detail Items:",-1)),t("div",xa,[(b(!0),P(he,null,ye(s.value.items,V=>{var I;return b(),P("div",{key:V.id_purchase_item,class:"d-flex justify-space-between text-caption mb-1"},[t("span",null,i(((I=V.item)==null?void 0:I.name)||"Unknown Item"),1),t("span",null,i(V.quantity_ordered)+" x "+i(ue(V.unit_cost)),1)])}),128))])])):$("",!0)]}),_:1,__:[43]}),e(we,null,{default:a(()=>[e(ke),e(S,{color:"grey",variant:"text",onClick:l[12]||(l[12]=o=>f.value=!1)},{default:a(()=>l[44]||(l[44]=[d(" Batal ")])),_:1,__:[44]}),e(S,{color:"error",variant:"flat",loading:x.value,onClick:ie},{default:a(()=>[e(K,{start:""},{default:a(()=>l[45]||(l[45]=[d("mdi-delete")])),_:1,__:[45]}),l[46]||(l[46]=d(" Hapus Purchase "))]),_:1,__:[46]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(He,{modelValue:D.value.show,"onUpdate:modelValue":l[14]||(l[14]=o=>D.value.show=o),color:D.value.color,timeout:4e3,location:"top right"},{default:a(()=>[d(i(D.value.message),1)]),_:1},8,["modelValue","color"])]),_:1}))}}),Ya=Ce(wa,[["__scopeId","data-v-22fac603"]]);export{Ya as default};
