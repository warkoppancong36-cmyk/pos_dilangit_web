import{d as Te,ax as Ee,r as S,V as O,w as re,g as V,f as s,o as g,b as o,e as l,X as f,l as z,aw as De,t as r,s as b,c as L,F as de,i as ue,$ as Re,ap as ce,aq as me,a0 as M,v as _e,ay as T,a3 as $e}from"./main-BeYChyqE.js";import{g as ze}from"./auth-a9M5ekjn.js";import{V as Le}from"./VDialog-DB-_06qg.js";import{V as P,b as X,c as Be}from"./VCard-BE4J-KWK.js";import{V as q}from"./VCardText-CiCmkOkk.js";import{V as Ue}from"./VOverlay-BeIaK0FG.js";import{V as Y}from"./VAvatar-CNQQSkfG.js";import{V as pe}from"./VImg-Byrj7t-L.js";import{V as ge}from"./VChip-Q4c6Slz2.js";import{V as W,a as x}from"./VRow-BIUD78Be.js";import{V as Z}from"./VDivider-C4pCokCc.js";import{V as fe}from"./VAlert-BeNH_8Ij.js";import{V as Oe}from"./VForm-B2b_Armc.js";import{V as ve}from"./VAutocomplete-eTggAw5l.js";import{a as be,b as ye,d as he}from"./VList-C_4ZD0s3.js";import{V as xe}from"./VTextField-DjRwf3lZ.js";import{V as Me}from"./VSwitch-CJ-V1z1p.js";import{V as ke}from"./VTooltip-lP6wu5sI.js";import{V as je}from"./VSpacer-DgnnU6eh.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./forwardRefs-B931MWyl.js";/* empty css              */import"./VSelect-CxNmxtHk.js";import"./VMenu-CMH2fMN5.js";import"./VCheckboxBtn-CXIxfrKE.js";import"./filter-DBt9VDVE.js";const Ke={class:"d-flex align-center gap-4"},Ge={class:"flex-grow-1"},He={class:"text-h6 font-weight-bold mb-1"},Je={class:"text-body-2 text-medium-emphasis mb-1"},Qe={class:"text-body-2 text-medium-emphasis mb-2"},Xe={class:"text-body-2 font-weight-bold"},Ye={class:"text-body-1 font-weight-bold"},We={class:"text-body-1 font-weight-bold"},Ze={class:"text-body-1 font-weight-bold"},et={class:"text-subtitle-1 font-weight-bold"},tt={class:"text-h6 font-weight-bold text-primary"},it={class:"d-flex align-center gap-2"},at={key:0,class:"text-center pa-8"},ot={key:1,class:"pa-4"},st={class:"d-flex align-center gap-3 flex-grow-1"},nt={class:"flex-grow-1"},lt={class:"font-weight-medium text-body-2 mb-1"},rt={class:"text-caption text-medium-emphasis",style:{"font-size":"0.75rem"}},dt={class:"d-flex align-center gap-2"},ut=Te({__name:"BaseProductCompositionModal",props:{show:{type:Boolean},composition:{},baseProducts:{},baseProductsLoading:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1}},emits:["close","save","notification"],setup(Ie,{emit:we}){const G=Ie,E=we,a=Ee({base_product_id:0,ingredient_base_product_id:0,ingredient_item_id:0,quantity:0,notes:"",is_active:!0,is_critical:!1}),k=S(!1),v=S({}),_=S(null),p=S(null),c=S([]),y=S([]),D=S(!1),A=S(!1),Ve=O(()=>y.value||[]),H=O(()=>a.base_product_id&&(a.ingredient_item_id||a.ingredient_base_product_id)&&a.quantity>0&&!j.value),ee=O(()=>{if(!p.value||!a.quantity)return 0;try{const t=p.value.cost_per_unit||0,e=Number(a.quantity)||0;return t*e}catch(t){return console.error("Error calculating cost:",t),0}}),te=O(()=>{if(!p.value||!a.quantity)return 0;try{const t=Number(p.value.current_stock)||0,e=Number(a.quantity)||0;return e>0?Math.floor(t/e):0}catch(t){return console.error("Error calculating max quantity:",t),0}}),j=O(()=>{if(!a.ingredient_item_id&&!a.ingredient_base_product_id)return!1;const t=c.value.some(e=>a.ingredient_item_id&&e.ingredient_item_id===a.ingredient_item_id?(console.log("Duplicate found - ingredient_item_id:",a.ingredient_item_id,"in composition:",e),!0):a.ingredient_base_product_id&&e.ingredient_base_product_id===a.ingredient_base_product_id?(console.log("Duplicate found - ingredient_base_product_id:",a.ingredient_base_product_id,"in composition:",e),!0):!1);return console.log("Duplicate check:",{ingredient_item_id:a.ingredient_item_id,ingredient_base_product_id:a.ingredient_base_product_id,existingCompositions:c.value.length,isDuplicate:t}),t}),F=t=>{if(t==null)return"0";const e=typeof t=="string"?parseFloat(t):Number(t);return isNaN(e)?"0":e.toLocaleString("id-ID")},R=t=>{if(t==null)return"Rp 0";const e=typeof t=="string"?parseFloat(t):Number(t);return isNaN(e)?"Rp 0":`Rp ${e.toLocaleString("id-ID")}`},K=t=>{var e,i;try{return(e=t.ingredient_item)!=null&&e.name?t.ingredient_item.name:(i=t.ingredient_base_product)!=null&&i.name?t.ingredient_base_product.name:"Unknown Item"}catch{return"Unknown Item"}},Ce=t=>{var e,i;try{return((e=t.ingredient_item)==null?void 0:e.current_stock)!==void 0?t.ingredient_item.current_stock:((i=t.ingredient_base_product)==null?void 0:i.current_stock)!==void 0?t.ingredient_base_product.current_stock:0}catch{return 0}},J=t=>{var e,i;try{return(e=t.ingredient_item)!=null&&e.unit?t.ingredient_item.unit:(i=t.ingredient_base_product)!=null&&i.unit?t.ingredient_base_product.unit:"pcs"}catch{return"pcs"}},Pe=()=>{if(!_.value)return 0;const t=_.value.selling_price||0,e=_.value.cost_per_unit||0;return t-e},Ne=()=>{Object.keys(a).forEach(t=>{t==="is_active"?a[t]=!0:t==="is_critical"?a[t]=!1:t==="quantity"||t==="base_product_id"||t==="ingredient_item_id"||t==="ingredient_base_product_id"?a[t]=0:a[t]=""}),p.value=null,v.value={}},ie=async()=>{const t=Number(a.base_product_id);t?(_.value=G.baseProducts.find(e=>e.id_base_product===t)||null,console.log("Loading compositions for base product:",t),await Q(),console.log("Compositions loading completed")):(_.value=null,c.value=[])},ae=()=>{const t=Number(a.ingredient_item_id);t?p.value=y.value.find(e=>e.id_item===t)||null:p.value=null},oe=async()=>{console.log("ensureItemsLoaded called, itemsCached:",A.value,"items length:",y.value.length),A.value?console.log("Items already cached, skipping load"):(console.log("Items not cached, loading..."),await se())},se=async()=>{if(A.value&&y.value.length>0){console.log("Using cached items:",y.value.length);return}try{D.value=!0,console.log("Loading items from API...");const t=await T.get("/api/items?per_page=all&active=true");if(console.log("Items API response:",t.data),t.data.success&&t.data.data){let e=[];Array.isArray(t.data.data.data)?e=t.data.data.data:Array.isArray(t.data.data)&&(e=t.data.data),y.value=e,A.value=!0,console.log("Items loaded and cached:",e.length),e.length>0&&console.log("Sample item structure:",e[0])}else console.error("API response not successful:",t),y.value=[]}catch(t){console.error("Error loading items with $api:",t);try{console.log("Trying fallback for items...");const i=await(await fetch("/api/items?per_page=all&active=true",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${$e("accessToken").value}`}})).json();if(console.log("Items fallback response:",i),i.success&&i.data){let n=[];Array.isArray(i.data.data)?n=i.data.data:Array.isArray(i.data)&&(n=i.data),y.value=n,A.value=!0,console.log("Items loaded via fallback:",n.length)}}catch(e){console.error("Items fallback also failed:",e),y.value=[]}y.value=[]}finally{D.value=!1}},Q=async()=>{if(a.base_product_id)try{console.log("Loading existing compositions for base_product_id:",a.base_product_id);const t=await T.get(`/api/base-product-compositions/base-product/${a.base_product_id}`);if(console.log("Full API response:",t.data),t.data.success){const e=t.data.data||[];e.forEach(i=>{if(i.is_temporary=!1,i.ingredient_item_id&&!i.ingredient_item){const n=y.value.find(h=>h.id_item===i.ingredient_item_id);n&&(i.ingredient_item=n)}}),c.value=e,console.log("Loaded existing compositions:",e.length),e.length>0&&console.log("Sample composition:",e[0])}else console.error("API response not successful:",t.data),c.value=[]}catch(t){console.error("Error loading compositions:",t),t.response&&console.error("Error response:",t.response.data),c.value=[]}};re(()=>G.show,async t=>{t&&(console.log("Modal opened"),console.log("Current auth headers:",T.defaults.headers.common),console.log("Items cached:",A.value,"Items count:",y.value.length),A.value?console.log("Items already cached, not loading again"):(console.log("Loading items on modal open..."),await se()),a.base_product_id&&Q())},{immediate:!0}),re(()=>G.composition,t=>{t?(Object.keys(a).forEach(e=>{const i=t[e];e==="is_active"?a[e]=i!==void 0?i:!0:e==="is_critical"?a[e]=i!==void 0?i:!1:e==="quantity"||e==="base_product_id"||e==="ingredient_item_id"?a[e]=i!==void 0?Number(i):0:a[e]=i||""}),ie(),ae()):Ne(),v.value={}},{immediate:!0});const Se=()=>{},ne=async()=>{var e,i,n,h,N,C;if(console.log("=== HANDLE SUBMIT START ==="),console.log("Form state:",{base_product_id:a.base_product_id,ingredient_item_id:a.ingredient_item_id,ingredient_base_product_id:a.ingredient_base_product_id,quantity:a.quantity}),console.log("Existing compositions count:",c.value.length),console.log("Can submit:",H.value),console.log("Is duplicate:",j.value),!H.value){console.log("Cannot submit - validation failed");return}if(c.value.some(u=>a.ingredient_item_id&&u.ingredient_item_id===a.ingredient_item_id?(console.log("DUPLICATE FOUND - ingredient_item_id match:",a.ingredient_item_id),!0):a.ingredient_base_product_id&&u.ingredient_base_product_id===a.ingredient_base_product_id?(console.log("DUPLICATE FOUND - ingredient_base_product_id match:",a.ingredient_base_product_id),!0):!1)){console.log("Duplicate detected, showing error");const u=a.ingredient_item_id?(e=p.value)==null?void 0:e.name:(i=p.value)==null?void 0:i.name;v.value={general:`Item "${u||"yang dipilih"}" sudah ada dalam daftar komposisi. Silakan pilih item yang berbeda.`};return}k.value=!0,v.value={};try{const u={id:Date.now(),base_product_id:Number(a.base_product_id),ingredient_base_product_id:a.ingredient_base_product_id>0?Number(a.ingredient_base_product_id):null,ingredient_item_id:a.ingredient_item_id>0?Number(a.ingredient_item_id):null,quantity:Number(a.quantity),notes:a.notes||null,is_active:a.is_active,is_critical:a.is_critical,ingredient_item:a.ingredient_item_id>0?p.value:null,ingredient_base_product:a.ingredient_base_product_id>0?p.value:null,total_cost:ee.value,is_temporary:!0};console.log("Adding composition to list:",u),c.value.push(u),console.log("Total compositions:",c.value.length),a.ingredient_base_product_id=0,a.ingredient_item_id=0,a.quantity=0,a.notes="",a.is_critical=!1,p.value=null}catch(u){console.error("Error adding composition:",u),(h=(n=u.response)==null?void 0:n.data)!=null&&h.errors?v.value=u.response.data.errors:v.value={general:((C=(N=u.response)==null?void 0:N.data)==null?void 0:C.message)||"Failed to add composition"}}finally{k.value=!1}},qe=async t=>{a.base_product_id=t.base_product_id,a.quantity=t.quantity,a.notes=t.notes||"",a.is_active=t.is_active,a.is_critical=t.is_critical||!1,t.ingredient_item_id?(a.ingredient_item_id=t.ingredient_item_id,a.ingredient_base_product_id=0,p.value=t.ingredient_item):t.ingredient_base_product_id&&(a.ingredient_base_product_id=t.ingredient_base_product_id,a.ingredient_item_id=0,p.value=t.ingredient_base_product),await le(t),v.value={},setTimeout(()=>{const e=document.querySelector(".composition-modal .v-card-text");e&&e.scrollTo({top:0,behavior:"smooth"})},100)},le=async t=>{var e,i;k.value=!0;try{console.log("Remove composition called:",t),console.log("is_temporary:",t.is_temporary),console.log("id:",t.id),console.log("id_base_product_composition:",t.id_base_product_composition);const n=t.id_base_product_composition||t.id,h=t.is_temporary===!0;if(console.log("compositionId:",n),console.log("isTemporary:",h),console.log("!isTemporary:",!h),console.log("Should call API:",n&&!h),n&&!h){console.log("✅ Calling DELETE API for composition ID:",n);const C=ze(),u={"Content-Type":"application/json",Accept:"application/json"};C&&(u.Authorization=`Bearer ${C}`),console.log("Request headers:",u);const I=await T.delete(`/api/base-product-compositions/${n}`,{headers:u});console.log("DELETE API response:",I.data),I.data.success?E("notification","Item komposisi berhasil dihapus dari database","success"):E("notification","Gagal menghapus item komposisi","error")}else console.log("❌ Skipping API call"),console.log("Reason - compositionId:",n,", isTemporary:",h),E("notification","Item komposisi berhasil dihapus","success");const N=c.value.findIndex(C=>C.id===t.id);N>-1&&(c.value.splice(N,1),console.log("Item removed from composition list at index:",N))}catch(n){console.error("Error deleting composition:",n),E("notification",((i=(e=n.response)==null?void 0:e.data)==null?void 0:i.message)||"Gagal menghapus item komposisi","error")}finally{k.value=!1}},Ae=async()=>{var i,n,h,N,C;if(c.value.length===0)return;k.value=!0,v.value={};let t=0,e=[];try{const u=c.value.filter(I=>I.is_temporary&&I.base_product_id&&I.quantity>0);if(console.log("Compositions to save:",u.length),console.log("All existing compositions:",c.value.length),u.length===0){console.log("No compositions to save");return}for(let I=u.length-1;I>=0;I--){const m=u[I];if(console.log(`
=== PROCESSING COMPOSITION ${I+1}/${u.length} ===`),console.log("Current composition raw data:",m),!m.base_product_id||m.quantity<=0){console.error("Invalid composition data:",m),e.push(`Invalid composition data for ${K(m)}`);continue}try{const d={};if(d.base_product_id=Number(m.base_product_id),d.quantity=Number(m.quantity),d.is_active=!!m.is_active,d.is_critical=!!m.is_critical,d.notes=m.notes||null,m.ingredient_item_id&&Number(m.ingredient_item_id)>0&&(d.ingredient_item_id=Number(m.ingredient_item_id)),m.ingredient_base_product_id&&Number(m.ingredient_base_product_id)>0&&(d.ingredient_base_product_id=Number(m.ingredient_base_product_id)),!d.ingredient_item_id&&!d.ingredient_base_product_id){console.error("No ingredient provided for composition:",m),e.push(`${K(m)}: No ingredient selected`);continue}console.log("Final savePayload constructed:",d),console.log("savePayload type checks:"),console.log("- base_product_id:",typeof d.base_product_id,d.base_product_id),console.log("- quantity:",typeof d.quantity,d.quantity),console.log("- ingredient_item_id:",typeof d.ingredient_item_id,d.ingredient_item_id),console.log("- ingredient_base_product_id:",typeof d.ingredient_base_product_id,d.ingredient_base_product_id),console.log("=== ABOUT TO SEND PAYLOAD ==="),console.log("savePayload stringified:",JSON.stringify(d)),console.log("savePayload keys:",Object.keys(d)),console.log("savePayload values:",Object.values(d));const B=T.interceptors.request.use(w=>(console.log("=== AXIOS REQUEST INTERCEPTOR ==="),console.log("Request URL:",w.url),console.log("Request method:",w.method),console.log("Request data type:",typeof w.data),console.log("Request data:",w.data),console.log("Request data stringified:",JSON.stringify(w.data)),console.log("Request headers:",w.headers),w)),$=await T.post("/api/base-product-compositions",d,{headers:{"Content-Type":"application/json",Accept:"application/json"}});T.interceptors.request.eject(B),console.log("=== POST RESPONSE ==="),console.log("Response status:",$.status),console.log("Response data:",$.data),t++;const U=c.value.findIndex(w=>w.id===m.id);U>-1&&c.value.splice(U,1)}catch(d){console.error("Error saving individual composition:",d);const B=K(m);if(((i=d.response)==null?void 0:i.status)===422){const $=((h=(n=d.response)==null?void 0:n.data)==null?void 0:h.message)||"";if($.includes("already exists")||$.includes("Composition already exists")){e.push(`${B}: Item sudah ada dalam komposisi database`);const U=c.value.findIndex(w=>w.id===m.id);U>-1&&c.value.splice(U,1)}else e.push(`${B}: ${$}`)}else e.push(`${B}: ${((C=(N=d.response)==null?void 0:N.data)==null?void 0:C.message)||"Gagal menyimpan"}`)}}t>0&&e.length===0?(E("save",{success:!0}),E("close")):t>0&&e.length>0?(v.value={general:`${t} item berhasil disimpan. Errors: ${e.join(", ")}`},await Q()):v.value={general:`Gagal menyimpan komposisi: ${e.join(", ")}`}}catch(u){console.error("Error saving compositions:",u),v.value={general:"Failed to save compositions: "+(u.message||"Unknown error")}}finally{k.value=!1}};return window.console=console,(t,e)=>(g(),V(Le,{"model-value":t.show,"max-width":"1000px",persistent:"",scrollable:"","onUpdate:modelValue":e[6]||(e[6]=i=>!i&&t.$emit("close"))},{default:s(()=>[o(P,{class:"composition-modal"},{default:s(()=>[o(X,{class:"composition-header"},{default:s(()=>[o(f,{icon:"mdi-chef-hat",class:"me-2"}),e[7]||(e[7]=l("span",null,"Kelola Komposisi Base Product",-1))]),_:1,__:[7]}),o(q,{class:"pa-6"},{default:s(()=>[o(Ue,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=i=>D.value=i),contained:"",persistent:"",class:"d-flex align-center justify-center"},{default:s(()=>[o(P,{class:"pa-6 text-center","min-width":"250"},{default:s(()=>[o(De,{indeterminate:"",color:"primary",size:"50",class:"mb-4"}),e[8]||(e[8]=l("div",{class:"text-h6 mb-2"},"Memuat Data...",-1)),e[9]||(e[9]=l("div",{class:"text-body-2 text-medium-emphasis"},"Mohon tunggu sebentar",-1))]),_:1,__:[8,9]})]),_:1},8,["modelValue"]),_.value?(g(),V(P,{key:0,variant:"tonal",color:"primary",class:"mb-6"},{default:s(()=>[o(q,{class:"pa-4"},{default:s(()=>{var i;return[l("div",Ke,[o(Y,{size:"60",rounded:""},{default:s(()=>[_.value.image_url?(g(),V(pe,{key:0,src:_.value.image_url,alt:_.value.name},null,8,["src","alt"])):(g(),V(f,{key:1,icon:"tabler-package",size:"30"}))]),_:1}),l("div",Ge,[l("h3",He,r(_.value.name),1),l("div",Je," SKU: "+r(_.value.sku||"No SKU"),1),l("div",Qe," Kategori: "+r(((i=_.value.category)==null?void 0:i.name)||"Tidak ada kategori"),1),o(ge,{color:_.value.current_stock>_.value.min_stock?"success":"warning",size:"small",variant:"flat",class:"mt-1"},{default:s(()=>[b(r(_.value.current_stock>_.value.min_stock?"Stok Aman":"Stok Menipis"),1)]),_:1},8,["color"])])])]}),_:1})]),_:1})):z("",!0),_.value?(g(),V(W,{key:1,class:"mb-6"},{default:s(()=>[o(x,{cols:"6",md:"3"},{default:s(()=>[o(P,{variant:"outlined",class:"stats-card"},{default:s(()=>[o(q,{class:"text-center pa-3"},{default:s(()=>{var i;return[o(f,{icon:"mdi-tag",color:"info",class:"mb-1",size:"20"}),l("div",Xe,r(((i=_.value.category)==null?void 0:i.name)||"No Category"),1),e[10]||(e[10]=l("div",{class:"text-caption text-medium-emphasis"},"Kategori",-1))]}),_:1,__:[10]})]),_:1})]),_:1}),o(x,{cols:"6",md:"3"},{default:s(()=>[o(P,{variant:"outlined",class:"stats-card"},{default:s(()=>[o(q,{class:"text-center pa-3"},{default:s(()=>[o(f,{icon:"mdi-package-variant",color:"primary",class:"mb-1",size:"20"}),l("div",Ye,r(R(_.value.cost_per_unit||0)),1),e[11]||(e[11]=l("div",{class:"text-caption text-medium-emphasis"},"HPP",-1))]),_:1,__:[11]})]),_:1})]),_:1}),o(x,{cols:"6",md:"3"},{default:s(()=>[o(P,{variant:"outlined",class:"stats-card"},{default:s(()=>[o(q,{class:"text-center pa-3"},{default:s(()=>[o(f,{icon:"mdi-currency-usd",color:"success",class:"mb-1",size:"20"}),l("div",We,r(R(_.value.selling_price||0)),1),e[12]||(e[12]=l("div",{class:"text-caption text-medium-emphasis"},"Harga Jual",-1))]),_:1,__:[12]})]),_:1})]),_:1}),o(x,{cols:"6",md:"3"},{default:s(()=>[o(P,{variant:"outlined",class:"stats-card"},{default:s(()=>[o(q,{class:"text-center pa-3"},{default:s(()=>[o(f,{icon:"mdi-trending-up",color:"warning",class:"mb-1",size:"20"}),l("div",Ze,r(R(Pe())),1),e[13]||(e[13]=l("div",{class:"text-caption text-medium-emphasis"},"Margin",-1))]),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):z("",!0),o(P,{class:"mb-6"},{default:s(()=>[o(X,{class:"d-flex align-center gap-2 pa-4"},{default:s(()=>[o(f,{icon:"mdi-plus-circle",color:"primary"}),e[14]||(e[14]=l("span",null,"Tambah Item Komposisi",-1))]),_:1,__:[14]}),o(Z),o(q,{class:"pa-4"},{default:s(()=>[Object.keys(v.value).length>0?(g(),V(fe,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:s(()=>[(g(!0),L(de,null,ue(v.value,(i,n)=>(g(),L("div",{key:n},[l("strong",null,r(n)+":",1),b(" "+r(Array.isArray(i)?i[0]:i),1)]))),128))]),_:1})):z("",!0),o(Oe,{onSubmit:Re(ne,["prevent"])},{default:s(()=>[o(W,null,{default:s(()=>[!t.editMode&&!a.base_product_id?(g(),V(x,{key:0,cols:"12",md:"6"},{default:s(()=>[o(ve,{modelValue:a.base_product_id,"onUpdate:modelValue":[e[1]||(e[1]=i=>a.base_product_id=i),ie],items:t.baseProducts,loading:t.baseProductsLoading,"item-title":"name","item-value":"id_base_product",label:"Pilih Base Product",placeholder:"Pilih base product","prepend-inner-icon":"tabler-package",clearable:"","error-messages":v.value.base_product_id},{item:s(({props:i,item:n})=>[o(be,ce(me(i)),{prepend:s(()=>[o(Y,{size:"30"},{default:s(()=>[n.raw.image_url?(g(),V(pe,{key:0,src:n.raw.image_url,alt:n.raw.name},null,8,["src","alt"])):(g(),V(f,{key:1,icon:"tabler-package",size:"16"}))]),_:2},1024)]),default:s(()=>[o(ye,null,{default:s(()=>[b(r(n.raw.name),1)]),_:2},1024),o(he,null,{default:s(()=>[b(" Stock: "+r(F(n.raw.current_stock))+" "+r(n.raw.unit)+" | "+r(n.raw.formatted_cost),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","error-messages"])]),_:1})):z("",!0),o(x,{cols:"12",md:!t.editMode&&!a.base_product_id?6:4},{default:s(()=>[o(ve,{modelValue:a.ingredient_item_id,"onUpdate:modelValue":[e[2]||(e[2]=i=>a.ingredient_item_id=i),ae],items:Ve.value,loading:D.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",placeholder:"Pilih item komposisi","prepend-inner-icon":"tabler-package",clearable:"","error-messages":v.value.ingredient_item_id,color:j.value?"warning":"primary","onClick:prependInner":oe,onFocus:oe,"no-data-text":D.value?"Memuat item...":y.value.length===0?"Tidak ada item tersedia":"Ketik untuk mencari..."},{item:s(({props:i,item:n})=>[o(be,ce(me(i)),{prepend:s(()=>[o(Y,{size:"30"},{default:s(()=>[o(f,{icon:"tabler-package",size:"16"})]),_:1})]),default:s(()=>[o(ye,null,{default:s(()=>[b(r(n.raw.name),1)]),_:2},1024),o(he,null,{default:s(()=>[b(" Stok: "+r(F(n.raw.current_stock||0))+" "+r(n.raw.unit||"pcs")+" | Rp "+r(R(n.raw.cost_per_unit||0)),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","error-messages","color","no-data-text"]),j.value?(g(),V(fe,{key:0,type:"warning",variant:"tonal",density:"compact",class:"mt-2"},{default:s(()=>[o(f,{icon:"mdi-alert",class:"me-2"}),e[15]||(e[15]=b(" Item ini sudah ada dalam daftar komposisi "))]),_:1,__:[15]})):z("",!0)]),_:1},8,["md"]),o(x,{cols:"6",md:!t.editMode&&!a.base_product_id?6:4},{default:s(()=>{var i;return[o(xe,{modelValue:a.quantity,"onUpdate:modelValue":e[3]||(e[3]=n=>a.quantity=n),type:"number",step:"0.01",min:"0",label:"Jumlah",placeholder:"1",suffix:((i=p.value)==null?void 0:i.unit)||"pcs","prepend-inner-icon":"mdi-numeric","error-messages":v.value.quantity,onInput:Se},null,8,["modelValue","suffix","error-messages"])]}),_:1},8,["md"]),o(x,{cols:"6",md:!t.editMode&&!a.base_product_id?6:2},{default:s(()=>{var i;return[o(xe,{"model-value":((i=p.value)==null?void 0:i.unit)||"pcs",label:"Satuan",readonly:"","prepend-inner-icon":"mdi-scale-balance"},null,8,["model-value"])]}),_:1},8,["md"]),o(x,{cols:"6",md:"2"},{default:s(()=>[o(Me,{modelValue:a.is_critical,"onUpdate:modelValue":e[4]||(e[4]=i=>a.is_critical=i),label:"Item Kritis",color:"warning","hide-details":""},null,8,["modelValue"])]),_:1}),o(x,{cols:"6",md:"2",class:"d-flex align-center"},{default:s(()=>[o(M,{color:"primary",loading:k.value,disabled:!H.value,onClick:ne,block:""},{default:s(()=>[o(f,{icon:"mdi-plus",class:"me-1"}),e[16]||(e[16]=b(" Tambah ke List "))]),_:1,__:[16]},8,["loading","disabled"])]),_:1})]),_:1}),p.value&&a.quantity?(g(),V(P,{key:0,variant:"tonal",color:"success",class:"mt-4"},{default:s(()=>[o(q,{class:"pa-3"},{default:s(()=>[o(W,null,{default:s(()=>[o(x,{cols:"12",md:"4"},{default:s(()=>{var i;return[e[17]||(e[17]=l("div",{class:"text-caption text-medium-emphasis"},"Cost per Unit:",-1)),l("div",et,r(R(((i=p.value)==null?void 0:i.cost_per_unit)||0)),1)]}),_:1,__:[17]}),o(x,{cols:"12",md:"4"},{default:s(()=>[e[18]||(e[18]=l("div",{class:"text-caption text-medium-emphasis"},"Total Cost:",-1)),l("div",tt,r(R(ee.value)),1)]),_:1,__:[18]}),o(x,{cols:"12",md:"4"},{default:s(()=>[e[19]||(e[19]=l("div",{class:"text-caption text-medium-emphasis"},"Available Stock:",-1)),l("div",{class:_e(["text-h6 font-weight-bold",te.value>0?"text-success":"text-error"])},r(te.value)+" portions ",3)]),_:1,__:[19]})]),_:1})]),_:1})]),_:1})):z("",!0)]),_:1})]),_:1})]),_:1}),o(P,null,{default:s(()=>[o(X,{class:"d-flex align-center justify-space-between pa-4"},{default:s(()=>[l("div",it,[o(f,{icon:"mdi-format-list-bulleted",color:"primary"}),l("span",null,"Daftar Item Komposisi ("+r(c.value.length)+")",1)])]),_:1}),o(Z),c.value.length===0?(g(),L("div",at,[o(f,{icon:"mdi-package-variant-closed",size:"64",color:"grey-lighten-2",class:"mb-4"}),e[20]||(e[20]=l("h3",{class:"text-h6 text-medium-emphasis mb-2"},"Belum ada item komposisi",-1)),e[21]||(e[21]=l("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Tambahkan item yang dibutuhkan untuk membuat base product ini ",-1))])):(g(),L("div",ot,[(g(!0),L(de,null,ue(c.value,i=>(g(),L("div",{key:i.id||i.base_product_id,class:_e(["composition-item d-flex align-center justify-space-between pa-3 mb-3 rounded-lg border",{"bg-green-lighten-5 border-success":i.is_temporary}])},[l("div",st,[o(f,{icon:"mdi-check-circle",color:"success",size:"18"}),l("div",nt,[l("div",lt,r(K(i)),1),l("div",rt,[b(" Dibutuhkan: "+r(F(i.quantity||0))+" "+r(J(i))+" ",1),e[22]||(e[22]=l("span",{class:"mx-2"},"•",-1)),b(" Stok: "+r(F(Ce(i)))+" "+r(J(i)),1)])])]),l("div",dt,[o(ge,{size:"x-small",variant:"outlined",color:"primary"},{default:s(()=>[b(r(J(i)),1)]),_:2},1024),o(M,{icon:"",size:"x-small",variant:"text",color:"primary",onClick:n=>qe(i),disabled:i.is_temporary||k.value},{default:s(()=>[o(f,{icon:"mdi-pencil",size:"16"}),o(ke,{activator:"parent",location:"top"},{default:s(()=>e[23]||(e[23]=[b(" Edit Komposisi ")])),_:1,__:[23]})]),_:2},1032,["onClick","disabled"]),o(M,{icon:"",size:"x-small",variant:"text",color:"error",disabled:k.value,onClick:n=>le(i)},{default:s(()=>[o(f,{icon:"mdi-delete",size:"16"}),o(ke,{activator:"parent",location:"top"},{default:s(()=>e[24]||(e[24]=[b(" Hapus Komposisi ")])),_:1,__:[24]})]),_:2},1032,["disabled","onClick"])])],2))),128))]))]),_:1})]),_:1}),o(Z),o(Be,{class:"pa-4"},{default:s(()=>[o(je),o(M,{variant:"outlined",onClick:e[5]||(e[5]=i=>t.$emit("close")),disabled:k.value},{default:s(()=>e[25]||(e[25]=[b(" Batal ")])),_:1,__:[25]},8,["disabled"]),o(M,{color:"primary",onClick:Ae,loading:k.value,disabled:c.value.length===0},{default:s(()=>[o(f,{icon:"mdi-content-save",class:"me-1"}),b(" Simpan Komposisi ("+r(c.value.filter(i=>i.is_temporary).length)+") ",1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),zt=Fe(ut,[["__scopeId","data-v-83ba6a21"]]);export{zt as default};
