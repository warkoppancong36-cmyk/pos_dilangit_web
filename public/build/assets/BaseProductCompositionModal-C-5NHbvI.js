import{d as Be,au as Ee,r as $,V as K,w as le,g as k,f as r,o as v,b as s,e as o,X as b,l as D,at as De,t as u,s as y,c as M,F as ue,i as ce,$ as Me,am as _e,an as me,a0 as L,v as pe,av as F,aw as Ue}from"./main-C0MrzgDC.js";import{g as je}from"./auth-CuuXRWj5.js";import{V as Ke}from"./VDialog-D_xtC1kn.js";import{V as C,b as W,c as Le}from"./VCard-CVYpAEPX.js";import{V as A}from"./VCardText-Bh-EEvZY.js";import{V as Fe}from"./VOverlay-BV4tSfAi.js";import{V as Y}from"./VAvatar-Dx4YCgPn.js";import{V as ge}from"./VImg-Bu_lligl.js";import{V as fe}from"./VChip-BDw9wNdp.js";import{V as Z,a as h}from"./VRow-COctEW4P.js";import{V as ee}from"./VDivider-CWh5UJOg.js";import{V as ve}from"./VAlert-DUbUrbU6.js";import{V as Re}from"./VForm-DZzqbT1h.js";import{V as be}from"./VAutocomplete-w4aoNVO9.js";import{a as ye,b as he,d as xe}from"./VList-DvFL3q_P.js";import{V as ke}from"./VTextField-W--0PDtM.js";import{V as Ge}from"./VSwitch-CzB3UoAF.js";import{V as we}from"./VTooltip-D3sMIj8b.js";import{V as Oe}from"./VSpacer-CYn6GMsj.js";import{_ as He}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./forwardRefs-B931MWyl.js";/* empty css              */import"./VSelect-D_dU7gBz.js";import"./VMenu-mv_ZKK7q.js";import"./VCheckboxBtn-C-51HGUU.js";import"./filter-CADweaZ8.js";const Je={class:"d-flex align-center gap-4"},Qe={class:"flex-grow-1"},Xe={class:"text-h6 font-weight-bold mb-1"},We={class:"text-body-2 text-medium-emphasis mb-1"},Ye={class:"text-body-2 text-medium-emphasis mb-2"},Ze={class:"text-body-2 font-weight-bold"},et={class:"text-body-1 font-weight-bold"},tt={class:"text-body-1 font-weight-bold"},it={class:"text-body-1 font-weight-bold"},at={class:"text-subtitle-1 font-weight-bold"},st={class:"text-h6 font-weight-bold text-primary"},rt={class:"d-flex align-center gap-2"},nt={key:0,class:"text-center pa-8"},ot={key:1,class:"pa-4"},dt={class:"d-flex align-center gap-3 flex-grow-1"},lt={class:"flex-grow-1"},ut={class:"font-weight-medium text-body-2 mb-1"},ct={class:"text-caption text-medium-emphasis",style:{"font-size":"0.75rem"}},_t={class:"d-flex align-center gap-2"},mt=Be({__name:"BaseProductCompositionModal",props:{show:{type:Boolean},composition:{},baseProducts:{},baseProductsLoading:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1}},emits:["close","save","notification"],setup(Ve,{emit:Ie}){const H=Ve,q=Ie,a=Ee({base_product_id:0,ingredient_base_product_id:0,ingredient_item_id:0,quantity:0,notes:"",is_active:!0,is_critical:!1}),x=$(!1),f=$({}),p=$(null),m=$(null),_=$([]),w=$([]),z=$(!1),U=$(!1),Ce=K(()=>w.value||[]),te=K(()=>a.base_product_id&&(a.ingredient_item_id||a.ingredient_base_product_id)&&a.quantity>0&&!J.value),ie=K(()=>{if(!m.value||!a.quantity)return 0;try{const t=m.value.cost_per_unit||0,e=Number(a.quantity)||0;return t*e}catch(t){return console.error("Error calculating cost:",t),0}}),ae=K(()=>{if(!m.value||!a.quantity)return 0;try{const t=Number(m.value.current_stock)||0,e=Number(a.quantity)||0;return e>0?Math.floor(t/e):0}catch(t){return console.error("Error calculating max quantity:",t),0}}),J=K(()=>!a.ingredient_item_id&&!a.ingredient_base_product_id?!1:_.value.some(e=>!!(a.ingredient_item_id&&e.ingredient_item_id===a.ingredient_item_id||a.ingredient_base_product_id&&e.ingredient_base_product_id===a.ingredient_base_product_id))),R=t=>{if(t==null)return"0";const e=typeof t=="string"?parseFloat(t):Number(t);return isNaN(e)?"0":e.toLocaleString("id-ID")},T=t=>{if(t==null)return"Rp 0";const e=typeof t=="string"?parseFloat(t):Number(t);return isNaN(e)?"Rp 0":`Rp ${e.toLocaleString("id-ID")}`},j=t=>{var e,i;try{return(e=t.ingredient_item)!=null&&e.name?t.ingredient_item.name:(i=t.ingredient_base_product)!=null&&i.name?t.ingredient_base_product.name:"Unknown Item"}catch{return"Unknown Item"}},Ne=t=>{var e,i;try{return((e=t.ingredient_item)==null?void 0:e.current_stock)!==void 0?t.ingredient_item.current_stock:((i=t.ingredient_base_product)==null?void 0:i.current_stock)!==void 0?t.ingredient_base_product.current_stock:0}catch{return 0}},Q=t=>{var e,i;try{return(e=t.ingredient_item)!=null&&e.unit?t.ingredient_item.unit:(i=t.ingredient_base_product)!=null&&i.unit?t.ingredient_base_product.unit:"pcs"}catch{return"pcs"}},qe=()=>{if(!p.value)return 0;const t=p.value.selling_price||0,e=p.value.cost_per_unit||0;return t-e},Pe=()=>{Object.keys(a).forEach(t=>{t==="is_active"?a[t]=!0:t==="is_critical"?a[t]=!1:t==="quantity"||t==="base_product_id"||t==="ingredient_item_id"||t==="ingredient_base_product_id"?a[t]=0:a[t]=""}),m.value=null,f.value={}},se=async()=>{const t=Number(a.base_product_id);t?(p.value=H.baseProducts.find(e=>e.id_base_product===t)||null,await X()):(p.value=null,_.value=[])},re=()=>{const t=Number(a.ingredient_item_id);t?m.value=w.value.find(e=>e.id_item===t)||null:m.value=null},ne=async()=>{U.value||await oe()},oe=async()=>{if(!(U.value&&w.value.length>0))try{z.value=!0;const t=await F.get("/api/items?per_page=all&active=true");if(t.data.success&&t.data.data){let e=[];Array.isArray(t.data.data.data)?e=t.data.data.data:Array.isArray(t.data.data)&&(e=t.data.data),w.value=e,U.value=!0}else console.error("API response not successful:",t),w.value=[]}catch(t){console.error("Error loading items with $api:",t);try{const i=await(await fetch("/api/items?per_page=all&active=true",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${Ue("accessToken").value}`}})).json();if(i.success&&i.data){let n=[];Array.isArray(i.data.data)?n=i.data.data:Array.isArray(i.data)&&(n=i.data),w.value=n,U.value=!0}}catch(e){console.error("Items fallback also failed:",e),w.value=[]}w.value=[]}finally{z.value=!1}},X=async()=>{if(a.base_product_id)try{const t=await F.get(`/api/base-product-compositions/base-product/${a.base_product_id}`);if(t.data.success){const e=t.data.data||[];e.forEach(i=>{if(i.is_temporary=!1,i.ingredient_item_id&&!i.ingredient_item){const n=w.value.find(N=>N.id_item===i.ingredient_item_id);n&&(i.ingredient_item=n)}}),_.value=e,e.length>0}else console.error("API response not successful:",t.data),_.value=[]}catch(t){console.error("Error loading compositions:",t),t.response&&console.error("Error response:",t.response.data),_.value=[]}};le(()=>H.show,async t=>{t&&(U.value||await oe(),a.base_product_id&&X())},{immediate:!0}),le(()=>H.composition,t=>{t?(Object.keys(a).forEach(e=>{const i=t[e];e==="is_active"?a[e]=i!==void 0?i:!0:e==="is_critical"?a[e]=i!==void 0?i:!1:e==="quantity"||e==="base_product_id"||e==="ingredient_item_id"?a[e]=i!==void 0?Number(i):0:a[e]=i||""}),se(),re()):Pe(),f.value={}},{immediate:!0});const Se=()=>{},de=async()=>{var i,n,N,P,V,S,B,I;if(!te.value)return;const t=_.value.findIndex(d=>d.is_editing===!0);if(t>-1){const d=_.value[t];if(_.value.some(l=>l.is_editing===!0?!1:!!(a.ingredient_item_id&&l.ingredient_item_id===a.ingredient_item_id||a.ingredient_base_product_id&&l.ingredient_base_product_id===a.ingredient_base_product_id))){const l=a.ingredient_item_id?(i=m.value)==null?void 0:i.name:(n=m.value)==null?void 0:n.name;f.value={general:`Item "${l||"yang dipilih"}" sudah ada dalam daftar komposisi. Silakan pilih item yang berbeda.`};return}d.quantity=Number(a.quantity),d.notes=a.notes||null,d.is_active=a.is_active,d.is_critical=a.is_critical,a.ingredient_item_id>0?(d.ingredient_item_id=Number(a.ingredient_item_id),d.ingredient_base_product_id=null,d.ingredient_item=m.value,d.ingredient_base_product=null):a.ingredient_base_product_id>0&&(d.ingredient_base_product_id=Number(a.ingredient_base_product_id),d.ingredient_item_id=null,d.ingredient_base_product=m.value,d.ingredient_item=null),d.is_modified=!0,d.is_editing=!1,d.edit_mode=!1,a.ingredient_base_product_id=0,a.ingredient_item_id=0,a.quantity=0,a.notes="",a.is_critical=!1,m.value=null;return}if(_.value.some(d=>!!(a.ingredient_item_id&&d.ingredient_item_id===a.ingredient_item_id||a.ingredient_base_product_id&&d.ingredient_base_product_id===a.ingredient_base_product_id))){const d=a.ingredient_item_id?(N=m.value)==null?void 0:N.name:(P=m.value)==null?void 0:P.name;f.value={general:`Item "${d||"yang dipilih"}" sudah ada dalam daftar komposisi. Silakan pilih item yang berbeda.`};return}x.value=!0,f.value={};try{const d={id:Date.now(),base_product_id:Number(a.base_product_id),ingredient_base_product_id:a.ingredient_base_product_id>0?Number(a.ingredient_base_product_id):null,ingredient_item_id:a.ingredient_item_id>0?Number(a.ingredient_item_id):null,quantity:Number(a.quantity),notes:a.notes||null,is_active:a.is_active,is_critical:a.is_critical,ingredient_item:a.ingredient_item_id>0?m.value:null,ingredient_base_product:a.ingredient_base_product_id>0?m.value:null,total_cost:ie.value,is_temporary:!0};_.value.push(d),a.ingredient_base_product_id=0,a.ingredient_item_id=0,a.quantity=0,a.notes="",a.is_critical=!1,m.value=null}catch(d){console.error("Error adding composition:",d),(S=(V=d.response)==null?void 0:V.data)!=null&&S.errors?f.value=d.response.data.errors:f.value={general:((I=(B=d.response)==null?void 0:B.data)==null?void 0:I.message)||"Failed to add composition"}}finally{x.value=!1}},$e=async t=>{a.base_product_id=t.base_product_id,a.quantity=t.quantity,a.notes=t.notes||"",a.is_active=t.is_active,a.is_critical=t.is_critical||!1,t.ingredient_item_id?(a.ingredient_item_id=t.ingredient_item_id,a.ingredient_base_product_id=0,m.value=t.ingredient_item):t.ingredient_base_product_id&&(a.ingredient_base_product_id=t.ingredient_base_product_id,a.ingredient_item_id=0,m.value=t.ingredient_base_product);const e=_.value.findIndex(i=>(i.id_base_product_composition||i.id)===(t.id_base_product_composition||t.id));e>-1&&(_.value[e].is_editing=!0,_.value[e].edit_mode=!0),f.value={},setTimeout(()=>{const i=document.querySelector(".composition-modal .v-card-text");i&&i.scrollTo({top:0,behavior:"smooth"})},100)},Ae=async t=>{var e,i;x.value=!0;try{const n=t.id_base_product_composition||t.id,N=t.is_temporary===!0;if(n&&!N){const V=je(),S={"Content-Type":"application/json",Accept:"application/json"};V&&(S.Authorization=`Bearer ${V}`),(await F.delete(`/api/base-product-compositions/${n}`,{headers:S})).data.success?q("notification","Item komposisi berhasil dihapus dari database","success"):q("notification","Gagal menghapus item komposisi","error")}else q("notification","Item komposisi berhasil dihapus","success");const P=_.value.findIndex(V=>V.id===t.id);P>-1&&_.value.splice(P,1)}catch(n){console.error("Error deleting composition:",n),q("notification",((i=(e=n.response)==null?void 0:e.data)==null?void 0:i.message)||"Gagal menghapus item komposisi","error")}finally{x.value=!1}},ze=async()=>{var i,n,N,P,V,S,B;if(_.value.length===0)return;x.value=!0,f.value={};let t=0,e=[];try{const I=_.value.filter(c=>c.is_temporary&&c.base_product_id&&c.quantity>0),d=_.value.filter(c=>c.is_modified&&!c.is_temporary&&c.id_base_product_composition);if(console.log("Compositions to save (new):",I.length),console.log("Compositions to update:",d.length),I.length===0&&d.length===0)return;for(const c of d)try{const l={base_product_id:Number(c.base_product_id),quantity:Number(c.quantity),is_active:!!c.is_active,is_critical:!!c.is_critical,notes:c.notes||null};c.ingredient_item_id&&Number(c.ingredient_item_id)>0&&(l.ingredient_item_id=Number(c.ingredient_item_id)),c.ingredient_base_product_id&&Number(c.ingredient_base_product_id)>0&&(l.ingredient_base_product_id=Number(c.ingredient_base_product_id)),console.log("Updating composition ID:",c.id_base_product_composition);const g=await F.put(`/api/base-product-compositions/${c.id_base_product_composition}`,l,{headers:{"Content-Type":"application/json",Accept:"application/json"}});console.log("Update response:",g.data),t++,c.is_modified=!1}catch(l){console.error("Error updating composition:",l);const g=j(c);e.push(`${g}: ${((n=(i=l.response)==null?void 0:i.data)==null?void 0:n.message)||"Update failed"}`)}for(let c=I.length-1;c>=0;c--){const l=I[c];if(!l.base_product_id||l.quantity<=0){console.error("Invalid composition data:",l),e.push(`Invalid composition data for ${j(l)}`);continue}try{const g={};if(g.base_product_id=Number(l.base_product_id),g.quantity=Number(l.quantity),g.is_active=!!l.is_active,g.is_critical=!!l.is_critical,g.notes=l.notes||null,l.ingredient_item_id&&Number(l.ingredient_item_id)>0&&(g.ingredient_item_id=Number(l.ingredient_item_id)),l.ingredient_base_product_id&&Number(l.ingredient_base_product_id)>0&&(g.ingredient_base_product_id=Number(l.ingredient_base_product_id)),!g.ingredient_item_id&&!g.ingredient_base_product_id){console.error("No ingredient provided for composition:",l),e.push(`${j(l)}: No ingredient selected`);continue}const G=await F.post("/api/base-product-compositions",g,{headers:{"Content-Type":"application/json",Accept:"application/json"}});t++;const E=_.value.findIndex(O=>O.id===l.id);E>-1&&_.value.splice(E,1)}catch(g){console.error("Error saving individual composition:",g);const G=j(l);if(((N=g.response)==null?void 0:N.status)===422){const E=((V=(P=g.response)==null?void 0:P.data)==null?void 0:V.message)||"";if(E.includes("already exists")||E.includes("Composition already exists")){e.push(`${G}: Item sudah ada dalam komposisi database`);const O=_.value.findIndex(Te=>Te.id===l.id);O>-1&&_.value.splice(O,1)}else e.push(`${G}: ${E}`)}else e.push(`${G}: ${((B=(S=g.response)==null?void 0:S.data)==null?void 0:B.message)||"Gagal menyimpan"}`)}}t>0&&e.length===0?(q("save",{success:!0}),q("close")):t>0&&e.length>0?(f.value={general:`${t} item berhasil disimpan. Errors: ${e.join(", ")}`},await X()):t===0&&e.length===0?(q("save",{success:!0}),q("close")):f.value={general:`Gagal menyimpan komposisi: ${e.join(", ")}`}}catch(I){console.error("Error saving compositions:",I),f.value={general:"Failed to save compositions: "+(I.message||"Unknown error")}}finally{x.value=!1}};return window.console=console,(t,e)=>(v(),k(Ke,{"model-value":t.show,"max-width":"1000px",persistent:"",scrollable:"","onUpdate:modelValue":e[6]||(e[6]=i=>!i&&t.$emit("close"))},{default:r(()=>[s(C,{class:"composition-modal"},{default:r(()=>[s(W,{class:"composition-header"},{default:r(()=>[s(b,{icon:"mdi-chef-hat",class:"me-2"}),e[7]||(e[7]=o("span",null,"Kelola Komposisi Base Product",-1))]),_:1,__:[7]}),s(A,{class:"pa-6"},{default:r(()=>[s(Fe,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=i=>z.value=i),contained:"",persistent:"",class:"d-flex align-center justify-center"},{default:r(()=>[s(C,{class:"pa-6 text-center","min-width":"250"},{default:r(()=>[s(De,{indeterminate:"",color:"primary",size:"50",class:"mb-4"}),e[8]||(e[8]=o("div",{class:"text-h6 mb-2"},"Memuat Data...",-1)),e[9]||(e[9]=o("div",{class:"text-body-2 text-medium-emphasis"},"Mohon tunggu sebentar",-1))]),_:1,__:[8,9]})]),_:1},8,["modelValue"]),p.value?(v(),k(C,{key:0,variant:"tonal",color:"primary",class:"mb-6"},{default:r(()=>[s(A,{class:"pa-4"},{default:r(()=>{var i;return[o("div",Je,[s(Y,{size:"60",rounded:""},{default:r(()=>[p.value.image_url?(v(),k(ge,{key:0,src:p.value.image_url,alt:p.value.name},null,8,["src","alt"])):(v(),k(b,{key:1,icon:"tabler-package",size:"30"}))]),_:1}),o("div",Qe,[o("h3",Xe,u(p.value.name),1),o("div",We," SKU: "+u(p.value.sku||"No SKU"),1),o("div",Ye," Kategori: "+u(((i=p.value.category)==null?void 0:i.name)||"Tidak ada kategori"),1),s(fe,{color:p.value.current_stock>p.value.min_stock?"success":"warning",size:"small",variant:"flat",class:"mt-1"},{default:r(()=>[y(u(p.value.current_stock>p.value.min_stock?"Stok Aman":"Stok Menipis"),1)]),_:1},8,["color"])])])]}),_:1})]),_:1})):D("",!0),p.value?(v(),k(Z,{key:1,class:"mb-6"},{default:r(()=>[s(h,{cols:"6",md:"3"},{default:r(()=>[s(C,{variant:"outlined",class:"stats-card"},{default:r(()=>[s(A,{class:"text-center pa-3"},{default:r(()=>{var i;return[s(b,{icon:"mdi-tag",color:"info",class:"mb-1",size:"20"}),o("div",Ze,u(((i=p.value.category)==null?void 0:i.name)||"No Category"),1),e[10]||(e[10]=o("div",{class:"text-caption text-medium-emphasis"},"Kategori",-1))]}),_:1,__:[10]})]),_:1})]),_:1}),s(h,{cols:"6",md:"3"},{default:r(()=>[s(C,{variant:"outlined",class:"stats-card"},{default:r(()=>[s(A,{class:"text-center pa-3"},{default:r(()=>[s(b,{icon:"mdi-package-variant",color:"primary",class:"mb-1",size:"20"}),o("div",et,u(T(p.value.cost_per_unit||0)),1),e[11]||(e[11]=o("div",{class:"text-caption text-medium-emphasis"},"HPP",-1))]),_:1,__:[11]})]),_:1})]),_:1}),s(h,{cols:"6",md:"3"},{default:r(()=>[s(C,{variant:"outlined",class:"stats-card"},{default:r(()=>[s(A,{class:"text-center pa-3"},{default:r(()=>[s(b,{icon:"mdi-currency-usd",color:"success",class:"mb-1",size:"20"}),o("div",tt,u(T(p.value.selling_price||0)),1),e[12]||(e[12]=o("div",{class:"text-caption text-medium-emphasis"},"Harga Jual",-1))]),_:1,__:[12]})]),_:1})]),_:1}),s(h,{cols:"6",md:"3"},{default:r(()=>[s(C,{variant:"outlined",class:"stats-card"},{default:r(()=>[s(A,{class:"text-center pa-3"},{default:r(()=>[s(b,{icon:"mdi-trending-up",color:"warning",class:"mb-1",size:"20"}),o("div",it,u(T(qe())),1),e[13]||(e[13]=o("div",{class:"text-caption text-medium-emphasis"},"Margin",-1))]),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):D("",!0),s(C,{class:"mb-6"},{default:r(()=>[s(W,{class:"d-flex align-center gap-2 pa-4"},{default:r(()=>[s(b,{icon:"mdi-plus-circle",color:"primary"}),e[14]||(e[14]=o("span",null,"Tambah Item Komposisi",-1))]),_:1,__:[14]}),s(ee),s(A,{class:"pa-4"},{default:r(()=>[Object.keys(f.value).length>0?(v(),k(ve,{key:0,type:"error",variant:"tonal",class:"mb-4"},{default:r(()=>[(v(!0),M(ue,null,ce(f.value,(i,n)=>(v(),M("div",{key:n},[o("strong",null,u(n)+":",1),y(" "+u(Array.isArray(i)?i[0]:i),1)]))),128))]),_:1})):D("",!0),s(Re,{onSubmit:Me(de,["prevent"])},{default:r(()=>[s(Z,null,{default:r(()=>[!t.editMode&&!a.base_product_id?(v(),k(h,{key:0,cols:"12",md:"6"},{default:r(()=>[s(be,{modelValue:a.base_product_id,"onUpdate:modelValue":[e[1]||(e[1]=i=>a.base_product_id=i),se],items:t.baseProducts,loading:t.baseProductsLoading,"item-title":"name","item-value":"id_base_product",label:"Pilih Base Product",placeholder:"Pilih base product","prepend-inner-icon":"tabler-package",clearable:"","error-messages":f.value.base_product_id},{item:r(({props:i,item:n})=>[s(ye,_e(me(i)),{prepend:r(()=>[s(Y,{size:"30"},{default:r(()=>[n.raw.image_url?(v(),k(ge,{key:0,src:n.raw.image_url,alt:n.raw.name},null,8,["src","alt"])):(v(),k(b,{key:1,icon:"tabler-package",size:"16"}))]),_:2},1024)]),default:r(()=>[s(he,null,{default:r(()=>[y(u(n.raw.name),1)]),_:2},1024),s(xe,null,{default:r(()=>[y(" Stock: "+u(R(n.raw.current_stock))+" "+u(n.raw.unit)+" | "+u(n.raw.formatted_cost),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","error-messages"])]),_:1})):D("",!0),s(h,{cols:"12",md:!t.editMode&&!a.base_product_id?6:4},{default:r(()=>[s(be,{modelValue:a.ingredient_item_id,"onUpdate:modelValue":[e[2]||(e[2]=i=>a.ingredient_item_id=i),re],items:Ce.value,loading:z.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",placeholder:"Pilih item komposisi","prepend-inner-icon":"tabler-package",clearable:"","error-messages":f.value.ingredient_item_id,color:J.value?"warning":"primary","onClick:prependInner":ne,onFocus:ne,"no-data-text":z.value?"Memuat item...":w.value.length===0?"Tidak ada item tersedia":"Ketik untuk mencari..."},{item:r(({props:i,item:n})=>[s(ye,_e(me(i)),{prepend:r(()=>[s(Y,{size:"30"},{default:r(()=>[s(b,{icon:"tabler-package",size:"16"})]),_:1})]),default:r(()=>[s(he,null,{default:r(()=>[y(u(n.raw.name),1)]),_:2},1024),s(xe,null,{default:r(()=>[y(" Stok: "+u(R(n.raw.current_stock||0))+" "+u(n.raw.unit||"pcs")+" | Rp "+u(T(n.raw.cost_per_unit||0)),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","loading","error-messages","color","no-data-text"]),J.value?(v(),k(ve,{key:0,type:"warning",variant:"tonal",density:"compact",class:"mt-2"},{default:r(()=>[s(b,{icon:"mdi-alert",class:"me-2"}),e[15]||(e[15]=y(" Item ini sudah ada dalam daftar komposisi "))]),_:1,__:[15]})):D("",!0)]),_:1},8,["md"]),s(h,{cols:"6",md:!t.editMode&&!a.base_product_id?6:4},{default:r(()=>{var i;return[s(ke,{modelValue:a.quantity,"onUpdate:modelValue":e[3]||(e[3]=n=>a.quantity=n),type:"number",step:"0.01",min:"0",label:"Jumlah",placeholder:"1",suffix:((i=m.value)==null?void 0:i.unit)||"pcs","prepend-inner-icon":"mdi-numeric","error-messages":f.value.quantity,onInput:Se},null,8,["modelValue","suffix","error-messages"])]}),_:1},8,["md"]),s(h,{cols:"6",md:!t.editMode&&!a.base_product_id?6:2},{default:r(()=>{var i;return[s(ke,{"model-value":((i=m.value)==null?void 0:i.unit)||"pcs",label:"Satuan",readonly:"","prepend-inner-icon":"mdi-scale-balance"},null,8,["model-value"])]}),_:1},8,["md"]),s(h,{cols:"6",md:"2"},{default:r(()=>[s(Ge,{modelValue:a.is_critical,"onUpdate:modelValue":e[4]||(e[4]=i=>a.is_critical=i),label:"Item Kritis",color:"warning","hide-details":""},null,8,["modelValue"])]),_:1}),s(h,{cols:"6",md:"2",class:"d-flex align-center"},{default:r(()=>[s(L,{color:"primary",loading:x.value,disabled:!te.value,onClick:de,block:""},{default:r(()=>[s(b,{icon:"mdi-plus",class:"me-1"}),e[16]||(e[16]=y(" Tambah ke List "))]),_:1,__:[16]},8,["loading","disabled"])]),_:1})]),_:1}),m.value&&a.quantity?(v(),k(C,{key:0,variant:"tonal",color:"success",class:"mt-4"},{default:r(()=>[s(A,{class:"pa-3"},{default:r(()=>[s(Z,null,{default:r(()=>[s(h,{cols:"12",md:"4"},{default:r(()=>{var i;return[e[17]||(e[17]=o("div",{class:"text-caption text-medium-emphasis"},"Cost per Unit:",-1)),o("div",at,u(T(((i=m.value)==null?void 0:i.cost_per_unit)||0)),1)]}),_:1,__:[17]}),s(h,{cols:"12",md:"4"},{default:r(()=>[e[18]||(e[18]=o("div",{class:"text-caption text-medium-emphasis"},"Total Cost:",-1)),o("div",st,u(T(ie.value)),1)]),_:1,__:[18]}),s(h,{cols:"12",md:"4"},{default:r(()=>[e[19]||(e[19]=o("div",{class:"text-caption text-medium-emphasis"},"Available Stock:",-1)),o("div",{class:pe(["text-h6 font-weight-bold",ae.value>0?"text-success":"text-error"])},u(ae.value)+" portions ",3)]),_:1,__:[19]})]),_:1})]),_:1})]),_:1})):D("",!0)]),_:1})]),_:1})]),_:1}),s(C,null,{default:r(()=>[s(W,{class:"d-flex align-center justify-space-between pa-4"},{default:r(()=>[o("div",rt,[s(b,{icon:"mdi-format-list-bulleted",color:"primary"}),o("span",null,"Daftar Item Komposisi ("+u(_.value.length)+")",1)])]),_:1}),s(ee),_.value.length===0?(v(),M("div",nt,[s(b,{icon:"mdi-package-variant-closed",size:"64",color:"grey-lighten-2",class:"mb-4"}),e[20]||(e[20]=o("h3",{class:"text-h6 text-medium-emphasis mb-2"},"Belum ada item komposisi",-1)),e[21]||(e[21]=o("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Tambahkan item yang dibutuhkan untuk membuat base product ini ",-1))])):(v(),M("div",ot,[(v(!0),M(ue,null,ce(_.value,i=>(v(),M("div",{key:i.id||i.base_product_id,class:pe(["composition-item d-flex align-center justify-space-between pa-3 mb-3 rounded-lg border",{"bg-green-lighten-5 border-success":i.is_temporary}])},[o("div",dt,[s(b,{icon:"mdi-check-circle",color:"success",size:"18"}),o("div",lt,[o("div",ut,u(j(i)),1),o("div",ct,[y(" Dibutuhkan: "+u(R(i.quantity||0))+" "+u(Q(i))+" ",1),e[22]||(e[22]=o("span",{class:"mx-2"},"•",-1)),y(" Stok: "+u(R(Ne(i)))+" "+u(Q(i)),1)])])]),o("div",_t,[s(fe,{size:"x-small",variant:"outlined",color:"primary"},{default:r(()=>[y(u(Q(i)),1)]),_:2},1024),s(L,{icon:"",size:"x-small",variant:"text",color:"primary",onClick:n=>$e(i),disabled:i.is_temporary||x.value},{default:r(()=>[s(b,{icon:"mdi-pencil",size:"16"}),s(we,{activator:"parent",location:"top"},{default:r(()=>e[23]||(e[23]=[y(" Edit Komposisi ")])),_:1,__:[23]})]),_:2},1032,["onClick","disabled"]),s(L,{icon:"",size:"x-small",variant:"text",color:"error",disabled:x.value,onClick:n=>Ae(i)},{default:r(()=>[s(b,{icon:"mdi-delete",size:"16"}),s(we,{activator:"parent",location:"top"},{default:r(()=>e[24]||(e[24]=[y(" Hapus Komposisi ")])),_:1,__:[24]})]),_:2},1032,["disabled","onClick"])])],2))),128))]))]),_:1})]),_:1}),s(ee),s(Le,{class:"pa-4"},{default:r(()=>[s(Oe),s(L,{variant:"outlined",onClick:e[5]||(e[5]=i=>t.$emit("close")),disabled:x.value},{default:r(()=>e[25]||(e[25]=[y(" Batal ")])),_:1,__:[25]},8,["disabled"]),s(L,{color:"primary",onClick:ze,loading:x.value,disabled:_.value.length===0},{default:r(()=>[s(b,{icon:"mdi-content-save",class:"me-1"}),y(" Simpan Komposisi ("+u(_.value.filter(i=>i.is_temporary).length)+") ",1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),jt=He(mt,[["__scopeId","data-v-e79a0c06"]]);export{jt as default};
