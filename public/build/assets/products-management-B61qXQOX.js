import{D as St}from"./DeleteConfirmationDialog-Cszkv9Yv.js";import{f as He}from"./formatters-BD6tdLx_.js";import{P as dt,u as Bt}from"./useProductItems-Bk-C86_n.js";import{I as Ft}from"./ItemsApi-Bga4W_1J.js";import{u as _t,H as Et}from"./HPPBreakdownDialog-J6IOwcVg.js";import{V as Ee}from"./VDialog-CODkmJOV.js";import{V as ee,b as we,c as Re}from"./VCard-OtdmNL9Q.js";import{a6 as Rt,a7 as Lt,ae as qt,r as I,b0 as ot,af as Nt,b5 as wt,bf as Ot,V as me,W as jt,w as Ce,br as Pt,av as ft,a8 as Jt,b as e,p as he,ba as Wt,cx as Gt,c8 as Vt,bd as Qt,F as Te,X as k,cm as Xt,c9 as Zt,aY as Yt,s as d,d as Fe,D as et,c as X,f as t,e as o,t as r,a1 as E,g as F,l as W,m as M,ax as it,cw as ct,at as Ke,i as We,v as Ge,o as m,_ as Le,az as gt,a0 as kt,j as It,cy as ea,bp as ta,au as Ne,ao as aa,ap as la,a3 as mt}from"./main-xnptf2TS.js";import{V as ae}from"./VCardText-BPTOC4_p.js";import{V as $e}from"./VAvatar-BWKse5Ys.js";import{V as se}from"./VChip-CznLCnP6.js";import{V as Se,a as $}from"./VRow-CBzhIdKk.js";import{V as bt}from"./VAutocomplete-h5RjX_Wu.js";import{u as oa,t as st,V as nt,a as je,b as Ye,d as tt}from"./VList-CRGSE_kw.js";import{u as sa,V as xe,m as ia}from"./VTextField-D1fuUSnH.js";import{V as Ze}from"./VSwitch-oM8lyryU.js";import{V as Oe}from"./VSpacer-DtE4IAYh.js";import{V as at}from"./VSnackbar-Bmm-2sbK.js";import{P as na}from"./ProductsApi-CcIiomfN.js";import{u as ra,m as ua,a as da,V as Be}from"./VSelect-Df7PjOaS.js";import{V as ca}from"./VCheckbox-LT1AMel_.js";import{V as Ue}from"./VDivider-_7qKKIdq.js";import{a as ma,V as va}from"./VDataTable-XC7AE1m2.js";import{V as pa}from"./VContainer-lRmSfgWH.js";import{a as Dt,u as fa,P as ga}from"./useProducts-Bajv0CeH.js";import{V as yt}from"./VForm-BA_U2T8s.js";import{V as Ct}from"./VTextarea-LsTERqtx.js";import{V as Me}from"./VTooltip-D7XaPE3M.js";import{m as _a,V as ka}from"./VImg-DieUwUB1.js";import{V as ba,u as ya}from"./useCategories-Dy1yQ4An.js";import{u as ha,m as xa,h as wa}from"./filter-Hb6Yguvo.js";import{f as Pa}from"./forwardRefs-B931MWyl.js";import{V as Va}from"./VMenu-CVgzTi3w.js";import{V as Ca}from"./VCheckboxBtn-D7c9WeBv.js";import{V as $a}from"./VDataTableServer-B96ewnBU.js";import{V as Sa}from"./VSkeletonLoader-WqPewfAt.js";import{V as Ia,a as Da,b as vt,c as pt}from"./VTabs-BILExzhy.js";import"./api-CulZ9SvH.js";import"./index-D-EbNoF1.js";import"./VOverlay-VQpNIzTh.js";/* empty css              */import"./VTable-OXifF_nr.js";import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-BH_98CVt.js";const za=Lt({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...xa({filterKeys:["title"]}),...ua({hideNoData:!0,returnObject:!0}),...Wt(ia({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),..._a({transition:!1})},"VCombobox"),Ta=Rt()({name:"VCombobox",props:za(),emits:{"update:focused":S=>!0,"update:modelValue":S=>!0,"update:search":S=>!0,"update:menu":S=>!0},setup(S,ye){var n;let{emit:q,slots:z}=ye;const{t:J}=qt(),g=I(),G=ot(!1),U=ot(!0),y=ot(!1),v=I(),j=I(),p=ot(-1);let A=!1;const{items:de,transformIn:ke,transformOut:C}=oa(S),{textColorClasses:ie,textColorStyles:ne}=Nt(()=>{var s;return(s=g.value)==null?void 0:s.color}),Q=wt(S,"modelValue",[],s=>ke(Ot(s)),s=>{const w=C(s);return S.multiple?w:w[0]??null}),ve=sa(S),T=me(()=>!!(S.chips||z.chip)),_=me(()=>T.value||!!z.selection),f=ot(!S.multiple&&!_.value?((n=Q.value[0])==null?void 0:n.title)??"":""),x=me({get:()=>f.value,set:s=>{var w;if(f.value=s??"",!S.multiple&&!_.value&&(Q.value=[st(S,s)]),s&&S.multiple&&((w=S.delimiters)!=null&&w.length)){const B=s.split(new RegExp(`(?:${S.delimiters.join("|")})+`));B.length>1&&(B.forEach(R=>{R=R.trim(),R&&Ae(st(S,R))}),f.value="")}s||(p.value=-1),U.value=!s}}),_e=me(()=>typeof S.counterValue=="function"?S.counterValue(Q.value):typeof S.counterValue=="number"?S.counterValue:S.multiple?Q.value.length:x.value.length),{filteredItems:pe,getMatches:fe}=ha(S,de,()=>U.value?"":x.value),P=me(()=>S.hideSelected?pe.value.filter(s=>!Q.value.some(w=>w.value===s.value)):pe.value),N=me(()=>S.hideNoData&&!P.value.length||ve.isReadonly.value||ve.isDisabled.value),h=wt(S,"menu"),O=me({get:()=>h.value,set:s=>{var w;h.value&&!s&&((w=v.value)!=null&&w.ΨopenChildren.size)||s&&N.value||(h.value=s)}}),K=jt(()=>O.value?S.closeText:S.openText);Ce(f,s=>{A?ft(()=>A=!1):G.value&&!O.value&&(O.value=!0),q("update:search",s)}),Ce(Q,s=>{var w;!S.multiple&&!_.value&&(f.value=((w=s[0])==null?void 0:w.title)??"")});const b=me(()=>Q.value.map(s=>s.value)),i=me(()=>{var w;return(S.autoSelectFirst===!0||S.autoSelectFirst==="exact"&&x.value===((w=P.value[0])==null?void 0:w.title))&&P.value.length>0&&!U.value&&!y.value}),a=I(),l=ra(a,g);function u(s){A=!0,S.openOnClear&&(O.value=!0)}function te(){N.value||(O.value=!0)}function L(s){N.value||(G.value&&(s.preventDefault(),s.stopPropagation()),O.value=!O.value)}function ce(s){var w;s.key!==" "&&Vt(s)&&((w=g.value)==null||w.focus())}function ze(s){var R,c,H,Y;if(Gt(s)||ve.isReadonly.value)return;const w=(R=g.value)==null?void 0:R.selectionStart,B=Q.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(s.key)&&s.preventDefault(),["Enter","ArrowDown"].includes(s.key)&&(O.value=!0),["Escape"].includes(s.key)&&(O.value=!1),["Enter","Escape","Tab"].includes(s.key)&&(i.value&&["Enter","Tab"].includes(s.key)&&!Q.value.some(V=>{let{value:re}=V;return re===P.value[0].value})&&Ae(pe.value[0]),U.value=!0),s.key==="ArrowDown"&&i.value&&((c=a.value)==null||c.focus("next")),s.key==="Enter"&&x.value&&(Ae(st(S,x.value)),_.value&&(f.value="")),["Backspace","Delete"].includes(s.key)){if(!S.multiple&&_.value&&Q.value.length>0&&!x.value)return Ae(Q.value[0],!1);if(~p.value){s.preventDefault();const V=p.value;Ae(Q.value[p.value],!1),p.value=V>=B-1?B-2:V}else s.key==="Backspace"&&!x.value&&(p.value=B-1);return}if(S.multiple)if(s.key==="ArrowLeft"){if(p.value<0&&w&&w>0)return;const V=p.value>-1?p.value-1:B-1;Q.value[V]?p.value=V:(p.value=-1,(H=g.value)==null||H.setSelectionRange(x.value.length,x.value.length))}else if(s.key==="ArrowRight"){if(p.value<0)return;const V=p.value+1;Q.value[V]?p.value=V:(p.value=-1,(Y=g.value)==null||Y.setSelectionRange(0,0))}else~p.value&&Vt(s)&&(p.value=-1)}function le(){var s;S.eager&&((s=j.value)==null||s.calculateVisibleItems())}function De(){var s;G.value&&(U.value=!0,(s=g.value)==null||s.focus())}function Ae(s){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!s||s.props.disabled))if(S.multiple){const B=Q.value.findIndex(c=>(S.valueComparator||Pt)(c.value,s.value)),R=w??!~B;if(~B){const c=R?[...Q.value,s]:[...Q.value];c.splice(B,1),Q.value=c}else R&&(Q.value=[...Q.value,s]);S.clearOnSelect&&(x.value="")}else{const B=w!==!1;Q.value=B?[s]:[],f.value=B&&!_.value?s.title:"",ft(()=>{O.value=!1,U.value=!0})}}function Qe(s){G.value=!0,setTimeout(()=>{y.value=!0})}function Je(s){y.value=!1}function D(s){(s==null||s===""&&!S.multiple&&!_.value)&&(Q.value=[])}return Ce(G,(s,w)=>{if(!(s||s===w)&&(p.value=-1,O.value=!1,x.value)){if(S.multiple){Ae(st(S,x.value));return}if(!_.value)return;Q.value.some(B=>{let{title:R}=B;return R===x.value})?f.value="":Ae(st(S,x.value))}}),Ce(O,()=>{if(!S.hideSelected&&O.value&&Q.value.length){const s=P.value.findIndex(w=>Q.value.some(B=>(S.valueComparator||Pt)(B.value,w.value)));Qt&&window.requestAnimationFrame(()=>{var w;s>=0&&((w=j.value)==null||w.scrollToIndex(s))})}}),Ce(()=>S.items,(s,w)=>{O.value||G.value&&!w.length&&s.length&&(O.value=!0)}),Jt(()=>{const s=!!(!S.hideNoData||P.value.length||z["prepend-item"]||z["append-item"]||z["no-data"]),w=Q.value.length>0,B=xe.filterProps(S);return e(xe,he({ref:g},B,{modelValue:x.value,"onUpdate:modelValue":[R=>x.value=R,D],focused:G.value,"onUpdate:focused":R=>G.value=R,validationValue:Q.externalValue,counterValue:_e.value,dirty:w,class:["v-combobox",{"v-combobox--active-menu":O.value,"v-combobox--chips":!!S.chips,"v-combobox--selection-slot":!!_.value,"v-combobox--selecting-index":p.value>-1,[`v-combobox--${S.multiple?"multiple":"single"}`]:!0},S.class],style:S.style,readonly:ve.isReadonly.value,placeholder:w?void 0:S.placeholder,"onClick:clear":u,"onMousedown:control":te,onKeydown:ze}),{...z,default:()=>e(Te,null,[e(Va,he({ref:v,modelValue:O.value,"onUpdate:modelValue":R=>O.value=R,activator:"parent",contentClass:"v-combobox__content",disabled:N.value,eager:S.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:S.transition,onAfterEnter:le,onAfterLeave:De},S.menuProps),{default:()=>[s&&e(nt,he({ref:a,selected:b.value,selectStrategy:S.multiple?"independent":"single-independent",onMousedown:R=>R.preventDefault(),onKeydown:ce,onFocusin:Qe,onFocusout:Je,tabindex:"-1","aria-live":"polite",color:S.itemColor??S.color},l,S.listProps),{default:()=>{var R,c,H;return[(R=z["prepend-item"])==null?void 0:R.call(z),!P.value.length&&!S.hideNoData&&(((c=z["no-data"])==null?void 0:c.call(z))??e(je,{key:"no-data",title:J(S.noDataText)},null)),e(da,{ref:j,renderless:!0,items:P.value,itemKey:"value"},{default:Y=>{var Pe;let{item:V,index:re,itemRef:ue}=Y;const oe=he(V.props,{ref:ue,key:V.value,active:i.value&&re===0?!0:void 0,onClick:()=>Ae(V,null)});return((Pe=z.item)==null?void 0:Pe.call(z,{item:V,index:re,props:oe}))??e(je,he(oe,{role:"option"}),{prepend:be=>{let{isSelected:Ve}=be;return e(Te,null,[S.multiple&&!S.hideSelected?e(Ca,{key:V.value,modelValue:Ve,ripple:!1,tabindex:"-1"},null):void 0,V.props.prependAvatar&&e($e,{image:V.props.prependAvatar},null),V.props.prependIcon&&e(k,{icon:V.props.prependIcon},null)])},title:()=>{var be;return U.value?V.title:wa("v-combobox",V.title,(be=fe(V))==null?void 0:be.title)}})}}),(H=z["append-item"])==null?void 0:H.call(z)]}})]}),Q.value.map((R,c)=>{function H(ue){ue.stopPropagation(),ue.preventDefault(),Ae(R,!1)}const Y={"onClick:close":H,onKeydown(ue){ue.key!=="Enter"&&ue.key!==" "||(ue.preventDefault(),ue.stopPropagation(),H(ue))},onMousedown(ue){ue.preventDefault(),ue.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},V=T.value?!!z.chip:!!z.selection,re=V?Zt(T.value?z.chip({item:R,index:c,props:Y}):z.selection({item:R,index:c})):void 0;if(!(V&&!re))return e("div",{key:R.value,class:["v-combobox__selection",c===p.value&&["v-combobox__selection--selected",ie.value]],style:c===p.value?ne.value:{}},[T.value?z.chip?e(Yt,{key:"chip-defaults",defaults:{VChip:{closable:S.closableChips,size:"small",text:R.title}}},{default:()=>[re]}):e(se,he({key:"chip",closable:S.closableChips,size:"small",text:R.title,disabled:R.props.disabled},Y),null):re??e("span",{class:"v-combobox__selection-text"},[R.title,S.multiple&&c<Q.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[d(",")])])])})]),"append-inner":function(){var Y,V;for(var R=arguments.length,c=new Array(R),H=0;H<R;H++)c[H]=arguments[H];return e(Te,null,[(Y=z["append-inner"])==null?void 0:Y.call(z,...c),(!S.hideNoData||S.items.length)&&S.menuIcon?e(k,{class:"v-combobox__menu-icon",color:(V=g.value)==null?void 0:V.fieldIconColor,icon:S.menuIcon,onMousedown:L,onClick:Xt,"aria-label":J(K.value),title:J(K.value),tabindex:"-1"},null):void 0])}})}),Pa({isFocused:G,isPristine:U,menu:O,search:x,selectionIndex:p,filteredItems:pe,select:Ae},g)}}),Ua={class:"d-flex align-center gap-3"},Aa={class:"text-body-2 ma-0 opacity-90"},Ha={class:"d-flex align-center gap-4"},Ma={class:"flex-grow-1"},Ka={class:"text-h6 font-weight-bold mb-1"},Ba={class:"text-body-2 text-medium-emphasis mb-1"},Fa={class:"d-flex align-center gap-4 mb-0"},Ea={class:"text-body-2 text-medium-emphasis mb-0"},Ra={class:"text-body-2 text-info mb-0 font-weight-medium"},La={key:0,class:"text-body-2 text-success mb-0 font-weight-medium"},qa={class:"text-body-1 font-weight-bold"},Na={class:"text-body-1 font-weight-bold"},Oa={class:"text-body-1 font-weight-bold"},ja={class:"text-body-1 font-weight-bold"},Ja={class:"d-flex align-center justify-space-between w-100"},Wa={class:"d-flex align-center"},Ga={key:0,class:"text-warning"},Qa={key:1},Xa={key:0,class:"text-center pa-8"},Za={class:"d-flex align-center gap-4 mt-1"},Ya={key:1,class:"text-primary"},el={class:"d-flex gap-2"},tl=Fe({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup(S,{emit:ye}){const q=S,z=ye,J=me({get:()=>q.modelValue,set:D=>z("update:modelValue",D)}),g=I(!1),G=I([]),U=I(!1),y=I(!1),v=I(""),j=I(""),p=I(!1),A=I(-1),de=I(!1),{loading:ke,currentHPPBreakdown:C,getProductHPPBreakdown:ie}=_t(),ne=me(()=>{var D,n,s;return((D=C.value)==null?void 0:D.total_hpp)||((n=q.product)==null?void 0:n.hpp)||((s=q.product)==null?void 0:s.cost)||0}),Q=me(()=>{var s;const D=((s=q.product)==null?void 0:s.price)||0,n=ne.value;return D-n}),ve=me(()=>{var s;const D=((s=q.product)==null?void 0:s.price)||0,n=ne.value;return D<=0?0:Math.round((D-n)/D*100)}),T=I({itemId:null,quantity:1,unit:"pcs",isCritical:!1}),_=I([]),f=I(!1),x=I([]),_e=async()=>{var D;if(q.product)try{const n=q.product.id_product||q.product.id,s=await dt.getAll({product_id:n,page:1,per_page:1e5});s.success&&((D=s.data)!=null&&D.data)&&(G.value=s.data.data,x.value=JSON.parse(JSON.stringify(s.data.data)))}catch(n){console.error("Error fetching product composition:",n)}},pe=async()=>{var D;f.value=!0;try{const n=await Ft.getAll({page:1,per_page:1e5,active:!0});n.success&&((D=n.data)!=null&&D.data)&&(_.value=n.data.data.map(s=>{var w,B,R;return{id:((w=s.id_item)==null?void 0:w.toString())||((B=s.id)==null?void 0:B.toString()),name:s.name,current_stock:((R=s.inventory)==null?void 0:R.current_stock)||0,unit:s.unit||"pcs"}}))}catch(n){console.error("Error fetching available items:",n),_.value=[]}finally{f.value=!1}},fe=me(()=>T.value.itemId&&T.value.quantity>0);me(()=>{if(!T.value.itemId)return null;const D=_.value.find(n=>n.id===T.value.itemId);return(D==null?void 0:D.unit)||null});const P=me(()=>{if(!T.value.itemId)return null;const D=_.value.find(n=>n.id===T.value.itemId);return D?O(D):null}),N=me(()=>P.value!==null&&P.value<=0),h=me(()=>Array.isArray(_.value)?_.value:[]),O=D=>D.current_stock||D.stock||0,K=()=>f.value?"Memuat items...":!_.value||_.value.length===0?"Tidak ada item tersedia":"Tidak ada item yang ditemukan",b=D=>{const n=O(D);return n>50?"success":n>20?"warning":n>0?"error":"grey"},i=D=>{const n=O(D);return n>50?"Aman":n>20?"Rendah":n>0?"Kritis":"Habis"};Ce(()=>q.items,D=>{D&&D.length>0,G.value=[...D]},{immediate:!0}),Ce(()=>q.modelValue,async D=>{D&&q.product&&(_e(),await a())});const a=async()=>{if(q.product&&(q.product.id_product||q.product.id))try{const D=parseInt(String(q.product.id_product||q.product.id));await ie(D,"latest")}catch(D){console.warn("Could not load HPP data:",D)}};et(()=>{pe()});const l=()=>{de.value=!0},u=async()=>{await a(),z("refresh")},te=()=>G.value.some(n=>{var s;return((s=n.item)==null?void 0:s.inventory)&&n.item.inventory.current_stock<n.quantity_needed})?"error":"success",L=()=>G.value.some(n=>{var s;return((s=n.item)==null?void 0:s.inventory)&&n.item.inventory.current_stock<n.quantity_needed})?"Stok Kritis":"Stok Aman",ce=()=>{if(!fe.value)return;const D=_.value.find(w=>w.id===T.value.itemId);if(!D)return;if(G.value.find(w=>{var B;return((B=w.item)==null?void 0:B.id)===D.id})){v.value=`Item "${D.name}" sudah ada dalam komposisi produk ini`,U.value=!0;return}const s={id_product_item:`temp_${Date.now()}`,item:{id:String(D.id),name:D.name,inventory:{current_stock:D.current_stock||0}},quantity_needed:T.value.quantity,unit:T.value.unit,is_critical:T.value.isCritical};G.value.push(s),De()},ze=(D,n)=>{var B;if(_.value.length===0){console.warn("⚠️ Available items not loaded yet, fetching..."),pe().then(()=>{ze(D,n)});return}p.value=!0,A.value=n;let s=((B=D.item)==null?void 0:B.id)||null;if(s!==null&&(s=s.toString()),T.value={itemId:s,quantity:parseFloat(D.quantity_needed.toString())||0,unit:D.unit,isCritical:D.is_critical},!_.value.find(R=>R.id===s)){console.warn("⚠️ Item ID not found in available items, trying alternative matching...");const R=_.value.find(c=>{var H;return c.name===((H=D.item)==null?void 0:H.name)});R?T.value.itemId=R.id:console.error("❌ Could not find item in available items by ID or name")}},le=()=>{var w;if(!fe.value||A.value===-1)return;const D=_.value.find(B=>B.id===T.value.itemId);if(!D)return;const n=G.value[A.value],s=((w=n.item)==null?void 0:w.id)!==D.id;G.value[A.value]={...G.value[A.value],id_product_item:s?`temp_${Date.now()}`:n.id_product_item,item:{id:String(D.id),name:D.name,inventory:{current_stock:D.current_stock||0}},quantity_needed:T.value.quantity,unit:T.value.unit,is_critical:T.value.isCritical},De()},De=()=>{p.value=!1,A.value=-1,T.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},Ae=D=>{G.value.splice(D,1)},Qe=async()=>{var D,n,s,w,B,R,c,H,Y;if(q.product){g.value=!0;try{const V=parseInt(String(((D=q.product)==null?void 0:D.id_product)||((n=q.product)==null?void 0:n.id)||"0")),re=x.value||[],ue=G.value;for(const oe of ue){const Pe=re.find(Ve=>{var qe,Xe;return!!(Ve.id_product_item===oe.id_product_item||oe.id_product_item&&!oe.id_product_item.toString().startsWith("temp_")&&((qe=Ve.item)==null?void 0:qe.id)===((Xe=oe.item)==null?void 0:Xe.id))});if(!((s=oe.item)!=null&&s.id)||parseInt(oe.item.id)===0){console.warn("⚠️ Skipping item with invalid item_id:",{item_name:(w=oe.item)==null?void 0:w.name,item_id:(B=oe.item)==null?void 0:B.id,full_item:oe});continue}const be={product_id:V,item_id:parseInt(((R=oe.item)==null?void 0:R.id)||"0"),quantity_needed:parseFloat(oe.quantity_needed.toString()),unit:oe.unit||"",is_critical:oe.is_critical,notes:oe.notes||""};try{Pe&&!((c=oe.id_product_item)!=null&&c.toString().startsWith("temp_"))?await dt.update(parseInt(Pe.id_product_item||"0"),be):await dt.create(be)}catch(Ve){throw console.error("❌ Error processing item:",Ve),(H=Ve.message)!=null&&H.includes("already assigned")?v.value=`Item "${(Y=oe.item)==null?void 0:Y.name}" sudah ditambahkan ke produk ini`:v.value=Ve.message||"Terjadi kesalahan saat menyimpan item",U.value=!0,Ve}}for(const oe of re)if(!ue.find(be=>be.id_product_item===oe.id_product_item)&&oe.id_product_item)try{await dt.delete(parseInt(oe.id_product_item))}catch(be){console.error("❌ Error deleting item:",be),v.value=`Gagal menghapus item: ${be.message}`,U.value=!0}j.value="Komposisi produk berhasil disimpan!",y.value=!0,z("save",{product:q.product,items:G.value}),z("refresh"),Je()}catch(V){console.error("❌ Error saving composition:",V),U.value||(v.value=V.message||"Terjadi kesalahan saat menyimpan komposisi",U.value=!0)}finally{g.value=!1}}},Je=()=>{J.value=!1,setTimeout(()=>{G.value=[...q.items],De()},300)};return(D,n)=>{var s,w,B,R;return m(),X(Te,null,[e(Ee,{modelValue:J.value,"onUpdate:modelValue":n[8]||(n[8]=c=>J.value=c),"max-width":"900",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var c;return[o("div",Ua,[e(k,{icon:"mdi-chef-hat",size:"24"}),o("div",null,[n[11]||(n[11]=o("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),o("p",Aa,r(((c=D.product)==null?void 0:c.name)||"Produk"),1)])]),e(E,{icon:"mdi-close",variant:"text",size:"small",onClick:Je})]}),_:1}),e(ae,{class:"pa-6"},{default:t(()=>[e(ee,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(ae,{class:"pa-4"},{default:t(()=>{var c,H,Y,V,re,ue;return[o("div",Ha,[e($e,{image:(c=D.product)==null?void 0:c.image_url,size:"64"},{default:t(()=>{var oe;return[(oe=D.product)!=null&&oe.image_url?W("",!0):(m(),F(k,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),o("div",Ma,[o("h4",Ka,r((H=D.product)==null?void 0:H.name),1),o("p",Ba," SKU: "+r(((Y=D.product)==null?void 0:Y.sku)||"SKU-"+((V=D.product)==null?void 0:V.id_product)),1),o("div",Fa,[o("p",Ea," Harga: "+r(M(He)(((re=D.product)==null?void 0:re.price)||0)),1),o("p",Ra," HPP: "+r(M(He)(ne.value)),1),(ue=D.product)!=null&&ue.price&&ne.value?(m(),X("p",La," Margin: "+r(M(He)(Q.value)),1)):W("",!0)])]),e(se,{color:te(),variant:"tonal"},{default:t(()=>[d(r(L()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e(Se,{class:"mb-6"},{default:t(()=>[e($,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"info"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>[e(k,{icon:"mdi-calculator",size:"20",class:"mb-1"}),o("div",qa,[d(r(M(He)(ne.value))+" ",1),M(ke)?(m(),F(it,{key:0,indeterminate:"",size:"12",width:"2",class:"ml-1"})):W("",!0)]),n[12]||(n[12]=o("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[12]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"primary"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>{var c;return[e(k,{icon:"mdi-currency-usd",size:"20",class:"mb-1"}),o("div",Na,r(M(He)(((c=D.product)==null?void 0:c.price)||0)),1),n[13]||(n[13]=o("div",{class:"text-caption"},"Harga Jual",-1))]}),_:1,__:[13]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"success"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>[e(k,{icon:"mdi-trending-up",size:"20",class:"mb-1"}),o("div",Oa,r(M(He)(Q.value)),1),n[14]||(n[14]=o("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[14]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"warning"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>[e(k,{icon:"mdi-percent",size:"20",class:"mb-1"}),o("div",ja,r(ve.value)+"% ",1),n[15]||(n[15]=o("div",{class:"text-caption"},"Margin %",-1))]),_:1,__:[15]})]),_:1})]),_:1})]),_:1}),e(ee,{class:"mb-6",elevation:"2"},{default:t(()=>[e(we,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[o("div",Ja,[o("div",Wa,[e(k,{icon:p.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),d(" "+r(p.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(ae,{class:"pa-4"},{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12",md:"4"},{default:t(()=>[e(bt,{modelValue:T.value.itemId,"onUpdate:modelValue":n[0]||(n[0]=c=>T.value.itemId=c),items:h.value,loading:f.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item (termasuk yang stok kosong)...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":K()},{item:t(({props:c,item:H})=>[e(je,he(c,{class:{"text-medium-emphasis":O(H.raw)<=0}}),{prepend:t(()=>[e($e,{size:"32",class:"me-3",color:O(H.raw)<=0?"warning":"primary",variant:"tonal"},{default:t(()=>[e(k,{icon:"mdi-package-variant",color:O(H.raw)<=0?"warning":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[O(H.raw)>0?(m(),F(se,{key:0,size:"x-small",color:b(H.raw),variant:"tonal"},{default:t(()=>[d(r(i(H.raw)),1)]),_:2},1032,["color"])):(m(),F(se,{key:1,size:"x-small",color:"warning",variant:"tonal","prepend-icon":"mdi-alert"},{default:t(()=>n[17]||(n[17]=[d(" Kosong ")])),_:1,__:[17]}))]),default:t(()=>[e(Ye,null,{default:t(()=>[d(r(H.raw.name),1)]),_:2},1024),e(tt,{class:"text-medium-emphasis"},{default:t(()=>[O(H.raw)<=0?(m(),X("span",Ga,[e(k,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),n[16]||(n[16]=d(" Stok Kosong - Masih bisa digunakan "))])):(m(),X("span",Qa," Stok: "+r(O(H.raw))+" "+r(H.raw.unit),1))]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:T.value.quantity,"onUpdate:modelValue":n[1]||(n[1]=c=>T.value.quantity=c),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Ze,{modelValue:T.value.isCritical,"onUpdate:modelValue":n[2]||(n[2]=c=>T.value.isCritical=c),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(E,{color:p.value?"success":"primary",block:"","prepend-icon":p.value?"mdi-check":"mdi-plus",onClick:n[3]||(n[3]=c=>p.value?le():ce()),disabled:!fe.value},{default:t(()=>[d(r(p.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),p.value?(m(),F(E,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:De},{default:t(()=>n[18]||(n[18]=[d(" Batal ")])),_:1,__:[18]})):W("",!0)]),_:1})]),_:1}),N.value?(m(),F(Ke,{key:0,color:"warning",variant:"tonal",class:"mt-4","prepend-icon":"mdi-alert"},{default:t(()=>[e(ct,null,{default:t(()=>n[19]||(n[19]=[d("Item Stok Kosong")])),_:1,__:[19]}),n[20]||(n[20]=o("div",null,"Item yang dipilih sedang kosong stok, namun masih bisa ditambahkan ke komposisi. Pastikan untuk memperbarui stok sebelum produksi.",-1))]),_:1,__:[20]})):W("",!0)]),_:1})]),_:1}),e(ee,{elevation:"2"},{default:t(()=>[e(we,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e(k,{icon:"mdi-format-list-bulleted",class:"me-2"}),d(" Daftar Item Komposisi ("+r(G.value.length)+") ",1)]),_:1}),e(ae,{class:"pa-0"},{default:t(()=>[G.value.length===0?(m(),X("div",Xa,[e(k,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),n[21]||(n[21]=o("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),n[22]||(n[22]=o("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(m(),F(nt,{key:1},{default:t(()=>[(m(!0),X(Te,null,We(G.value,(c,H)=>(m(),F(je,{key:c.id||H,class:"border-b"},{prepend:t(()=>[e($e,{size:"40",class:"me-3"},{default:t(()=>{var Y,V;return[e(k,{icon:(Y=c.item)!=null&&Y.inventory&&c.item.inventory.current_stock>=c.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(V=c.item)!=null&&V.inventory&&c.item.inventory.current_stock>=c.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[o("div",el,[e(E,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:Y=>ze(c,H)},null,8,["onClick"]),e(E,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:Y=>Ae(H)},null,8,["onClick"])])]),default:t(()=>[e(Ye,{class:"font-weight-medium"},{default:t(()=>{var Y;return[d(r(((Y=c.item)==null?void 0:Y.name)||"Item tidak ditemukan")+" ",1),c.is_critical?(m(),F(se,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>n[23]||(n[23]=[d(" Kritis ")])),_:1,__:[23]})):W("",!0)]}),_:2},1024),e(tt,null,{default:t(()=>{var Y;return[o("div",Za,[o("span",null,"Dibutuhkan: "+r(parseFloat(c.quantity_needed.toString()))+" "+r(c.unit),1),(Y=c.item)!=null&&Y.inventory?(m(),X("span",{key:0,class:Ge(c.item.inventory.current_stock>=c.quantity_needed?"text-success":"text-error")}," Stok: "+r(c.item.inventory.current_stock)+" "+r(c.unit),3)):W("",!0),c.formatted_total_cost?(m(),X("span",Ya,r(c.formatted_total_cost),1)):W("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(Re,{class:"pa-6 pt-0"},{default:t(()=>[e(E,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:l},{default:t(()=>n[24]||(n[24]=[d(" Setting HPP ")])),_:1,__:[24]}),e(Oe),e(E,{variant:"outlined",onClick:Je},{default:t(()=>n[25]||(n[25]=[d(" Batal ")])),_:1,__:[25]}),e(E,{color:"primary",onClick:Qe,loading:g.value},{default:t(()=>n[26]||(n[26]=[d(" Simpan Komposisi ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1}),e(at,{modelValue:U.value,"onUpdate:modelValue":n[5]||(n[5]=c=>U.value=c),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(E,{color:"white",variant:"text",onClick:n[4]||(n[4]=c=>U.value=!1)},{default:t(()=>n[27]||(n[27]=[d(" Tutup ")])),_:1,__:[27]})]),default:t(()=>[d(r(v.value)+" ",1)]),_:1},8,["modelValue"]),e(at,{modelValue:y.value,"onUpdate:modelValue":n[7]||(n[7]=c=>y.value=c),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(E,{color:"white",variant:"text",onClick:n[6]||(n[6]=c=>y.value=!1)},{default:t(()=>n[28]||(n[28]=[d(" Tutup ")])),_:1,__:[28]})]),default:t(()=>[d(r(j.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(Et,{modelValue:de.value,"onUpdate:modelValue":n[9]||(n[9]=c=>de.value=c),"product-id":parseInt(String(((s=D.product)==null?void 0:s.id_product)||((w=D.product)==null?void 0:w.id)||"0")),"product-name":((B=D.product)==null?void 0:B.product_name)||((R=D.product)==null?void 0:R.name),onHppUpdated:u,onPriceUpdated:n[10]||(n[10]=c=>z("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),zt=Le(tl,[["__scopeId","data-v-44243e1a"]]),al={class:"product-selection"},ll={key:0,class:"text-center pa-4"},ol={key:1,class:"product-list",style:{"max-height":"400px","overflow-y":"auto"}},sl={class:"d-flex flex-column align-end"},il={key:0,class:"text-body-2 text-primary font-weight-medium"},nl={key:2,class:"text-center pa-8"},rl={class:"text-h6 mt-2 text-medium-emphasis"},ul={class:"text-body-2 text-medium-emphasis"},dl=Fe({__name:"ProductSelectionList",emits:["select"],setup(S,{emit:ye}){const q=ye,z=I([]),J=I(!1),g=I(""),G=async()=>{try{J.value=!0;const y=await na.getAll({per_page:100,search:g.value,active:!0});y.success&&(z.value=y.data||[])}catch(y){console.error("Error fetching products:",y)}finally{J.value=!1}},U=y=>{q("select",y)};return et(()=>{G()}),(y,v)=>(m(),X("div",al,[e(xe,{modelValue:g.value,"onUpdate:modelValue":[v[0]||(v[0]=j=>g.value=j),G],label:"Cari produk...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",class:"mb-3"},null,8,["modelValue"]),J.value?(m(),X("div",ll,[e(it,{indeterminate:"",color:"primary"}),v[1]||(v[1]=o("div",{class:"mt-2"},"Memuat produk...",-1))])):z.value.length>0?(m(),X("div",ol,[e(nt,{density:"compact"},{default:t(()=>[(m(!0),X(Te,null,We(z.value,j=>(m(),F(je,{key:j.id_product||j.id,class:"product-item",onClick:p=>U(j),style:{cursor:"pointer"},ripple:!0},{prepend:t(()=>[j.image_url?(m(),F($e,{key:0,image:j.image_url,size:"32",class:"me-3"},null,8,["image"])):(m(),F(k,{key:1,icon:"mdi-package-variant",size:"32",color:"grey-lighten-1",class:"me-3"}))]),append:t(()=>[o("div",sl,[j.price?(m(),X("div",il,r(j.formatted_price||M(He)(j.price)),1)):W("",!0),e(k,{icon:"mdi-chevron-right",size:"16",color:"grey-lighten-1"})])]),default:t(()=>[e(Ye,{class:"text-body-2"},{default:t(()=>[d(r(j.name),1)]),_:2},1024),j.sku?(m(),F(tt,{key:0,class:"text-caption"},{default:t(()=>[d(" SKU: "+r(j.sku),1)]),_:2},1024)):W("",!0)]),_:2},1032,["onClick"]))),128))]),_:1})])):(m(),X("div",nl,[e(k,{icon:"mdi-package-variant-closed",size:"64",color:"grey-lighten-2"}),o("div",rl,r(g.value?"Tidak ada produk ditemukan":"Belum ada produk"),1),o("div",ul,r(g.value?"Coba ubah kata kunci pencarian":"Tambah produk terlebih dahulu"),1)]))]))}}),cl=Le(dl,[["__scopeId","data-v-1280b878"]]),ml={class:"composition-cards"},vl={class:"d-flex gap-2"},pl={key:1,class:"text-center pa-12"},fl={key:2,class:"text-center pa-12"},gl={class:"d-flex align-center gap-3"},_l={class:"flex-grow-1 min-width-0"},kl={class:"text-h6 font-weight-bold text-truncate"},bl={class:"text-caption text-medium-emphasis mb-0"},yl={class:"d-flex align-center gap-2 mb-3"},hl={class:"text-body-2 font-weight-medium"},xl={class:"composition-items"},wl={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},Pl={class:"text-body-2 text-truncate"},Vl={class:"text-end flex-shrink-0"},Cl={class:"text-body-2 font-weight-medium"},$l={key:0,class:"text-caption text-success"},Sl={key:1,class:"text-caption text-primary"},Il={class:"d-flex justify-between align-center mb-3"},Dl={class:"text-h6 font-weight-bold text-primary"},zl={class:"d-flex gap-2"},Tl={key:4,class:"d-flex justify-center mt-6"},Ul={key:5,class:"text-center mt-4"},Al={class:"d-flex align-center"},Hl={class:"d-flex align-center gap-4"},Ml={class:"flex-grow-1"},Kl={class:"text-h5 font-weight-bold mb-2"},Bl={class:"d-flex align-center gap-4 mb-2"},Fl={class:"text-body-2"},El={class:"d-flex align-center gap-4"},Rl={class:"text-h6 text-primary font-weight-bold"},Ll={class:"text-body-2 text-info font-weight-medium"},ql={key:0,class:"text-body-2 text-success font-weight-medium"},Nl={class:"d-flex align-center mt-1 gap-4"},Ol={class:"d-flex align-center"},jl={class:"d-flex align-center"},Jl={key:0,class:"d-flex align-center"},Wl={class:"text-primary font-weight-medium"},Gl={key:1,class:"text-center py-8"},Ql={class:"text-h6 font-weight-bold"},Xl={class:"text-h6 font-weight-bold"},Zl={class:"text-h6 font-weight-bold"},Yl={class:"text-h6 font-weight-bold"},eo={class:"text-h6 font-weight-bold"},to=Fe({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup(S,{emit:ye}){const q=S,z=ye,J=I(!1),g=I(!1),G=I(!1),U=I(null),y=I([]),v=I(null),j=I(1),p=I(12),A=I({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),de=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],ke=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],C=i=>{U.value=i,y.value=i.items||[],J.value=!0},ie=()=>{G.value=!0},ne=i=>{U.value=i,y.value=[],G.value=!1,J.value=!0},Q=()=>{z("refresh"),b()},ve=i=>{v.value=i,g.value=!0},T=()=>{A.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},_=me(()=>!!(A.value.search||A.value.stockStatus||A.value.itemType||A.value.criticalOnly||A.value.sortBy!=="name_asc")),f=me(()=>{let i=0;return A.value.search&&i++,A.value.stockStatus&&i++,A.value.itemType&&i++,A.value.criticalOnly&&i++,A.value.sortBy!=="name_asc"&&i++,i}),x=me(()=>{const i=new Map;q.productItems.forEach(l=>{if(!l.product)return;const u=l.product.id_product||l.product.id;i.has(u)||i.set(u,{...l.product,items:[],totalItems:0}),i.get(u).items.push(l),i.get(u).totalItems++});let a=Array.from(i.values());if(A.value.search){const l=A.value.search.toLowerCase();a=a.filter(u=>u.name.toLowerCase().includes(l)||u.sku&&u.sku.toLowerCase().includes(l)||u.items.some(te=>{var L;return(L=te.item)==null?void 0:L.name.toLowerCase().includes(l)}))}return A.value.stockStatus&&(a=a.filter(l=>{const u=fe(l);switch(A.value.stockStatus){case"safe":return u.color==="success";case"critical":return u.color==="warning";case"out":return u.color==="error";default:return!0}})),A.value.criticalOnly&&(a=a.filter(l=>l.items.some(u=>u.is_critical))),a.sort((l,u)=>{switch(A.value.sortBy){case"name_asc":return l.name.localeCompare(u.name);case"name_desc":return u.name.localeCompare(l.name);case"price_asc":return(l.price||0)-(u.price||0);case"price_desc":return(u.price||0)-(l.price||0);case"items_asc":return l.totalItems-u.totalItems;case"items_desc":return u.totalItems-l.totalItems;default:return l.name.localeCompare(u.name)}}),a}),_e=me(()=>Math.ceil(x.value.length/p.value)),pe=me(()=>{const i=(j.value-1)*p.value,a=i+p.value;return x.value.slice(i,a)}),fe=i=>{let a=!1,l=!1;return i.items.forEach(u=>{var te;if((te=u.item)!=null&&te.inventory){const L=u.item.inventory.current_stock||0,ce=u.quantity_needed||0;L<=0?a=!0:(L<ce||u.is_critical)&&(l=!0)}}),a?{text:"Stok Habis",color:"error"}:l?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},P=i=>{if(!(i!=null&&i.inventory))return"grey";const a=i.inventory.current_stock||0;return a<=0?"error":a<=10?"warning":"success"},N=i=>{if(!(i!=null&&i.inventory))return"Tidak ada data";const a=i.inventory.current_stock||0;return a<=0?"Habis":a<=10?"Rendah":"Aman"},h=i=>{const a=P(i);return{"text-error":a==="error","text-warning":a==="warning","text-success":a==="success","text-grey":a==="grey"}},O=i=>`Item Komposisi (${i})`,K=i=>{j.value=i},b=()=>{j.value=1};return Ce(()=>[A.value.search,A.value.stockStatus,A.value.criticalOnly,A.value.sortBy],()=>{b()}),(i,a)=>(m(),X("div",ml,[e(ee,{class:"mb-6"},{default:t(()=>[e(we,{class:"d-flex align-center justify-between"},{default:t(()=>[a[16]||(a[16]=o("div",null,[o("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),o("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),o("div",vl,[e(E,{color:"primary","prepend-icon":"mdi-plus",onClick:ie},{default:t(()=>a[14]||(a[14]=[d(" Tambah Komposisi ")])),_:1,__:[14]}),e(E,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:a[0]||(a[0]=l=>z("refresh")),loading:i.loading},{default:t(()=>a[15]||(a[15]=[d(" Refresh ")])),_:1,__:[15]},8,["loading"])])]),_:1,__:[16]})]),_:1}),e(ee,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ae,null,{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:A.value.search,"onUpdate:modelValue":a[1]||(a[1]=l=>A.value.search=l),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:A.value.stockStatus,"onUpdate:modelValue":a[2]||(a[2]=l=>A.value.stockStatus=l),items:de,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:A.value.sortBy,"onUpdate:modelValue":a[3]||(a[3]=l=>A.value.sortBy=l),items:ke,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(ca,{modelValue:A.value.criticalOnly,"onUpdate:modelValue":a[4]||(a[4]=l=>A.value.criticalOnly=l),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Se,{class:"mt-3"},{default:t(()=>[e($,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(E,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:T,disabled:!_.value},{default:t(()=>a[17]||(a[17]=[d(" Reset Filter ")])),_:1,__:[17]},8,["disabled"]),_.value?(m(),F(se,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[d(r(f.value)+" filter aktif ",1)]),_:1})):W("",!0)]),_:1}),e($,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(se,{color:x.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[d(r(x.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!i.loading&&x.value.length===0&&_.value?(m(),F(Ke,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):W("",!0),i.loading?(m(),X("div",pl,[e(it,{color:"primary",indeterminate:"",size:"64"}),a[18]||(a[18]=o("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):x.value.length===0?(m(),X("div",fl,[e(k,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),a[20]||(a[20]=o("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),a[21]||(a[21]=o("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(E,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:ie},{default:t(()=>a[19]||(a[19]=[d(" Buat Komposisi Pertama ")])),_:1,__:[19]})])):(m(),F(Se,{key:3},{default:t(()=>[(m(!0),X(Te,null,We(pe.value,l=>(m(),F($,{key:l.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ee,{class:Ge(["composition-card h-100",{"border-error":fe(l).color==="error"}]),elevation:"2"},{default:t(()=>[e(we,{class:"pa-4 pb-2"},{default:t(()=>[o("div",gl,[e($e,{image:l.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[l.image_url?W("",!0):(m(),F(k,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),o("div",_l,[o("h3",kl,r(l.name),1),o("p",bl,r(l.sku||"SKU-"+l.id_product),1)])])]),_:2},1024),e(ae,{class:"py-2"},{default:t(()=>[e(se,{color:fe(l).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[d(r(fe(l).text),1)]),_:2},1032,["color"]),o("div",yl,[e(k,{icon:"mdi-format-list-bulleted",size:"16"}),o("span",hl,r(O(l.totalItems)),1)]),o("div",xl,[(m(!0),X(Te,null,We(l.items,u=>{var te,L,ce,ze;return m(),X("div",{key:u.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[o("div",wl,[e(k,{icon:(te=u.item)!=null&&te.inventory&&u.item.inventory.current_stock>=u.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(L=u.item)!=null&&L.inventory&&u.item.inventory.current_stock>=u.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),o("span",Pl,r(((ce=u.item)==null?void 0:ce.name)||"Item tidak ditemukan"),1),u.is_critical?(m(),F(se,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>a[22]||(a[22]=[d(" Kritis ")])),_:1,__:[22]})):W("",!0)]),o("div",Vl,[o("div",Cl,r(parseFloat(u.quantity_needed))+" "+r(u.unit),1),(ze=u.item)!=null&&ze.inventory?(m(),X("div",$l," Stok: "+r(u.item.inventory.current_stock)+" "+r(u.unit),1)):W("",!0),u.formatted_total_cost?(m(),X("div",Sl,r(u.formatted_total_cost),1)):W("",!0)])])}),128))])]),_:2},1024),e(ae,{class:"pt-0"},{default:t(()=>[e(Ue,{class:"mb-3"}),o("div",Il,[a[23]||(a[23]=o("span",{class:"text-body-2"},"Harga:",-1)),o("span",Dl,r(M(He)(l.price||0)),1)]),o("div",zl,[e(E,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:u=>ve(l)},{default:t(()=>a[24]||(a[24]=[d(" Detail ")])),_:2,__:[24]},1032,["onClick"]),e(E,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:u=>C(l)},{default:t(()=>a[25]||(a[25]=[d(" Kelola ")])),_:2,__:[25]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),x.value.length>p.value?(m(),X("div",Tl,[e(ma,{modelValue:j.value,"onUpdate:modelValue":[a[5]||(a[5]=l=>j.value=l),K],length:_e.value,"total-visible":i.$vuetify.display.smAndDown?5:7,size:"small"},null,8,["modelValue","length","total-visible"])])):W("",!0),x.value.length>0?(m(),X("div",Ul,[e(se,{variant:"tonal",color:"primary",size:"small"},{default:t(()=>[d(" Menampilkan "+r((j.value-1)*p.value+1)+"-"+r(Math.min(j.value*p.value,x.value.length))+" dari "+r(x.value.length)+" produk ",1)]),_:1})])):W("",!0),e(zt,{modelValue:J.value,"onUpdate:modelValue":a[6]||(a[6]=l=>J.value=l),product:U.value,items:y.value,onSave:Q,onRefresh:a[7]||(a[7]=l=>z("refresh"))},null,8,["modelValue","product","items"]),e(Ee,{modelValue:g.value,"onUpdate:modelValue":a[11]||(a[11]=l=>g.value=l),"max-width":"900",scrollable:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",Al,[e(k,{icon:"mdi-eye",class:"mr-2",color:"primary"}),a[26]||(a[26]=o("span",null,"Detail Komposisi Produk",-1))]),e(E,{icon:"",variant:"text",onClick:a[8]||(a[8]=l=>g.value=!1)},{default:t(()=>[e(k,{icon:"mdi-close"})]),_:1})]),_:1}),e(Ue),v.value?(m(),F(ae,{key:0},{default:t(()=>[e(pa,null,{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12"},{default:t(()=>[e(ee,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(ae,null,{default:t(()=>[o("div",Hl,[e($e,{image:v.value.image_url,size:"80"},{default:t(()=>[v.value.image_url?W("",!0):(m(),F(k,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),o("div",Ml,[o("h2",Kl,r(v.value.name),1),o("div",Bl,[e(se,{color:fe(v.value).color,variant:"tonal",size:"small"},{default:t(()=>[d(r(fe(v.value).text),1)]),_:1},8,["color"]),o("span",Fl,"SKU: "+r(v.value.sku||"-"),1)]),o("div",El,[o("div",Rl,r(M(He)(v.value.price||0)),1),o("div",Ll," HPP: "+r(M(He)(v.value.hpp||v.value.cost||0)),1),v.value.price&&(v.value.hpp||v.value.cost)?(m(),X("div",ql," Margin: "+r(M(He)((v.value.price||0)-(v.value.hpp||v.value.cost||0))),1)):W("",!0)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e(Se,null,{default:t(()=>[e($,{cols:"12"},{default:t(()=>[e(ee,{variant:"outlined"},{default:t(()=>[e(we,{class:"text-h6"},{default:t(()=>[e(k,{icon:"mdi-format-list-bulleted",class:"mr-2"}),d(" Komposisi Item ("+r(v.value.totalItems||0)+") ",1)]),_:1}),e(ae,null,{default:t(()=>[v.value.items&&v.value.items.length>0?(m(),F(nt,{key:0},{default:t(()=>[(m(!0),X(Te,null,We(v.value.items,(l,u)=>(m(),F(je,{key:l.id_product_item,class:"px-0"},{prepend:t(()=>[e($e,{size:"40",color:P(l.item),variant:"tonal"},{default:t(()=>{var te;return[e(k,{icon:(te=l.item)!=null&&te.inventory&&l.item.inventory.current_stock>=l.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(se,{color:P(l.item),variant:"tonal",size:"small"},{default:t(()=>[d(r(N(l.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(Ye,{class:"font-weight-medium"},{default:t(()=>{var te;return[d(r(((te=l.item)==null?void 0:te.name)||"Unknown Item")+" ",1),l.is_critical?(m(),F(se,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>a[27]||(a[27]=[d(" Kritis ")])),_:1,__:[27]})):W("",!0)]}),_:2},1024),e(tt,null,{default:t(()=>{var te,L;return[o("div",Nl,[o("div",Ol,[e(k,{icon:"mdi-scale",size:"14",class:"mr-1"}),o("span",null," Kebutuhan: "+r(Number(l.quantity_needed||0).toLocaleString("id-ID"))+" "+r(l.unit),1)]),o("div",jl,[e(k,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),o("span",{class:Ge(h(l.item))}," Stok: "+r(Number(((L=(te=l.item)==null?void 0:te.inventory)==null?void 0:L.current_stock)||0).toLocaleString("id-ID"))+" "+r(l.unit),3)]),l.formatted_total_cost?(m(),X("div",Jl,[e(k,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),o("span",Wl,r(l.formatted_total_cost),1)])):W("",!0)])]}),_:2},1024),u<v.value.items.length-1?(m(),F(Ue,{key:0,class:"mt-3"})):W("",!0)]),_:2},1024))),128))]),_:1})):(m(),X("div",Gl,[e(k,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),a[28]||(a[28]=o("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(Se,{class:"mt-4"},{default:t(()=>[e($,{cols:"12",md:"2"},{default:t(()=>[e(ee,{variant:"outlined",color:"primary"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(k,{icon:"mdi-format-list-bulleted",size:"24",class:"mb-2"}),o("div",Ql,r(v.value.totalItems||0),1),a[29]||(a[29]=o("div",{class:"text-caption"},"Total Item",-1))]),_:1,__:[29]})]),_:1})]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(ee,{variant:"outlined",color:"warning"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>{var l;return[e(k,{icon:"mdi-alert",size:"24",class:"mb-2"}),o("div",Xl,r(((l=v.value.items)==null?void 0:l.filter(u=>u.is_critical).length)||0),1),a[30]||(a[30]=o("div",{class:"text-caption"},"Item Kritis",-1))]}),_:1,__:[30]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"info"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(k,{icon:"mdi-calculator",size:"24",class:"mb-2"}),o("div",Zl,r(M(He)(v.value.hpp||v.value.cost||0)),1),a[31]||(a[31]=o("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[31]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"success"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(k,{icon:"mdi-currency-usd",size:"24",class:"mb-2"}),o("div",Yl,r(M(He)(v.value.price||0)),1),a[32]||(a[32]=o("div",{class:"text-caption"},"Harga Jual",-1))]),_:1,__:[32]})]),_:1})]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(ee,{variant:"outlined",color:"purple"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(k,{icon:"mdi-trending-up",size:"24",class:"mb-2"}),o("div",eo,r(M(He)((v.value.price||0)-(v.value.hpp||v.value.cost||0))),1),a[33]||(a[33]=o("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[33]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):W("",!0),e(Ue),e(Re,{class:"pa-4"},{default:t(()=>[e(Oe),e(E,{variant:"outlined",onClick:a[9]||(a[9]=l=>g.value=!1)},{default:t(()=>a[34]||(a[34]=[d(" Tutup ")])),_:1,__:[34]}),e(E,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:a[10]||(a[10]=()=>{g.value=!1,C(v.value)})},{default:t(()=>a[35]||(a[35]=[d(" Kelola Komposisi ")])),_:1,__:[35]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ee,{modelValue:G.value,"onUpdate:modelValue":a[13]||(a[13]=l=>G.value=l),"max-width":"600px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-between pa-4"},{default:t(()=>[a[36]||(a[36]=o("span",{class:"text-h6"},"Pilih Produk untuk Komposisi",-1)),e(E,{variant:"text",icon:"mdi-close",size:"small",onClick:a[12]||(a[12]=l=>G.value=!1)})]),_:1,__:[36]}),e(ae,{class:"pa-4"},{default:t(()=>[e(cl,{onSelect:ne})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),ao=Le(to,[["__scopeId","data-v-e2cb9847"]]),lo={class:"d-flex align-center gap-2"},oo={class:"text-white"},so={class:"text-h6 mb-4 d-flex align-center gap-2"},io={class:"text-h6 mb-4 d-flex align-center gap-2"},no={class:"d-flex flex-column gap-2"},ro={key:0,class:"d-flex align-center gap-2"},uo={class:"d-flex align-center gap-2 mb-2"},co={class:"d-flex gap-2"},mo={class:"d-flex gap-2"},vo={class:"d-flex align-center justify-space-between"},po={class:"d-flex align-center gap-2"},fo={class:"text-end"},go={class:"text-h6 font-weight-bold"},_o={class:"text-caption"},ko={class:"text-h6 mb-4 d-flex align-center gap-2"},bo={class:"text-h6 mb-4 d-flex align-center gap-2"},yo={class:"image-upload-container"},ho={key:0,class:"mb-4"},xo={class:"text-center mt-2"},wo={class:"text-h6 mb-4 d-flex align-center gap-2"},Po={class:"text-h6 mb-4 d-flex align-center gap-2"},Vo={class:"text-h6 mb-4 d-flex align-center gap-2"},Co={class:"d-flex align-center"},$o={class:"text-subtitle-1"},So={class:"text-body-1"},Io={class:"d-flex align-center"},Do={class:"text-subtitle-1"},zo=Fe({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup(S,{emit:ye}){var K,b,i;const q=It(),{nameRules:z,categoryRules:J}=Dt(),{getProductHPPBreakdown:g}=_t(),G=I(!1),U=I(!1),y=async()=>{if(!(!p.editMode||!C.id))try{const a=await fetch(`/api/products/${C.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(a.ok){const l=await a.json();U.value=l.success&&l.data&&l.data.length>0}}catch(a){console.error("Error checking HPP status:",a)}},v=async()=>{if(C.id)try{G.value=!0;const a=await g(C.id,"latest");a&&(C.cost=a.total_hpp,de("update-form","cost",a.total_hpp))}catch(a){console.error("Error refreshing HPP:",a)}finally{G.value=!1}},j=()=>{},p=S,A=me(()=>p.errorMessage),de=ye,ke=I(),C=gt({...p.formData,available_in_kitchen:!!p.formData.available_in_kitchen,available_in_bar:!!p.formData.available_in_bar});Ce(()=>p.formData,a=>{const l={...a,available_in_kitchen:!!a.available_in_kitchen,available_in_bar:!!a.available_in_bar};Object.assign(C,l)},{deep:!0}),Ce(C,a=>{Object.keys(a).forEach(l=>{de("update-form",l,a[l])})},{deep:!0}),Ce(()=>p.modelValue,a=>{a&&p.editMode&&y()});const ie=gt({length:((K=p.formData.dimensions)==null?void 0:K.length)||null,width:((b=p.formData.dimensions)==null?void 0:b.width)||null,height:((i=p.formData.dimensions)==null?void 0:i.height)||null});Ce(ie,a=>{const l=a.length!==null||a.width!==null||a.height!==null;C.dimensions=l?{length:a.length!==null?a.length:void 0,width:a.width!==null?a.width:void 0,height:a.height!==null?a.height:void 0}:{}},{deep:!0});const ne=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],Q=me(()=>{if(!C.price||!C.cost||C.cost<=0)return 0;const a=(C.price-C.cost)/C.cost*100;return Math.ceil(a)}),ve=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),T=a=>a<10?"error":a<25?"warning":a<50?"success":"info",_=a=>a<10?"tabler-trending-down":a<25?"tabler-trending-up":a<50?"tabler-trending-up-2":"tabler-trending-up-3",f=a=>!a||a===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),x=a=>{if(!a||a.trim()===""||a==="Rp 0")return 0;const u=a.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(u)||0},_e=I(!1),pe=a=>{const l=x(a);C.price=l},fe=()=>{_e.value=!0},P=()=>{_e.value=!1},N=async()=>{var l;const{valid:a}=await((l=ke.value)==null?void 0:l.validate());a&&de("submit",C)},h=a=>{de("image-change",a)},O=()=>{de("remove-image")};return(a,l)=>(m(),F(Ee,{"model-value":a.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":l[27]||(l[27]=u=>a.$emit("update:modelValue",u))},{default:t(()=>[e(ee,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(we,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[o("div",lo,[e(k,{icon:a.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),o("span",oo,r(a.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(E,{icon:"tabler-x",variant:"text",color:"white",onClick:l[0]||(l[0]=u=>a.$emit("close"))})]),_:1}),e(Ue),e(ae,{class:"pa-6"},{default:t(()=>[e(yt,{ref_key:"formRef",ref:ke,onSubmit:kt(N,["prevent"])},{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12"},{default:t(()=>[o("h6",so,[e(k,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),l[28]||(l[28]=d(" Informasi Dasar "))])]),_:1}),e($,{cols:"12",md:"8"},{default:t(()=>[e(xe,{modelValue:C.name,"onUpdate:modelValue":l[1]||(l[1]=u=>C.name=u),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:M(z),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:C.sku,"onUpdate:modelValue":l[2]||(l[2]=u=>C.sku=u),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ct,{modelValue:C.description,"onUpdate:modelValue":l[3]||(l[3]=u=>C.description=u),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(Be,{"model-value":C.category_id,"onUpdate:modelValue":l[4]||(l[4]=u=>C.category_id=u),items:a.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:M(J),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(xe,{modelValue:C.brand,"onUpdate:modelValue":l[5]||(l[5]=u=>C.brand=u),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",io,[e(k,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),l[29]||(l[29]=d(" Harga & Biaya "))])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(xe,{"model-value":f(C.price),"onUpdate:modelValue":l[6]||(l[6]=u=>pe(u)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:fe,onBlur:P},null,8,["model-value"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[o("div",no,[e(xe,{"model-value":f(C.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),a.editMode?(m(),X("div",ro,[e(se,{color:U.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e(k,{icon:U.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),d(" "+r(U.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),U.value?(m(),F(E,{key:0,size:"small",variant:"outlined",color:"primary",onClick:v,loading:G.value},{default:t(()=>[e(k,{icon:"tabler-refresh",size:"14",class:"me-1"}),l[30]||(l[30]=d(" Update HPP "))]),_:1,__:[30]},8,["loading"])):(m(),F(Me,{key:1},{activator:t(({props:u})=>[e(se,he(u,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e(k,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),l[31]||(l[31]=d(" Belum Ada Resep "))]),_:2,__:[31]},1040)]),default:t(()=>[l[32]||(l[32]=o("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[32]}))])):W("",!0)])]),_:1}),a.editMode?(m(),F($,{key:0,cols:"12"},{default:t(()=>[U.value?(m(),F(Ke,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ct,null,{default:t(()=>[e(k,{icon:"tabler-info-circle",class:"me-2"}),l[33]||(l[33]=d(" HPP Otomatis Aktif "))]),_:1,__:[33]}),l[34]||(l[34]=o("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[34]})):(m(),F(Ke,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ct,null,{default:t(()=>[e(k,{icon:"tabler-alert-triangle",class:"me-2"}),l[35]||(l[35]=d(" HPP Manual "))]),_:1,__:[35]}),l[36]||(l[36]=o("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[36]}))]),_:1})):W("",!0),e($,{cols:"12"},{default:t(()=>[U.value&&a.editMode?(m(),F(Ke,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[o("div",uo,[e(k,{icon:"tabler-check-circle"}),l[37]||(l[37]=o("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),l[40]||(l[40]=o("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),o("div",co,[e(E,{size:"small",color:"primary",variant:"outlined",onClick:j},{default:t(()=>[e(k,{icon:"tabler-edit",size:"14",class:"me-1"}),l[38]||(l[38]=d(" Edit Resep "))]),_:1,__:[38]}),e(E,{size:"small",variant:"outlined",color:"info",onClick:v,loading:G.value},{default:t(()=>[e(k,{icon:"tabler-refresh",size:"14",class:"me-1"}),l[39]||(l[39]=d(" Refresh HPP "))]),_:1,__:[39]},8,["loading"])])]),_:1,__:[40]})):!U.value&&a.editMode?(m(),F(Ke,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[o("div",mo,[e(E,{size:"small",variant:"outlined",color:"info",onClick:l[7]||(l[7]=u=>M(q).push("/hpp-management"))},{default:t(()=>[e(k,{icon:"tabler-calculator",size:"14",class:"me-1"}),l[41]||(l[41]=d(" Lihat HPP Management "))]),_:1,__:[41]})])]),_:1})):W("",!0)]),_:1}),e($,{cols:"12"},{default:t(()=>[C.price&&C.cost&&C.cost>0?(m(),F(Ke,{key:0,color:T(Q.value),variant:"tonal",class:"mb-0"},{default:t(()=>[o("div",vo,[o("div",po,[e(k,{icon:_(Q.value)},null,8,["icon"]),l[42]||(l[42]=o("span",{class:"font-weight-medium"},"Profit Margin",-1))]),o("div",fo,[o("div",go,r(Math.round(Q.value))+"%",1),o("div",_o," Keuntungan: "+r(ve(C.price-C.cost)),1)])])]),_:1},8,["color"])):W("",!0)]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",ko,[e(k,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),l[43]||(l[43]=d(" Dimensi (cm) "))])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:ie.length,"onUpdate:modelValue":l[8]||(l[8]=u=>ie.length=u),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:ie.width,"onUpdate:modelValue":l[9]||(l[9]=u=>ie.width=u),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:ie.height,"onUpdate:modelValue":l[10]||(l[10]=u=>ie.height=u),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",bo,[e(k,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),l[44]||(l[44]=d(" Gambar Produk "))])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("div",yo,[a.imagePreview?(m(),X("div",ho,[e(ka,{src:a.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),o("div",xo,[e(E,{size:"small",color:"error",variant:"outlined",onClick:O},{default:t(()=>l[45]||(l[45]=[d(" Hapus Gambar ")])),_:1,__:[45]})])])):W("",!0),e(ba,{"model-value":a.selectedImage,"onUpdate:modelValue":l[11]||(l[11]=u=>h(Array.isArray(u)?u:[u])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),l[46]||(l[46]=o("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",wo,[e(k,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),l[47]||(l[47]=d(" Pengaturan "))])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(Be,{"model-value":C.status,"onUpdate:modelValue":l[12]||(l[12]=u=>C.status=u),items:ne,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(Ze,{"model-value":C.active,"onUpdate:modelValue":l[13]||(l[13]=u=>C.active=u??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(Ze,{"model-value":C.featured,"onUpdate:modelValue":l[14]||(l[14]=u=>C.featured=u??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",Po,[e(k,{icon:"tabler-tools-kitchen-2",size:"20",class:"coffee-icon"}),l[48]||(l[48]=d(" Ketersediaan Station "))])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(Ze,{"model-value":C.available_in_kitchen,"onUpdate:modelValue":l[15]||(l[15]=u=>C.available_in_kitchen=!!u),label:"Tersedia di Kitchen",color:"coffee",inset:""},{prepend:t(()=>[e(k,{icon:"tabler-chef-hat",class:"me-2",color:C.available_in_kitchen?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(Ze,{"model-value":C.available_in_bar,"onUpdate:modelValue":l[16]||(l[16]=u=>C.available_in_bar=!!u),label:"Tersedia di Bar",color:"coffee",inset:""},{prepend:t(()=>[e(k,{icon:"tabler-glass-cocktail",class:"me-2",color:C.available_in_bar?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",Vo,[e(k,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),l[49]||(l[49]=d(" SEO (Opsional) "))])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(xe,{modelValue:C.meta_title,"onUpdate:modelValue":l[17]||(l[17]=u=>C.meta_title=u),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ct,{modelValue:C.meta_description,"onUpdate:modelValue":l[18]||(l[18]=u=>C.meta_description=u),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ta,{"model-value":C.tags,"onUpdate:modelValue":l[19]||(l[19]=u=>C.tags=u),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Ue),e(Re,{class:"pa-6"},{default:t(()=>[e(Oe),e(E,{variant:"outlined",class:"coffee-secondary",onClick:l[20]||(l[20]=u=>a.$emit("close"))},{default:t(()=>l[50]||(l[50]=[d(" Batal ")])),_:1,__:[50]}),e(E,{color:"primary",class:"coffee-primary",loading:a.loading,onClick:N},{default:t(()=>[d(r(a.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),a.useDialogError?W("",!0):(m(),F(at,{key:0,"model-value":!!A.value,"onUpdate:modelValue":l[22]||(l[22]=u=>!u&&a.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(E,{icon:"tabler-x",size:"small",variant:"text",onClick:l[21]||(l[21]=u=>a.$emit("clear-error"))})]),default:t(()=>[o("div",Co,[e(k,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),o("div",null,[l[51]||(l[51]=o("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),o("div",$o,r(A.value),1)])])]),_:1},8,["model-value"])),a.useDialogError?(m(),F(Ee,{key:1,"model-value":!!A.value,"onUpdate:modelValue":l[24]||(l[24]=u=>!u&&a.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center text-error"},{default:t(()=>[e(k,{icon:"tabler-alert-circle",class:"me-2"}),l[52]||(l[52]=d(" Error Occurred "))]),_:1,__:[52]}),e(Ue),e(ae,{class:"py-4"},{default:t(()=>[o("div",So,r(A.value),1)]),_:1}),e(Ue),e(Re,{class:"justify-end pa-4"},{default:t(()=>[e(E,{color:"error",variant:"outlined",onClick:l[23]||(l[23]=u=>a.$emit("clear-error"))},{default:t(()=>l[53]||(l[53]=[d(" Close ")])),_:1,__:[53]})]),_:1})]),_:1})]),_:1},8,["model-value"])):W("",!0),e(at,{"model-value":!!a.successMessage,"onUpdate:modelValue":l[26]||(l[26]=u=>!u&&a.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(E,{icon:"tabler-x",size:"small",variant:"text",onClick:l[25]||(l[25]=u=>a.$emit("clear-success"))})]),default:t(()=>[o("div",Io,[e(k,{icon:"tabler-check-circle",class:"me-3",size:"28"}),o("div",null,[l[54]||(l[54]=o("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),o("div",Do,r(a.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),To=Le(zo,[["__scopeId","data-v-333cc50b"]]),Uo={key:0,class:"mt-4"},Ao={class:"d-flex align-center gap-2 mb-2"},Ho={class:"d-flex flex-wrap gap-2"},Mo=Fe({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup(S,{emit:ye}){const q=S,z=ye,{categories:J,loading:g,fetchAllCategories:G}=ya(),U=I(!1),y=I("");et(async()=>{await G(),y.value=v.search||""});const v=gt({...q.filters});Ce(()=>q.filters,_=>{Object.assign(v,_),y.value=_.search||""},{deep:!0}),ea(y,_=>{v.search=_,(_.length>=3||_.length===0)&&(U.value=!0,z("search",_),C(),setTimeout(()=>{U.value=!1},500))},{debounce:500,maxWait:1e3});const j=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],p=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],A=[{title:"Kitchen Only",value:"kitchen"},{title:"Bar Only",value:"bar"},{title:"Kitchen & Bar",value:"both"}],de=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],ke=me(()=>!!(y.value||v.category_id||v.active||v.stock_status||v.station||v.featured!==null||v.min_price||v.max_price)),C=()=>{z("update:filters",{...v})},ie=()=>{y.value="",v.search="",z("search",""),C()},ne=()=>{y.value="",Object.assign(v,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),C()},Q=_=>{const f=J.value.find(x=>x.id_category===_);return(f==null?void 0:f.name)||"Unknown"},ve=_=>{if(!_)return"Semua";const f=j.find(x=>x.value===_);return(f==null?void 0:f.title)||String(_)},T=_=>{const f=p.find(x=>x.value===_);return(f==null?void 0:f.title)||_};return(_,f)=>(m(),F(ee,{class:"mb-6"},{default:t(()=>[e(we,{class:"d-flex align-center gap-2"},{default:t(()=>[e(k,{icon:"tabler-filter",class:"coffee-icon"}),f[11]||(f[11]=d(" Filter & Pencarian Produk "))]),_:1,__:[11]}),e(ae,null,{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:y.value,"onUpdate:modelValue":f[0]||(f[0]=x=>y.value=x),label:"Cari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:U.value,clearable:"",variant:"outlined",hint:y.value.length>0&&y.value.length<3?`Ketik ${3-y.value.length} karakter lagi untuk mencari`:"","persistent-hint":"","onClick:clear":ie},null,8,["modelValue","loading","hint"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:v.category_id,"onUpdate:modelValue":[f[1]||(f[1]=x=>v.category_id=x),C],items:M(J),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:M(g),clearable:"",variant:"outlined"},{"no-data":t(()=>[e(je,null,{default:t(()=>[e(Ye,null,{default:t(()=>[d(r(M(g)?"Memuat kategori...":"Tidak ada kategori"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:v.active,"onUpdate:modelValue":[f[2]||(f[2]=x=>v.active=x),C],items:j,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:v.stock_status,"onUpdate:modelValue":[f[3]||(f[3]=x=>v.stock_status=x),C],items:p,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:v.station,"onUpdate:modelValue":[f[4]||(f[4]=x=>v.station=x),C],items:A,label:"Station",placeholder:"Semua station","prepend-inner-icon":"tabler-tools-kitchen-2",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(E,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:ne})]),_:1})]),_:1}),e(Se,{class:"mt-3"},{default:t(()=>[e($,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:v.min_price,"onUpdate:modelValue":f[5]||(f[5]=x=>v.min_price=x),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:C},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:v.max_price,"onUpdate:modelValue":f[6]||(f[6]=x=>v.max_price=x),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:C},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:v.sort_order,"onUpdate:modelValue":[f[7]||(f[7]=x=>v.sort_order=x),C],items:de,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),ke.value?(m(),X("div",Uo,[o("div",Ao,[e(k,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),f[12]||(f[12]=o("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),o("div",Ho,[y.value?(m(),F(se,{key:0,closable:"",size:"small",color:"coffee","onClick:close":ie},{default:t(()=>[d(" Pencarian: "+r(y.value),1)]),_:1})):W("",!0),v.category_id?(m(),F(se,{key:1,closable:"",size:"small",color:"coffee","onClick:close":f[8]||(f[8]=x=>{v.category_id=null,C()})},{default:t(()=>[d(" Kategori: "+r(Q(v.category_id)),1)]),_:1})):W("",!0),v.active?(m(),F(se,{key:2,closable:"",size:"small",color:"coffee","onClick:close":f[9]||(f[9]=x=>{v.active=null,C()})},{default:t(()=>[d(" Status: "+r(ve(v.active)),1)]),_:1})):W("",!0),v.stock_status?(m(),F(se,{key:3,closable:"",size:"small",color:"coffee","onClick:close":f[10]||(f[10]=x=>{v.stock_status=null,C()})},{default:t(()=>[d(" Stok: "+r(T(v.stock_status)),1)]),_:1})):W("",!0)])])):W("",!0)]),_:1})]),_:1}))}}),Ko=Le(Mo,[["__scopeId","data-v-d0e7ae77"]]),Bo={class:"d-flex align-center gap-2"},Fo={class:"text-h6"},Eo={class:"d-flex align-center gap-2"},Ro={class:"text-h6"},Lo={class:"d-flex align-center gap-2"},qo={class:"text-h6"},No={class:"d-flex align-center gap-2"},Oo={class:"text-h6"},jo={class:"d-flex align-center gap-2"},Jo={class:"text-h6"},Wo={class:"d-flex align-center gap-2"},Go={class:"text-h6"},Qo={class:"d-flex align-center gap-2"},Xo={class:"text-h6"},Zo={class:"d-flex align-center gap-2"},Yo={class:"text-h6"},es=Fe({__name:"ProductStatsCards",props:{stats:{}},setup(S){const ye=z=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(z),q=z=>`${z.toFixed(1)}%`;return(z,J)=>(m(),F(Se,{class:"mb-6"},{default:t(()=>[e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-package"})]),_:1}),o("div",null,[J[0]||(J[0]=o("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),o("div",Bo,[o("h6",Fo,r(((g=z.stats)==null?void 0:g.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-check"})]),_:1}),o("div",null,[J[1]||(J[1]=o("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),o("div",Eo,[o("h6",Ro,r(((g=z.stats)==null?void 0:g.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-star"})]),_:1}),o("div",null,[J[2]||(J[2]=o("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),o("div",Lo,[o("h6",qo,r(((g=z.stats)==null?void 0:g.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-alert-triangle"})]),_:1}),o("div",null,[J[3]||(J[3]=o("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),o("div",No,[o("h6",Oo,r(((g=z.stats)==null?void 0:g.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-currency-dollar"})]),_:1}),o("div",null,[J[4]||(J[4]=o("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),o("div",jo,[o("h6",Jo,r(ye(((g=z.stats)==null?void 0:g.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-chart-line"})]),_:1}),o("div",null,[J[5]||(J[5]=o("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),o("div",Wo,[o("h6",Go,r(ye(((g=z.stats)==null?void 0:g.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-trending-up"})]),_:1}),o("div",null,[J[6]||(J[6]=o("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),o("div",Qo,[o("h6",Xo,r(q(((g=z.stats)==null?void 0:g.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-x-circle"})]),_:1}),o("div",null,[J[7]||(J[7]=o("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),o("div",Zo,[o("h6",Yo,r(((g=z.stats)==null?void 0:g.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),ts=Le(es,[["__scopeId","data-v-124783ae"]]),as={class:"d-flex align-center gap-2"},ls={class:"d-flex align-center gap-2"},os={class:"text-center py-8"},ss={class:"d-flex align-center gap-3 py-2"},is={class:"font-weight-medium"},ns={class:"text-caption text-medium-emphasis"},rs={class:"text-end"},us={class:"font-weight-medium"},ds={class:"text-caption text-medium-emphasis d-flex align-center justify-end gap-1"},cs={class:"text-center profit-margin-container"},ms={class:"text-center"},vs={key:0,class:"text-caption text-medium-emphasis mt-1"},ps={class:"d-flex align-center gap-2"},fs={class:"d-flex gap-2 align-center"},gs={class:"text-body-2"},_s={class:"text-caption text-medium-emphasis"},ks={class:"d-flex align-center gap-1"},bs=300*1e3,ys=1e3,hs=Fe({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","toggle-kitchen","toggle-bar","bulk-delete","update:options","update:selected-products"],setup(S,{expose:ye,emit:q}){const z=S,J=q,{currentHPPBreakdown:g,getProductHPPBreakdown:G}=_t(),U=I({}),y=I({}),v=I({}),j=I(new Set),p=I(new Set);let A=null;const de=P=>{const N=v.value[P];return N?Date.now()-N.timestamp<bs:!1},ke=async()=>{if(p.value.size===0)return;const P=Array.from(p.value);p.value.clear();const N=P.filter(O=>{const K=z.products.find(b=>(b.id_product||b.id)===O);return K&&(K.hpp===void 0||K.hpp===null)});if(N.length===0)return;const h=3;for(let O=0;O<N.length;O+=h){const b=N.slice(O,O+h).map(async i=>{var a;if(!(y.value[i]||de(i))){y.value[i]=!0,j.value.add(i);try{if(await G(i,"latest"),(a=g.value)!=null&&a.total_hpp){const l=g.value.total_hpp;U.value[i]=l,v.value[i]={data:l,timestamp:Date.now(),attempted:!0}}else v.value[i]={data:0,timestamp:Date.now(),attempted:!0}}catch(l){console.warn(`Could not load HPP for product ${i}:`,l),v.value[i]={data:0,timestamp:Date.now(),attempted:!0}}finally{y.value[i]=!1}}});await Promise.all(b),O+h<P.length&&await new Promise(i=>setTimeout(i,500))}},C=P=>{if(de(P)){U.value[P]=v.value[P].data;return}j.value.has(P)||(p.value.add(P),A&&clearTimeout(A),A=setTimeout(()=>{ke()},ys))},ie=()=>{for(const P of z.products){const N=P.id_product||P.id;N&&(de(N)?U.value[N]=v.value[N].data:!j.value.has(N)&&!y.value[N]&&C(N))}},ne=P=>{const N=P.id_product||P.id;return U.value[N]||P.cost||0},Q=P=>{const N=ne(P),h=P.price||0;return h<=0||N<=0?0:Math.round((h-N)/h*100)};ta(()=>{z.products&&z.products.length>0&&ie()}),et(()=>{z.products&&z.products.length>0&&ie()}),ye({refreshHPPData:async P=>{P?(delete v.value[P],delete U.value[P],j.value.delete(P),z.products.find(h=>(h.id_product||h.id)===P)&&C(P)):(v.value={},U.value={},j.value.clear(),p.value.clear(),ie())}});const T=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Station",key:"station_availability",sortable:!1,width:"150px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],_=P=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(P),f=P=>new Date(P).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),x=P=>new Date(P).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),_e=P=>P<10?"error":P<25?"warning":P<50?"success":"info",pe=P=>{J("toggle-kitchen",P)},fe=P=>{J("toggle-bar",P)};return(P,N)=>(m(),F(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",as,[e(k,{icon:"tabler-list",class:"coffee-icon"}),N[5]||(N[5]=d(" Data Produk ")),P.totalItems?(m(),F(se,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[d(r(P.totalItems)+" item ",1)]),_:1})):W("",!0)]),o("div",ls,[P.selectedProducts.length>0?(m(),F(E,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:N[0]||(N[0]=h=>P.$emit("bulk-delete"))},{default:t(()=>[d(" Hapus Terpilih ("+r(P.selectedProducts.length)+") ",1)]),_:1})):W("",!0),e(E,{"prepend-icon":"tabler-plus",color:"coffee",onClick:N[1]||(N[1]=h=>P.$emit("add-product"))},{default:t(()=>N[6]||(N[6]=[d(" Tambah Produk ")])),_:1,__:[6]})])]),_:1}),e(Ue),e($a,{"model-value":P.selectedProducts,"onUpdate:modelValue":N[3]||(N[3]=h=>P.$emit("update:selected-products",h)),headers:T,items:P.products,"items-length":P.totalItems,loading:P.loading,"items-per-page":P.itemsPerPage,page:P.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:options":N[4]||(N[4]=h=>P.$emit("update:options",h))},{loading:t(()=>[e(Sa,{type:"table-row@10"})]),"no-data":t(()=>[o("div",os,[e(k,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),N[8]||(N[8]=o("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),N[9]||(N[9]=o("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(E,{"prepend-icon":"tabler-plus",color:"coffee",onClick:N[2]||(N[2]=h=>P.$emit("add-product"))},{default:t(()=>N[7]||(N[7]=[d(" Tambah Produk Pertama ")])),_:1,__:[7]})])]),"item.name":t(({item:h})=>[o("div",ss,[e($e,{image:h.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[h.image_url?W("",!0):(m(),F(k,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),o("div",null,[o("div",is,r(h.name),1),o("div",ns," SKU: "+r(h.sku||"-"),1)])])]),"item.category":t(({item:h})=>[e(se,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var O;return[d(r(((O=h.category)==null?void 0:O.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:h})=>[o("div",rs,[o("div",us,r(_(h.price)),1),o("div",ds,[o("span",null,"HPP: "+r(_(ne(h))),1),y.value[h.id_product||h.id]&&ne(h)>0?(m(),F(it,{key:0,indeterminate:"",size:"12",width:"2"})):W("",!0)])])]),"item.profit_margin":t(({item:h})=>[o("div",cs,[e(se,{color:_e(Q(h)),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[d(r(Q(h))+"% ",1)]),_:2},1032,["color"])])]),"item.stock":t(({item:h})=>[o("div",ms,[e(se,{color:h.stock_status==="out_of_stock"?"error":h.stock_status==="low_stock"?"warning":"success",size:"small",variant:"tonal"},{default:t(()=>[d(r(h.stock_status==="out_of_stock"?"Habis":h.stock_status==="low_stock"?"Rendah":"Aman"),1)]),_:2},1032,["color"]),h.min_stock?(m(),X("div",vs," Min: "+r(h.min_stock),1)):W("",!0)])]),"item.active":t(({item:h})=>[o("div",ps,[e(se,{color:h.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[d(r(h.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),h.featured?(m(),F(Me,{key:0,text:"Produk Unggulan"},{activator:t(({props:O})=>[e(k,he(O,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):W("",!0)])]),"item.station_availability":t(({item:h})=>[o("div",fs,[e(Me,{location:"top"},{activator:t(({props:O})=>{var K,b,i;return[e(se,he(O,{color:h.available_in_kitchen?"success":"error",variant:"flat",size:"small",class:["station-chip cursor-pointer",{"station-chip-loading":(K=P.toggleLoading)==null?void 0:K[h.id_product]}],onClick:a=>pe(h),loading:((b=P.toggleLoading)==null?void 0:b[h.id_product])||!1,disabled:((i=P.toggleLoading)==null?void 0:i[h.id_product])||!1}),{prepend:t(()=>[e(k,{icon:h.available_in_kitchen?"tabler-check":"tabler-x",size:"14",color:"white"},null,8,["icon"])]),default:t(()=>[N[10]||(N[10]=o("span",{style:{color:"white !important","font-weight":"600 !important"}}," Kitchen ",-1))]),_:2,__:[10]},1040,["color","class","onClick","loading","disabled"])]}),default:t(()=>[o("span",null,r(h.available_in_kitchen?"Tersedia di Kitchen":"Tidak tersedia di Kitchen"),1)]),_:2},1024),e(Me,{location:"top"},{activator:t(({props:O})=>{var K,b,i;return[e(se,he(O,{color:h.available_in_bar?"success":"error",variant:"flat",size:"small",class:["station-chip cursor-pointer",{"station-chip-loading":(K=P.toggleLoading)==null?void 0:K[h.id_product]}],onClick:a=>fe(h),loading:((b=P.toggleLoading)==null?void 0:b[h.id_product])||!1,disabled:((i=P.toggleLoading)==null?void 0:i[h.id_product])||!1}),{prepend:t(()=>[e(k,{icon:h.available_in_bar?"tabler-check":"tabler-x",size:"14",color:"white"},null,8,["icon"])]),default:t(()=>[N[11]||(N[11]=o("span",{style:{color:"white !important","font-weight":"600 !important"}}," Bar ",-1))]),_:2,__:[11]},1040,["color","class","onClick","loading","disabled"])]}),default:t(()=>[o("span",null,r(h.available_in_bar?"Tersedia di Bar":"Tidak tersedia di Bar"),1)]),_:2},1024)])]),"item.created_at":t(({item:h})=>[o("div",gs,r(f(h.created_at??"")),1),o("div",_s,r(x((h==null?void 0:h.created_at)??"")),1)]),"item.actions":t(({item:h})=>[o("div",ks,[e(Me,{text:"Kelola Komposisi"},{activator:t(({props:O})=>[e(E,he(O,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:K=>P.$emit("open-composition-dialog",h)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Kelola Variant"},{activator:t(({props:O})=>[e(E,he(O,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:K=>P.$emit("open-variant-dialog",h)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Edit Produk"},{activator:t(({props:O})=>[e(E,he(O,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:K=>P.$emit("edit-product",h)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:h.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:O})=>{var K;return[e(E,he(O,{icon:h.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:h.active?"success":"error",loading:((K=P.toggleLoading)==null?void 0:K[h.id_product])||!1,onClick:b=>P.$emit("toggle-active",h)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Me,{text:h.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:O})=>[e(E,he(O,{icon:h.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:h.featured?"warning":"default",onClick:K=>P.$emit("toggle-featured",h)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Me,{text:"Hapus Produk"},{activator:t(({props:O})=>[e(E,he(O,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:K=>P.$emit("delete-product",h)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),xs=Le(hs,[["__scopeId","data-v-e3fcb175"]]),ws={class:"d-flex align-center gap-3"},Ps={class:"text-h5 font-weight-bold"},Vs={class:"text-h6"},Cs={class:"text-body-1"},$s={class:"d-flex flex-column"},Ss={class:"font-weight-medium"},Is={class:"text-caption text-grey-darken-1"},Ds={class:"font-weight-medium"},zs={key:0,class:"text-caption"},Ts={key:1,class:"text-grey-lighten-1 text-caption"},Us={class:"v-data-table__footer"},As={class:"pa-4 d-flex justify-space-between align-center"},Hs={class:"text-subtitle-1 font-weight-bold"},Ms={class:"text-subtitle-2 text-uppercase"},Ks={class:"text-h6 font-weight-bold my-2"},Bs={class:"text-caption"},Tt=Fe({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup(S,{emit:ye}){const q=S,z=ye,J=I(!1),g=I(null),G=I(null),U=I(!1),y=I(!1),v=I("latest"),j=I(0),p=I(0),A=I(""),de=I(0),ke=I(!1),C=I(!1),ie=I(""),ne=I(""),Q=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],ve=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],T=K=>!K||K===0?"":new Intl.NumberFormat("id-ID").format(K),_=K=>{if(!K)return 0;const b=K.replace(/[^\d]/g,"");return parseInt(b)||0},f=K=>{var i;const b=_(K);if(p.value=b,A.value=T(b),(i=g.value)!=null&&i.total_hpp&&b>0){const a=g.value.total_hpp;j.value=a>0?Math.round((b-a)/a*100):0}else j.value=0},x=K=>He(K),_e=async(K,b)=>{J.value=!0;try{await new Promise(i=>setTimeout(i,500)),g.value={total_hpp:15e4,method:b,calculated_at:new Date().toISOString(),items:[{item_name:"Tepung Terigu",item_code:"TPNG001",quantity_needed:.5,unit:"kg",cost_per_unit:15e3,total_cost:7500,is_critical:!1,notes:null},{item_name:"Gula Pasir",item_code:"GUL001",quantity_needed:.25,unit:"kg",cost_per_unit:12e3,total_cost:3e3,is_critical:!1,notes:null},{item_name:"Telur Ayam",item_code:"TLR001",quantity_needed:3,unit:"pcs",cost_per_unit:3e3,total_cost:9e3,is_critical:!0,notes:"Price volatile"}]},U.value=!0}catch(i){console.error("Error loading HPP breakdown:",i),U.value=!1}finally{J.value=!1}},pe=async(K,b)=>{J.value=!0;try{if(await new Promise(i=>setTimeout(i,1e3)),g.value){switch(b){case"latest":g.value.total_hpp=Math.round(g.value.total_hpp*1.1);break;case"average":g.value.total_hpp=Math.round(g.value.total_hpp*1.05);break;default:g.value.total_hpp=Math.round(g.value.total_hpp*1.03)}g.value.calculated_at=new Date().toISOString()}}catch(i){throw i}finally{J.value=!1}},fe=async(K,b,i,a,l)=>{J.value=!0;try{return await new Promise(u=>setTimeout(u,1e3)),{data:{new_price:i,markup_percentage:g.value?Math.round((i-g.value.total_hpp)/g.value.total_hpp*100):0}}}catch(u){throw u}finally{J.value=!1}},P=async()=>{var K,b,i;if(q.variantId)try{const a=localStorage.getItem("token"),l=await Ne.get(`/api/variants/${q.variantId}`,{headers:{Authorization:`Bearer ${a}`,Accept:"application/json"}});if(l.data.success&&l.data.data){const u=l.data.data;if(u.price&&u.price>0)p.value=Number(u.price),A.value=T(Number(u.price));else if((K=g.value)!=null&&K.total_hpp){const te=Math.round(g.value.total_hpp*1.2);p.value=te,A.value=T(te)}if((b=g.value)!=null&&b.total_hpp&&p.value>0){const te=g.value.total_hpp;j.value=te>0?Math.round((p.value-te)/te*100):0}de.value+=1}}catch(a){console.warn("Could not load target price, using default:",a),(i=g.value)!=null&&i.total_hpp&&(p.value=Math.round(g.value.total_hpp*1.2))}},N=async()=>{q.variantId&&(await _e(q.variantId,v.value),await P())},h=async()=>{var K,b;if(q.variantId)try{await pe(q.variantId,v.value),ie.value=`HPP successfully updated using ${v.value} method!`,ke.value=!0,z("hpp-updated"),await N()}catch(i){console.error("Error updating HPP:",i),ne.value=((b=(K=i==null?void 0:i.response)==null?void 0:K.data)==null?void 0:b.message)||"Failed to update HPP",C.value=!0}},O=async()=>{var K,b,i,a,l,u,te,L,ce,ze;if(q.variantId&&((K=g.value)!=null&&K.total_hpp)&&p.value)try{const le=await fe(q.variantId,v.value,p.value,!0,!0);if((b=le==null?void 0:le.data)!=null&&b.new_price){if(p.value=le.data.new_price,A.value=T(le.data.new_price),((i=le==null?void 0:le.data)==null?void 0:i.markup_percentage)!==void 0)j.value=le.data.markup_percentage;else{const De=g.value.total_hpp;j.value=De>0?Math.round((le.data.new_price-De)/De*100):0}de.value+=1,await ft()}q.variantId&&await _e(q.variantId,v.value),ie.value=`Price successfully updated to ${x(((a=le==null?void 0:le.data)==null?void 0:a.new_price)||p.value)}!`,ke.value=!0,z("price-updated",{variantId:q.variantId,oldPrice:(l=le==null?void 0:le.data)==null?void 0:l.old_price,newPrice:(u=le==null?void 0:le.data)==null?void 0:u.new_price,hpp:(te=le==null?void 0:le.data)==null?void 0:te.hpp,markupPercentage:(L=le==null?void 0:le.data)==null?void 0:L.markup_percentage})}catch(le){console.error("Error applying price suggestion:",le),ne.value=((ze=(ce=le==null?void 0:le.response)==null?void 0:ce.data)==null?void 0:ze.message)||"Failed to update variant price",C.value=!0}};return Ce(()=>q.modelValue,K=>{K&&q.variantId&&N()}),Ce(()=>q.variantId,K=>{K&&q.modelValue&&N()}),Ce(v,async()=>{q.variantId&&await N()}),Ce([()=>{var K;return(K=g.value)==null?void 0:K.total_hpp},p],()=>{var K;if((K=g.value)!=null&&K.total_hpp&&p.value>0){const b=g.value.total_hpp;j.value=b>0?Math.round((p.value-b)/b*100):0}else j.value=0}),Ce(p,K=>{K!==_(A.value)&&(A.value=T(K))}),(K,b)=>(m(),X(Te,null,[e(Ee,{"model-value":K.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":b[6]||(b[6]=i=>K.$emit("update:modelValue",i))},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",ws,[e(k,{icon:"mdi-calculator-variant",size:"24"}),o("span",null,"HPP Breakdown - "+r(K.variantName||"Variant"),1)]),e(E,{icon:"mdi-close",size:"small",variant:"text",onClick:b[0]||(b[0]=i=>K.$emit("update:modelValue",!1))})]),_:1}),e(ae,null,{default:t(()=>[e(Se,{class:"mb-4"},{default:t(()=>[e($,{cols:"12",md:"6"},{default:t(()=>[e(Be,{modelValue:v.value,"onUpdate:modelValue":[b[1]||(b[1]=i=>v.value=i),N],items:Q,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(E,{color:"primary",variant:"elevated",loading:J.value,"prepend-icon":"mdi-update",block:"",onClick:h},{default:t(()=>[d(" Update HPP with "+r(v.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),U.value?(m(),F(ee,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(ae,null,{default:t(()=>[e(Se,{align:"center"},{default:t(()=>[e($,{cols:"12",md:"4"},{default:t(()=>{var i;return[b[11]||(b[11]=o("div",{class:"text-subtitle-2"}," Total HPP ",-1)),o("div",Ps,r(x(((i=g.value)==null?void 0:i.total_hpp)||0)),1)]}),_:1,__:[11]}),e($,{cols:"12",md:"4"},{default:t(()=>{var i;return[b[12]||(b[12]=o("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),o("div",Vs,r((i=Q.find(a=>{var l;return a.value===((l=g.value)==null?void 0:l.method)}))==null?void 0:i.title),1)]}),_:1,__:[12]}),e($,{cols:"12",md:"4"},{default:t(()=>{var i;return[b[13]||(b[13]=o("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),o("div",Cs,r((i=g.value)!=null&&i.calculated_at?new Date(g.value.calculated_at).toLocaleString():"-"),1)]}),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):W("",!0),U.value?(m(),F(ee,{key:1},{default:t(()=>{var i;return[e(we,null,{default:t(()=>{var a,l;return[e(k,{icon:"mdi-format-list-bulleted",class:"me-2"}),d(" Item Breakdown ("+r(((l=(a=g.value)==null?void 0:a.items)==null?void 0:l.length)||0)+" items) ",1)]}),_:1}),e(va,{headers:ve,items:((i=g.value)==null?void 0:i.items)||[],"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:a})=>[o("div",$s,[o("span",Ss,r(a.item_name),1),o("span",Is,r(a.item_code),1)])]),"item.quantity_needed":t(({item:a})=>[o("span",Ds,r(a.quantity_needed)+" "+r(a.unit),1)]),"item.cost_per_unit":t(({item:a})=>[o("span",null,r(x(a.cost_per_unit)),1)]),"item.total_cost":t(({item:a})=>[e(se,{color:a.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[d(r(x(a.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:a})=>[e(se,{color:a.is_critical?"error":"success","prepend-icon":a.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[d(r(a.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:a})=>[a.notes?(m(),X("span",zs,r(a.notes),1)):(m(),X("span",Ts,"—"))]),bottom:t(()=>{var a;return[o("div",Us,[e(Ue),o("div",As,[o("div",Hs," Total HPP: "+r(x(((a=g.value)==null?void 0:a.total_hpp)||0)),1),e(se,{color:"info",variant:"elevated"},{default:t(()=>{var l,u;return[d(r(((u=(l=g.value)==null?void 0:l.items)==null?void 0:u.length)||0)+" items ",1)]}),_:1})])])]}),_:1},8,["items"])]}),_:1})):W("",!0),U.value?(m(),F(ee,{key:2,class:"mt-4"},{default:t(()=>[e(we,null,{default:t(()=>[e(k,{icon:"mdi-cash-multiple",class:"me-2"}),b[14]||(b[14]=d(" Price Suggestion "))]),_:1,__:[14]}),e(ae,null,{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12",md:"6"},{default:t(()=>{var i;return[(m(),F(xe,{key:de.value,modelValue:A.value,"onUpdate:modelValue":[b[2]||(b[2]=a=>A.value=a),f],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${x(((i=g.value)==null?void 0:i.total_hpp)||0)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>{var i;return[(m(),F(xe,{key:de.value,modelValue:j.value,"onUpdate:modelValue":b[3]||(b[3]=a=>j.value=a),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${x(p.value-(((i=g.value)==null?void 0:i.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e(Se,{class:"mt-2"},{default:t(()=>[e($,{cols:"12",md:"12"},{default:t(()=>[e(E,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:J.value,disabled:!p.value||p.value<=0,block:"",onClick:O},{default:t(()=>b[15]||(b[15]=[d(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):W("",!0),y.value?(m(),F(ee,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(we,null,{default:t(()=>[e(k,{icon:"mdi-lightbulb",class:"me-2"}),b[16]||(b[16]=d(" Price Suggestions "))]),_:1,__:[16]}),e(ae,null,{default:t(()=>[e(Se,null,{default:t(()=>[(m(!0),X(Te,null,We(G.value.suggestions,(i,a)=>(m(),F($,{key:a,cols:"12",md:"4"},{default:t(()=>[e(ee,{variant:"elevated"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[o("div",Ms,r(a)+" Method ",1),o("div",Ks,r(x(i.suggested_price)),1),o("div",Bs,[d(" HPP: "+r(x(i.hpp)),1),b[17]||(b[17]=o("br",null,null,-1)),d(" Markup: "+r(i.markup_percentage.toFixed(1))+"%",1),b[18]||(b[18]=o("br",null,null,-1)),d(" Margin: "+r(i.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):W("",!0),!U.value&&!J.value?(m(),F(ee,{key:4,variant:"outlined"},{default:t(()=>[e(ae,{class:"text-center py-8"},{default:t(()=>[e(k,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),b[20]||(b[20]=o("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),b[21]||(b[21]=o("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(E,{color:"primary","prepend-icon":"mdi-plus",onClick:b[4]||(b[4]=i=>K.$emit("update:modelValue",!1))},{default:t(()=>b[19]||(b[19]=[d(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):W("",!0)]),_:1}),e(Re,{class:"pa-4"},{default:t(()=>[e(Oe),e(E,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:b[5]||(b[5]=i=>K.$emit("update:modelValue",!1))},{default:t(()=>b[22]||(b[22]=[d(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(at,{modelValue:ke.value,"onUpdate:modelValue":b[8]||(b[8]=i=>ke.value=i),color:"success",location:"top"},{actions:t(()=>[e(E,{color:"white",variant:"text",onClick:b[7]||(b[7]=i=>ke.value=!1)},{default:t(()=>b[23]||(b[23]=[d(" Close ")])),_:1,__:[23]})]),default:t(()=>[d(r(ie.value)+" ",1)]),_:1},8,["modelValue"]),e(at,{modelValue:C.value,"onUpdate:modelValue":b[10]||(b[10]=i=>C.value=i),color:"error",location:"top"},{actions:t(()=>[e(E,{color:"white",variant:"text",onClick:b[9]||(b[9]=i=>C.value=!1)},{default:t(()=>b[24]||(b[24]=[d(" Close ")])),_:1,__:[24]})]),default:t(()=>[d(r(ne.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),Fs={class:"d-flex align-center gap-2"},Es={class:"pa-4",style:{"background-color":"#2A2A2A"}},Rs={key:0,class:"d-flex align-center gap-3"},Ls={class:"text-h6 text-white font-weight-bold"},qs={class:"d-flex align-center gap-4 mt-1"},Ns={class:"text-caption text-grey-lighten-1"},Os={class:"text-caption text-grey-lighten-1"},js={class:"pa-4 add-item-form"},Js={class:"d-flex align-center justify-space-between mb-4"},Ws={class:"d-flex align-center gap-2"},Gs={class:"text-h6"},Qs={key:0,class:"text-error"},Xs={key:1},Zs={class:"d-flex align-center"},Ys={class:"pa-4 text-center"},ei={class:"pa-4 pt-0"},ti={class:"d-flex align-center justify-between mb-4"},ai={class:"text-h6"},li={key:0,class:"composition-list"},oi={class:"d-flex align-center justify-between"},si={class:"d-flex align-center gap-3"},ii={class:"font-weight-medium"},ni={class:"text-caption text-medium-emphasis"},ri={class:"font-weight-medium text-primary"},ui={class:"d-flex align-center gap-2"},di={class:"text-center"},ci={key:0,class:"text-body-2 text-medium-emphasis"},mi={class:"text-center"},vi={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},pi=Fe({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup(S,{emit:ye}){const q=S,z=ye,J=I(),g=I(!1),G=I(!1),U=I([]),y=I([]),v=I(!1),j=I(null),p=I(!1),A=I(null),de=I(!1),ke=I(!1),C=I(""),ie=I(""),ne=I("success"),Q=I(!1),ve=me({get:()=>q.modelValue,set:n=>{z("update:modelValue",n)}}),T=()=>({item_id:null,quantity:1,is_critical:!1}),_=I(T()),f=me(()=>!_.value.item_id||!Array.isArray(U.value)?null:U.value.find(n=>n.id_item===_.value.item_id)),x=me(()=>!f.value||v.value&&j.value!==null?null:y.value.find(n=>{var s,w;return n.name===((s=f.value)==null?void 0:s.name)||n.id&&((w=f.value)==null?void 0:w.id_item)&&n.id===f.value.id_item})),_e=me(()=>{if(!f.value)return"";if(v.value&&j.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(x.value){const n=x.value;return`Item sudah ada dengan quantity ${n.quantity} ${n.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${fe(f.value)} ${f.value.unit}`}),pe=me(()=>Array.isArray(U.value)?U.value.filter(n=>fe(n)>0):[]),fe=n=>{var s,w;return((s=n.inventory)==null?void 0:s.current_stock)||((w=n.inventory)==null?void 0:w.available_stock)||n.current_stock||0},P=()=>G.value?"Memuat items...":!U.value||U.value.length===0?"Tidak ada item tersedia":pe.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",N=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),h=n=>{switch(n){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},O=n=>{switch(n){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},K=(n,s,w)=>{var V,re,ue,oe,Pe,be,Ve,qe;if(!s)return!0;const B=s.toLowerCase().trim(),R=((re=(V=w==null?void 0:w.raw)==null?void 0:V.name)==null?void 0:re.toLowerCase())||"",c=((oe=(ue=w==null?void 0:w.raw)==null?void 0:ue.item_code)==null?void 0:oe.toLowerCase())||"",H=((be=(Pe=w==null?void 0:w.raw)==null?void 0:Pe.unit)==null?void 0:be.toLowerCase())||"",Y=((qe=(Ve=w==null?void 0:w.raw)==null?void 0:Ve.description)==null?void 0:qe.toLowerCase())||"";return R.includes(B)||c.includes(B)||H.includes(B)||Y.includes(B)},b=async()=>{var n,s,w;G.value=!0;try{const B=await Ne.get("/api/items?per_page=all&include=inventory"),R=((s=(n=B.data)==null?void 0:n.data)==null?void 0:s.data)||((w=B.data)==null?void 0:w.data)||B.data||[];U.value=Array.isArray(R)?R:[]}catch(B){console.error("Error loading items:",B),B!=null&&B.response&&(console.error("API Error Status:",B.response.status),console.error("API Error Data:",B.response.data)),U.value=[]}finally{G.value=!1}},i=async()=>{var n,s,w,B,R;if(!(!((n=q.variant)!=null&&n.id)&&!((s=q.variant)!=null&&s.id_variant)))try{const c=q.variant.id||q.variant.id_variant,H=await Ne.get(`/api/variant-items/variant/${c}`),Y=((B=(w=H.data)==null?void 0:w.data)==null?void 0:B.composition)||((R=H.data)==null?void 0:R.composition)||[];if(!Array.isArray(Y)){console.warn("API response composition is not an array:",Y),y.value=[];return}y.value=Y.map(V=>{var re,ue,oe,Pe,be,Ve,qe,Xe,rt,ut;return{id:V.id_variant_item||V.id,name:((re=V.item)==null?void 0:re.name)||V.name,quantity:parseFloat(V.quantity_needed||V.quantity||V.qty||"1"),unit:V.unit||((ue=V.item)==null?void 0:ue.unit)||"pcs",stock:((Pe=(oe=V.item)==null?void 0:oe.inventory)==null?void 0:Pe.current_stock)||((Ve=(be=V.item)==null?void 0:be.inventory)==null?void 0:Ve.available_stock)||((qe=V.item)==null?void 0:qe.current_stock)||V.stock||0,price:parseFloat(((Xe=V.item)==null?void 0:Xe.cost_per_unit)||((rt=V.item)==null?void 0:rt.price)||V.price||"0"),is_critical:V.is_critical||!1,inventory:(ut=V.item)!=null&&ut.inventory?{current_stock:V.item.inventory.current_stock||0,available_stock:V.item.inventory.available_stock||0,stock_status:V.item.inventory.stock_status||"unknown",reorder_level:V.item.inventory.reorder_level||0}:null}})}catch(c){console.error("Error loading composition items:",c),c!=null&&c.response&&(console.error("API Error Status:",c.response.status),console.error("API Error Data:",c.response.data)),y.value=[]}},a=async()=>{var R,c;const{valid:n}=await J.value.validate();if(!n||!f.value)return;const s=f.value.name,w=f.value.id_item,B=_.value.quantity;if(v.value&&j.value!==null)y.value[j.value].quantity,y.value[j.value].quantity=B,y.value[j.value].is_critical=_.value.is_critical,v.value=!1,j.value=null;else{const H=y.value.findIndex(Y=>Y.name===s||Y.id&&w&&Y.id===w);if(H!==-1){const re=y.value[H].quantity+B;y.value[H].quantity=re}else{const Y={name:s,quantity:B,unit:f.value.unit,stock:((R=f.value.inventory)==null?void 0:R.current_stock)||((c=f.value.inventory)==null?void 0:c.available_stock)||f.value.current_stock||0,price:f.value.cost_per_unit||0,is_critical:_.value.is_critical,inventory:f.value.inventory?{current_stock:f.value.inventory.current_stock||0,available_stock:f.value.inventory.available_stock||0,stock_status:f.value.inventory.stock_status||"unknown",reorder_level:f.value.inventory.reorder_level||0}:null};y.value.push(Y)}}_.value=T()},l=(n,s)=>{const w=U.value.find(B=>B.name===n.name||B.id_item===n.id);w?(v.value=!0,j.value=s,_.value={item_id:w.id_item,quantity:n.quantity,is_critical:n.is_critical||!1},setTimeout(()=>{const B=document.querySelector(".add-item-form");B&&B.scrollIntoView({behavior:"smooth",block:"start"})},100)):console.error("❌ Could not find item in available items")},u=()=>{v.value=!1,j.value=null,_.value=T()},te=(n,s)=>{A.value={item:n,index:s},p.value=!0},L=async()=>{var B,R,c;if(!A.value)return;const{item:n,index:s}=A.value;n.name;const w=n.id;de.value=!0;try{w&&await Ne.delete(`/api/variant-items/${w}`),p.value=!1,A.value=null,await i(),z("save")}catch(H){console.error("❌ Error deleting item:",H),console.error("❌ Error details:",(B=H.response)==null?void 0:B.data),alert("Gagal menghapus item: "+(((c=(R=H.response)==null?void 0:R.data)==null?void 0:c.message)||H.message))}finally{de.value=!1}},ce=()=>{p.value=!1,A.value=null},ze=()=>{switch(ne.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},le=()=>{switch(ne.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},De=()=>{switch(ne.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},Ae=()=>{switch(ne.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Qe=async()=>{var n,s,w,B;if(!((n=q.variant)!=null&&n.id)&&!((s=q.variant)!=null&&s.id_variant)){console.error("No variant ID found");return}g.value=!0;try{const R=q.variant.id||q.variant.id_variant;if(y.value.some(H=>H.id)){const H={items:y.value.map(V=>{const re=U.value.find(ue=>ue.name===V.name);return{id_variant_item:V.id,quantity_needed:Number(V.quantity),unit:V.unit,is_critical:V.is_critical||!1}}).filter(V=>V.id_variant_item&&V.quantity_needed>0)},Y=await Ne.post("/api/variant-items/bulk-update",H)}else{const H={id_variant:R,items:y.value.map(V=>{const re=U.value.find(ue=>ue.name===V.name);return{id_item:re==null?void 0:re.id_item,quantity_needed:Number(V.quantity),unit:V.unit,is_critical:V.is_critical||!1}}).filter(V=>V.id_item&&V.quantity_needed>0)},Y=await Ne.post("/api/variant-items/bulk-store",H)}z("save"),D()}catch(R){console.error("Error saving composition:",R),alert("Gagal menyimpan komposisi: "+(((B=(w=R.response)==null?void 0:w.data)==null?void 0:B.message)||R.message))}finally{g.value=!1}},Je=()=>{Q.value=!0},D=()=>{ve.value=!1,_.value=T(),y.value=[],v.value=!1,j.value=null};return Ce(()=>q.modelValue,n=>{n?(_.value=T(),b(),i()):(v.value=!1,j.value=null)}),Ce(()=>_.value.item_id,n=>{n&&f.value}),et(()=>{b()}),(n,s)=>{var w,B,R;return m(),X(Te,null,[e(Ee,{modelValue:ve.value,"onUpdate:modelValue":s[3]||(s[3]=c=>ve.value=c),"max-width":"1000px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[o("div",Fs,[e(k,{icon:"mdi-delete",color:"white"}),s[9]||(s[9]=o("span",null,"Kelola Komposisi Item",-1))]),e(E,{icon:"mdi-close",variant:"text",color:"white",onClick:D,disabled:g.value},null,8,["disabled"])]),_:1}),e(ae,{class:"pa-0"},{default:t(()=>[o("div",Es,[n.variant?(m(),X("div",Rs,[e(k,{icon:"mdi-coffee",size:"32",color:"white"}),o("div",null,[o("h3",Ls,r(n.variant.name),1),o("div",qs,[o("span",Ns,"SKU: "+r(n.variant.sku),1),o("span",Os,"Harga: "+r(N(n.variant.price||0)),1),e(se,{color:"success",size:"small",variant:"tonal"},{default:t(()=>s[10]||(s[10]=[d(" Stok Aman ")])),_:1,__:[10]})])])])):W("",!0)]),o("div",js,[o("div",Js,[o("div",Ws,[e(k,{icon:"mdi-plus-circle",color:"success"}),o("h4",Gs,r(v.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(yt,{ref_key:"form",ref:J,onSubmit:kt(a,["prevent"])},{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12",md:"4"},{default:t(()=>[e(bt,{modelValue:_.value.item_id,"onUpdate:modelValue":s[0]||(s[0]=c=>_.value.item_id=c),items:pe.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[c=>!!c||"Item wajib dipilih"],loading:G.value,disabled:G.value||U.value&&U.value.length===0,"no-data-text":P(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":K},{"prepend-inner":t(()=>[e(k,{icon:"mdi-package",size:"16"})]),item:t(({props:c,item:H})=>[e(je,he(c,{title:H.raw.name,disabled:fe(H.raw)<=0,class:["pa-3",{"text-disabled":fe(H.raw)<=0}]}),{prepend:t(()=>[e(k,{icon:"mdi-package-variant",color:fe(H.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[o("div",{class:Ge(["text-caption",fe(H.raw)<=0?"text-disabled":"text-medium-emphasis"])},[fe(H.raw)<=0?(m(),X("span",Qs,[e(k,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),s[11]||(s[11]=d(" Stok Habis "))])):(m(),X("span",Xs," Stok: "+r(fe(H.raw))+" "+r(H.raw.unit),1))],2)]),append:t(()=>{var Y;return[fe(H.raw)>0?(m(),F(se,{key:0,size:"x-small",color:h(((Y=H.raw.inventory)==null?void 0:Y.stock_status)||H.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var V;return[d(r(O(((V=H.raw.inventory)==null?void 0:V.stock_status)||H.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(m(),F(se,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>s[12]||(s[12]=[d(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:c})=>[o("div",Zs,[e(k,{icon:"mdi-package-variant",size:"16",class:"me-2"}),o("span",null,r(c.raw.name),1)])]),"no-data":t(()=>[o("div",Ys,[e(k,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),s[13]||(s[13]=o("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),s[14]||(s[14]=o("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:_.value.quantity,"onUpdate:modelValue":s[1]||(s[1]=c=>_.value.quantity=c),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[c=>!!c||"Jumlah wajib diisi",c=>c>0||"Jumlah harus lebih dari 0"],hint:_e.value,"persistent-hint":"",color:x.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>{var c;return[e(xe,{"model-value":((c=f.value)==null?void 0:c.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!f.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e(k,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e($,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(Ze,{modelValue:_.value.is_critical,"onUpdate:modelValue":s[2]||(s[2]=c=>_.value.is_critical=c),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(E,{color:v.value?"primary":x.value?"warning":"#D4A574",onClick:a,loading:g.value,disabled:!_.value.item_id||!_.value.quantity,block:""},{default:t(()=>[e(k,{icon:v.value?"mdi-content-save":x.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),d(" "+r(v.value?"Update":x.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),v.value?(m(),F(E,{key:0,color:"grey",variant:"outlined",onClick:u,size:"small",block:""},{default:t(()=>[e(k,{icon:"mdi-close",class:"me-1"}),s[15]||(s[15]=d(" Batal "))]),_:1,__:[15]})):W("",!0)]),_:1})]),_:1})]),_:1},512)]),o("div",ei,[o("div",ti,[o("h4",ai,"Daftar Item Komposisi ("+r(y.value.length)+")",1)]),y.value.length>0?(m(),X("div",li,[(m(!0),X(Te,null,We(y.value,(c,H)=>(m(),F(ee,{key:H,variant:"outlined",class:"mb-3"},{default:t(()=>[e(ae,{class:"pa-3"},{default:t(()=>{var Y,V,re,ue,oe,Pe,be;return[o("div",oi,[o("div",si,[e(k,{icon:"mdi-check-circle",color:"success"}),o("div",null,[o("div",ii,r(c.name),1),o("div",ni,[o("span",ri,"Dibutuhkan: "+r(c.quantity)+" "+r(c.unit),1),s[16]||(s[16]=d(" • ")),o("span",{class:Ge({"text-success":(((Y=c.inventory)==null?void 0:Y.current_stock)??0)>(((V=c.inventory)==null?void 0:V.reorder_level)??0),"text-warning":(((re=c.inventory)==null?void 0:re.current_stock)??0)<=(((ue=c.inventory)==null?void 0:ue.reorder_level)??0)&&(((oe=c.inventory)==null?void 0:oe.current_stock)??0)>0,"text-error":(((Pe=c.inventory)==null?void 0:Pe.current_stock)??0)<=0})}," Stok: "+r(((be=c.inventory)==null?void 0:be.current_stock)||c.stock||0)+" "+r(c.unit),3),d(" • "+r(N(c.price)),1)])])]),o("div",ui,[e(E,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:Ve=>l(c,H)},null,8,["onClick"]),e(E,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Ve=>te(c,H)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(m(),F(ee,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e(k,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),s[17]||(s[17]=o("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(Re,{class:"px-6 pb-6"},{default:t(()=>[e(E,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:Je},{default:t(()=>s[18]||(s[18]=[d(" Setting HPP ")])),_:1,__:[18]}),e(Oe),e(E,{variant:"outlined",onClick:D,disabled:g.value},{default:t(()=>s[19]||(s[19]=[d(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(E,{color:"#D4A574",onClick:Qe,loading:g.value,disabled:y.value.length===0},{default:t(()=>s[20]||(s[20]=[d(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Tt,{modelValue:Q.value,"onUpdate:modelValue":s[4]||(s[4]=c=>Q.value=c),"variant-id":((w=n.variant)==null?void 0:w.id)||((B=n.variant)==null?void 0:B.id_variant),"variant-name":(R=n.variant)==null?void 0:R.name,onHppUpdated:s[5]||(s[5]=c=>z("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Ee,{modelValue:p.value,"onUpdate:modelValue":s[6]||(s[6]=c=>p.value=c),"max-width":"400px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e(k,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),s[21]||(s[21]=d(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(Ue),e(ae,{class:"pa-6"},{default:t(()=>[o("div",di,[e(k,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),s[24]||(s[24]=o("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),A.value?(m(),X("div",ci,[o("strong",null,r(A.value.item.name),1),s[22]||(s[22]=o("br",null,null,-1)),d(" Dibutuhkan: "+r(A.value.item.quantity)+" "+r(A.value.item.unit),1)])):W("",!0),e(Ke,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>s[23]||(s[23]=[o("strong",null,"Perhatian:",-1),d(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(Re,{class:"px-6 pb-6"},{default:t(()=>[e(E,{variant:"outlined",onClick:ce,disabled:de.value,class:"flex-grow-1"},{default:t(()=>s[25]||(s[25]=[d(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(E,{color:"error",onClick:L,loading:de.value,class:"flex-grow-1"},{default:t(()=>s[26]||(s[26]=[d(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ee,{modelValue:ke.value,"onUpdate:modelValue":s[8]||(s[8]=c=>ke.value=c),"max-width":"450px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:Ge(["d-flex align-center justify-center text-h6",De()])},{default:t(()=>[e(k,{icon:ze(),color:le(),class:"me-2",size:"24"},null,8,["icon","color"]),d(" "+r(ie.value),1)]),_:1},8,["class"]),e(Ue),e(ae,{class:"pa-6"},{default:t(()=>[o("div",mi,[e(k,{icon:ze(),color:le(),size:"64",class:"mb-4"},null,8,["icon","color"]),o("div",vi,r(C.value),1),e(Ke,{type:ne.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[ne.value==="success"?(m(),X(Te,{key:0},[s[27]||(s[27]=o("strong",null,"Berhasil!",-1)),s[28]||(s[28]=d(" Perubahan telah disimpan. "))],64)):ne.value==="info"?(m(),X(Te,{key:1},[s[29]||(s[29]=o("strong",null,"Informasi:",-1)),s[30]||(s[30]=d(" Item telah diperbarui sesuai permintaan. "))],64)):(m(),X(Te,{key:2},[s[31]||(s[31]=o("strong",null,"Perhatian:",-1)),s[32]||(s[32]=d(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(Re,{class:"px-6 pb-6"},{default:t(()=>[e(Oe),e(E,{color:Ae(),onClick:s[7]||(s[7]=c=>ke.value=!1),class:"px-6"},{default:t(()=>[e(k,{icon:"mdi-check",class:"me-1"}),s[33]||(s[33]=d(" OK "))]),_:1,__:[33]},8,["color"]),e(Oe)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),fi=Le(pi,[["__scopeId","data-v-d2ce0c17"]]),gi={class:"d-flex align-center gap-2"},_i={class:"mt-2"},ki={key:0,class:"mt-1 font-weight-medium"},bi={key:1,class:"mt-1 text-warning"},yi=Fe({__name:"CreateVariantDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save"],setup(S,{emit:ye}){const q=S,z=ye,J=I(),g=I(!1),G=I(!1),U=I([]),y=I({name:"",selectedProduct:null,selectedProductId:null,active:!0}),v=[T=>!!T||"Nama variant wajib diisi",T=>T.length>=3||"Nama variant minimal 3 karakter"],j=[T=>!!T||"Produk wajib dipilih"],p=(T,_="success")=>{const f=document.createElement("div");f.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${_==="success"?"#4CAF50":"#f44336"};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 9999;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
  `;const x=document.createElement("span");if(x.innerHTML=_==="success"?"✓":"✕",x.style.cssText=`
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    font-weight: bold;
  `,f.appendChild(x),f.appendChild(document.createTextNode(T)),!document.querySelector("#snackbar-styles")){const _e=document.createElement("style");_e.id="snackbar-styles",_e.textContent=`
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `,document.head.appendChild(_e)}document.body.appendChild(f),setTimeout(()=>{f.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{f.parentNode&&f.parentNode.removeChild(f)},300)},3e3)},A=async()=>{G.value=!0;try{const T=await Ne.get("/api/products");U.value=T.data.data||T.data||[]}catch(T){console.error("Gagal mengambil data produk:",T),U.value=[]}finally{G.value=!1}},de=T=>{!T&&U.value.length===0&&A()},ke=T=>{y.value.selectedProduct=T,T?y.value.selectedProductId=T.id:y.value.selectedProductId=null},C=me(()=>y.value.selectedProduct?y.value.selectedProduct:y.value.selectedProductId&&U.value.length>0?U.value.find(_=>_.id===y.value.selectedProductId):null),ie=()=>{const T=C.value;if(!T||!y.value.name)return"";const _=T.sku||"PROD",f=y.value.name.replace(/\s+/g,"").toUpperCase().substring(0,3),x=Date.now().toString().slice(-4);return`${_}-${f}-${x}`},ne=async()=>{var f,x;if(g.value)return;const{valid:T}=await J.value.validate();if(!T)return;const _=C.value;if(!_){p("Produk tidak ditemukan","error");return}if(!_.id&&!_.id_product){p("ID Produk tidak valid","error"),console.error("Product missing ID:",_);return}g.value=!0;try{const _e={id_product:_.id||_.id_product,name:y.value.name,sku:ie(),price:0,cost_price:null,barcode:null,variant_values:[],active:y.value.active},pe=await Ne.post("/api/variants",_e);if(pe.data.success!==!1&&(pe.status===200||pe.status===201))p("Variant berhasil dibuat!","success"),z("save"),ve();else throw new Error(pe.data.message||"Gagal membuat variant")}catch(_e){const pe=((x=(f=_e.response)==null?void 0:f.data)==null?void 0:x.message)||_e.message||"Gagal membuat variant";p(pe,"error"),console.error("Save variant error:",_e)}finally{g.value=!1}},Q=()=>{var T;y.value={name:"",selectedProduct:null,selectedProductId:null,active:!0},(T=J.value)==null||T.resetValidation()},ve=()=>{z("update:modelValue",!1),Q()};return Ce(()=>q.modelValue,T=>{T&&(Q(),A())}),(T,_)=>(m(),F(Ee,{"model-value":T.modelValue,"onUpdate:modelValue":_[3]||(_[3]=f=>T.$emit("update:modelValue",f)),"max-width":"600px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"bg-primary text-white"},{default:t(()=>[e(k,{icon:"mdi-plus-circle",class:"me-2"}),_[4]||(_[4]=d(" Tambah Variant Baru ")),e(Oe),e(E,{icon:"mdi-close",variant:"text",color:"white",onClick:ve})]),_:1,__:[4]}),e(yt,{ref_key:"formRef",ref:J,onSubmit:kt(ne,["prevent"])},{default:t(()=>[e(ae,{class:"pa-6"},{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12"},{default:t(()=>[e(bt,{modelValue:y.value.selectedProduct,"onUpdate:modelValue":[_[0]||(_[0]=f=>y.value.selectedProduct=f),ke],items:U.value,loading:G.value,"item-title":"name","return-object":"",label:"Pilih Produk *",placeholder:"Cari produk...",variant:"outlined",rules:j,required:"","no-data-text":"Tidak ada produk ditemukan","onUpdate:search":de},{item:t(({props:f,item:x})=>[e(je,aa(la(f)),{prepend:t(()=>[e($e,{image:x.raw.image_url,size:"40"},{default:t(()=>[x.raw.image_url?W("",!0):(m(),F(k,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"])]),default:t(()=>[e(Ye,null,{default:t(()=>[d(r(x.raw.name),1)]),_:2},1024),e(tt,null,{default:t(()=>[d("SKU: "+r(x.raw.sku||"-"),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:f})=>[o("div",gi,[e($e,{image:f.raw.image_url,size:"24"},{default:t(()=>[f.raw.image_url?W("",!0):(m(),F(k,{key:0,icon:"mdi-coffee",size:"16"}))]),_:2},1032,["image"]),o("span",null,r(f.raw.name),1)])]),_:1},8,["modelValue","items","loading"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(xe,{modelValue:y.value.name,"onUpdate:modelValue":_[1]||(_[1]=f=>y.value.name=f),label:"Nama Variant *",placeholder:"Contoh: Large Hot, Medium Cold, dll",variant:"outlined",rules:v,required:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ke,{color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ct,null,{default:t(()=>[e(k,{icon:"mdi-information",class:"me-2"}),_[5]||(_[5]=d(" SKU Otomatis "))]),_:1,__:[5]}),o("div",_i,[_[6]||(_[6]=d(" SKU variant akan dibuat otomatis berdasarkan nama produk dan variant ")),y.value.name&&(y.value.selectedProduct||y.value.selectedProductId)?(m(),X("div",ki," Preview SKU: "+r(ie()),1)):y.value.name&&!y.value.selectedProduct&&!y.value.selectedProductId?(m(),X("div",bi," Pilih produk terlebih dahulu untuk melihat preview SKU ")):W("",!0)])]),_:1})]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ze,{modelValue:y.value.active,"onUpdate:modelValue":_[2]||(_[2]=f=>y.value.active=f),label:"Variant Aktif",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Ue),e(Re,{class:"pa-6"},{default:t(()=>[e(Oe),e(E,{variant:"outlined",onClick:ve,disabled:g.value},{default:t(()=>_[7]||(_[7]=[d(" Batal ")])),_:1,__:[7]},8,["disabled"]),e(E,{type:"submit",color:"primary",loading:g.value},{default:t(()=>_[8]||(_[8]=[d(" Simpan Variant ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),hi=Le(yi,[["__scopeId","data-v-5477c365"]]),xi={class:"product-variant-tab"},wi={class:"d-flex gap-2"},Pi={key:0,class:"mt-4 d-flex align-center gap-2"},Vi={key:1,class:"text-center pa-12"},Ci={key:2,class:"text-center pa-12"},$i={class:"d-flex align-center gap-3"},Si={class:"flex-grow-1 min-width-0"},Ii={class:"text-h6 font-weight-bold text-truncate"},Di={class:"text-body-2 text-medium-emphasis mb-0"},zi={class:"d-flex flex-column gap-1"},Ti={class:"text-xs"},Ui={class:"d-flex align-center gap-2"},Ai={class:"text-primary font-weight-medium"},Hi={class:"d-flex gap-1"},Mi={class:"d-flex align-center justify-space-between w-100"},Ki={class:"d-flex gap-1"},Bi=Fe({__name:"ProductVariantTab",props:{loading:{type:Boolean}},emits:["refresh"],setup(S,{emit:ye}){const q=ye,z=I(!1),J=I([]),g=I(!1),G=I(!1),U=I(null),y=I(!1),v=I(!1),j=I(!1),p=I({search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}),A=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],de=[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Variant Terbanyak",value:"variants_desc"},{title:"Variant Tersedikit",value:"variants_asc"}],ke=me(()=>!!(p.value.search||p.value.stockStatus||p.value.activeStatus!==null||p.value.sortBy!=="name_asc")),C=me(()=>{const i={};return J.value.forEach(a=>{const l=a.id_product;i[l]||(i[l]={product:a.product||{id:a.id_product,id_product:a.id_product,name:`Product ${a.id_product}`,sku:""},variants:[]}),i[l].variants.push(a)}),Object.values(i)}),ie=me(()=>{let i=[...C.value];if(p.value.search){const a=p.value.search.toLowerCase();i=i.filter(l=>{var u;return l.product.name.toLowerCase().includes(a)||((u=l.product.sku)==null?void 0:u.toLowerCase().includes(a))||l.variants.some(te=>te.name.toLowerCase().includes(a)||te.sku.toLowerCase().includes(a))})}switch(p.value.stockStatus&&(i=i.filter(a=>a.variants.some(l=>{var te;return(((te=l.composition_summary)==null?void 0:te.stock_status)||"safe")===p.value.stockStatus}))),p.value.activeStatus!==null&&(i=i.filter(a=>a.variants.some(l=>l.is_active===p.value.activeStatus))),p.value.sortBy){case"name_asc":i.sort((a,l)=>a.product.name.localeCompare(l.product.name));break;case"name_desc":i.sort((a,l)=>l.product.name.localeCompare(a.product.name));break;case"variants_desc":i.sort((a,l)=>l.variants.length-a.variants.length);break;case"variants_asc":i.sort((a,l)=>a.variants.length-l.variants.length);break}return i}),ne=(i,a="success")=>{},Q=async i=>{try{const a=J.value.findIndex(l=>l.id_variant===i.variantId);a!==-1&&(J.value[a]={...J.value[a],price:i.newPrice,cost:i.hpp}),ne(`Price updated to ${new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(i.newPrice)}`,"success")}catch(a){console.error("Error handling price update:",a),await ve()}},ve=async()=>{var i,a,l;z.value=!0;try{const u=await Ne.get("/api/variants",{params:{per_page:1e3,with_product:!0,with_composition:!0}});if(u.data.success===!1)throw new Error(u.data.message||"Failed to load variants");const te=((i=u.data.data)==null?void 0:i.data)||u.data.data||[];J.value=te.map(L=>({...L,is_active:L.active!==void 0?L.active:L.is_active,id:L.id_variant||L.id,id_product:L.id_product||L.product_id}))}catch(u){(l=(a=u.response)==null?void 0:a.data)!=null&&l.message||u.message,J.value=[]}finally{z.value=!1}},T=i=>{U.value=i,y.value=!0},_=i=>{i&&(U.value=i,v.value=!0)},f=i=>{U.value=i,g.value=!0},x=()=>{j.value=!0},_e=async()=>{var i,a;if(U.value)try{G.value=!0,await Ne.delete(`/api/variants/${U.value.id_variant}`),ne("Variant berhasil dihapus","success"),await ve(),g.value=!1}catch(l){(a=(i=l.response)==null?void 0:i.data)!=null&&a.message}finally{G.value=!1}},pe=i=>{switch(i){case"critical":return"error";case"out":return"error";case"safe":return"success";default:return"primary"}},fe=i=>{switch(i){case"critical":return"Kritis";case"out":return"Habis";case"safe":return"Aman";default:return"Normal"}},P=i=>{const a=i.filter(l=>l.is_active).length;return a===0?"error":a===i.length?"success":"warning"},N=i=>i.some(a=>{var u;const l=(u=a.composition_summary)==null?void 0:u.stock_status;return l==="critical"||l==="out"}),h=i=>{const a=i.filter(u=>u.is_active).length,l=i.filter(u=>{var L;const te=(L=u.composition_summary)==null?void 0:L.stock_status;return te==="critical"||te==="out"}).length;return l>0?{text:`${l} Stok Kritis`,color:"error",icon:"mdi-alert-circle"}:a===i.length?{text:"Semua Aktif",color:"success",icon:"mdi-check-circle"}:a===0?{text:"Semua Nonaktif",color:"error",icon:"mdi-close-circle"}:{text:`${a}/${i.length} Aktif`,color:"warning",icon:"mdi-minus-circle"}},O=()=>{p.value={search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}},K=()=>{ve(),q("refresh")},b=()=>{ve(),q("refresh")};return et(()=>{ve()}),(i,a)=>{var l,u,te;return m(),X("div",xi,[e(ee,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(we,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a[14]||(a[14]=o("div",null,[o("h2",{class:"text-h5 font-weight-bold"},"Variant Produk"),o("p",{class:"text-body-2 text-medium-emphasis"}," Kelola variant dan komposisi untuk produk Anda ")],-1)),o("div",wi,[e(E,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:ve,loading:z.value},{default:t(()=>a[12]||(a[12]=[d(" Refresh ")])),_:1,__:[12]},8,["loading"]),e(E,{color:"primary","prepend-icon":"mdi-plus",onClick:x},{default:t(()=>a[13]||(a[13]=[d(" Tambah Variant ")])),_:1,__:[13]})])]),_:1,__:[14]})]),_:1}),e(ee,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ae,null,{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:p.value.search,"onUpdate:modelValue":a[0]||(a[0]=L=>p.value.search=L),label:"Cari Variant",placeholder:"Nama variant, SKU, atau produk...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:p.value.stockStatus,"onUpdate:modelValue":a[1]||(a[1]=L=>p.value.stockStatus=L),items:A,label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:p.value.activeStatus,"onUpdate:modelValue":a[2]||(a[2]=L=>p.value.activeStatus=L),items:[{title:"Semua Status",value:null},{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Status Aktif",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:p.value.sortBy,"onUpdate:modelValue":a[3]||(a[3]=L=>p.value.sortBy=L),items:de,label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),ke.value?(m(),X("div",Pi,[a[16]||(a[16]=o("span",{class:"text-body-2"},"Filter aktif:",-1)),p.value.search?(m(),F(se,{key:0,size:"small",closable:"","onClick:close":a[4]||(a[4]=L=>p.value.search="")},{default:t(()=>[d(" Pencarian: "+r(p.value.search),1)]),_:1})):W("",!0),p.value.stockStatus?(m(),F(se,{key:1,size:"small",closable:"","onClick:close":a[5]||(a[5]=L=>p.value.stockStatus="")},{default:t(()=>{var L;return[d(" Stok: "+r((L=A.find(ce=>ce.value===p.value.stockStatus))==null?void 0:L.title),1)]}),_:1})):W("",!0),p.value.activeStatus!==null?(m(),F(se,{key:2,size:"small",closable:"","onClick:close":a[6]||(a[6]=L=>p.value.activeStatus=null)},{default:t(()=>[d(" Status: "+r(p.value.activeStatus?"Aktif":"Nonaktif"),1)]),_:1})):W("",!0),e(E,{variant:"text",size:"small",color:"error",onClick:O},{default:t(()=>a[15]||(a[15]=[d(" Hapus Semua Filter ")])),_:1,__:[15]})])):W("",!0)]),_:1})]),_:1}),!z.value&&ie.value.length===0&&ke.value?(m(),F(Ke,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada variant yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):W("",!0),z.value?(m(),X("div",Vi,[e(it,{color:"primary",indeterminate:"",size:"64"}),a[17]||(a[17]=o("div",{class:"mt-4 text-h6"},"Memuat variant...",-1))])):C.value.length===0?(m(),X("div",Ci,[e(k,{icon:"mdi-tune-variant",size:"96",class:"text-disabled mb-6"}),a[19]||(a[19]=o("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Variant Produk",-1)),a[20]||(a[20]=o("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat variant untuk produk Anda agar dapat menawarkan pilihan yang beragam ",-1)),e(E,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:x},{default:t(()=>a[18]||(a[18]=[d(" Buat Variant Pertama ")])),_:1,__:[18]})])):(m(),F(Se,{key:3},{default:t(()=>[(m(!0),X(Te,null,We(ie.value,L=>(m(),F($,{key:L.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ee,{class:Ge(["variant-group-card h-100",{"border-error":N(L.variants)}]),elevation:"2"},{default:t(()=>[e(we,{class:"pa-4 pb-2"},{default:t(()=>[o("div",$i,[e($e,{image:L.product.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[L.product.image_url?W("",!0):(m(),F(k,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),o("div",Si,[o("h3",Ii,r(L.product.name),1),o("p",Di," SKU: "+r(L.product.sku||"-"),1)]),e(se,{color:P(L.variants),size:"small",variant:"tonal"},{default:t(()=>[d(r(L.variants.length)+" Variant ",1)]),_:2},1032,["color"])])]),_:2},1024),e(Ue),e(ae,{class:"pa-4"},{default:t(()=>[e(nt,{class:"pa-0"},{default:t(()=>[(m(!0),X(Te,null,We(L.variants,(ce,ze)=>(m(),F(je,{key:ce.id_variant,class:Ge(["pa-2 rounded-lg variant-item",{"mb-2":ze<L.variants.length-1}])},{prepend:t(()=>[e($e,{size:"32",color:ce.is_active?"success":"error",variant:"tonal"},{default:t(()=>[e(k,{icon:ce.is_active?"mdi-check":"mdi-close",size:"16"},null,8,["icon"])]),_:2},1032,["color"])]),append:t(()=>[o("div",Hi,[e(Me,{text:"Kelola Komposisi"},{activator:t(({props:le})=>[e(E,he({ref_for:!0},le,{icon:"mdi-chef-hat",size:"small",variant:"text",color:"primary",onClick:De=>T(ce)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Hapus Variant"},{activator:t(({props:le})=>[e(E,he({ref_for:!0},le,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:De=>f(ce)}),null,16,["onClick"])]),_:2},1024)])]),default:t(()=>[e(Ye,{class:"text-sm font-weight-medium"},{default:t(()=>[d(r(ce.name),1)]),_:2},1024),e(tt,null,{default:t(()=>[o("div",zi,[o("span",Ti,"SKU: "+r(ce.sku),1),o("div",Ui,[o("span",Ai,r(M(He)(ce.price||0)),1),ce.composition_summary?(m(),F(se,{key:0,color:pe(ce.composition_summary.stock_status),size:"x-small",variant:"tonal"},{default:t(()=>[d(r(fe(ce.composition_summary.stock_status)),1)]),_:2},1032,["color"])):W("",!0)])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:2},1024)]),_:2},1024),e(Ue),e(Re,{class:"pa-4"},{default:t(()=>[o("div",Mi,[o("div",null,[e(se,{color:h(L.variants).color,size:"small",variant:"tonal"},{default:t(()=>[e(k,{icon:h(L.variants).icon,size:"14",class:"me-1"},null,8,["icon"]),d(" "+r(h(L.variants).text),1)]),_:2},1032,["color"])]),o("div",Ki,[e(Me,{text:"Setting HPP Produk"},{activator:t(({props:ce})=>[e(E,he({ref_for:!0},ce,{icon:"mdi-calculator-variant",size:"small",variant:"text",color:"warning",onClick:ze=>_(L.variants[0])}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Tambah Variant"},{activator:t(({props:ce})=>[e(E,he({ref_for:!0},ce,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:x}),null,16)]),_:1}),e(Me,{text:"Pengaturan Produk (Coming Soon)"},{activator:t(({props:ce})=>[e(E,he({ref_for:!0},ce,{icon:"mdi-cog",size:"small",variant:"text",color:"secondary",disabled:""}),null,16)]),_:1})])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(fi,{modelValue:y.value,"onUpdate:modelValue":a[7]||(a[7]=L=>y.value=L),variant:U.value,onSave:K},null,8,["modelValue","variant"]),e(Tt,{modelValue:v.value,"onUpdate:modelValue":a[8]||(a[8]=L=>v.value=L),"variant-id":(l=U.value)==null?void 0:l.id_variant,"variant-name":(u=U.value)==null?void 0:u.name,onHppUpdated:ve,onPriceUpdated:Q},null,8,["modelValue","variant-id","variant-name"]),e(hi,{modelValue:j.value,"onUpdate:modelValue":a[9]||(a[9]=L=>j.value=L),onSave:b},null,8,["modelValue"]),e(St,{modelValue:g.value,"onUpdate:modelValue":a[10]||(a[10]=L=>g.value=L),title:"Konfirmasi Hapus Variant","item-name":(te=U.value)==null?void 0:te.name,loading:G.value,"confirm-text":"Hapus Variant",onConfirm:_e,onCancel:a[11]||(a[11]=L=>g.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),$t=Le(Bi,[["__scopeId","data-v-22b81d4b"]]),Fi={class:"product-management"},Ei={class:"d-flex justify-space-between align-center mb-6"},Ri={class:"d-flex gap-3 align-center"},Li={key:0,class:"d-flex gap-2"},qi={class:"d-flex align-center"},Ni=Fe({__name:"products-management",setup(S){It();const{productsList:ye,categories:q,loading:z,saveLoading:J,deleteLoading:g,toggleLoading:G,stats:U,dialog:y,deleteDialog:v,editMode:j,selectedProduct:p,selectedProducts:A,currentPage:de,totalItems:ke,itemsPerPage:C,filters:ie,errorMessage:ne,successMessage:Q,modalErrorMessage:ve,formData:T,selectedImage:_,imagePreview:f,canCreateEdit:x,hasSelectedProducts:_e,fetchProductsList:pe,fetchCategories:fe,fetchStats:P,saveProduct:N,deleteProduct:h,bulkDeleteProducts:O,toggleActiveStatus:K,toggleFeaturedStatus:b,toggleKitchenAvailability:i,toggleBarAvailability:a,openCreateDialog:l,openEditDialog:u,openDeleteDialog:te,closeDialog:L,handleImageUpload:ce,clearModalError:ze,updateOptions:le}=Dt(),{dialog:De,editMode:Ae,formData:Qe,availableItems:Je,saveLoading:D,modalErrorMessage:n,openCreateDialog:s,closeDialog:w,saveRecipe:B,clearModalError:R,fetchAvailableItems:c}=fa(),{productItemsList:H,loading:Y,fetchProductItemsForComposition:V}=Bt(),re=I("products"),ue=I(),oe=I(!1),Pe=I(null),be=I(!1),Ve=I(null),qe=async()=>{await h()},Xe=async()=>{await O()},rt=Ie=>{const Z=Ie.id_product||Ie.id;s(Z)},ut=async Ie=>{Pe.value=Ie;try{await V({page:1,per_page:100,critical_only:!1})}catch{}oe.value=!0},Ut=Ie=>{Ve.value=Ie,be.value=!0},At=Ie=>{if(!Ie)return[];const Z=Ie.id_product||Ie.id;return H.value.filter(lt=>{var ge;return((ge=lt.product)==null?void 0:ge.id_product)===Z||lt.product_id===Z})||[]},ht=async()=>{if(await V({page:1,per_page:100,critical_only:!1}),await pe(),Pe.value&&ue.value){const Ie=Pe.value.id_product||Pe.value.id;await ue.value.refreshHPPData(Ie)}},Ht=Ie=>{Object.assign(ie,Ie),pe()},Mt=Ie=>{console.log("Search query received:",Ie),ie.search=Ie,console.log("Filters after search update:",ie),pe()},Kt=()=>{_.value=null,f.value&&(f.value="")};return Ce(re,async Ie=>{Ie==="compositions"&&await V({page:1,per_page:100,critical_only:!1})},{immediate:!1}),et(()=>{pe(),fe(),P(),c(),V({page:1,per_page:100,critical_only:!1})}),(Ie,Z)=>{var lt;return m(),X("div",Fi,[o("div",Ei,[Z[18]||(Z[18]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),o("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),o("div",Ri,[M(_e)&&re.value==="products"?(m(),X("div",Li,[e(se,{color:"primary",size:"small"},{default:t(()=>[d(r(M(A).length)+" dipilih ",1)]),_:1}),e(E,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:Xe},{default:t(()=>Z[16]||(Z[16]=[d(" Hapus Terpilih ")])),_:1,__:[16]})])):W("",!0),M(x)&&re.value==="products"?(m(),F(E,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:M(l)},{default:t(()=>Z[17]||(Z[17]=[d(" Tambah Produk ")])),_:1,__:[17]},8,["onClick"])):W("",!0)])]),e(Ia,{modelValue:re.value,"onUpdate:modelValue":Z[0]||(Z[0]=ge=>re.value=ge),class:"mb-6"},{default:t(()=>[e(vt,{value:"products"},{default:t(()=>[e(k,{icon:"mdi-coffee",class:"me-2"}),Z[19]||(Z[19]=d(" Produk "))]),_:1,__:[19]}),e(vt,{value:"compositions"},{default:t(()=>[e(k,{icon:"mdi-chef-hat",class:"me-2"}),Z[20]||(Z[20]=d(" Komposisi Produk "))]),_:1,__:[20]}),e(vt,{value:"variants"},{default:t(()=>[e(k,{icon:"mdi-tune-variant",class:"me-2"}),Z[21]||(Z[21]=d(" Variant Produk "))]),_:1,__:[21]})]),_:1},8,["modelValue"]),M(ne)?(m(),F(Ke,{key:0,type:"error",variant:"outlined",class:"mb-4",text:M(ne),closable:"","onClick:close":Z[1]||(Z[1]=ge=>ne.value="")},null,8,["text"])):W("",!0),M(Q)?(m(),F(Ke,{key:1,type:"success",variant:"outlined",class:"mb-4",text:M(Q),closable:"","onClick:close":Z[2]||(Z[2]=ge=>Q.value="")},null,8,["text"])):W("",!0),e(Da,{modelValue:re.value,"onUpdate:modelValue":Z[4]||(Z[4]=ge=>re.value=ge)},{default:t(()=>[e(pt,{value:"products"},{default:t(()=>[e(ts,{stats:M(U)},null,8,["stats"]),e(Ko,{filters:M(ie),"onUpdate:filters":Ht,onSearch:Mt},null,8,["filters"]),e(xs,{ref_key:"productTableRef",ref:ue,products:M(ye),loading:M(z),"current-page":M(de),"total-items":M(ke),"items-per-page":M(C),"selected-products":M(A),"toggle-loading":M(G),"onUpdate:options":M(le),onAddProduct:M(l),onEditProduct:M(u),onOpenRecipeDialog:rt,onOpenCompositionDialog:ut,onOpenVariantDialog:Ut,onDeleteProduct:M(te),onToggleActive:M(K),onToggleFeatured:M(b),onToggleKitchen:M(i),onToggleBar:M(a),"onUpdate:selectedProducts":Z[3]||(Z[3]=ge=>A.value=ge)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:options","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured","onToggleKitchen","onToggleBar"])]),_:1}),e(pt,{value:"compositions"},{default:t(()=>[e(ao,{"product-items":M(H),loading:M(Y),onRefresh:M(V)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(pt,{value:"variants"},{default:t(()=>[e($t,{loading:M(z),onRefresh:M(pe)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(To,{modelValue:M(y),"onUpdate:modelValue":[Z[5]||(Z[5]=ge=>mt(y)?y.value=ge:null),Z[6]||(Z[6]=ge=>y.value=ge)],"edit-mode":M(j),"form-data":M(T),categories:M(q),loading:M(J),"error-message":M(ve),"selected-image":M(_)?[M(_)]:[],"image-preview":M(f),onClose:M(L),onSubmit:M(N),onImageChange:M(ce),onRemoveImage:Kt,onClearError:M(ze),onUpdateForm:Z[7]||(Z[7]=(ge,xt)=>M(T)[ge]=xt)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(ga,{modelValue:M(De),"onUpdate:modelValue":[Z[8]||(Z[8]=ge=>mt(De)?De.value=ge:null),Z[9]||(Z[9]=ge=>De.value=ge)],"edit-mode":M(Ae),"form-data":M(Qe),"available-items":M(Je),loading:M(D),"error-message":M(n),onClose:M(w),onSave:M(B),onClearError:M(R)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(St,{modelValue:M(v),"onUpdate:modelValue":Z[10]||(Z[10]=ge=>mt(v)?v.value=ge:null),title:"Konfirmasi Hapus Produk","item-name":(lt=M(p))==null?void 0:lt.name,loading:M(g),"confirm-text":"Hapus Produk",onConfirm:qe,onCancel:Z[11]||(Z[11]=ge=>v.value=!1)},null,8,["modelValue","item-name","loading"]),e(zt,{modelValue:oe.value,"onUpdate:modelValue":Z[12]||(Z[12]=ge=>oe.value=ge),product:Pe.value,items:At(Pe.value),onSave:ht,onRefresh:ht},null,8,["modelValue","product","items"]),e(Ee,{modelValue:be.value,"onUpdate:modelValue":Z[15]||(Z[15]=ge=>be.value=ge),"max-width":"1400px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex justify-between align-center"},{default:t(()=>{var ge;return[o("div",qi,[e(k,{icon:"tabler-versions",class:"me-2"}),d(" Kelola Variant - "+r((ge=Ve.value)==null?void 0:ge.name),1)]),e(E,{icon:"tabler-x",variant:"text",onClick:Z[13]||(Z[13]=xt=>be.value=!1)})]}),_:1}),e(Ue),e(ae,{class:"pa-0"},{default:t(()=>[Ve.value?(m(),F($t,{key:0,product:Ve.value},null,8,["product"])):W("",!0)]),_:1}),e(Ue),e(Re,null,{default:t(()=>[e(Oe),e(E,{color:"grey-darken-1",variant:"outlined",onClick:Z[14]||(Z[14]=ge=>be.value=!1)},{default:t(()=>[e(k,{icon:"mdi-close",class:"me-1"}),Z[22]||(Z[22]=d(" Tutup "))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Mn=Le(Ni,[["__scopeId","data-v-0500c9fb"]]);export{Mn as default};
