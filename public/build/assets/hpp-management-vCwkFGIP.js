import{u as X}from"./useHPP-DLG4dPgH.js";import{V as C,b as j,c as re}from"./VCard-Dc0kmm9d.js";import{d as W,r as L,D as de,g as y,f as e,b as t,e as a,X as U,a0 as k,m as l,s as r,l as V,t as o,aE as te,o as P,w as J,c as E,aX as se,aI as fe,V as G,v as ee,F as ue,i as ce,at as ge,aY as Pe,p as ie}from"./main-DjqmDiIz.js";import{V as A,a as g}from"./VRow-Bd9KaDfF.js";import{V as z}from"./VCardText-R2xf0xyg.js";import{V as K}from"./VSelect-DlqmIY7r.js";import{V as N}from"./VChip-DjKKKdJh.js";import{V as Z,a as be}from"./VDataTable-BVT_g1uz.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ae}from"./VDivider-oMNJlvlT.js";import{V as le}from"./VTextField-Cr70duVL.js";import{V as he}from"./VAlert-Cg4Lq4pq.js";import{V as pe}from"./VSpacer-6KgkCcbL.js";import{V as me}from"./VDialog-CO1Pg2O1.js";import{V as ne}from"./VMenu-D3ibQp-y.js";import{V as xe,c as ye,a as ke,b as we,d as Ce}from"./VList-DCB4Qb1M.js";import"./index-D-EbNoF1.js";import"./VAvatar-Clbtu_25.js";import"./VImg-DDXPFBq2.js";/* empty css              */import"./forwardRefs-B931MWyl.js";import"./VOverlay-CZFIfHxA.js";import"./VCheckboxBtn-DRXImS0r.js";import"./VTable-DQqaxhye.js";import"./filter-9vv_0SEG.js";const Ve={class:"d-flex align-center gap-3"},He={class:"text-h4 font-weight-bold"},$e={class:"text-h4 font-weight-bold"},Me={class:"text-h4 font-weight-bold"},ze={class:"text-h4 font-weight-bold"},De={class:"text-h6 font-weight-bold text-primary"},Ue={class:"text-h6 font-weight-bold text-success"},Se={class:"text-h6 font-weight-bold text-error"},Ie={class:"text-grey-darken-1"},Be={class:"font-weight-bold text-primary"},Ae={class:"text-caption"},Le=W({__name:"HPPDashboard",setup(Q){const{loading:R,hppDashboard:m,bulkUpdateResults:$,hasDashboardData:w,getHPPDashboard:b,bulkUpdateHPP:D,formatCurrency:f}=X(),T=L("latest"),S=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],H=[{title:"Product",value:"product_name",sortable:!0},{title:"Old Cost",value:"old_cost",align:"end"},{title:"New Cost",value:"new_cost",align:"end"},{title:"Difference",value:"difference",align:"center"},{title:"Updated",value:"updated_at",sortable:!0}],M=async()=>{await b()},O=async()=>{await D(T.value),await M()};return de(()=>{M()}),(I,i)=>(P(),y(C,null,{default:e(()=>[t(j,{class:"d-flex align-center justify-space-between"},{default:e(()=>[a("div",Ve,[t(U,{icon:"mdi-calculator-variant",size:"24"}),i[1]||(i[1]=a("span",null,"HPP Management Dashboard",-1))]),t(k,{color:"primary",variant:"elevated",onClick:M,loading:l(R),"prepend-icon":"mdi-refresh"},{default:e(()=>i[2]||(i[2]=[r(" Refresh Data ")])),_:1,__:[2]},8,["loading"])]),_:1}),t(z,null,{default:e(()=>[l(w)?(P(),y(A,{key:0,class:"mb-6"},{default:e(()=>[t(g,{cols:"12",md:"3"},{default:e(()=>[t(C,{color:"primary",variant:"tonal",class:"h-100"},{default:e(()=>[t(z,{class:"text-center"},{default:e(()=>[t(U,{icon:"mdi-package-variant",size:"48",class:"mb-2"}),a("div",He,o(l(m).total_products),1),i[3]||(i[3]=a("div",{class:"text-subtitle-1"},"Total Products",-1))]),_:1,__:[3]})]),_:1})]),_:1}),t(g,{cols:"12",md:"3"},{default:e(()=>[t(C,{color:"success",variant:"tonal",class:"h-100"},{default:e(()=>[t(z,{class:"text-center"},{default:e(()=>[t(U,{icon:"mdi-check-circle",size:"48",class:"mb-2"}),a("div",$e,o(l(m).products_with_items),1),i[4]||(i[4]=a("div",{class:"text-subtitle-1"},"With HPP Data",-1))]),_:1,__:[4]})]),_:1})]),_:1}),t(g,{cols:"12",md:"3"},{default:e(()=>[t(C,{color:"warning",variant:"tonal",class:"h-100"},{default:e(()=>[t(z,{class:"text-center"},{default:e(()=>[t(U,{icon:"mdi-alert-circle",size:"48",class:"mb-2"}),a("div",Me,o(l(m).products_without_items),1),i[5]||(i[5]=a("div",{class:"text-subtitle-1"},"Missing HPP Data",-1))]),_:1,__:[5]})]),_:1})]),_:1}),t(g,{cols:"12",md:"3"},{default:e(()=>[t(C,{color:"info",variant:"tonal",class:"h-100"},{default:e(()=>[t(z,{class:"text-center"},{default:e(()=>{var _;return[t(U,{icon:"mdi-trending-up",size:"48",class:"mb-2"}),a("div",ze,o(l(f)(((_=l(m).hpp_statistics)==null?void 0:_.average_margin)||0)),1),i[6]||(i[6]=a("div",{class:"text-subtitle-1"},"Average Margin",-1))]}),_:1,__:[6]})]),_:1})]),_:1})]),_:1})):V("",!0),l(w)&&l(m).hpp_statistics?(P(),y(A,{key:1,class:"mb-6"},{default:e(()=>[t(g,{cols:"12"},{default:e(()=>[t(C,null,{default:e(()=>[t(j,null,{default:e(()=>[t(U,{icon:"mdi-chart-line",class:"me-2"}),i[7]||(i[7]=r(" HPP Statistics "))]),_:1,__:[7]}),t(z,null,{default:e(()=>[t(A,null,{default:e(()=>[t(g,{cols:"12",md:"4"},{default:e(()=>[i[8]||(i[8]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Average HPP",-1)),a("div",De,o(l(f)(l(m).hpp_statistics.average_hpp)),1)]),_:1,__:[8]}),t(g,{cols:"12",md:"4"},{default:e(()=>[i[9]||(i[9]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Min HPP",-1)),a("div",Ue,o(l(f)(l(m).hpp_statistics.min_hpp)),1)]),_:1,__:[9]}),t(g,{cols:"12",md:"4"},{default:e(()=>[i[10]||(i[10]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Max HPP",-1)),a("div",Se,o(l(f)(l(m).hpp_statistics.max_hpp)),1)]),_:1,__:[10]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):V("",!0),t(A,{class:"mb-6"},{default:e(()=>[t(g,{cols:"12"},{default:e(()=>[t(C,null,{default:e(()=>[t(j,null,{default:e(()=>[t(U,{icon:"mdi-update",class:"me-2"}),i[11]||(i[11]=r(" Bulk HPP Operations "))]),_:1,__:[11]}),t(z,null,{default:e(()=>[t(A,{align:"center"},{default:e(()=>[t(g,{cols:"12",md:"4"},{default:e(()=>[t(K,{modelValue:T.value,"onUpdate:modelValue":i[0]||(i[0]=_=>T.value=_),items:S,label:"HPP Calculation Method",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),t(g,{cols:"12",md:"4"},{default:e(()=>[t(k,{color:"primary",variant:"elevated",loading:l(R),onClick:O,"prepend-icon":"mdi-update",block:""},{default:e(()=>i[12]||(i[12]=[r(" Bulk Update All Products ")])),_:1,__:[12]},8,["loading"])]),_:1}),t(g,{cols:"12",md:"4"},{default:e(()=>[l($).length>0?(P(),y(N,{key:0,color:"success",variant:"elevated","prepend-icon":"mdi-check"},{default:e(()=>[r(o(l($).length)+" products updated ",1)]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l($).length>0?(P(),y(A,{key:2},{default:e(()=>[t(g,{cols:"12"},{default:e(()=>[t(C,null,{default:e(()=>[t(j,null,{default:e(()=>[t(U,{icon:"mdi-file-document-multiple",class:"me-2"}),r(" Bulk Update Results ("+o(l($).length)+" products) ",1)]),_:1}),t(z,null,{default:e(()=>[t(Z,{headers:H,items:l($),"items-per-page":10,class:"elevation-1"},{"item.old_cost":e(({item:_})=>[a("span",Ie,o(l(f)(_.old_cost)),1)]),"item.new_cost":e(({item:_})=>[a("span",Be,o(l(f)(_.new_cost)),1)]),"item.difference":e(({item:_})=>[t(N,{color:_.difference>0?"error":_.difference<0?"success":"grey",variant:"tonal",size:"small"},{default:e(()=>[r(o(_.difference>0?"+":"")+o(l(f)(_.difference)),1)]),_:2},1032,["color"])]),"item.updated_at":e(({item:_})=>[a("span",Ae,o(new Date(_.updated_at).toLocaleString()),1)]),_:1},8,["items"])]),_:1})]),_:1})]),_:1})]),_:1})):V("",!0),l(R)&&!l(w)?(P(),y(A,{key:3},{default:e(()=>[t(g,{cols:"12",class:"text-center py-12"},{default:e(()=>[t(te,{indeterminate:"",size:"64"}),i[13]||(i[13]=a("div",{class:"mt-4 text-h6"},"Loading HPP Dashboard...",-1))]),_:1,__:[13]})]),_:1})):V("",!0),!l(R)&&!l(w)?(P(),y(A,{key:4},{default:e(()=>[t(g,{cols:"12",class:"text-center py-12"},{default:e(()=>[t(U,{icon:"mdi-chart-line",size:"64",class:"text-grey-lighten-1 mb-4"}),i[15]||(i[15]=a("div",{class:"text-h6 text-grey-darken-1 mb-2"},"No HPP Data Available",-1)),i[16]||(i[16]=a("div",{class:"text-body-2 text-grey-darken-1 mb-4"},' Click "Refresh Data" to load HPP dashboard information ',-1)),t(k,{color:"primary",variant:"elevated",onClick:M,"prepend-icon":"mdi-refresh"},{default:e(()=>i[14]||(i[14]=[r(" Load Dashboard ")])),_:1,__:[14]})]),_:1,__:[15,16]})]),_:1})):V("",!0)]),_:1})]),_:1}))}}),Te=Y(Le,[["__scopeId","data-v-3833158f"]]),Ne={class:"d-flex align-center gap-3"},Re={class:"text-h5 font-weight-bold"},Fe={class:"text-h6"},je={class:"text-body-1"},Oe={class:"d-flex flex-column"},qe={class:"font-weight-medium"},Ee={class:"text-caption text-grey-darken-1"},Ge={class:"font-weight-medium"},Qe={key:0,class:"text-caption"},Ke={key:1,class:"text-grey-lighten-1 text-caption"},Xe={class:"v-data-table__footer"},We={class:"pa-4 d-flex justify-space-between align-center"},Ye={class:"text-subtitle-1 font-weight-bold"},Je={key:0,class:"text-center"},Ze={class:"text-h6 font-weight-bold text-success"},et={class:"d-flex justify-space-between align-center"},tt=W({__name:"HPPBreakdownDialog",props:{modelValue:{type:Boolean},productId:{},productName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup(Q,{emit:R}){const m=Q,$=R,{loading:w,currentHPPBreakdown:b,currentHPPSuggestion:D,hasHPPData:f,hasSuggestionData:T,getProductHPPBreakdown:S,updateProductHPP:H,calculateSuggestedPrice:M,updatePriceFromHPP:O,formatCurrency:I}=X(),i=L("latest"),_=L(0),F=L(0),q=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],h=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],c=async()=>{if(m.productId)try{const n=localStorage.getItem("token"),s=await fe.get(`/api/products/${m.productId}`,{headers:{Authorization:`Bearer ${n}`,Accept:"application/json"}});if(s.data.success&&s.data.data){const u=s.data.data;if(u.markup_percentage!==null&&u.markup_percentage!==void 0)_.value=Number(u.markup_percentage);else if(u.price&&u.cost&&u.cost>0){const B=(u.price-u.cost)/u.cost*100;_.value=Math.round(B*100)/100}else _.value=20;F.value+=1}}catch(n){console.warn("Could not load markup percentage, using default:",n),_.value=20}},d=async()=>{m.productId&&(await S(m.productId,i.value),await c())},x=async()=>{m.productId&&(await H(m.productId,i.value),$("hpp-updated"),await d())},v=async()=>{m.productId&&await M(m.productId,_.value)},p=async()=>{var n,s,u;if(m.productId)try{const B=await O(m.productId,i.value,_.value,!0);if(((n=B==null?void 0:B.data)==null?void 0:n.markup_percentage)!==void 0)_.value=B.data.markup_percentage,F.value+=1,await se();else if((s=B==null?void 0:B.data)!=null&&s.new_price&&((u=b.value)!=null&&u.total_hpp)){const _e=B.data.new_price,oe=b.value.total_hpp,ve=(_e-oe)/oe*100;_.value=Math.round(ve*100)/100,F.value+=1,await se()}await d(),$("price-updated")}catch(B){console.error("Error applying price suggestion:",B)}};return J(()=>m.modelValue,n=>{n&&m.productId&&d()}),J(()=>m.productId,n=>{n&&m.modelValue&&d()}),(n,s)=>(P(),y(me,{"model-value":n.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":s[4]||(s[4]=u=>n.$emit("update:modelValue",u))},{default:e(()=>[t(C,null,{default:e(()=>[t(j,{class:"d-flex align-center justify-space-between"},{default:e(()=>[a("div",Ne,[t(U,{icon:"mdi-calculator-variant",size:"24"}),a("span",null,"HPP Breakdown - "+o(n.productName||"Product"),1)]),t(k,{icon:"mdi-close",size:"small",variant:"text",onClick:s[0]||(s[0]=u=>n.$emit("update:modelValue",!1))})]),_:1}),t(z,null,{default:e(()=>[t(A,{class:"mb-4"},{default:e(()=>[t(g,{cols:"12",md:"6"},{default:e(()=>[t(K,{modelValue:i.value,"onUpdate:modelValue":[s[1]||(s[1]=u=>i.value=u),d],items:q,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(g,{cols:"12",md:"6"},{default:e(()=>[t(k,{color:"primary",variant:"elevated",loading:l(w),"prepend-icon":"mdi-update",block:"",onClick:x},{default:e(()=>[r(" Update HPP with "+o(i.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),l(f)?(P(),y(C,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:e(()=>[t(z,null,{default:e(()=>[t(A,{align:"center"},{default:e(()=>[t(g,{cols:"12",md:"4"},{default:e(()=>[s[5]||(s[5]=a("div",{class:"text-subtitle-2"}," Total HPP ",-1)),a("div",Re,o(l(I)(l(b).total_hpp)),1)]),_:1,__:[5]}),t(g,{cols:"12",md:"4"},{default:e(()=>{var u;return[s[6]||(s[6]=a("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),a("div",Fe,o((u=q.find(B=>B.value===l(b).method))==null?void 0:u.title),1)]}),_:1,__:[6]}),t(g,{cols:"12",md:"4"},{default:e(()=>[s[7]||(s[7]=a("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),a("div",je,o(new Date(l(b).calculated_at).toLocaleString()),1)]),_:1,__:[7]})]),_:1})]),_:1})]),_:1})):V("",!0),l(f)?(P(),y(C,{key:1},{default:e(()=>[t(j,null,{default:e(()=>[t(U,{icon:"mdi-format-list-bulleted",class:"me-2"}),r(" Item Breakdown ("+o(l(b).items.length)+" items) ",1)]),_:1}),t(Z,{headers:h,items:l(b).items,"items-per-page":10,class:"elevation-0"},{"item.item_name":e(({item:u})=>[a("div",Oe,[a("span",qe,o(u.item_name),1),a("span",Ee,o(u.item_code),1)])]),"item.quantity_needed":e(({item:u})=>[a("span",Ge,o(u.quantity_needed)+" "+o(u.unit),1)]),"item.cost_per_unit":e(({item:u})=>[a("span",null,o(l(I)(u.cost_per_unit)),1)]),"item.total_cost":e(({item:u})=>[t(N,{color:u.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:e(()=>[r(o(l(I)(u.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":e(({item:u})=>[t(N,{color:u.is_critical?"error":"success","prepend-icon":u.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:e(()=>[r(o(u.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":e(({item:u})=>[u.notes?(P(),E("span",Qe,o(u.notes),1)):(P(),E("span",Ke,"—"))]),bottom:e(()=>[a("div",Xe,[t(ae),a("div",We,[a("div",Ye," Total HPP: "+o(l(I)(l(b).total_hpp)),1),t(N,{color:"info",variant:"elevated"},{default:e(()=>[r(o(l(b).items.length)+" items ",1)]),_:1})])])]),_:1},8,["items"])]),_:1})):V("",!0),l(f)?(P(),y(A,{key:2,class:"mt-4"},{default:e(()=>[t(g,{cols:"12"},{default:e(()=>[t(C,null,{default:e(()=>[t(j,null,{default:e(()=>[t(U,{icon:"mdi-currency-usd",class:"me-2"}),s[8]||(s[8]=r(" Price Suggestion "))]),_:1,__:[8]}),t(z,null,{default:e(()=>[t(A,{align:"end"},{default:e(()=>[t(g,{cols:"12",md:"3"},{default:e(()=>[(P(),y(le,{key:F.value,modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=u=>_.value=u),modelModifiers:{number:!0},type:"number",label:"Markup Percentage (%)",variant:"outlined",suffix:"%",min:"0",max:"1000"},null,8,["modelValue"]))]),_:1}),t(g,{cols:"12",md:"3"},{default:e(()=>[t(k,{color:"info",variant:"elevated",loading:l(w),"prepend-icon":"mdi-calculator",block:"",onClick:v},{default:e(()=>s[9]||(s[9]=[r(" Calculate ")])),_:1,__:[9]},8,["loading"])]),_:1}),t(g,{cols:"12",md:"3"},{default:e(()=>[l(T)?(P(),y(k,{key:0,color:"success",variant:"elevated",loading:l(w),"prepend-icon":"mdi-check",block:"",onClick:p},{default:e(()=>s[10]||(s[10]=[r(" Apply Price ")])),_:1,__:[10]},8,["loading"])):V("",!0)]),_:1}),t(g,{cols:"12",md:"3"},{default:e(()=>{var u;return[l(T)?(P(),E("div",Je,[s[11]||(s[11]=a("div",{class:"text-subtitle-2"}," Suggested Price ",-1)),a("div",Ze,o(l(I)(((u=l(D).suggestions[i.value])==null?void 0:u.suggested_price)||0)),1)])):V("",!0)]}),_:1})]),_:1}),l(T)?(P(),y(A,{key:0,class:"mt-4"},{default:e(()=>[t(g,{cols:"12"},{default:e(()=>[t(he,{color:"info",variant:"tonal",class:"mb-0"},{default:e(()=>{var u,B;return[a("div",et,[a("div",null,[s[12]||(s[12]=a("strong",null,"HPP:",-1)),r(" "+o(l(I)(((u=l(D).suggestions[i.value])==null?void 0:u.hpp)||0))+" | ",1),s[13]||(s[13]=a("strong",null,"Markup:",-1)),r(" "+o(_.value)+"% | ",1),s[14]||(s[14]=a("strong",null,"Profit:",-1)),r(" "+o(l(I)(((B=l(D).suggestions[i.value])==null?void 0:B.profit_margin)||0)),1)]),t(N,{color:"success",variant:"elevated",size:"small"},{default:e(()=>[r(o(Number(_.value).toFixed(1))+"% margin ",1)]),_:1})])]}),_:1})]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):V("",!0),l(w)&&!l(f)?(P(),y(C,{key:3},{default:e(()=>[t(z,{class:"text-center py-12"},{default:e(()=>[t(te,{indeterminate:"",size:"64"}),s[15]||(s[15]=a("div",{class:"mt-4 text-h6"}," Loading HPP breakdown... ",-1))]),_:1,__:[15]})]),_:1})):V("",!0),!l(w)&&!l(f)?(P(),y(C,{key:4},{default:e(()=>[t(z,{class:"text-center py-12"},{default:e(()=>[t(U,{icon:"mdi-calculator-variant",size:"64",class:"text-grey-lighten-1 mb-4"}),s[17]||(s[17]=a("div",{class:"text-h6 text-grey-darken-1 mb-2"}," No HPP Data Available ",-1)),s[18]||(s[18]=a("div",{class:"text-body-2 text-grey-darken-1 mb-4"}," This product doesn't have item composition data or HPP calculation failed ",-1)),t(k,{color:"primary",variant:"elevated","prepend-icon":"mdi-refresh",onClick:d},{default:e(()=>s[16]||(s[16]=[r(" Try Again ")])),_:1,__:[16]})]),_:1,__:[17,18]})]),_:1})):V("",!0)]),_:1}),t(re,{class:"px-6 pb-6"},{default:e(()=>[t(pe),t(k,{color:"grey-darken-1",variant:"text",onClick:s[3]||(s[3]=u=>n.$emit("update:modelValue",!1))},{default:e(()=>s[19]||(s[19]=[r(" Close ")])),_:1,__:[19]})]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),at=Y(tt,[["__scopeId","data-v-a8173b63"]]),lt={class:"d-flex align-center gap-3"},ot={class:"text-center"},st={class:"text-h5 font-weight-bold text-primary"},it={class:"text-center"},nt={class:"text-h5 font-weight-bold text-info"},rt={class:"text-center"},dt={class:"text-center"},ut={class:"mb-4"},ct={class:"text-h4 font-weight-bold"},pt={class:"mb-4"},mt={class:"mb-4"},_t={class:"text-h6"},vt={class:"d-flex flex-column"},ft={class:"font-weight-medium"},gt={class:"text-caption text-grey-darken-1"},Pt={class:"font-weight-medium"},bt={class:"text-end"},ht={class:"text-caption mt-1"},xt={class:"v-data-table__footer"},yt={class:"pa-4 d-flex justify-space-between align-center"},kt={class:"text-subtitle-1 font-weight-bold"},wt={class:"d-flex gap-2"},Ct=W({__name:"HPPComparisonDialog",props:{modelValue:{type:Boolean},productId:{},productName:{default:""}},emits:["update:modelValue","hpp-updated"],setup(Q,{emit:R}){const m=Q,$=R,{loading:w,currentHPPComparison:b,hasComparisonData:D,compareHPPMethods:f,updateProductHPP:T,formatCurrency:S}=X(),H=L("latest_purchase"),M={current:{title:"Current Cost",icon:"mdi-database",color:"primary"},latest_purchase:{title:"Latest Purchase",icon:"mdi-clock-outline",color:"success"},average_purchase:{title:"Average Purchase",icon:"mdi-chart-line",color:"warning"}},O=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Contribution",value:"percentage",align:"end"}],I=G(()=>D.value?b.value.current_price-b.value.current_cost:0),i=G(()=>!D.value||b.value.current_cost===0?0:I.value/b.value.current_cost*100),_=G(()=>D.value?b.value.breakdown[H.value]:null),F=async()=>{m.productId&&await f(m.productId)},q=x=>{H.value=x},h=async()=>{if(!m.productId)return;const x=H.value==="latest_purchase"?"latest":H.value==="average_purchase"?"average":"current";await T(m.productId,x),$("hpp-updated"),await F()},c=x=>x>0?"error":x<0?"success":"grey",d=x=>`${x>0?"+":""}${S(x)}`;return J(()=>m.modelValue,x=>{x&&m.productId&&F()}),J(()=>m.productId,x=>{x&&m.modelValue&&F()}),(x,v)=>(P(),y(me,{"model-value":x.modelValue,"onUpdate:modelValue":v[2]||(v[2]=p=>x.$emit("update:modelValue",p)),"max-width":"1400",scrollable:""},{default:e(()=>[t(C,null,{default:e(()=>[t(j,{class:"d-flex align-center justify-space-between"},{default:e(()=>[a("div",lt,[t(U,{icon:"mdi-compare",size:"24"}),a("span",null,"HPP Methods Comparison - "+o(x.productName||"Product"),1)]),t(k,{icon:"mdi-close",size:"small",variant:"text",onClick:v[0]||(v[0]=p=>x.$emit("update:modelValue",!1))})]),_:1}),t(z,null,{default:e(()=>[l(D)?(P(),y(C,{key:0,variant:"outlined",class:"mb-4"},{default:e(()=>[t(j,null,{default:e(()=>[t(U,{icon:"mdi-chart-bar",class:"me-2"}),v[3]||(v[3]=r(" HPP Comparison Summary "))]),_:1,__:[3]}),t(z,null,{default:e(()=>[t(A,null,{default:e(()=>[t(g,{cols:"12",md:"3"},{default:e(()=>[a("div",ot,[v[4]||(v[4]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Current Price",-1)),a("div",st,o(l(S)(l(b).current_price)),1)])]),_:1}),t(g,{cols:"12",md:"3"},{default:e(()=>[a("div",it,[v[5]||(v[5]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Current Cost",-1)),a("div",nt,o(l(S)(l(b).current_cost)),1)])]),_:1}),t(g,{cols:"12",md:"3"},{default:e(()=>[a("div",rt,[v[6]||(v[6]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Current Margin",-1)),a("div",{class:ee(["text-h5 font-weight-bold",I.value>=0?"text-success":"text-error"])},o(l(S)(I.value)),3)])]),_:1}),t(g,{cols:"12",md:"3"},{default:e(()=>[a("div",dt,[v[7]||(v[7]=a("div",{class:"text-subtitle-2 text-grey-darken-1"},"Margin %",-1)),a("div",{class:ee(["text-h5 font-weight-bold",i.value>=0?"text-success":"text-error"])},o(i.value.toFixed(1))+"% ",3)])]),_:1})]),_:1})]),_:1})]),_:1})):V("",!0),l(D)?(P(),y(A,{key:1},{default:e(()=>[(P(),E(ue,null,ce(M,(p,n)=>t(g,{key:n,cols:"12",md:"4"},{default:e(()=>[t(C,{color:p.color,variant:"tonal",class:ee(["h-100",{"v-card--selected":H.value===n}])},{default:e(()=>[t(j,{class:"d-flex justify-space-between align-center"},{default:e(()=>[a("div",null,[t(U,{icon:p.icon,class:"me-2"},null,8,["icon"]),r(" "+o(p.title),1)]),t(N,{color:p.color,variant:"elevated",size:"small"},{default:e(()=>[r(o(n.toUpperCase()),1)]),_:2},1032,["color"])]),_:2},1024),t(z,null,{default:e(()=>{var s;return[a("div",ut,[v[8]||(v[8]=a("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"HPP Cost",-1)),a("div",ct,o(l(S)(l(b).hpp_methods[n])),1)]),a("div",pt,[v[9]||(v[9]=a("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"vs Current Cost",-1)),t(N,{color:c(l(b).hpp_methods[n]-l(b).current_cost),variant:"tonal",size:"small"},{default:e(()=>[r(o(d(l(b).hpp_methods[n]-l(b).current_cost)),1)]),_:2},1032,["color"])]),a("div",mt,[v[10]||(v[10]=a("div",{class:"text-subtitle-2 text-grey-darken-1 mb-1"},"Items Count",-1)),a("div",_t,o(((s=l(b).breakdown[n])==null?void 0:s.items.length)||0)+" items ",1)]),t(k,{color:p.color,variant:"elevated",block:"",onClick:u=>q(n),"prepend-icon":H.value===n?"mdi-check":"mdi-eye"},{default:e(()=>[r(o(H.value===n?"Selected":"View Details"),1)]),_:2},1032,["color","onClick","prepend-icon"])]}),_:2},1024)]),_:2},1032,["color","class"])]),_:2},1024)),64))]),_:1})):V("",!0),l(D)&&_.value?(P(),y(C,{key:2,class:"mt-4"},{default:e(()=>[t(j,null,{default:e(()=>{var p;return[t(U,{icon:"mdi-format-list-bulleted",class:"me-2"}),r(" "+o((p=M[H.value])==null?void 0:p.title)+" - Detailed Breakdown ",1)]}),_:1}),t(Z,{headers:O,items:_.value.items,"items-per-page":15,class:"elevation-0"},{"item.item_name":e(({item:p})=>[a("div",vt,[a("span",ft,o(p.item_name),1),a("span",gt,o(p.item_code),1)])]),"item.quantity_needed":e(({item:p})=>[a("span",Pt,o(Number(p.quantity_needed).toFixed(3))+" "+o(p.unit),1)]),"item.cost_per_unit":e(({item:p})=>[a("span",null,o(l(S)(p.cost_per_unit)),1)]),"item.total_cost":e(({item:p})=>[t(N,{color:p.is_critical?"error":"primary",variant:"tonal",size:"small"},{default:e(()=>[r(o(l(S)(p.total_cost)),1)]),_:2},1032,["color"])]),"item.percentage":e(({item:p})=>[a("div",bt,[t(ge,{"model-value":p.total_cost/_.value.total_hpp*100,color:p.is_critical?"error":"primary",height:"4",rounded:""},null,8,["model-value","color"]),a("span",ht,o((p.total_cost/_.value.total_hpp*100).toFixed(1))+"% ",1)])]),bottom:e(()=>{var p,n;return[a("div",xt,[t(ae),a("div",yt,[a("div",kt," Total HPP ("+o((p=M[H.value])==null?void 0:p.title)+"): "+o(l(S)(_.value.total_hpp)),1),a("div",wt,[t(N,{color:"info",variant:"elevated",size:"small"},{default:e(()=>[r(o(_.value.items.length)+" items ",1)]),_:1}),t(k,{color:(n=M[H.value])==null?void 0:n.color,variant:"elevated",size:"small",onClick:h,loading:l(w),"prepend-icon":"mdi-check"},{default:e(()=>v[11]||(v[11]=[r(" Apply This HPP ")])),_:1,__:[11]},8,["color","loading"])])])])]}),_:1},8,["items"])]),_:1})):V("",!0),l(w)&&!l(D)?(P(),y(C,{key:3},{default:e(()=>[t(z,{class:"text-center py-12"},{default:e(()=>[t(te,{indeterminate:"",size:"64"}),v[12]||(v[12]=a("div",{class:"mt-4 text-h6"},"Loading HPP comparison...",-1))]),_:1,__:[12]})]),_:1})):V("",!0),!l(w)&&!l(D)?(P(),y(C,{key:4},{default:e(()=>[t(z,{class:"text-center py-12"},{default:e(()=>[t(U,{icon:"mdi-compare",size:"64",class:"text-grey-lighten-1 mb-4"}),v[14]||(v[14]=a("div",{class:"text-h6 text-grey-darken-1 mb-2"},"No Comparison Data Available",-1)),v[15]||(v[15]=a("div",{class:"text-body-2 text-grey-darken-1 mb-4"}," Unable to load HPP methods comparison for this product ",-1)),t(k,{color:"primary",variant:"elevated",onClick:F,"prepend-icon":"mdi-refresh"},{default:e(()=>v[13]||(v[13]=[r(" Try Again ")])),_:1,__:[13]})]),_:1,__:[14,15]})]),_:1})):V("",!0)]),_:1}),t(re,{class:"px-6 pb-6"},{default:e(()=>[t(pe),t(k,{color:"grey-darken-1",variant:"text",onClick:v[1]||(v[1]=p=>x.$emit("update:modelValue",!1))},{default:e(()=>v[16]||(v[16]=[r(" Close ")])),_:1,__:[16]})]),_:1})]),_:1})]),_:1},8,["model-value"]))}}),Vt=Y(Ct,[["__scopeId","data-v-4f8318c7"]]),Ht={class:"hpp-actions"},$t={class:"d-flex align-center gap-2 mb-2"},Mt={class:"d-flex flex-column gap-2"},zt={key:0,class:"mt-2 text-center"},Dt=W({__name:"HPPProductActions",props:{product:{}},emits:["hpp-updated","price-updated","product-updated"],setup(Q,{emit:R}){const m=Q,$=R,{loading:w,updateProductHPP:b,updatePriceFromHPP:D,formatCurrency:f}=X(),T=L(!1),S=L(!1),H=L(30),M=L(0),O=[{title:"Current Cost",value:"current",icon:"mdi-database",description:"Use stored cost per unit"},{title:"Latest Purchase",value:"latest",icon:"mdi-clock-outline",description:"Use latest purchase prices"},{title:"Average Purchase",value:"average",icon:"mdi-chart-line",description:"Use average purchase prices"}],I=G(()=>(m.product.price||0)-(m.product.cost||0)),i=G(()=>!m.product.cost||m.product.cost===0?0:I.value/m.product.cost*100),_=G(()=>{const p=m.product.cost||0;return p===0?{color:"error",icon:"mdi-alert-circle",text:"No HPP"}:p>0&&i.value<10?{color:"warning",icon:"mdi-alert",text:"Low Margin"}:{color:"success",icon:"mdi-check-circle",text:"Good Margin"}}),F=()=>{T.value=!0},q=()=>{S.value=!0},h=async p=>{await b(m.product.id_product,p),x()},c=()=>{const p=m.product.cost||0;M.value=Math.round(p*(1+H.value/100))},d=async()=>{await D(m.product.id_product,"current",H.value,!1),v(),M.value=0},x=()=>{$("hpp-updated"),$("product-updated")},v=()=>{$("price-updated"),$("product-updated")};return(p,n)=>(P(),E("div",Ht,[a("div",$t,[t(N,{color:_.value.color,"prepend-icon":_.value.icon,variant:"tonal",size:"small"},{default:e(()=>[r(" HPP: "+o(l(f)(p.product.cost||0)),1)]),_:1},8,["color","prepend-icon"]),p.product.price&&p.product.cost?(P(),y(N,{key:0,color:I.value>=0?"success":"error",variant:"tonal",size:"small"},{default:e(()=>[r(o(i.value.toFixed(1))+"% margin ",1)]),_:1},8,["color"])):V("",!0)]),t(Pe,{variant:"tonal",density:"compact",class:"hpp-btn-group"},{default:e(()=>[t(k,{size:"small","prepend-icon":"mdi-calculator-variant",onClick:F,loading:l(w)},{default:e(()=>n[3]||(n[3]=[r(" HPP Detail ")])),_:1,__:[3]},8,["loading"]),t(k,{size:"small","prepend-icon":"mdi-compare",onClick:q,loading:l(w)},{default:e(()=>n[4]||(n[4]=[r(" Compare ")])),_:1,__:[4]},8,["loading"]),t(ne,null,{activator:e(({props:s})=>[t(k,ie({size:"small","prepend-icon":"mdi-update"},s,{loading:l(w)}),{default:e(()=>n[5]||(n[5]=[r(" Update HPP ")])),_:2,__:[5]},1040,["loading"])]),default:e(()=>[t(C,{"min-width":"250"},{default:e(()=>[t(xe,null,{default:e(()=>[t(ye,null,{default:e(()=>n[6]||(n[6]=[r("Update HPP Method")])),_:1,__:[6]}),(P(),E(ue,null,ce(O,s=>t(ke,{key:s.value,onClick:u=>h(s.value),"prepend-icon":s.icon},{default:e(()=>[t(we,null,{default:e(()=>[r(o(s.title),1)]),_:2},1024),t(Ce,null,{default:e(()=>[r(o(s.description),1)]),_:2},1024)]),_:2},1032,["onClick","prepend-icon"])),64))]),_:1})]),_:1})]),_:1}),t(ne,null,{activator:e(({props:s})=>[t(k,ie({size:"small","prepend-icon":"mdi-currency-usd"},s,{loading:l(w)}),{default:e(()=>n[7]||(n[7]=[r(" Price Tools ")])),_:2,__:[7]},1040,["loading"])]),default:e(()=>[t(C,{"min-width":"280"},{default:e(()=>[t(j,{class:"text-subtitle-1"},{default:e(()=>n[8]||(n[8]=[r("Price Calculator")])),_:1,__:[8]}),t(z,null,{default:e(()=>[t(le,{modelValue:H.value,"onUpdate:modelValue":n[0]||(n[0]=s=>H.value=s),modelModifiers:{number:!0},type:"number",label:"Markup %",variant:"outlined",density:"compact",suffix:"%",min:"0",max:"1000",class:"mb-3"},null,8,["modelValue"]),a("div",Mt,[t(k,{color:"info",variant:"tonal",size:"small",block:"",onClick:c,"prepend-icon":"mdi-calculator"},{default:e(()=>n[9]||(n[9]=[r(" Calculate Price ")])),_:1,__:[9]}),M.value>0?(P(),y(k,{key:0,color:"success",variant:"tonal",size:"small",block:"",onClick:d,"prepend-icon":"mdi-check"},{default:e(()=>[r(" Apply "+o(l(f)(M.value)),1)]),_:1})):V("",!0)]),M.value>0?(P(),E("div",zt,[t(N,{color:"info",variant:"tonal",size:"small"},{default:e(()=>[r(" Profit: "+o(l(f)(M.value-(p.product.cost||0))),1)]),_:1})])):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(at,{modelValue:T.value,"onUpdate:modelValue":n[1]||(n[1]=s=>T.value=s),"product-id":p.product.id_product,"product-name":p.product.name,onHppUpdated:x,onPriceUpdated:v},null,8,["modelValue","product-id","product-name"]),t(Vt,{modelValue:S.value,"onUpdate:modelValue":n[2]||(n[2]=s=>S.value=s),"product-id":p.product.id_product,"product-name":p.product.name,onHppUpdated:x},null,8,["modelValue","product-id","product-name"])]))}}),Ut=Y(Dt,[["__scopeId","data-v-02ad34bc"]]),St={class:"d-flex align-center justify-space-between mb-6"},It={class:"d-flex gap-3"},Bt={class:"d-flex align-center gap-3"},At={class:"d-flex align-center gap-2"},Lt={class:"d-flex flex-column"},Tt={class:"font-weight-medium"},Nt={class:"text-caption text-grey-darken-1"},Rt={class:"font-weight-bold text-primary"},Ft={class:"font-weight-medium"},jt={class:"d-flex flex-column align-end"},Ot={class:"text-caption"},qt={class:"v-data-table__footer"},Et={class:"pa-4 d-flex justify-space-between align-center"},Gt={class:"text-body-2"},Qt=W({__name:"hpp-management",setup(Q){const{formatCurrency:R}=X(),m=L([]),$=L(!1),w=L(""),b=L(1),D=L(15),f=L({category:null,hppStatus:null,marginRange:null}),T=L([{title:"All Categories",value:null},{title:"Food & Beverage",value:"food"},{title:"Electronics",value:"electronics"},{title:"Clothing",value:"clothing"},{title:"Others",value:"others"}]),S=[{title:"All Status",value:null},{title:"Good Margin",value:"good"},{title:"Low Margin",value:"low"},{title:"No HPP Data",value:"no_hpp"}],H=[{title:"All Ranges",value:null},{title:"< 10%",value:"low"},{title:"10% - 30%",value:"medium"},{title:"> 30%",value:"high"}],M=[{title:"Product",value:"name",sortable:!0,width:"200px"},{title:"Price",value:"current_price",align:"end",sortable:!0},{title:"HPP Cost",value:"current_cost",align:"end",sortable:!0},{title:"Margin",value:"margin",align:"end",sortable:!0},{title:"Status",value:"hpp_status",align:"center"},{title:"Actions",value:"actions",sortable:!1,width:"250px"}],O=G(()=>{let h=[...m.value];return f.value.hppStatus&&(h=h.filter(c=>f.value.hppStatus==="good"?c.margin_percent>=10:f.value.hppStatus==="low"?c.margin_percent<10&&c.cost>0:f.value.hppStatus==="no_hpp"?c.cost===0:!0)),f.value.marginRange&&(h=h.filter(c=>f.value.marginRange==="low"?c.margin_percent<10:f.value.marginRange==="medium"?c.margin_percent>=10&&c.margin_percent<=30:f.value.marginRange==="high"?c.margin_percent>30:!0)),h}),I=G(()=>Math.ceil(O.value.length/D.value)),i=async()=>{$.value=!0;try{const h=await fetch("/api/products",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);const c=await h.json();c.success&&(m.value=c.data.map(d=>({...d,margin_amount:(d.price||0)-(d.cost||0),margin_percent:d.cost>0?((d.price||0)-(d.cost||0))/d.cost*100:0,hpp_status:_(d)})))}catch(h){console.error("Error loading products:",h)}finally{$.value=!1}},_=h=>{const c=h.cost||0,d=c>0?((h.price||0)-c)/c*100:0;return c===0?{color:"error",icon:"mdi-alert-circle",text:"No HPP"}:d<10?{color:"warning",icon:"mdi-alert",text:"Low Margin"}:{color:"success",icon:"mdi-check-circle",text:"Good Margin"}},F=h=>h>0?"success":h<0?"error":"grey",q=()=>{f.value={category:null,hppStatus:null,marginRange:null}};return de(()=>{i()}),(h,c)=>(P(),E("div",null,[a("div",St,[c[9]||(c[9]=a("div",null,[a("h1",{class:"text-h4 font-weight-bold mb-1"},"HPP Management"),a("p",{class:"text-body-1 text-grey-darken-1 mb-0"}," Manage Harga Pokok Produksi (Cost of Goods Sold) for all products ")],-1)),a("div",It,[t(k,{color:"orange",variant:"outlined","prepend-icon":"mdi-package-variant-closed",onClick:c[0]||(c[0]=d=>h.$router.push("/product-items-management"))},{default:e(()=>c[7]||(c[7]=[r(" Komposisi Produk ")])),_:1,__:[7]}),t(k,{color:"primary",variant:"elevated","prepend-icon":"mdi-plus",onClick:c[1]||(c[1]=d=>h.$router.push("/products-management"))},{default:e(()=>c[8]||(c[8]=[r(" Manage Products ")])),_:1,__:[8]})])]),t(Te),t(C,{class:"mt-6"},{default:e(()=>[t(j,{class:"d-flex align-center justify-space-between"},{default:e(()=>[a("div",Bt,[t(U,{icon:"mdi-package-variant",size:"24"}),c[10]||(c[10]=a("span",null,"Products HPP Overview",-1))]),a("div",At,[t(le,{modelValue:w.value,"onUpdate:modelValue":c[2]||(c[2]=d=>w.value=d),"prepend-inner-icon":"mdi-magnify",label:"Search products...",variant:"outlined",density:"compact","hide-details":"",clearable:"",style:{"inline-size":"300px"}},null,8,["modelValue"]),t(k,{color:"primary",variant:"text",onClick:i,loading:$.value,icon:"mdi-refresh"},null,8,["loading"])])]),_:1}),t(z,null,{default:e(()=>[t(A,{class:"mb-4"},{default:e(()=>[t(g,{cols:"12",md:"3"},{default:e(()=>[t(K,{modelValue:f.value.category,"onUpdate:modelValue":c[3]||(c[3]=d=>f.value.category=d),items:T.value,label:"Category",variant:"outlined",density:"compact",clearable:"","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(g,{cols:"12",md:"3"},{default:e(()=>[t(K,{modelValue:f.value.hppStatus,"onUpdate:modelValue":c[4]||(c[4]=d=>f.value.hppStatus=d),items:S,label:"HPP Status",variant:"outlined",density:"compact",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),t(g,{cols:"12",md:"3"},{default:e(()=>[t(K,{modelValue:f.value.marginRange,"onUpdate:modelValue":c[5]||(c[5]=d=>f.value.marginRange=d),items:H,label:"Margin Range",variant:"outlined",density:"compact",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),t(g,{cols:"12",md:"3"},{default:e(()=>[t(k,{color:"error",variant:"text",onClick:q,"prepend-icon":"mdi-filter-off",block:""},{default:e(()=>c[11]||(c[11]=[r(" Clear Filters ")])),_:1,__:[11]})]),_:1})]),_:1}),t(Z,{headers:M,items:O.value,loading:$.value,"items-per-page":D.value,search:w.value,class:"elevation-1"},{"item.name":e(({item:d})=>[a("div",Lt,[a("span",Tt,o(d.name),1),a("span",Nt,o(d.sku),1)])]),"item.current_price":e(({item:d})=>[a("span",Rt,o(l(R)(d.price||0)),1)]),"item.current_cost":e(({item:d})=>[a("span",Ft,o(l(R)(d.cost||0)),1)]),"item.margin":e(({item:d})=>[a("div",jt,[t(N,{color:F(d.margin_amount),variant:"tonal",size:"small",class:"mb-1"},{default:e(()=>[r(o(l(R)(d.margin_amount)),1)]),_:2},1032,["color"]),a("span",Ot,o(d.margin_percent.toFixed(1))+"% ",1)])]),"item.hpp_status":e(({item:d})=>[t(N,{color:d.hpp_status.color,"prepend-icon":d.hpp_status.icon,variant:"tonal",size:"small"},{default:e(()=>[r(o(d.hpp_status.text),1)]),_:2},1032,["color","prepend-icon"])]),"item.actions":e(({item:d})=>[t(Ut,{product:d,onHppUpdated:i,onPriceUpdated:i,onProductUpdated:i},null,8,["product"])]),bottom:e(()=>[a("div",qt,[t(ae),a("div",Et,[a("div",Gt," Showing "+o(O.value.length)+" of "+o(m.value.length)+" products ",1),I.value>1?(P(),y(be,{key:0,modelValue:b.value,"onUpdate:modelValue":c[6]||(c[6]=d=>b.value=d),length:I.value,"total-visible":7,size:"small"},null,8,["modelValue","length"])):V("",!0)])])]),_:1},8,["items","loading","items-per-page","search"])]),_:1})]),_:1})]))}}),ba=Y(Qt,[["__scopeId","data-v-44113db1"]]);export{ba as default};
