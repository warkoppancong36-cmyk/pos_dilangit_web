import{D as St}from"./DeleteConfirmationDialog-C3SR5WIm.js";import{f as He}from"./formatters-BD6tdLx_.js";import{P as dt,u as Bt}from"./useProductItems-Du1HeEif.js";import{I as Ft}from"./ItemsApi-CT2GWEOy.js";import{u as _t,H as Et}from"./HPPBreakdownDialog-B1TeHPZ1.js";import{V as Ee}from"./VDialog-BhHbwSp-.js";import{V as ee,b as we,c as Re}from"./VCard-KdKd0_zs.js";import{a6 as Rt,a7 as Lt,ae as qt,r as I,b0 as ot,af as Nt,b5 as wt,bf as Ot,V as me,W as jt,w as Ce,br as Pt,aL as ft,a8 as Jt,b as e,p as he,ba as Wt,cx as Gt,c8 as Vt,bd as Qt,F as Te,X as _,cm as Xt,c9 as Zt,aY as Yt,s as d,d as Fe,D as et,c as X,f as t,e as o,t as r,a1 as F,g as K,l as W,m as H,aw as it,cw as ct,at as Ke,i as We,v as Ge,o as v,_ as Le,ay as gt,a0 as kt,j as It,cy as ea,bp as ta,au as Ne,ao as aa,ap as la,a3 as mt}from"./main-mVb2Zi2r.js";import{V as ae}from"./VCardText-C6cQ2YPR.js";import{V as $e}from"./VAvatar-CPl1Rs8l.js";import{V as oe}from"./VChip-DfcpfFlX.js";import{V as Se,a as $}from"./VRow-BmgHKxKl.js";import{V as yt}from"./VAutocomplete-DglK-3Jh.js";import{u as oa,t as st,V as nt,a as je,b as Ye,d as tt}from"./VList-B7SLC7Gv.js";import{u as sa,V as xe,m as ia}from"./VTextField-BbvOAUmR.js";import{V as Ze}from"./VSwitch-BrRftdBW.js";import{V as Oe}from"./VSpacer-DKRYQo20.js";import{V as at}from"./VSnackbar-BzZyYdAp.js";import{P as na}from"./ProductsApi-TiulAREm.js";import{u as ra,m as ua,a as da,V as Be}from"./VSelect-DaQg8yMC.js";import{V as ca}from"./VCheckbox-WHZKe8D-.js";import{V as Ue}from"./VDivider-Dg-qwhzs.js";import{a as ma,V as va}from"./VDataTable-CBL58a2p.js";import{V as pa}from"./VContainer-Du07OJ9E.js";import{a as Dt,u as fa,P as ga}from"./useProducts-CQF5nE5_.js";import{V as bt}from"./VForm-Crx42ANL.js";import{V as Ct}from"./VTextarea-DGBVzz8_.js";import{V as Me}from"./VTooltip-DGe7dXvC.js";import{m as _a,V as ka}from"./VImg-DDUr8xsk.js";import{V as ya,u as ba}from"./useCategories-DiT35Y6D.js";import{u as ha,m as xa,h as wa}from"./filter-BpN1xjbh.js";import{f as Pa}from"./forwardRefs-B931MWyl.js";import{V as Va}from"./VMenu-MXx5zkZ-.js";import{V as Ca}from"./VCheckboxBtn-Bjfx1eIL.js";import{V as $a}from"./VDataTableServer-20j8L5ll.js";import{V as Sa}from"./VSkeletonLoader-DhjbNmVb.js";import{V as Ia,a as Da,b as vt,c as pt}from"./VTabs-TOblgNa6.js";import"./api-BJzohsYF.js";import"./index-D-EbNoF1.js";import"./VOverlay-Q1I2eFOg.js";/* empty css              */import"./VTable-COTb2rj8.js";import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-WCdFWsP5.js";const za=Lt({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...xa({filterKeys:["title"]}),...ua({hideNoData:!0,returnObject:!0}),...Wt(ia({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),..._a({transition:!1})},"VCombobox"),Ta=Rt()({name:"VCombobox",props:za(),emits:{"update:focused":S=>!0,"update:modelValue":S=>!0,"update:search":S=>!0,"update:menu":S=>!0},setup(S,be){var n;let{emit:q,slots:z}=be;const{t:J}=qt(),g=I(),G=ot(!1),T=ot(!0),h=ot(!1),p=I(),j=I(),f=ot(-1);let U=!1;const{items:de,transformIn:ke,transformOut:C}=oa(S),{textColorClasses:re,textColorStyles:se}=Nt(()=>{var s;return(s=g.value)==null?void 0:s.color}),Q=wt(S,"modelValue",[],s=>ke(Ot(s)),s=>{const V=C(s);return S.multiple?V:V[0]??null}),ve=sa(S),b=me(()=>!!(S.chips||z.chip)),m=me(()=>b.value||!!z.selection),k=ot(!S.multiple&&!m.value?((n=Q.value[0])==null?void 0:n.title)??"":""),R=me({get:()=>k.value,set:s=>{var V;if(k.value=s??"",!S.multiple&&!m.value&&(Q.value=[st(S,s)]),s&&S.multiple&&((V=S.delimiters)!=null&&V.length)){const B=s.split(new RegExp(`(?:${S.delimiters.join("|")})+`));B.length>1&&(B.forEach(E=>{E=E.trim(),E&&Ae(st(S,E))}),k.value="")}s||(f.value=-1),T.value=!s}}),_e=me(()=>typeof S.counterValue=="function"?S.counterValue(Q.value):typeof S.counterValue=="number"?S.counterValue:S.multiple?Q.value.length:R.value.length),{filteredItems:pe,getMatches:fe}=ha(S,de,()=>T.value?"":R.value),w=me(()=>S.hideSelected?pe.value.filter(s=>!Q.value.some(V=>V.value===s.value)):pe.value),N=me(()=>S.hideNoData&&!w.value.length||ve.isReadonly.value||ve.isDisabled.value),x=wt(S,"menu"),O=me({get:()=>x.value,set:s=>{var V;x.value&&!s&&((V=p.value)!=null&&V.ΨopenChildren.size)||s&&N.value||(x.value=s)}}),M=jt(()=>O.value?S.closeText:S.openText);Ce(k,s=>{U?ft(()=>U=!1):G.value&&!O.value&&(O.value=!0),q("update:search",s)}),Ce(Q,s=>{var V;!S.multiple&&!m.value&&(k.value=((V=s[0])==null?void 0:V.title)??"")});const y=me(()=>Q.value.map(s=>s.value)),i=me(()=>{var V;return(S.autoSelectFirst===!0||S.autoSelectFirst==="exact"&&R.value===((V=w.value[0])==null?void 0:V.title))&&w.value.length>0&&!T.value&&!h.value}),a=I(),l=ra(a,g);function u(s){U=!0,S.openOnClear&&(O.value=!0)}function te(){N.value||(O.value=!0)}function L(s){N.value||(G.value&&(s.preventDefault(),s.stopPropagation()),O.value=!O.value)}function ce(s){var V;s.key!==" "&&Vt(s)&&((V=g.value)==null||V.focus())}function ze(s){var E,c,A,Y;if(Gt(s)||ve.isReadonly.value)return;const V=(E=g.value)==null?void 0:E.selectionStart,B=Q.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(s.key)&&s.preventDefault(),["Enter","ArrowDown"].includes(s.key)&&(O.value=!0),["Escape"].includes(s.key)&&(O.value=!1),["Enter","Escape","Tab"].includes(s.key)&&(i.value&&["Enter","Tab"].includes(s.key)&&!Q.value.some(P=>{let{value:ie}=P;return ie===w.value[0].value})&&Ae(pe.value[0]),T.value=!0),s.key==="ArrowDown"&&i.value&&((c=a.value)==null||c.focus("next")),s.key==="Enter"&&R.value&&(Ae(st(S,R.value)),m.value&&(k.value="")),["Backspace","Delete"].includes(s.key)){if(!S.multiple&&m.value&&Q.value.length>0&&!R.value)return Ae(Q.value[0],!1);if(~f.value){s.preventDefault();const P=f.value;Ae(Q.value[f.value],!1),f.value=P>=B-1?B-2:P}else s.key==="Backspace"&&!R.value&&(f.value=B-1);return}if(S.multiple)if(s.key==="ArrowLeft"){if(f.value<0&&V&&V>0)return;const P=f.value>-1?f.value-1:B-1;Q.value[P]?f.value=P:(f.value=-1,(A=g.value)==null||A.setSelectionRange(R.value.length,R.value.length))}else if(s.key==="ArrowRight"){if(f.value<0)return;const P=f.value+1;Q.value[P]?f.value=P:(f.value=-1,(Y=g.value)==null||Y.setSelectionRange(0,0))}else~f.value&&Vt(s)&&(f.value=-1)}function le(){var s;S.eager&&((s=j.value)==null||s.calculateVisibleItems())}function De(){var s;G.value&&(T.value=!0,(s=g.value)==null||s.focus())}function Ae(s){let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!s||s.props.disabled))if(S.multiple){const B=Q.value.findIndex(c=>(S.valueComparator||Pt)(c.value,s.value)),E=V??!~B;if(~B){const c=E?[...Q.value,s]:[...Q.value];c.splice(B,1),Q.value=c}else E&&(Q.value=[...Q.value,s]);S.clearOnSelect&&(R.value="")}else{const B=V!==!1;Q.value=B?[s]:[],k.value=B&&!m.value?s.title:"",ft(()=>{O.value=!1,T.value=!0})}}function Qe(s){G.value=!0,setTimeout(()=>{h.value=!0})}function Je(s){h.value=!1}function D(s){(s==null||s===""&&!S.multiple&&!m.value)&&(Q.value=[])}return Ce(G,(s,V)=>{if(!(s||s===V)&&(f.value=-1,O.value=!1,R.value)){if(S.multiple){Ae(st(S,R.value));return}if(!m.value)return;Q.value.some(B=>{let{title:E}=B;return E===R.value})?k.value="":Ae(st(S,R.value))}}),Ce(O,()=>{if(!S.hideSelected&&O.value&&Q.value.length){const s=w.value.findIndex(V=>Q.value.some(B=>(S.valueComparator||Pt)(B.value,V.value)));Qt&&window.requestAnimationFrame(()=>{var V;s>=0&&((V=j.value)==null||V.scrollToIndex(s))})}}),Ce(()=>S.items,(s,V)=>{O.value||G.value&&!V.length&&s.length&&(O.value=!0)}),Jt(()=>{const s=!!(!S.hideNoData||w.value.length||z["prepend-item"]||z["append-item"]||z["no-data"]),V=Q.value.length>0,B=xe.filterProps(S);return e(xe,he({ref:g},B,{modelValue:R.value,"onUpdate:modelValue":[E=>R.value=E,D],focused:G.value,"onUpdate:focused":E=>G.value=E,validationValue:Q.externalValue,counterValue:_e.value,dirty:V,class:["v-combobox",{"v-combobox--active-menu":O.value,"v-combobox--chips":!!S.chips,"v-combobox--selection-slot":!!m.value,"v-combobox--selecting-index":f.value>-1,[`v-combobox--${S.multiple?"multiple":"single"}`]:!0},S.class],style:S.style,readonly:ve.isReadonly.value,placeholder:V?void 0:S.placeholder,"onClick:clear":u,"onMousedown:control":te,onKeydown:ze}),{...z,default:()=>e(Te,null,[e(Va,he({ref:p,modelValue:O.value,"onUpdate:modelValue":E=>O.value=E,activator:"parent",contentClass:"v-combobox__content",disabled:N.value,eager:S.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:S.transition,onAfterEnter:le,onAfterLeave:De},S.menuProps),{default:()=>[s&&e(nt,he({ref:a,selected:y.value,selectStrategy:S.multiple?"independent":"single-independent",onMousedown:E=>E.preventDefault(),onKeydown:ce,onFocusin:Qe,onFocusout:Je,tabindex:"-1","aria-live":"polite",color:S.itemColor??S.color},l,S.listProps),{default:()=>{var E,c,A;return[(E=z["prepend-item"])==null?void 0:E.call(z),!w.value.length&&!S.hideNoData&&(((c=z["no-data"])==null?void 0:c.call(z))??e(je,{key:"no-data",title:J(S.noDataText)},null)),e(da,{ref:j,renderless:!0,items:w.value,itemKey:"value"},{default:Y=>{var Pe;let{item:P,index:ie,itemRef:ue}=Y;const ne=he(P.props,{ref:ue,key:P.value,active:i.value&&ie===0?!0:void 0,onClick:()=>Ae(P,null)});return((Pe=z.item)==null?void 0:Pe.call(z,{item:P,index:ie,props:ne}))??e(je,he(ne,{role:"option"}),{prepend:ye=>{let{isSelected:Ve}=ye;return e(Te,null,[S.multiple&&!S.hideSelected?e(Ca,{key:P.value,modelValue:Ve,ripple:!1,tabindex:"-1"},null):void 0,P.props.prependAvatar&&e($e,{image:P.props.prependAvatar},null),P.props.prependIcon&&e(_,{icon:P.props.prependIcon},null)])},title:()=>{var ye;return T.value?P.title:wa("v-combobox",P.title,(ye=fe(P))==null?void 0:ye.title)}})}}),(A=z["append-item"])==null?void 0:A.call(z)]}})]}),Q.value.map((E,c)=>{function A(ue){ue.stopPropagation(),ue.preventDefault(),Ae(E,!1)}const Y={"onClick:close":A,onKeydown(ue){ue.key!=="Enter"&&ue.key!==" "||(ue.preventDefault(),ue.stopPropagation(),A(ue))},onMousedown(ue){ue.preventDefault(),ue.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},P=b.value?!!z.chip:!!z.selection,ie=P?Zt(b.value?z.chip({item:E,index:c,props:Y}):z.selection({item:E,index:c})):void 0;if(!(P&&!ie))return e("div",{key:E.value,class:["v-combobox__selection",c===f.value&&["v-combobox__selection--selected",re.value]],style:c===f.value?se.value:{}},[b.value?z.chip?e(Yt,{key:"chip-defaults",defaults:{VChip:{closable:S.closableChips,size:"small",text:E.title}}},{default:()=>[ie]}):e(oe,he({key:"chip",closable:S.closableChips,size:"small",text:E.title,disabled:E.props.disabled},Y),null):ie??e("span",{class:"v-combobox__selection-text"},[E.title,S.multiple&&c<Q.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[d(",")])])])})]),"append-inner":function(){var Y,P;for(var E=arguments.length,c=new Array(E),A=0;A<E;A++)c[A]=arguments[A];return e(Te,null,[(Y=z["append-inner"])==null?void 0:Y.call(z,...c),(!S.hideNoData||S.items.length)&&S.menuIcon?e(_,{class:"v-combobox__menu-icon",color:(P=g.value)==null?void 0:P.fieldIconColor,icon:S.menuIcon,onMousedown:L,onClick:Xt,"aria-label":J(M.value),title:J(M.value),tabindex:"-1"},null):void 0])}})}),Pa({isFocused:G,isPristine:T,menu:O,search:R,selectionIndex:f,filteredItems:pe,select:Ae},g)}}),Ua={class:"d-flex align-center gap-3"},Aa={class:"text-body-2 ma-0 opacity-90"},Ha={class:"d-flex align-center gap-4"},Ma={class:"flex-grow-1"},Ka={class:"text-h6 font-weight-bold mb-1"},Ba={class:"text-body-2 text-medium-emphasis mb-1"},Fa={class:"d-flex align-center gap-4 mb-0"},Ea={class:"text-body-2 text-medium-emphasis mb-0"},Ra={class:"text-body-2 text-info mb-0 font-weight-medium"},La={key:0,class:"text-body-2 text-success mb-0 font-weight-medium"},qa={class:"text-body-1 font-weight-bold"},Na={class:"text-body-1 font-weight-bold"},Oa={class:"text-body-1 font-weight-bold"},ja={class:"text-body-1 font-weight-bold"},Ja={class:"d-flex align-center justify-space-between w-100"},Wa={class:"d-flex align-center"},Ga={key:0,class:"text-warning"},Qa={key:1},Xa={key:0,class:"text-center pa-8"},Za={class:"d-flex align-center gap-4 mt-1"},Ya={key:1,class:"text-primary"},el={class:"d-flex gap-2"},tl=Fe({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup(S,{emit:be}){const q=S,z=be,J=me({get:()=>q.modelValue,set:D=>z("update:modelValue",D)}),g=I(!1),G=I([]),T=I(!1),h=I(!1),p=I(""),j=I(""),f=I(!1),U=I(-1),de=I(!1),{loading:ke,currentHPPBreakdown:C,getProductHPPBreakdown:re}=_t(),se=me(()=>{var D,n,s;return((D=C.value)==null?void 0:D.total_hpp)||((n=q.product)==null?void 0:n.hpp)||((s=q.product)==null?void 0:s.cost)||0}),Q=me(()=>{var s;const D=((s=q.product)==null?void 0:s.price)||0,n=se.value;return D-n}),ve=me(()=>{var s;const D=((s=q.product)==null?void 0:s.price)||0,n=se.value;return D<=0?0:Math.round((D-n)/D*100)}),b=I({itemId:null,quantity:1,isCritical:!1}),m=I([]),k=I(!1),R=I([]),_e=async()=>{var D;if(q.product)try{const n=q.product.id_product||q.product.id,s=await dt.getAll({product_id:n,page:1,per_page:1e5});s.success&&((D=s.data)!=null&&D.data)&&(G.value=s.data.data,R.value=JSON.parse(JSON.stringify(s.data.data)))}catch(n){console.error("Error fetching product composition:",n)}},pe=async()=>{var D;k.value=!0;try{const n=await Ft.getAll({page:1,per_page:1e5,active:!0});n.success&&((D=n.data)!=null&&D.data)&&(m.value=n.data.data.map(s=>{var V,B,E;return{id:((V=s.id_item)==null?void 0:V.toString())||((B=s.id)==null?void 0:B.toString()),name:s.name,current_stock:((E=s.inventory)==null?void 0:E.current_stock)||0,unit:s.unit||"pcs"}}))}catch(n){console.error("Error fetching available items:",n),m.value=[]}finally{k.value=!1}},fe=me(()=>b.value.itemId&&b.value.quantity>0);me(()=>{if(!b.value.itemId)return null;const D=m.value.find(n=>n.id===b.value.itemId);return(D==null?void 0:D.unit)||null});const w=me(()=>{if(!b.value.itemId)return null;const D=m.value.find(n=>n.id===b.value.itemId);return D?O(D):null}),N=me(()=>w.value!==null&&w.value<=0),x=me(()=>Array.isArray(m.value)?m.value:[]),O=D=>D.current_stock||D.stock||0,M=()=>k.value?"Memuat items...":!m.value||m.value.length===0?"Tidak ada item tersedia":"Tidak ada item yang ditemukan",y=D=>{const n=O(D);return n>50?"success":n>20?"warning":n>0?"error":"grey"},i=D=>{const n=O(D);return n>50?"Aman":n>20?"Rendah":n>0?"Kritis":"Habis"};Ce(()=>q.items,D=>{D&&D.length>0,G.value=[...D]},{immediate:!0}),Ce(()=>q.modelValue,async D=>{D&&q.product&&(_e(),await a())});const a=async()=>{if(q.product&&(q.product.id_product||q.product.id))try{const D=parseInt(String(q.product.id_product||q.product.id));await re(D,"latest")}catch(D){console.warn("Could not load HPP data:",D)}};et(()=>{pe()});const l=()=>{de.value=!0},u=async()=>{await a(),z("refresh")},te=()=>G.value.some(n=>{var s;return((s=n.item)==null?void 0:s.inventory)&&n.item.inventory.current_stock<n.quantity_needed})?"error":"success",L=()=>G.value.some(n=>{var s;return((s=n.item)==null?void 0:s.inventory)&&n.item.inventory.current_stock<n.quantity_needed})?"Stok Kritis":"Stok Aman",ce=()=>{if(!fe.value)return;const D=m.value.find(V=>V.id===b.value.itemId);if(!D)return;if(G.value.find(V=>{var B;return((B=V.item)==null?void 0:B.id)===D.id})){p.value=`Item "${D.name}" sudah ada dalam komposisi produk ini`,T.value=!0;return}const s={id_product_item:`temp_${Date.now()}`,item:{id:String(D.id),name:D.name,inventory:{current_stock:D.current_stock||0}},quantity_needed:b.value.quantity,unit:b.value.unit,is_critical:b.value.isCritical};G.value.push(s),De()},ze=(D,n)=>{var B;if(m.value.length===0){console.warn("⚠️ Available items not loaded yet, fetching..."),pe().then(()=>{ze(D,n)});return}f.value=!0,U.value=n;let s=((B=D.item)==null?void 0:B.id)||null;if(s!==null&&(s=s.toString()),b.value={itemId:s,quantity:parseFloat(D.quantity_needed.toString())||0,unit:D.unit,isCritical:D.is_critical},!m.value.find(E=>E.id===s)){console.warn("⚠️ Item ID not found in available items, trying alternative matching...");const E=m.value.find(c=>{var A;return c.name===((A=D.item)==null?void 0:A.name)});E?b.value.itemId=E.id:console.error("❌ Could not find item in available items by ID or name")}},le=()=>{if(!fe.value||U.value===-1)return;const D=m.value.find(n=>n.id===b.value.itemId);D&&(G.value[U.value]={...G.value[U.value],item:{id:String(D.id),name:D.name,inventory:{current_stock:D.current_stock||0}},quantity_needed:b.value.quantity,unit:b.value.unit,is_critical:b.value.isCritical},De())},De=()=>{f.value=!1,U.value=-1,b.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},Ae=D=>{G.value.splice(D,1)},Qe=async()=>{var D,n,s,V,B,E,c,A,Y;if(q.product){g.value=!0;try{const P=parseInt(String(((D=q.product)==null?void 0:D.id_product)||((n=q.product)==null?void 0:n.id)||"0")),ie=R.value||[],ue=G.value;for(const ne of ue){const Pe=ie.find(Ve=>{var qe,Xe;return!!(Ve.id_product_item===ne.id_product_item||ne.id_product_item&&!ne.id_product_item.toString().startsWith("temp_")&&((qe=Ve.item)==null?void 0:qe.id)===((Xe=ne.item)==null?void 0:Xe.id))});if(!((s=ne.item)!=null&&s.id)||parseInt(ne.item.id)===0){console.warn("⚠️ Skipping item with invalid item_id:",{item_name:(V=ne.item)==null?void 0:V.name,item_id:(B=ne.item)==null?void 0:B.id,full_item:ne});continue}const ye={product_id:P,item_id:parseInt(((E=ne.item)==null?void 0:E.id)||"0"),quantity_needed:parseFloat(ne.quantity_needed.toString()),is_critical:ne.is_critical,notes:ne.notes||""};try{Pe&&!((c=ne.id_product_item)!=null&&c.toString().startsWith("temp_"))?await dt.update(parseInt(Pe.id_product_item||"0"),ye):await dt.create(ye)}catch(Ve){throw console.error("❌ Error processing item:",Ve),(A=Ve.message)!=null&&A.includes("already assigned")?p.value=`Item "${(Y=ne.item)==null?void 0:Y.name}" sudah ditambahkan ke produk ini`:p.value=Ve.message||"Terjadi kesalahan saat menyimpan item",T.value=!0,Ve}}for(const ne of ie)if(!ue.find(ye=>ye.id_product_item===ne.id_product_item)&&ne.id_product_item)try{await dt.delete(parseInt(ne.id_product_item))}catch(ye){console.error("❌ Error deleting item:",ye),p.value=`Gagal menghapus item: ${ye.message}`,T.value=!0}j.value="Komposisi produk berhasil disimpan!",h.value=!0,z("save",{product:q.product,items:G.value}),z("refresh"),Je()}catch(P){console.error("❌ Error saving composition:",P),T.value||(p.value=P.message||"Terjadi kesalahan saat menyimpan komposisi",T.value=!0)}finally{g.value=!1}}},Je=()=>{J.value=!1,setTimeout(()=>{G.value=[...q.items],De()},300)};return(D,n)=>{var s,V,B,E;return v(),X(Te,null,[e(Ee,{modelValue:J.value,"onUpdate:modelValue":n[8]||(n[8]=c=>J.value=c),"max-width":"900",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var c;return[o("div",Ua,[e(_,{icon:"mdi-chef-hat",size:"24"}),o("div",null,[n[11]||(n[11]=o("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),o("p",Aa,r(((c=D.product)==null?void 0:c.name)||"Produk"),1)])]),e(F,{icon:"mdi-close",variant:"text",size:"small",onClick:Je})]}),_:1}),e(ae,{class:"pa-6"},{default:t(()=>[e(ee,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(ae,{class:"pa-4"},{default:t(()=>{var c,A,Y,P,ie,ue;return[o("div",Ha,[e($e,{image:(c=D.product)==null?void 0:c.image_url,size:"64"},{default:t(()=>{var ne;return[(ne=D.product)!=null&&ne.image_url?W("",!0):(v(),K(_,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),o("div",Ma,[o("h4",Ka,r((A=D.product)==null?void 0:A.name),1),o("p",Ba," SKU: "+r(((Y=D.product)==null?void 0:Y.sku)||"SKU-"+((P=D.product)==null?void 0:P.id_product)),1),o("div",Fa,[o("p",Ea," Harga: "+r(H(He)(((ie=D.product)==null?void 0:ie.price)||0)),1),o("p",Ra," HPP: "+r(H(He)(se.value)),1),(ue=D.product)!=null&&ue.price&&se.value?(v(),X("p",La," Margin: "+r(H(He)(Q.value)),1)):W("",!0)])]),e(oe,{color:te(),variant:"tonal"},{default:t(()=>[d(r(L()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e(Se,{class:"mb-6"},{default:t(()=>[e($,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"info"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>[e(_,{icon:"mdi-calculator",size:"20",class:"mb-1"}),o("div",qa,[d(r(H(He)(se.value))+" ",1),H(ke)?(v(),K(it,{key:0,indeterminate:"",size:"12",width:"2",class:"ml-1"})):W("",!0)]),n[12]||(n[12]=o("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[12]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"primary"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>{var c;return[e(_,{icon:"mdi-currency-usd",size:"20",class:"mb-1"}),o("div",Na,r(H(He)(((c=D.product)==null?void 0:c.price)||0)),1),n[13]||(n[13]=o("div",{class:"text-caption"},"Harga Jual",-1))]}),_:1,__:[13]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"success"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>[e(_,{icon:"mdi-trending-up",size:"20",class:"mb-1"}),o("div",Oa,r(H(He)(Q.value)),1),n[14]||(n[14]=o("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[14]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"warning"},{default:t(()=>[e(ae,{class:"text-center pa-3"},{default:t(()=>[e(_,{icon:"mdi-percent",size:"20",class:"mb-1"}),o("div",ja,r(ve.value)+"% ",1),n[15]||(n[15]=o("div",{class:"text-caption"},"Margin %",-1))]),_:1,__:[15]})]),_:1})]),_:1})]),_:1}),e(ee,{class:"mb-6",elevation:"2"},{default:t(()=>[e(we,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[o("div",Ja,[o("div",Wa,[e(_,{icon:f.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),d(" "+r(f.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(ae,{class:"pa-4"},{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12",md:"4"},{default:t(()=>[e(yt,{modelValue:b.value.itemId,"onUpdate:modelValue":n[0]||(n[0]=c=>b.value.itemId=c),items:x.value,loading:k.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item (termasuk yang stok kosong)...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":M()},{item:t(({props:c,item:A})=>[e(je,he(c,{class:{"text-medium-emphasis":O(A.raw)<=0}}),{prepend:t(()=>[e($e,{size:"32",class:"me-3",color:O(A.raw)<=0?"warning":"primary",variant:"tonal"},{default:t(()=>[e(_,{icon:"mdi-package-variant",color:O(A.raw)<=0?"warning":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[O(A.raw)>0?(v(),K(oe,{key:0,size:"x-small",color:y(A.raw),variant:"tonal"},{default:t(()=>[d(r(i(A.raw)),1)]),_:2},1032,["color"])):(v(),K(oe,{key:1,size:"x-small",color:"warning",variant:"tonal","prepend-icon":"mdi-alert"},{default:t(()=>n[17]||(n[17]=[d(" Kosong ")])),_:1,__:[17]}))]),default:t(()=>[e(Ye,null,{default:t(()=>[d(r(A.raw.name),1)]),_:2},1024),e(tt,{class:"text-medium-emphasis"},{default:t(()=>[O(A.raw)<=0?(v(),X("span",Ga,[e(_,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),n[16]||(n[16]=d(" Stok Kosong - Masih bisa digunakan "))])):(v(),X("span",Qa," Stok: "+r(O(A.raw))+" "+r(A.raw.unit),1))]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:b.value.quantity,"onUpdate:modelValue":n[1]||(n[1]=c=>b.value.quantity=c),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Ze,{modelValue:b.value.isCritical,"onUpdate:modelValue":n[2]||(n[2]=c=>b.value.isCritical=c),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(F,{color:f.value?"success":"primary",block:"","prepend-icon":f.value?"mdi-check":"mdi-plus",onClick:n[3]||(n[3]=c=>f.value?le():ce()),disabled:!fe.value},{default:t(()=>[d(r(f.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),f.value?(v(),K(F,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:De},{default:t(()=>n[18]||(n[18]=[d(" Batal ")])),_:1,__:[18]})):W("",!0)]),_:1})]),_:1}),N.value?(v(),K(Ke,{key:0,color:"warning",variant:"tonal",class:"mt-4","prepend-icon":"mdi-alert"},{default:t(()=>[e(ct,null,{default:t(()=>n[19]||(n[19]=[d("Item Stok Kosong")])),_:1,__:[19]}),n[20]||(n[20]=o("div",null,"Item yang dipilih sedang kosong stok, namun masih bisa ditambahkan ke komposisi. Pastikan untuk memperbarui stok sebelum produksi.",-1))]),_:1,__:[20]})):W("",!0)]),_:1})]),_:1}),e(ee,{elevation:"2"},{default:t(()=>[e(we,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e(_,{icon:"mdi-format-list-bulleted",class:"me-2"}),d(" Daftar Item Komposisi ("+r(G.value.length)+") ",1)]),_:1}),e(ae,{class:"pa-0"},{default:t(()=>[G.value.length===0?(v(),X("div",Xa,[e(_,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),n[21]||(n[21]=o("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),n[22]||(n[22]=o("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(v(),K(nt,{key:1},{default:t(()=>[(v(!0),X(Te,null,We(G.value,(c,A)=>(v(),K(je,{key:c.id||A,class:"border-b"},{prepend:t(()=>[e($e,{size:"40",class:"me-3"},{default:t(()=>{var Y,P;return[e(_,{icon:(Y=c.item)!=null&&Y.inventory&&c.item.inventory.current_stock>=c.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(P=c.item)!=null&&P.inventory&&c.item.inventory.current_stock>=c.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[o("div",el,[e(F,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:Y=>ze(c,A)},null,8,["onClick"]),e(F,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:Y=>Ae(A)},null,8,["onClick"])])]),default:t(()=>[e(Ye,{class:"font-weight-medium"},{default:t(()=>{var Y;return[d(r(((Y=c.item)==null?void 0:Y.name)||"Item tidak ditemukan")+" ",1),c.is_critical?(v(),K(oe,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>n[23]||(n[23]=[d(" Kritis ")])),_:1,__:[23]})):W("",!0)]}),_:2},1024),e(tt,null,{default:t(()=>{var Y;return[o("div",Za,[o("span",null,"Dibutuhkan: "+r(parseFloat(c.quantity_needed))+" "+r(c.unit),1),(Y=c.item)!=null&&Y.inventory?(v(),X("span",{key:0,class:Ge(c.item.inventory.current_stock>=c.quantity_needed?"text-success":"text-error")}," Stok: "+r(c.item.inventory.current_stock)+" "+r(c.unit),3)):W("",!0),c.formatted_total_cost?(v(),X("span",Ya,r(c.formatted_total_cost),1)):W("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(Re,{class:"pa-6 pt-0"},{default:t(()=>[e(F,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:l},{default:t(()=>n[24]||(n[24]=[d(" Setting HPP ")])),_:1,__:[24]}),e(Oe),e(F,{variant:"outlined",onClick:Je},{default:t(()=>n[25]||(n[25]=[d(" Batal ")])),_:1,__:[25]}),e(F,{color:"primary",onClick:Qe,loading:g.value},{default:t(()=>n[26]||(n[26]=[d(" Simpan Komposisi ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1}),e(at,{modelValue:T.value,"onUpdate:modelValue":n[5]||(n[5]=c=>T.value=c),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(F,{color:"white",variant:"text",onClick:n[4]||(n[4]=c=>T.value=!1)},{default:t(()=>n[27]||(n[27]=[d(" Tutup ")])),_:1,__:[27]})]),default:t(()=>[d(r(p.value)+" ",1)]),_:1},8,["modelValue"]),e(at,{modelValue:h.value,"onUpdate:modelValue":n[7]||(n[7]=c=>h.value=c),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(F,{color:"white",variant:"text",onClick:n[6]||(n[6]=c=>h.value=!1)},{default:t(()=>n[28]||(n[28]=[d(" Tutup ")])),_:1,__:[28]})]),default:t(()=>[d(r(j.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(Et,{modelValue:de.value,"onUpdate:modelValue":n[9]||(n[9]=c=>de.value=c),"product-id":parseInt(String(((s=D.product)==null?void 0:s.id_product)||((V=D.product)==null?void 0:V.id)||"0")),"product-name":((B=D.product)==null?void 0:B.product_name)||((E=D.product)==null?void 0:E.name),onHppUpdated:u,onPriceUpdated:n[10]||(n[10]=c=>z("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),zt=Le(tl,[["__scopeId","data-v-8422e870"]]),al={class:"product-selection"},ll={key:0,class:"text-center pa-4"},ol={key:1,class:"product-list",style:{"max-height":"400px","overflow-y":"auto"}},sl={class:"d-flex flex-column align-end"},il={key:0,class:"text-body-2 text-primary font-weight-medium"},nl={key:2,class:"text-center pa-8"},rl={class:"text-h6 mt-2 text-medium-emphasis"},ul={class:"text-body-2 text-medium-emphasis"},dl=Fe({__name:"ProductSelectionList",emits:["select"],setup(S,{emit:be}){const q=be,z=I([]),J=I(!1),g=I(""),G=async()=>{try{J.value=!0;const h=await na.getAll({per_page:100,search:g.value,active:!0});h.success&&(z.value=h.data||[])}catch(h){console.error("Error fetching products:",h)}finally{J.value=!1}},T=h=>{q("select",h)};return et(()=>{G()}),(h,p)=>(v(),X("div",al,[e(xe,{modelValue:g.value,"onUpdate:modelValue":[p[0]||(p[0]=j=>g.value=j),G],label:"Cari produk...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",class:"mb-3"},null,8,["modelValue"]),J.value?(v(),X("div",ll,[e(it,{indeterminate:"",color:"primary"}),p[1]||(p[1]=o("div",{class:"mt-2"},"Memuat produk...",-1))])):z.value.length>0?(v(),X("div",ol,[e(nt,{density:"compact"},{default:t(()=>[(v(!0),X(Te,null,We(z.value,j=>(v(),K(je,{key:j.id_product||j.id,class:"product-item",onClick:f=>T(j),style:{cursor:"pointer"},ripple:!0},{prepend:t(()=>[j.image_url?(v(),K($e,{key:0,image:j.image_url,size:"32",class:"me-3"},null,8,["image"])):(v(),K(_,{key:1,icon:"mdi-package-variant",size:"32",color:"grey-lighten-1",class:"me-3"}))]),append:t(()=>[o("div",sl,[j.price?(v(),X("div",il,r(j.formatted_price||H(He)(j.price)),1)):W("",!0),e(_,{icon:"mdi-chevron-right",size:"16",color:"grey-lighten-1"})])]),default:t(()=>[e(Ye,{class:"text-body-2"},{default:t(()=>[d(r(j.name),1)]),_:2},1024),j.sku?(v(),K(tt,{key:0,class:"text-caption"},{default:t(()=>[d(" SKU: "+r(j.sku),1)]),_:2},1024)):W("",!0)]),_:2},1032,["onClick"]))),128))]),_:1})])):(v(),X("div",nl,[e(_,{icon:"mdi-package-variant-closed",size:"64",color:"grey-lighten-2"}),o("div",rl,r(g.value?"Tidak ada produk ditemukan":"Belum ada produk"),1),o("div",ul,r(g.value?"Coba ubah kata kunci pencarian":"Tambah produk terlebih dahulu"),1)]))]))}}),cl=Le(dl,[["__scopeId","data-v-1280b878"]]),ml={class:"composition-cards"},vl={class:"d-flex gap-2"},pl={key:1,class:"text-center pa-12"},fl={key:2,class:"text-center pa-12"},gl={class:"d-flex align-center gap-3"},_l={class:"flex-grow-1 min-width-0"},kl={class:"text-h6 font-weight-bold text-truncate"},yl={class:"text-caption text-medium-emphasis mb-0"},bl={class:"d-flex align-center gap-2 mb-3"},hl={class:"text-body-2 font-weight-medium"},xl={class:"composition-items"},wl={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},Pl={class:"text-body-2 text-truncate"},Vl={class:"text-end flex-shrink-0"},Cl={class:"text-body-2 font-weight-medium"},$l={key:0,class:"text-caption text-success"},Sl={key:1,class:"text-caption text-primary"},Il={class:"d-flex justify-between align-center mb-3"},Dl={class:"text-h6 font-weight-bold text-primary"},zl={class:"d-flex gap-2"},Tl={key:4,class:"d-flex justify-center mt-6"},Ul={key:5,class:"text-center mt-4"},Al={class:"d-flex align-center"},Hl={class:"d-flex align-center gap-4"},Ml={class:"flex-grow-1"},Kl={class:"text-h5 font-weight-bold mb-2"},Bl={class:"d-flex align-center gap-4 mb-2"},Fl={class:"text-body-2"},El={class:"d-flex align-center gap-4"},Rl={class:"text-h6 text-primary font-weight-bold"},Ll={class:"text-body-2 text-info font-weight-medium"},ql={key:0,class:"text-body-2 text-success font-weight-medium"},Nl={class:"d-flex align-center mt-1 gap-4"},Ol={class:"d-flex align-center"},jl={class:"d-flex align-center"},Jl={key:0,class:"d-flex align-center"},Wl={class:"text-primary font-weight-medium"},Gl={key:1,class:"text-center py-8"},Ql={class:"text-h6 font-weight-bold"},Xl={class:"text-h6 font-weight-bold"},Zl={class:"text-h6 font-weight-bold"},Yl={class:"text-h6 font-weight-bold"},eo={class:"text-h6 font-weight-bold"},to=Fe({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup(S,{emit:be}){const q=S,z=be,J=I(!1),g=I(!1),G=I(!1),T=I(null),h=I([]),p=I(null),j=I(1),f=I(12),U=I({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),de=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],ke=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],C=i=>{T.value=i,h.value=i.items||[],J.value=!0},re=()=>{G.value=!0},se=i=>{T.value=i,h.value=[],G.value=!1,J.value=!0},Q=()=>{z("refresh"),y()},ve=i=>{p.value=i,g.value=!0},b=()=>{U.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},m=me(()=>!!(U.value.search||U.value.stockStatus||U.value.itemType||U.value.criticalOnly||U.value.sortBy!=="name_asc")),k=me(()=>{let i=0;return U.value.search&&i++,U.value.stockStatus&&i++,U.value.itemType&&i++,U.value.criticalOnly&&i++,U.value.sortBy!=="name_asc"&&i++,i}),R=me(()=>{const i=new Map;q.productItems.forEach(l=>{if(!l.product)return;const u=l.product.id_product||l.product.id;i.has(u)||i.set(u,{...l.product,items:[],totalItems:0}),i.get(u).items.push(l),i.get(u).totalItems++});let a=Array.from(i.values());if(U.value.search){const l=U.value.search.toLowerCase();a=a.filter(u=>u.name.toLowerCase().includes(l)||u.sku&&u.sku.toLowerCase().includes(l)||u.items.some(te=>{var L;return(L=te.item)==null?void 0:L.name.toLowerCase().includes(l)}))}return U.value.stockStatus&&(a=a.filter(l=>{const u=fe(l);switch(U.value.stockStatus){case"safe":return u.color==="success";case"critical":return u.color==="warning";case"out":return u.color==="error";default:return!0}})),U.value.criticalOnly&&(a=a.filter(l=>l.items.some(u=>u.is_critical))),a.sort((l,u)=>{switch(U.value.sortBy){case"name_asc":return l.name.localeCompare(u.name);case"name_desc":return u.name.localeCompare(l.name);case"price_asc":return(l.price||0)-(u.price||0);case"price_desc":return(u.price||0)-(l.price||0);case"items_asc":return l.totalItems-u.totalItems;case"items_desc":return u.totalItems-l.totalItems;default:return l.name.localeCompare(u.name)}}),a}),_e=me(()=>Math.ceil(R.value.length/f.value)),pe=me(()=>{const i=(j.value-1)*f.value,a=i+f.value;return R.value.slice(i,a)}),fe=i=>{let a=!1,l=!1;return i.items.forEach(u=>{var te;if((te=u.item)!=null&&te.inventory){const L=u.item.inventory.current_stock||0,ce=u.quantity_needed||0;L<=0?a=!0:(L<ce||u.is_critical)&&(l=!0)}}),a?{text:"Stok Habis",color:"error"}:l?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},w=i=>{if(!(i!=null&&i.inventory))return"grey";const a=i.inventory.current_stock||0;return a<=0?"error":a<=10?"warning":"success"},N=i=>{if(!(i!=null&&i.inventory))return"Tidak ada data";const a=i.inventory.current_stock||0;return a<=0?"Habis":a<=10?"Rendah":"Aman"},x=i=>{const a=w(i);return{"text-error":a==="error","text-warning":a==="warning","text-success":a==="success","text-grey":a==="grey"}},O=i=>`Item Komposisi (${i})`,M=i=>{j.value=i},y=()=>{j.value=1};return Ce(()=>[U.value.search,U.value.stockStatus,U.value.criticalOnly,U.value.sortBy],()=>{y()}),(i,a)=>(v(),X("div",ml,[e(ee,{class:"mb-6"},{default:t(()=>[e(we,{class:"d-flex align-center justify-between"},{default:t(()=>[a[16]||(a[16]=o("div",null,[o("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),o("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),o("div",vl,[e(F,{color:"primary","prepend-icon":"mdi-plus",onClick:re},{default:t(()=>a[14]||(a[14]=[d(" Tambah Komposisi ")])),_:1,__:[14]}),e(F,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:a[0]||(a[0]=l=>z("refresh")),loading:i.loading},{default:t(()=>a[15]||(a[15]=[d(" Refresh ")])),_:1,__:[15]},8,["loading"])])]),_:1,__:[16]})]),_:1}),e(ee,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ae,null,{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:U.value.search,"onUpdate:modelValue":a[1]||(a[1]=l=>U.value.search=l),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:U.value.stockStatus,"onUpdate:modelValue":a[2]||(a[2]=l=>U.value.stockStatus=l),items:de,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:U.value.sortBy,"onUpdate:modelValue":a[3]||(a[3]=l=>U.value.sortBy=l),items:ke,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(ca,{modelValue:U.value.criticalOnly,"onUpdate:modelValue":a[4]||(a[4]=l=>U.value.criticalOnly=l),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Se,{class:"mt-3"},{default:t(()=>[e($,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(F,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:b,disabled:!m.value},{default:t(()=>a[17]||(a[17]=[d(" Reset Filter ")])),_:1,__:[17]},8,["disabled"]),m.value?(v(),K(oe,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[d(r(k.value)+" filter aktif ",1)]),_:1})):W("",!0)]),_:1}),e($,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(oe,{color:R.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[d(r(R.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!i.loading&&R.value.length===0&&m.value?(v(),K(Ke,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):W("",!0),i.loading?(v(),X("div",pl,[e(it,{color:"primary",indeterminate:"",size:"64"}),a[18]||(a[18]=o("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):R.value.length===0?(v(),X("div",fl,[e(_,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),a[20]||(a[20]=o("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),a[21]||(a[21]=o("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(F,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:re},{default:t(()=>a[19]||(a[19]=[d(" Buat Komposisi Pertama ")])),_:1,__:[19]})])):(v(),K(Se,{key:3},{default:t(()=>[(v(!0),X(Te,null,We(pe.value,l=>(v(),K($,{key:l.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ee,{class:Ge(["composition-card h-100",{"border-error":fe(l).color==="error"}]),elevation:"2"},{default:t(()=>[e(we,{class:"pa-4 pb-2"},{default:t(()=>[o("div",gl,[e($e,{image:l.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[l.image_url?W("",!0):(v(),K(_,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),o("div",_l,[o("h3",kl,r(l.name),1),o("p",yl,r(l.sku||"SKU-"+l.id_product),1)])])]),_:2},1024),e(ae,{class:"py-2"},{default:t(()=>[e(oe,{color:fe(l).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[d(r(fe(l).text),1)]),_:2},1032,["color"]),o("div",bl,[e(_,{icon:"mdi-format-list-bulleted",size:"16"}),o("span",hl,r(O(l.totalItems)),1)]),o("div",xl,[(v(!0),X(Te,null,We(l.items,u=>{var te,L,ce,ze;return v(),X("div",{key:u.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[o("div",wl,[e(_,{icon:(te=u.item)!=null&&te.inventory&&u.item.inventory.current_stock>=u.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(L=u.item)!=null&&L.inventory&&u.item.inventory.current_stock>=u.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),o("span",Pl,r(((ce=u.item)==null?void 0:ce.name)||"Item tidak ditemukan"),1),u.is_critical?(v(),K(oe,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>a[22]||(a[22]=[d(" Kritis ")])),_:1,__:[22]})):W("",!0)]),o("div",Vl,[o("div",Cl,r(parseFloat(u.quantity_needed))+" "+r(u.unit),1),(ze=u.item)!=null&&ze.inventory?(v(),X("div",$l," Stok: "+r(u.item.inventory.current_stock)+" "+r(u.unit),1)):W("",!0),u.formatted_total_cost?(v(),X("div",Sl,r(u.formatted_total_cost),1)):W("",!0)])])}),128))])]),_:2},1024),e(ae,{class:"pt-0"},{default:t(()=>[e(Ue,{class:"mb-3"}),o("div",Il,[a[23]||(a[23]=o("span",{class:"text-body-2"},"Harga:",-1)),o("span",Dl,r(H(He)(l.price||0)),1)]),o("div",zl,[e(F,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:u=>ve(l)},{default:t(()=>a[24]||(a[24]=[d(" Detail ")])),_:2,__:[24]},1032,["onClick"]),e(F,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:u=>C(l)},{default:t(()=>a[25]||(a[25]=[d(" Kelola ")])),_:2,__:[25]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),R.value.length>f.value?(v(),X("div",Tl,[e(ma,{modelValue:j.value,"onUpdate:modelValue":[a[5]||(a[5]=l=>j.value=l),M],length:_e.value,"total-visible":i.$vuetify.display.smAndDown?5:7,size:"small"},null,8,["modelValue","length","total-visible"])])):W("",!0),R.value.length>0?(v(),X("div",Ul,[e(oe,{variant:"tonal",color:"primary",size:"small"},{default:t(()=>[d(" Menampilkan "+r((j.value-1)*f.value+1)+"-"+r(Math.min(j.value*f.value,R.value.length))+" dari "+r(R.value.length)+" produk ",1)]),_:1})])):W("",!0),e(zt,{modelValue:J.value,"onUpdate:modelValue":a[6]||(a[6]=l=>J.value=l),product:T.value,items:h.value,onSave:Q,onRefresh:a[7]||(a[7]=l=>z("refresh"))},null,8,["modelValue","product","items"]),e(Ee,{modelValue:g.value,"onUpdate:modelValue":a[11]||(a[11]=l=>g.value=l),"max-width":"900",scrollable:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",Al,[e(_,{icon:"mdi-eye",class:"mr-2",color:"primary"}),a[26]||(a[26]=o("span",null,"Detail Komposisi Produk",-1))]),e(F,{icon:"",variant:"text",onClick:a[8]||(a[8]=l=>g.value=!1)},{default:t(()=>[e(_,{icon:"mdi-close"})]),_:1})]),_:1}),e(Ue),p.value?(v(),K(ae,{key:0},{default:t(()=>[e(pa,null,{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12"},{default:t(()=>[e(ee,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(ae,null,{default:t(()=>[o("div",Hl,[e($e,{image:p.value.image_url,size:"80"},{default:t(()=>[p.value.image_url?W("",!0):(v(),K(_,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),o("div",Ml,[o("h2",Kl,r(p.value.name),1),o("div",Bl,[e(oe,{color:fe(p.value).color,variant:"tonal",size:"small"},{default:t(()=>[d(r(fe(p.value).text),1)]),_:1},8,["color"]),o("span",Fl,"SKU: "+r(p.value.sku||"-"),1)]),o("div",El,[o("div",Rl,r(H(He)(p.value.price||0)),1),o("div",Ll," HPP: "+r(H(He)(p.value.hpp||p.value.cost||0)),1),p.value.price&&(p.value.hpp||p.value.cost)?(v(),X("div",ql," Margin: "+r(H(He)((p.value.price||0)-(p.value.hpp||p.value.cost||0))),1)):W("",!0)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e(Se,null,{default:t(()=>[e($,{cols:"12"},{default:t(()=>[e(ee,{variant:"outlined"},{default:t(()=>[e(we,{class:"text-h6"},{default:t(()=>[e(_,{icon:"mdi-format-list-bulleted",class:"mr-2"}),d(" Komposisi Item ("+r(p.value.totalItems||0)+") ",1)]),_:1}),e(ae,null,{default:t(()=>[p.value.items&&p.value.items.length>0?(v(),K(nt,{key:0},{default:t(()=>[(v(!0),X(Te,null,We(p.value.items,(l,u)=>(v(),K(je,{key:l.id_product_item,class:"px-0"},{prepend:t(()=>[e($e,{size:"40",color:w(l.item),variant:"tonal"},{default:t(()=>{var te;return[e(_,{icon:(te=l.item)!=null&&te.inventory&&l.item.inventory.current_stock>=l.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(oe,{color:w(l.item),variant:"tonal",size:"small"},{default:t(()=>[d(r(N(l.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(Ye,{class:"font-weight-medium"},{default:t(()=>{var te;return[d(r(((te=l.item)==null?void 0:te.name)||"Unknown Item")+" ",1),l.is_critical?(v(),K(oe,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>a[27]||(a[27]=[d(" Kritis ")])),_:1,__:[27]})):W("",!0)]}),_:2},1024),e(tt,null,{default:t(()=>{var te,L;return[o("div",Nl,[o("div",Ol,[e(_,{icon:"mdi-scale",size:"14",class:"mr-1"}),o("span",null," Kebutuhan: "+r(Number(l.quantity_needed||0).toLocaleString("id-ID"))+" "+r(l.unit),1)]),o("div",jl,[e(_,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),o("span",{class:Ge(x(l.item))}," Stok: "+r(Number(((L=(te=l.item)==null?void 0:te.inventory)==null?void 0:L.current_stock)||0).toLocaleString("id-ID"))+" "+r(l.unit),3)]),l.formatted_total_cost?(v(),X("div",Jl,[e(_,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),o("span",Wl,r(l.formatted_total_cost),1)])):W("",!0)])]}),_:2},1024),u<p.value.items.length-1?(v(),K(Ue,{key:0,class:"mt-3"})):W("",!0)]),_:2},1024))),128))]),_:1})):(v(),X("div",Gl,[e(_,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),a[28]||(a[28]=o("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(Se,{class:"mt-4"},{default:t(()=>[e($,{cols:"12",md:"2"},{default:t(()=>[e(ee,{variant:"outlined",color:"primary"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(_,{icon:"mdi-format-list-bulleted",size:"24",class:"mb-2"}),o("div",Ql,r(p.value.totalItems||0),1),a[29]||(a[29]=o("div",{class:"text-caption"},"Total Item",-1))]),_:1,__:[29]})]),_:1})]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(ee,{variant:"outlined",color:"warning"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>{var l;return[e(_,{icon:"mdi-alert",size:"24",class:"mb-2"}),o("div",Xl,r(((l=p.value.items)==null?void 0:l.filter(u=>u.is_critical).length)||0),1),a[30]||(a[30]=o("div",{class:"text-caption"},"Item Kritis",-1))]}),_:1,__:[30]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"info"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(_,{icon:"mdi-calculator",size:"24",class:"mb-2"}),o("div",Zl,r(H(He)(p.value.hpp||p.value.cost||0)),1),a[31]||(a[31]=o("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[31]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(ee,{variant:"outlined",color:"success"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(_,{icon:"mdi-currency-usd",size:"24",class:"mb-2"}),o("div",Yl,r(H(He)(p.value.price||0)),1),a[32]||(a[32]=o("div",{class:"text-caption"},"Harga Jual",-1))]),_:1,__:[32]})]),_:1})]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(ee,{variant:"outlined",color:"purple"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[e(_,{icon:"mdi-trending-up",size:"24",class:"mb-2"}),o("div",eo,r(H(He)((p.value.price||0)-(p.value.hpp||p.value.cost||0))),1),a[33]||(a[33]=o("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[33]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):W("",!0),e(Ue),e(Re,{class:"pa-4"},{default:t(()=>[e(Oe),e(F,{variant:"outlined",onClick:a[9]||(a[9]=l=>g.value=!1)},{default:t(()=>a[34]||(a[34]=[d(" Tutup ")])),_:1,__:[34]}),e(F,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:a[10]||(a[10]=()=>{g.value=!1,C(p.value)})},{default:t(()=>a[35]||(a[35]=[d(" Kelola Komposisi ")])),_:1,__:[35]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ee,{modelValue:G.value,"onUpdate:modelValue":a[13]||(a[13]=l=>G.value=l),"max-width":"600px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-between pa-4"},{default:t(()=>[a[36]||(a[36]=o("span",{class:"text-h6"},"Pilih Produk untuk Komposisi",-1)),e(F,{variant:"text",icon:"mdi-close",size:"small",onClick:a[12]||(a[12]=l=>G.value=!1)})]),_:1,__:[36]}),e(ae,{class:"pa-4"},{default:t(()=>[e(cl,{onSelect:se})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),ao=Le(to,[["__scopeId","data-v-e2cb9847"]]),lo={class:"d-flex align-center gap-2"},oo={class:"text-white"},so={class:"text-h6 mb-4 d-flex align-center gap-2"},io={class:"text-h6 mb-4 d-flex align-center gap-2"},no={class:"d-flex flex-column gap-2"},ro={key:0,class:"d-flex align-center gap-2"},uo={class:"d-flex align-center gap-2 mb-2"},co={class:"d-flex gap-2"},mo={class:"d-flex gap-2"},vo={class:"d-flex align-center justify-space-between"},po={class:"d-flex align-center gap-2"},fo={class:"text-end"},go={class:"text-h6 font-weight-bold"},_o={class:"text-caption"},ko={class:"text-h6 mb-4 d-flex align-center gap-2"},yo={class:"text-h6 mb-4 d-flex align-center gap-2"},bo={class:"image-upload-container"},ho={key:0,class:"mb-4"},xo={class:"text-center mt-2"},wo={class:"text-h6 mb-4 d-flex align-center gap-2"},Po={class:"text-h6 mb-4 d-flex align-center gap-2"},Vo={class:"text-h6 mb-4 d-flex align-center gap-2"},Co={class:"d-flex align-center"},$o={class:"text-subtitle-1"},So={class:"text-body-1"},Io={class:"d-flex align-center"},Do={class:"text-subtitle-1"},zo=Fe({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup(S,{emit:be}){var M,y,i;const q=It(),{nameRules:z,categoryRules:J}=Dt(),{getProductHPPBreakdown:g}=_t(),G=I(!1),T=I(!1),h=async()=>{if(!(!f.editMode||!C.id))try{const a=await fetch(`/api/products/${C.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(a.ok){const l=await a.json();T.value=l.success&&l.data&&l.data.length>0}}catch(a){console.error("Error checking HPP status:",a)}},p=async()=>{if(C.id)try{G.value=!0;const a=await g(C.id,"latest");a&&(C.cost=a.total_hpp,de("update-form","cost",a.total_hpp))}catch(a){console.error("Error refreshing HPP:",a)}finally{G.value=!1}},j=()=>{},f=S,U=me(()=>f.errorMessage),de=be,ke=I(),C=gt({...f.formData,available_in_kitchen:!!f.formData.available_in_kitchen,available_in_bar:!!f.formData.available_in_bar});Ce(()=>f.formData,a=>{const l={...a,available_in_kitchen:!!a.available_in_kitchen,available_in_bar:!!a.available_in_bar};Object.assign(C,l)},{deep:!0}),Ce(C,a=>{Object.keys(a).forEach(l=>{de("update-form",l,a[l])})},{deep:!0}),Ce(()=>f.modelValue,a=>{a&&f.editMode&&h()});const re=gt({length:((M=f.formData.dimensions)==null?void 0:M.length)||null,width:((y=f.formData.dimensions)==null?void 0:y.width)||null,height:((i=f.formData.dimensions)==null?void 0:i.height)||null});Ce(re,a=>{const l=a.length!==null||a.width!==null||a.height!==null;C.dimensions=l?{length:a.length!==null?a.length:void 0,width:a.width!==null?a.width:void 0,height:a.height!==null?a.height:void 0}:{}},{deep:!0});const se=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],Q=me(()=>{if(!C.price||!C.cost||C.cost<=0)return 0;const a=(C.price-C.cost)/C.cost*100;return Math.ceil(a)}),ve=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),b=a=>a<10?"error":a<25?"warning":a<50?"success":"info",m=a=>a<10?"tabler-trending-down":a<25?"tabler-trending-up":a<50?"tabler-trending-up-2":"tabler-trending-up-3",k=a=>!a||a===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),R=a=>{if(!a||a.trim()===""||a==="Rp 0")return 0;const u=a.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(u)||0},_e=I(!1),pe=a=>{const l=R(a);C.price=l},fe=()=>{_e.value=!0},w=()=>{_e.value=!1},N=async()=>{var l;const{valid:a}=await((l=ke.value)==null?void 0:l.validate());a&&de("submit",C)},x=a=>{de("image-change",a)},O=()=>{de("remove-image")};return(a,l)=>(v(),K(Ee,{"model-value":a.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":l[27]||(l[27]=u=>a.$emit("update:modelValue",u))},{default:t(()=>[e(ee,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(we,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[o("div",lo,[e(_,{icon:a.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),o("span",oo,r(a.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(F,{icon:"tabler-x",variant:"text",color:"white",onClick:l[0]||(l[0]=u=>a.$emit("close"))})]),_:1}),e(Ue),e(ae,{class:"pa-6"},{default:t(()=>[e(bt,{ref_key:"formRef",ref:ke,onSubmit:kt(N,["prevent"])},{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12"},{default:t(()=>[o("h6",so,[e(_,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),l[28]||(l[28]=d(" Informasi Dasar "))])]),_:1}),e($,{cols:"12",md:"8"},{default:t(()=>[e(xe,{modelValue:C.name,"onUpdate:modelValue":l[1]||(l[1]=u=>C.name=u),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:H(z),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:C.sku,"onUpdate:modelValue":l[2]||(l[2]=u=>C.sku=u),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ct,{modelValue:C.description,"onUpdate:modelValue":l[3]||(l[3]=u=>C.description=u),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(Be,{"model-value":C.category_id,"onUpdate:modelValue":l[4]||(l[4]=u=>C.category_id=u),items:a.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:H(J),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(xe,{modelValue:C.brand,"onUpdate:modelValue":l[5]||(l[5]=u=>C.brand=u),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",io,[e(_,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),l[29]||(l[29]=d(" Harga & Biaya "))])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(xe,{"model-value":k(C.price),"onUpdate:modelValue":l[6]||(l[6]=u=>pe(u)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:fe,onBlur:w},null,8,["model-value"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[o("div",no,[e(xe,{"model-value":k(C.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),a.editMode?(v(),X("div",ro,[e(oe,{color:T.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e(_,{icon:T.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),d(" "+r(T.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),T.value?(v(),K(F,{key:0,size:"small",variant:"outlined",color:"primary",onClick:p,loading:G.value},{default:t(()=>[e(_,{icon:"tabler-refresh",size:"14",class:"me-1"}),l[30]||(l[30]=d(" Update HPP "))]),_:1,__:[30]},8,["loading"])):(v(),K(Me,{key:1},{activator:t(({props:u})=>[e(oe,he(u,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e(_,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),l[31]||(l[31]=d(" Belum Ada Resep "))]),_:2,__:[31]},1040)]),default:t(()=>[l[32]||(l[32]=o("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[32]}))])):W("",!0)])]),_:1}),a.editMode?(v(),K($,{key:0,cols:"12"},{default:t(()=>[T.value?(v(),K(Ke,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ct,null,{default:t(()=>[e(_,{icon:"tabler-info-circle",class:"me-2"}),l[33]||(l[33]=d(" HPP Otomatis Aktif "))]),_:1,__:[33]}),l[34]||(l[34]=o("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[34]})):(v(),K(Ke,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ct,null,{default:t(()=>[e(_,{icon:"tabler-alert-triangle",class:"me-2"}),l[35]||(l[35]=d(" HPP Manual "))]),_:1,__:[35]}),l[36]||(l[36]=o("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[36]}))]),_:1})):W("",!0),e($,{cols:"12"},{default:t(()=>[T.value&&a.editMode?(v(),K(Ke,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[o("div",uo,[e(_,{icon:"tabler-check-circle"}),l[37]||(l[37]=o("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),l[40]||(l[40]=o("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),o("div",co,[e(F,{size:"small",color:"primary",variant:"outlined",onClick:j},{default:t(()=>[e(_,{icon:"tabler-edit",size:"14",class:"me-1"}),l[38]||(l[38]=d(" Edit Resep "))]),_:1,__:[38]}),e(F,{size:"small",variant:"outlined",color:"info",onClick:p,loading:G.value},{default:t(()=>[e(_,{icon:"tabler-refresh",size:"14",class:"me-1"}),l[39]||(l[39]=d(" Refresh HPP "))]),_:1,__:[39]},8,["loading"])])]),_:1,__:[40]})):!T.value&&a.editMode?(v(),K(Ke,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[o("div",mo,[e(F,{size:"small",variant:"outlined",color:"info",onClick:l[7]||(l[7]=u=>H(q).push("/hpp-management"))},{default:t(()=>[e(_,{icon:"tabler-calculator",size:"14",class:"me-1"}),l[41]||(l[41]=d(" Lihat HPP Management "))]),_:1,__:[41]})])]),_:1})):W("",!0)]),_:1}),e($,{cols:"12"},{default:t(()=>[C.price&&C.cost&&C.cost>0?(v(),K(Ke,{key:0,color:b(Q.value),variant:"tonal",class:"mb-0"},{default:t(()=>[o("div",vo,[o("div",po,[e(_,{icon:m(Q.value)},null,8,["icon"]),l[42]||(l[42]=o("span",{class:"font-weight-medium"},"Profit Margin",-1))]),o("div",fo,[o("div",go,r(Math.round(Q.value))+"%",1),o("div",_o," Keuntungan: "+r(ve(C.price-C.cost)),1)])])]),_:1},8,["color"])):W("",!0)]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",ko,[e(_,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),l[43]||(l[43]=d(" Dimensi (cm) "))])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:re.length,"onUpdate:modelValue":l[8]||(l[8]=u=>re.length=u),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:re.width,"onUpdate:modelValue":l[9]||(l[9]=u=>re.width=u),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:re.height,"onUpdate:modelValue":l[10]||(l[10]=u=>re.height=u),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",yo,[e(_,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),l[44]||(l[44]=d(" Gambar Produk "))])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("div",bo,[a.imagePreview?(v(),X("div",ho,[e(ka,{src:a.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),o("div",xo,[e(F,{size:"small",color:"error",variant:"outlined",onClick:O},{default:t(()=>l[45]||(l[45]=[d(" Hapus Gambar ")])),_:1,__:[45]})])])):W("",!0),e(ya,{"model-value":a.selectedImage,"onUpdate:modelValue":l[11]||(l[11]=u=>x(Array.isArray(u)?u:[u])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),l[46]||(l[46]=o("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",wo,[e(_,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),l[47]||(l[47]=d(" Pengaturan "))])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(Be,{"model-value":C.status,"onUpdate:modelValue":l[12]||(l[12]=u=>C.status=u),items:se,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(Ze,{"model-value":C.active,"onUpdate:modelValue":l[13]||(l[13]=u=>C.active=u??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(Ze,{"model-value":C.featured,"onUpdate:modelValue":l[14]||(l[14]=u=>C.featured=u??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",Po,[e(_,{icon:"tabler-tools-kitchen-2",size:"20",class:"coffee-icon"}),l[48]||(l[48]=d(" Ketersediaan Station "))])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(Ze,{"model-value":C.available_in_kitchen,"onUpdate:modelValue":l[15]||(l[15]=u=>C.available_in_kitchen=!!u),label:"Tersedia di Kitchen",color:"coffee",inset:""},{prepend:t(()=>[e(_,{icon:"tabler-chef-hat",class:"me-2",color:C.available_in_kitchen?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(Ze,{"model-value":C.available_in_bar,"onUpdate:modelValue":l[16]||(l[16]=u=>C.available_in_bar=!!u),label:"Tersedia di Bar",color:"coffee",inset:""},{prepend:t(()=>[e(_,{icon:"tabler-glass-cocktail",class:"me-2",color:C.available_in_bar?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",Vo,[e(_,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),l[49]||(l[49]=d(" SEO (Opsional) "))])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(xe,{modelValue:C.meta_title,"onUpdate:modelValue":l[17]||(l[17]=u=>C.meta_title=u),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ct,{modelValue:C.meta_description,"onUpdate:modelValue":l[18]||(l[18]=u=>C.meta_description=u),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ta,{"model-value":C.tags,"onUpdate:modelValue":l[19]||(l[19]=u=>C.tags=u),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Ue),e(Re,{class:"pa-6"},{default:t(()=>[e(Oe),e(F,{variant:"outlined",class:"coffee-secondary",onClick:l[20]||(l[20]=u=>a.$emit("close"))},{default:t(()=>l[50]||(l[50]=[d(" Batal ")])),_:1,__:[50]}),e(F,{color:"primary",class:"coffee-primary",loading:a.loading,onClick:N},{default:t(()=>[d(r(a.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),a.useDialogError?W("",!0):(v(),K(at,{key:0,"model-value":!!U.value,"onUpdate:modelValue":l[22]||(l[22]=u=>!u&&a.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(F,{icon:"tabler-x",size:"small",variant:"text",onClick:l[21]||(l[21]=u=>a.$emit("clear-error"))})]),default:t(()=>[o("div",Co,[e(_,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),o("div",null,[l[51]||(l[51]=o("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),o("div",$o,r(U.value),1)])])]),_:1},8,["model-value"])),a.useDialogError?(v(),K(Ee,{key:1,"model-value":!!U.value,"onUpdate:modelValue":l[24]||(l[24]=u=>!u&&a.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center text-error"},{default:t(()=>[e(_,{icon:"tabler-alert-circle",class:"me-2"}),l[52]||(l[52]=d(" Error Occurred "))]),_:1,__:[52]}),e(Ue),e(ae,{class:"py-4"},{default:t(()=>[o("div",So,r(U.value),1)]),_:1}),e(Ue),e(Re,{class:"justify-end pa-4"},{default:t(()=>[e(F,{color:"error",variant:"outlined",onClick:l[23]||(l[23]=u=>a.$emit("clear-error"))},{default:t(()=>l[53]||(l[53]=[d(" Close ")])),_:1,__:[53]})]),_:1})]),_:1})]),_:1},8,["model-value"])):W("",!0),e(at,{"model-value":!!a.successMessage,"onUpdate:modelValue":l[26]||(l[26]=u=>!u&&a.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(F,{icon:"tabler-x",size:"small",variant:"text",onClick:l[25]||(l[25]=u=>a.$emit("clear-success"))})]),default:t(()=>[o("div",Io,[e(_,{icon:"tabler-check-circle",class:"me-3",size:"28"}),o("div",null,[l[54]||(l[54]=o("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),o("div",Do,r(a.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),To=Le(zo,[["__scopeId","data-v-333cc50b"]]),Uo={key:0,class:"mt-4"},Ao={class:"d-flex align-center gap-2 mb-2"},Ho={class:"d-flex flex-wrap gap-2"},Mo=Fe({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup(S,{emit:be}){const q=S,z=be,{categories:J,loading:g,fetchAllCategories:G}=ba(),T=I(!1),h=I("");et(async()=>{await G(),h.value=p.search||""});const p=gt({...q.filters});Ce(()=>q.filters,b=>{Object.assign(p,b),h.value=b.search||""},{deep:!0}),ea(h,b=>{p.search=b,(b.length>=3||b.length===0)&&(T.value=!0,z("search",b),C(),setTimeout(()=>{T.value=!1},500))},{debounce:500,maxWait:1e3});const j=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],f=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],U=[{title:"Kitchen Only",value:"kitchen"},{title:"Bar Only",value:"bar"},{title:"Kitchen & Bar",value:"both"}],de=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],ke=me(()=>!!(h.value||p.category_id||p.active||p.stock_status||p.station||p.featured!==null||p.min_price||p.max_price)),C=()=>{z("update:filters",{...p})},re=()=>{h.value="",Object.assign(p,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),C()},se=b=>{const m=J.value.find(k=>k.id_category===b);return(m==null?void 0:m.name)||"Unknown"},Q=b=>{if(!b)return"Semua";const m=j.find(k=>k.value===b);return(m==null?void 0:m.title)||String(b)},ve=b=>{const m=f.find(k=>k.value===b);return(m==null?void 0:m.title)||b};return(b,m)=>(v(),K(ee,{class:"mb-6"},{default:t(()=>[e(we,{class:"d-flex align-center gap-2"},{default:t(()=>[e(_,{icon:"tabler-filter",class:"coffee-icon"}),m[12]||(m[12]=d(" Filter & Pencarian Produk "))]),_:1,__:[12]}),e(ae,null,{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:h.value,"onUpdate:modelValue":m[0]||(m[0]=k=>h.value=k),label:"Cari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:T.value,clearable:"",variant:"outlined",hint:h.value.length>0&&h.value.length<3?`Ketik ${3-h.value.length} karakter lagi untuk mencari`:"","persistent-hint":""},null,8,["modelValue","loading","hint"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:p.category_id,"onUpdate:modelValue":[m[1]||(m[1]=k=>p.category_id=k),C],items:H(J),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:H(g),clearable:"",variant:"outlined"},{"no-data":t(()=>[e(je,null,{default:t(()=>[e(Ye,null,{default:t(()=>[d(r(H(g)?"Memuat kategori...":"Tidak ada kategori"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:p.active,"onUpdate:modelValue":[m[2]||(m[2]=k=>p.active=k),C],items:j,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:p.stock_status,"onUpdate:modelValue":[m[3]||(m[3]=k=>p.stock_status=k),C],items:f,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:p.station,"onUpdate:modelValue":[m[4]||(m[4]=k=>p.station=k),C],items:U,label:"Station",placeholder:"Semua station","prepend-inner-icon":"tabler-tools-kitchen-2",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(F,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:re})]),_:1})]),_:1}),e(Se,{class:"mt-3"},{default:t(()=>[e($,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:p.min_price,"onUpdate:modelValue":m[5]||(m[5]=k=>p.min_price=k),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:C},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:p.max_price,"onUpdate:modelValue":m[6]||(m[6]=k=>p.max_price=k),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:C},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:p.sort_order,"onUpdate:modelValue":[m[7]||(m[7]=k=>p.sort_order=k),C],items:de,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),ke.value?(v(),X("div",Uo,[o("div",Ao,[e(_,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),m[13]||(m[13]=o("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),o("div",Ho,[h.value?(v(),K(oe,{key:0,closable:"",size:"small",color:"coffee","onClick:close":m[8]||(m[8]=k=>{h.value="",p.search="",C()})},{default:t(()=>[d(" Pencarian: "+r(h.value),1)]),_:1})):W("",!0),p.category_id?(v(),K(oe,{key:1,closable:"",size:"small",color:"coffee","onClick:close":m[9]||(m[9]=k=>{p.category_id=null,C()})},{default:t(()=>[d(" Kategori: "+r(se(p.category_id)),1)]),_:1})):W("",!0),p.active?(v(),K(oe,{key:2,closable:"",size:"small",color:"coffee","onClick:close":m[10]||(m[10]=k=>{p.active=null,C()})},{default:t(()=>[d(" Status: "+r(Q(p.active)),1)]),_:1})):W("",!0),p.stock_status?(v(),K(oe,{key:3,closable:"",size:"small",color:"coffee","onClick:close":m[11]||(m[11]=k=>{p.stock_status=null,C()})},{default:t(()=>[d(" Stok: "+r(ve(p.stock_status)),1)]),_:1})):W("",!0)])])):W("",!0)]),_:1})]),_:1}))}}),Ko=Le(Mo,[["__scopeId","data-v-d597dc7f"]]),Bo={class:"d-flex align-center gap-2"},Fo={class:"text-h6"},Eo={class:"d-flex align-center gap-2"},Ro={class:"text-h6"},Lo={class:"d-flex align-center gap-2"},qo={class:"text-h6"},No={class:"d-flex align-center gap-2"},Oo={class:"text-h6"},jo={class:"d-flex align-center gap-2"},Jo={class:"text-h6"},Wo={class:"d-flex align-center gap-2"},Go={class:"text-h6"},Qo={class:"d-flex align-center gap-2"},Xo={class:"text-h6"},Zo={class:"d-flex align-center gap-2"},Yo={class:"text-h6"},es=Fe({__name:"ProductStatsCards",props:{stats:{}},setup(S){const be=z=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(z),q=z=>`${z.toFixed(1)}%`;return(z,J)=>(v(),K(Se,{class:"mb-6"},{default:t(()=>[e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-package"})]),_:1}),o("div",null,[J[0]||(J[0]=o("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),o("div",Bo,[o("h6",Fo,r(((g=z.stats)==null?void 0:g.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-check"})]),_:1}),o("div",null,[J[1]||(J[1]=o("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),o("div",Eo,[o("h6",Ro,r(((g=z.stats)==null?void 0:g.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-star"})]),_:1}),o("div",null,[J[2]||(J[2]=o("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),o("div",Lo,[o("h6",qo,r(((g=z.stats)==null?void 0:g.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-alert-triangle"})]),_:1}),o("div",null,[J[3]||(J[3]=o("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),o("div",No,[o("h6",Oo,r(((g=z.stats)==null?void 0:g.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-currency-dollar"})]),_:1}),o("div",null,[J[4]||(J[4]=o("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),o("div",jo,[o("h6",Jo,r(be(((g=z.stats)==null?void 0:g.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-chart-line"})]),_:1}),o("div",null,[J[5]||(J[5]=o("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),o("div",Wo,[o("h6",Go,r(be(((g=z.stats)==null?void 0:g.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-trending-up"})]),_:1}),o("div",null,[J[6]||(J[6]=o("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),o("div",Qo,[o("h6",Xo,r(q(((g=z.stats)==null?void 0:g.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ee,{class:"stats-card"},{default:t(()=>[e(ae,{class:"d-flex align-center"},{default:t(()=>{var g;return[e($e,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-x-circle"})]),_:1}),o("div",null,[J[7]||(J[7]=o("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),o("div",Zo,[o("h6",Yo,r(((g=z.stats)==null?void 0:g.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),ts=Le(es,[["__scopeId","data-v-124783ae"]]),as={class:"d-flex align-center gap-2"},ls={class:"d-flex align-center gap-2"},os={class:"text-center py-8"},ss={class:"d-flex align-center gap-3 py-2"},is={class:"font-weight-medium"},ns={class:"text-caption text-medium-emphasis"},rs={class:"text-end"},us={class:"font-weight-medium"},ds={class:"text-caption text-medium-emphasis d-flex align-center justify-end gap-1"},cs={class:"text-center profit-margin-container"},ms={class:"text-center"},vs={key:0,class:"text-caption text-medium-emphasis mt-1"},ps={class:"d-flex align-center gap-2"},fs={class:"d-flex gap-2 align-center"},gs={class:"text-body-2"},_s={class:"text-caption text-medium-emphasis"},ks={class:"d-flex align-center gap-1"},ys=300*1e3,bs=1e3,hs=Fe({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","toggle-kitchen","toggle-bar","bulk-delete","update:options","update:selected-products"],setup(S,{expose:be,emit:q}){const z=S,J=q,{currentHPPBreakdown:g,getProductHPPBreakdown:G}=_t(),T=I({}),h=I({}),p=I({}),j=I(new Set),f=I(new Set);let U=null;const de=w=>{const N=p.value[w];return N?Date.now()-N.timestamp<ys:!1},ke=async()=>{if(f.value.size===0)return;const w=Array.from(f.value);f.value.clear();const N=w.filter(O=>{const M=z.products.find(y=>(y.id_product||y.id)===O);return M&&(M.hpp===void 0||M.hpp===null)});if(N.length===0)return;const x=3;for(let O=0;O<N.length;O+=x){const y=N.slice(O,O+x).map(async i=>{var a;if(!(h.value[i]||de(i))){h.value[i]=!0,j.value.add(i);try{if(await G(i,"latest"),(a=g.value)!=null&&a.total_hpp){const l=g.value.total_hpp;T.value[i]=l,p.value[i]={data:l,timestamp:Date.now(),attempted:!0}}else p.value[i]={data:0,timestamp:Date.now(),attempted:!0}}catch(l){console.warn(`Could not load HPP for product ${i}:`,l),p.value[i]={data:0,timestamp:Date.now(),attempted:!0}}finally{h.value[i]=!1}}});await Promise.all(y),O+x<w.length&&await new Promise(i=>setTimeout(i,500))}},C=w=>{if(de(w)){T.value[w]=p.value[w].data;return}j.value.has(w)||(f.value.add(w),U&&clearTimeout(U),U=setTimeout(()=>{ke()},bs))},re=()=>{for(const w of z.products){const N=w.id_product||w.id;N&&(de(N)?T.value[N]=p.value[N].data:!j.value.has(N)&&!h.value[N]&&C(N))}},se=w=>{const N=w.id_product||w.id;return T.value[N]||w.cost||0},Q=w=>{const N=se(w),x=w.price||0;return x<=0||N<=0?0:Math.round((x-N)/x*100)};ta(()=>{z.products&&z.products.length>0&&re()}),et(()=>{z.products&&z.products.length>0&&re()}),be({refreshHPPData:async w=>{w?(delete p.value[w],delete T.value[w],j.value.delete(w),z.products.find(x=>(x.id_product||x.id)===w)&&C(w)):(p.value={},T.value={},j.value.clear(),f.value.clear(),re())}});const b=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Station",key:"station_availability",sortable:!1,width:"150px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],m=w=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(w),k=w=>new Date(w).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),R=w=>new Date(w).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),_e=w=>w<10?"error":w<25?"warning":w<50?"success":"info",pe=w=>{J("toggle-kitchen",w)},fe=w=>{J("toggle-bar",w)};return(w,N)=>(v(),K(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",as,[e(_,{icon:"tabler-list",class:"coffee-icon"}),N[5]||(N[5]=d(" Data Produk ")),w.totalItems?(v(),K(oe,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[d(r(w.totalItems)+" item ",1)]),_:1})):W("",!0)]),o("div",ls,[w.selectedProducts.length>0?(v(),K(F,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:N[0]||(N[0]=x=>w.$emit("bulk-delete"))},{default:t(()=>[d(" Hapus Terpilih ("+r(w.selectedProducts.length)+") ",1)]),_:1})):W("",!0),e(F,{"prepend-icon":"tabler-plus",color:"coffee",onClick:N[1]||(N[1]=x=>w.$emit("add-product"))},{default:t(()=>N[6]||(N[6]=[d(" Tambah Produk ")])),_:1,__:[6]})])]),_:1}),e(Ue),e($a,{"model-value":w.selectedProducts,"onUpdate:modelValue":N[3]||(N[3]=x=>w.$emit("update:selected-products",x)),headers:b,items:w.products,"items-length":w.totalItems,loading:w.loading,"items-per-page":w.itemsPerPage,page:w.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:options":N[4]||(N[4]=x=>w.$emit("update:options",x))},{loading:t(()=>[e(Sa,{type:"table-row@10"})]),"no-data":t(()=>[o("div",os,[e(_,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),N[8]||(N[8]=o("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),N[9]||(N[9]=o("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(F,{"prepend-icon":"tabler-plus",color:"coffee",onClick:N[2]||(N[2]=x=>w.$emit("add-product"))},{default:t(()=>N[7]||(N[7]=[d(" Tambah Produk Pertama ")])),_:1,__:[7]})])]),"item.name":t(({item:x})=>[o("div",ss,[e($e,{image:x.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[x.image_url?W("",!0):(v(),K(_,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),o("div",null,[o("div",is,r(x.name),1),o("div",ns," SKU: "+r(x.sku||"-"),1)])])]),"item.category":t(({item:x})=>[e(oe,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var O;return[d(r(((O=x.category)==null?void 0:O.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:x})=>[o("div",rs,[o("div",us,r(m(x.price)),1),o("div",ds,[o("span",null,"HPP: "+r(m(se(x))),1),h.value[x.id_product||x.id]&&se(x)>0?(v(),K(it,{key:0,indeterminate:"",size:"12",width:"2"})):W("",!0)])])]),"item.profit_margin":t(({item:x})=>[o("div",cs,[e(oe,{color:_e(Q(x)),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[d(r(Q(x))+"% ",1)]),_:2},1032,["color"])])]),"item.stock":t(({item:x})=>[o("div",ms,[e(oe,{color:x.stock_status==="out_of_stock"?"error":x.stock_status==="low_stock"?"warning":"success",size:"small",variant:"tonal"},{default:t(()=>[d(r(x.stock_status==="out_of_stock"?"Habis":x.stock_status==="low_stock"?"Rendah":"Aman"),1)]),_:2},1032,["color"]),x.min_stock?(v(),X("div",vs," Min: "+r(x.min_stock),1)):W("",!0)])]),"item.active":t(({item:x})=>[o("div",ps,[e(oe,{color:x.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[d(r(x.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),x.featured?(v(),K(Me,{key:0,text:"Produk Unggulan"},{activator:t(({props:O})=>[e(_,he(O,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):W("",!0)])]),"item.station_availability":t(({item:x})=>[o("div",fs,[e(Me,{location:"top"},{activator:t(({props:O})=>{var M,y,i;return[e(oe,he(O,{color:x.available_in_kitchen?"success":"error",variant:"flat",size:"small",class:["station-chip cursor-pointer",{"station-chip-loading":(M=w.toggleLoading)==null?void 0:M[x.id_product]}],onClick:a=>pe(x),loading:((y=w.toggleLoading)==null?void 0:y[x.id_product])||!1,disabled:((i=w.toggleLoading)==null?void 0:i[x.id_product])||!1}),{prepend:t(()=>[e(_,{icon:x.available_in_kitchen?"tabler-check":"tabler-x",size:"14",color:"white"},null,8,["icon"])]),default:t(()=>[N[10]||(N[10]=o("span",{style:{color:"white !important","font-weight":"600 !important"}}," Kitchen ",-1))]),_:2,__:[10]},1040,["color","class","onClick","loading","disabled"])]}),default:t(()=>[o("span",null,r(x.available_in_kitchen?"Tersedia di Kitchen":"Tidak tersedia di Kitchen"),1)]),_:2},1024),e(Me,{location:"top"},{activator:t(({props:O})=>{var M,y,i;return[e(oe,he(O,{color:x.available_in_bar?"success":"error",variant:"flat",size:"small",class:["station-chip cursor-pointer",{"station-chip-loading":(M=w.toggleLoading)==null?void 0:M[x.id_product]}],onClick:a=>fe(x),loading:((y=w.toggleLoading)==null?void 0:y[x.id_product])||!1,disabled:((i=w.toggleLoading)==null?void 0:i[x.id_product])||!1}),{prepend:t(()=>[e(_,{icon:x.available_in_bar?"tabler-check":"tabler-x",size:"14",color:"white"},null,8,["icon"])]),default:t(()=>[N[11]||(N[11]=o("span",{style:{color:"white !important","font-weight":"600 !important"}}," Bar ",-1))]),_:2,__:[11]},1040,["color","class","onClick","loading","disabled"])]}),default:t(()=>[o("span",null,r(x.available_in_bar?"Tersedia di Bar":"Tidak tersedia di Bar"),1)]),_:2},1024)])]),"item.created_at":t(({item:x})=>[o("div",gs,r(k(x.created_at??"")),1),o("div",_s,r(R((x==null?void 0:x.created_at)??"")),1)]),"item.actions":t(({item:x})=>[o("div",ks,[e(Me,{text:"Kelola Komposisi"},{activator:t(({props:O})=>[e(F,he(O,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:M=>w.$emit("open-composition-dialog",x)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Kelola Variant"},{activator:t(({props:O})=>[e(F,he(O,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:M=>w.$emit("open-variant-dialog",x)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Edit Produk"},{activator:t(({props:O})=>[e(F,he(O,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:M=>w.$emit("edit-product",x)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:x.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:O})=>{var M;return[e(F,he(O,{icon:x.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:x.active?"success":"error",loading:((M=w.toggleLoading)==null?void 0:M[x.id_product])||!1,onClick:y=>w.$emit("toggle-active",x)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Me,{text:x.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:O})=>[e(F,he(O,{icon:x.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:x.featured?"warning":"default",onClick:M=>w.$emit("toggle-featured",x)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Me,{text:"Hapus Produk"},{activator:t(({props:O})=>[e(F,he(O,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:M=>w.$emit("delete-product",x)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),xs=Le(hs,[["__scopeId","data-v-e3fcb175"]]),ws={class:"d-flex align-center gap-3"},Ps={class:"text-h5 font-weight-bold"},Vs={class:"text-h6"},Cs={class:"text-body-1"},$s={class:"d-flex flex-column"},Ss={class:"font-weight-medium"},Is={class:"text-caption text-grey-darken-1"},Ds={class:"font-weight-medium"},zs={key:0,class:"text-caption"},Ts={key:1,class:"text-grey-lighten-1 text-caption"},Us={class:"v-data-table__footer"},As={class:"pa-4 d-flex justify-space-between align-center"},Hs={class:"text-subtitle-1 font-weight-bold"},Ms={class:"text-subtitle-2 text-uppercase"},Ks={class:"text-h6 font-weight-bold my-2"},Bs={class:"text-caption"},Tt=Fe({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup(S,{emit:be}){const q=S,z=be,J=I(!1),g=I(null),G=I(null),T=I(!1),h=I(!1),p=I("latest"),j=I(0),f=I(0),U=I(""),de=I(0),ke=I(!1),C=I(!1),re=I(""),se=I(""),Q=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],ve=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],b=M=>!M||M===0?"":new Intl.NumberFormat("id-ID").format(M),m=M=>{if(!M)return 0;const y=M.replace(/[^\d]/g,"");return parseInt(y)||0},k=M=>{var i;const y=m(M);if(f.value=y,U.value=b(y),(i=g.value)!=null&&i.total_hpp&&y>0){const a=g.value.total_hpp;j.value=a>0?Math.round((y-a)/a*100):0}else j.value=0},R=M=>He(M),_e=async(M,y)=>{J.value=!0;try{await new Promise(i=>setTimeout(i,500)),g.value={total_hpp:15e4,method:y,calculated_at:new Date().toISOString(),items:[{item_name:"Tepung Terigu",item_code:"TPNG001",quantity_needed:.5,unit:"kg",cost_per_unit:15e3,total_cost:7500,is_critical:!1,notes:null},{item_name:"Gula Pasir",item_code:"GUL001",quantity_needed:.25,unit:"kg",cost_per_unit:12e3,total_cost:3e3,is_critical:!1,notes:null},{item_name:"Telur Ayam",item_code:"TLR001",quantity_needed:3,unit:"pcs",cost_per_unit:3e3,total_cost:9e3,is_critical:!0,notes:"Price volatile"}]},T.value=!0}catch(i){console.error("Error loading HPP breakdown:",i),T.value=!1}finally{J.value=!1}},pe=async(M,y)=>{J.value=!0;try{if(await new Promise(i=>setTimeout(i,1e3)),g.value){switch(y){case"latest":g.value.total_hpp=Math.round(g.value.total_hpp*1.1);break;case"average":g.value.total_hpp=Math.round(g.value.total_hpp*1.05);break;default:g.value.total_hpp=Math.round(g.value.total_hpp*1.03)}g.value.calculated_at=new Date().toISOString()}}catch(i){throw i}finally{J.value=!1}},fe=async(M,y,i,a,l)=>{J.value=!0;try{return await new Promise(u=>setTimeout(u,1e3)),{data:{new_price:i,markup_percentage:g.value?Math.round((i-g.value.total_hpp)/g.value.total_hpp*100):0}}}catch(u){throw u}finally{J.value=!1}},w=async()=>{var M,y,i;if(q.variantId)try{const a=localStorage.getItem("token"),l=await Ne.get(`/api/variants/${q.variantId}`,{headers:{Authorization:`Bearer ${a}`,Accept:"application/json"}});if(l.data.success&&l.data.data){const u=l.data.data;if(u.price&&u.price>0)f.value=Number(u.price),U.value=b(Number(u.price));else if((M=g.value)!=null&&M.total_hpp){const te=Math.round(g.value.total_hpp*1.2);f.value=te,U.value=b(te)}if((y=g.value)!=null&&y.total_hpp&&f.value>0){const te=g.value.total_hpp;j.value=te>0?Math.round((f.value-te)/te*100):0}de.value+=1}}catch(a){console.warn("Could not load target price, using default:",a),(i=g.value)!=null&&i.total_hpp&&(f.value=Math.round(g.value.total_hpp*1.2))}},N=async()=>{q.variantId&&(await _e(q.variantId,p.value),await w())},x=async()=>{var M,y;if(q.variantId)try{await pe(q.variantId,p.value),re.value=`HPP successfully updated using ${p.value} method!`,ke.value=!0,z("hpp-updated"),await N()}catch(i){console.error("Error updating HPP:",i),se.value=((y=(M=i==null?void 0:i.response)==null?void 0:M.data)==null?void 0:y.message)||"Failed to update HPP",C.value=!0}},O=async()=>{var M,y,i,a,l,u,te,L,ce,ze;if(q.variantId&&((M=g.value)!=null&&M.total_hpp)&&f.value)try{const le=await fe(q.variantId,p.value,f.value,!0,!0);if((y=le==null?void 0:le.data)!=null&&y.new_price){if(f.value=le.data.new_price,U.value=b(le.data.new_price),((i=le==null?void 0:le.data)==null?void 0:i.markup_percentage)!==void 0)j.value=le.data.markup_percentage;else{const De=g.value.total_hpp;j.value=De>0?Math.round((le.data.new_price-De)/De*100):0}de.value+=1,await ft()}q.variantId&&await _e(q.variantId,p.value),re.value=`Price successfully updated to ${R(((a=le==null?void 0:le.data)==null?void 0:a.new_price)||f.value)}!`,ke.value=!0,z("price-updated",{variantId:q.variantId,oldPrice:(l=le==null?void 0:le.data)==null?void 0:l.old_price,newPrice:(u=le==null?void 0:le.data)==null?void 0:u.new_price,hpp:(te=le==null?void 0:le.data)==null?void 0:te.hpp,markupPercentage:(L=le==null?void 0:le.data)==null?void 0:L.markup_percentage})}catch(le){console.error("Error applying price suggestion:",le),se.value=((ze=(ce=le==null?void 0:le.response)==null?void 0:ce.data)==null?void 0:ze.message)||"Failed to update variant price",C.value=!0}};return Ce(()=>q.modelValue,M=>{M&&q.variantId&&N()}),Ce(()=>q.variantId,M=>{M&&q.modelValue&&N()}),Ce(p,async()=>{q.variantId&&await N()}),Ce([()=>{var M;return(M=g.value)==null?void 0:M.total_hpp},f],()=>{var M;if((M=g.value)!=null&&M.total_hpp&&f.value>0){const y=g.value.total_hpp;j.value=y>0?Math.round((f.value-y)/y*100):0}else j.value=0}),Ce(f,M=>{M!==m(U.value)&&(U.value=b(M))}),(M,y)=>(v(),X(Te,null,[e(Ee,{"model-value":M.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":y[6]||(y[6]=i=>M.$emit("update:modelValue",i))},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",ws,[e(_,{icon:"mdi-calculator-variant",size:"24"}),o("span",null,"HPP Breakdown - "+r(M.variantName||"Variant"),1)]),e(F,{icon:"mdi-close",size:"small",variant:"text",onClick:y[0]||(y[0]=i=>M.$emit("update:modelValue",!1))})]),_:1}),e(ae,null,{default:t(()=>[e(Se,{class:"mb-4"},{default:t(()=>[e($,{cols:"12",md:"6"},{default:t(()=>[e(Be,{modelValue:p.value,"onUpdate:modelValue":[y[1]||(y[1]=i=>p.value=i),N],items:Q,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(F,{color:"primary",variant:"elevated",loading:J.value,"prepend-icon":"mdi-update",block:"",onClick:x},{default:t(()=>[d(" Update HPP with "+r(p.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),T.value?(v(),K(ee,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(ae,null,{default:t(()=>[e(Se,{align:"center"},{default:t(()=>[e($,{cols:"12",md:"4"},{default:t(()=>{var i;return[y[11]||(y[11]=o("div",{class:"text-subtitle-2"}," Total HPP ",-1)),o("div",Ps,r(R(((i=g.value)==null?void 0:i.total_hpp)||0)),1)]}),_:1,__:[11]}),e($,{cols:"12",md:"4"},{default:t(()=>{var i;return[y[12]||(y[12]=o("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),o("div",Vs,r((i=Q.find(a=>{var l;return a.value===((l=g.value)==null?void 0:l.method)}))==null?void 0:i.title),1)]}),_:1,__:[12]}),e($,{cols:"12",md:"4"},{default:t(()=>{var i;return[y[13]||(y[13]=o("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),o("div",Cs,r((i=g.value)!=null&&i.calculated_at?new Date(g.value.calculated_at).toLocaleString():"-"),1)]}),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):W("",!0),T.value?(v(),K(ee,{key:1},{default:t(()=>{var i;return[e(we,null,{default:t(()=>{var a,l;return[e(_,{icon:"mdi-format-list-bulleted",class:"me-2"}),d(" Item Breakdown ("+r(((l=(a=g.value)==null?void 0:a.items)==null?void 0:l.length)||0)+" items) ",1)]}),_:1}),e(va,{headers:ve,items:((i=g.value)==null?void 0:i.items)||[],"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:a})=>[o("div",$s,[o("span",Ss,r(a.item_name),1),o("span",Is,r(a.item_code),1)])]),"item.quantity_needed":t(({item:a})=>[o("span",Ds,r(a.quantity_needed)+" "+r(a.unit),1)]),"item.cost_per_unit":t(({item:a})=>[o("span",null,r(R(a.cost_per_unit)),1)]),"item.total_cost":t(({item:a})=>[e(oe,{color:a.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[d(r(R(a.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:a})=>[e(oe,{color:a.is_critical?"error":"success","prepend-icon":a.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[d(r(a.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:a})=>[a.notes?(v(),X("span",zs,r(a.notes),1)):(v(),X("span",Ts,"—"))]),bottom:t(()=>{var a;return[o("div",Us,[e(Ue),o("div",As,[o("div",Hs," Total HPP: "+r(R(((a=g.value)==null?void 0:a.total_hpp)||0)),1),e(oe,{color:"info",variant:"elevated"},{default:t(()=>{var l,u;return[d(r(((u=(l=g.value)==null?void 0:l.items)==null?void 0:u.length)||0)+" items ",1)]}),_:1})])])]}),_:1},8,["items"])]}),_:1})):W("",!0),T.value?(v(),K(ee,{key:2,class:"mt-4"},{default:t(()=>[e(we,null,{default:t(()=>[e(_,{icon:"mdi-cash-multiple",class:"me-2"}),y[14]||(y[14]=d(" Price Suggestion "))]),_:1,__:[14]}),e(ae,null,{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12",md:"6"},{default:t(()=>{var i;return[(v(),K(xe,{key:de.value,modelValue:U.value,"onUpdate:modelValue":[y[2]||(y[2]=a=>U.value=a),k],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${R(((i=g.value)==null?void 0:i.total_hpp)||0)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>{var i;return[(v(),K(xe,{key:de.value,modelValue:j.value,"onUpdate:modelValue":y[3]||(y[3]=a=>j.value=a),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${R(f.value-(((i=g.value)==null?void 0:i.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e(Se,{class:"mt-2"},{default:t(()=>[e($,{cols:"12",md:"12"},{default:t(()=>[e(F,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:J.value,disabled:!f.value||f.value<=0,block:"",onClick:O},{default:t(()=>y[15]||(y[15]=[d(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):W("",!0),h.value?(v(),K(ee,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(we,null,{default:t(()=>[e(_,{icon:"mdi-lightbulb",class:"me-2"}),y[16]||(y[16]=d(" Price Suggestions "))]),_:1,__:[16]}),e(ae,null,{default:t(()=>[e(Se,null,{default:t(()=>[(v(!0),X(Te,null,We(G.value.suggestions,(i,a)=>(v(),K($,{key:a,cols:"12",md:"4"},{default:t(()=>[e(ee,{variant:"elevated"},{default:t(()=>[e(ae,{class:"text-center"},{default:t(()=>[o("div",Ms,r(a)+" Method ",1),o("div",Ks,r(R(i.suggested_price)),1),o("div",Bs,[d(" HPP: "+r(R(i.hpp)),1),y[17]||(y[17]=o("br",null,null,-1)),d(" Markup: "+r(i.markup_percentage.toFixed(1))+"%",1),y[18]||(y[18]=o("br",null,null,-1)),d(" Margin: "+r(i.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):W("",!0),!T.value&&!J.value?(v(),K(ee,{key:4,variant:"outlined"},{default:t(()=>[e(ae,{class:"text-center py-8"},{default:t(()=>[e(_,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),y[20]||(y[20]=o("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),y[21]||(y[21]=o("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(F,{color:"primary","prepend-icon":"mdi-plus",onClick:y[4]||(y[4]=i=>M.$emit("update:modelValue",!1))},{default:t(()=>y[19]||(y[19]=[d(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):W("",!0)]),_:1}),e(Re,{class:"pa-4"},{default:t(()=>[e(Oe),e(F,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:y[5]||(y[5]=i=>M.$emit("update:modelValue",!1))},{default:t(()=>y[22]||(y[22]=[d(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(at,{modelValue:ke.value,"onUpdate:modelValue":y[8]||(y[8]=i=>ke.value=i),color:"success",location:"top"},{actions:t(()=>[e(F,{color:"white",variant:"text",onClick:y[7]||(y[7]=i=>ke.value=!1)},{default:t(()=>y[23]||(y[23]=[d(" Close ")])),_:1,__:[23]})]),default:t(()=>[d(r(re.value)+" ",1)]),_:1},8,["modelValue"]),e(at,{modelValue:C.value,"onUpdate:modelValue":y[10]||(y[10]=i=>C.value=i),color:"error",location:"top"},{actions:t(()=>[e(F,{color:"white",variant:"text",onClick:y[9]||(y[9]=i=>C.value=!1)},{default:t(()=>y[24]||(y[24]=[d(" Close ")])),_:1,__:[24]})]),default:t(()=>[d(r(se.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),Fs={class:"d-flex align-center gap-2"},Es={class:"pa-4",style:{"background-color":"#2A2A2A"}},Rs={key:0,class:"d-flex align-center gap-3"},Ls={class:"text-h6 text-white font-weight-bold"},qs={class:"d-flex align-center gap-4 mt-1"},Ns={class:"text-caption text-grey-lighten-1"},Os={class:"text-caption text-grey-lighten-1"},js={class:"pa-4 add-item-form"},Js={class:"d-flex align-center justify-space-between mb-4"},Ws={class:"d-flex align-center gap-2"},Gs={class:"text-h6"},Qs={key:0,class:"text-error"},Xs={key:1},Zs={class:"d-flex align-center"},Ys={class:"pa-4 text-center"},ei={class:"pa-4 pt-0"},ti={class:"d-flex align-center justify-between mb-4"},ai={class:"text-h6"},li={key:0,class:"composition-list"},oi={class:"d-flex align-center justify-between"},si={class:"d-flex align-center gap-3"},ii={class:"font-weight-medium"},ni={class:"text-caption text-medium-emphasis"},ri={class:"font-weight-medium text-primary"},ui={class:"d-flex align-center gap-2"},di={class:"text-center"},ci={key:0,class:"text-body-2 text-medium-emphasis"},mi={class:"text-center"},vi={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},pi=Fe({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup(S,{emit:be}){const q=S,z=be,J=I(),g=I(!1),G=I(!1),T=I([]),h=I([]),p=I(!1),j=I(null),f=I(!1),U=I(null),de=I(!1),ke=I(!1),C=I(""),re=I(""),se=I("success"),Q=I(!1),ve=me({get:()=>q.modelValue,set:n=>{z("update:modelValue",n)}}),b=()=>({item_id:null,quantity:1,is_critical:!1}),m=I(b()),k=me(()=>!m.value.item_id||!Array.isArray(T.value)?null:T.value.find(n=>n.id_item===m.value.item_id)),R=me(()=>!k.value||p.value&&j.value!==null?null:h.value.find(n=>{var s,V;return n.name===((s=k.value)==null?void 0:s.name)||n.id&&((V=k.value)==null?void 0:V.id_item)&&n.id===k.value.id_item})),_e=me(()=>{if(!k.value)return"";if(p.value&&j.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(R.value){const n=R.value;return`Item sudah ada dengan quantity ${n.quantity} ${n.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${fe(k.value)} ${k.value.unit}`}),pe=me(()=>Array.isArray(T.value)?T.value.filter(n=>fe(n)>0):[]),fe=n=>{var s,V;return((s=n.inventory)==null?void 0:s.current_stock)||((V=n.inventory)==null?void 0:V.available_stock)||n.current_stock||0},w=()=>G.value?"Memuat items...":!T.value||T.value.length===0?"Tidak ada item tersedia":pe.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",N=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),x=n=>{switch(n){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},O=n=>{switch(n){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},M=(n,s,V)=>{var P,ie,ue,ne,Pe,ye,Ve,qe;if(!s)return!0;const B=s.toLowerCase().trim(),E=((ie=(P=V==null?void 0:V.raw)==null?void 0:P.name)==null?void 0:ie.toLowerCase())||"",c=((ne=(ue=V==null?void 0:V.raw)==null?void 0:ue.item_code)==null?void 0:ne.toLowerCase())||"",A=((ye=(Pe=V==null?void 0:V.raw)==null?void 0:Pe.unit)==null?void 0:ye.toLowerCase())||"",Y=((qe=(Ve=V==null?void 0:V.raw)==null?void 0:Ve.description)==null?void 0:qe.toLowerCase())||"";return E.includes(B)||c.includes(B)||A.includes(B)||Y.includes(B)},y=async()=>{var n,s,V;G.value=!0;try{const B=await Ne.get("/api/items?per_page=all&include=inventory"),E=((s=(n=B.data)==null?void 0:n.data)==null?void 0:s.data)||((V=B.data)==null?void 0:V.data)||B.data||[];T.value=Array.isArray(E)?E:[]}catch(B){console.error("Error loading items:",B),B!=null&&B.response&&(console.error("API Error Status:",B.response.status),console.error("API Error Data:",B.response.data)),T.value=[]}finally{G.value=!1}},i=async()=>{var n,s,V,B,E;if(!(!((n=q.variant)!=null&&n.id)&&!((s=q.variant)!=null&&s.id_variant)))try{const c=q.variant.id||q.variant.id_variant,A=await Ne.get(`/api/variant-items/variant/${c}`),Y=((B=(V=A.data)==null?void 0:V.data)==null?void 0:B.composition)||((E=A.data)==null?void 0:E.composition)||[];if(!Array.isArray(Y)){console.warn("API response composition is not an array:",Y),h.value=[];return}h.value=Y.map(P=>{var ie,ue,ne,Pe,ye,Ve,qe,Xe,rt,ut;return{id:P.id_variant_item||P.id,name:((ie=P.item)==null?void 0:ie.name)||P.name,quantity:parseFloat(P.quantity_needed||P.quantity||P.qty||"1"),unit:P.unit||((ue=P.item)==null?void 0:ue.unit)||"pcs",stock:((Pe=(ne=P.item)==null?void 0:ne.inventory)==null?void 0:Pe.current_stock)||((Ve=(ye=P.item)==null?void 0:ye.inventory)==null?void 0:Ve.available_stock)||((qe=P.item)==null?void 0:qe.current_stock)||P.stock||0,price:parseFloat(((Xe=P.item)==null?void 0:Xe.cost_per_unit)||((rt=P.item)==null?void 0:rt.price)||P.price||"0"),is_critical:P.is_critical||!1,inventory:(ut=P.item)!=null&&ut.inventory?{current_stock:P.item.inventory.current_stock||0,available_stock:P.item.inventory.available_stock||0,stock_status:P.item.inventory.stock_status||"unknown",reorder_level:P.item.inventory.reorder_level||0}:null}})}catch(c){console.error("Error loading composition items:",c),c!=null&&c.response&&(console.error("API Error Status:",c.response.status),console.error("API Error Data:",c.response.data)),h.value=[]}},a=async()=>{var E,c;const{valid:n}=await J.value.validate();if(!n||!k.value)return;const s=k.value.name,V=k.value.id_item,B=m.value.quantity;if(p.value&&j.value!==null)h.value[j.value].quantity,h.value[j.value].quantity=B,h.value[j.value].is_critical=m.value.is_critical,p.value=!1,j.value=null;else{const A=h.value.findIndex(Y=>Y.name===s||Y.id&&V&&Y.id===V);if(A!==-1){const ie=h.value[A].quantity+B;h.value[A].quantity=ie}else{const Y={name:s,quantity:B,unit:k.value.unit,stock:((E=k.value.inventory)==null?void 0:E.current_stock)||((c=k.value.inventory)==null?void 0:c.available_stock)||k.value.current_stock||0,price:k.value.cost_per_unit||0,is_critical:m.value.is_critical,inventory:k.value.inventory?{current_stock:k.value.inventory.current_stock||0,available_stock:k.value.inventory.available_stock||0,stock_status:k.value.inventory.stock_status||"unknown",reorder_level:k.value.inventory.reorder_level||0}:null};h.value.push(Y)}}m.value=b()},l=(n,s)=>{const V=T.value.find(B=>B.name===n.name||B.id_item===n.id);V?(p.value=!0,j.value=s,m.value={item_id:V.id_item,quantity:n.quantity,is_critical:n.is_critical||!1},setTimeout(()=>{const B=document.querySelector(".add-item-form");B&&B.scrollIntoView({behavior:"smooth",block:"start"})},100)):console.error("❌ Could not find item in available items")},u=()=>{p.value=!1,j.value=null,m.value=b()},te=(n,s)=>{U.value={item:n,index:s},f.value=!0},L=async()=>{var B,E,c;if(!U.value)return;const{item:n,index:s}=U.value;n.name;const V=n.id;de.value=!0;try{V&&await Ne.delete(`/api/variant-items/${V}`),f.value=!1,U.value=null,await i(),z("save")}catch(A){console.error("❌ Error deleting item:",A),console.error("❌ Error details:",(B=A.response)==null?void 0:B.data),alert("Gagal menghapus item: "+(((c=(E=A.response)==null?void 0:E.data)==null?void 0:c.message)||A.message))}finally{de.value=!1}},ce=()=>{f.value=!1,U.value=null},ze=()=>{switch(se.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},le=()=>{switch(se.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},De=()=>{switch(se.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},Ae=()=>{switch(se.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Qe=async()=>{var n,s,V,B;if(!((n=q.variant)!=null&&n.id)&&!((s=q.variant)!=null&&s.id_variant)){console.error("No variant ID found");return}g.value=!0;try{const E=q.variant.id||q.variant.id_variant;if(h.value.some(A=>A.id)){const A={items:h.value.map(P=>{const ie=T.value.find(ue=>ue.name===P.name);return{id_variant_item:P.id,quantity_needed:Number(P.quantity),unit:P.unit,is_critical:P.is_critical||!1}}).filter(P=>P.id_variant_item&&P.quantity_needed>0)},Y=await Ne.post("/api/variant-items/bulk-update",A)}else{const A={id_variant:E,items:h.value.map(P=>{const ie=T.value.find(ue=>ue.name===P.name);return{id_item:ie==null?void 0:ie.id_item,quantity_needed:Number(P.quantity),unit:P.unit,is_critical:P.is_critical||!1}}).filter(P=>P.id_item&&P.quantity_needed>0)},Y=await Ne.post("/api/variant-items/bulk-store",A)}z("save"),D()}catch(E){console.error("Error saving composition:",E),alert("Gagal menyimpan komposisi: "+(((B=(V=E.response)==null?void 0:V.data)==null?void 0:B.message)||E.message))}finally{g.value=!1}},Je=()=>{Q.value=!0},D=()=>{ve.value=!1,m.value=b(),h.value=[],p.value=!1,j.value=null};return Ce(()=>q.modelValue,n=>{n?(m.value=b(),y(),i()):(p.value=!1,j.value=null)}),Ce(()=>m.value.item_id,n=>{n&&k.value}),et(()=>{y()}),(n,s)=>{var V,B,E;return v(),X(Te,null,[e(Ee,{modelValue:ve.value,"onUpdate:modelValue":s[3]||(s[3]=c=>ve.value=c),"max-width":"1000px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[o("div",Fs,[e(_,{icon:"mdi-delete",color:"white"}),s[9]||(s[9]=o("span",null,"Kelola Komposisi Item",-1))]),e(F,{icon:"mdi-close",variant:"text",color:"white",onClick:D,disabled:g.value},null,8,["disabled"])]),_:1}),e(ae,{class:"pa-0"},{default:t(()=>[o("div",Es,[n.variant?(v(),X("div",Rs,[e(_,{icon:"mdi-coffee",size:"32",color:"white"}),o("div",null,[o("h3",Ls,r(n.variant.name),1),o("div",qs,[o("span",Ns,"SKU: "+r(n.variant.sku),1),o("span",Os,"Harga: "+r(N(n.variant.price||0)),1),e(oe,{color:"success",size:"small",variant:"tonal"},{default:t(()=>s[10]||(s[10]=[d(" Stok Aman ")])),_:1,__:[10]})])])])):W("",!0)]),o("div",js,[o("div",Js,[o("div",Ws,[e(_,{icon:"mdi-plus-circle",color:"success"}),o("h4",Gs,r(p.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(bt,{ref_key:"form",ref:J,onSubmit:kt(a,["prevent"])},{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12",md:"4"},{default:t(()=>[e(yt,{modelValue:m.value.item_id,"onUpdate:modelValue":s[0]||(s[0]=c=>m.value.item_id=c),items:pe.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[c=>!!c||"Item wajib dipilih"],loading:G.value,disabled:G.value||T.value&&T.value.length===0,"no-data-text":w(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":M},{"prepend-inner":t(()=>[e(_,{icon:"mdi-package",size:"16"})]),item:t(({props:c,item:A})=>[e(je,he(c,{title:A.raw.name,disabled:fe(A.raw)<=0,class:["pa-3",{"text-disabled":fe(A.raw)<=0}]}),{prepend:t(()=>[e(_,{icon:"mdi-package-variant",color:fe(A.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[o("div",{class:Ge(["text-caption",fe(A.raw)<=0?"text-disabled":"text-medium-emphasis"])},[fe(A.raw)<=0?(v(),X("span",Qs,[e(_,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),s[11]||(s[11]=d(" Stok Habis "))])):(v(),X("span",Xs," Stok: "+r(fe(A.raw))+" "+r(A.raw.unit),1))],2)]),append:t(()=>{var Y;return[fe(A.raw)>0?(v(),K(oe,{key:0,size:"x-small",color:x(((Y=A.raw.inventory)==null?void 0:Y.stock_status)||A.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var P;return[d(r(O(((P=A.raw.inventory)==null?void 0:P.stock_status)||A.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(v(),K(oe,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>s[12]||(s[12]=[d(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:c})=>[o("div",Zs,[e(_,{icon:"mdi-package-variant",size:"16",class:"me-2"}),o("span",null,r(c.raw.name),1)])]),"no-data":t(()=>[o("div",Ys,[e(_,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),s[13]||(s[13]=o("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),s[14]||(s[14]=o("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:m.value.quantity,"onUpdate:modelValue":s[1]||(s[1]=c=>m.value.quantity=c),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[c=>!!c||"Jumlah wajib diisi",c=>c>0||"Jumlah harus lebih dari 0"],hint:_e.value,"persistent-hint":"",color:R.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>{var c;return[e(xe,{"model-value":((c=k.value)==null?void 0:c.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!k.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e(_,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e($,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(Ze,{modelValue:m.value.is_critical,"onUpdate:modelValue":s[2]||(s[2]=c=>m.value.is_critical=c),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(F,{color:p.value?"primary":R.value?"warning":"#D4A574",onClick:a,loading:g.value,disabled:!m.value.item_id||!m.value.quantity,block:""},{default:t(()=>[e(_,{icon:p.value?"mdi-content-save":R.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),d(" "+r(p.value?"Update":R.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),p.value?(v(),K(F,{key:0,color:"grey",variant:"outlined",onClick:u,size:"small",block:""},{default:t(()=>[e(_,{icon:"mdi-close",class:"me-1"}),s[15]||(s[15]=d(" Batal "))]),_:1,__:[15]})):W("",!0)]),_:1})]),_:1})]),_:1},512)]),o("div",ei,[o("div",ti,[o("h4",ai,"Daftar Item Komposisi ("+r(h.value.length)+")",1)]),h.value.length>0?(v(),X("div",li,[(v(!0),X(Te,null,We(h.value,(c,A)=>(v(),K(ee,{key:A,variant:"outlined",class:"mb-3"},{default:t(()=>[e(ae,{class:"pa-3"},{default:t(()=>{var Y,P,ie,ue,ne,Pe,ye;return[o("div",oi,[o("div",si,[e(_,{icon:"mdi-check-circle",color:"success"}),o("div",null,[o("div",ii,r(c.name),1),o("div",ni,[o("span",ri,"Dibutuhkan: "+r(c.quantity)+" "+r(c.unit),1),s[16]||(s[16]=d(" • ")),o("span",{class:Ge({"text-success":(((Y=c.inventory)==null?void 0:Y.current_stock)??0)>(((P=c.inventory)==null?void 0:P.reorder_level)??0),"text-warning":(((ie=c.inventory)==null?void 0:ie.current_stock)??0)<=(((ue=c.inventory)==null?void 0:ue.reorder_level)??0)&&(((ne=c.inventory)==null?void 0:ne.current_stock)??0)>0,"text-error":(((Pe=c.inventory)==null?void 0:Pe.current_stock)??0)<=0})}," Stok: "+r(((ye=c.inventory)==null?void 0:ye.current_stock)||c.stock||0)+" "+r(c.unit),3),d(" • "+r(N(c.price)),1)])])]),o("div",ui,[e(F,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:Ve=>l(c,A)},null,8,["onClick"]),e(F,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Ve=>te(c,A)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(v(),K(ee,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e(_,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),s[17]||(s[17]=o("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(Re,{class:"px-6 pb-6"},{default:t(()=>[e(F,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:Je},{default:t(()=>s[18]||(s[18]=[d(" Setting HPP ")])),_:1,__:[18]}),e(Oe),e(F,{variant:"outlined",onClick:D,disabled:g.value},{default:t(()=>s[19]||(s[19]=[d(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(F,{color:"#D4A574",onClick:Qe,loading:g.value,disabled:h.value.length===0},{default:t(()=>s[20]||(s[20]=[d(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Tt,{modelValue:Q.value,"onUpdate:modelValue":s[4]||(s[4]=c=>Q.value=c),"variant-id":((V=n.variant)==null?void 0:V.id)||((B=n.variant)==null?void 0:B.id_variant),"variant-name":(E=n.variant)==null?void 0:E.name,onHppUpdated:s[5]||(s[5]=c=>z("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Ee,{modelValue:f.value,"onUpdate:modelValue":s[6]||(s[6]=c=>f.value=c),"max-width":"400px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e(_,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),s[21]||(s[21]=d(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(Ue),e(ae,{class:"pa-6"},{default:t(()=>[o("div",di,[e(_,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),s[24]||(s[24]=o("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),U.value?(v(),X("div",ci,[o("strong",null,r(U.value.item.name),1),s[22]||(s[22]=o("br",null,null,-1)),d(" Dibutuhkan: "+r(U.value.item.quantity)+" "+r(U.value.item.unit),1)])):W("",!0),e(Ke,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>s[23]||(s[23]=[o("strong",null,"Perhatian:",-1),d(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(Re,{class:"px-6 pb-6"},{default:t(()=>[e(F,{variant:"outlined",onClick:ce,disabled:de.value,class:"flex-grow-1"},{default:t(()=>s[25]||(s[25]=[d(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(F,{color:"error",onClick:L,loading:de.value,class:"flex-grow-1"},{default:t(()=>s[26]||(s[26]=[d(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ee,{modelValue:ke.value,"onUpdate:modelValue":s[8]||(s[8]=c=>ke.value=c),"max-width":"450px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:Ge(["d-flex align-center justify-center text-h6",De()])},{default:t(()=>[e(_,{icon:ze(),color:le(),class:"me-2",size:"24"},null,8,["icon","color"]),d(" "+r(re.value),1)]),_:1},8,["class"]),e(Ue),e(ae,{class:"pa-6"},{default:t(()=>[o("div",mi,[e(_,{icon:ze(),color:le(),size:"64",class:"mb-4"},null,8,["icon","color"]),o("div",vi,r(C.value),1),e(Ke,{type:se.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[se.value==="success"?(v(),X(Te,{key:0},[s[27]||(s[27]=o("strong",null,"Berhasil!",-1)),s[28]||(s[28]=d(" Perubahan telah disimpan. "))],64)):se.value==="info"?(v(),X(Te,{key:1},[s[29]||(s[29]=o("strong",null,"Informasi:",-1)),s[30]||(s[30]=d(" Item telah diperbarui sesuai permintaan. "))],64)):(v(),X(Te,{key:2},[s[31]||(s[31]=o("strong",null,"Perhatian:",-1)),s[32]||(s[32]=d(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(Re,{class:"px-6 pb-6"},{default:t(()=>[e(Oe),e(F,{color:Ae(),onClick:s[7]||(s[7]=c=>ke.value=!1),class:"px-6"},{default:t(()=>[e(_,{icon:"mdi-check",class:"me-1"}),s[33]||(s[33]=d(" OK "))]),_:1,__:[33]},8,["color"]),e(Oe)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),fi=Le(pi,[["__scopeId","data-v-d2ce0c17"]]),gi={class:"d-flex align-center gap-2"},_i={class:"mt-2"},ki={key:0,class:"mt-1 font-weight-medium"},yi={key:1,class:"mt-1 text-warning"},bi=Fe({__name:"CreateVariantDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save"],setup(S,{emit:be}){const q=S,z=be,J=I(),g=I(!1),G=I(!1),T=I([]),h=I({name:"",selectedProduct:null,selectedProductId:null,active:!0}),p=[b=>!!b||"Nama variant wajib diisi",b=>b.length>=3||"Nama variant minimal 3 karakter"],j=[b=>!!b||"Produk wajib dipilih"],f=(b,m="success")=>{const k=document.createElement("div");k.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${m==="success"?"#4CAF50":"#f44336"};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 9999;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
  `;const R=document.createElement("span");if(R.innerHTML=m==="success"?"✓":"✕",R.style.cssText=`
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    font-weight: bold;
  `,k.appendChild(R),k.appendChild(document.createTextNode(b)),!document.querySelector("#snackbar-styles")){const _e=document.createElement("style");_e.id="snackbar-styles",_e.textContent=`
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `,document.head.appendChild(_e)}document.body.appendChild(k),setTimeout(()=>{k.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{k.parentNode&&k.parentNode.removeChild(k)},300)},3e3)},U=async()=>{G.value=!0;try{const b=await Ne.get("/api/products");T.value=b.data.data||b.data||[]}catch(b){console.error("Gagal mengambil data produk:",b),T.value=[]}finally{G.value=!1}},de=b=>{!b&&T.value.length===0&&U()},ke=b=>{h.value.selectedProduct=b,b?h.value.selectedProductId=b.id:h.value.selectedProductId=null},C=me(()=>h.value.selectedProduct?h.value.selectedProduct:h.value.selectedProductId&&T.value.length>0?T.value.find(m=>m.id===h.value.selectedProductId):null),re=()=>{const b=C.value;if(!b||!h.value.name)return"";const m=b.sku||"PROD",k=h.value.name.replace(/\s+/g,"").toUpperCase().substring(0,3),R=Date.now().toString().slice(-4);return`${m}-${k}-${R}`},se=async()=>{var k,R;if(g.value)return;const{valid:b}=await J.value.validate();if(!b)return;const m=C.value;if(!m){f("Produk tidak ditemukan","error");return}if(!m.id&&!m.id_product){f("ID Produk tidak valid","error"),console.error("Product missing ID:",m);return}g.value=!0;try{const _e={id_product:m.id||m.id_product,name:h.value.name,sku:re(),price:0,cost_price:null,barcode:null,variant_values:[],active:h.value.active},pe=await Ne.post("/api/variants",_e);if(pe.data.success!==!1&&(pe.status===200||pe.status===201))f("Variant berhasil dibuat!","success"),z("save"),ve();else throw new Error(pe.data.message||"Gagal membuat variant")}catch(_e){const pe=((R=(k=_e.response)==null?void 0:k.data)==null?void 0:R.message)||_e.message||"Gagal membuat variant";f(pe,"error"),console.error("Save variant error:",_e)}finally{g.value=!1}},Q=()=>{var b;h.value={name:"",selectedProduct:null,selectedProductId:null,active:!0},(b=J.value)==null||b.resetValidation()},ve=()=>{z("update:modelValue",!1),Q()};return Ce(()=>q.modelValue,b=>{b&&(Q(),U())}),(b,m)=>(v(),K(Ee,{"model-value":b.modelValue,"onUpdate:modelValue":m[3]||(m[3]=k=>b.$emit("update:modelValue",k)),"max-width":"600px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"bg-primary text-white"},{default:t(()=>[e(_,{icon:"mdi-plus-circle",class:"me-2"}),m[4]||(m[4]=d(" Tambah Variant Baru ")),e(Oe),e(F,{icon:"mdi-close",variant:"text",color:"white",onClick:ve})]),_:1,__:[4]}),e(bt,{ref_key:"formRef",ref:J,onSubmit:kt(se,["prevent"])},{default:t(()=>[e(ae,{class:"pa-6"},{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12"},{default:t(()=>[e(yt,{modelValue:h.value.selectedProduct,"onUpdate:modelValue":[m[0]||(m[0]=k=>h.value.selectedProduct=k),ke],items:T.value,loading:G.value,"item-title":"name","return-object":"",label:"Pilih Produk *",placeholder:"Cari produk...",variant:"outlined",rules:j,required:"","no-data-text":"Tidak ada produk ditemukan","onUpdate:search":de},{item:t(({props:k,item:R})=>[e(je,aa(la(k)),{prepend:t(()=>[e($e,{image:R.raw.image_url,size:"40"},{default:t(()=>[R.raw.image_url?W("",!0):(v(),K(_,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"])]),default:t(()=>[e(Ye,null,{default:t(()=>[d(r(R.raw.name),1)]),_:2},1024),e(tt,null,{default:t(()=>[d("SKU: "+r(R.raw.sku||"-"),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:k})=>[o("div",gi,[e($e,{image:k.raw.image_url,size:"24"},{default:t(()=>[k.raw.image_url?W("",!0):(v(),K(_,{key:0,icon:"mdi-coffee",size:"16"}))]),_:2},1032,["image"]),o("span",null,r(k.raw.name),1)])]),_:1},8,["modelValue","items","loading"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(xe,{modelValue:h.value.name,"onUpdate:modelValue":m[1]||(m[1]=k=>h.value.name=k),label:"Nama Variant *",placeholder:"Contoh: Large Hot, Medium Cold, dll",variant:"outlined",rules:p,required:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ke,{color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ct,null,{default:t(()=>[e(_,{icon:"mdi-information",class:"me-2"}),m[5]||(m[5]=d(" SKU Otomatis "))]),_:1,__:[5]}),o("div",_i,[m[6]||(m[6]=d(" SKU variant akan dibuat otomatis berdasarkan nama produk dan variant ")),h.value.name&&(h.value.selectedProduct||h.value.selectedProductId)?(v(),X("div",ki," Preview SKU: "+r(re()),1)):h.value.name&&!h.value.selectedProduct&&!h.value.selectedProductId?(v(),X("div",yi," Pilih produk terlebih dahulu untuk melihat preview SKU ")):W("",!0)])]),_:1})]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ze,{modelValue:h.value.active,"onUpdate:modelValue":m[2]||(m[2]=k=>h.value.active=k),label:"Variant Aktif",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Ue),e(Re,{class:"pa-6"},{default:t(()=>[e(Oe),e(F,{variant:"outlined",onClick:ve,disabled:g.value},{default:t(()=>m[7]||(m[7]=[d(" Batal ")])),_:1,__:[7]},8,["disabled"]),e(F,{type:"submit",color:"primary",loading:g.value},{default:t(()=>m[8]||(m[8]=[d(" Simpan Variant ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),hi=Le(bi,[["__scopeId","data-v-5477c365"]]),xi={class:"product-variant-tab"},wi={class:"d-flex gap-2"},Pi={key:0,class:"mt-4 d-flex align-center gap-2"},Vi={key:1,class:"text-center pa-12"},Ci={key:2,class:"text-center pa-12"},$i={class:"d-flex align-center gap-3"},Si={class:"flex-grow-1 min-width-0"},Ii={class:"text-h6 font-weight-bold text-truncate"},Di={class:"text-body-2 text-medium-emphasis mb-0"},zi={class:"d-flex flex-column gap-1"},Ti={class:"text-xs"},Ui={class:"d-flex align-center gap-2"},Ai={class:"text-primary font-weight-medium"},Hi={class:"d-flex gap-1"},Mi={class:"d-flex align-center justify-space-between w-100"},Ki={class:"d-flex gap-1"},Bi=Fe({__name:"ProductVariantTab",props:{loading:{type:Boolean}},emits:["refresh"],setup(S,{emit:be}){const q=be,z=I(!1),J=I([]),g=I(!1),G=I(!1),T=I(null),h=I(!1),p=I(!1),j=I(!1),f=I({search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}),U=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],de=[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Variant Terbanyak",value:"variants_desc"},{title:"Variant Tersedikit",value:"variants_asc"}],ke=me(()=>!!(f.value.search||f.value.stockStatus||f.value.activeStatus!==null||f.value.sortBy!=="name_asc")),C=me(()=>{const i={};return J.value.forEach(a=>{const l=a.id_product;i[l]||(i[l]={product:a.product||{id:a.id_product,id_product:a.id_product,name:`Product ${a.id_product}`,sku:""},variants:[]}),i[l].variants.push(a)}),Object.values(i)}),re=me(()=>{let i=[...C.value];if(f.value.search){const a=f.value.search.toLowerCase();i=i.filter(l=>{var u;return l.product.name.toLowerCase().includes(a)||((u=l.product.sku)==null?void 0:u.toLowerCase().includes(a))||l.variants.some(te=>te.name.toLowerCase().includes(a)||te.sku.toLowerCase().includes(a))})}switch(f.value.stockStatus&&(i=i.filter(a=>a.variants.some(l=>{var te;return(((te=l.composition_summary)==null?void 0:te.stock_status)||"safe")===f.value.stockStatus}))),f.value.activeStatus!==null&&(i=i.filter(a=>a.variants.some(l=>l.is_active===f.value.activeStatus))),f.value.sortBy){case"name_asc":i.sort((a,l)=>a.product.name.localeCompare(l.product.name));break;case"name_desc":i.sort((a,l)=>l.product.name.localeCompare(a.product.name));break;case"variants_desc":i.sort((a,l)=>l.variants.length-a.variants.length);break;case"variants_asc":i.sort((a,l)=>a.variants.length-l.variants.length);break}return i}),se=(i,a="success")=>{},Q=async i=>{try{const a=J.value.findIndex(l=>l.id_variant===i.variantId);a!==-1&&(J.value[a]={...J.value[a],price:i.newPrice,cost:i.hpp}),se(`Price updated to ${new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(i.newPrice)}`,"success")}catch(a){console.error("Error handling price update:",a),await ve()}},ve=async()=>{var i,a,l;z.value=!0;try{const u=await Ne.get("/api/variants",{params:{per_page:1e3,with_product:!0,with_composition:!0}});if(u.data.success===!1)throw new Error(u.data.message||"Failed to load variants");const te=((i=u.data.data)==null?void 0:i.data)||u.data.data||[];J.value=te.map(L=>({...L,is_active:L.active!==void 0?L.active:L.is_active,id:L.id_variant||L.id,id_product:L.id_product||L.product_id}))}catch(u){(l=(a=u.response)==null?void 0:a.data)!=null&&l.message||u.message,J.value=[]}finally{z.value=!1}},b=i=>{T.value=i,h.value=!0},m=i=>{i&&(T.value=i,p.value=!0)},k=i=>{T.value=i,g.value=!0},R=()=>{j.value=!0},_e=async()=>{var i,a;if(T.value)try{G.value=!0,await Ne.delete(`/api/variants/${T.value.id_variant}`),se("Variant berhasil dihapus","success"),await ve(),g.value=!1}catch(l){(a=(i=l.response)==null?void 0:i.data)!=null&&a.message}finally{G.value=!1}},pe=i=>{switch(i){case"critical":return"error";case"out":return"error";case"safe":return"success";default:return"primary"}},fe=i=>{switch(i){case"critical":return"Kritis";case"out":return"Habis";case"safe":return"Aman";default:return"Normal"}},w=i=>{const a=i.filter(l=>l.is_active).length;return a===0?"error":a===i.length?"success":"warning"},N=i=>i.some(a=>{var u;const l=(u=a.composition_summary)==null?void 0:u.stock_status;return l==="critical"||l==="out"}),x=i=>{const a=i.filter(u=>u.is_active).length,l=i.filter(u=>{var L;const te=(L=u.composition_summary)==null?void 0:L.stock_status;return te==="critical"||te==="out"}).length;return l>0?{text:`${l} Stok Kritis`,color:"error",icon:"mdi-alert-circle"}:a===i.length?{text:"Semua Aktif",color:"success",icon:"mdi-check-circle"}:a===0?{text:"Semua Nonaktif",color:"error",icon:"mdi-close-circle"}:{text:`${a}/${i.length} Aktif`,color:"warning",icon:"mdi-minus-circle"}},O=()=>{f.value={search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}},M=()=>{ve(),q("refresh")},y=()=>{ve(),q("refresh")};return et(()=>{ve()}),(i,a)=>{var l,u,te;return v(),X("div",xi,[e(ee,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(we,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a[14]||(a[14]=o("div",null,[o("h2",{class:"text-h5 font-weight-bold"},"Variant Produk"),o("p",{class:"text-body-2 text-medium-emphasis"}," Kelola variant dan komposisi untuk produk Anda ")],-1)),o("div",wi,[e(F,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:ve,loading:z.value},{default:t(()=>a[12]||(a[12]=[d(" Refresh ")])),_:1,__:[12]},8,["loading"]),e(F,{color:"primary","prepend-icon":"mdi-plus",onClick:R},{default:t(()=>a[13]||(a[13]=[d(" Tambah Variant ")])),_:1,__:[13]})])]),_:1,__:[14]})]),_:1}),e(ee,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ae,null,{default:t(()=>[e(Se,null,{default:t(()=>[e($,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:f.value.search,"onUpdate:modelValue":a[0]||(a[0]=L=>f.value.search=L),label:"Cari Variant",placeholder:"Nama variant, SKU, atau produk...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:f.value.stockStatus,"onUpdate:modelValue":a[1]||(a[1]=L=>f.value.stockStatus=L),items:U,label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:f.value.activeStatus,"onUpdate:modelValue":a[2]||(a[2]=L=>f.value.activeStatus=L),items:[{title:"Semua Status",value:null},{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Status Aktif",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:f.value.sortBy,"onUpdate:modelValue":a[3]||(a[3]=L=>f.value.sortBy=L),items:de,label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),ke.value?(v(),X("div",Pi,[a[16]||(a[16]=o("span",{class:"text-body-2"},"Filter aktif:",-1)),f.value.search?(v(),K(oe,{key:0,size:"small",closable:"","onClick:close":a[4]||(a[4]=L=>f.value.search="")},{default:t(()=>[d(" Pencarian: "+r(f.value.search),1)]),_:1})):W("",!0),f.value.stockStatus?(v(),K(oe,{key:1,size:"small",closable:"","onClick:close":a[5]||(a[5]=L=>f.value.stockStatus="")},{default:t(()=>{var L;return[d(" Stok: "+r((L=U.find(ce=>ce.value===f.value.stockStatus))==null?void 0:L.title),1)]}),_:1})):W("",!0),f.value.activeStatus!==null?(v(),K(oe,{key:2,size:"small",closable:"","onClick:close":a[6]||(a[6]=L=>f.value.activeStatus=null)},{default:t(()=>[d(" Status: "+r(f.value.activeStatus?"Aktif":"Nonaktif"),1)]),_:1})):W("",!0),e(F,{variant:"text",size:"small",color:"error",onClick:O},{default:t(()=>a[15]||(a[15]=[d(" Hapus Semua Filter ")])),_:1,__:[15]})])):W("",!0)]),_:1})]),_:1}),!z.value&&re.value.length===0&&ke.value?(v(),K(Ke,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada variant yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):W("",!0),z.value?(v(),X("div",Vi,[e(it,{color:"primary",indeterminate:"",size:"64"}),a[17]||(a[17]=o("div",{class:"mt-4 text-h6"},"Memuat variant...",-1))])):C.value.length===0?(v(),X("div",Ci,[e(_,{icon:"mdi-tune-variant",size:"96",class:"text-disabled mb-6"}),a[19]||(a[19]=o("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Variant Produk",-1)),a[20]||(a[20]=o("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat variant untuk produk Anda agar dapat menawarkan pilihan yang beragam ",-1)),e(F,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:R},{default:t(()=>a[18]||(a[18]=[d(" Buat Variant Pertama ")])),_:1,__:[18]})])):(v(),K(Se,{key:3},{default:t(()=>[(v(!0),X(Te,null,We(re.value,L=>(v(),K($,{key:L.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ee,{class:Ge(["variant-group-card h-100",{"border-error":N(L.variants)}]),elevation:"2"},{default:t(()=>[e(we,{class:"pa-4 pb-2"},{default:t(()=>[o("div",$i,[e($e,{image:L.product.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[L.product.image_url?W("",!0):(v(),K(_,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),o("div",Si,[o("h3",Ii,r(L.product.name),1),o("p",Di," SKU: "+r(L.product.sku||"-"),1)]),e(oe,{color:w(L.variants),size:"small",variant:"tonal"},{default:t(()=>[d(r(L.variants.length)+" Variant ",1)]),_:2},1032,["color"])])]),_:2},1024),e(Ue),e(ae,{class:"pa-4"},{default:t(()=>[e(nt,{class:"pa-0"},{default:t(()=>[(v(!0),X(Te,null,We(L.variants,(ce,ze)=>(v(),K(je,{key:ce.id_variant,class:Ge(["pa-2 rounded-lg variant-item",{"mb-2":ze<L.variants.length-1}])},{prepend:t(()=>[e($e,{size:"32",color:ce.is_active?"success":"error",variant:"tonal"},{default:t(()=>[e(_,{icon:ce.is_active?"mdi-check":"mdi-close",size:"16"},null,8,["icon"])]),_:2},1032,["color"])]),append:t(()=>[o("div",Hi,[e(Me,{text:"Kelola Komposisi"},{activator:t(({props:le})=>[e(F,he({ref_for:!0},le,{icon:"mdi-chef-hat",size:"small",variant:"text",color:"primary",onClick:De=>b(ce)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Hapus Variant"},{activator:t(({props:le})=>[e(F,he({ref_for:!0},le,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:De=>k(ce)}),null,16,["onClick"])]),_:2},1024)])]),default:t(()=>[e(Ye,{class:"text-sm font-weight-medium"},{default:t(()=>[d(r(ce.name),1)]),_:2},1024),e(tt,null,{default:t(()=>[o("div",zi,[o("span",Ti,"SKU: "+r(ce.sku),1),o("div",Ui,[o("span",Ai,r(H(He)(ce.price||0)),1),ce.composition_summary?(v(),K(oe,{key:0,color:pe(ce.composition_summary.stock_status),size:"x-small",variant:"tonal"},{default:t(()=>[d(r(fe(ce.composition_summary.stock_status)),1)]),_:2},1032,["color"])):W("",!0)])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:2},1024)]),_:2},1024),e(Ue),e(Re,{class:"pa-4"},{default:t(()=>[o("div",Mi,[o("div",null,[e(oe,{color:x(L.variants).color,size:"small",variant:"tonal"},{default:t(()=>[e(_,{icon:x(L.variants).icon,size:"14",class:"me-1"},null,8,["icon"]),d(" "+r(x(L.variants).text),1)]),_:2},1032,["color"])]),o("div",Ki,[e(Me,{text:"Setting HPP Produk"},{activator:t(({props:ce})=>[e(F,he({ref_for:!0},ce,{icon:"mdi-calculator-variant",size:"small",variant:"text",color:"warning",onClick:ze=>m(L.variants[0])}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Tambah Variant"},{activator:t(({props:ce})=>[e(F,he({ref_for:!0},ce,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:R}),null,16)]),_:1}),e(Me,{text:"Pengaturan Produk (Coming Soon)"},{activator:t(({props:ce})=>[e(F,he({ref_for:!0},ce,{icon:"mdi-cog",size:"small",variant:"text",color:"secondary",disabled:""}),null,16)]),_:1})])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(fi,{modelValue:h.value,"onUpdate:modelValue":a[7]||(a[7]=L=>h.value=L),variant:T.value,onSave:M},null,8,["modelValue","variant"]),e(Tt,{modelValue:p.value,"onUpdate:modelValue":a[8]||(a[8]=L=>p.value=L),"variant-id":(l=T.value)==null?void 0:l.id_variant,"variant-name":(u=T.value)==null?void 0:u.name,onHppUpdated:ve,onPriceUpdated:Q},null,8,["modelValue","variant-id","variant-name"]),e(hi,{modelValue:j.value,"onUpdate:modelValue":a[9]||(a[9]=L=>j.value=L),onSave:y},null,8,["modelValue"]),e(St,{modelValue:g.value,"onUpdate:modelValue":a[10]||(a[10]=L=>g.value=L),title:"Konfirmasi Hapus Variant","item-name":(te=T.value)==null?void 0:te.name,loading:G.value,"confirm-text":"Hapus Variant",onConfirm:_e,onCancel:a[11]||(a[11]=L=>g.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),$t=Le(Bi,[["__scopeId","data-v-22b81d4b"]]),Fi={class:"product-management"},Ei={class:"d-flex justify-space-between align-center mb-6"},Ri={class:"d-flex gap-3 align-center"},Li={key:0,class:"d-flex gap-2"},qi={class:"d-flex align-center"},Ni=Fe({__name:"products-management",setup(S){It();const{productsList:be,categories:q,loading:z,saveLoading:J,deleteLoading:g,toggleLoading:G,stats:T,dialog:h,deleteDialog:p,editMode:j,selectedProduct:f,selectedProducts:U,currentPage:de,totalItems:ke,itemsPerPage:C,filters:re,errorMessage:se,successMessage:Q,modalErrorMessage:ve,formData:b,selectedImage:m,imagePreview:k,canCreateEdit:R,hasSelectedProducts:_e,fetchProductsList:pe,fetchCategories:fe,fetchStats:w,saveProduct:N,deleteProduct:x,bulkDeleteProducts:O,toggleActiveStatus:M,toggleFeaturedStatus:y,toggleKitchenAvailability:i,toggleBarAvailability:a,openCreateDialog:l,openEditDialog:u,openDeleteDialog:te,closeDialog:L,handleImageUpload:ce,clearModalError:ze,updateOptions:le}=Dt(),{dialog:De,editMode:Ae,formData:Qe,availableItems:Je,saveLoading:D,modalErrorMessage:n,openCreateDialog:s,closeDialog:V,saveRecipe:B,clearModalError:E,fetchAvailableItems:c}=fa(),{productItemsList:A,loading:Y,fetchProductItemsForComposition:P}=Bt(),ie=I("products"),ue=I(),ne=I(!1),Pe=I(null),ye=I(!1),Ve=I(null),qe=async()=>{await x()},Xe=async()=>{await O()},rt=Ie=>{const Z=Ie.id_product||Ie.id;s(Z)},ut=async Ie=>{Pe.value=Ie;try{await P({page:1,per_page:100,critical_only:!1})}catch{}ne.value=!0},Ut=Ie=>{Ve.value=Ie,ye.value=!0},At=Ie=>{if(!Ie)return[];const Z=Ie.id_product||Ie.id;return A.value.filter(lt=>{var ge;return((ge=lt.product)==null?void 0:ge.id_product)===Z||lt.product_id===Z})||[]},ht=async()=>{if(await P({page:1,per_page:100,critical_only:!1}),await pe(),Pe.value&&ue.value){const Ie=Pe.value.id_product||Pe.value.id;await ue.value.refreshHPPData(Ie)}},Ht=Ie=>{Object.assign(re,Ie),pe()},Mt=Ie=>{console.log("Search query received:",Ie),re.search=Ie,console.log("Filters after search update:",re),pe()},Kt=()=>{m.value=null,k.value&&(k.value="")};return Ce(ie,async Ie=>{Ie==="compositions"&&await P({page:1,per_page:100,critical_only:!1})},{immediate:!1}),et(()=>{pe(),fe(),w(),c(),P({page:1,per_page:100,critical_only:!1})}),(Ie,Z)=>{var lt;return v(),X("div",Fi,[o("div",Ei,[Z[18]||(Z[18]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),o("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),o("div",Ri,[H(_e)&&ie.value==="products"?(v(),X("div",Li,[e(oe,{color:"primary",size:"small"},{default:t(()=>[d(r(H(U).length)+" dipilih ",1)]),_:1}),e(F,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:Xe},{default:t(()=>Z[16]||(Z[16]=[d(" Hapus Terpilih ")])),_:1,__:[16]})])):W("",!0),H(R)&&ie.value==="products"?(v(),K(F,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:H(l)},{default:t(()=>Z[17]||(Z[17]=[d(" Tambah Produk ")])),_:1,__:[17]},8,["onClick"])):W("",!0)])]),e(Ia,{modelValue:ie.value,"onUpdate:modelValue":Z[0]||(Z[0]=ge=>ie.value=ge),class:"mb-6"},{default:t(()=>[e(vt,{value:"products"},{default:t(()=>[e(_,{icon:"mdi-coffee",class:"me-2"}),Z[19]||(Z[19]=d(" Produk "))]),_:1,__:[19]}),e(vt,{value:"compositions"},{default:t(()=>[e(_,{icon:"mdi-chef-hat",class:"me-2"}),Z[20]||(Z[20]=d(" Komposisi Produk "))]),_:1,__:[20]}),e(vt,{value:"variants"},{default:t(()=>[e(_,{icon:"mdi-tune-variant",class:"me-2"}),Z[21]||(Z[21]=d(" Variant Produk "))]),_:1,__:[21]})]),_:1},8,["modelValue"]),H(se)?(v(),K(Ke,{key:0,type:"error",variant:"outlined",class:"mb-4",text:H(se),closable:"","onClick:close":Z[1]||(Z[1]=ge=>se.value="")},null,8,["text"])):W("",!0),H(Q)?(v(),K(Ke,{key:1,type:"success",variant:"outlined",class:"mb-4",text:H(Q),closable:"","onClick:close":Z[2]||(Z[2]=ge=>Q.value="")},null,8,["text"])):W("",!0),e(Da,{modelValue:ie.value,"onUpdate:modelValue":Z[4]||(Z[4]=ge=>ie.value=ge)},{default:t(()=>[e(pt,{value:"products"},{default:t(()=>[e(ts,{stats:H(T)},null,8,["stats"]),e(Ko,{filters:H(re),"onUpdate:filters":Ht,onSearch:Mt},null,8,["filters"]),e(xs,{ref_key:"productTableRef",ref:ue,products:H(be),loading:H(z),"current-page":H(de),"total-items":H(ke),"items-per-page":H(C),"selected-products":H(U),"toggle-loading":H(G),"onUpdate:options":H(le),onAddProduct:H(l),onEditProduct:H(u),onOpenRecipeDialog:rt,onOpenCompositionDialog:ut,onOpenVariantDialog:Ut,onDeleteProduct:H(te),onToggleActive:H(M),onToggleFeatured:H(y),onToggleKitchen:H(i),onToggleBar:H(a),"onUpdate:selectedProducts":Z[3]||(Z[3]=ge=>U.value=ge)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:options","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured","onToggleKitchen","onToggleBar"])]),_:1}),e(pt,{value:"compositions"},{default:t(()=>[e(ao,{"product-items":H(A),loading:H(Y),onRefresh:H(P)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(pt,{value:"variants"},{default:t(()=>[e($t,{loading:H(z),onRefresh:H(pe)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(To,{modelValue:H(h),"onUpdate:modelValue":[Z[5]||(Z[5]=ge=>mt(h)?h.value=ge:null),Z[6]||(Z[6]=ge=>h.value=ge)],"edit-mode":H(j),"form-data":H(b),categories:H(q),loading:H(J),"error-message":H(ve),"selected-image":H(m)?[H(m)]:[],"image-preview":H(k),onClose:H(L),onSubmit:H(N),onImageChange:H(ce),onRemoveImage:Kt,onClearError:H(ze),onUpdateForm:Z[7]||(Z[7]=(ge,xt)=>H(b)[ge]=xt)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(ga,{modelValue:H(De),"onUpdate:modelValue":[Z[8]||(Z[8]=ge=>mt(De)?De.value=ge:null),Z[9]||(Z[9]=ge=>De.value=ge)],"edit-mode":H(Ae),"form-data":H(Qe),"available-items":H(Je),loading:H(D),"error-message":H(n),onClose:H(V),onSave:H(B),onClearError:H(E)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(St,{modelValue:H(p),"onUpdate:modelValue":Z[10]||(Z[10]=ge=>mt(p)?p.value=ge:null),title:"Konfirmasi Hapus Produk","item-name":(lt=H(f))==null?void 0:lt.name,loading:H(g),"confirm-text":"Hapus Produk",onConfirm:qe,onCancel:Z[11]||(Z[11]=ge=>p.value=!1)},null,8,["modelValue","item-name","loading"]),e(zt,{modelValue:ne.value,"onUpdate:modelValue":Z[12]||(Z[12]=ge=>ne.value=ge),product:Pe.value,items:At(Pe.value),onSave:ht,onRefresh:ht},null,8,["modelValue","product","items"]),e(Ee,{modelValue:ye.value,"onUpdate:modelValue":Z[15]||(Z[15]=ge=>ye.value=ge),"max-width":"1400px",persistent:""},{default:t(()=>[e(ee,null,{default:t(()=>[e(we,{class:"d-flex justify-between align-center"},{default:t(()=>{var ge;return[o("div",qi,[e(_,{icon:"tabler-versions",class:"me-2"}),d(" Kelola Variant - "+r((ge=Ve.value)==null?void 0:ge.name),1)]),e(F,{icon:"tabler-x",variant:"text",onClick:Z[13]||(Z[13]=xt=>ye.value=!1)})]}),_:1}),e(Ue),e(ae,{class:"pa-0"},{default:t(()=>[Ve.value?(v(),K($t,{key:0,product:Ve.value},null,8,["product"])):W("",!0)]),_:1}),e(Ue),e(Re,null,{default:t(()=>[e(Oe),e(F,{color:"grey-darken-1",variant:"outlined",onClick:Z[14]||(Z[14]=ge=>ye.value=!1)},{default:t(()=>[e(_,{icon:"mdi-close",class:"me-1"}),Z[22]||(Z[22]=d(" Tutup "))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Mn=Le(Ni,[["__scopeId","data-v-0500c9fb"]]);export{Mn as default};
