import{r as v,V as T,w as ne,bi as le,d as fe,ab as ke,D as ye,c as p,e as s,b as r,f as c,t as m,a1 as S,g as W,l as z,F as ie,i as ue,ax as be,X as I,m as h,o as d,s as i,v as re,a0 as he,_ as Ce}from"./main-DGh5Nwpa.js";import{P as L}from"./PosApi-Bg4WsKQs.js";import Ve from"./CashDrawerDialog-D7WSazZi.js";import we from"./PaymentDialog-B-M6K5gL.js";import xe from"./TransactionHistoryDialog-CblvND6s.js";import{V as De}from"./VAvatar-C3epMzZ-.js";import{V as Se}from"./VTextField-8XleqEm2.js";import{V as ce}from"./VSelect-BbvHtFp4.js";import{V as de}from"./VChip-D-hpJwqG.js";import{V as Ie}from"./VDialog-BNeciKZr.js";import{V as Te}from"./VSnackbar-C10JU3oQ.js";import{V as ze}from"./VImg-pcSTi1VD.js";import{V as Pe,b as Ae,c as qe}from"./VCard-CDCVaLyl.js";import{V as Ee}from"./VCardText-Bgvdx-bB.js";import{V as Be}from"./VSpacer-DE1iSBu2.js";import"./auth-CuuXRWj5.js";import"./VDivider-D9PgDXT6.js";import"./VRow-D8cHFDYl.js";/* empty css              */import"./VForm-CA1vLOrP.js";import"./forwardRefs-B931MWyl.js";import"./VTextarea-Bz2_EVBy.js";import"./DiscountCodeInput-DZw68sQ4.js";import"./PromotionSuggestions-dJjKYbhr.js";import"./VCheckboxBtn-B4gnngxM.js";import"./EditOrderDialog-D2lV1tsg.js";import"./OrderDetailDialog-C7GazZEu.js";import"./VTable-COUHwWOl.js";import"./VDataTable-CdjvirIl.js";import"./filter-bIEq24bs.js";import"./VList-CPmEsnxS.js";import"./VOverlay-DRWd7XTC.js";import"./VMenu-C_tZHj7u.js";const $e=()=>{const _=v([]),B=v(null),u=v(0),g=v("amount"),R=v(0),M=v(!1),f=v(null),k=T(()=>_.value.reduce((a,o)=>a+o.selling_price*o.quantity,0)),C=T(()=>u.value?g.value==="percentage"?k.value*u.value/100:u.value:0),P=T(()=>(k.value-C.value)*R.value/100),N=T(()=>Math.max(0,k.value-C.value+P.value)),O=T(()=>_.value.reduce((a,o)=>a+o.quantity,0)),$=T(()=>_.value.length===0),y=T(()=>({subtotal:k.value,discountAmount:C.value,discountType:g.value,taxAmount:P.value,totalAmount:N.value})),j=(a,o=1)=>{try{const n=_.value.find(b=>b.id_product===a.id_product);if(n){const b=n.quantity+o;if(b<=a.stock)n.quantity=b;else throw new Error(`Stok tidak mencukupi. Tersedia: ${a.stock}`)}else if(o<=a.stock)_.value.push({...a,quantity:o});else throw new Error(`Stok tidak mencukupi. Tersedia: ${a.stock}`);return f.value=null,!0}catch(n){return f.value=n instanceof Error?n.message:"Gagal menambahkan ke keranjang",!1}},A=a=>{const o=_.value.findIndex(n=>n.id_product===a);o>-1&&_.value.splice(o,1)},F=(a,o)=>{const n=_.value.find(b=>b.id_product===a);if(n)if(o<=0)A(a);else if(o<=n.stock)n.quantity=o;else return f.value=`Stok tidak mencukupi. Tersedia: ${n.stock}`,!1;return!0},K=()=>{_.value=[],B.value=null,u.value=0,g.value="amount",f.value=null},Q=(a,o="amount")=>o==="percentage"&&a>100?(f.value="Diskon persentase tidak boleh lebih dari 100%",!1):o==="amount"&&a>k.value?(f.value="Diskon tidak boleh lebih dari subtotal",!1):(u.value=a,g.value=o,f.value=null,!0),E=()=>{u.value=0,g.value="amount"},J=a=>{B.value=a},Y=async(a,o="takeaway")=>{try{if(M.value=!0,f.value=null,$.value)throw new Error("Keranjang kosong");const n={order_type:o,id_customer:B.value||void 0,guest_count:1,notes:a.notes},V=(await L.createOrder(n)).data;for(const w of _.value)await L.addItem(V.id_order,{id_product:w.id_product,id_variant:w.id_variant||void 0,quantity:w.quantity,price:w.selling_price,notes:""});return C.value>0&&await L.applyDiscount(V.id_order,{discount_type:g.value==="percentage"?"percentage":"fixed",discount_value:g.value==="percentage"?u.value:C.value}),await L.processPayment(V.id_order,{payment_method:a.payment_method,amount:a.amount,reference_number:a.reference_number,notes:a.notes}),K(),V}catch(n){throw f.value=n instanceof Error?n.message:"Gagal membuat pesanan",n}finally{M.value=!1}},q=()=>{const a=[];return $.value&&a.push("Keranjang kosong"),_.value.forEach(o=>{o.quantity>o.stock&&a.push(`Stok ${o.name} tidak mencukupi`)}),C.value>k.value&&a.push("Diskon tidak boleh lebih dari subtotal"),{isValid:a.length===0,errors:a}},se=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),Z=a=>_.value.find(o=>o.id_product===a),ee=a=>{const o=Z(a);return o?o.quantity:0},U=(a,o=1)=>ee(a.id_product)+o<=a.stock;ne([_,u,g],()=>{const a=q();!a.isValid&&a.errors.length>0?f.value=a.errors[0]:f.value=null},{deep:!0}),ne([u,g,k],()=>{g.value==="percentage"&&u.value>100&&(u.value=100),C.value>k.value&&(g.value==="amount"?u.value=k.value:u.value=100)});const G=(a,o)=>o==="kitchen"?a.available_in_kitchen!==!1:o==="bar"?a.available_in_bar!==!1:!1,oe=a=>a.available_in_kitchen!==!1&&a.available_in_bar!==!1,te=a=>{const o=[];return a.available_in_kitchen!==!1&&o.push("kitchen"),a.available_in_bar!==!1&&o.push("bar"),o},ae=(a,o)=>a.every(n=>G(n,o)),H=a=>{const o=[],n=[],b=[];return a.forEach(V=>{const w=te(V);w.length===1?w[0]==="kitchen"?o.push(V):w[0]==="bar"&&n.push(V):w.length===2&&b.push(V)}),{kitchen:o,bar:n,both:b}};return{cartItems:le(_),selectedCustomer:B,discountAmount:u,discountType:g,taxRate:R,loading:le(M),error:le(f),subtotal:k,discountValue:C,taxValue:P,totalAmount:N,cartCount:O,isEmpty:$,orderSummary:y,addToCart:j,removeFromCart:A,updateQuantity:F,clearCart:K,applyDiscount:Q,removeDiscount:E,setCustomer:J,createOrder:Y,validateCart:q,formatCurrency:se,getCartItemById:Z,getItemQuantity:ee,canAddToCart:U,isAvailableInStation:G,isAvailableInBothStations:oe,getAvailableStations:te,canProcessOrderInStation:ae,getStationRequirements:H}},je={class:"pos-layout"},Fe={class:"pos-header"},Ke={class:"header-content"},Ue={class:"header-left"},He={class:"logo-section"},Le={class:"header-info"},Re={class:"header-meta"},Me={class:"header-actions"},Ne={class:"pos-main"},Oe={class:"product-panel"},Qe={class:"filter-bar"},Je={class:"search-section"},Ge={class:"filter-section"},Xe={class:"products-container"},We={key:0,class:"products-grid"},Ye=["onClick"],Ze={class:"product-image"},et={class:"product-image-wrapper"},tt={key:1,class:"product-image-placeholder"},at={class:"placeholder-text"},st={class:"station-badges"},ot={key:0,class:"station-badge kitchen-badge",title:"Tersedia di Kitchen"},lt={key:1,class:"station-badge bar-badge",title:"Tersedia di Bar"},rt={key:0,class:"status-indicator out-of-stock-indicator"},nt={key:1,class:"status-indicator no-price-indicator"},it={key:2,class:"cart-indicator"},ut={class:"product-info"},ct={class:"product-name"},dt={class:"product-sku"},mt={class:"product-footer"},vt={key:1,class:"empty-state"},pt={key:2,class:"empty-state"},_t={class:"empty-title"},gt={class:"empty-text"},ft={class:"cart-panel"},kt={class:"cart-header"},yt={class:"cart-title"},bt={class:"cart-content"},ht={key:0,class:"cart-items"},Ct={class:"item-info"},Vt={class:"item-name"},wt={class:"item-price"},xt={class:"item-controls"},Dt={class:"quantity-controls"},St={class:"quantity"},It={class:"item-total"},Tt={key:1,class:"empty-cart"},zt={key:0,class:"cart-summary"},Pt={class:"summary-row"},At={class:"summary-value"},qt={class:"summary-row"},Et={class:"summary-value"},Bt={class:"summary-row"},$t={class:"summary-value summary-total"},jt=fe({__name:"index",setup(_){const B=ke(),{cartItems:u,subtotal:g,cartCount:R,addToCart:M,removeFromCart:f,updateQuantity:k,clearCart:C}=$e(),P=v(!1),N=v([]),O=v([]),$=v([]),y=v(""),j=v(null),A=v(null),F=v(!1),K=v(!1),Q=v(!1),E=v(!1),J=v(""),Y=v({}),q=v({show:!1,message:"",color:"success"});setInterval(()=>{J.value=new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})},1e3);const se=T(()=>B.user);T(()=>new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}));const Z=T(()=>u.value.map(l=>({...l}))),ee=[{title:"Kitchen",value:"kitchen"},{title:"Bar",value:"bar"}],U=T(()=>{let l=N.value;if(y.value){const e=y.value.toLowerCase();l=l.filter(x=>{var t,D;return x.name.toLowerCase().includes(e)||((t=x.sku)==null?void 0:t.toLowerCase().includes(e))||((D=x.barcode)==null?void 0:D.toLowerCase().includes(e))})}return j.value&&(l=l.filter(e=>e.id_category===j.value)),A.value&&(l=l.filter(e=>A.value==="kitchen"?e.available_in_kitchen!==!1:A.value==="bar"?e.available_in_bar!==!1:!0)),l}),G=async()=>{try{P.value=!0;const l=await L.getProducts();N.value=l.data.map(e=>{var x,t,D;return{id_product:e.id_product,name:e.name,sku:e.sku,selling_price:parseFloat(e.price),stock:((x=e.stock_info)==null?void 0:x.available_stock)||((t=e.stock_info)==null?void 0:t.current_stock)||e.stock||0,image:e.image_url||e.image,id_category:(D=e.category)==null?void 0:D.id_category,available_in_kitchen:e.available_in_kitchen??!0,available_in_bar:e.available_in_bar??!0}})}catch(l){console.error("Error loading products:",l)}finally{P.value=!1}},oe=async()=>{try{const l=await L.getCategories();l.success&&l.data&&(O.value=l.data)}catch(l){console.error("Error loading categories:",l),O.value=[{id_category:1,name:"Minuman"},{id_category:2,name:"Makanan"},{id_category:3,name:"Snack"}]}},te=async()=>{try{$.value=[{id_customer:1,name:"John Doe",phone:"0812345678",email:"john@example.com"},{id_customer:2,name:"Jane Smith",phone:"0812345679",email:"jane@example.com"},{id_customer:3,name:"Bob Johnson",phone:"0812345680",email:"bob@example.com"}]}catch(l){console.error("Error loading customers:",l)}},ae=l=>{if(!H(l)){l.stock<=0?console.warn("Stok tidak tersedia untuk produk:",l.name):(!l.selling_price||l.selling_price<=0)&&console.warn("Harga tidak tersedia untuk produk:",l.name);return}M(l)},H=l=>l.stock>0&&l.selling_price>0,a=l=>l===0?"stock-low":l<10?"stock-medium":"stock-high",o=l=>{const e=u.value.find(x=>x.id_product===l);return e?e.quantity:0},n=()=>{E.value=!0},b=()=>{C(),E.value=!1},V=l=>{console.error("ðŸ–¼ï¸ Image error for product ID:",l),Y.value[l]=!0},w=l=>l.split(" ").slice(0,2).map(e=>e.charAt(0)).join("").toUpperCase(),me=()=>{F.value=!0},ve=l=>{q.value={show:!0,message:"Pembayaran berhasil diproses! ðŸŽ‰",color:"success"},F.value=!1,G()},pe=()=>{C()},_e=()=>{Q.value=!0},ge=()=>{K.value=!0},X=l=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l);return ye(async()=>{J.value=new Date().toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),await Promise.all([G(),oe(),te()])}),(l,e)=>{var x;return d(),p("div",je,[s("div",Fe,[s("div",Ke,[s("div",Ue,[s("div",He,[r(De,{size:"40",color:"primary"},{default:c(()=>[r(I,{size:"20"},{default:c(()=>e[11]||(e[11]=[i("tabler-shopping-cart")])),_:1,__:[11]})]),_:1}),s("div",Le,[e[13]||(e[13]=s("h3",{class:"pos-title"},"Point of Sale",-1)),s("div",Re,[s("span",null,m(((x=se.value)==null?void 0:x.name)||"Administrator"),1),e[12]||(e[12]=s("span",null,"â€¢",-1)),s("span",null,m(J.value),1)])])])]),s("div",Me,[r(S,{variant:"text",color:"primary","prepend-icon":"tabler-history",onClick:ge},{default:c(()=>e[14]||(e[14]=[i(" Riwayat ")])),_:1,__:[14]}),r(S,{variant:"outlined",color:"success","prepend-icon":"tabler-receipt",onClick:_e},{default:c(()=>e[15]||(e[15]=[i(" Cash Drawer ")])),_:1,__:[15]})])])]),s("div",Ne,[s("div",Oe,[s("div",Qe,[s("div",Je,[r(Se,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),placeholder:"Cari produk, SKU, atau barcode...",density:"comfortable",variant:"solo","prepend-inner-icon":"tabler-search",clearable:"","hide-details":"",class:"search-input","onClick:clear":e[1]||(e[1]=t=>y.value="")},null,8,["modelValue"])]),s("div",Ge,[r(ce,{modelValue:j.value,"onUpdate:modelValue":e[2]||(e[2]=t=>j.value=t),items:O.value,"item-title":"name","item-value":"id_category",placeholder:"Kategori",density:"comfortable",variant:"solo","prepend-inner-icon":"tabler-category",clearable:"","hide-details":"",style:{"min-inline-size":"180px"},class:"category-select"},null,8,["modelValue","items"]),r(ce,{modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=t=>A.value=t),items:ee,"item-title":"title","item-value":"value",placeholder:"Station",density:"comfortable",variant:"solo","prepend-inner-icon":"tabler-tools-kitchen-2",clearable:"","hide-details":"",style:{"min-inline-size":"150px"},class:"station-select"},null,8,["modelValue"]),U.value.length>0?(d(),W(de,{key:0,color:"primary",variant:"tonal",size:"large"},{default:c(()=>[i(m(U.value.length)+" produk ",1)]),_:1})):z("",!0)])]),s("div",Xe,[!P.value&&U.value.length>0?(d(),p("div",We,[(d(!0),p(ie,null,ue(U.value,t=>(d(),p("div",{key:t.id_product,class:re(["product-item",{"out-of-stock":t.stock===0,"no-price":!t.selling_price||t.selling_price<=0,disabled:t.stock===0||!t.selling_price||t.selling_price<=0}]),onClick:D=>H(t)?ae(t):null},[s("div",Ze,[s("div",et,[t.image&&!Y.value[t.id_product]?(d(),W(ze,{key:0,src:t.image,class:"product-image-content",cover:"",onError:D=>V(t.id_product)},null,8,["src","onError"])):(d(),p("div",tt,[r(I,{size:"32",color:"grey-400"},{default:c(()=>e[16]||(e[16]=[i("tabler-package")])),_:1,__:[16]}),s("span",at,m(w(t.name)),1)]))]),s("div",{class:re(["stock-badge",a(t.stock)])},[r(I,{icon:t.stock>0?"tabler-package":"tabler-package-off",size:"12",class:"mr-1"},null,8,["icon"]),i(" Stock: "+m(t.stock),1)],2),s("div",st,[t.available_in_kitchen?(d(),p("div",ot,[r(I,{icon:"tabler-chef-hat",size:"10"}),e[17]||(e[17]=i(" Kitchen "))])):z("",!0),t.available_in_bar?(d(),p("div",lt,[r(I,{icon:"tabler-glass-cocktail",size:"10"}),e[18]||(e[18]=i(" Bar "))])):z("",!0)]),t.stock===0?(d(),p("div",rt,[r(I,{icon:"tabler-alert-circle",size:"14"}),e[19]||(e[19]=i(" Stok Habis "))])):!t.selling_price||t.selling_price<=0?(d(),p("div",nt,[r(I,{icon:"tabler-alert-triangle",size:"14"}),e[20]||(e[20]=i(" Harga Kosong "))])):z("",!0),o(t.id_product)>0?(d(),p("div",it,m(o(t.id_product))+" di keranjang ",1)):z("",!0)]),s("div",ut,[s("h6",ct,m(t.name),1),s("p",dt,m(t.sku),1),s("div",mt,[s("span",{class:re(["product-price",{"price-missing":!t.selling_price||t.selling_price<=0}])},m(t.selling_price&&t.selling_price>0?X(t.selling_price):"Harga tidak tersedia"),3),r(S,{size:"small",color:"primary",variant:"flat",icon:"tabler-plus",disabled:!H(t),onClick:he(D=>H(t)?ae(t):null,["stop"])},null,8,["disabled","onClick"])])])],10,Ye))),128))])):P.value?(d(),p("div",vt,[r(be,{size:"48",color:"primary",indeterminate:""}),e[21]||(e[21]=s("p",{class:"empty-text"},"Memuat produk...",-1))])):(d(),p("div",pt,[r(I,{size:"64",color:"grey-400"},{default:c(()=>[i(m(y.value?"tabler-search-off":"tabler-package"),1)]),_:1}),s("h4",_t,m(y.value?"Produk Tidak Ditemukan":"Tidak Ada Produk"),1),s("p",gt,m(y.value?`Coba kata kunci lain untuk pencarian "${y.value}"`:"Belum ada produk yang tersedia"),1),y.value?(d(),W(S,{key:0,variant:"outlined",onClick:e[4]||(e[4]=t=>y.value="")},{default:c(()=>e[22]||(e[22]=[i(" Reset Pencarian ")])),_:1,__:[22]})):z("",!0)]))])]),s("div",ft,[s("div",kt,[s("div",yt,[r(I,{size:"20",color:"success"},{default:c(()=>e[23]||(e[23]=[i("tabler-shopping-cart")])),_:1,__:[23]}),e[24]||(e[24]=s("span",null,"Keranjang",-1)),h(u).length>0?(d(),W(de,{key:0,color:"success",variant:"tonal",size:"small"},{default:c(()=>[i(m(h(R)),1)]),_:1})):z("",!0)]),h(u).length>0?(d(),W(S,{key:0,variant:"text",color:"error",size:"small","prepend-icon":"tabler-trash",onClick:n},{default:c(()=>e[25]||(e[25]=[i(" Hapus Semua ")])),_:1,__:[25]})):z("",!0)]),s("div",bt,[h(u).length>0?(d(),p("div",ht,[(d(!0),p(ie,null,ue(h(u),t=>(d(),p("div",{key:t.id_product,class:"cart-item"},[s("div",Ct,[s("h6",Vt,m(t.name),1),s("p",wt,m(X(t.selling_price))+" / item",1)]),s("div",xt,[s("div",Dt,[r(S,{size:"x-small",variant:"text",color:"error",icon:"tabler-minus",disabled:t.quantity<=1,onClick:D=>h(k)(t.id_product,t.quantity-1)},null,8,["disabled","onClick"]),s("span",St,m(t.quantity),1),r(S,{size:"x-small",variant:"text",color:"success",icon:"tabler-plus",disabled:t.quantity>=t.stock,onClick:D=>h(k)(t.id_product,t.quantity+1)},null,8,["disabled","onClick"])]),s("div",It,m(X(t.selling_price*t.quantity)),1),r(S,{size:"x-small",variant:"text",color:"error",icon:"tabler-x",onClick:D=>h(f)(t.id_product)},null,8,["onClick"])])]))),128))])):(d(),p("div",Tt,[r(I,{size:"48",color:"grey-400"},{default:c(()=>e[26]||(e[26]=[i("tabler-shopping-cart")])),_:1,__:[26]}),e[27]||(e[27]=s("h4",null,"Keranjang Kosong",-1)),e[28]||(e[28]=s("p",null,"Pilih produk untuk mulai berbelanja",-1))]))]),h(u).length>0?(d(),p("div",zt,[s("div",Pt,[e[29]||(e[29]=s("span",{class:"summary-label"},"Subtotal",-1)),s("span",At,m(X(h(g))),1)]),s("div",qt,[e[30]||(e[30]=s("span",{class:"summary-label"},"Items",-1)),s("span",Et,m(h(R)),1)]),s("div",Bt,[e[31]||(e[31]=s("span",{class:"summary-label summary-total"},"Total",-1)),s("span",$t,m(X(h(g))),1)]),r(S,{color:"success",size:"large",block:"",class:"checkout-btn",onClick:me},{default:c(()=>[r(I,{start:""},{default:c(()=>e[32]||(e[32]=[i("tabler-credit-card")])),_:1,__:[32]}),e[33]||(e[33]=i(" Bayar Sekarang "))]),_:1,__:[33]})])):z("",!0)])]),r(we,{modelValue:F.value,"onUpdate:modelValue":e[5]||(e[5]=t=>F.value=t),"cart-items":Z.value,customers:$.value,onPaymentSuccess:ve,onClearCart:pe},null,8,["modelValue","cart-items","customers"]),r(xe,{modelValue:K.value,"onUpdate:modelValue":e[6]||(e[6]=t=>K.value=t)},null,8,["modelValue"]),r(Ve,{modelValue:Q.value,"onUpdate:modelValue":e[7]||(e[7]=t=>Q.value=t)},null,8,["modelValue"]),r(Ie,{modelValue:E.value,"onUpdate:modelValue":e[9]||(e[9]=t=>E.value=t),"max-width":"400",persistent:""},{default:c(()=>[r(Pe,null,{default:c(()=>[r(Ae,null,{default:c(()=>e[34]||(e[34]=[i("Hapus Semua Item?")])),_:1,__:[34]}),r(Ee,null,{default:c(()=>e[35]||(e[35]=[i(" Apakah Anda yakin ingin menghapus semua item dari keranjang? ")])),_:1,__:[35]}),r(qe,null,{default:c(()=>[r(Be),r(S,{variant:"text",onClick:e[8]||(e[8]=t=>E.value=!1)},{default:c(()=>e[36]||(e[36]=[i("Batal")])),_:1,__:[36]}),r(S,{color:"error",variant:"text",onClick:b},{default:c(()=>e[37]||(e[37]=[i("Hapus")])),_:1,__:[37]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(Te,{modelValue:q.value.show,"onUpdate:modelValue":e[10]||(e[10]=t=>q.value.show=t),color:q.value.color,timeout:4e3,location:"top right"},{default:c(()=>[i(m(q.value.message),1)]),_:1},8,["modelValue","color"])])}}}),fa=Ce(jt,[["__scopeId","data-v-3915e197"]]);export{fa as default};
