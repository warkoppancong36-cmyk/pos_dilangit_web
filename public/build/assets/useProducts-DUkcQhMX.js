import{d as Ae,V as b,g as ee,f as r,b as o,e as u,X as te,t as j,$ as Fe,c as z,a0 as G,s as K,F as le,i as ie,p as Oe,co as Be,m as ae,l as pe,o as E,r as c,aD as ne}from"./main-5m4Pub-1.js";import{f as se}from"./helpers-B-vn2Qqf.js";import{V as Me}from"./VDialog-DSzUML26.js";import{b as Ne,V as ve,c as Te}from"./VCard-CtuMQEfa.js";import{V as qe}from"./VCardText-BWtDAEKx.js";import{V as Le}from"./VForm-CS_KpFfR.js";import{V as Z,a as x}from"./VRow-DnBzc8dw.js";import{V as Y}from"./VTextField-D1GQQR9s.js";import{V as fe}from"./VSelect-AvDy_3O0.js";import{V as ge}from"./VTextarea-BTwFcsaL.js";import{V as je}from"./VAutocomplete-ruA2572E.js";import{a as $e}from"./VList-B6V86m45.js";import{V as ze}from"./VDivider-CPeEws-u.js";import{V as Ge}from"./VChip-eZw-rtuv.js";import{V as Ke,a as He}from"./VAlert-UZFKvk1F.js";import{V as Je}from"./VSpacer-CzaJ5qYN.js";import{V as We}from"./VSnackbar--Y8EasbE.js";import{_ as Xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as Ye}from"./CategoriesApi-CEOgVL5M.js";import{P as N}from"./ProductsApi-B_Xyv-9B.js";const Qe={class:"d-flex align-center"},Ze={class:"text-h5 font-weight-bold"},et={class:"text-subtitle-1 opacity-90"},tt={class:"pa-6 border-b"},at={class:"pa-6 border-b"},st={class:"d-flex align-center justify-space-between mb-4"},ot={key:0,class:"text-center py-8"},rt={key:1},lt={class:"text-h6 font-weight-bold"},it={class:"d-flex justify-space-between align-center mb-2"},nt={class:"text-h6 font-weight-bold"},ut={class:"d-flex justify-space-between align-center"},ct={class:"text-subtitle-1 font-weight-bold text-success"},dt={class:"pa-6"},mt={class:"d-flex align-center justify-space-between mb-4"},pt={key:0,class:"text-center py-8"},vt={key:1},ft={class:"d-flex align-start"},gt={class:"text-body-2"},_t={class:"d-flex align-center"},bt={class:"text-subtitle-1"},ht=Ae({__name:"ProductRecipeDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},loading:{type:Boolean},formData:{},availableItems:{},errorMessage:{},productName:{}},emits:["update:modelValue","close","save","clear-error"],setup(k,{emit:$}){const n=k,V=$,C=b({get:()=>n.modelValue,set:a=>{a||V("close"),V("update:modelValue",a)}}),D=a=>{if(!a||!Array.isArray(n.availableItems))return 0;const t=n.availableItems.find(s=>s.id_item===a);return(t==null?void 0:t.current_stock)||0},f=a=>D(a),S=(a,t)=>!a||!t||t<=0?!1:t>D(a),O=(a,t)=>{if(!a||!t||t<=0)return"primary";const s=D(a),g=t/s*100;return t>s?"error":g>80?"warning":"primary"},h=(a,t)=>{if(!a||!t||t<=0)return"0";const s=D(a);return s<=0?"0":(t/s*100).toFixed(1)},m=a=>new Intl.NumberFormat("id-ID").format(a),_=b(()=>Array.isArray(n.availableItems)?n.availableItems.map(a=>{a.current_stock<=0||a.current_stock<=10||`${a.current_stock}`;const t=a.current_stock<=0;return{id:a.id_item,text:`${a.name} (${m(D(a.id_item))} ${a.unit})`,item:a,disabled:t}}):[]),w=[{title:"Mudah",value:"easy",color:"success"},{title:"Sedang",value:"medium",color:"warning"},{title:"Sulit",value:"hard",color:"error"}],T=["porsi","cup","liter","ml","pcs","pack"],J=b(()=>Array.isArray(n.availableItems)?n.formData.items.reduce((a,t)=>{const s=n.availableItems.find(g=>g.id_item===t.item_id);return s&&t.quantity>0?a+s.cost_per_unit*t.quantity:a},0):0),q=b(()=>{const a=n.formData.portion_size||1;return J.value/a}),P=b(()=>n.formData.items.every(a=>a.item_id&&a.quantity>0?!S(a.item_id,a.quantity):!0)),L=b(()=>{const a=[];return n.formData.items.forEach(t=>{if(t.item_id&&t.quantity>0&&S(t.item_id,t.quantity)){const s=n.availableItems.find(d=>d.id_item===t.item_id),g=D(t.item_id);s&&a.push(`${s.name}: maksimal ${m(g)} ${s.unit}`)}}),a}),R=a=>{if(a.item_id&&Array.isArray(n.availableItems)){const t=n.availableItems.find(s=>s.id_item===a.item_id);t&&(a.unit=t.unit)}},A=()=>{if(V("clear-error"),n.formData.items.filter(t=>t.item_id&&t.quantity>0?S(t.item_id,t.quantity):!1).length>0){V("update:modelValue",!0);return}V("save")},U=()=>{n.formData.items.push({product_id:n.formData.product_id,item_id:0,quantity:1,unit:"",notes:""})},B=a=>{n.formData.items.splice(a,1)},X=()=>{n.formData.instructions||(n.formData.instructions=[]),n.formData.instructions.push("")},W=a=>{n.formData.instructions&&n.formData.instructions.length>1&&n.formData.instructions.splice(a,1)};return(a,t)=>(E(),ee(Me,{modelValue:C.value,"onUpdate:modelValue":t[10]||(t[10]=s=>C.value=s),"max-width":"1000",persistent:"",class:"recipe-dialog"},{default:r(()=>[o(ve,{class:"recipe-card"},{default:r(()=>[o(Ne,{class:"bg-primary text-white pa-6"},{default:r(()=>[u("div",Qe,[o(te,{icon:"tabler-chef-hat",class:"me-3",size:"32"}),u("div",null,[u("div",Ze,j(a.editMode?"Edit":"Buat")+" Resep Produk ",1),u("div",et,j(a.productName||"Produk Baru"),1)])])]),_:1}),o(qe,{class:"pa-0"},{default:r(()=>[o(Le,{onSubmit:Fe(A,["prevent"])},{default:r(()=>[u("div",tt,[o(Z,null,{default:r(()=>[o(x,{cols:"12",md:"6"},{default:r(()=>[o(Y,{modelValue:a.formData.name,"onUpdate:modelValue":t[0]||(t[0]=s=>a.formData.name=s),label:"Nama Resep",variant:"outlined",density:"compact",required:"",rules:[s=>!!s||"Nama resep wajib diisi"]},null,8,["modelValue","rules"])]),_:1}),o(x,{cols:"12",md:"3"},{default:r(()=>[o(Y,{modelValue:a.formData.portion_size,"onUpdate:modelValue":t[1]||(t[1]=s=>a.formData.portion_size=s),modelModifiers:{number:!0},label:"Ukuran Porsi",variant:"outlined",density:"compact",type:"number",min:"1",required:"",rules:[s=>s>0||"Ukuran porsi harus lebih dari 0"]},null,8,["modelValue","rules"])]),_:1}),o(x,{cols:"12",md:"3"},{default:r(()=>[o(fe,{modelValue:a.formData.portion_unit,"onUpdate:modelValue":t[2]||(t[2]=s=>a.formData.portion_unit=s),label:"Satuan Porsi",variant:"outlined",density:"compact",items:T,required:""},null,8,["modelValue"])]),_:1})]),_:1}),o(Z,null,{default:r(()=>[o(x,{cols:"12",md:"4"},{default:r(()=>[o(fe,{modelValue:a.formData.difficulty_level,"onUpdate:modelValue":t[3]||(t[3]=s=>a.formData.difficulty_level=s),label:"Tingkat Kesulitan",variant:"outlined",density:"compact",items:w,"item-title":"title","item-value":"value",required:""},null,8,["modelValue"])]),_:1}),o(x,{cols:"12",md:"4"},{default:r(()=>[o(Y,{modelValue:a.formData.preparation_time,"onUpdate:modelValue":t[4]||(t[4]=s=>a.formData.preparation_time=s),modelModifiers:{number:!0},label:"Waktu Persiapan (menit)",variant:"outlined",density:"compact",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),o(x,{cols:"12",md:"4"},{default:r(()=>[o(Y,{modelValue:a.formData.notes,"onUpdate:modelValue":t[5]||(t[5]=s=>a.formData.notes=s),label:"Catatan Tambahan",variant:"outlined",density:"compact",placeholder:"Opsional"},null,8,["modelValue"])]),_:1})]),_:1}),o(Z,null,{default:r(()=>[o(x,{cols:"12"},{default:r(()=>[o(ge,{modelValue:a.formData.description,"onUpdate:modelValue":t[6]||(t[6]=s=>a.formData.description=s),label:"Deskripsi Resep",variant:"outlined",density:"compact",rows:"3","auto-grow":"",counter:"500",rules:[s=>!s||s.length<=500||"Deskripsi maksimal 500 karakter"]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),u("div",at,[u("div",st,[t[12]||(t[12]=u("div",null,[u("h3",{class:"text-h6 font-weight-bold"},"Bahan-Bahan"),u("p",{class:"text-body-2 text-medium-emphasis"}," Pilih bahan dan tentukan jumlah yang dibutuhkan ")],-1)),o(G,{color:"primary",variant:"outlined",size:"small",onClick:U,"prepend-icon":"tabler-plus"},{default:r(()=>t[11]||(t[11]=[K(" Tambah Bahan ")])),_:1,__:[11]})]),a.formData.items.length===0?(E(),z("div",ot,[o(te,{icon:"tabler-bowl",size:"64",class:"text-grey-lighten-1 mb-4"}),t[14]||(t[14]=u("p",{class:"text-body-1 text-medium-emphasis"}," Belum ada bahan yang ditambahkan ",-1)),o(G,{color:"primary",variant:"outlined",onClick:U,"prepend-icon":"tabler-plus"},{default:r(()=>t[13]||(t[13]=[K(" Tambah Bahan Pertama ")])),_:1,__:[13]})])):(E(),z("div",rt,[(E(!0),z(le,null,ie(a.formData.items,(s,g)=>(E(),ee(Z,{key:g,class:"mb-4 align-center"},{default:r(()=>[o(x,{cols:"12",md:"4"},{default:r(()=>[o(je,{modelValue:s.item_id,"onUpdate:modelValue":[d=>s.item_id=d,d=>R(s)],items:_.value,"item-title":"text","item-value":"id",label:"Pilih Bahan",variant:"outlined",density:"compact",required:"",clearable:"",rules:[d=>!!d||"Bahan wajib dipilih"]},{item:r(({props:d,item:M})=>[o($e,Oe({ref_for:!0},d,{disabled:M.raw.disabled}),Be({title:r(()=>[K(j(M.raw.text),1)]),_:2},[M.raw.disabled?{name:"subtitle",fn:r(()=>[t[15]||(t[15]=u("span",{class:"text-error"},"Stok habis",-1))]),key:"0"}:void 0]),1040,["disabled"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","rules"])]),_:2},1024),o(x,{cols:"12",md:"4"},{default:r(()=>[o(Y,{modelValue:s.quantity,"onUpdate:modelValue":d=>s.quantity=d,modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0",max:f(s.item_id),step:"0.01",required:"",color:O(s.item_id,s.quantity),rules:[d=>d>0||"Jumlah harus lebih dari 0",d=>d<=f(s.item_id)||`Jumlah tidak boleh melebihi stok tersedia (${f(s.item_id)})`],error:S(s.item_id,s.quantity),"error-messages":S(s.item_id,s.quantity)?`Stok tidak cukup (${f(s.item_id)} tersedia)`:[],hint:`Stok tersedia: ${f(s.item_id)} | Akan menggunakan: ${h(s.item_id,s.quantity)}%`,"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","max","color","rules","error","error-messages","hint"])]),_:2},1024),o(x,{cols:"12",md:"2"},{default:r(()=>[o(Y,{modelValue:s.unit,"onUpdate:modelValue":d=>s.unit=d,label:"Satuan",variant:"outlined",density:"compact",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(x,{cols:"12",md:"2"},{default:r(()=>{var d;return[t[16]||(t[16]=u("div",{class:"text-caption text-medium-emphasis"},"Biaya",-1)),u("div",lt,j(s.item_id&&s.quantity>0&&Array.isArray(a.availableItems)?ae(se)((((d=a.availableItems.find(M=>M.id_item===s.item_id))==null?void 0:d.cost_per_unit)||0)*s.quantity):ae(se)(0)),1),o(G,{color:"error",variant:"text",size:"small",icon:"tabler-trash",onClick:M=>B(g)},null,8,["onClick"])]}),_:2,__:[16]},1024)]),_:2},1024))),128)),o(ze,{class:"my-4"}),o(Z,null,{default:r(()=>[o(x,{cols:"12",md:"6"},{default:r(()=>[o(ve,{variant:"outlined",class:"pa-4"},{default:r(()=>[t[19]||(t[19]=u("div",{class:"text-subtitle-2 text-medium-emphasis mb-2"}," Ringkasan Biaya ",-1)),u("div",it,[t[17]||(t[17]=u("span",null,"Total Biaya Resep:",-1)),u("span",nt,j(ae(se)(J.value)),1)]),u("div",ut,[t[18]||(t[18]=u("span",null,"Biaya per Porsi:",-1)),u("span",ct,j(ae(se)(q.value)),1)])]),_:1,__:[19]})]),_:1})]),_:1})]))]),u("div",dt,[u("div",mt,[t[21]||(t[21]=u("div",null,[u("h3",{class:"text-h6 font-weight-bold"},"Instruksi Pembuatan"),u("p",{class:"text-body-2 text-medium-emphasis"}," Langkah-langkah untuk membuat produk ")],-1)),o(G,{color:"primary",variant:"outlined",size:"small",onClick:X,"prepend-icon":"tabler-plus"},{default:r(()=>t[20]||(t[20]=[K(" Tambah Langkah ")])),_:1,__:[20]})]),!a.formData.instructions||a.formData.instructions.length===0?(E(),z("div",pt,[o(te,{icon:"tabler-list-numbers",size:"64",class:"text-grey-lighten-1 mb-4"}),t[23]||(t[23]=u("p",{class:"text-body-1 text-medium-emphasis"}," Belum ada instruksi yang ditambahkan ",-1)),o(G,{color:"primary",variant:"outlined",onClick:X,"prepend-icon":"tabler-plus"},{default:r(()=>t[22]||(t[22]=[K(" Tambah Instruksi Pertama ")])),_:1,__:[22]})])):(E(),z("div",vt,[(E(!0),z(le,null,ie(a.formData.instructions,(s,g)=>(E(),z("div",{key:g,class:"mb-4"},[u("div",ft,[o(Ge,{color:"primary",size:"small",class:"me-3 mt-3"},{default:r(()=>[K(j(g+1),1)]),_:2},1024),o(ge,{modelValue:a.formData.instructions[g],"onUpdate:modelValue":d=>a.formData.instructions[g]=d,label:`Langkah ${g+1}`,variant:"outlined",density:"compact",rows:"2","auto-grow":"",class:"flex-grow-1",required:"",rules:[d=>!!d||"Instruksi tidak boleh kosong"]},null,8,["modelValue","onUpdate:modelValue","label","rules"]),a.formData.instructions.length>1?(E(),ee(G,{key:0,color:"error",variant:"text",size:"small",icon:"tabler-trash",class:"ms-2 mt-3",onClick:d=>W(g)},null,8,["onClick"])):pe("",!0)])]))),128))]))])]),_:1})]),_:1}),o(Te,{class:"pa-6"},{default:r(()=>[L.value.length>0?(E(),ee(x,{key:0,cols:"12",class:"px-0"},{default:r(()=>[o(Ke,{type:"error",variant:"tonal",density:"compact"},{default:r(()=>[o(He,{class:"mb-2"},{default:r(()=>t[24]||(t[24]=[K("Stok Tidak Mencukupi")])),_:1,__:[24]}),u("div",gt,[(E(!0),z(le,null,ie(L.value,s=>(E(),z("div",{key:s,class:"mb-1"}," • "+j(s),1))),128))])]),_:1})]),_:1})):pe("",!0),o(Je),o(G,{variant:"outlined",class:"coffee-secondary",onClick:t[7]||(t[7]=s=>C.value=!1)},{default:r(()=>t[25]||(t[25]=[K(" Batal ")])),_:1,__:[25]}),o(G,{color:"primary",class:"coffee-primary",loading:a.loading,disabled:!P.value,onClick:A},{default:r(()=>[K(j(a.editMode?"Perbarui":"Simpan")+" Resep ",1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}),o(We,{"model-value":!!a.errorMessage,"onUpdate:modelValue":t[9]||(t[9]=s=>!s&&V("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:r(()=>[o(G,{icon:"tabler-x",size:"small",variant:"text",onClick:t[8]||(t[8]=s=>V("clear-error"))})]),default:r(()=>[u("div",_t,[o(te,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),u("div",null,[t[26]||(t[26]=u("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),u("div",bt,j(a.errorMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["modelValue"]))}}),Gt=Xe(ht,[["__scopeId","data-v-7086619c"]]);function Kt(){const k=c([]),$=c([]),n=c(!1),V=c(!1),C=c(!1),D=c({total_recipes:0,active_recipes:0,total_items_used:0,avg_cost_per_recipe:0}),f=c(!1),S=c(!1),O=c(!1),h=c(null),m=ne({product_id:0,name:"",description:"",items:[],portion_size:1,portion_unit:"porsi",preparation_time:30,difficulty_level:"medium",instructions:[],active:!0}),_=c(""),w=c(""),T=c(""),J=b(()=>!n.value),q="product_recipes",P=()=>{try{const l=localStorage.getItem(q),p=l?JSON.parse(l):[];return console.log("📖 Loaded recipes from localStorage:",p.length,"recipes"),p}catch(l){return console.error("❌ Failed to load recipes from localStorage:",l),[]}},L=l=>{try{localStorage.setItem(q,JSON.stringify(l)),console.log("✅ Recipes saved to localStorage:",l.length,"recipes"),console.log("Storage key:",q)}catch(p){console.error("❌ Failed to save recipes to localStorage:",p)}},R=l=>l.items.reduce((p,v)=>{const I=$.value.find(H=>H.id_item===v.item_id);return p+v.quantity*((I==null?void 0:I.cost_per_unit)||0)},0),A=l=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),U=()=>{Object.assign(m,{id:void 0,product_id:0,name:"",description:"",items:[],portion_size:1,portion_unit:"porsi",preparation_time:30,difficulty_level:"medium",instructions:[],active:!0})},B=async l=>{if(l){n.value=!0,_.value="";try{await new Promise(v=>setTimeout(v,500));const p=P();k.value=p.filter(v=>v.product_id===l),w.value="Resep berhasil dimuat"}catch(p){console.error("Failed to fetch recipes:",p),_.value="Gagal memuat data resep",k.value=[]}finally{n.value=!1}}},X=async()=>{try{$.value=[{id_item:1,item_code:"KOPI001",name:"Kopi Arabica",unit:"gram",cost_per_unit:50,current_stock:1e3,minimum_stock:100,active:!0},{id_item:2,item_code:"SUSU001",name:"Susu Segar",unit:"ml",cost_per_unit:15,current_stock:2e3,minimum_stock:200,active:!0},{id_item:3,item_code:"GULA001",name:"Gula Pasir",unit:"gram",cost_per_unit:12,current_stock:5e3,minimum_stock:500,active:!0},{id_item:4,item_code:"CHOC001",name:"Cokelat Bubuk",unit:"gram",cost_per_unit:80,current_stock:500,minimum_stock:50,active:!0}]}catch(l){console.error("Failed to fetch available items:",l),$.value=[]}},W=async()=>{try{const l=m.product_id;if(!l)return;const v=P().filter(y=>y.product_id===l),I=v.filter(y=>y.active),H=new Set(v.flatMap(y=>y.items.map(Q=>Q.item_id))),oe=I.reduce((y,Q)=>y+(Q.total_cost||0),0)/(I.length||1);D.value={total_recipes:v.length,active_recipes:I.length,total_items_used:H.size,avg_cost_per_recipe:oe}}catch(l){console.error("Failed to fetch stats:",l)}},a=async()=>{var l;V.value=!0,T.value="";try{await new Promise(v=>setTimeout(v,1e3));const p=P();if(O.value&&((l=h.value)!=null&&l.id)){const v=p.findIndex(I=>{var H;return I.id===((H=h.value)==null?void 0:H.id)});v!==-1&&(p[v]={...m,id:h.value.id,total_cost:R(m),updated_at:new Date().toISOString()}),w.value="Resep berhasil diperbarui"}else{const v={...m,id:Date.now(),total_cost:R(m),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};p.unshift(v),w.value="Resep berhasil ditambahkan"}console.log("💾 Saving recipe data:",m),console.log("📦 Total recipes to save:",p.length),L(p),await B(m.product_id),await W(),M()}catch(p){console.error("Failed to save recipe:",p),T.value="Gagal menyimpan resep"}finally{V.value=!1}},t=async()=>{if(h.value){C.value=!0;try{await new Promise(v=>setTimeout(v,1e3));const p=P().filter(v=>{var I;return v.id!==((I=h.value)==null?void 0:I.id)});L(p),w.value="Resep berhasil dihapus",await B(m.product_id),await W(),S.value=!1,h.value=null}catch(l){console.error("Failed to delete recipe:",l),_.value="Gagal menghapus resep"}finally{C.value=!1}}},s=l=>{O.value=!1,U(),m.product_id=l,f.value=!0},g=l=>{O.value=!0,h.value=l,Object.assign(m,{...l,items:[...l.items]}),f.value=!0},d=l=>{h.value=l,S.value=!0},M=()=>{f.value=!1,T.value="",setTimeout(()=>{U(),h.value=null,O.value=!1},200)};return{recipesList:k,availableItems:$,loading:n,saveLoading:V,deleteLoading:C,stats:D,dialog:f,deleteDialog:S,editMode:O,selectedRecipe:h,formData:m,errorMessage:_,successMessage:w,modalErrorMessage:T,canCreateEdit:J,calculateRecipeCost:R,formatCurrency:A,fetchRecipes:B,fetchAvailableItems:X,fetchStats:W,saveRecipe:a,deleteRecipe:t,openCreateDialog:s,openEditDialog:g,openDeleteDialog:d,closeDialog:M,clearModalError:()=>{T.value=""}}}const Ht=()=>{const k=c([]),$=c([]),n=c(!1),V=c(!1),C=c(!1),D=c({}),f=c({total_products:0,published_products:0,draft_products:0,archived_products:0,active_products:0,inactive_products:0,featured_products:0,low_stock_products:0,out_of_stock_products:0,total_stock_value:0,average_price:0,total_categories:0,average_margin:0,highest_margin:0,lowest_margin:0,profitable_products:0}),S=c(!1),O=c(!1),h=c(!1),m=c(null),_=c([]),w=c(1),T=c(0),J=c(15),q=ne({search:"",active:"all",category_id:null,stock_status:"all",featured:"all",sortBy:"created_at",sortOrder:"desc"}),P=c(""),L=c(""),R=c(""),A=ne({name:"",description:"",price:0,cost:0,sku:"",barcode:"",min_stock:0,weight:0,dimensions:{length:void 0,width:void 0,height:void 0},category_id:0,brand:"",unit:"pcs",status:"published",active:!0,featured:!1,tags:[],meta_title:"",meta_description:""}),U=c(null),B=c(""),X=[e=>!!e||"Nama produk wajib diisi",e=>e.length>=2||"Nama produk minimal 2 karakter",e=>e.length<=255||"Nama produk maksimal 255 karakter"],W=[e=>!!e||"Harga wajib diisi",e=>Number(e)>0||"Harga harus lebih dari 0"],a=[e=>!!e||"Kategori wajib dipilih"],t=[e=>{if(!e)return!0;const i=N.validateSKU(e);return i.valid||i.error}],s=b(()=>!0),g=b(()=>!0),d=b(()=>f.value.active_products),M=b(()=>f.value.inactive_products),ue=b(()=>f.value.featured_products),l=b(()=>f.value.low_stock_products),p=b(()=>f.value.out_of_stock_products),v=b(()=>f.value.average_price),I=b(()=>f.value.total_stock_value),H=b(()=>_.value.length>0),oe=b(()=>k.value.length),y=async()=>{try{n.value=!0,P.value="";const e={...q,page:w.value,per_page:J.value};Object.keys(e).forEach(F=>{(e[F]===""||e[F]==="all")&&delete e[F]});const i=await N.getAll(e);if(i.success)k.value=i.data,i.pagination&&(T.value=i.pagination.total,w.value=i.pagination.current_page);else throw new Error(i.message)}catch(e){console.error("Error fetching products:",e),P.value=e.message||"Gagal mengambil data produk",k.value=[]}finally{n.value=!1}},Q=async()=>{try{const e=await Ye.getCategories({page:1,per_page:100,status:"active"});e.success&&($.value=e.data)}catch(e){console.error("Error fetching categories:",e)}},_e=async()=>{try{const e=await N.getStats();e.success&&(f.value=e.data)}catch(e){console.error("Error fetching stats:",e)}},be=async()=>{try{V.value=!0,R.value="";const e={...A};e.price&&(e.price=Number(e.price)),e.cost&&(e.cost=Number(e.cost)),e.min_stock&&(e.min_stock=Number(e.min_stock)),e.weight&&(e.weight=Number(e.weight)),e.category_id&&(e.category_id=Number(e.category_id));let i;if(h.value&&m.value?i=await N.update(m.value.id_product,e,U.value||void 0):i=await N.create(e,U.value||void 0),console.log("Product save response:",i),i.success)L.value=i.message||"Product saved successfully",ce(),await y();else throw new Error(i.message)}catch(e){console.error("Error saving product:",e),R.value=e.errors||e.message}finally{V.value=!1}},he=async()=>{if(m.value)try{C.value=!0;const e=await N.delete(m.value.id_product);if(e.success)L.value=e.message,O.value=!1,await y();else throw new Error(e.message)}catch(e){console.error("Error deleting product:",e),P.value=e.message||"Gagal menghapus produk"}finally{C.value=!1}},ye=async()=>{if(_.value.length!==0)try{C.value=!0;const e=await N.bulkDelete(_.value);if(e.success)L.value=e.message,_.value=[],await y();else throw new Error(e.message)}catch(e){console.error("Error bulk deleting products:",e),P.value=e.message||"Gagal menghapus produk"}finally{C.value=!1}},ke=async e=>{try{D.value[e.id_product]=!0;const i=await N.toggleActive(e.id_product);if(i.success){const F=k.value.findIndex(re=>re.id_product===e.id_product);F!==-1&&(k.value[F]=i.data)}else throw new Error(i.message)}catch(i){console.error("Error toggling active status:",i),P.value=i.message||"Gagal mengubah status produk"}finally{D.value[e.id_product]=!1}},we=async e=>{try{D.value[e.id_product]=!0;const i=await N.toggleFeatured(e.id_product);if(i.success){const F=k.value.findIndex(re=>re.id_product===e.id_product);F!==-1&&(k.value[F]=i.data)}else throw new Error(i.message)}catch(i){console.error("Error toggling featured status:",i),P.value=i.message||"Gagal mengubah status produk unggulan"}finally{D.value[e.id_product]=!1}},Ve=()=>{h.value=!1,m.value=null,de(),S.value=!0},De=e=>{h.value=!0,m.value=e,Pe(e),S.value=!0},Se=e=>{m.value=e,O.value=!0},ce=()=>{S.value=!1,R.value="",de()},de=()=>{Object.assign(A,{name:"",description:"",price:"",cost:"",sku:"",barcode:"",stock:"",min_stock:"",weight:"",dimensions:{length:void 0,width:void 0,height:void 0},category_id:"",brand:"",unit:"pcs",status:"published",active:!0,featured:!1,tags:[],meta_title:"",meta_description:""}),U.value=null,B.value=""},Pe=e=>{Object.assign(A,{name:e.name,description:e.description||"",price:e.price,cost:e.cost||"",sku:e.sku||"",barcode:e.barcode||"",min_stock:e.min_stock||"",weight:e.weight||"",dimensions:e.dimensions||{length:void 0,width:void 0,height:void 0},category_id:e.category_id,brand:e.brand||"",unit:e.unit||"pcs",status:e.status,active:e.active,featured:e.featured,tags:e.tags||[],meta_title:e.meta_title||"",meta_description:e.meta_description||""}),U.value=null,B.value=e.image_url||""},Ie=e=>{if(e.length===0)return;const i=e[0],F=N.validateImage(i);if(!F.valid){R.value=F.error||"File tidak valid";return}U.value=i,B.value=URL.createObjectURL(i),R.value=""},Ce=()=>{U.value=null,B.value=""},Re=()=>{A.name&&(A.sku=N.generateSKU(A.name))},Ue=()=>{R.value=""},Ee=e=>{w.value=e,y()},xe=()=>{w.value=1,y()},me=()=>{w.value=1,y()};return{productsList:k,categories:$,loading:n,saveLoading:V,deleteLoading:C,toggleLoading:D,stats:f,dialog:S,deleteDialog:O,editMode:h,selectedProduct:m,selectedProducts:_,currentPage:w,totalItems:T,itemsPerPage:J,filters:q,errorMessage:P,successMessage:L,modalErrorMessage:R,formData:A,selectedImage:U,imagePreview:B,nameRules:X,priceRules:W,categoryRules:a,skuRules:t,canCreateEdit:s,canDelete:g,totalActiveProducts:d,totalInactiveProducts:M,totalFeaturedProducts:ue,totalLowStockProducts:l,totalOutOfStockProducts:p,averagePrice:v,totalStockValue:I,hasSelectedProducts:H,filteredProductsCount:oe,fetchProductsList:y,fetchCategories:Q,fetchStats:_e,saveProduct:be,deleteProduct:he,bulkDeleteProducts:ye,toggleActiveStatus:ke,toggleFeaturedStatus:we,openCreateDialog:Ve,openEditDialog:De,openDeleteDialog:Se,closeDialog:ce,handleImageUpload:Ie,removeImage:Ce,generateSKU:Re,clearModalError:Ue,onPageChange:Ee,onSearch:xe,onFilterChange:me,handleFiltersUpdate:e=>{Object.assign(q,e),me()},onSortChange:()=>{w.value=1,y()},resetFilters:()=>{Object.assign(q,{search:"",active:"all",category_id:null,stock_status:"all",featured:"all",sortBy:"created_at",sortOrder:"desc"}),w.value=1,y()},toggleProductSelection:e=>{const i=_.value.indexOf(e);i>-1?_.value.splice(i,1):_.value.push(e)},selectAllProducts:()=>{_.value.length===k.value.length?_.value=[]:_.value=k.value.map(e=>e.id_product)}}};export{Gt as P,Ht as a,Kt as u};
