import{P as ue}from"./PosApi-BghDI0Sn.js";import ce from"./EditOrderDialog-DTsP4GP_.js";import me from"./OrderDetailDialog-A30XlTow.js";import{V as pe}from"./VDialog-GpAVL4r0.js";import{V as b,b as fe}from"./VCard-BhgFqeUq.js";import{d as ve,r as i,V as Q,D as _e,w as j,g as F,f as o,o as d,b as l,e as s,X as ge,a0 as x,t as n,l as ye,c as h,F as Ve,i as be,s as I}from"./main-D33dJ5YV.js";import{V as f}from"./VCardText-D8eb-y6K.js";import{V as q,a as u}from"./VRow-D-ijqz6Y.js";import{V as O}from"./VTextField-C-AgsGuZ.js";import{V as xe}from"./VSelect-BVUJ7i9D.js";import{V as he}from"./VDataTable-D7VPQFnx.js";import{V as K}from"./VChip-BXKLoxM8.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VForm-Be9wfqbx.js";import"./forwardRefs-B931MWyl.js";import"./VAlert-B4HK_jE8.js";import"./VAvatar-D5U1GjEp.js";import"./VImg-rGiGPYBa.js";import"./VTextarea-CBN5syCJ.js";import"./VDivider-CoAGDTEQ.js";import"./VSpacer-Dz2rWejt.js";/* empty css              */import"./VTable-Cf_TYLm0.js";import"./VOverlay-BMb9aIgN.js";import"./VList-BJUTcKQk.js";import"./VMenu-XaiwHx_j.js";import"./VCheckboxBtn-8d11QtJt.js";import"./filter-RtIrtOjc.js";const ke={class:"d-flex align-items-center gap-2"},we={class:"text-h4"},Te={class:"text-h4"},Ce={class:"text-h4"},Se={class:"text-h4"},Pe={key:0},Fe={class:"font-weight-medium"},Ie={class:"text-caption text-medium-emphasis"},Oe={key:1,class:"text-medium-emphasis"},Ne={class:"font-weight-medium"},Ue={key:0},Le={key:1,class:"text-medium-emphasis"},Re={class:"text-body-2"},Me={class:"text-caption text-medium-emphasis"},ze=ve({__name:"TransactionHistoryDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(W,{emit:X}){const Y=W,G=X,w=i(!1),c=i([]),v=i(""),_=i(""),m=i(""),p=i(""),T=i(!1),C=i(!1),D=i(null),g=i({total_orders:0,total_revenue:0,average_order:0,pending_orders:0}),J=[{title:"No. Pesanan",key:"order_number",sortable:!0},{title:"Pelanggan",key:"customer",sortable:!1},{title:"Status",key:"status",sortable:!0},{title:"Total",key:"total_amount",sortable:!0},{title:"Pembayaran",key:"payment_method",sortable:!1},{title:"Tanggal",key:"created_at",sortable:!0},{title:"Aksi",key:"actions",sortable:!1,width:"120px"}],Z=[{title:"Pending",value:"pending"},{title:"Diproses",value:"preparing"},{title:"Selesai",value:"completed"},{title:"Dibatalkan",value:"cancelled"}],k=Q({get:()=>Y.modelValue,set:e=>G("update:modelValue",e)}),N=Q(()=>{let e=c.value;if(v.value){const t=v.value.toLowerCase();e=e.filter(a=>{var R,M,z,A,B,E,$,H;const r=((M=(R=a.order_number)==null?void 0:R.toLowerCase())==null?void 0:M.includes(t))||!1,y=((B=(A=(z=a.customer)==null?void 0:z.name)==null?void 0:A.toLowerCase())==null?void 0:B.includes(t))||!1,V=((H=($=(E=a.customer)==null?void 0:E.phone)==null?void 0:$.toLowerCase())==null?void 0:H.includes(t))||!1;return r||y||V})}return _.value&&(e=e.filter(t=>t.status===_.value)),m.value&&(e=e.filter(t=>new Date(t.created_at)>=new Date(m.value))),p.value&&(e=e.filter(t=>new Date(t.created_at)<=new Date(p.value+" 23:59:59"))),e}),ee=async()=>{try{w.value=!0;const e=await ue.getOrders();console.log("API Response structure:",e),e.success&&Array.isArray(e.data)?c.value=e.data:(console.warn("Unexpected response structure:",e),c.value=[]),console.log("Loaded transactions:",c.value.length),S()}catch(e){console.error("Error loading transactions:",e),c.value=[]}finally{w.value=!1}},S=()=>{const e=N.value,t=e.reduce((r,y)=>{const V=typeof y.total_amount=="string"?parseFloat(y.total_amount):y.total_amount;return r+(isNaN(V)||!isFinite(V)?0:V)},0),a=e.length>0&&t>0?t/e.length:0;g.value={total_orders:e.length,total_revenue:t,average_order:a,pending_orders:e.filter(r=>r.status==="pending").length}},U=e=>{D.value=e,T.value=!0},te=e=>{console.log("Printing order:",e.order_number)},ae=e=>{D.value=e,C.value=!0},L=e=>{const t=c.value.findIndex(a=>a.id_order===e.id_order);t!==-1&&(c.value[t]=e),S()},le=e=>({pending:"warning",preparing:"info",completed:"success",cancelled:"error"})[e]||"default",oe=e=>({pending:"Pending",preparing:"Diproses",completed:"Selesai",cancelled:"Dibatalkan"})[e]||e,se=e=>({cash:"Tunai",card:"Kartu",digital_wallet:"E-Wallet",qris:"QRIS",bank_transfer:"Transfer"})[e]||e,P=e=>{const t=typeof e=="string"?parseFloat(e):e;return isNaN(t)||!isFinite(t)?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t)},re=e=>new Date(e).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}),ne=e=>new Date(e).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),ie=()=>{k.value=!1},de=()=>{const e=new Date().toISOString().split("T")[0],t=new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0];m.value=t,p.value=e};return _e(()=>{de()}),j(k,e=>{e&&ee()}),j([v,_,m,p],()=>{S()}),(e,t)=>(d(),F(pe,{modelValue:k.value,"onUpdate:modelValue":t[6]||(t[6]=a=>k.value=a),"max-width":"1200",scrollable:""},{default:o(()=>[l(b,{class:"coffee-dialog"},{default:o(()=>[l(fe,{class:"d-flex align-center justify-space-between coffee-header"},{default:o(()=>[s("div",ke,[l(ge,{icon:"tabler-history",class:"text-white"}),t[7]||(t[7]=s("div",null,[s("div",{class:"coffee-title"},"Riwayat Transaksi"),s("div",{class:"coffee-subtitle"},"Daftar transaksi dan pembayaran")],-1))]),l(x,{icon:"tabler-x",variant:"text",color:"white",onClick:ie})]),_:1}),l(f,{class:"pb-0 px-6"},{default:o(()=>[l(q,null,{default:o(()=>[l(u,{cols:"12",md:"4"},{default:o(()=>[l(O,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=a=>v.value=a),label:"Cari transaksi...",variant:"outlined",density:"compact","prepend-inner-icon":"tabler-search",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"2"},{default:o(()=>[l(xe,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=a=>_.value=a),items:Z,label:"Status",variant:"outlined",density:"compact",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"3"},{default:o(()=>[l(O,{modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=a=>m.value=a),label:"Dari Tanggal",type:"date",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"3"},{default:o(()=>[l(O,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=a=>p.value=a),label:"Sampai Tanggal",type:"date",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(f,{class:"px-6"},{default:o(()=>[l(q,{class:"mb-4"},{default:o(()=>[l(u,{cols:"12",md:"3"},{default:o(()=>[l(b,{variant:"tonal",color:"primary"},{default:o(()=>[l(f,{class:"text-center"},{default:o(()=>[s("h3",we,n(g.value.total_orders),1),t[8]||(t[8]=s("p",{class:"text-body-2 mb-0"},"Total Transaksi",-1))]),_:1,__:[8]})]),_:1})]),_:1}),l(u,{cols:"12",md:"3"},{default:o(()=>[l(b,{variant:"tonal",color:"success"},{default:o(()=>[l(f,{class:"text-center"},{default:o(()=>[s("h3",Te,n(P(g.value.total_revenue)),1),t[9]||(t[9]=s("p",{class:"text-body-2 mb-0"},"Total Pendapatan",-1))]),_:1,__:[9]})]),_:1})]),_:1}),l(u,{cols:"12",md:"3"},{default:o(()=>[l(b,{variant:"tonal",color:"info"},{default:o(()=>[l(f,{class:"text-center"},{default:o(()=>[s("h3",Ce,n(P(g.value.average_order)),1),t[10]||(t[10]=s("p",{class:"text-body-2 mb-0"},"Rata-rata per Transaksi",-1))]),_:1,__:[10]})]),_:1})]),_:1}),l(u,{cols:"12",md:"3"},{default:o(()=>[l(b,{variant:"tonal",color:"warning"},{default:o(()=>[l(f,{class:"text-center"},{default:o(()=>[s("h3",Se,n(g.value.pending_orders),1),t[11]||(t[11]=s("p",{class:"text-body-2 mb-0"},"Transaksi Pending",-1))]),_:1,__:[11]})]),_:1})]),_:1})]),_:1}),l(he,{headers:J,items:N.value,loading:w.value,"items-per-page":10,class:"elevation-1"},{"item.order_number":o(({item:a})=>[l(x,{variant:"text",color:"primary",size:"small",onClick:r=>U(a)},{default:o(()=>[I(n(a.order_number),1)]),_:2},1032,["onClick"])]),"item.customer":o(({item:a})=>[a.customer?(d(),h("div",Pe,[s("div",Fe,n(a.customer.name),1),s("div",Ie,n(a.customer.phone),1)])):(d(),h("span",Oe,"-"))]),"item.status":o(({item:a})=>[l(K,{color:le(a.status),size:"small",variant:"tonal"},{default:o(()=>[I(n(oe(a.status)),1)]),_:2},1032,["color"])]),"item.total_amount":o(({item:a})=>[s("span",Ne,n(P(a.total_amount)),1)]),"item.payment_method":o(({item:a})=>[a.payments&&a.payments.length>0?(d(),h("div",Ue,[(d(!0),h(Ve,null,be(a.payments,r=>(d(),F(K,{key:r.id_payment,size:"small",variant:"outlined",class:"ma-1"},{default:o(()=>[I(n(se(r.payment_method)),1)]),_:2},1024))),128))])):(d(),h("span",Le,"-"))]),"item.created_at":o(({item:a})=>[s("div",null,[s("div",Re,n(re(a.created_at)),1),s("div",Me,n(ne(a.created_at)),1)])]),"item.actions":o(({item:a})=>[l(x,{icon:"tabler-eye",variant:"text",size:"small",onClick:r=>U(a)},null,8,["onClick"]),l(x,{icon:"tabler-printer",variant:"text",size:"small",onClick:r=>te(a)},null,8,["onClick"]),a.status==="pending"?(d(),F(x,{key:0,icon:"tabler-edit",variant:"text",size:"small",color:"primary",onClick:r=>ae(a)},null,8,["onClick"])):ye("",!0)]),_:1},8,["items","loading"])]),_:1})]),_:1}),l(me,{modelValue:T.value,"onUpdate:modelValue":t[4]||(t[4]=a=>T.value=a),order:D.value,onOrderUpdated:L},null,8,["modelValue","order"]),l(ce,{modelValue:C.value,"onUpdate:modelValue":t[5]||(t[5]=a=>C.value=a),order:D.value,onOrderUpdated:L},null,8,["modelValue","order"])]),_:1},8,["modelValue"]))}}),pt=De(ze,[["__scopeId","data-v-63fd5816"]]);export{pt as default};
