import{D as St}from"./DeleteConfirmationDialog-Bu1_yV53.js";import{f as Ae}from"./formatters-BD6tdLx_.js";import{P as rt,u as Mt}from"./useProductItems-CM_SQf4A.js";import{I as Kt}from"./ItemsApi-B4RoqIXh.js";import{u as _t,H as Ft}from"./HPPBreakdownDialog-BhsWdfKV.js";import{V as Le}from"./VDialog-05PAAxpz.js";import{V as Y,b as xe,c as Be}from"./VCard-DNMkVA9Y.js";import{a8 as Et,a9 as Bt,af as Rt,r as z,aH as lt,ag as qt,aN as wt,bi as Lt,V as pe,W as Nt,w as he,bt as Pt,b8 as ft,aa as Ot,b as e,p as we,bd as jt,cv as Jt,c8 as Vt,bg as Wt,F as ze,X as w,cm as Gt,c9 as Qt,aJ as Xt,s as u,d as Re,D as tt,c as Z,f as t,e as l,t as n,a0 as R,g as B,l as j,m as K,aw as dt,i as Je,v as We,o as f,ax as gt,$ as kt,j as It,cw as Zt,aR as Yt,ay as qe,ap as ea,aq as ta,a5 as mt}from"./main-CBieGgt2.js";import{V as le}from"./VCardText-DH5Ygolj.js";import{V as Ve}from"./VAvatar-SRbocHam.js";import{V as ce}from"./VChip-CUvmn3GD.js";import{V as Pe,a as I}from"./VRow-rILDZYkB.js";import{V as yt}from"./VAutocomplete-DoJZyOB4.js";import{e as aa,t as ot,V as ct,a as je,b as Ye,d as st}from"./VList-DFzv6ALg.js";import{u as la,V as be,m as oa}from"./VTextField-BcAeW67M.js";import{V as it}from"./VSwitch-dtBlQZ23.js";import{a as ut,V as Ke}from"./VAlert-BxPkO_hf.js";import{V as Ne}from"./VSpacer-BqlpQUeG.js";import{V as et}from"./VSnackbar-B-zU94df.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as sa,m as ia,a as na,V as Fe}from"./VSelect-BqpkGD1S.js";import{V as ra}from"./VCheckbox-CG0y7ymW.js";import{V as Ue}from"./VDivider-4cT9G7xT.js";import{V as ua}from"./VContainer-DwEidDyD.js";import{a as Dt,u as da,P as ca}from"./useProducts-B7hzuSRX.js";import{V as bt}from"./VForm-HvkzlCA2.js";import{V as Ct}from"./VTextarea-CA-1XBS9.js";import{V as Me}from"./VTooltip-tvH_v-PA.js";import{m as ma,V as va}from"./VImg-BRSac059.js";import{V as pa,u as fa}from"./useCategories-CuP52HJ5.js";import{u as ga,m as _a,h as ka}from"./filter-C5QUR2us.js";import{f as ya}from"./forwardRefs-B931MWyl.js";import{V as ba}from"./VMenu-PaxLP6h7.js";import{V as ha}from"./VCheckboxBtn-NWxqozbZ.js";import{V as xa}from"./VDataTableServer-Oddferc4.js";import{V as wa}from"./VSkeletonLoader-C_MBGnCj.js";import{V as Pa}from"./VDataTable-CP1flFCv.js";import{V as Va,a as Ca,b as vt,c as pt}from"./VTabs-C4ehx714.js";import"./ProductsApi-DTcmroFR.js";import"./api-BCWE1m-p.js";import"./index-D-EbNoF1.js";import"./VOverlay-BPIdux_c.js";/* empty css              */import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-ByI2tn2H.js";import"./VTable-CMKDRTDG.js";const $a=Bt({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,..._a({filterKeys:["title"]}),...ia({hideNoData:!0,returnObject:!0}),...jt(oa({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...ma({transition:!1})},"VCombobox"),Sa=Et()({name:"VCombobox",props:$a(),emits:{"update:focused":$=>!0,"update:modelValue":$=>!0,"update:search":$=>!0,"update:menu":$=>!0},setup($,ke){var r;let{emit:M,slots:A}=ke;const{t:O}=Rt(),k=z(),W=lt(!1),U=lt(!0),g=lt(!1),y=z(),ee=z(),h=lt(-1);let X=!1;const{items:ve,transformIn:se,transformOut:E}=aa($),{textColorClasses:de,textColorStyles:me}=qt(()=>{var a;return(a=k.value)==null?void 0:a.color}),N=wt($,"modelValue",[],a=>se(Lt(a)),a=>{const p=E(a);return $.multiple?p:p[0]??null}),G=la($),d=pe(()=>!!($.chips||A.chip)),_=pe(()=>d.value||!!A.selection),T=lt(!$.multiple&&!_.value?((r=N.value[0])==null?void 0:r.title)??"":""),m=pe({get:()=>T.value,set:a=>{var p;if(T.value=a??"",!$.multiple&&!_.value&&(N.value=[ot($,a)]),a&&$.multiple&&((p=$.delimiters)!=null&&p.length)){const F=a.split(new RegExp(`(?:${$.delimiters.join("|")})+`));F.length>1&&(F.forEach(H=>{H=H.trim(),H&&Ce(ot($,H))}),T.value="")}a||(h.value=-1),U.value=!a}}),x=pe(()=>typeof $.counterValue=="function"?$.counterValue(N.value):typeof $.counterValue=="number"?$.counterValue:$.multiple?N.value.length:m.value.length),{filteredItems:s,getMatches:v}=ga($,ve,()=>U.value?"":m.value),D=pe(()=>$.hideSelected?s.value.filter(a=>!N.value.some(p=>p.value===a.value)):s.value),te=pe(()=>$.hideNoData&&!D.value.length||G.isReadonly.value||G.isDisabled.value),oe=wt($,"menu"),ne=pe({get:()=>oe.value,set:a=>{var p;oe.value&&!a&&((p=y.value)!=null&&p.Î¨openChildren.size)||a&&te.value||(oe.value=a)}}),q=Nt(()=>ne.value?$.closeText:$.openText);he(T,a=>{X?ft(()=>X=!1):W.value&&!ne.value&&(ne.value=!0),M("update:search",a)}),he(N,a=>{var p;!$.multiple&&!_.value&&(T.value=((p=a[0])==null?void 0:p.title)??"")});const S=pe(()=>N.value.map(a=>a.value)),c=pe(()=>{var p;return($.autoSelectFirst===!0||$.autoSelectFirst==="exact"&&m.value===((p=D.value[0])==null?void 0:p.title))&&D.value.length>0&&!U.value&&!g.value}),o=z(),i=sa(o,k);function C(a){X=!0,$.openOnClear&&(ne.value=!0)}function fe(){te.value||(ne.value=!0)}function J(a){te.value||(W.value&&(a.preventDefault(),a.stopPropagation()),ne.value=!ne.value)}function _e(a){var p;a.key!==" "&&Vt(a)&&((p=k.value)==null||p.focus())}function De(a){var H,V,b,L;if(Jt(a)||G.isReadonly.value)return;const p=(H=k.value)==null?void 0:H.selectionStart,F=N.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(a.key)&&a.preventDefault(),["Enter","ArrowDown"].includes(a.key)&&(ne.value=!0),["Escape"].includes(a.key)&&(ne.value=!1),["Enter","Escape","Tab"].includes(a.key)&&(c.value&&["Enter","Tab"].includes(a.key)&&!N.value.some(P=>{let{value:re}=P;return re===D.value[0].value})&&Ce(s.value[0]),U.value=!0),a.key==="ArrowDown"&&c.value&&((V=o.value)==null||V.focus("next")),a.key==="Enter"&&m.value&&(Ce(ot($,m.value)),_.value&&(T.value="")),["Backspace","Delete"].includes(a.key)){if(!$.multiple&&_.value&&N.value.length>0&&!m.value)return Ce(N.value[0],!1);if(~h.value){a.preventDefault();const P=h.value;Ce(N.value[h.value],!1),h.value=P>=F-1?F-2:P}else a.key==="Backspace"&&!m.value&&(h.value=F-1);return}if($.multiple)if(a.key==="ArrowLeft"){if(h.value<0&&p&&p>0)return;const P=h.value>-1?h.value-1:F-1;N.value[P]?h.value=P:(h.value=-1,(b=k.value)==null||b.setSelectionRange(m.value.length,m.value.length))}else if(a.key==="ArrowRight"){if(h.value<0)return;const P=h.value+1;N.value[P]?h.value=P:(h.value=-1,(L=k.value)==null||L.setSelectionRange(0,0))}else~h.value&&Vt(a)&&(h.value=-1)}function ae(){var a;$.eager&&((a=ee.value)==null||a.calculateVisibleItems())}function He(){var a;W.value&&(U.value=!0,(a=k.value)==null||a.focus())}function Ce(a){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!a||a.props.disabled))if($.multiple){const F=N.value.findIndex(V=>($.valueComparator||Pt)(V.value,a.value)),H=p??!~F;if(~F){const V=H?[...N.value,a]:[...N.value];V.splice(F,1),N.value=V}else H&&(N.value=[...N.value,a]);$.clearOnSelect&&(m.value="")}else{const F=p!==!1;N.value=F?[a]:[],T.value=F&&!_.value?a.title:"",ft(()=>{ne.value=!1,U.value=!0})}}function Ge(a){W.value=!0,setTimeout(()=>{g.value=!0})}function Qe(a){g.value=!1}function Ee(a){(a==null||a===""&&!$.multiple&&!_.value)&&(N.value=[])}return he(W,(a,p)=>{if(!(a||a===p)&&(h.value=-1,ne.value=!1,m.value)){if($.multiple){Ce(ot($,m.value));return}if(!_.value)return;N.value.some(F=>{let{title:H}=F;return H===m.value})?T.value="":Ce(ot($,m.value))}}),he(ne,()=>{if(!$.hideSelected&&ne.value&&N.value.length){const a=D.value.findIndex(p=>N.value.some(F=>($.valueComparator||Pt)(F.value,p.value)));Wt&&window.requestAnimationFrame(()=>{var p;a>=0&&((p=ee.value)==null||p.scrollToIndex(a))})}}),he(()=>$.items,(a,p)=>{ne.value||W.value&&!p.length&&a.length&&(ne.value=!0)}),Ot(()=>{const a=!!(!$.hideNoData||D.value.length||A["prepend-item"]||A["append-item"]||A["no-data"]),p=N.value.length>0,F=be.filterProps($);return e(be,we({ref:k},F,{modelValue:m.value,"onUpdate:modelValue":[H=>m.value=H,Ee],focused:W.value,"onUpdate:focused":H=>W.value=H,validationValue:N.externalValue,counterValue:x.value,dirty:p,class:["v-combobox",{"v-combobox--active-menu":ne.value,"v-combobox--chips":!!$.chips,"v-combobox--selection-slot":!!_.value,"v-combobox--selecting-index":h.value>-1,[`v-combobox--${$.multiple?"multiple":"single"}`]:!0},$.class],style:$.style,readonly:G.isReadonly.value,placeholder:p?void 0:$.placeholder,"onClick:clear":C,"onMousedown:control":fe,onKeydown:De}),{...A,default:()=>e(ze,null,[e(ba,we({ref:y,modelValue:ne.value,"onUpdate:modelValue":H=>ne.value=H,activator:"parent",contentClass:"v-combobox__content",disabled:te.value,eager:$.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:$.transition,onAfterEnter:ae,onAfterLeave:He},$.menuProps),{default:()=>[a&&e(ct,we({ref:o,selected:S.value,selectStrategy:$.multiple?"independent":"single-independent",onMousedown:H=>H.preventDefault(),onKeydown:_e,onFocusin:Ge,onFocusout:Qe,tabindex:"-1","aria-live":"polite",color:$.itemColor??$.color},i,$.listProps),{default:()=>{var H,V,b;return[(H=A["prepend-item"])==null?void 0:H.call(A),!D.value.length&&!$.hideNoData&&(((V=A["no-data"])==null?void 0:V.call(A))??e(je,{key:"no-data",title:O($.noDataText)},null)),e(na,{ref:ee,renderless:!0,items:D.value,itemKey:"value"},{default:L=>{var ie;let{item:P,index:re,itemRef:ue}=L;const ye=we(P.props,{ref:ue,key:P.value,active:c.value&&re===0?!0:void 0,onClick:()=>Ce(P,null)});return((ie=A.item)==null?void 0:ie.call(A,{item:P,index:re,props:ye}))??e(je,we(ye,{role:"option"}),{prepend:$e=>{let{isSelected:Se}=$e;return e(ze,null,[$.multiple&&!$.hideSelected?e(ha,{key:P.value,modelValue:Se,ripple:!1,tabindex:"-1"},null):void 0,P.props.prependAvatar&&e(Ve,{image:P.props.prependAvatar},null),P.props.prependIcon&&e(w,{icon:P.props.prependIcon},null)])},title:()=>{var $e;return U.value?P.title:ka("v-combobox",P.title,($e=v(P))==null?void 0:$e.title)}})}}),(b=A["append-item"])==null?void 0:b.call(A)]}})]}),N.value.map((H,V)=>{function b(ue){ue.stopPropagation(),ue.preventDefault(),Ce(H,!1)}const L={"onClick:close":b,onKeydown(ue){ue.key!=="Enter"&&ue.key!==" "||(ue.preventDefault(),ue.stopPropagation(),b(ue))},onMousedown(ue){ue.preventDefault(),ue.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},P=d.value?!!A.chip:!!A.selection,re=P?Qt(d.value?A.chip({item:H,index:V,props:L}):A.selection({item:H,index:V})):void 0;if(!(P&&!re))return e("div",{key:H.value,class:["v-combobox__selection",V===h.value&&["v-combobox__selection--selected",de.value]],style:V===h.value?me.value:{}},[d.value?A.chip?e(Xt,{key:"chip-defaults",defaults:{VChip:{closable:$.closableChips,size:"small",text:H.title}}},{default:()=>[re]}):e(ce,we({key:"chip",closable:$.closableChips,size:"small",text:H.title,disabled:H.props.disabled},L),null):re??e("span",{class:"v-combobox__selection-text"},[H.title,$.multiple&&V<N.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[u(",")])])])})]),"append-inner":function(){var L,P;for(var H=arguments.length,V=new Array(H),b=0;b<H;b++)V[b]=arguments[b];return e(ze,null,[(L=A["append-inner"])==null?void 0:L.call(A,...V),(!$.hideNoData||$.items.length)&&$.menuIcon?e(w,{class:"v-combobox__menu-icon",color:(P=k.value)==null?void 0:P.fieldIconColor,icon:$.menuIcon,onMousedown:J,onClick:Gt,"aria-label":O(q.value),title:O(q.value),tabindex:"-1"},null):void 0])}})}),ya({isFocused:W,isPristine:U,menu:ne,search:m,selectionIndex:h,filteredItems:s,select:Ce},k)}}),Ia={class:"d-flex align-center gap-3"},Da={class:"text-body-2 ma-0 opacity-90"},za={class:"d-flex align-center gap-4"},Ua={class:"flex-grow-1"},Ta={class:"text-h6 font-weight-bold mb-1"},Aa={class:"text-body-2 text-medium-emphasis mb-1"},Ha={class:"d-flex align-center gap-4 mb-0"},Ma={class:"text-body-2 text-medium-emphasis mb-0"},Ka={class:"text-body-2 text-info mb-0 font-weight-medium"},Fa={key:0,class:"text-body-2 text-success mb-0 font-weight-medium"},Ea={class:"text-body-1 font-weight-bold"},Ba={class:"text-body-1 font-weight-bold"},Ra={class:"text-body-1 font-weight-bold"},qa={class:"text-body-1 font-weight-bold"},La={class:"d-flex align-center justify-space-between w-100"},Na={class:"d-flex align-center"},Oa={key:0,class:"text-warning"},ja={key:1},Ja={key:0,class:"text-center pa-8"},Wa={class:"d-flex align-center gap-4 mt-1"},Ga={key:1,class:"text-primary"},Qa={class:"d-flex gap-2"},Xa=Re({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup($,{emit:ke}){const M=$,A=ke,O=pe({get:()=>M.modelValue,set:r=>A("update:modelValue",r)}),k=z(!1),W=z([]),U=z(!1),g=z(!1),y=z(""),ee=z(""),h=z(!1),X=z(-1),ve=z(!1),{loading:se,currentHPPBreakdown:E,getProductHPPBreakdown:de}=_t(),me=pe(()=>{var r,a,p;return((r=E.value)==null?void 0:r.total_hpp)||((a=M.product)==null?void 0:a.hpp)||((p=M.product)==null?void 0:p.cost)||0}),N=pe(()=>{var p;const r=((p=M.product)==null?void 0:p.price)||0,a=me.value;return r-a}),G=pe(()=>{var p;const r=((p=M.product)==null?void 0:p.price)||0,a=me.value;return r<=0?0:Math.round((r-a)/r*100)}),d=z({itemId:null,quantity:1,unit:"pcs",isCritical:!1}),_=z([]),T=z(!1),m=z([]),x=async()=>{var r;if(M.product)try{const a=M.product.id_product||M.product.id,p=await rt.getAll({product_id:a,page:1,per_page:1e5});p.success&&((r=p.data)!=null&&r.data)&&(W.value=p.data.data,m.value=JSON.parse(JSON.stringify(p.data.data)))}catch(a){console.error("Error fetching product composition:",a)}},s=async()=>{var r;T.value=!0;try{const a=await Kt.getAll({page:1,per_page:1e5,active:!0});a.success&&((r=a.data)!=null&&r.data)&&(_.value=a.data.data.map(p=>{var F,H,V;return{id:((F=p.id_item)==null?void 0:F.toString())||((H=p.id)==null?void 0:H.toString()),name:p.name,current_stock:((V=p.inventory)==null?void 0:V.current_stock)||0,unit:p.unit||"pcs"}}))}catch(a){console.error("Error fetching available items:",a),_.value=[]}finally{T.value=!1}},v=pe(()=>d.value.itemId&&d.value.quantity>0&&d.value.unit.trim().length>0),D=pe(()=>{if(!d.value.itemId)return null;const r=_.value.find(a=>a.id===d.value.itemId);return(r==null?void 0:r.unit)||null}),te=pe(()=>{if(!d.value.itemId)return null;const r=_.value.find(a=>a.id===d.value.itemId);return r?q(r):null}),oe=pe(()=>te.value!==null&&te.value<=0),ne=pe(()=>Array.isArray(_.value)?_.value:[]),q=r=>r.current_stock||r.stock||0,S=()=>T.value?"Memuat items...":!_.value||_.value.length===0?"Tidak ada item tersedia":"Tidak ada item yang ditemukan",c=r=>{const a=q(r);return a>50?"success":a>20?"warning":a>0?"error":"grey"},o=r=>{const a=q(r);return a>50?"Aman":a>20?"Rendah":a>0?"Kritis":"Habis"};he(()=>d.value.itemId,r=>{if(r){const a=_.value.find(p=>p.id===r);a!=null&&a.unit&&(d.value.unit=a.unit)}}),he(()=>M.items,r=>{r&&r.length>0,W.value=[...r]},{immediate:!0}),he(()=>M.modelValue,async r=>{r&&M.product&&(x(),await i())});const i=async()=>{if(M.product&&(M.product.id_product||M.product.id))try{const r=parseInt(String(M.product.id_product||M.product.id));await de(r,"latest")}catch(r){console.warn("Could not load HPP data:",r)}};tt(()=>{s()});const C=()=>{ve.value=!0},fe=async()=>{await i(),A("refresh")},J=()=>W.value.some(a=>{var p;return((p=a.item)==null?void 0:p.inventory)&&a.item.inventory.current_stock<a.quantity_needed})?"error":"success",_e=()=>W.value.some(a=>{var p;return((p=a.item)==null?void 0:p.inventory)&&a.item.inventory.current_stock<a.quantity_needed})?"Stok Kritis":"Stok Aman",De=()=>{if(!v.value)return;const r=_.value.find(F=>F.id===d.value.itemId);if(!r)return;if(W.value.find(F=>{var H;return((H=F.item)==null?void 0:H.id)===r.id})){y.value=`Item "${r.name}" sudah ada dalam komposisi produk ini`,U.value=!0;return}const p={id_product_item:`temp_${Date.now()}`,item:{id:String(r.id),name:r.name,inventory:{current_stock:r.current_stock||0}},quantity_needed:d.value.quantity,unit:d.value.unit,is_critical:d.value.isCritical};W.value.push(p),Ce()},ae=(r,a)=>{var H;if(_.value.length===0){console.warn("â ï¸ Available items not loaded yet, fetching..."),s().then(()=>{ae(r,a)});return}h.value=!0,X.value=a;let p=((H=r.item)==null?void 0:H.id)||null;if(p!==null&&(p=p.toString()),d.value={itemId:p,quantity:parseFloat(r.quantity_needed.toString())||0,unit:r.unit,isCritical:r.is_critical},!_.value.find(V=>V.id===p)){console.warn("â ï¸ Item ID not found in available items, trying alternative matching...");const V=_.value.find(b=>{var L;return b.name===((L=r.item)==null?void 0:L.name)});V?d.value.itemId=V.id:console.error("â Could not find item in available items by ID or name")}},He=()=>{if(!v.value||X.value===-1)return;const r=_.value.find(a=>a.id===d.value.itemId);r&&(W.value[X.value]={...W.value[X.value],item:{id:String(r.id),name:r.name,inventory:{current_stock:r.current_stock||0}},quantity_needed:d.value.quantity,unit:d.value.unit,is_critical:d.value.isCritical},Ce())},Ce=()=>{h.value=!1,X.value=-1,d.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},Ge=r=>{W.value.splice(r,1)},Qe=async()=>{var r,a,p,F,H,V,b,L,P;if(M.product){k.value=!0;try{const re=parseInt(String(((r=M.product)==null?void 0:r.id_product)||((a=M.product)==null?void 0:a.id)||"0")),ue=m.value||[],ye=W.value;for(const ie of ye){const $e=ue.find(Te=>{var Xe,Ze;return!!(Te.id_product_item===ie.id_product_item||ie.id_product_item&&!ie.id_product_item.toString().startsWith("temp_")&&((Xe=Te.item)==null?void 0:Xe.id)===((Ze=ie.item)==null?void 0:Ze.id))});if(!((p=ie.item)!=null&&p.id)||parseInt(ie.item.id)===0){console.warn("â ï¸ Skipping item with invalid item_id:",{item_name:(F=ie.item)==null?void 0:F.name,item_id:(H=ie.item)==null?void 0:H.id,full_item:ie});continue}const Se={product_id:re,item_id:parseInt(((V=ie.item)==null?void 0:V.id)||"0"),quantity_needed:parseFloat(ie.quantity_needed.toString()),unit:ie.unit,is_critical:ie.is_critical,notes:ie.notes||""};try{$e&&!((b=ie.id_product_item)!=null&&b.toString().startsWith("temp_"))?await rt.update(parseInt($e.id_product_item||"0"),Se):await rt.create(Se)}catch(Te){throw console.error("â Error processing item:",Te),(L=Te.message)!=null&&L.includes("already assigned")?y.value=`Item "${(P=ie.item)==null?void 0:P.name}" sudah ditambahkan ke produk ini`:y.value=Te.message||"Terjadi kesalahan saat menyimpan item",U.value=!0,Te}}for(const ie of ue)if(!ye.find(Se=>Se.id_product_item===ie.id_product_item)&&ie.id_product_item)try{await rt.delete(parseInt(ie.id_product_item))}catch(Se){console.error("â Error deleting item:",Se),y.value=`Gagal menghapus item: ${Se.message}`,U.value=!0}ee.value="Komposisi produk berhasil disimpan!",g.value=!0,A("save",{product:M.product,items:W.value}),A("refresh"),Ee()}catch(re){console.error("â Error saving composition:",re),U.value||(y.value=re.message||"Terjadi kesalahan saat menyimpan komposisi",U.value=!0)}finally{k.value=!1}}},Ee=()=>{O.value=!1,setTimeout(()=>{W.value=[...M.items],Ce()},300)};return(r,a)=>{var p,F,H,V;return f(),Z(ze,null,[e(Le,{modelValue:O.value,"onUpdate:modelValue":a[9]||(a[9]=b=>O.value=b),"max-width":"900",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var b;return[l("div",Ia,[e(w,{icon:"mdi-chef-hat",size:"24"}),l("div",null,[a[12]||(a[12]=l("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),l("p",Da,n(((b=r.product)==null?void 0:b.name)||"Produk"),1)])]),e(R,{icon:"mdi-close",variant:"text",size:"small",onClick:Ee})]}),_:1}),e(le,{class:"pa-6"},{default:t(()=>[e(Y,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(le,{class:"pa-4"},{default:t(()=>{var b,L,P,re,ue,ye;return[l("div",za,[e(Ve,{image:(b=r.product)==null?void 0:b.image_url,size:"64"},{default:t(()=>{var ie;return[(ie=r.product)!=null&&ie.image_url?j("",!0):(f(),B(w,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),l("div",Ua,[l("h4",Ta,n((L=r.product)==null?void 0:L.name),1),l("p",Aa," SKU: "+n(((P=r.product)==null?void 0:P.sku)||"SKU-"+((re=r.product)==null?void 0:re.id_product)),1),l("div",Ha,[l("p",Ma," Harga: "+n(K(Ae)(((ue=r.product)==null?void 0:ue.price)||0)),1),l("p",Ka," HPP: "+n(K(Ae)(me.value)),1),(ye=r.product)!=null&&ye.price&&me.value?(f(),Z("p",Fa," Margin: "+n(K(Ae)(N.value)),1)):j("",!0)])]),e(ce,{color:J(),variant:"tonal"},{default:t(()=>[u(n(_e()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e(Pe,{class:"mb-6"},{default:t(()=>[e(I,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"info"},{default:t(()=>[e(le,{class:"text-center pa-3"},{default:t(()=>[e(w,{icon:"mdi-calculator",size:"20",class:"mb-1"}),l("div",Ea,[u(n(K(Ae)(me.value))+" ",1),K(se)?(f(),B(dt,{key:0,indeterminate:"",size:"12",width:"2",class:"ml-1"})):j("",!0)]),a[13]||(a[13]=l("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[13]})]),_:1})]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"primary"},{default:t(()=>[e(le,{class:"text-center pa-3"},{default:t(()=>{var b;return[e(w,{icon:"mdi-currency-usd",size:"20",class:"mb-1"}),l("div",Ba,n(K(Ae)(((b=r.product)==null?void 0:b.price)||0)),1),a[14]||(a[14]=l("div",{class:"text-caption"},"Harga Jual",-1))]}),_:1,__:[14]})]),_:1})]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"success"},{default:t(()=>[e(le,{class:"text-center pa-3"},{default:t(()=>[e(w,{icon:"mdi-trending-up",size:"20",class:"mb-1"}),l("div",Ra,n(K(Ae)(N.value)),1),a[15]||(a[15]=l("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[15]})]),_:1})]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"warning"},{default:t(()=>[e(le,{class:"text-center pa-3"},{default:t(()=>[e(w,{icon:"mdi-percent",size:"20",class:"mb-1"}),l("div",qa,n(G.value)+"% ",1),a[16]||(a[16]=l("div",{class:"text-caption"},"Margin %",-1))]),_:1,__:[16]})]),_:1})]),_:1})]),_:1}),e(Y,{class:"mb-6",elevation:"2"},{default:t(()=>[e(xe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[l("div",La,[l("div",Na,[e(w,{icon:h.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),u(" "+n(h.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(le,{class:"pa-4"},{default:t(()=>[e(Pe,null,{default:t(()=>[e(I,{cols:"12",md:"4"},{default:t(()=>[e(yt,{modelValue:d.value.itemId,"onUpdate:modelValue":a[0]||(a[0]=b=>d.value.itemId=b),items:ne.value,loading:T.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item (termasuk yang stok kosong)...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":S()},{item:t(({props:b,item:L})=>[e(je,we(b,{class:{"text-medium-emphasis":q(L.raw)<=0}}),{prepend:t(()=>[e(Ve,{size:"32",class:"me-3",color:q(L.raw)<=0?"warning":"primary",variant:"tonal"},{default:t(()=>[e(w,{icon:"mdi-package-variant",color:q(L.raw)<=0?"warning":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[q(L.raw)>0?(f(),B(ce,{key:0,size:"x-small",color:c(L.raw),variant:"tonal"},{default:t(()=>[u(n(o(L.raw)),1)]),_:2},1032,["color"])):(f(),B(ce,{key:1,size:"x-small",color:"warning",variant:"tonal","prepend-icon":"mdi-alert"},{default:t(()=>a[18]||(a[18]=[u(" Kosong ")])),_:1,__:[18]}))]),default:t(()=>[e(Ye,null,{default:t(()=>[u(n(L.raw.name),1)]),_:2},1024),e(st,{class:"text-medium-emphasis"},{default:t(()=>[q(L.raw)<=0?(f(),Z("span",Oa,[e(w,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),a[17]||(a[17]=u(" Stok Kosong - Masih bisa digunakan "))])):(f(),Z("span",ja," Stok: "+n(q(L.raw))+" "+n(L.raw.unit),1))]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(be,{modelValue:d.value.quantity,"onUpdate:modelValue":a[1]||(a[1]=b=>d.value.quantity=b),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(be,{modelValue:d.value.unit,"onUpdate:modelValue":a[2]||(a[2]=b=>d.value.unit=b),label:"Satuan",variant:"outlined",placeholder:"kg, pcs, ml",readonly:!!D.value,hint:D.value?`Satuan dari item: ${D.value}`:"","persistent-hint":""},null,8,["modelValue","readonly","hint"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(it,{modelValue:d.value.isCritical,"onUpdate:modelValue":a[3]||(a[3]=b=>d.value.isCritical=b),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(R,{color:h.value?"success":"primary",block:"","prepend-icon":h.value?"mdi-check":"mdi-plus",onClick:a[4]||(a[4]=b=>h.value?He():De()),disabled:!v.value},{default:t(()=>[u(n(h.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),h.value?(f(),B(R,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:Ce},{default:t(()=>a[19]||(a[19]=[u(" Batal ")])),_:1,__:[19]})):j("",!0)]),_:1})]),_:1}),oe.value?(f(),B(Ke,{key:0,color:"warning",variant:"tonal",class:"mt-4","prepend-icon":"mdi-alert"},{default:t(()=>[e(ut,null,{default:t(()=>a[20]||(a[20]=[u("Item Stok Kosong")])),_:1,__:[20]}),a[21]||(a[21]=l("div",null,"Item yang dipilih sedang kosong stok, namun masih bisa ditambahkan ke komposisi. Pastikan untuk memperbarui stok sebelum produksi.",-1))]),_:1,__:[21]})):j("",!0)]),_:1})]),_:1}),e(Y,{elevation:"2"},{default:t(()=>[e(xe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e(w,{icon:"mdi-format-list-bulleted",class:"me-2"}),u(" Daftar Item Komposisi ("+n(W.value.length)+") ",1)]),_:1}),e(le,{class:"pa-0"},{default:t(()=>[W.value.length===0?(f(),Z("div",Ja,[e(w,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),a[22]||(a[22]=l("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),a[23]||(a[23]=l("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(f(),B(ct,{key:1},{default:t(()=>[(f(!0),Z(ze,null,Je(W.value,(b,L)=>(f(),B(je,{key:b.id||L,class:"border-b"},{prepend:t(()=>[e(Ve,{size:"40",class:"me-3"},{default:t(()=>{var P,re;return[e(w,{icon:(P=b.item)!=null&&P.inventory&&b.item.inventory.current_stock>=b.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(re=b.item)!=null&&re.inventory&&b.item.inventory.current_stock>=b.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[l("div",Qa,[e(R,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:P=>ae(b,L)},null,8,["onClick"]),e(R,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:P=>Ge(L)},null,8,["onClick"])])]),default:t(()=>[e(Ye,{class:"font-weight-medium"},{default:t(()=>{var P;return[u(n(((P=b.item)==null?void 0:P.name)||"Item tidak ditemukan")+" ",1),b.is_critical?(f(),B(ce,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>a[24]||(a[24]=[u(" Kritis ")])),_:1,__:[24]})):j("",!0)]}),_:2},1024),e(st,null,{default:t(()=>{var P;return[l("div",Wa,[l("span",null,"Dibutuhkan: "+n(parseFloat(b.quantity_needed))+" "+n(b.unit),1),(P=b.item)!=null&&P.inventory?(f(),Z("span",{key:0,class:We(b.item.inventory.current_stock>=b.quantity_needed?"text-success":"text-error")}," Stok: "+n(b.item.inventory.current_stock)+" "+n(b.unit),3)):j("",!0),b.formatted_total_cost?(f(),Z("span",Ga,n(b.formatted_total_cost),1)):j("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(Be,{class:"pa-6 pt-0"},{default:t(()=>[e(R,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:C},{default:t(()=>a[25]||(a[25]=[u(" Setting HPP ")])),_:1,__:[25]}),e(Ne),e(R,{variant:"outlined",onClick:Ee},{default:t(()=>a[26]||(a[26]=[u(" Batal ")])),_:1,__:[26]}),e(R,{color:"primary",onClick:Qe,loading:k.value},{default:t(()=>a[27]||(a[27]=[u(" Simpan Komposisi ")])),_:1,__:[27]},8,["loading"])]),_:1})]),_:1}),e(et,{modelValue:U.value,"onUpdate:modelValue":a[6]||(a[6]=b=>U.value=b),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:a[5]||(a[5]=b=>U.value=!1)},{default:t(()=>a[28]||(a[28]=[u(" Tutup ")])),_:1,__:[28]})]),default:t(()=>[u(n(y.value)+" ",1)]),_:1},8,["modelValue"]),e(et,{modelValue:g.value,"onUpdate:modelValue":a[8]||(a[8]=b=>g.value=b),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:a[7]||(a[7]=b=>g.value=!1)},{default:t(()=>a[29]||(a[29]=[u(" Tutup ")])),_:1,__:[29]})]),default:t(()=>[u(n(ee.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(Ft,{modelValue:ve.value,"onUpdate:modelValue":a[10]||(a[10]=b=>ve.value=b),"product-id":parseInt(String(((p=r.product)==null?void 0:p.id_product)||((F=r.product)==null?void 0:F.id)||"0")),"product-name":((H=r.product)==null?void 0:H.product_name)||((V=r.product)==null?void 0:V.name),onHppUpdated:fe,onPriceUpdated:a[11]||(a[11]=b=>A("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),zt=Oe(Xa,[["__scopeId","data-v-e5c956e7"]]),Za={class:"composition-cards"},Ya={key:1,class:"text-center pa-12"},el={key:2,class:"text-center pa-12"},tl={class:"d-flex align-center gap-3"},al={class:"flex-grow-1 min-width-0"},ll={class:"text-h6 font-weight-bold text-truncate"},ol={class:"text-caption text-medium-emphasis mb-0"},sl={class:"d-flex align-center gap-2 mb-3"},il={class:"text-body-2 font-weight-medium"},nl={class:"composition-items"},rl={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},ul={class:"text-body-2 text-truncate"},dl={class:"text-end flex-shrink-0"},cl={class:"text-body-2 font-weight-medium"},ml={key:0,class:"text-caption text-success"},vl={key:1,class:"text-caption text-primary"},pl={class:"d-flex justify-between align-center mb-3"},fl={class:"text-h6 font-weight-bold text-primary"},gl={class:"d-flex gap-2"},_l={class:"d-flex align-center"},kl={class:"d-flex align-center gap-4"},yl={class:"flex-grow-1"},bl={class:"text-h5 font-weight-bold mb-2"},hl={class:"d-flex align-center gap-4 mb-2"},xl={class:"text-body-2"},wl={class:"d-flex align-center gap-4"},Pl={class:"text-h6 text-primary font-weight-bold"},Vl={class:"text-body-2 text-info font-weight-medium"},Cl={key:0,class:"text-body-2 text-success font-weight-medium"},$l={class:"d-flex align-center mt-1 gap-4"},Sl={class:"d-flex align-center"},Il={class:"d-flex align-center"},Dl={key:0,class:"d-flex align-center"},zl={class:"text-primary font-weight-medium"},Ul={key:1,class:"text-center py-8"},Tl={class:"text-h6 font-weight-bold"},Al={class:"text-h6 font-weight-bold"},Hl={class:"text-h6 font-weight-bold"},Ml={class:"text-h6 font-weight-bold"},Kl={class:"text-h6 font-weight-bold"},Fl=Re({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup($,{emit:ke}){const M=$,A=ke,O=z(!1),k=z(!1),W=z(null),U=z([]),g=z(null),y=z({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),ee=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],h=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],X=x=>{W.value=x,U.value=x.items||[],O.value=!0},ve=x=>{g.value=x,k.value=!0},se=x=>{A("refresh")},E=()=>{y.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},de=pe(()=>!!(y.value.search||y.value.stockStatus||y.value.itemType||y.value.criticalOnly||y.value.sortBy!=="name_asc")),me=pe(()=>{let x=0;return y.value.search&&x++,y.value.stockStatus&&x++,y.value.itemType&&x++,y.value.criticalOnly&&x++,y.value.sortBy!=="name_asc"&&x++,x}),N=pe(()=>{const x=new Map;M.productItems.forEach(v=>{if(!v.product)return;const D=v.product.id_product||v.product.id;x.has(D)||x.set(D,{...v.product,items:[],totalItems:0}),x.get(D).items.push(v),x.get(D).totalItems++});let s=Array.from(x.values());if(y.value.search){const v=y.value.search.toLowerCase();s=s.filter(D=>D.name.toLowerCase().includes(v)||D.sku&&D.sku.toLowerCase().includes(v)||D.items.some(te=>{var oe;return(oe=te.item)==null?void 0:oe.name.toLowerCase().includes(v)}))}return y.value.stockStatus&&(s=s.filter(v=>{const D=G(v);switch(y.value.stockStatus){case"safe":return D.color==="success";case"critical":return D.color==="warning";case"out":return D.color==="error";default:return!0}})),y.value.criticalOnly&&(s=s.filter(v=>v.items.some(D=>D.is_critical))),s.sort((v,D)=>{switch(y.value.sortBy){case"name_asc":return v.name.localeCompare(D.name);case"name_desc":return D.name.localeCompare(v.name);case"price_asc":return(v.price||0)-(D.price||0);case"price_desc":return(D.price||0)-(v.price||0);case"items_asc":return v.totalItems-D.totalItems;case"items_desc":return D.totalItems-v.totalItems;default:return v.name.localeCompare(D.name)}}),s}),G=x=>{let s=!1,v=!1;return x.items.forEach(D=>{var te;if((te=D.item)!=null&&te.inventory){const oe=D.item.inventory.current_stock||0,ne=D.quantity_needed||0;oe<=0?s=!0:(oe<ne||D.is_critical)&&(v=!0)}}),s?{text:"Stok Habis",color:"error"}:v?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},d=x=>{if(!(x!=null&&x.inventory))return"grey";const s=x.inventory.current_stock||0;return s<=0?"error":s<=10?"warning":"success"},_=x=>{if(!(x!=null&&x.inventory))return"Tidak ada data";const s=x.inventory.current_stock||0;return s<=0?"Habis":s<=10?"Rendah":"Aman"},T=x=>{const s=d(x);return{"text-error":s==="error","text-warning":s==="warning","text-success":s==="success","text-grey":s==="grey"}},m=x=>`Item Komposisi (${x})`;return(x,s)=>(f(),Z("div",Za,[e(Y,{class:"mb-6"},{default:t(()=>[e(xe,{class:"d-flex align-center justify-between"},{default:t(()=>[s[12]||(s[12]=l("div",null,[l("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),l("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),e(R,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:s[0]||(s[0]=v=>A("refresh")),loading:x.loading},{default:t(()=>s[11]||(s[11]=[u(" Refresh ")])),_:1,__:[11]},8,["loading"])]),_:1,__:[12]})]),_:1}),e(Y,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(le,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(I,{cols:"12",md:"3"},{default:t(()=>[e(be,{modelValue:y.value.search,"onUpdate:modelValue":s[1]||(s[1]=v=>y.value.search=v),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:y.value.stockStatus,"onUpdate:modelValue":s[2]||(s[2]=v=>y.value.stockStatus=v),items:ee,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:y.value.sortBy,"onUpdate:modelValue":s[3]||(s[3]=v=>y.value.sortBy=v),items:h,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(ra,{modelValue:y.value.criticalOnly,"onUpdate:modelValue":s[4]||(s[4]=v=>y.value.criticalOnly=v),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Pe,{class:"mt-3"},{default:t(()=>[e(I,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(R,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:E,disabled:!de.value},{default:t(()=>s[13]||(s[13]=[u(" Reset Filter ")])),_:1,__:[13]},8,["disabled"]),de.value?(f(),B(ce,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[u(n(me.value)+" filter aktif ",1)]),_:1})):j("",!0)]),_:1}),e(I,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(ce,{color:N.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[u(n(N.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!x.loading&&N.value.length===0&&de.value?(f(),B(Ke,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):j("",!0),x.loading?(f(),Z("div",Ya,[e(dt,{color:"primary",indeterminate:"",size:"64"}),s[14]||(s[14]=l("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):N.value.length===0?(f(),Z("div",el,[e(w,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),s[16]||(s[16]=l("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),s[17]||(s[17]=l("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(R,{color:"primary",size:"large","prepend-icon":"mdi-plus"},{default:t(()=>s[15]||(s[15]=[u(" Buat Komposisi Pertama ")])),_:1,__:[15]})])):(f(),B(Pe,{key:3},{default:t(()=>[(f(!0),Z(ze,null,Je(N.value,v=>(f(),B(I,{key:v.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(Y,{class:We(["composition-card h-100",{"border-error":G(v).color==="error"}]),elevation:"2"},{default:t(()=>[e(xe,{class:"pa-4 pb-2"},{default:t(()=>[l("div",tl,[e(Ve,{image:v.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[v.image_url?j("",!0):(f(),B(w,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),l("div",al,[l("h3",ll,n(v.name),1),l("p",ol,n(v.sku||"SKU-"+v.id_product),1)])])]),_:2},1024),e(le,{class:"py-2"},{default:t(()=>[e(ce,{color:G(v).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[u(n(G(v).text),1)]),_:2},1032,["color"]),l("div",sl,[e(w,{icon:"mdi-format-list-bulleted",size:"16"}),l("span",il,n(m(v.totalItems)),1)]),l("div",nl,[(f(!0),Z(ze,null,Je(v.items,D=>{var te,oe,ne,q;return f(),Z("div",{key:D.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[l("div",rl,[e(w,{icon:(te=D.item)!=null&&te.inventory&&D.item.inventory.current_stock>=D.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(oe=D.item)!=null&&oe.inventory&&D.item.inventory.current_stock>=D.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),l("span",ul,n(((ne=D.item)==null?void 0:ne.name)||"Item tidak ditemukan"),1),D.is_critical?(f(),B(ce,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>s[18]||(s[18]=[u(" Kritis ")])),_:1,__:[18]})):j("",!0)]),l("div",dl,[l("div",cl,n(parseFloat(D.quantity_needed))+" "+n(D.unit),1),(q=D.item)!=null&&q.inventory?(f(),Z("div",ml," Stok: "+n(D.item.inventory.current_stock)+" "+n(D.unit),1)):j("",!0),D.formatted_total_cost?(f(),Z("div",vl,n(D.formatted_total_cost),1)):j("",!0)])])}),128))])]),_:2},1024),e(le,{class:"pt-0"},{default:t(()=>[e(Ue,{class:"mb-3"}),l("div",pl,[s[19]||(s[19]=l("span",{class:"text-body-2"},"Harga:",-1)),l("span",fl,n(K(Ae)(v.price||0)),1)]),l("div",gl,[e(R,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:D=>ve(v)},{default:t(()=>s[20]||(s[20]=[u(" Detail ")])),_:2,__:[20]},1032,["onClick"]),e(R,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:D=>X(v)},{default:t(()=>s[21]||(s[21]=[u(" Kelola ")])),_:2,__:[21]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(zt,{modelValue:O.value,"onUpdate:modelValue":s[5]||(s[5]=v=>O.value=v),product:W.value,items:U.value,onSave:se,onRefresh:s[6]||(s[6]=v=>A("refresh"))},null,8,["modelValue","product","items"]),e(Le,{modelValue:k.value,"onUpdate:modelValue":s[10]||(s[10]=v=>k.value=v),"max-width":"900",scrollable:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",_l,[e(w,{icon:"mdi-eye",class:"mr-2",color:"primary"}),s[22]||(s[22]=l("span",null,"Detail Komposisi Produk",-1))]),e(R,{icon:"",variant:"text",onClick:s[7]||(s[7]=v=>k.value=!1)},{default:t(()=>[e(w,{icon:"mdi-close"})]),_:1})]),_:1}),e(Ue),g.value?(f(),B(le,{key:0},{default:t(()=>[e(ua,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[e(Y,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(le,null,{default:t(()=>[l("div",kl,[e(Ve,{image:g.value.image_url,size:"80"},{default:t(()=>[g.value.image_url?j("",!0):(f(),B(w,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),l("div",yl,[l("h2",bl,n(g.value.name),1),l("div",hl,[e(ce,{color:G(g.value).color,variant:"tonal",size:"small"},{default:t(()=>[u(n(G(g.value).text),1)]),_:1},8,["color"]),l("span",xl,"SKU: "+n(g.value.sku||"-"),1)]),l("div",wl,[l("div",Pl,n(K(Ae)(g.value.price||0)),1),l("div",Vl," HPP: "+n(K(Ae)(g.value.hpp||g.value.cost||0)),1),g.value.price&&(g.value.hpp||g.value.cost)?(f(),Z("div",Cl," Margin: "+n(K(Ae)((g.value.price||0)-(g.value.hpp||g.value.cost||0))),1)):j("",!0)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e(Pe,null,{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[e(Y,{variant:"outlined"},{default:t(()=>[e(xe,{class:"text-h6"},{default:t(()=>[e(w,{icon:"mdi-format-list-bulleted",class:"mr-2"}),u(" Komposisi Item ("+n(g.value.totalItems||0)+") ",1)]),_:1}),e(le,null,{default:t(()=>[g.value.items&&g.value.items.length>0?(f(),B(ct,{key:0},{default:t(()=>[(f(!0),Z(ze,null,Je(g.value.items,(v,D)=>(f(),B(je,{key:v.id_product_item,class:"px-0"},{prepend:t(()=>[e(Ve,{size:"40",color:d(v.item),variant:"tonal"},{default:t(()=>{var te;return[e(w,{icon:(te=v.item)!=null&&te.inventory&&v.item.inventory.current_stock>=v.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(ce,{color:d(v.item),variant:"tonal",size:"small"},{default:t(()=>[u(n(_(v.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(Ye,{class:"font-weight-medium"},{default:t(()=>{var te;return[u(n(((te=v.item)==null?void 0:te.name)||"Unknown Item")+" ",1),v.is_critical?(f(),B(ce,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>s[23]||(s[23]=[u(" Kritis ")])),_:1,__:[23]})):j("",!0)]}),_:2},1024),e(st,null,{default:t(()=>{var te,oe;return[l("div",$l,[l("div",Sl,[e(w,{icon:"mdi-scale",size:"14",class:"mr-1"}),l("span",null," Kebutuhan: "+n(Number(v.quantity_needed||0).toLocaleString("id-ID"))+" "+n(v.unit),1)]),l("div",Il,[e(w,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),l("span",{class:We(T(v.item))}," Stok: "+n(Number(((oe=(te=v.item)==null?void 0:te.inventory)==null?void 0:oe.current_stock)||0).toLocaleString("id-ID"))+" "+n(v.unit),3)]),v.formatted_total_cost?(f(),Z("div",Dl,[e(w,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),l("span",zl,n(v.formatted_total_cost),1)])):j("",!0)])]}),_:2},1024),D<g.value.items.length-1?(f(),B(Ue,{key:0,class:"mt-3"})):j("",!0)]),_:2},1024))),128))]),_:1})):(f(),Z("div",Ul,[e(w,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),s[24]||(s[24]=l("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(Pe,{class:"mt-4"},{default:t(()=>[e(I,{cols:"12",md:"2"},{default:t(()=>[e(Y,{variant:"outlined",color:"primary"},{default:t(()=>[e(le,{class:"text-center"},{default:t(()=>[e(w,{icon:"mdi-format-list-bulleted",size:"24",class:"mb-2"}),l("div",Tl,n(g.value.totalItems||0),1),s[25]||(s[25]=l("div",{class:"text-caption"},"Total Item",-1))]),_:1,__:[25]})]),_:1})]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(Y,{variant:"outlined",color:"warning"},{default:t(()=>[e(le,{class:"text-center"},{default:t(()=>{var v;return[e(w,{icon:"mdi-alert",size:"24",class:"mb-2"}),l("div",Al,n(((v=g.value.items)==null?void 0:v.filter(D=>D.is_critical).length)||0),1),s[26]||(s[26]=l("div",{class:"text-caption"},"Item Kritis",-1))]}),_:1,__:[26]})]),_:1})]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"info"},{default:t(()=>[e(le,{class:"text-center"},{default:t(()=>[e(w,{icon:"mdi-calculator",size:"24",class:"mb-2"}),l("div",Hl,n(K(Ae)(g.value.hpp||g.value.cost||0)),1),s[27]||(s[27]=l("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[27]})]),_:1})]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"success"},{default:t(()=>[e(le,{class:"text-center"},{default:t(()=>[e(w,{icon:"mdi-currency-usd",size:"24",class:"mb-2"}),l("div",Ml,n(K(Ae)(g.value.price||0)),1),s[28]||(s[28]=l("div",{class:"text-caption"},"Harga Jual",-1))]),_:1,__:[28]})]),_:1})]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(Y,{variant:"outlined",color:"purple"},{default:t(()=>[e(le,{class:"text-center"},{default:t(()=>[e(w,{icon:"mdi-trending-up",size:"24",class:"mb-2"}),l("div",Kl,n(K(Ae)((g.value.price||0)-(g.value.hpp||g.value.cost||0))),1),s[29]||(s[29]=l("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[29]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0),e(Ue),e(Be,{class:"pa-4"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",onClick:s[8]||(s[8]=v=>k.value=!1)},{default:t(()=>s[30]||(s[30]=[u(" Tutup ")])),_:1,__:[30]}),e(R,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:s[9]||(s[9]=()=>{k.value=!1,X(g.value)})},{default:t(()=>s[31]||(s[31]=[u(" Kelola Komposisi ")])),_:1,__:[31]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),El=Oe(Fl,[["__scopeId","data-v-25f6bef1"]]),Bl={class:"d-flex align-center gap-2"},Rl={class:"text-white"},ql={class:"text-h6 mb-4 d-flex align-center gap-2"},Ll={class:"text-h6 mb-4 d-flex align-center gap-2"},Nl={class:"d-flex flex-column gap-2"},Ol={key:0,class:"d-flex align-center gap-2"},jl={class:"d-flex align-center gap-2 mb-2"},Jl={class:"d-flex gap-2"},Wl={class:"d-flex gap-2"},Gl={class:"d-flex align-center justify-space-between"},Ql={class:"d-flex align-center gap-2"},Xl={class:"text-end"},Zl={class:"text-h6 font-weight-bold"},Yl={class:"text-caption"},eo={class:"text-h6 mb-4 d-flex align-center gap-2"},to={class:"text-h6 mb-4 d-flex align-center gap-2"},ao={class:"image-upload-container"},lo={key:0,class:"mb-4"},oo={class:"text-center mt-2"},so={class:"text-h6 mb-4 d-flex align-center gap-2"},io={class:"text-h6 mb-4 d-flex align-center gap-2"},no={class:"d-flex align-center"},ro={class:"text-subtitle-1"},uo={class:"text-body-1"},co={class:"d-flex align-center"},mo={class:"text-subtitle-1"},vo=Re({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup($,{emit:ke}){var q,S,c;const M=It(),{nameRules:A,categoryRules:O}=Dt(),{getProductHPPBreakdown:k}=_t(),W=z(!1),U=z(!1),g=async()=>{if(!(!h.editMode||!E.id))try{const o=await fetch(`/api/products/${E.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(o.ok){const i=await o.json();U.value=i.success&&i.data&&i.data.length>0}}catch(o){console.error("Error checking HPP status:",o)}},y=async()=>{if(E.id)try{W.value=!0;const o=await k(E.id,"latest");o&&(E.cost=o.total_hpp,ve("update-form","cost",o.total_hpp))}catch(o){console.error("Error refreshing HPP:",o)}finally{W.value=!1}},ee=()=>{},h=$,X=pe(()=>h.errorMessage),ve=ke,se=z(),E=gt({...h.formData});he(()=>h.formData,o=>{Object.assign(E,o)},{deep:!0}),he(E,o=>{Object.keys(o).forEach(i=>{ve("update-form",i,o[i])})},{deep:!0}),he(()=>h.modelValue,o=>{o&&h.editMode&&g()});const de=gt({length:((q=h.formData.dimensions)==null?void 0:q.length)||null,width:((S=h.formData.dimensions)==null?void 0:S.width)||null,height:((c=h.formData.dimensions)==null?void 0:c.height)||null});he(de,o=>{const i=o.length!==null||o.width!==null||o.height!==null;E.dimensions=i?{length:o.length!==null?o.length:void 0,width:o.width!==null?o.width:void 0,height:o.height!==null?o.height:void 0}:{}},{deep:!0});const me=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],N=pe(()=>{if(!E.price||!E.cost||E.cost<=0)return 0;const o=(E.price-E.cost)/E.cost*100;return Math.ceil(o)}),G=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),d=o=>o<10?"error":o<25?"warning":o<50?"success":"info",_=o=>o<10?"tabler-trending-down":o<25?"tabler-trending-up":o<50?"tabler-trending-up-2":"tabler-trending-up-3",T=o=>!o||o===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),m=o=>{if(!o||o.trim()===""||o==="Rp 0")return 0;const C=o.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(C)||0},x=z(!1),s=o=>{const i=m(o);E.price=i},v=()=>{x.value=!0},D=()=>{x.value=!1},te=async()=>{var i;const{valid:o}=await((i=se.value)==null?void 0:i.validate());o&&ve("submit",E)},oe=o=>{ve("image-change",o)},ne=()=>{ve("remove-image")};return(o,i)=>(f(),B(Le,{"model-value":o.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":i[25]||(i[25]=C=>o.$emit("update:modelValue",C))},{default:t(()=>[e(Y,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[l("div",Bl,[e(w,{icon:o.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),l("span",Rl,n(o.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(R,{icon:"tabler-x",variant:"text",color:"white",onClick:i[0]||(i[0]=C=>o.$emit("close"))})]),_:1}),e(Ue),e(le,{class:"pa-6"},{default:t(()=>[e(bt,{ref_key:"formRef",ref:se,onSubmit:kt(te,["prevent"])},{default:t(()=>[e(Pe,null,{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[l("h6",ql,[e(w,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),i[26]||(i[26]=u(" Informasi Dasar "))])]),_:1}),e(I,{cols:"12",md:"8"},{default:t(()=>[e(be,{modelValue:E.name,"onUpdate:modelValue":i[1]||(i[1]=C=>E.name=C),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:K(A),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(be,{modelValue:E.sku,"onUpdate:modelValue":i[2]||(i[2]=C=>E.sku=C),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(Ct,{modelValue:E.description,"onUpdate:modelValue":i[3]||(i[3]=C=>E.description=C),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[e(Fe,{"model-value":E.category_id,"onUpdate:modelValue":i[4]||(i[4]=C=>E.category_id=C),items:o.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:K(O),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[e(be,{modelValue:E.brand,"onUpdate:modelValue":i[5]||(i[5]=C=>E.brand=C),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[l("h6",Ll,[e(w,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),i[27]||(i[27]=u(" Harga & Biaya "))])]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[e(be,{"model-value":T(E.price),"onUpdate:modelValue":i[6]||(i[6]=C=>s(C)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:v,onBlur:D},null,8,["model-value"])]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[l("div",Nl,[e(be,{"model-value":T(E.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),o.editMode?(f(),Z("div",Ol,[e(ce,{color:U.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e(w,{icon:U.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),u(" "+n(U.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),U.value?(f(),B(R,{key:0,size:"small",variant:"outlined",color:"primary",onClick:y,loading:W.value},{default:t(()=>[e(w,{icon:"tabler-refresh",size:"14",class:"me-1"}),i[28]||(i[28]=u(" Update HPP "))]),_:1,__:[28]},8,["loading"])):(f(),B(Me,{key:1},{activator:t(({props:C})=>[e(ce,we(C,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e(w,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),i[29]||(i[29]=u(" Belum Ada Resep "))]),_:2,__:[29]},1040)]),default:t(()=>[i[30]||(i[30]=l("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[30]}))])):j("",!0)])]),_:1}),o.editMode?(f(),B(I,{key:0,cols:"12"},{default:t(()=>[U.value?(f(),B(Ke,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ut,null,{default:t(()=>[e(w,{icon:"tabler-info-circle",class:"me-2"}),i[31]||(i[31]=u(" HPP Otomatis Aktif "))]),_:1,__:[31]}),i[32]||(i[32]=l("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[32]})):(f(),B(Ke,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ut,null,{default:t(()=>[e(w,{icon:"tabler-alert-triangle",class:"me-2"}),i[33]||(i[33]=u(" HPP Manual "))]),_:1,__:[33]}),i[34]||(i[34]=l("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[34]}))]),_:1})):j("",!0),e(I,{cols:"12"},{default:t(()=>[U.value&&o.editMode?(f(),B(Ke,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[l("div",jl,[e(w,{icon:"tabler-check-circle"}),i[35]||(i[35]=l("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),i[38]||(i[38]=l("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),l("div",Jl,[e(R,{size:"small",color:"primary",variant:"outlined",onClick:ee},{default:t(()=>[e(w,{icon:"tabler-edit",size:"14",class:"me-1"}),i[36]||(i[36]=u(" Edit Resep "))]),_:1,__:[36]}),e(R,{size:"small",variant:"outlined",color:"info",onClick:y,loading:W.value},{default:t(()=>[e(w,{icon:"tabler-refresh",size:"14",class:"me-1"}),i[37]||(i[37]=u(" Refresh HPP "))]),_:1,__:[37]},8,["loading"])])]),_:1,__:[38]})):!U.value&&o.editMode?(f(),B(Ke,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[l("div",Wl,[e(R,{size:"small",variant:"outlined",color:"info",onClick:i[7]||(i[7]=C=>K(M).push("/hpp-management"))},{default:t(()=>[e(w,{icon:"tabler-calculator",size:"14",class:"me-1"}),i[39]||(i[39]=u(" Lihat HPP Management "))]),_:1,__:[39]})])]),_:1})):j("",!0)]),_:1}),e(I,{cols:"12"},{default:t(()=>[E.price&&E.cost&&E.cost>0?(f(),B(Ke,{key:0,color:d(N.value),variant:"tonal",class:"mb-0"},{default:t(()=>[l("div",Gl,[l("div",Ql,[e(w,{icon:_(N.value)},null,8,["icon"]),i[40]||(i[40]=l("span",{class:"font-weight-medium"},"Profit Margin",-1))]),l("div",Xl,[l("div",Zl,n(Math.round(N.value))+"%",1),l("div",Yl," Keuntungan: "+n(G(E.price-E.cost)),1)])])]),_:1},8,["color"])):j("",!0)]),_:1}),e(I,{cols:"12"},{default:t(()=>[l("h6",eo,[e(w,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),i[41]||(i[41]=u(" Dimensi (cm) "))])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(be,{modelValue:de.length,"onUpdate:modelValue":i[8]||(i[8]=C=>de.length=C),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(be,{modelValue:de.width,"onUpdate:modelValue":i[9]||(i[9]=C=>de.width=C),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(be,{modelValue:de.height,"onUpdate:modelValue":i[10]||(i[10]=C=>de.height=C),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[l("h6",to,[e(w,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),i[42]||(i[42]=u(" Gambar Produk "))])]),_:1}),e(I,{cols:"12"},{default:t(()=>[l("div",ao,[o.imagePreview?(f(),Z("div",lo,[e(va,{src:o.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),l("div",oo,[e(R,{size:"small",color:"error",variant:"outlined",onClick:ne},{default:t(()=>i[43]||(i[43]=[u(" Hapus Gambar ")])),_:1,__:[43]})])])):j("",!0),e(pa,{"model-value":o.selectedImage,"onUpdate:modelValue":i[11]||(i[11]=C=>oe(Array.isArray(C)?C:[C])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),i[44]||(i[44]=l("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e(I,{cols:"12"},{default:t(()=>[l("h6",so,[e(w,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),i[45]||(i[45]=u(" Pengaturan "))])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(Fe,{"model-value":E.status,"onUpdate:modelValue":i[12]||(i[12]=C=>E.status=C),items:me,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(it,{"model-value":E.active,"onUpdate:modelValue":i[13]||(i[13]=C=>E.active=C??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(I,{cols:"12",md:"4"},{default:t(()=>[e(it,{"model-value":E.featured,"onUpdate:modelValue":i[14]||(i[14]=C=>E.featured=C??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[l("h6",io,[e(w,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),i[46]||(i[46]=u(" SEO (Opsional) "))])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(be,{modelValue:E.meta_title,"onUpdate:modelValue":i[15]||(i[15]=C=>E.meta_title=C),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(Ct,{modelValue:E.meta_description,"onUpdate:modelValue":i[16]||(i[16]=C=>E.meta_description=C),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(Sa,{"model-value":E.tags,"onUpdate:modelValue":i[17]||(i[17]=C=>E.tags=C),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Ue),e(Be,{class:"pa-6"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",class:"coffee-secondary",onClick:i[18]||(i[18]=C=>o.$emit("close"))},{default:t(()=>i[47]||(i[47]=[u(" Batal ")])),_:1,__:[47]}),e(R,{color:"primary",class:"coffee-primary",loading:o.loading,onClick:te},{default:t(()=>[u(n(o.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),o.useDialogError?j("",!0):(f(),B(et,{key:0,"model-value":!!X.value,"onUpdate:modelValue":i[20]||(i[20]=C=>!C&&o.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(R,{icon:"tabler-x",size:"small",variant:"text",onClick:i[19]||(i[19]=C=>o.$emit("clear-error"))})]),default:t(()=>[l("div",no,[e(w,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),l("div",null,[i[48]||(i[48]=l("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),l("div",ro,n(X.value),1)])])]),_:1},8,["model-value"])),o.useDialogError?(f(),B(Le,{key:1,"model-value":!!X.value,"onUpdate:modelValue":i[22]||(i[22]=C=>!C&&o.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center text-error"},{default:t(()=>[e(w,{icon:"tabler-alert-circle",class:"me-2"}),i[49]||(i[49]=u(" Error Occurred "))]),_:1,__:[49]}),e(Ue),e(le,{class:"py-4"},{default:t(()=>[l("div",uo,n(X.value),1)]),_:1}),e(Ue),e(Be,{class:"justify-end pa-4"},{default:t(()=>[e(R,{color:"error",variant:"outlined",onClick:i[21]||(i[21]=C=>o.$emit("clear-error"))},{default:t(()=>i[50]||(i[50]=[u(" Close ")])),_:1,__:[50]})]),_:1})]),_:1})]),_:1},8,["model-value"])):j("",!0),e(et,{"model-value":!!o.successMessage,"onUpdate:modelValue":i[24]||(i[24]=C=>!C&&o.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(R,{icon:"tabler-x",size:"small",variant:"text",onClick:i[23]||(i[23]=C=>o.$emit("clear-success"))})]),default:t(()=>[l("div",co,[e(w,{icon:"tabler-check-circle",class:"me-3",size:"28"}),l("div",null,[i[51]||(i[51]=l("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),l("div",mo,n(o.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),po=Oe(vo,[["__scopeId","data-v-da76a61d"]]),fo={key:0,class:"mt-4"},go={class:"d-flex align-center gap-2 mb-2"},_o={class:"d-flex flex-wrap gap-2"},ko=Re({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup($,{emit:ke}){const M=$,A=ke,{categories:O,loading:k,fetchAllCategories:W}=fa(),U=z(!1),g=z("");tt(async()=>{await W(),g.value=y.search||""});const y=gt({...M.filters});he(()=>M.filters,G=>{Object.assign(y,G),g.value=G.search||""},{deep:!0}),Zt(g,G=>{y.search=G,(G.length>=3||G.length===0)&&(U.value=!0,A("search",G),se(),setTimeout(()=>{U.value=!1},500))},{debounce:500,maxWait:1e3});const ee=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],h=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],X=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],ve=pe(()=>!!(g.value||y.category_id||y.active||y.stock_status||y.featured!==null||y.min_price||y.max_price)),se=()=>{A("update:filters",{...y})},E=()=>{g.value="",Object.assign(y,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),se()},de=G=>{const d=O.value.find(_=>_.id_category===G);return(d==null?void 0:d.name)||"Unknown"},me=G=>{if(!G)return"Semua";const d=ee.find(_=>_.value===G);return(d==null?void 0:d.title)||String(G)},N=G=>{const d=h.find(_=>_.value===G);return(d==null?void 0:d.title)||G};return(G,d)=>(f(),B(Y,{class:"mb-6"},{default:t(()=>[e(xe,{class:"d-flex align-center gap-2"},{default:t(()=>[e(w,{icon:"tabler-filter",class:"coffee-icon"}),d[11]||(d[11]=u(" Filter & Pencarian Produk "))]),_:1,__:[11]}),e(le,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(I,{cols:"12",md:"4"},{default:t(()=>[e(be,{modelValue:g.value,"onUpdate:modelValue":d[0]||(d[0]=_=>g.value=_),label:"Cari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:U.value,clearable:"",variant:"outlined",hint:g.value.length>0&&g.value.length<3?`Ketik ${3-g.value.length} karakter lagi untuk mencari`:"","persistent-hint":""},null,8,["modelValue","loading","hint"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:y.category_id,"onUpdate:modelValue":[d[1]||(d[1]=_=>y.category_id=_),se],items:K(O),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:K(k),clearable:"",variant:"outlined"},{"no-data":t(()=>[e(je,null,{default:t(()=>[e(Ye,null,{default:t(()=>[u(n(K(k)?"Memuat kategori...":"Tidak ada kategori"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(Fe,{modelValue:y.active,"onUpdate:modelValue":[d[2]||(d[2]=_=>y.active=_),se],items:ee,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(Fe,{modelValue:y.stock_status,"onUpdate:modelValue":[d[3]||(d[3]=_=>y.stock_status=_),se],items:h,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(R,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:E})]),_:1})]),_:1}),e(Pe,{class:"mt-3"},{default:t(()=>[e(I,{cols:"12",md:"3"},{default:t(()=>[e(be,{modelValue:y.min_price,"onUpdate:modelValue":d[4]||(d[4]=_=>y.min_price=_),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:se},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(be,{modelValue:y.max_price,"onUpdate:modelValue":d[5]||(d[5]=_=>y.max_price=_),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:se},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(Fe,{modelValue:y.sort_order,"onUpdate:modelValue":[d[6]||(d[6]=_=>y.sort_order=_),se],items:X,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),ve.value?(f(),Z("div",fo,[l("div",go,[e(w,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),d[12]||(d[12]=l("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),l("div",_o,[g.value?(f(),B(ce,{key:0,closable:"",size:"small",color:"coffee","onClick:close":d[7]||(d[7]=_=>{g.value="",y.search="",se()})},{default:t(()=>[u(" Pencarian: "+n(g.value),1)]),_:1})):j("",!0),y.category_id?(f(),B(ce,{key:1,closable:"",size:"small",color:"coffee","onClick:close":d[8]||(d[8]=_=>{y.category_id=null,se()})},{default:t(()=>[u(" Kategori: "+n(de(y.category_id)),1)]),_:1})):j("",!0),y.active?(f(),B(ce,{key:2,closable:"",size:"small",color:"coffee","onClick:close":d[9]||(d[9]=_=>{y.active=null,se()})},{default:t(()=>[u(" Status: "+n(me(y.active)),1)]),_:1})):j("",!0),y.stock_status?(f(),B(ce,{key:3,closable:"",size:"small",color:"coffee","onClick:close":d[10]||(d[10]=_=>{y.stock_status=null,se()})},{default:t(()=>[u(" Stok: "+n(N(y.stock_status)),1)]),_:1})):j("",!0)])])):j("",!0)]),_:1})]),_:1}))}}),yo=Oe(ko,[["__scopeId","data-v-a79393fb"]]),bo={class:"d-flex align-center gap-2"},ho={class:"text-h6"},xo={class:"d-flex align-center gap-2"},wo={class:"text-h6"},Po={class:"d-flex align-center gap-2"},Vo={class:"text-h6"},Co={class:"d-flex align-center gap-2"},$o={class:"text-h6"},So={class:"d-flex align-center gap-2"},Io={class:"text-h6"},Do={class:"d-flex align-center gap-2"},zo={class:"text-h6"},Uo={class:"d-flex align-center gap-2"},To={class:"text-h6"},Ao={class:"d-flex align-center gap-2"},Ho={class:"text-h6"},Mo=Re({__name:"ProductStatsCards",props:{stats:{}},setup($){const ke=A=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(A),M=A=>`${A.toFixed(1)}%`;return(A,O)=>(f(),B(Pe,{class:"mb-6"},{default:t(()=>[e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Ve,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(w,{icon:"tabler-package"})]),_:1}),l("div",null,[O[0]||(O[0]=l("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),l("div",bo,[l("h6",ho,n(((k=A.stats)==null?void 0:k.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Ve,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(w,{icon:"tabler-check"})]),_:1}),l("div",null,[O[1]||(O[1]=l("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),l("div",xo,[l("h6",wo,n(((k=A.stats)==null?void 0:k.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Ve,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(w,{icon:"tabler-star"})]),_:1}),l("div",null,[O[2]||(O[2]=l("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),l("div",Po,[l("h6",Vo,n(((k=A.stats)==null?void 0:k.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Ve,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(w,{icon:"tabler-alert-triangle"})]),_:1}),l("div",null,[O[3]||(O[3]=l("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),l("div",Co,[l("h6",$o,n(((k=A.stats)==null?void 0:k.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Ve,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(w,{icon:"tabler-currency-dollar"})]),_:1}),l("div",null,[O[4]||(O[4]=l("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),l("div",So,[l("h6",Io,n(ke(((k=A.stats)==null?void 0:k.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Ve,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(w,{icon:"tabler-chart-line"})]),_:1}),l("div",null,[O[5]||(O[5]=l("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),l("div",Do,[l("h6",zo,n(ke(((k=A.stats)==null?void 0:k.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Ve,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(w,{icon:"tabler-trending-up"})]),_:1}),l("div",null,[O[6]||(O[6]=l("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),l("div",Uo,[l("h6",To,n(M(((k=A.stats)==null?void 0:k.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(I,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(le,{class:"d-flex align-center"},{default:t(()=>{var k;return[e(Ve,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e(w,{icon:"tabler-x-circle"})]),_:1}),l("div",null,[O[7]||(O[7]=l("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),l("div",Ao,[l("h6",Ho,n(((k=A.stats)==null?void 0:k.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),Ko=Oe(Mo,[["__scopeId","data-v-124783ae"]]),Fo={class:"d-flex align-center gap-2"},Eo={class:"d-flex align-center gap-2"},Bo={class:"text-center py-8"},Ro={class:"d-flex align-center gap-3 py-2"},qo={class:"font-weight-medium"},Lo={class:"text-caption text-medium-emphasis"},No={class:"text-end"},Oo={class:"font-weight-medium"},jo={class:"text-caption text-medium-emphasis d-flex align-center justify-end gap-1"},Jo={class:"text-center profit-margin-container"},Wo={class:"text-center"},Go={key:0,class:"text-caption text-medium-emphasis mt-1"},Qo={class:"d-flex align-center gap-2"},Xo={class:"text-body-2"},Zo={class:"text-caption text-medium-emphasis"},Yo={class:"d-flex align-center gap-1"},es=300*1e3,ts=1e3,as=Re({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","bulk-delete","update:page","update:items-per-page","update:sort-by","update:selected-products"],setup($,{expose:ke}){const M=$,{currentHPPBreakdown:A,getProductHPPBreakdown:O}=_t(),k=z({}),W=z({}),U=z({}),g=z(new Set),y=z(new Set);let ee=null;const h=m=>{const x=U.value[m];return x?Date.now()-x.timestamp<es:!1},X=async()=>{if(y.value.size===0)return;const m=Array.from(y.value);y.value.clear();const x=m.filter(v=>{const D=M.products.find(te=>(te.id_product||te.id)===v);return D&&(D.hpp===void 0||D.hpp===null)});if(x.length===0)return;const s=3;for(let v=0;v<x.length;v+=s){const te=x.slice(v,v+s).map(async oe=>{var ne;if(!(W.value[oe]||h(oe))){W.value[oe]=!0,g.value.add(oe);try{if(await O(oe,"latest"),(ne=A.value)!=null&&ne.total_hpp){const q=A.value.total_hpp;k.value[oe]=q,U.value[oe]={data:q,timestamp:Date.now(),attempted:!0}}else U.value[oe]={data:0,timestamp:Date.now(),attempted:!0}}catch(q){console.warn(`Could not load HPP for product ${oe}:`,q),U.value[oe]={data:0,timestamp:Date.now(),attempted:!0}}finally{W.value[oe]=!1}}});await Promise.all(te),v+s<m.length&&await new Promise(oe=>setTimeout(oe,500))}},ve=m=>{if(h(m)){k.value[m]=U.value[m].data;return}g.value.has(m)||(y.value.add(m),ee&&clearTimeout(ee),ee=setTimeout(()=>{X()},ts))},se=()=>{for(const m of M.products){const x=m.id_product||m.id;x&&(h(x)?k.value[x]=U.value[x].data:!g.value.has(x)&&!W.value[x]&&ve(x))}},E=m=>{const x=m.id_product||m.id;return k.value[x]||m.cost||0},de=m=>{const x=E(m),s=m.price||0;return s<=0||x<=0?0:Math.round((s-x)/s*100)};Yt(()=>{M.products&&M.products.length>0&&se()}),tt(()=>{M.products&&M.products.length>0&&se()}),ke({refreshHPPData:async m=>{m?(delete U.value[m],delete k.value[m],g.value.delete(m),M.products.find(s=>(s.id_product||s.id)===m)&&ve(m)):(U.value={},k.value={},g.value.clear(),y.value.clear(),se())}});const N=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],G=m=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),d=m=>new Date(m).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),_=m=>new Date(m).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),T=m=>m<10?"error":m<25?"warning":m<50?"success":"info";return(m,x)=>(f(),B(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",Fo,[e(w,{icon:"tabler-list",class:"coffee-icon"}),x[7]||(x[7]=u(" Data Produk ")),m.totalItems?(f(),B(ce,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[u(n(m.totalItems)+" item ",1)]),_:1})):j("",!0)]),l("div",Eo,[m.selectedProducts.length>0?(f(),B(R,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:x[0]||(x[0]=s=>m.$emit("bulk-delete"))},{default:t(()=>[u(" Hapus Terpilih ("+n(m.selectedProducts.length)+") ",1)]),_:1})):j("",!0),e(R,{"prepend-icon":"tabler-plus",color:"coffee",onClick:x[1]||(x[1]=s=>m.$emit("add-product"))},{default:t(()=>x[8]||(x[8]=[u(" Tambah Produk ")])),_:1,__:[8]})])]),_:1}),e(Ue),e(xa,{"model-value":m.selectedProducts,"onUpdate:modelValue":x[3]||(x[3]=s=>m.$emit("update:selected-products",s)),headers:N,items:m.products,"items-length":m.totalItems,loading:m.loading,"items-per-page":m.itemsPerPage,page:m.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:page":x[4]||(x[4]=s=>m.$emit("update:page",s)),"onUpdate:itemsPerPage":x[5]||(x[5]=s=>m.$emit("update:items-per-page",s)),"onUpdate:sortBy":x[6]||(x[6]=s=>m.$emit("update:sort-by",s))},{loading:t(()=>[e(wa,{type:"table-row@10"})]),"no-data":t(()=>[l("div",Bo,[e(w,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),x[10]||(x[10]=l("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),x[11]||(x[11]=l("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(R,{"prepend-icon":"tabler-plus",color:"coffee",onClick:x[2]||(x[2]=s=>m.$emit("add-product"))},{default:t(()=>x[9]||(x[9]=[u(" Tambah Produk Pertama ")])),_:1,__:[9]})])]),"item.name":t(({item:s})=>[l("div",Ro,[e(Ve,{image:s.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[s.image_url?j("",!0):(f(),B(w,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),l("div",null,[l("div",qo,n(s.name),1),l("div",Lo," SKU: "+n(s.sku||"-"),1)])])]),"item.category":t(({item:s})=>[e(ce,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var v;return[u(n(((v=s.category)==null?void 0:v.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:s})=>[l("div",No,[l("div",Oo,n(G(s.price)),1),l("div",jo,[l("span",null,"HPP: "+n(G(E(s))),1),W.value[s.id_product||s.id]&&E(s)>0?(f(),B(dt,{key:0,indeterminate:"",size:"12",width:"2"})):j("",!0)])])]),"item.profit_margin":t(({item:s})=>[l("div",Jo,[e(ce,{color:T(de(s)),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[u(n(de(s))+"% ",1)]),_:2},1032,["color"])])]),"item.stock":t(({item:s})=>[l("div",Wo,[e(ce,{color:s.stock_status==="out_of_stock"?"error":s.stock_status==="low_stock"?"warning":"success",size:"small",variant:"tonal"},{default:t(()=>[u(n(s.stock_status==="out_of_stock"?"Habis":s.stock_status==="low_stock"?"Rendah":"Aman"),1)]),_:2},1032,["color"]),s.min_stock?(f(),Z("div",Go," Min: "+n(s.min_stock),1)):j("",!0)])]),"item.active":t(({item:s})=>[l("div",Qo,[e(ce,{color:s.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[u(n(s.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),s.featured?(f(),B(Me,{key:0,text:"Produk Unggulan"},{activator:t(({props:v})=>[e(w,we(v,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):j("",!0)])]),"item.created_at":t(({item:s})=>[l("div",Xo,n(d(s.created_at??"")),1),l("div",Zo,n(_((s==null?void 0:s.created_at)??"")),1)]),"item.actions":t(({item:s})=>[l("div",Yo,[e(Me,{text:"Kelola Komposisi"},{activator:t(({props:v})=>[e(R,we(v,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:D=>m.$emit("open-composition-dialog",s)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Kelola Variant"},{activator:t(({props:v})=>[e(R,we(v,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:D=>m.$emit("open-variant-dialog",s)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Edit Produk"},{activator:t(({props:v})=>[e(R,we(v,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:D=>m.$emit("edit-product",s)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:s.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:v})=>{var D;return[e(R,we(v,{icon:s.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:s.active?"success":"error",loading:((D=m.toggleLoading)==null?void 0:D[s.id_product])||!1,onClick:te=>m.$emit("toggle-active",s)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Me,{text:s.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:v})=>[e(R,we(v,{icon:s.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:s.featured?"warning":"default",onClick:D=>m.$emit("toggle-featured",s)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Me,{text:"Hapus Produk"},{activator:t(({props:v})=>[e(R,we(v,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:D=>m.$emit("delete-product",s)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),ls=Oe(as,[["__scopeId","data-v-0df0c22e"]]),os={class:"d-flex align-center gap-3"},ss={class:"text-h5 font-weight-bold"},is={class:"text-h6"},ns={class:"text-body-1"},rs={class:"d-flex flex-column"},us={class:"font-weight-medium"},ds={class:"text-caption text-grey-darken-1"},cs={class:"font-weight-medium"},ms={key:0,class:"text-caption"},vs={key:1,class:"text-grey-lighten-1 text-caption"},ps={class:"v-data-table__footer"},fs={class:"pa-4 d-flex justify-space-between align-center"},gs={class:"text-subtitle-1 font-weight-bold"},_s={class:"text-subtitle-2 text-uppercase"},ks={class:"text-h6 font-weight-bold my-2"},ys={class:"text-caption"},Ut=Re({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup($,{emit:ke}){const M=$,A=ke,O=z(!1),k=z(null),W=z(null),U=z(!1),g=z(!1),y=z("latest"),ee=z(0),h=z(0),X=z(""),ve=z(0),se=z(!1),E=z(!1),de=z(""),me=z(""),N=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],G=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],d=q=>!q||q===0?"":new Intl.NumberFormat("id-ID").format(q),_=q=>{if(!q)return 0;const S=q.replace(/[^\d]/g,"");return parseInt(S)||0},T=q=>{var c;const S=_(q);if(h.value=S,X.value=d(S),(c=k.value)!=null&&c.total_hpp&&S>0){const o=k.value.total_hpp;ee.value=o>0?Math.round((S-o)/o*100):0}else ee.value=0},m=q=>Ae(q),x=async(q,S)=>{O.value=!0;try{await new Promise(c=>setTimeout(c,500)),k.value={total_hpp:15e4,method:S,calculated_at:new Date().toISOString(),items:[{item_name:"Tepung Terigu",item_code:"TPNG001",quantity_needed:.5,unit:"kg",cost_per_unit:15e3,total_cost:7500,is_critical:!1,notes:null},{item_name:"Gula Pasir",item_code:"GUL001",quantity_needed:.25,unit:"kg",cost_per_unit:12e3,total_cost:3e3,is_critical:!1,notes:null},{item_name:"Telur Ayam",item_code:"TLR001",quantity_needed:3,unit:"pcs",cost_per_unit:3e3,total_cost:9e3,is_critical:!0,notes:"Price volatile"}]},U.value=!0}catch(c){console.error("Error loading HPP breakdown:",c),U.value=!1}finally{O.value=!1}},s=async(q,S)=>{O.value=!0;try{if(await new Promise(c=>setTimeout(c,1e3)),k.value){switch(S){case"latest":k.value.total_hpp=Math.round(k.value.total_hpp*1.1);break;case"average":k.value.total_hpp=Math.round(k.value.total_hpp*1.05);break;default:k.value.total_hpp=Math.round(k.value.total_hpp*1.03)}k.value.calculated_at=new Date().toISOString()}}catch(c){throw c}finally{O.value=!1}},v=async(q,S,c,o,i)=>{O.value=!0;try{return await new Promise(C=>setTimeout(C,1e3)),{data:{new_price:c,markup_percentage:k.value?Math.round((c-k.value.total_hpp)/k.value.total_hpp*100):0}}}catch(C){throw C}finally{O.value=!1}},D=async()=>{var q,S,c;if(M.variantId)try{const o=localStorage.getItem("token"),i=await qe.get(`/api/variants/${M.variantId}`,{headers:{Authorization:`Bearer ${o}`,Accept:"application/json"}});if(i.data.success&&i.data.data){const C=i.data.data;if(C.price&&C.price>0)h.value=Number(C.price),X.value=d(Number(C.price));else if((q=k.value)!=null&&q.total_hpp){const fe=Math.round(k.value.total_hpp*1.2);h.value=fe,X.value=d(fe)}if((S=k.value)!=null&&S.total_hpp&&h.value>0){const fe=k.value.total_hpp;ee.value=fe>0?Math.round((h.value-fe)/fe*100):0}ve.value+=1}}catch(o){console.warn("Could not load target price, using default:",o),(c=k.value)!=null&&c.total_hpp&&(h.value=Math.round(k.value.total_hpp*1.2))}},te=async()=>{M.variantId&&(await x(M.variantId,y.value),await D())},oe=async()=>{var q,S;if(M.variantId)try{await s(M.variantId,y.value),de.value=`HPP successfully updated using ${y.value} method!`,se.value=!0,A("hpp-updated"),await te()}catch(c){console.error("Error updating HPP:",c),me.value=((S=(q=c==null?void 0:c.response)==null?void 0:q.data)==null?void 0:S.message)||"Failed to update HPP",E.value=!0}},ne=async()=>{var q,S,c,o,i,C,fe,J,_e,De;if(M.variantId&&((q=k.value)!=null&&q.total_hpp)&&h.value)try{const ae=await v(M.variantId,y.value,h.value,!0,!0);if((S=ae==null?void 0:ae.data)!=null&&S.new_price){if(h.value=ae.data.new_price,X.value=d(ae.data.new_price),((c=ae==null?void 0:ae.data)==null?void 0:c.markup_percentage)!==void 0)ee.value=ae.data.markup_percentage;else{const He=k.value.total_hpp;ee.value=He>0?Math.round((ae.data.new_price-He)/He*100):0}ve.value+=1,await ft()}M.variantId&&await x(M.variantId,y.value),de.value=`Price successfully updated to ${m(((o=ae==null?void 0:ae.data)==null?void 0:o.new_price)||h.value)}!`,se.value=!0,A("price-updated",{variantId:M.variantId,oldPrice:(i=ae==null?void 0:ae.data)==null?void 0:i.old_price,newPrice:(C=ae==null?void 0:ae.data)==null?void 0:C.new_price,hpp:(fe=ae==null?void 0:ae.data)==null?void 0:fe.hpp,markupPercentage:(J=ae==null?void 0:ae.data)==null?void 0:J.markup_percentage})}catch(ae){console.error("Error applying price suggestion:",ae),me.value=((De=(_e=ae==null?void 0:ae.response)==null?void 0:_e.data)==null?void 0:De.message)||"Failed to update variant price",E.value=!0}};return he(()=>M.modelValue,q=>{q&&M.variantId&&te()}),he(()=>M.variantId,q=>{q&&M.modelValue&&te()}),he(y,async()=>{M.variantId&&await te()}),he([()=>{var q;return(q=k.value)==null?void 0:q.total_hpp},h],()=>{var q;if((q=k.value)!=null&&q.total_hpp&&h.value>0){const S=k.value.total_hpp;ee.value=S>0?Math.round((h.value-S)/S*100):0}else ee.value=0}),he(h,q=>{q!==_(X.value)&&(X.value=d(q))}),(q,S)=>(f(),Z(ze,null,[e(Le,{"model-value":q.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":S[6]||(S[6]=c=>q.$emit("update:modelValue",c))},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",os,[e(w,{icon:"mdi-calculator-variant",size:"24"}),l("span",null,"HPP Breakdown - "+n(q.variantName||"Variant"),1)]),e(R,{icon:"mdi-close",size:"small",variant:"text",onClick:S[0]||(S[0]=c=>q.$emit("update:modelValue",!1))})]),_:1}),e(le,null,{default:t(()=>[e(Pe,{class:"mb-4"},{default:t(()=>[e(I,{cols:"12",md:"6"},{default:t(()=>[e(Fe,{modelValue:y.value,"onUpdate:modelValue":[S[1]||(S[1]=c=>y.value=c),te],items:N,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>[e(R,{color:"primary",variant:"elevated",loading:O.value,"prepend-icon":"mdi-update",block:"",onClick:oe},{default:t(()=>[u(" Update HPP with "+n(y.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),U.value?(f(),B(Y,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(le,null,{default:t(()=>[e(Pe,{align:"center"},{default:t(()=>[e(I,{cols:"12",md:"4"},{default:t(()=>{var c;return[S[11]||(S[11]=l("div",{class:"text-subtitle-2"}," Total HPP ",-1)),l("div",ss,n(m(((c=k.value)==null?void 0:c.total_hpp)||0)),1)]}),_:1,__:[11]}),e(I,{cols:"12",md:"4"},{default:t(()=>{var c;return[S[12]||(S[12]=l("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),l("div",is,n((c=N.find(o=>{var i;return o.value===((i=k.value)==null?void 0:i.method)}))==null?void 0:c.title),1)]}),_:1,__:[12]}),e(I,{cols:"12",md:"4"},{default:t(()=>{var c;return[S[13]||(S[13]=l("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),l("div",ns,n((c=k.value)!=null&&c.calculated_at?new Date(k.value.calculated_at).toLocaleString():"-"),1)]}),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):j("",!0),U.value?(f(),B(Y,{key:1},{default:t(()=>{var c;return[e(xe,null,{default:t(()=>{var o,i;return[e(w,{icon:"mdi-format-list-bulleted",class:"me-2"}),u(" Item Breakdown ("+n(((i=(o=k.value)==null?void 0:o.items)==null?void 0:i.length)||0)+" items) ",1)]}),_:1}),e(Pa,{headers:G,items:((c=k.value)==null?void 0:c.items)||[],"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:o})=>[l("div",rs,[l("span",us,n(o.item_name),1),l("span",ds,n(o.item_code),1)])]),"item.quantity_needed":t(({item:o})=>[l("span",cs,n(o.quantity_needed)+" "+n(o.unit),1)]),"item.cost_per_unit":t(({item:o})=>[l("span",null,n(m(o.cost_per_unit)),1)]),"item.total_cost":t(({item:o})=>[e(ce,{color:o.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[u(n(m(o.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:o})=>[e(ce,{color:o.is_critical?"error":"success","prepend-icon":o.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[u(n(o.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:o})=>[o.notes?(f(),Z("span",ms,n(o.notes),1)):(f(),Z("span",vs,"â"))]),bottom:t(()=>{var o;return[l("div",ps,[e(Ue),l("div",fs,[l("div",gs," Total HPP: "+n(m(((o=k.value)==null?void 0:o.total_hpp)||0)),1),e(ce,{color:"info",variant:"elevated"},{default:t(()=>{var i,C;return[u(n(((C=(i=k.value)==null?void 0:i.items)==null?void 0:C.length)||0)+" items ",1)]}),_:1})])])]}),_:1},8,["items"])]}),_:1})):j("",!0),U.value?(f(),B(Y,{key:2,class:"mt-4"},{default:t(()=>[e(xe,null,{default:t(()=>[e(w,{icon:"mdi-cash-multiple",class:"me-2"}),S[14]||(S[14]=u(" Price Suggestion "))]),_:1,__:[14]}),e(le,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(I,{cols:"12",md:"6"},{default:t(()=>{var c;return[(f(),B(be,{key:ve.value,modelValue:X.value,"onUpdate:modelValue":[S[2]||(S[2]=o=>X.value=o),T],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${m(((c=k.value)==null?void 0:c.total_hpp)||0)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1}),e(I,{cols:"12",md:"6"},{default:t(()=>{var c;return[(f(),B(be,{key:ve.value,modelValue:ee.value,"onUpdate:modelValue":S[3]||(S[3]=o=>ee.value=o),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${m(h.value-(((c=k.value)==null?void 0:c.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e(Pe,{class:"mt-2"},{default:t(()=>[e(I,{cols:"12",md:"12"},{default:t(()=>[e(R,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:O.value,disabled:!h.value||h.value<=0,block:"",onClick:ne},{default:t(()=>S[15]||(S[15]=[u(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):j("",!0),g.value?(f(),B(Y,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(xe,null,{default:t(()=>[e(w,{icon:"mdi-lightbulb",class:"me-2"}),S[16]||(S[16]=u(" Price Suggestions "))]),_:1,__:[16]}),e(le,null,{default:t(()=>[e(Pe,null,{default:t(()=>[(f(!0),Z(ze,null,Je(W.value.suggestions,(c,o)=>(f(),B(I,{key:o,cols:"12",md:"4"},{default:t(()=>[e(Y,{variant:"elevated"},{default:t(()=>[e(le,{class:"text-center"},{default:t(()=>[l("div",_s,n(o)+" Method ",1),l("div",ks,n(m(c.suggested_price)),1),l("div",ys,[u(" HPP: "+n(m(c.hpp)),1),S[17]||(S[17]=l("br",null,null,-1)),u(" Markup: "+n(c.markup_percentage.toFixed(1))+"%",1),S[18]||(S[18]=l("br",null,null,-1)),u(" Margin: "+n(c.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):j("",!0),!U.value&&!O.value?(f(),B(Y,{key:4,variant:"outlined"},{default:t(()=>[e(le,{class:"text-center py-8"},{default:t(()=>[e(w,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),S[20]||(S[20]=l("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),S[21]||(S[21]=l("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:S[4]||(S[4]=c=>q.$emit("update:modelValue",!1))},{default:t(()=>S[19]||(S[19]=[u(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):j("",!0)]),_:1}),e(Be,{class:"pa-4"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:S[5]||(S[5]=c=>q.$emit("update:modelValue",!1))},{default:t(()=>S[22]||(S[22]=[u(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(et,{modelValue:se.value,"onUpdate:modelValue":S[8]||(S[8]=c=>se.value=c),color:"success",location:"top"},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:S[7]||(S[7]=c=>se.value=!1)},{default:t(()=>S[23]||(S[23]=[u(" Close ")])),_:1,__:[23]})]),default:t(()=>[u(n(de.value)+" ",1)]),_:1},8,["modelValue"]),e(et,{modelValue:E.value,"onUpdate:modelValue":S[10]||(S[10]=c=>E.value=c),color:"error",location:"top"},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:S[9]||(S[9]=c=>E.value=!1)},{default:t(()=>S[24]||(S[24]=[u(" Close ")])),_:1,__:[24]})]),default:t(()=>[u(n(me.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),bs={class:"d-flex align-center gap-2"},hs={class:"pa-4",style:{"background-color":"#2A2A2A"}},xs={key:0,class:"d-flex align-center gap-3"},ws={class:"text-h6 text-white font-weight-bold"},Ps={class:"d-flex align-center gap-4 mt-1"},Vs={class:"text-caption text-grey-lighten-1"},Cs={class:"text-caption text-grey-lighten-1"},$s={class:"pa-4 add-item-form"},Ss={class:"d-flex align-center justify-space-between mb-4"},Is={class:"d-flex align-center gap-2"},Ds={class:"text-h6"},zs={key:0,class:"text-error"},Us={key:1},Ts={class:"d-flex align-center"},As={class:"pa-4 text-center"},Hs={class:"pa-4 pt-0"},Ms={class:"d-flex align-center justify-between mb-4"},Ks={class:"text-h6"},Fs={key:0,class:"composition-list"},Es={class:"d-flex align-center justify-between"},Bs={class:"d-flex align-center gap-3"},Rs={class:"font-weight-medium"},qs={class:"text-caption text-medium-emphasis"},Ls={class:"font-weight-medium text-primary"},Ns={class:"d-flex align-center gap-2"},Os={class:"text-center"},js={key:0,class:"text-body-2 text-medium-emphasis"},Js={class:"text-center"},Ws={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},Gs=Re({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup($,{emit:ke}){const M=$,A=ke,O=z(),k=z(!1),W=z(!1),U=z([]),g=z([]),y=z(!1),ee=z(null),h=z(!1),X=z(null),ve=z(!1),se=z(!1),E=z(""),de=z(""),me=z("success"),N=z(!1),G=pe({get:()=>M.modelValue,set:r=>{A("update:modelValue",r)}}),d=()=>({item_id:null,quantity:1,is_critical:!1}),_=z(d()),T=pe(()=>!_.value.item_id||!Array.isArray(U.value)?null:U.value.find(r=>r.id_item===_.value.item_id)),m=pe(()=>!T.value||y.value&&ee.value!==null?null:g.value.find(r=>{var a,p;return r.name===((a=T.value)==null?void 0:a.name)||r.id&&((p=T.value)==null?void 0:p.id_item)&&r.id===T.value.id_item})),x=pe(()=>{if(!T.value)return"";if(y.value&&ee.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(m.value){const r=m.value;return`Item sudah ada dengan quantity ${r.quantity} ${r.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${v(T.value)} ${T.value.unit}`}),s=pe(()=>Array.isArray(U.value)?U.value.filter(r=>v(r)>0):[]),v=r=>{var a,p;return((a=r.inventory)==null?void 0:a.current_stock)||((p=r.inventory)==null?void 0:p.available_stock)||r.current_stock||0},D=()=>W.value?"Memuat items...":!U.value||U.value.length===0?"Tidak ada item tersedia":s.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",te=r=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(r),oe=r=>{switch(r){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},ne=r=>{switch(r){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},q=(r,a,p)=>{var P,re,ue,ye,ie,$e,Se,Te;if(!a)return!0;const F=a.toLowerCase().trim(),H=((re=(P=p==null?void 0:p.raw)==null?void 0:P.name)==null?void 0:re.toLowerCase())||"",V=((ye=(ue=p==null?void 0:p.raw)==null?void 0:ue.item_code)==null?void 0:ye.toLowerCase())||"",b=(($e=(ie=p==null?void 0:p.raw)==null?void 0:ie.unit)==null?void 0:$e.toLowerCase())||"",L=((Te=(Se=p==null?void 0:p.raw)==null?void 0:Se.description)==null?void 0:Te.toLowerCase())||"";return H.includes(F)||V.includes(F)||b.includes(F)||L.includes(F)},S=async()=>{var r,a,p;W.value=!0;try{const F=await qe.get("/api/items?per_page=all&include=inventory"),H=((a=(r=F.data)==null?void 0:r.data)==null?void 0:a.data)||((p=F.data)==null?void 0:p.data)||F.data||[];U.value=Array.isArray(H)?H:[]}catch(F){console.error("Error loading items:",F),F!=null&&F.response&&(console.error("API Error Status:",F.response.status),console.error("API Error Data:",F.response.data)),U.value=[]}finally{W.value=!1}},c=async()=>{var r,a,p,F,H;if(!(!((r=M.variant)!=null&&r.id)&&!((a=M.variant)!=null&&a.id_variant)))try{const V=M.variant.id||M.variant.id_variant,b=await qe.get(`/api/variant-items/variant/${V}`),L=((F=(p=b.data)==null?void 0:p.data)==null?void 0:F.composition)||((H=b.data)==null?void 0:H.composition)||[];if(!Array.isArray(L)){console.warn("API response composition is not an array:",L),g.value=[];return}g.value=L.map(P=>{var re,ue,ye,ie,$e,Se,Te,Xe,Ze,nt;return{id:P.id_variant_item||P.id,name:((re=P.item)==null?void 0:re.name)||P.name,quantity:parseFloat(P.quantity_needed||P.quantity||P.qty||"1"),unit:P.unit||((ue=P.item)==null?void 0:ue.unit)||"pcs",stock:((ie=(ye=P.item)==null?void 0:ye.inventory)==null?void 0:ie.current_stock)||((Se=($e=P.item)==null?void 0:$e.inventory)==null?void 0:Se.available_stock)||((Te=P.item)==null?void 0:Te.current_stock)||P.stock||0,price:parseFloat(((Xe=P.item)==null?void 0:Xe.cost_per_unit)||((Ze=P.item)==null?void 0:Ze.price)||P.price||"0"),is_critical:P.is_critical||!1,inventory:(nt=P.item)!=null&&nt.inventory?{current_stock:P.item.inventory.current_stock||0,available_stock:P.item.inventory.available_stock||0,stock_status:P.item.inventory.stock_status||"unknown",reorder_level:P.item.inventory.reorder_level||0}:null}})}catch(V){console.error("Error loading composition items:",V),V!=null&&V.response&&(console.error("API Error Status:",V.response.status),console.error("API Error Data:",V.response.data)),g.value=[]}},o=async()=>{var H,V;const{valid:r}=await O.value.validate();if(!r||!T.value)return;const a=T.value.name,p=T.value.id_item,F=_.value.quantity;if(y.value&&ee.value!==null)g.value[ee.value].quantity,g.value[ee.value].quantity=F,g.value[ee.value].is_critical=_.value.is_critical,y.value=!1,ee.value=null;else{const b=g.value.findIndex(L=>L.name===a||L.id&&p&&L.id===p);if(b!==-1){const re=g.value[b].quantity+F;g.value[b].quantity=re}else{const L={name:a,quantity:F,unit:T.value.unit,stock:((H=T.value.inventory)==null?void 0:H.current_stock)||((V=T.value.inventory)==null?void 0:V.available_stock)||T.value.current_stock||0,price:T.value.cost_per_unit||0,is_critical:_.value.is_critical,inventory:T.value.inventory?{current_stock:T.value.inventory.current_stock||0,available_stock:T.value.inventory.available_stock||0,stock_status:T.value.inventory.stock_status||"unknown",reorder_level:T.value.inventory.reorder_level||0}:null};g.value.push(L)}}_.value=d()},i=(r,a)=>{const p=U.value.find(F=>F.name===r.name||F.id_item===r.id);p?(y.value=!0,ee.value=a,_.value={item_id:p.id_item,quantity:r.quantity,is_critical:r.is_critical||!1},setTimeout(()=>{const F=document.querySelector(".add-item-form");F&&F.scrollIntoView({behavior:"smooth",block:"start"})},100)):console.error("â Could not find item in available items")},C=()=>{y.value=!1,ee.value=null,_.value=d()},fe=(r,a)=>{X.value={item:r,index:a},h.value=!0},J=async()=>{var F,H,V;if(!X.value)return;const{item:r,index:a}=X.value;r.name;const p=r.id;ve.value=!0;try{p&&await qe.delete(`/api/variant-items/${p}`),h.value=!1,X.value=null,await c(),A("save")}catch(b){console.error("â Error deleting item:",b),console.error("â Error details:",(F=b.response)==null?void 0:F.data),alert("Gagal menghapus item: "+(((V=(H=b.response)==null?void 0:H.data)==null?void 0:V.message)||b.message))}finally{ve.value=!1}},_e=()=>{h.value=!1,X.value=null},De=()=>{switch(me.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},ae=()=>{switch(me.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},He=()=>{switch(me.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},Ce=()=>{switch(me.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Ge=async()=>{var r,a,p,F;if(!((r=M.variant)!=null&&r.id)&&!((a=M.variant)!=null&&a.id_variant)){console.error("No variant ID found");return}k.value=!0;try{const H=M.variant.id||M.variant.id_variant;if(g.value.some(b=>b.id)){const b={items:g.value.map(P=>{const re=U.value.find(ue=>ue.name===P.name);return{id_variant_item:P.id,quantity_needed:Number(P.quantity),unit:P.unit,is_critical:P.is_critical||!1}}).filter(P=>P.id_variant_item&&P.quantity_needed>0)},L=await qe.post("/api/variant-items/bulk-update",b)}else{const b={id_variant:H,items:g.value.map(P=>{const re=U.value.find(ue=>ue.name===P.name);return{id_item:re==null?void 0:re.id_item,quantity_needed:Number(P.quantity),unit:P.unit,is_critical:P.is_critical||!1}}).filter(P=>P.id_item&&P.quantity_needed>0)},L=await qe.post("/api/variant-items/bulk-store",b)}A("save"),Ee()}catch(H){console.error("Error saving composition:",H),alert("Gagal menyimpan komposisi: "+(((F=(p=H.response)==null?void 0:p.data)==null?void 0:F.message)||H.message))}finally{k.value=!1}},Qe=()=>{N.value=!0},Ee=()=>{G.value=!1,_.value=d(),g.value=[],y.value=!1,ee.value=null};return he(()=>M.modelValue,r=>{r?(_.value=d(),S(),c()):(y.value=!1,ee.value=null)}),he(()=>_.value.item_id,r=>{r&&T.value}),tt(()=>{S()}),(r,a)=>{var p,F,H;return f(),Z(ze,null,[e(Le,{modelValue:G.value,"onUpdate:modelValue":a[3]||(a[3]=V=>G.value=V),"max-width":"1000px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[l("div",bs,[e(w,{icon:"mdi-delete",color:"white"}),a[9]||(a[9]=l("span",null,"Kelola Komposisi Item",-1))]),e(R,{icon:"mdi-close",variant:"text",color:"white",onClick:Ee,disabled:k.value},null,8,["disabled"])]),_:1}),e(le,{class:"pa-0"},{default:t(()=>[l("div",hs,[r.variant?(f(),Z("div",xs,[e(w,{icon:"mdi-coffee",size:"32",color:"white"}),l("div",null,[l("h3",ws,n(r.variant.name),1),l("div",Ps,[l("span",Vs,"SKU: "+n(r.variant.sku),1),l("span",Cs,"Harga: "+n(te(r.variant.price||0)),1),e(ce,{color:"success",size:"small",variant:"tonal"},{default:t(()=>a[10]||(a[10]=[u(" Stok Aman ")])),_:1,__:[10]})])])])):j("",!0)]),l("div",$s,[l("div",Ss,[l("div",Is,[e(w,{icon:"mdi-plus-circle",color:"success"}),l("h4",Ds,n(y.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(bt,{ref_key:"form",ref:O,onSubmit:kt(o,["prevent"])},{default:t(()=>[e(Pe,null,{default:t(()=>[e(I,{cols:"12",md:"4"},{default:t(()=>[e(yt,{modelValue:_.value.item_id,"onUpdate:modelValue":a[0]||(a[0]=V=>_.value.item_id=V),items:s.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[V=>!!V||"Item wajib dipilih"],loading:W.value,disabled:W.value||U.value&&U.value.length===0,"no-data-text":D(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":q},{"prepend-inner":t(()=>[e(w,{icon:"mdi-package",size:"16"})]),item:t(({props:V,item:b})=>[e(je,we(V,{title:b.raw.name,disabled:v(b.raw)<=0,class:["pa-3",{"text-disabled":v(b.raw)<=0}]}),{prepend:t(()=>[e(w,{icon:"mdi-package-variant",color:v(b.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[l("div",{class:We(["text-caption",v(b.raw)<=0?"text-disabled":"text-medium-emphasis"])},[v(b.raw)<=0?(f(),Z("span",zs,[e(w,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),a[11]||(a[11]=u(" Stok Habis "))])):(f(),Z("span",Us," Stok: "+n(v(b.raw))+" "+n(b.raw.unit),1))],2)]),append:t(()=>{var L;return[v(b.raw)>0?(f(),B(ce,{key:0,size:"x-small",color:oe(((L=b.raw.inventory)==null?void 0:L.stock_status)||b.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var P;return[u(n(ne(((P=b.raw.inventory)==null?void 0:P.stock_status)||b.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(f(),B(ce,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>a[12]||(a[12]=[u(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:V})=>[l("div",Ts,[e(w,{icon:"mdi-package-variant",size:"16",class:"me-2"}),l("span",null,n(V.raw.name),1)])]),"no-data":t(()=>[l("div",As,[e(w,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),a[13]||(a[13]=l("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),a[14]||(a[14]=l("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>[e(be,{modelValue:_.value.quantity,"onUpdate:modelValue":a[1]||(a[1]=V=>_.value.quantity=V),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[V=>!!V||"Jumlah wajib diisi",V=>V>0||"Jumlah harus lebih dari 0"],hint:x.value,"persistent-hint":"",color:m.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e(I,{cols:"12",md:"2"},{default:t(()=>{var V;return[e(be,{"model-value":((V=T.value)==null?void 0:V.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!T.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e(w,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e(I,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(it,{modelValue:_.value.is_critical,"onUpdate:modelValue":a[2]||(a[2]=V=>_.value.is_critical=V),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(R,{color:y.value?"primary":m.value?"warning":"#D4A574",onClick:o,loading:k.value,disabled:!_.value.item_id||!_.value.quantity,block:""},{default:t(()=>[e(w,{icon:y.value?"mdi-content-save":m.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),u(" "+n(y.value?"Update":m.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),y.value?(f(),B(R,{key:0,color:"grey",variant:"outlined",onClick:C,size:"small",block:""},{default:t(()=>[e(w,{icon:"mdi-close",class:"me-1"}),a[15]||(a[15]=u(" Batal "))]),_:1,__:[15]})):j("",!0)]),_:1})]),_:1})]),_:1},512)]),l("div",Hs,[l("div",Ms,[l("h4",Ks,"Daftar Item Komposisi ("+n(g.value.length)+")",1)]),g.value.length>0?(f(),Z("div",Fs,[(f(!0),Z(ze,null,Je(g.value,(V,b)=>(f(),B(Y,{key:b,variant:"outlined",class:"mb-3"},{default:t(()=>[e(le,{class:"pa-3"},{default:t(()=>{var L,P,re,ue,ye,ie,$e;return[l("div",Es,[l("div",Bs,[e(w,{icon:"mdi-check-circle",color:"success"}),l("div",null,[l("div",Rs,n(V.name),1),l("div",qs,[l("span",Ls,"Dibutuhkan: "+n(V.quantity)+" "+n(V.unit),1),a[16]||(a[16]=u(" â¢ ")),l("span",{class:We({"text-success":(((L=V.inventory)==null?void 0:L.current_stock)??0)>(((P=V.inventory)==null?void 0:P.reorder_level)??0),"text-warning":(((re=V.inventory)==null?void 0:re.current_stock)??0)<=(((ue=V.inventory)==null?void 0:ue.reorder_level)??0)&&(((ye=V.inventory)==null?void 0:ye.current_stock)??0)>0,"text-error":(((ie=V.inventory)==null?void 0:ie.current_stock)??0)<=0})}," Stok: "+n((($e=V.inventory)==null?void 0:$e.current_stock)||V.stock||0)+" "+n(V.unit),3),u(" â¢ "+n(te(V.price)),1)])])]),l("div",Ns,[e(R,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:Se=>i(V,b)},null,8,["onClick"]),e(R,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Se=>fe(V,b)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(f(),B(Y,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e(w,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),a[17]||(a[17]=l("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(Be,{class:"px-6 pb-6"},{default:t(()=>[e(R,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:Qe},{default:t(()=>a[18]||(a[18]=[u(" Setting HPP ")])),_:1,__:[18]}),e(Ne),e(R,{variant:"outlined",onClick:Ee,disabled:k.value},{default:t(()=>a[19]||(a[19]=[u(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(R,{color:"#D4A574",onClick:Ge,loading:k.value,disabled:g.value.length===0},{default:t(()=>a[20]||(a[20]=[u(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ut,{modelValue:N.value,"onUpdate:modelValue":a[4]||(a[4]=V=>N.value=V),"variant-id":((p=r.variant)==null?void 0:p.id)||((F=r.variant)==null?void 0:F.id_variant),"variant-name":(H=r.variant)==null?void 0:H.name,onHppUpdated:a[5]||(a[5]=V=>A("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Le,{modelValue:h.value,"onUpdate:modelValue":a[6]||(a[6]=V=>h.value=V),"max-width":"400px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e(w,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),a[21]||(a[21]=u(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(Ue),e(le,{class:"pa-6"},{default:t(()=>[l("div",Os,[e(w,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),a[24]||(a[24]=l("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),X.value?(f(),Z("div",js,[l("strong",null,n(X.value.item.name),1),a[22]||(a[22]=l("br",null,null,-1)),u(" Dibutuhkan: "+n(X.value.item.quantity)+" "+n(X.value.item.unit),1)])):j("",!0),e(Ke,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>a[23]||(a[23]=[l("strong",null,"Perhatian:",-1),u(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(Be,{class:"px-6 pb-6"},{default:t(()=>[e(R,{variant:"outlined",onClick:_e,disabled:ve.value,class:"flex-grow-1"},{default:t(()=>a[25]||(a[25]=[u(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(R,{color:"error",onClick:J,loading:ve.value,class:"flex-grow-1"},{default:t(()=>a[26]||(a[26]=[u(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Le,{modelValue:se.value,"onUpdate:modelValue":a[8]||(a[8]=V=>se.value=V),"max-width":"450px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:We(["d-flex align-center justify-center text-h6",He()])},{default:t(()=>[e(w,{icon:De(),color:ae(),class:"me-2",size:"24"},null,8,["icon","color"]),u(" "+n(de.value),1)]),_:1},8,["class"]),e(Ue),e(le,{class:"pa-6"},{default:t(()=>[l("div",Js,[e(w,{icon:De(),color:ae(),size:"64",class:"mb-4"},null,8,["icon","color"]),l("div",Ws,n(E.value),1),e(Ke,{type:me.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[me.value==="success"?(f(),Z(ze,{key:0},[a[27]||(a[27]=l("strong",null,"Berhasil!",-1)),a[28]||(a[28]=u(" Perubahan telah disimpan. "))],64)):me.value==="info"?(f(),Z(ze,{key:1},[a[29]||(a[29]=l("strong",null,"Informasi:",-1)),a[30]||(a[30]=u(" Item telah diperbarui sesuai permintaan. "))],64)):(f(),Z(ze,{key:2},[a[31]||(a[31]=l("strong",null,"Perhatian:",-1)),a[32]||(a[32]=u(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(Be,{class:"px-6 pb-6"},{default:t(()=>[e(Ne),e(R,{color:Ce(),onClick:a[7]||(a[7]=V=>se.value=!1),class:"px-6"},{default:t(()=>[e(w,{icon:"mdi-check",class:"me-1"}),a[33]||(a[33]=u(" OK "))]),_:1,__:[33]},8,["color"]),e(Ne)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Qs=Oe(Gs,[["__scopeId","data-v-d2ce0c17"]]),Xs={class:"d-flex align-center gap-2"},Zs={class:"mt-2"},Ys={key:0,class:"mt-1 font-weight-medium"},ei={key:1,class:"mt-1 text-warning"},ti=Re({__name:"CreateVariantDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save"],setup($,{emit:ke}){const M=$,A=ke,O=z(),k=z(!1),W=z(!1),U=z([]),g=z({name:"",selectedProduct:null,selectedProductId:null,active:!0}),y=[d=>!!d||"Nama variant wajib diisi",d=>d.length>=3||"Nama variant minimal 3 karakter"],ee=[d=>!!d||"Produk wajib dipilih"],h=(d,_="success")=>{const T=document.createElement("div");T.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${_==="success"?"#4CAF50":"#f44336"};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 9999;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
  `;const m=document.createElement("span");if(m.innerHTML=_==="success"?"â":"â",m.style.cssText=`
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    font-weight: bold;
  `,T.appendChild(m),T.appendChild(document.createTextNode(d)),!document.querySelector("#snackbar-styles")){const x=document.createElement("style");x.id="snackbar-styles",x.textContent=`
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `,document.head.appendChild(x)}document.body.appendChild(T),setTimeout(()=>{T.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{T.parentNode&&T.parentNode.removeChild(T)},300)},3e3)},X=async()=>{W.value=!0;try{const d=await qe.get("/api/products");U.value=d.data.data||d.data||[]}catch(d){console.error("Gagal mengambil data produk:",d),U.value=[]}finally{W.value=!1}},ve=d=>{!d&&U.value.length===0&&X()},se=d=>{g.value.selectedProduct=d,d?g.value.selectedProductId=d.id:g.value.selectedProductId=null},E=pe(()=>g.value.selectedProduct?g.value.selectedProduct:g.value.selectedProductId&&U.value.length>0?U.value.find(_=>_.id===g.value.selectedProductId):null),de=()=>{const d=E.value;if(!d||!g.value.name)return"";const _=d.sku||"PROD",T=g.value.name.replace(/\s+/g,"").toUpperCase().substring(0,3),m=Date.now().toString().slice(-4);return`${_}-${T}-${m}`},me=async()=>{var T,m;if(k.value)return;const{valid:d}=await O.value.validate();if(!d)return;const _=E.value;if(!_){h("Produk tidak ditemukan","error");return}if(!_.id&&!_.id_product){h("ID Produk tidak valid","error"),console.error("Product missing ID:",_);return}k.value=!0;try{const x={id_product:_.id||_.id_product,name:g.value.name,sku:de(),price:0,cost_price:null,barcode:null,variant_values:[],active:g.value.active},s=await qe.post("/api/variants",x);if(s.data.success!==!1&&(s.status===200||s.status===201))h("Variant berhasil dibuat!","success"),A("save"),G();else throw new Error(s.data.message||"Gagal membuat variant")}catch(x){const s=((m=(T=x.response)==null?void 0:T.data)==null?void 0:m.message)||x.message||"Gagal membuat variant";h(s,"error"),console.error("Save variant error:",x)}finally{k.value=!1}},N=()=>{var d;g.value={name:"",selectedProduct:null,selectedProductId:null,active:!0},(d=O.value)==null||d.resetValidation()},G=()=>{A("update:modelValue",!1),N()};return he(()=>M.modelValue,d=>{d&&(N(),X())}),(d,_)=>(f(),B(Le,{"model-value":d.modelValue,"onUpdate:modelValue":_[3]||(_[3]=T=>d.$emit("update:modelValue",T)),"max-width":"600px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"bg-primary text-white"},{default:t(()=>[e(w,{icon:"mdi-plus-circle",class:"me-2"}),_[4]||(_[4]=u(" Tambah Variant Baru ")),e(Ne),e(R,{icon:"mdi-close",variant:"text",color:"white",onClick:G})]),_:1,__:[4]}),e(bt,{ref_key:"formRef",ref:O,onSubmit:kt(me,["prevent"])},{default:t(()=>[e(le,{class:"pa-6"},{default:t(()=>[e(Pe,null,{default:t(()=>[e(I,{cols:"12"},{default:t(()=>[e(yt,{modelValue:g.value.selectedProduct,"onUpdate:modelValue":[_[0]||(_[0]=T=>g.value.selectedProduct=T),se],items:U.value,loading:W.value,"item-title":"name","return-object":"",label:"Pilih Produk *",placeholder:"Cari produk...",variant:"outlined",rules:ee,required:"","no-data-text":"Tidak ada produk ditemukan","onUpdate:search":ve},{item:t(({props:T,item:m})=>[e(je,ea(ta(T)),{prepend:t(()=>[e(Ve,{image:m.raw.image_url,size:"40"},{default:t(()=>[m.raw.image_url?j("",!0):(f(),B(w,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"])]),default:t(()=>[e(Ye,null,{default:t(()=>[u(n(m.raw.name),1)]),_:2},1024),e(st,null,{default:t(()=>[u("SKU: "+n(m.raw.sku||"-"),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:T})=>[l("div",Xs,[e(Ve,{image:T.raw.image_url,size:"24"},{default:t(()=>[T.raw.image_url?j("",!0):(f(),B(w,{key:0,icon:"mdi-coffee",size:"16"}))]),_:2},1032,["image"]),l("span",null,n(T.raw.name),1)])]),_:1},8,["modelValue","items","loading"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(be,{modelValue:g.value.name,"onUpdate:modelValue":_[1]||(_[1]=T=>g.value.name=T),label:"Nama Variant *",placeholder:"Contoh: Large Hot, Medium Cold, dll",variant:"outlined",rules:y,required:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(Ke,{color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ut,null,{default:t(()=>[e(w,{icon:"mdi-information",class:"me-2"}),_[5]||(_[5]=u(" SKU Otomatis "))]),_:1,__:[5]}),l("div",Zs,[_[6]||(_[6]=u(" SKU variant akan dibuat otomatis berdasarkan nama produk dan variant ")),g.value.name&&(g.value.selectedProduct||g.value.selectedProductId)?(f(),Z("div",Ys," Preview SKU: "+n(de()),1)):g.value.name&&!g.value.selectedProduct&&!g.value.selectedProductId?(f(),Z("div",ei," Pilih produk terlebih dahulu untuk melihat preview SKU ")):j("",!0)])]),_:1})]),_:1}),e(I,{cols:"12"},{default:t(()=>[e(it,{modelValue:g.value.active,"onUpdate:modelValue":_[2]||(_[2]=T=>g.value.active=T),label:"Variant Aktif",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Ue),e(Be,{class:"pa-6"},{default:t(()=>[e(Ne),e(R,{variant:"outlined",onClick:G,disabled:k.value},{default:t(()=>_[7]||(_[7]=[u(" Batal ")])),_:1,__:[7]},8,["disabled"]),e(R,{type:"submit",color:"primary",loading:k.value},{default:t(()=>_[8]||(_[8]=[u(" Simpan Variant ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),ai=Oe(ti,[["__scopeId","data-v-5477c365"]]),li={class:"product-variant-tab"},oi={class:"d-flex gap-2"},si={key:0,class:"mt-4 d-flex align-center gap-2"},ii={key:1,class:"text-center pa-12"},ni={key:2,class:"text-center pa-12"},ri={class:"d-flex align-center gap-3"},ui={class:"flex-grow-1 min-width-0"},di={class:"text-h6 font-weight-bold text-truncate"},ci={class:"text-body-2 text-medium-emphasis mb-0"},mi={class:"d-flex flex-column gap-1"},vi={class:"text-xs"},pi={class:"d-flex align-center gap-2"},fi={class:"text-primary font-weight-medium"},gi={class:"d-flex gap-1"},_i={class:"d-flex align-center justify-space-between w-100"},ki={class:"d-flex gap-1"},yi=Re({__name:"ProductVariantTab",props:{loading:{type:Boolean}},emits:["refresh"],setup($,{emit:ke}){const M=ke,A=z(!1),O=z([]),k=z(!1),W=z(!1),U=z(null),g=z(!1),y=z(!1),ee=z(!1),h=z({search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}),X=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],ve=[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Variant Terbanyak",value:"variants_desc"},{title:"Variant Tersedikit",value:"variants_asc"}],se=pe(()=>!!(h.value.search||h.value.stockStatus||h.value.activeStatus!==null||h.value.sortBy!=="name_asc")),E=pe(()=>{const c={};return O.value.forEach(o=>{const i=o.id_product;c[i]||(c[i]={product:o.product||{id:o.id_product,id_product:o.id_product,name:`Product ${o.id_product}`,sku:""},variants:[]}),c[i].variants.push(o)}),Object.values(c)}),de=pe(()=>{let c=[...E.value];if(h.value.search){const o=h.value.search.toLowerCase();c=c.filter(i=>{var C;return i.product.name.toLowerCase().includes(o)||((C=i.product.sku)==null?void 0:C.toLowerCase().includes(o))||i.variants.some(fe=>fe.name.toLowerCase().includes(o)||fe.sku.toLowerCase().includes(o))})}switch(h.value.stockStatus&&(c=c.filter(o=>o.variants.some(i=>{var fe;return(((fe=i.composition_summary)==null?void 0:fe.stock_status)||"safe")===h.value.stockStatus}))),h.value.activeStatus!==null&&(c=c.filter(o=>o.variants.some(i=>i.is_active===h.value.activeStatus))),h.value.sortBy){case"name_asc":c.sort((o,i)=>o.product.name.localeCompare(i.product.name));break;case"name_desc":c.sort((o,i)=>i.product.name.localeCompare(o.product.name));break;case"variants_desc":c.sort((o,i)=>i.variants.length-o.variants.length);break;case"variants_asc":c.sort((o,i)=>o.variants.length-i.variants.length);break}return c}),me=(c,o="success")=>{},N=async c=>{try{const o=O.value.findIndex(i=>i.id_variant===c.variantId);o!==-1&&(O.value[o]={...O.value[o],price:c.newPrice,cost:c.hpp}),me(`Price updated to ${new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(c.newPrice)}`,"success")}catch(o){console.error("Error handling price update:",o),await G()}},G=async()=>{var c,o,i;A.value=!0;try{const C=await qe.get("/api/variants",{params:{per_page:1e3,with_product:!0,with_composition:!0}});if(C.data.success===!1)throw new Error(C.data.message||"Failed to load variants");const fe=((c=C.data.data)==null?void 0:c.data)||C.data.data||[];O.value=fe.map(J=>({...J,is_active:J.active!==void 0?J.active:J.is_active,id:J.id_variant||J.id,id_product:J.id_product||J.product_id}))}catch(C){(i=(o=C.response)==null?void 0:o.data)!=null&&i.message||C.message,O.value=[]}finally{A.value=!1}},d=c=>{U.value=c,g.value=!0},_=c=>{c&&(U.value=c,y.value=!0)},T=c=>{U.value=c,k.value=!0},m=()=>{ee.value=!0},x=async()=>{var c,o;if(U.value)try{W.value=!0,await qe.delete(`/api/variants/${U.value.id_variant}`),me("Variant berhasil dihapus","success"),await G(),k.value=!1}catch(i){(o=(c=i.response)==null?void 0:c.data)!=null&&o.message}finally{W.value=!1}},s=c=>{switch(c){case"critical":return"error";case"out":return"error";case"safe":return"success";default:return"primary"}},v=c=>{switch(c){case"critical":return"Kritis";case"out":return"Habis";case"safe":return"Aman";default:return"Normal"}},D=c=>{const o=c.filter(i=>i.is_active).length;return o===0?"error":o===c.length?"success":"warning"},te=c=>c.some(o=>{var C;const i=(C=o.composition_summary)==null?void 0:C.stock_status;return i==="critical"||i==="out"}),oe=c=>{const o=c.filter(C=>C.is_active).length,i=c.filter(C=>{var J;const fe=(J=C.composition_summary)==null?void 0:J.stock_status;return fe==="critical"||fe==="out"}).length;return i>0?{text:`${i} Stok Kritis`,color:"error",icon:"mdi-alert-circle"}:o===c.length?{text:"Semua Aktif",color:"success",icon:"mdi-check-circle"}:o===0?{text:"Semua Nonaktif",color:"error",icon:"mdi-close-circle"}:{text:`${o}/${c.length} Aktif`,color:"warning",icon:"mdi-minus-circle"}},ne=()=>{h.value={search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}},q=()=>{G(),M("refresh")},S=()=>{G(),M("refresh")};return tt(()=>{G()}),(c,o)=>{var i,C,fe;return f(),Z("div",li,[e(Y,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o[14]||(o[14]=l("div",null,[l("h2",{class:"text-h5 font-weight-bold"},"Variant Produk"),l("p",{class:"text-body-2 text-medium-emphasis"}," Kelola variant dan komposisi untuk produk Anda ")],-1)),l("div",oi,[e(R,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:G,loading:A.value},{default:t(()=>o[12]||(o[12]=[u(" Refresh ")])),_:1,__:[12]},8,["loading"]),e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:m},{default:t(()=>o[13]||(o[13]=[u(" Tambah Variant ")])),_:1,__:[13]})])]),_:1,__:[14]})]),_:1}),e(Y,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(le,null,{default:t(()=>[e(Pe,null,{default:t(()=>[e(I,{cols:"12",md:"3"},{default:t(()=>[e(be,{modelValue:h.value.search,"onUpdate:modelValue":o[0]||(o[0]=J=>h.value.search=J),label:"Cari Variant",placeholder:"Nama variant, SKU, atau produk...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:h.value.stockStatus,"onUpdate:modelValue":o[1]||(o[1]=J=>h.value.stockStatus=J),items:X,label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:h.value.activeStatus,"onUpdate:modelValue":o[2]||(o[2]=J=>h.value.activeStatus=J),items:[{title:"Semua Status",value:null},{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Status Aktif",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:h.value.sortBy,"onUpdate:modelValue":o[3]||(o[3]=J=>h.value.sortBy=J),items:ve,label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),se.value?(f(),Z("div",si,[o[16]||(o[16]=l("span",{class:"text-body-2"},"Filter aktif:",-1)),h.value.search?(f(),B(ce,{key:0,size:"small",closable:"","onClick:close":o[4]||(o[4]=J=>h.value.search="")},{default:t(()=>[u(" Pencarian: "+n(h.value.search),1)]),_:1})):j("",!0),h.value.stockStatus?(f(),B(ce,{key:1,size:"small",closable:"","onClick:close":o[5]||(o[5]=J=>h.value.stockStatus="")},{default:t(()=>{var J;return[u(" Stok: "+n((J=X.find(_e=>_e.value===h.value.stockStatus))==null?void 0:J.title),1)]}),_:1})):j("",!0),h.value.activeStatus!==null?(f(),B(ce,{key:2,size:"small",closable:"","onClick:close":o[6]||(o[6]=J=>h.value.activeStatus=null)},{default:t(()=>[u(" Status: "+n(h.value.activeStatus?"Aktif":"Nonaktif"),1)]),_:1})):j("",!0),e(R,{variant:"text",size:"small",color:"error",onClick:ne},{default:t(()=>o[15]||(o[15]=[u(" Hapus Semua Filter ")])),_:1,__:[15]})])):j("",!0)]),_:1})]),_:1}),!A.value&&de.value.length===0&&se.value?(f(),B(Ke,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada variant yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):j("",!0),A.value?(f(),Z("div",ii,[e(dt,{color:"primary",indeterminate:"",size:"64"}),o[17]||(o[17]=l("div",{class:"mt-4 text-h6"},"Memuat variant...",-1))])):E.value.length===0?(f(),Z("div",ni,[e(w,{icon:"mdi-tune-variant",size:"96",class:"text-disabled mb-6"}),o[19]||(o[19]=l("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Variant Produk",-1)),o[20]||(o[20]=l("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat variant untuk produk Anda agar dapat menawarkan pilihan yang beragam ",-1)),e(R,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:m},{default:t(()=>o[18]||(o[18]=[u(" Buat Variant Pertama ")])),_:1,__:[18]})])):(f(),B(Pe,{key:3},{default:t(()=>[(f(!0),Z(ze,null,Je(de.value,J=>(f(),B(I,{key:J.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(Y,{class:We(["variant-group-card h-100",{"border-error":te(J.variants)}]),elevation:"2"},{default:t(()=>[e(xe,{class:"pa-4 pb-2"},{default:t(()=>[l("div",ri,[e(Ve,{image:J.product.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[J.product.image_url?j("",!0):(f(),B(w,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),l("div",ui,[l("h3",di,n(J.product.name),1),l("p",ci," SKU: "+n(J.product.sku||"-"),1)]),e(ce,{color:D(J.variants),size:"small",variant:"tonal"},{default:t(()=>[u(n(J.variants.length)+" Variant ",1)]),_:2},1032,["color"])])]),_:2},1024),e(Ue),e(le,{class:"pa-4"},{default:t(()=>[e(ct,{class:"pa-0"},{default:t(()=>[(f(!0),Z(ze,null,Je(J.variants,(_e,De)=>(f(),B(je,{key:_e.id_variant,class:We(["pa-2 rounded-lg variant-item",{"mb-2":De<J.variants.length-1}])},{prepend:t(()=>[e(Ve,{size:"32",color:_e.is_active?"success":"error",variant:"tonal"},{default:t(()=>[e(w,{icon:_e.is_active?"mdi-check":"mdi-close",size:"16"},null,8,["icon"])]),_:2},1032,["color"])]),append:t(()=>[l("div",gi,[e(Me,{text:"Kelola Komposisi"},{activator:t(({props:ae})=>[e(R,we({ref_for:!0},ae,{icon:"mdi-chef-hat",size:"small",variant:"text",color:"primary",onClick:He=>d(_e)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Hapus Variant"},{activator:t(({props:ae})=>[e(R,we({ref_for:!0},ae,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:He=>T(_e)}),null,16,["onClick"])]),_:2},1024)])]),default:t(()=>[e(Ye,{class:"text-sm font-weight-medium"},{default:t(()=>[u(n(_e.name),1)]),_:2},1024),e(st,null,{default:t(()=>[l("div",mi,[l("span",vi,"SKU: "+n(_e.sku),1),l("div",pi,[l("span",fi,n(K(Ae)(_e.price||0)),1),_e.composition_summary?(f(),B(ce,{key:0,color:s(_e.composition_summary.stock_status),size:"x-small",variant:"tonal"},{default:t(()=>[u(n(v(_e.composition_summary.stock_status)),1)]),_:2},1032,["color"])):j("",!0)])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:2},1024)]),_:2},1024),e(Ue),e(Be,{class:"pa-4"},{default:t(()=>[l("div",_i,[l("div",null,[e(ce,{color:oe(J.variants).color,size:"small",variant:"tonal"},{default:t(()=>[e(w,{icon:oe(J.variants).icon,size:"14",class:"me-1"},null,8,["icon"]),u(" "+n(oe(J.variants).text),1)]),_:2},1032,["color"])]),l("div",ki,[e(Me,{text:"Setting HPP Produk"},{activator:t(({props:_e})=>[e(R,we({ref_for:!0},_e,{icon:"mdi-calculator-variant",size:"small",variant:"text",color:"warning",onClick:De=>_(J.variants[0])}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Tambah Variant"},{activator:t(({props:_e})=>[e(R,we({ref_for:!0},_e,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:m}),null,16)]),_:1}),e(Me,{text:"Pengaturan Produk (Coming Soon)"},{activator:t(({props:_e})=>[e(R,we({ref_for:!0},_e,{icon:"mdi-cog",size:"small",variant:"text",color:"secondary",disabled:""}),null,16)]),_:1})])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(Qs,{modelValue:g.value,"onUpdate:modelValue":o[7]||(o[7]=J=>g.value=J),variant:U.value,onSave:q},null,8,["modelValue","variant"]),e(Ut,{modelValue:y.value,"onUpdate:modelValue":o[8]||(o[8]=J=>y.value=J),"variant-id":(i=U.value)==null?void 0:i.id_variant,"variant-name":(C=U.value)==null?void 0:C.name,onHppUpdated:G,onPriceUpdated:N},null,8,["modelValue","variant-id","variant-name"]),e(ai,{modelValue:ee.value,"onUpdate:modelValue":o[9]||(o[9]=J=>ee.value=J),onSave:S},null,8,["modelValue"]),e(St,{modelValue:k.value,"onUpdate:modelValue":o[10]||(o[10]=J=>k.value=J),title:"Konfirmasi Hapus Variant","item-name":(fe=U.value)==null?void 0:fe.name,loading:W.value,"confirm-text":"Hapus Variant",onConfirm:x,onCancel:o[11]||(o[11]=J=>k.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),$t=Oe(yi,[["__scopeId","data-v-22b81d4b"]]),bi={class:"product-management"},hi={class:"d-flex justify-space-between align-center mb-6"},xi={class:"d-flex gap-3 align-center"},wi={key:0,class:"d-flex gap-2"},Pi={class:"d-flex align-center"},Vi=Re({__name:"products-management",setup($){It();const{productsList:ke,categories:M,loading:A,saveLoading:O,deleteLoading:k,toggleLoading:W,stats:U,dialog:g,deleteDialog:y,editMode:ee,selectedProduct:h,selectedProducts:X,currentPage:ve,totalItems:se,itemsPerPage:E,filters:de,errorMessage:me,successMessage:N,modalErrorMessage:G,formData:d,selectedImage:_,imagePreview:T,canCreateEdit:m,hasSelectedProducts:x,fetchProductsList:s,fetchCategories:v,fetchStats:D,saveProduct:te,deleteProduct:oe,bulkDeleteProducts:ne,toggleActiveStatus:q,toggleFeaturedStatus:S,openCreateDialog:c,openEditDialog:o,openDeleteDialog:i,closeDialog:C,handleImageUpload:fe,clearModalError:J,onPageChange:_e}=Dt(),{dialog:De,editMode:ae,formData:He,availableItems:Ce,saveLoading:Ge,modalErrorMessage:Qe,openCreateDialog:Ee,closeDialog:r,saveRecipe:a,clearModalError:p,fetchAvailableItems:F}=da(),{productItemsList:H,loading:V,fetchProductItemsForComposition:b}=Mt(),L=z("products"),P=z(),re=z(!1),ue=z(null),ye=z(!1),ie=z(null),$e=async()=>{await oe()},Se=async()=>{await ne()},Te=Ie=>{const Q=Ie.id_product||Ie.id;Ee(Q)},Xe=async Ie=>{ue.value=Ie;try{await b({page:1,per_page:50,critical_only:!1})}catch{}re.value=!0},Ze=Ie=>{ie.value=Ie,ye.value=!0},nt=Ie=>{if(!Ie)return[];const Q=Ie.id_product||Ie.id;return H.value.filter(at=>{var ge;return((ge=at.product)==null?void 0:ge.id_product)===Q||at.product_id===Q})||[]},ht=async()=>{if(await b({page:1,per_page:50,critical_only:!1}),await s(),ue.value&&P.value){const Ie=ue.value.id_product||ue.value.id;await P.value.refreshHPPData(Ie)}},Tt=Ie=>{Object.assign(de,Ie),s()},At=Ie=>{de.search=Ie,s()},Ht=()=>{_.value=null,T.value&&(T.value="")};return he(L,async Ie=>{Ie==="compositions"&&await b({page:1,per_page:15,critical_only:!1})},{immediate:!1}),tt(()=>{s(),v(),D(),F()}),(Ie,Q)=>{var at;return f(),Z("div",bi,[l("div",hi,[Q[18]||(Q[18]=l("div",null,[l("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),l("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),l("div",xi,[K(x)&&L.value==="products"?(f(),Z("div",wi,[e(ce,{color:"primary",size:"small"},{default:t(()=>[u(n(K(X).length)+" dipilih ",1)]),_:1}),e(R,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:Se},{default:t(()=>Q[16]||(Q[16]=[u(" Hapus Terpilih ")])),_:1,__:[16]})])):j("",!0),K(m)&&L.value==="products"?(f(),B(R,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:K(c)},{default:t(()=>Q[17]||(Q[17]=[u(" Tambah Produk ")])),_:1,__:[17]},8,["onClick"])):j("",!0)])]),e(Va,{modelValue:L.value,"onUpdate:modelValue":Q[0]||(Q[0]=ge=>L.value=ge),class:"mb-6"},{default:t(()=>[e(vt,{value:"products"},{default:t(()=>[e(w,{icon:"mdi-coffee",class:"me-2"}),Q[19]||(Q[19]=u(" Produk "))]),_:1,__:[19]}),e(vt,{value:"compositions"},{default:t(()=>[e(w,{icon:"mdi-chef-hat",class:"me-2"}),Q[20]||(Q[20]=u(" Komposisi Produk "))]),_:1,__:[20]}),e(vt,{value:"variants"},{default:t(()=>[e(w,{icon:"mdi-tune-variant",class:"me-2"}),Q[21]||(Q[21]=u(" Variant Produk "))]),_:1,__:[21]})]),_:1},8,["modelValue"]),K(me)?(f(),B(Ke,{key:0,type:"error",variant:"outlined",class:"mb-4",text:K(me),closable:"","onClick:close":Q[1]||(Q[1]=ge=>me.value="")},null,8,["text"])):j("",!0),K(N)?(f(),B(Ke,{key:1,type:"success",variant:"outlined",class:"mb-4",text:K(N),closable:"","onClick:close":Q[2]||(Q[2]=ge=>N.value="")},null,8,["text"])):j("",!0),e(Ca,{modelValue:L.value,"onUpdate:modelValue":Q[4]||(Q[4]=ge=>L.value=ge)},{default:t(()=>[e(pt,{value:"products"},{default:t(()=>[e(Ko,{stats:K(U)},null,8,["stats"]),e(yo,{filters:K(de),"onUpdate:filters":Tt,onSearch:At},null,8,["filters"]),e(ls,{ref_key:"productTableRef",ref:P,products:K(ke),loading:K(A),"current-page":K(ve),"total-items":K(se),"items-per-page":K(E),"selected-products":K(X),"toggle-loading":K(W),"onUpdate:page":K(_e),onAddProduct:K(c),onEditProduct:K(o),onOpenRecipeDialog:Te,onOpenCompositionDialog:Xe,onOpenVariantDialog:Ze,onDeleteProduct:K(i),onToggleActive:K(q),onToggleFeatured:K(S),"onUpdate:selectedProducts":Q[3]||(Q[3]=ge=>X.value=ge)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:page","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured"])]),_:1}),e(pt,{value:"compositions"},{default:t(()=>[e(El,{"product-items":K(H),loading:K(V),onRefresh:K(b)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(pt,{value:"variants"},{default:t(()=>[e($t,{loading:K(A),onRefresh:K(s)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(po,{modelValue:K(g),"onUpdate:modelValue":[Q[5]||(Q[5]=ge=>mt(g)?g.value=ge:null),Q[6]||(Q[6]=ge=>g.value=ge)],"edit-mode":K(ee),"form-data":K(d),categories:K(M),loading:K(O),"error-message":K(G),"selected-image":K(_)?[K(_)]:[],"image-preview":K(T),onClose:K(C),onSubmit:K(te),onImageChange:K(fe),onRemoveImage:Ht,onClearError:K(J),onUpdateForm:Q[7]||(Q[7]=(ge,xt)=>K(d)[ge]=xt)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(ca,{modelValue:K(De),"onUpdate:modelValue":[Q[8]||(Q[8]=ge=>mt(De)?De.value=ge:null),Q[9]||(Q[9]=ge=>De.value=ge)],"edit-mode":K(ae),"form-data":K(He),"available-items":K(Ce),loading:K(Ge),"error-message":K(Qe),onClose:K(r),onSave:K(a),onClearError:K(p)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(St,{modelValue:K(y),"onUpdate:modelValue":Q[10]||(Q[10]=ge=>mt(y)?y.value=ge:null),title:"Konfirmasi Hapus Produk","item-name":(at=K(h))==null?void 0:at.name,loading:K(k),"confirm-text":"Hapus Produk",onConfirm:$e,onCancel:Q[11]||(Q[11]=ge=>y.value=!1)},null,8,["modelValue","item-name","loading"]),e(zt,{modelValue:re.value,"onUpdate:modelValue":Q[12]||(Q[12]=ge=>re.value=ge),product:ue.value,items:nt(ue.value),onSave:ht,onRefresh:ht},null,8,["modelValue","product","items"]),e(Le,{modelValue:ye.value,"onUpdate:modelValue":Q[15]||(Q[15]=ge=>ye.value=ge),"max-width":"1400px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex justify-between align-center"},{default:t(()=>{var ge;return[l("div",Pi,[e(w,{icon:"tabler-versions",class:"me-2"}),u(" Kelola Variant - "+n((ge=ie.value)==null?void 0:ge.name),1)]),e(R,{icon:"tabler-x",variant:"text",onClick:Q[13]||(Q[13]=xt=>ye.value=!1)})]}),_:1}),e(Ue),e(le,{class:"pa-0"},{default:t(()=>[ie.value?(f(),B($t,{key:0,product:ie.value},null,8,["product"])):j("",!0)]),_:1}),e(Ue),e(Be,null,{default:t(()=>[e(Ne),e(R,{color:"grey-darken-1",variant:"outlined",onClick:Q[14]||(Q[14]=ge=>ye.value=!1)},{default:t(()=>[e(w,{icon:"mdi-close",class:"me-1"}),Q[22]||(Q[22]=u(" Tutup "))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),yn=Oe(Vi,[["__scopeId","data-v-9db14e64"]]);export{yn as default};
