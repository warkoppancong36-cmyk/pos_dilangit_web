import{P as $}from"./PosApi-BqyOrwTF.js";import de from"./EditOrderDialog-DT7wBClP.js";import ce from"./OrderDetailDialog-CjxDBfXB.js";import{V as me}from"./VDialog-xefm2FMY.js";import{V as T,b as pe}from"./VCard-7gd_o7Jb.js";import{d as ve,r as u,V as ge,w as j,g as A,f as o,o as m,b as l,e as s,X as H,a1 as y,s as w,c as x,l as M,t as d,F as _e,i as fe,_ as ye}from"./main-BP7jZy1V.js";import{V as b}from"./VCardText-LmLZYPt0.js";import{V as Q,a as p}from"./VRow-CjCzl0iF.js";import{V as z}from"./VTextField-BvFRNGHy.js";import{V as xe}from"./VSelect-vgbCEO1n.js";import{V as be}from"./VDataTable-08pk0W_n.js";import{V as L}from"./VChip-WtE9SuE7.js";import"./VForm-BHS8JXkg.js";import"./forwardRefs-B931MWyl.js";import"./VTextarea-vz4fkAZ2.js";import"./VImg-DofzBdA3.js";import"./VDivider-DERbRu3O.js";import"./VSpacer-DjX8krbl.js";/* empty css              */import"./VTable-B3CWDnlT.js";import"./VOverlay-CsNzN0zO.js";import"./VAvatar-DUglxHLi.js";import"./VList-D2JN0bYD.js";import"./VMenu-BSIULBn1.js";import"./VCheckboxBtn-Cch-902U.js";import"./filter-D8OS6eks.js";const Ve={class:"d-flex align-items-center gap-2"},he={class:"text-h4"},ke={class:"text-h4"},Te={class:"text-h4"},we={class:"text-h4"},De={key:0},Ce={class:"font-weight-medium"},Se={class:"text-caption text-medium-emphasis"},Ie={key:1,class:"text-medium-emphasis"},Fe={class:"font-weight-medium"},Oe={key:0},Pe={key:1,class:"text-medium-emphasis"},Ue={class:"text-body-2"},Ne={class:"text-caption text-medium-emphasis"},Ae={key:0,class:"pa-4 text-center border-t"},ze=ve({__name:"TransactionHistoryDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(q,{emit:K}){const W=q,X=K,S=u(!1),c=u([]),_=u(""),f=u(""),V=u(""),v=u(new Date().toISOString().split("T")[0]),g=u(new Date().toISOString().split("T")[0]),I=u(!1),F=u(!1),D=u(null),O=u(!1),n=u({current_page:1,per_page:15,total:0,last_page:1}),h=u({total_orders:0,total_revenue:0,average_order:0,pending_orders:0}),G=[{title:"No. Pesanan",key:"order_number",sortable:!0},{title:"Pelanggan",key:"customer",sortable:!1},{title:"Status",key:"status",sortable:!0},{title:"Total",key:"total_amount",sortable:!0},{title:"Pembayaran",key:"payment_method",sortable:!1},{title:"Tanggal",key:"created_at",sortable:!0},{title:"Aksi",key:"actions",sortable:!1,width:"120px"}],J=[{title:"Pending",value:"pending"},{title:"Diproses",value:"preparing"},{title:"Selesai",value:"completed"},{title:"Dibatalkan",value:"cancelled"}],Y=[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],C=ge({get:()=>W.modelValue,set:a=>X("update:modelValue",a)}),k=async(a=1,t=15)=>{try{S.value=!0,console.log("ðŸ“… LoadTransactions dateFrom:",v.value),console.log("ðŸ“… LoadTransactions dateTo:",g.value);const e={page:a,per_page:t>=999999?"all":t};_.value&&(e.search=_.value),f.value&&(e.status=f.value),V.value&&(e.category_id=V.value),v.value&&(e.date_from=v.value),g.value&&(e.date_to=g.value);const i=await $.getOrders(e);if(i.success){const r=i.data;r!=null&&r.data&&Array.isArray(r.data)?(c.value=r.data,n.value={current_page:r.current_page||1,per_page:t>=999999?-1:r.per_page||15,total:r.total||0,last_page:r.last_page||1}):Array.isArray(r)?(c.value=r,n.value={current_page:1,per_page:t>=999999?-1:r.length,total:r.length,last_page:1}):(console.warn("Unexpected response structure:",i),c.value=[],n.value={current_page:1,per_page:15,total:0,last_page:1})}else c.value=[],n.value={current_page:1,per_page:15,total:0,last_page:1};R()}catch(e){console.error("Error loading transactions:",e),c.value=[],n.value={current_page:1,per_page:15,total:0,last_page:1}}finally{S.value=!1}},Z=a=>{k(a,n.value.per_page)},ee=async a=>{if(a===-1){const t=n.value.total;if(t>1e3&&!window.confirm(`Anda akan memuat semua ${t} transaksi. Ini mungkin memakan waktu lama. Lanjutkan?`))return;await k(1,999999)}else await k(1,a)},R=()=>{const a=c.value,t=a.reduce((i,r)=>{const N=typeof r.total_amount=="string"?parseFloat(r.total_amount):r.total_amount;return i+(isNaN(N)||!isFinite(N)?0:N)},0),e=a.length>0&&t>0?t/a.length:0;h.value={total_orders:n.value.total,total_revenue:t,average_order:e,pending_orders:a.filter(i=>i.status==="pending").length}},B=a=>{D.value=a,I.value=!0},te=a=>{},ae=a=>{D.value=a,F.value=!0},E=a=>{const t=c.value.findIndex(e=>e.id_order===a.id_order);t!==-1&&(c.value[t]=a),R()},le=a=>({pending:"warning",preparing:"info",completed:"success",cancelled:"error"})[a]||"default",oe=a=>({pending:"Pending",preparing:"Diproses",completed:"Selesai",cancelled:"Dibatalkan"})[a]||a,se=a=>({cash:"Tunai",card:"Kartu",digital_wallet:"E-Wallet",qris:"QRIS",bank_transfer:"Transfer"})[a]||a,P=a=>{const t=typeof a=="string"?parseFloat(a):a;return isNaN(t)||!isFinite(t)?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t)},re=a=>new Date(a).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}),ne=a=>new Date(a).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),ie=async()=>{try{O.value=!0;const a={};_.value&&(a.search=_.value),f.value&&(a.payment_status=f.value),V.value&&(a.category_id=V.value),v.value&&(a.start_date=v.value),g.value&&(a.end_date=g.value);const t=await $.exportOrdersToExcel(a)}catch{}finally{O.value=!1}},ue=()=>{C.value=!1};j(C,a=>{a&&k()});let U=null;return j([_,f,V,v,g],()=>{U&&clearTimeout(U),U=setTimeout(()=>{k(1,n.value.per_page)},500)}),(a,t)=>(m(),A(me,{modelValue:C.value,"onUpdate:modelValue":t[6]||(t[6]=e=>C.value=e),"max-width":"1400",scrollable:""},{default:o(()=>[l(T,{class:"coffee-dialog"},{default:o(()=>[l(pe,{class:"d-flex align-center justify-space-between coffee-header"},{default:o(()=>[s("div",Ve,[l(H,{icon:"tabler-history",class:"text-white"}),t[7]||(t[7]=s("div",null,[s("div",{class:"coffee-title"},"Riwayat Transaksi"),s("div",{class:"coffee-subtitle"},"Daftar transaksi dan pembayaran")],-1))]),l(y,{icon:"tabler-x",variant:"text",color:"white",onClick:ue})]),_:1}),l(b,{class:"pb-0 px-6"},{default:o(()=>[l(Q,null,{default:o(()=>[l(p,{cols:"12",md:"3"},{default:o(()=>[l(z,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=e=>_.value=e),label:"Cari transaksi...",variant:"outlined",density:"compact","prepend-inner-icon":"tabler-search",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",md:"2"},{default:o(()=>[l(xe,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e),items:J,label:"Status",variant:"outlined",density:"compact",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",md:"2"},{default:o(()=>[l(z,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=e=>v.value=e),label:"Dari Tanggal",type:"date",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",md:"2"},{default:o(()=>[l(z,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=e=>g.value=e),label:"Sampai Tanggal",type:"date",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",md:"1"},{default:o(()=>[l(y,{color:"success",variant:"tonal","prepend-icon":"tabler-download",onClick:ie,loading:O.value,block:""},{default:o(()=>t[8]||(t[8]=[w(" Export ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1})]),_:1}),l(b,{class:"px-6"},{default:o(()=>[l(Q,{class:"mb-4"},{default:o(()=>[l(p,{cols:"12",md:"3"},{default:o(()=>[l(T,{variant:"tonal",color:"primary"},{default:o(()=>[l(b,{class:"text-center"},{default:o(()=>[s("h3",he,d(h.value.total_orders),1),t[9]||(t[9]=s("p",{class:"text-body-2 mb-0"},"Total Transaksi",-1))]),_:1,__:[9]})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:o(()=>[l(T,{variant:"tonal",color:"success"},{default:o(()=>[l(b,{class:"text-center"},{default:o(()=>[s("h3",ke,d(P(h.value.total_revenue)),1),t[10]||(t[10]=s("p",{class:"text-body-2 mb-0"},"Total Pendapatan",-1))]),_:1,__:[10]})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:o(()=>[l(T,{variant:"tonal",color:"info"},{default:o(()=>[l(b,{class:"text-center"},{default:o(()=>[s("h3",Te,d(P(h.value.average_order)),1),t[11]||(t[11]=s("p",{class:"text-body-2 mb-0"},"Rata-rata per Transaksi",-1))]),_:1,__:[11]})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:o(()=>[l(T,{variant:"tonal",color:"warning"},{default:o(()=>[l(b,{class:"text-center"},{default:o(()=>[s("h3",we,d(h.value.pending_orders),1),t[12]||(t[12]=s("p",{class:"text-body-2 mb-0"},"Transaksi Pending",-1))]),_:1,__:[12]})]),_:1})]),_:1})]),_:1}),l(be,{headers:G,items:c.value,loading:S.value,"items-per-page":n.value.per_page===-1?c.value.length:n.value.per_page,page:n.value.current_page,"items-length":n.value.total,"server-items-length":n.value.total,"items-per-page-options":Y,"show-select":!1,class:"elevation-1","onUpdate:page":Z,"onUpdate:itemsPerPage":ee},{"item.order_number":o(({item:e})=>[l(y,{variant:"text",color:"primary",size:"small",onClick:i=>B(e)},{default:o(()=>[w(d(e.order_number),1)]),_:2},1032,["onClick"])]),"item.customer":o(({item:e})=>[e.customer?(m(),x("div",De,[s("div",Ce,d(e.customer.name),1),s("div",Se,d(e.customer.phone),1)])):(m(),x("span",Ie,"-"))]),"item.status":o(({item:e})=>[l(L,{color:le(e.status),size:"small",variant:"tonal"},{default:o(()=>[w(d(oe(e.status)),1)]),_:2},1032,["color"])]),"item.total_amount":o(({item:e})=>[s("span",Fe,d(P(e.total_amount)),1)]),"item.payment_method":o(({item:e})=>[e.payments&&e.payments.length>0?(m(),x("div",Oe,[(m(!0),x(_e,null,fe(e.payments,i=>(m(),A(L,{key:i.id_payment,size:"small",variant:"outlined",class:"ma-1"},{default:o(()=>[w(d(se(i.payment_method)),1)]),_:2},1024))),128))])):(m(),x("span",Pe,"-"))]),"item.created_at":o(({item:e})=>[s("div",null,[s("div",Ue,d(re(e.created_at)),1),s("div",Ne,d(ne(e.created_at)),1)])]),"item.actions":o(({item:e})=>[l(y,{icon:"tabler-eye",variant:"text",size:"small",onClick:i=>B(e)},null,8,["onClick"]),l(y,{icon:"tabler-printer",variant:"text",size:"small",onClick:i=>te(e)},null,8,["onClick"]),e.status==="pending"?(m(),A(y,{key:0,icon:"tabler-edit",variant:"text",size:"small",color:"primary",onClick:i=>ae(e)},null,8,["onClick"])):M("",!0)]),_:1},8,["items","loading","items-per-page","page","items-length","server-items-length"]),n.value.per_page===-1?(m(),x("div",Ae,[l(L,{color:"success",variant:"tonal",size:"large"},{default:o(()=>[l(H,{start:"",icon:"tabler-check-circle"}),w(" Menampilkan semua "+d(c.value.length)+" transaksi ",1)]),_:1})])):M("",!0)]),_:1})]),_:1}),l(ce,{modelValue:I.value,"onUpdate:modelValue":t[4]||(t[4]=e=>I.value=e),order:D.value,onOrderUpdated:E},null,8,["modelValue","order"]),l(de,{modelValue:F.value,"onUpdate:modelValue":t[5]||(t[5]=e=>F.value=e),order:D.value,onOrderUpdated:E},null,8,["modelValue","order"])]),_:1},8,["modelValue"]))}}),ut=ye(ze,[["__scopeId","data-v-24b8c65d"]]);export{ut as default};
