import{D as Ut}from"./DeleteConfirmationDialog-lRXhQs92.js";import{f as Ke}from"./formatters-BD6tdLx_.js";import{P as gt,u as Et}from"./useProductItems-CRQvNo69.js";import{I as Bt}from"./ItemsApi-DFzIU80m.js";import{u as wt,H as Ft}from"./HPPBreakdownDialog-CbgjA4W-.js";import{V as Oe}from"./VDialog-DZymRYYe.js";import{V as ae,b as Pe,c as je}from"./VCard-81xWS9tH.js";import{a6 as Rt,a7 as Lt,ae as qt,r as $,b0 as mt,af as Nt,b5 as It,bf as Ot,V as ve,W as jt,w as Ce,br as $t,av as ht,a8 as Jt,b as e,p as xe,ba as Wt,cx as Qt,c8 as Dt,bd as Gt,F as Ue,X as _,cm as Xt,c9 as Zt,aY as Yt,s as c,d as qe,D as ut,c as Z,f as t,e as o,t as r,a1 as R,g as F,l as W,m as E,ax as pt,cw as _t,at as Fe,i as Ye,v as lt,o as m,_ as Je,az as xt,a0 as Pt,j as At,aK as ea,bp as ta,au as We,ao as aa,ap as la,a3 as kt}from"./main-24jsE5B8.js";import{V as oe}from"./VCardText-Coho3Kj4.js";import{V as $e}from"./VAvatar-Boabezwh.js";import{V as ue}from"./VChip-CqH5M1on.js";import{V as De,a as S}from"./VRow-VuVxoIUW.js";import{V as Vt}from"./VAutocomplete-BLXBsejy.js";import{u as oa,t as vt,V as ft,a as Ge,b as rt,d as dt}from"./VList-BZJmnVxE.js";import{u as ia,V as we,m as sa}from"./VTextField-DwGkqUgg.js";import{V as nt}from"./VSwitch-CICKWjY4.js";import{V as Qe}from"./VSpacer-DUcoug-T.js";import{V as ct}from"./VSnackbar-DwW2OtuO.js";import{P as na}from"./ProductsApi-rZKzdjfA.js";import{u as ra,m as ua,a as da,V as Re}from"./VSelect-DuX3cw0o.js";import{V as ca}from"./VCheckbox-COzQjIG_.js";import{V as He}from"./VDivider-CEqkt4Xn.js";import{a as ma,V as va}from"./VDataTable-BXi48pCg.js";import{V as pa}from"./VContainer-CafCsJqN.js";import{a as Ht,u as fa,P as ga}from"./useProducts-BSraBaz4.js";import{V as Ct}from"./VForm-CHgt9xEL.js";import{V as zt}from"./VTextarea-B5jZClZn.js";import{V as Ee}from"./VTooltip-BQ2s2Au_.js";import{m as _a,V as ka}from"./VImg-BwGI18en.js";import{V as ya,u as ba}from"./useCategories-I0D8ug6N.js";import{u as ha,m as xa,h as wa}from"./filter-aVFjFGO-.js";import{f as Pa}from"./forwardRefs-B931MWyl.js";import{V as Va}from"./VMenu-u44_zTt1.js";import{V as Ca}from"./VCheckboxBtn-DuT5ftrk.js";import{V as Sa}from"./VDataTableServer-ZlJtq5yY.js";import{V as Ia}from"./VSkeletonLoader-lcoxl8ce.js";import{V as $a,a as Da,b as yt,c as bt}from"./VTabs-B36-8sTA.js";import"./api-BRs2FpVe.js";import"./index-D-EbNoF1.js";import"./VOverlay-CFVhjsOG.js";/* empty css              */import"./VTable-CNZWrnp_.js";import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-CZUwri5m.js";const za=Lt({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...xa({filterKeys:["title"]}),...ua({hideNoData:!0,returnObject:!0}),...Wt(sa({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),..._a({transition:!1})},"VCombobox"),Ta=Rt()({name:"VCombobox",props:za(),emits:{"update:focused":I=>!0,"update:modelValue":I=>!0,"update:search":I=>!0,"update:menu":I=>!0},setup(I,be){var n;let{emit:q,slots:D}=be;const{t:J}=qt(),f=$(),Q=mt(!1),T=mt(!0),b=mt(!1),v=$(),j=$(),p=mt(-1);let U=!1;const{items:ce,transformIn:ke,transformOut:H}=oa(I),{textColorClasses:te,textColorStyles:ne}=Nt(()=>{var i;return(i=f.value)==null?void 0:i.color}),G=It(I,"modelValue",[],i=>ke(Ot(i)),i=>{const y=H(i);return I.multiple?y:y[0]??null}),pe=ia(I),z=ve(()=>!!(I.chips||D.chip)),w=ve(()=>z.value||!!D.selection),h=mt(!I.multiple&&!w.value?((n=G.value[0])==null?void 0:n.title)??"":""),g=ve({get:()=>h.value,set:i=>{var y;if(h.value=i??"",!I.multiple&&!w.value&&(G.value=[vt(I,i)]),i&&I.multiple&&((y=I.delimiters)!=null&&y.length)){const M=i.split(new RegExp(`(?:${I.delimiters.join("|")})+`));M.length>1&&(M.forEach(K=>{K=K.trim(),K&&Me(vt(I,K))}),h.value="")}i||(p.value=-1),T.value=!i}}),Y=ve(()=>typeof I.counterValue=="function"?I.counterValue(G.value):typeof I.counterValue=="number"?I.counterValue:I.multiple?G.value.length:g.value.length),{filteredItems:fe,getMatches:ge}=ha(I,ce,()=>T.value?"":g.value),P=ve(()=>I.hideSelected?fe.value.filter(i=>!G.value.some(y=>y.value===i.value)):fe.value),N=ve(()=>I.hideNoData&&!P.value.length||pe.isReadonly.value||pe.isDisabled.value),x=It(I,"menu"),O=ve({get:()=>x.value,set:i=>{var y;x.value&&!i&&((y=v.value)!=null&&y.Î¨openChildren.size)||i&&N.value||(x.value=i)}}),B=jt(()=>O.value?I.closeText:I.openText);Ce(h,i=>{U?ht(()=>U=!1):Q.value&&!O.value&&(O.value=!0),q("update:search",i)}),Ce(G,i=>{var y;!I.multiple&&!w.value&&(h.value=((y=i[0])==null?void 0:y.title)??"")});const k=ve(()=>G.value.map(i=>i.value)),s=ve(()=>{var y;return(I.autoSelectFirst===!0||I.autoSelectFirst==="exact"&&g.value===((y=P.value[0])==null?void 0:y.title))&&P.value.length>0&&!T.value&&!b.value}),a=$(),l=ra(a,f);function u(i){U=!0,I.openOnClear&&(O.value=!0)}function le(){N.value||(O.value=!0)}function L(i){N.value||(Q.value&&(i.preventDefault(),i.stopPropagation()),O.value=!O.value)}function me(i){var y;i.key!==" "&&Dt(i)&&((y=f.value)==null||y.focus())}function Te(i){var K,d,A,X;if(Qt(i)||pe.isReadonly.value)return;const y=(K=f.value)==null?void 0:K.selectionStart,M=G.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(i.key)&&i.preventDefault(),["Enter","ArrowDown"].includes(i.key)&&(O.value=!0),["Escape"].includes(i.key)&&(O.value=!1),["Enter","Escape","Tab"].includes(i.key)&&(s.value&&["Enter","Tab"].includes(i.key)&&!G.value.some(C=>{let{value:se}=C;return se===P.value[0].value})&&Me(fe.value[0]),T.value=!0),i.key==="ArrowDown"&&s.value&&((d=a.value)==null||d.focus("next")),i.key==="Enter"&&g.value&&(Me(vt(I,g.value)),w.value&&(h.value="")),["Backspace","Delete"].includes(i.key)){if(!I.multiple&&w.value&&G.value.length>0&&!g.value)return Me(G.value[0],!1);if(~p.value){i.preventDefault();const C=p.value;Me(G.value[p.value],!1),p.value=C>=M-1?M-2:C}else i.key==="Backspace"&&!g.value&&(p.value=M-1);return}if(I.multiple)if(i.key==="ArrowLeft"){if(p.value<0&&y&&y>0)return;const C=p.value>-1?p.value-1:M-1;G.value[C]?p.value=C:(p.value=-1,(A=f.value)==null||A.setSelectionRange(g.value.length,g.value.length))}else if(i.key==="ArrowRight"){if(p.value<0)return;const C=p.value+1;G.value[C]?p.value=C:(p.value=-1,(X=f.value)==null||X.setSelectionRange(0,0))}else~p.value&&Dt(i)&&(p.value=-1)}function ie(){var i;I.eager&&((i=j.value)==null||i.calculateVisibleItems())}function ze(){var i;Q.value&&(T.value=!0,(i=f.value)==null||i.focus())}function Me(i){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!i||i.props.disabled))if(I.multiple){const M=G.value.findIndex(d=>(I.valueComparator||$t)(d.value,i.value)),K=y??!~M;if(~M){const d=K?[...G.value,i]:[...G.value];d.splice(M,1),G.value=d}else K&&(G.value=[...G.value,i]);I.clearOnSelect&&(g.value="")}else{const M=y!==!1;G.value=M?[i]:[],h.value=M&&!w.value?i.title:"",ht(()=>{O.value=!1,T.value=!0})}}function ot(i){Q.value=!0,setTimeout(()=>{b.value=!0})}function Xe(i){b.value=!1}function V(i){(i==null||i===""&&!I.multiple&&!w.value)&&(G.value=[])}return Ce(Q,(i,y)=>{if(!(i||i===y)&&(p.value=-1,O.value=!1,g.value)){if(I.multiple){Me(vt(I,g.value));return}if(!w.value)return;G.value.some(M=>{let{title:K}=M;return K===g.value})?h.value="":Me(vt(I,g.value))}}),Ce(O,()=>{if(!I.hideSelected&&O.value&&G.value.length){const i=P.value.findIndex(y=>G.value.some(M=>(I.valueComparator||$t)(M.value,y.value)));Gt&&window.requestAnimationFrame(()=>{var y;i>=0&&((y=j.value)==null||y.scrollToIndex(i))})}}),Ce(()=>I.items,(i,y)=>{O.value||Q.value&&!y.length&&i.length&&(O.value=!0)}),Jt(()=>{const i=!!(!I.hideNoData||P.value.length||D["prepend-item"]||D["append-item"]||D["no-data"]),y=G.value.length>0,M=we.filterProps(I);return e(we,xe({ref:f},M,{modelValue:g.value,"onUpdate:modelValue":[K=>g.value=K,V],focused:Q.value,"onUpdate:focused":K=>Q.value=K,validationValue:G.externalValue,counterValue:Y.value,dirty:y,class:["v-combobox",{"v-combobox--active-menu":O.value,"v-combobox--chips":!!I.chips,"v-combobox--selection-slot":!!w.value,"v-combobox--selecting-index":p.value>-1,[`v-combobox--${I.multiple?"multiple":"single"}`]:!0},I.class],style:I.style,readonly:pe.isReadonly.value,placeholder:y?void 0:I.placeholder,"onClick:clear":u,"onMousedown:control":le,onKeydown:Te}),{...D,default:()=>e(Ue,null,[e(Va,xe({ref:v,modelValue:O.value,"onUpdate:modelValue":K=>O.value=K,activator:"parent",contentClass:"v-combobox__content",disabled:N.value,eager:I.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:I.transition,onAfterEnter:ie,onAfterLeave:ze},I.menuProps),{default:()=>[i&&e(ft,xe({ref:a,selected:k.value,selectStrategy:I.multiple?"independent":"single-independent",onMousedown:K=>K.preventDefault(),onKeydown:me,onFocusin:ot,onFocusout:Xe,tabindex:"-1","aria-live":"polite",color:I.itemColor??I.color},l,I.listProps),{default:()=>{var K,d,A;return[(K=D["prepend-item"])==null?void 0:K.call(D),!P.value.length&&!I.hideNoData&&(((d=D["no-data"])==null?void 0:d.call(D))??e(Ge,{key:"no-data",title:J(I.noDataText)},null)),e(da,{ref:j,renderless:!0,items:P.value,itemKey:"value"},{default:X=>{var Se;let{item:C,index:se,itemRef:re}=X;const he=xe(C.props,{ref:re,key:C.value,active:s.value&&se===0?!0:void 0,onClick:()=>Me(C,null)});return((Se=D.item)==null?void 0:Se.call(D,{item:C,index:se,props:he}))??e(Ge,xe(he,{role:"option"}),{prepend:Ve=>{let{isSelected:Ae}=Ve;return e(Ue,null,[I.multiple&&!I.hideSelected?e(Ca,{key:C.value,modelValue:Ae,ripple:!1,tabindex:"-1"},null):void 0,C.props.prependAvatar&&e($e,{image:C.props.prependAvatar},null),C.props.prependIcon&&e(_,{icon:C.props.prependIcon},null)])},title:()=>{var Ve;return T.value?C.title:wa("v-combobox",C.title,(Ve=ge(C))==null?void 0:Ve.title)}})}}),(A=D["append-item"])==null?void 0:A.call(D)]}})]}),G.value.map((K,d)=>{function A(re){re.stopPropagation(),re.preventDefault(),Me(K,!1)}const X={"onClick:close":A,onKeydown(re){re.key!=="Enter"&&re.key!==" "||(re.preventDefault(),re.stopPropagation(),A(re))},onMousedown(re){re.preventDefault(),re.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},C=z.value?!!D.chip:!!D.selection,se=C?Zt(z.value?D.chip({item:K,index:d,props:X}):D.selection({item:K,index:d})):void 0;if(!(C&&!se))return e("div",{key:K.value,class:["v-combobox__selection",d===p.value&&["v-combobox__selection--selected",te.value]],style:d===p.value?ne.value:{}},[z.value?D.chip?e(Yt,{key:"chip-defaults",defaults:{VChip:{closable:I.closableChips,size:"small",text:K.title}}},{default:()=>[se]}):e(ue,xe({key:"chip",closable:I.closableChips,size:"small",text:K.title,disabled:K.props.disabled},X),null):se??e("span",{class:"v-combobox__selection-text"},[K.title,I.multiple&&d<G.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[c(",")])])])})]),"append-inner":function(){var X,C;for(var K=arguments.length,d=new Array(K),A=0;A<K;A++)d[A]=arguments[A];return e(Ue,null,[(X=D["append-inner"])==null?void 0:X.call(D,...d),(!I.hideNoData||I.items.length)&&I.menuIcon?e(_,{class:"v-combobox__menu-icon",color:(C=f.value)==null?void 0:C.fieldIconColor,icon:I.menuIcon,onMousedown:L,onClick:Xt,"aria-label":J(B.value),title:J(B.value),tabindex:"-1"},null):void 0])}})}),Pa({isFocused:Q,isPristine:T,menu:O,search:g,selectionIndex:p,filteredItems:fe,select:Me},f)}}),Ua={class:"d-flex align-center gap-3"},Aa={class:"text-body-2 ma-0 opacity-90"},Ha={class:"d-flex align-center gap-4"},Ma={class:"flex-grow-1"},Ka={class:"text-h6 font-weight-bold mb-1"},Ea={class:"text-body-2 text-medium-emphasis mb-1"},Ba={class:"d-flex align-center gap-4 mb-0"},Fa={class:"text-body-2 text-medium-emphasis mb-0"},Ra={class:"text-body-2 text-info mb-0 font-weight-medium"},La={key:0,class:"text-body-2 text-success mb-0 font-weight-medium"},qa={class:"text-body-1 font-weight-bold"},Na={class:"text-body-1 font-weight-bold"},Oa={class:"text-body-1 font-weight-bold"},ja={class:"text-body-1 font-weight-bold"},Ja={class:"d-flex align-center justify-space-between w-100"},Wa={class:"d-flex align-center"},Qa={key:0,class:"text-warning"},Ga={key:1},Xa={key:0,class:"text-center pa-8"},Za={class:"d-flex align-center gap-4 mt-1"},Ya={key:1,class:"text-primary"},el={class:"d-flex gap-2"},tl=qe({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup(I,{emit:be}){const q=I,D=be,J=ve({get:()=>q.modelValue,set:V=>D("update:modelValue",V)}),f=$(!1),Q=$([]),T=$(!1),b=$(!1),v=$(""),j=$(""),p=$(!1),U=$(-1),ce=$(!1),{loading:ke,currentHPPBreakdown:H,getProductHPPBreakdown:te}=wt(),ne=ve(()=>{var V,n,i;return((V=H.value)==null?void 0:V.total_hpp)||((n=q.product)==null?void 0:n.hpp)||((i=q.product)==null?void 0:i.cost)||0}),G=ve(()=>{var i;const V=((i=q.product)==null?void 0:i.price)||0,n=ne.value;return V-n}),pe=ve(()=>{var i;const V=((i=q.product)==null?void 0:i.price)||0,n=ne.value;return V<=0?0:Math.round((V-n)/V*100)}),z=$({itemId:null,quantity:1,unit:"pcs",isCritical:!1}),w=$([]),h=$(!1),g=$([]),Y=async()=>{var V;if(q.product)try{const n=q.product.id_product||q.product.id,i=await gt.getAll({product_id:n,page:1,per_page:1e5});i.success&&((V=i.data)!=null&&V.data)&&(Q.value=i.data.data,g.value=JSON.parse(JSON.stringify(i.data.data)),console.log("ðŸ“¥ Fetched composition items:",i.data.data),i.data.data.length>0&&console.log("ðŸ“¥ First item structure:",{full:i.data.data[0],item:i.data.data[0].item,item_id:i.data.data[0].item_id,id_product_item:i.data.data[0].id_product_item}))}catch(n){console.error("Error fetching product composition:",n)}},fe=async()=>{var V;h.value=!0;try{const n=await Bt.getAll({page:1,per_page:1e5,active:!0});n.success&&((V=n.data)!=null&&V.data)&&(w.value=n.data.data.map(i=>{var y,M,K;return{id:((y=i.id_item)==null?void 0:y.toString())||((M=i.id)==null?void 0:M.toString()),name:i.name,current_stock:((K=i.inventory)==null?void 0:K.current_stock)||0,unit:i.unit||"pcs"}}))}catch(n){console.error("Error fetching available items:",n),w.value=[]}finally{h.value=!1}},ge=ve(()=>z.value.itemId&&z.value.quantity>0);ve(()=>{if(!z.value.itemId)return null;const V=w.value.find(n=>n.id===z.value.itemId);return(V==null?void 0:V.unit)||null});const P=ve(()=>{if(!z.value.itemId)return null;const V=w.value.find(n=>n.id===z.value.itemId);return V?O(V):null}),N=ve(()=>P.value!==null&&P.value<=0),x=ve(()=>Array.isArray(w.value)?w.value:[]),O=V=>V.current_stock||V.stock||0,B=()=>h.value?"Memuat items...":!w.value||w.value.length===0?"Tidak ada item tersedia":"Tidak ada item yang ditemukan",k=V=>{const n=O(V);return n>50?"success":n>20?"warning":n>0?"error":"grey"},s=V=>{const n=O(V);return n>50?"Aman":n>20?"Rendah":n>0?"Kritis":"Habis"};Ce(()=>q.items,V=>{V&&V.length>0,Q.value=[...V]},{immediate:!0}),Ce(()=>q.modelValue,async V=>{V&&q.product&&(Y(),await a())});const a=async()=>{if(q.product&&(q.product.id_product||q.product.id))try{const V=parseInt(String(q.product.id_product||q.product.id));await te(V,"latest")}catch(V){console.warn("Could not load HPP data:",V)}};ut(()=>{fe()});const l=()=>{ce.value=!0},u=async()=>{await a(),D("refresh")},le=()=>Q.value.some(n=>{var i;return((i=n.item)==null?void 0:i.inventory)&&n.item.inventory.current_stock<n.quantity_needed})?"error":"success",L=()=>Q.value.some(n=>{var i;return((i=n.item)==null?void 0:i.inventory)&&n.item.inventory.current_stock<n.quantity_needed})?"Stok Kritis":"Stok Aman",me=()=>{if(!ge.value)return;const V=w.value.find(y=>y.id===z.value.itemId);if(!V)return;if(Q.value.find(y=>{var K,d;const M=((K=y.item)==null?void 0:K.id)||((d=y.item)==null?void 0:d.id_item)||y.item_id;return String(M)===String(V.id)})){v.value=`Item "${V.name}" sudah ada dalam komposisi produk ini. Silakan edit item yang sudah ada.`,T.value=!0;return}const i={id_product_item:`temp_${Date.now()}`,item:{id:String(V.id),name:V.name,inventory:{current_stock:V.current_stock||0}},quantity_needed:z.value.quantity,unit:z.value.unit,is_critical:z.value.isCritical};Q.value.push(i),ze()},Te=(V,n)=>{var M,K;if(w.value.length===0){console.warn("âš ï¸ Available items not loaded yet, fetching..."),fe().then(()=>{Te(V,n)});return}p.value=!0,U.value=n;let i=((M=V.item)==null?void 0:M.id)||((K=V.item)==null?void 0:K.id_item)||V.item_id||null;if(i!==null&&(i=i.toString()),console.log("âœï¸ Edit Item:",{itemId:i,item:V,item_item:V.item,item_id_root:V.item_id}),z.value={itemId:i,quantity:parseFloat(V.quantity_needed.toString())||0,unit:V.unit,isCritical:V.is_critical},!w.value.find(d=>d.id===i)){console.warn("âš ï¸ Item ID not found in available items, trying alternative matching...");const d=w.value.find(A=>{var X;return A.name===((X=V.item)==null?void 0:X.name)});d?z.value.itemId=d.id:console.error("âŒ Could not find item in available items by ID or name")}},ie=()=>{var K,d;if(!ge.value||U.value===-1)return;const V=w.value.find(A=>A.id===z.value.itemId);if(!V)return;const n=Q.value[U.value],i=((K=n.item)==null?void 0:K.id)||((d=n.item)==null?void 0:d.id_item)||n.item_id,y=V.id,M=String(i)!==String(y);if(M&&Q.value.find((X,C)=>{var re,he;if(C===U.value)return!1;const se=((re=X.item)==null?void 0:re.id)||((he=X.item)==null?void 0:he.id_item)||X.item_id;return String(se)===String(y)})){v.value=`Item "${V.name}" sudah ada dalam komposisi produk ini. Silakan edit item yang sudah ada.`,T.value=!0;return}console.log("ðŸ”„ Update Item:",{hasItemChanged:M,currentItemId:i,selectedItemId:y,currentProductItemId:n.id_product_item,currentItem:n}),Q.value[U.value]={...Q.value[U.value],id_product_item:M?`temp_${Date.now()}`:n.id_product_item,item_id:parseInt(String(y)),item:{id:String(V.id),id_item:parseInt(String(V.id)),name:V.name,inventory:{current_stock:V.current_stock||0}},quantity_needed:z.value.quantity,unit:z.value.unit,is_critical:z.value.isCritical},ze()},ze=()=>{p.value=!1,U.value=-1,z.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},Me=V=>{Q.value.splice(V,1)},ot=async()=>{var V,n,i,y,M,K,d,A,X,C,se,re,he,Se,Ve,Ae;if(q.product){f.value=!0;try{const Le=parseInt(String(((V=q.product)==null?void 0:V.id_product)||((n=q.product)==null?void 0:n.id)||"0")),et=g.value||[],Ze=Q.value;for(const de of Ze)if(String(de.id_product_item||"").startsWith("temp_")){const Ne=((i=de.item)==null?void 0:i.id)||((y=de.item)==null?void 0:y.id_item)||de.item_id,Be=et.find(tt=>{var ye,ee;const it=((ye=tt.item)==null?void 0:ye.id)||((ee=tt.item)==null?void 0:ee.id_item)||tt.item_id,st=Ze.find(at=>at.id_product_item===tt.id_product_item&&!String(at.id_product_item).startsWith("temp_"));return String(it)===String(Ne)&&!st});Be&&(console.log("ðŸ”„ Converting DELETE+CREATE to UPDATE:",{item_name:(M=de.item)==null?void 0:M.name,old_id:Be.id_product_item,temp_id:de.id_product_item}),de.id_product_item=Be.id_product_item)}for(const de of Ze){const Ie=et.find(Be=>{const tt=Be.id_product_item,it=de.id_product_item;if(!it||String(it).startsWith("temp_"))return!1;const st=parseInt(String(tt)),ye=parseInt(String(it));return!isNaN(st)&&!isNaN(ye)&&st===ye?(console.log("âœ… Found existing match:",st,"===",ye),!0):!1});if(console.log("ðŸ” Item matching result:",{item_name:(K=de.item)==null?void 0:K.name,current_id_product_item:de.id_product_item,current_id_type:typeof de.id_product_item,existingItem_found:!!Ie,existingItem_id:Ie==null?void 0:Ie.id_product_item,existingItem_id_type:typeof(Ie==null?void 0:Ie.id_product_item)}),!((d=de.item)!=null&&d.id)||parseInt(de.item.id)===0){console.warn("âš ï¸ Skipping item with invalid item_id:",{item_name:(A=de.item)==null?void 0:A.name,item_id:(X=de.item)==null?void 0:X.id,full_item:de});continue}const Ne={product_id:Le,item_id:parseInt(((C=de.item)==null?void 0:C.id)||"0"),quantity_needed:parseFloat(de.quantity_needed.toString()),unit:de.unit||"",is_critical:de.is_critical,notes:de.notes||""};console.log("ðŸ” Processing item:",{item_name:(se=de.item)==null?void 0:se.name,item_id:(re=de.item)==null?void 0:re.id,id_product_item:de.id_product_item,existingItem:Ie?{id:Ie.id_product_item,item_id:(he=Ie.item)==null?void 0:he.id}:null,action:Ie&&Ie.id_product_item?"UPDATE":"CREATE"});try{Ie&&Ie.id_product_item&&!Ie.id_product_item.toString().startsWith("temp_")?(console.log("ðŸ“ Updating item:",Ie.id_product_item),await gt.update(parseInt(Ie.id_product_item),Ne)):(console.log("âž• Creating new item"),await gt.create(Ne))}catch(Be){throw console.error("âŒ Error processing item:",Be),(Se=Be.message)!=null&&Se.includes("already assigned")?v.value=`Item "${(Ve=de.item)==null?void 0:Ve.name}" sudah ditambahkan ke produk ini`:v.value=Be.message||"Terjadi kesalahan saat menyimpan item",T.value=!0,Be}}for(const de of et)if(!Ze.find(Ne=>String(Ne.id_product_item)===String(de.id_product_item))&&de.id_product_item)try{console.log("ï¿½ï¸ Deleting item:",de.id_product_item,(Ae=de.item)==null?void 0:Ae.name),await gt.delete(parseInt(String(de.id_product_item)))}catch(Ne){console.error("âŒ Error deleting item:",Ne),v.value=`Gagal menghapus item: ${Ne.message}`,T.value=!0}j.value="Komposisi produk berhasil disimpan!",b.value=!0,D("save",{product:q.product,items:Q.value}),D("refresh"),Xe()}catch(Le){console.error("âŒ Error saving composition:",Le),T.value||(v.value=Le.message||"Terjadi kesalahan saat menyimpan komposisi",T.value=!0)}finally{f.value=!1}}},Xe=()=>{J.value=!1,setTimeout(()=>{Q.value=[...q.items],ze()},300)};return(V,n)=>{var i,y,M,K;return m(),Z(Ue,null,[e(Oe,{modelValue:J.value,"onUpdate:modelValue":n[8]||(n[8]=d=>J.value=d),"max-width":"900",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var d;return[o("div",Ua,[e(_,{icon:"mdi-chef-hat",size:"24"}),o("div",null,[n[11]||(n[11]=o("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),o("p",Aa,r(((d=V.product)==null?void 0:d.name)||"Produk"),1)])]),e(R,{icon:"mdi-close",variant:"text",size:"small",onClick:Xe})]}),_:1}),e(oe,{class:"pa-6 dialog-content"},{default:t(()=>[e(ae,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(oe,{class:"pa-4"},{default:t(()=>{var d,A,X,C,se,re;return[o("div",Ha,[e($e,{image:(d=V.product)==null?void 0:d.image_url,size:"64"},{default:t(()=>{var he;return[(he=V.product)!=null&&he.image_url?W("",!0):(m(),F(_,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),o("div",Ma,[o("h4",Ka,r((A=V.product)==null?void 0:A.name),1),o("p",Ea," SKU: "+r(((X=V.product)==null?void 0:X.sku)||"SKU-"+((C=V.product)==null?void 0:C.id_product)),1),o("div",Ba,[o("p",Fa," Harga: "+r(E(Ke)(((se=V.product)==null?void 0:se.price)||0)),1),o("p",Ra," HPP: "+r(E(Ke)(ne.value)),1),(re=V.product)!=null&&re.price&&ne.value?(m(),Z("p",La," Margin: "+r(E(Ke)(G.value)),1)):W("",!0)])]),e(ue,{color:le(),variant:"tonal"},{default:t(()=>[c(r(L()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e(De,{class:"mb-6"},{default:t(()=>[e(S,{cols:"12",md:"3"},{default:t(()=>[e(ae,{variant:"outlined",color:"info"},{default:t(()=>[e(oe,{class:"text-center pa-3"},{default:t(()=>[e(_,{icon:"mdi-calculator",size:"20",class:"mb-1"}),o("div",qa,[c(r(E(Ke)(ne.value))+" ",1),E(ke)?(m(),F(pt,{key:0,indeterminate:"",size:"12",width:"2",class:"ml-1"})):W("",!0)]),n[12]||(n[12]=o("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[12]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(ae,{variant:"outlined",color:"primary"},{default:t(()=>[e(oe,{class:"text-center pa-3"},{default:t(()=>{var d;return[e(_,{icon:"mdi-currency-usd",size:"20",class:"mb-1"}),o("div",Na,r(E(Ke)(((d=V.product)==null?void 0:d.price)||0)),1),n[13]||(n[13]=o("div",{class:"text-caption"},"Harga Jual",-1))]}),_:1,__:[13]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(ae,{variant:"outlined",color:"success"},{default:t(()=>[e(oe,{class:"text-center pa-3"},{default:t(()=>[e(_,{icon:"mdi-trending-up",size:"20",class:"mb-1"}),o("div",Oa,r(E(Ke)(G.value)),1),n[14]||(n[14]=o("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[14]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(ae,{variant:"outlined",color:"warning"},{default:t(()=>[e(oe,{class:"text-center pa-3"},{default:t(()=>[e(_,{icon:"mdi-percent",size:"20",class:"mb-1"}),o("div",ja,r(pe.value)+"% ",1),n[15]||(n[15]=o("div",{class:"text-caption"},"Margin %",-1))]),_:1,__:[15]})]),_:1})]),_:1})]),_:1}),e(ae,{class:"mb-6",elevation:"2"},{default:t(()=>[e(Pe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[o("div",Ja,[o("div",Wa,[e(_,{icon:p.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),c(" "+r(p.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(oe,{class:"pa-4"},{default:t(()=>[e(De,null,{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>[e(Vt,{modelValue:z.value.itemId,"onUpdate:modelValue":n[0]||(n[0]=d=>z.value.itemId=d),items:x.value,loading:h.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item (termasuk yang stok kosong)...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":B()},{item:t(({props:d,item:A})=>[e(Ge,xe(d,{class:{"text-medium-emphasis":O(A.raw)<=0}}),{prepend:t(()=>[e($e,{size:"32",class:"me-3",color:O(A.raw)<=0?"warning":"primary",variant:"tonal"},{default:t(()=>[e(_,{icon:"mdi-package-variant",color:O(A.raw)<=0?"warning":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[O(A.raw)>0?(m(),F(ue,{key:0,size:"x-small",color:k(A.raw),variant:"tonal"},{default:t(()=>[c(r(s(A.raw)),1)]),_:2},1032,["color"])):(m(),F(ue,{key:1,size:"x-small",color:"warning",variant:"tonal","prepend-icon":"mdi-alert"},{default:t(()=>n[17]||(n[17]=[c(" Kosong ")])),_:1,__:[17]}))]),default:t(()=>[e(rt,null,{default:t(()=>[c(r(A.raw.name),1)]),_:2},1024),e(dt,{class:"text-medium-emphasis"},{default:t(()=>[O(A.raw)<=0?(m(),Z("span",Qa,[e(_,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),n[16]||(n[16]=c(" Stok Kosong - Masih bisa digunakan "))])):(m(),Z("span",Ga," Stok: "+r(O(A.raw))+" "+r(A.raw.unit),1))]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(we,{modelValue:z.value.quantity,"onUpdate:modelValue":n[1]||(n[1]=d=>z.value.quantity=d),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(nt,{modelValue:z.value.isCritical,"onUpdate:modelValue":n[2]||(n[2]=d=>z.value.isCritical=d),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(R,{color:p.value?"success":"primary",block:"","prepend-icon":p.value?"mdi-check":"mdi-plus",onClick:n[3]||(n[3]=d=>p.value?ie():me()),disabled:!ge.value},{default:t(()=>[c(r(p.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),p.value?(m(),F(R,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:ze},{default:t(()=>n[18]||(n[18]=[c(" Batal ")])),_:1,__:[18]})):W("",!0)]),_:1})]),_:1}),N.value?(m(),F(Fe,{key:0,color:"warning",variant:"tonal",class:"mt-4","prepend-icon":"mdi-alert"},{default:t(()=>[e(_t,null,{default:t(()=>n[19]||(n[19]=[c("Item Stok Kosong")])),_:1,__:[19]}),n[20]||(n[20]=o("div",null,"Item yang dipilih sedang kosong stok, namun masih bisa ditambahkan ke komposisi. Pastikan untuk memperbarui stok sebelum produksi.",-1))]),_:1,__:[20]})):W("",!0)]),_:1})]),_:1}),e(ae,{elevation:"2"},{default:t(()=>[e(Pe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e(_,{icon:"mdi-format-list-bulleted",class:"me-2"}),c(" Daftar Item Komposisi ("+r(Q.value.length)+") ",1)]),_:1}),e(oe,{class:"pa-0"},{default:t(()=>[Q.value.length===0?(m(),Z("div",Xa,[e(_,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),n[21]||(n[21]=o("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),n[22]||(n[22]=o("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(m(),F(ft,{key:1},{default:t(()=>[(m(!0),Z(Ue,null,Ye(Q.value,(d,A)=>(m(),F(Ge,{key:d.id||A,class:"border-b"},{prepend:t(()=>[e($e,{size:"40",class:"me-3"},{default:t(()=>{var X,C;return[e(_,{icon:(X=d.item)!=null&&X.inventory&&d.item.inventory.current_stock>=d.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(C=d.item)!=null&&C.inventory&&d.item.inventory.current_stock>=d.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[o("div",el,[e(R,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:X=>Te(d,A)},null,8,["onClick"]),e(R,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:X=>Me(A)},null,8,["onClick"])])]),default:t(()=>[e(rt,{class:"font-weight-medium"},{default:t(()=>{var X;return[c(r(((X=d.item)==null?void 0:X.name)||"Item tidak ditemukan")+" ",1),d.is_critical?(m(),F(ue,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>n[23]||(n[23]=[c(" Kritis ")])),_:1,__:[23]})):W("",!0)]}),_:2},1024),e(dt,null,{default:t(()=>{var X;return[o("div",Za,[o("span",null,"Dibutuhkan: "+r(parseFloat(d.quantity_needed.toString()))+" "+r(d.unit),1),(X=d.item)!=null&&X.inventory?(m(),Z("span",{key:0,class:lt(d.item.inventory.current_stock>=d.quantity_needed?"text-success":"text-error")}," Stok: "+r(d.item.inventory.current_stock)+" "+r(d.unit),3)):W("",!0),d.formatted_total_cost?(m(),Z("span",Ya,r(d.formatted_total_cost),1)):W("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(je,{class:"pa-6 dialog-footer"},{default:t(()=>[e(R,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:l},{default:t(()=>n[24]||(n[24]=[c(" Setting HPP ")])),_:1,__:[24]}),e(Qe),e(R,{variant:"outlined",onClick:Xe},{default:t(()=>n[25]||(n[25]=[c(" Batal ")])),_:1,__:[25]}),e(R,{color:"primary",onClick:ot,loading:f.value},{default:t(()=>n[26]||(n[26]=[c(" Simpan Komposisi ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1}),e(ct,{modelValue:T.value,"onUpdate:modelValue":n[5]||(n[5]=d=>T.value=d),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:n[4]||(n[4]=d=>T.value=!1)},{default:t(()=>n[27]||(n[27]=[c(" Tutup ")])),_:1,__:[27]})]),default:t(()=>[c(r(v.value)+" ",1)]),_:1},8,["modelValue"]),e(ct,{modelValue:b.value,"onUpdate:modelValue":n[7]||(n[7]=d=>b.value=d),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:n[6]||(n[6]=d=>b.value=!1)},{default:t(()=>n[28]||(n[28]=[c(" Tutup ")])),_:1,__:[28]})]),default:t(()=>[c(r(j.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(Ft,{modelValue:ce.value,"onUpdate:modelValue":n[9]||(n[9]=d=>ce.value=d),"product-id":parseInt(String(((i=V.product)==null?void 0:i.id_product)||((y=V.product)==null?void 0:y.id)||"0")),"product-name":((M=V.product)==null?void 0:M.product_name)||((K=V.product)==null?void 0:K.name),onHppUpdated:u,onPriceUpdated:n[10]||(n[10]=d=>D("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),Mt=Je(tl,[["__scopeId","data-v-05194dd2"]]),al={class:"product-selection"},ll={key:0,class:"text-center pa-4"},ol={key:1,class:"product-list",style:{"max-height":"400px","overflow-y":"auto"}},il={class:"d-flex flex-column align-end"},sl={key:0,class:"text-body-2 text-primary font-weight-medium"},nl={key:2,class:"text-center pa-8"},rl={class:"text-h6 mt-2 text-medium-emphasis"},ul={class:"text-body-2 text-medium-emphasis"},dl=qe({__name:"ProductSelectionList",emits:["select"],setup(I,{emit:be}){const q=be,D=$([]),J=$(!1),f=$(""),Q=async()=>{try{J.value=!0;const b=await na.getAll({per_page:100,search:f.value,active:!0});b.success&&(D.value=b.data||[])}catch(b){console.error("Error fetching products:",b)}finally{J.value=!1}},T=b=>{q("select",b)};return ut(()=>{Q()}),(b,v)=>(m(),Z("div",al,[e(we,{modelValue:f.value,"onUpdate:modelValue":[v[0]||(v[0]=j=>f.value=j),Q],label:"Cari produk...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",class:"mb-3"},null,8,["modelValue"]),J.value?(m(),Z("div",ll,[e(pt,{indeterminate:"",color:"primary"}),v[1]||(v[1]=o("div",{class:"mt-2"},"Memuat produk...",-1))])):D.value.length>0?(m(),Z("div",ol,[e(ft,{density:"compact"},{default:t(()=>[(m(!0),Z(Ue,null,Ye(D.value,j=>(m(),F(Ge,{key:j.id_product||j.id,class:"product-item",onClick:p=>T(j),style:{cursor:"pointer"},ripple:!0},{prepend:t(()=>[j.image_url?(m(),F($e,{key:0,image:j.image_url,size:"32",class:"me-3"},null,8,["image"])):(m(),F(_,{key:1,icon:"mdi-package-variant",size:"32",color:"grey-lighten-1",class:"me-3"}))]),append:t(()=>[o("div",il,[j.price?(m(),Z("div",sl,r(j.formatted_price||E(Ke)(j.price)),1)):W("",!0),e(_,{icon:"mdi-chevron-right",size:"16",color:"grey-lighten-1"})])]),default:t(()=>[e(rt,{class:"text-body-2"},{default:t(()=>[c(r(j.name),1)]),_:2},1024),j.sku?(m(),F(dt,{key:0,class:"text-caption"},{default:t(()=>[c(" SKU: "+r(j.sku),1)]),_:2},1024)):W("",!0)]),_:2},1032,["onClick"]))),128))]),_:1})])):(m(),Z("div",nl,[e(_,{icon:"mdi-package-variant-closed",size:"64",color:"grey-lighten-2"}),o("div",rl,r(f.value?"Tidak ada produk ditemukan":"Belum ada produk"),1),o("div",ul,r(f.value?"Coba ubah kata kunci pencarian":"Tambah produk terlebih dahulu"),1)]))]))}}),cl=Je(dl,[["__scopeId","data-v-1280b878"]]),ml={class:"composition-cards"},vl={class:"d-flex gap-2"},pl={key:1,class:"text-center pa-12"},fl={key:2,class:"text-center pa-12"},gl={class:"d-flex align-center gap-3"},_l={class:"flex-grow-1 min-width-0"},kl={class:"text-h6 font-weight-bold text-truncate"},yl={class:"text-caption text-medium-emphasis mb-0"},bl={class:"d-flex align-center gap-2 mb-3"},hl={class:"text-body-2 font-weight-medium"},xl={class:"composition-items"},wl={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},Pl={class:"text-body-2 text-truncate"},Vl={class:"text-end flex-shrink-0"},Cl={class:"text-body-2 font-weight-medium"},Sl={key:0,class:"text-caption text-success"},Il={key:1,class:"text-caption text-primary"},$l={class:"d-flex justify-between align-center mb-3"},Dl={class:"text-h6 font-weight-bold text-primary"},zl={class:"d-flex gap-2"},Tl={key:4,class:"d-flex justify-center mt-6"},Ul={key:5,class:"text-center mt-4"},Al={class:"d-flex align-center"},Hl={class:"d-flex align-center gap-4"},Ml={class:"flex-grow-1"},Kl={class:"text-h5 font-weight-bold mb-2"},El={class:"d-flex align-center gap-4 mb-2"},Bl={class:"text-body-2"},Fl={class:"d-flex align-center gap-4"},Rl={class:"text-h6 text-primary font-weight-bold"},Ll={class:"text-body-2 text-info font-weight-medium"},ql={key:0,class:"text-body-2 text-success font-weight-medium"},Nl={class:"d-flex align-center mt-1 gap-4"},Ol={class:"d-flex align-center"},jl={class:"d-flex align-center"},Jl={key:0,class:"d-flex align-center"},Wl={class:"text-primary font-weight-medium"},Ql={key:1,class:"text-center py-8"},Gl={class:"text-h6 font-weight-bold"},Xl={class:"text-h6 font-weight-bold"},Zl={class:"text-h6 font-weight-bold"},Yl={class:"text-h6 font-weight-bold"},eo={class:"text-h6 font-weight-bold"},to=qe({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup(I,{emit:be}){const q=I,D=be,J=$(!1),f=$(!1),Q=$(!1),T=$(null),b=$([]),v=$(null),j=$(1),p=$(12),U=$({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),ce=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],ke=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],H=s=>{T.value=s,b.value=s.items||[],J.value=!0},te=()=>{Q.value=!0},ne=s=>{T.value=s,b.value=[],Q.value=!1,J.value=!0},G=()=>{D("refresh"),k()},pe=s=>{v.value=s,f.value=!0},z=()=>{U.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},w=ve(()=>!!(U.value.search||U.value.stockStatus||U.value.itemType||U.value.criticalOnly||U.value.sortBy!=="name_asc")),h=ve(()=>{let s=0;return U.value.search&&s++,U.value.stockStatus&&s++,U.value.itemType&&s++,U.value.criticalOnly&&s++,U.value.sortBy!=="name_asc"&&s++,s}),g=ve(()=>{const s=new Map;q.productItems.forEach(l=>{if(!l.product)return;const u=l.product.id_product||l.product.id;s.has(u)||s.set(u,{...l.product,items:[],totalItems:0}),s.get(u).items.push(l),s.get(u).totalItems++});let a=Array.from(s.values());if(U.value.search){const l=U.value.search.toLowerCase();a=a.filter(u=>u.name.toLowerCase().includes(l)||u.sku&&u.sku.toLowerCase().includes(l)||u.items.some(le=>{var L;return(L=le.item)==null?void 0:L.name.toLowerCase().includes(l)}))}return U.value.stockStatus&&(a=a.filter(l=>{const u=ge(l);switch(U.value.stockStatus){case"safe":return u.color==="success";case"critical":return u.color==="warning";case"out":return u.color==="error";default:return!0}})),U.value.criticalOnly&&(a=a.filter(l=>l.items.some(u=>u.is_critical))),a.sort((l,u)=>{switch(U.value.sortBy){case"name_asc":return l.name.localeCompare(u.name);case"name_desc":return u.name.localeCompare(l.name);case"price_asc":return(l.price||0)-(u.price||0);case"price_desc":return(u.price||0)-(l.price||0);case"items_asc":return l.totalItems-u.totalItems;case"items_desc":return u.totalItems-l.totalItems;default:return l.name.localeCompare(u.name)}}),a}),Y=ve(()=>Math.ceil(g.value.length/p.value)),fe=ve(()=>{const s=(j.value-1)*p.value,a=s+p.value;return g.value.slice(s,a)}),ge=s=>{let a=!1,l=!1;return s.items.forEach(u=>{var le;if((le=u.item)!=null&&le.inventory){const L=u.item.inventory.current_stock||0,me=u.quantity_needed||0;L<=0?a=!0:(L<me||u.is_critical)&&(l=!0)}}),a?{text:"Stok Habis",color:"error"}:l?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},P=s=>{if(!(s!=null&&s.inventory))return"grey";const a=s.inventory.current_stock||0;return a<=0?"error":a<=10?"warning":"success"},N=s=>{if(!(s!=null&&s.inventory))return"Tidak ada data";const a=s.inventory.current_stock||0;return a<=0?"Habis":a<=10?"Rendah":"Aman"},x=s=>{const a=P(s);return{"text-error":a==="error","text-warning":a==="warning","text-success":a==="success","text-grey":a==="grey"}},O=s=>`Item Komposisi (${s})`,B=s=>{j.value=s},k=()=>{j.value=1};return Ce(()=>[U.value.search,U.value.stockStatus,U.value.criticalOnly,U.value.sortBy],()=>{k()}),(s,a)=>(m(),Z("div",ml,[e(ae,{class:"mb-6"},{default:t(()=>[e(Pe,{class:"d-flex align-center justify-between"},{default:t(()=>[a[16]||(a[16]=o("div",null,[o("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),o("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),o("div",vl,[e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:te},{default:t(()=>a[14]||(a[14]=[c(" Tambah Komposisi ")])),_:1,__:[14]}),e(R,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:a[0]||(a[0]=l=>D("refresh")),loading:s.loading},{default:t(()=>a[15]||(a[15]=[c(" Refresh ")])),_:1,__:[15]},8,["loading"])])]),_:1,__:[16]})]),_:1}),e(ae,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(oe,null,{default:t(()=>[e(De,null,{default:t(()=>[e(S,{cols:"12",md:"3"},{default:t(()=>[e(we,{modelValue:U.value.search,"onUpdate:modelValue":a[1]||(a[1]=l=>U.value.search=l),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Re,{modelValue:U.value.stockStatus,"onUpdate:modelValue":a[2]||(a[2]=l=>U.value.stockStatus=l),items:ce,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Re,{modelValue:U.value.sortBy,"onUpdate:modelValue":a[3]||(a[3]=l=>U.value.sortBy=l),items:ke,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(ca,{modelValue:U.value.criticalOnly,"onUpdate:modelValue":a[4]||(a[4]=l=>U.value.criticalOnly=l),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(De,{class:"mt-3"},{default:t(()=>[e(S,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(R,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:z,disabled:!w.value},{default:t(()=>a[17]||(a[17]=[c(" Reset Filter ")])),_:1,__:[17]},8,["disabled"]),w.value?(m(),F(ue,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[c(r(h.value)+" filter aktif ",1)]),_:1})):W("",!0)]),_:1}),e(S,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(ue,{color:g.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[c(r(g.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!s.loading&&g.value.length===0&&w.value?(m(),F(Fe,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):W("",!0),s.loading?(m(),Z("div",pl,[e(pt,{color:"primary",indeterminate:"",size:"64"}),a[18]||(a[18]=o("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):g.value.length===0?(m(),Z("div",fl,[e(_,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),a[20]||(a[20]=o("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),a[21]||(a[21]=o("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(R,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:te},{default:t(()=>a[19]||(a[19]=[c(" Buat Komposisi Pertama ")])),_:1,__:[19]})])):(m(),F(De,{key:3},{default:t(()=>[(m(!0),Z(Ue,null,Ye(fe.value,l=>(m(),F(S,{key:l.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ae,{class:lt(["composition-card h-100",{"border-error":ge(l).color==="error"}]),elevation:"2"},{default:t(()=>[e(Pe,{class:"pa-4 pb-2"},{default:t(()=>[o("div",gl,[e($e,{image:l.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[l.image_url?W("",!0):(m(),F(_,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),o("div",_l,[o("h3",kl,r(l.name),1),o("p",yl,r(l.sku||"SKU-"+l.id_product),1)])])]),_:2},1024),e(oe,{class:"py-2"},{default:t(()=>[e(ue,{color:ge(l).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[c(r(ge(l).text),1)]),_:2},1032,["color"]),o("div",bl,[e(_,{icon:"mdi-format-list-bulleted",size:"16"}),o("span",hl,r(O(l.totalItems)),1)]),o("div",xl,[(m(!0),Z(Ue,null,Ye(l.items,u=>{var le,L,me,Te;return m(),Z("div",{key:u.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[o("div",wl,[e(_,{icon:(le=u.item)!=null&&le.inventory&&u.item.inventory.current_stock>=u.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(L=u.item)!=null&&L.inventory&&u.item.inventory.current_stock>=u.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),o("span",Pl,r(((me=u.item)==null?void 0:me.name)||"Item tidak ditemukan"),1),u.is_critical?(m(),F(ue,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>a[22]||(a[22]=[c(" Kritis ")])),_:1,__:[22]})):W("",!0)]),o("div",Vl,[o("div",Cl,r(parseFloat(u.quantity_needed))+" "+r(u.unit),1),(Te=u.item)!=null&&Te.inventory?(m(),Z("div",Sl," Stok: "+r(u.item.inventory.current_stock)+" "+r(u.unit),1)):W("",!0),u.formatted_total_cost?(m(),Z("div",Il,r(u.formatted_total_cost),1)):W("",!0)])])}),128))])]),_:2},1024),e(oe,{class:"pt-0"},{default:t(()=>[e(He,{class:"mb-3"}),o("div",$l,[a[23]||(a[23]=o("span",{class:"text-body-2"},"Harga:",-1)),o("span",Dl,r(E(Ke)(l.price||0)),1)]),o("div",zl,[e(R,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:u=>pe(l)},{default:t(()=>a[24]||(a[24]=[c(" Detail ")])),_:2,__:[24]},1032,["onClick"]),e(R,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:u=>H(l)},{default:t(()=>a[25]||(a[25]=[c(" Kelola ")])),_:2,__:[25]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),g.value.length>p.value?(m(),Z("div",Tl,[e(ma,{modelValue:j.value,"onUpdate:modelValue":[a[5]||(a[5]=l=>j.value=l),B],length:Y.value,"total-visible":s.$vuetify.display.smAndDown?5:7,size:"small"},null,8,["modelValue","length","total-visible"])])):W("",!0),g.value.length>0?(m(),Z("div",Ul,[e(ue,{variant:"tonal",color:"primary",size:"small"},{default:t(()=>[c(" Menampilkan "+r((j.value-1)*p.value+1)+"-"+r(Math.min(j.value*p.value,g.value.length))+" dari "+r(g.value.length)+" produk ",1)]),_:1})])):W("",!0),e(Mt,{modelValue:J.value,"onUpdate:modelValue":a[6]||(a[6]=l=>J.value=l),product:T.value,items:b.value,onSave:G,onRefresh:a[7]||(a[7]=l=>D("refresh"))},null,8,["modelValue","product","items"]),e(Oe,{modelValue:f.value,"onUpdate:modelValue":a[11]||(a[11]=l=>f.value=l),"max-width":"900",scrollable:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",Al,[e(_,{icon:"mdi-eye",class:"mr-2",color:"primary"}),a[26]||(a[26]=o("span",null,"Detail Komposisi Produk",-1))]),e(R,{icon:"",variant:"text",onClick:a[8]||(a[8]=l=>f.value=!1)},{default:t(()=>[e(_,{icon:"mdi-close"})]),_:1})]),_:1}),e(He),v.value?(m(),F(oe,{key:0},{default:t(()=>[e(pa,null,{default:t(()=>[e(De,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(ae,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(oe,null,{default:t(()=>[o("div",Hl,[e($e,{image:v.value.image_url,size:"80"},{default:t(()=>[v.value.image_url?W("",!0):(m(),F(_,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),o("div",Ml,[o("h2",Kl,r(v.value.name),1),o("div",El,[e(ue,{color:ge(v.value).color,variant:"tonal",size:"small"},{default:t(()=>[c(r(ge(v.value).text),1)]),_:1},8,["color"]),o("span",Bl,"SKU: "+r(v.value.sku||"-"),1)]),o("div",Fl,[o("div",Rl,r(E(Ke)(v.value.price||0)),1),o("div",Ll," HPP: "+r(E(Ke)(v.value.hpp||v.value.cost||0)),1),v.value.price&&(v.value.hpp||v.value.cost)?(m(),Z("div",ql," Margin: "+r(E(Ke)((v.value.price||0)-(v.value.hpp||v.value.cost||0))),1)):W("",!0)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e(De,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(ae,{variant:"outlined"},{default:t(()=>[e(Pe,{class:"text-h6"},{default:t(()=>[e(_,{icon:"mdi-format-list-bulleted",class:"mr-2"}),c(" Komposisi Item ("+r(v.value.totalItems||0)+") ",1)]),_:1}),e(oe,null,{default:t(()=>[v.value.items&&v.value.items.length>0?(m(),F(ft,{key:0},{default:t(()=>[(m(!0),Z(Ue,null,Ye(v.value.items,(l,u)=>(m(),F(Ge,{key:l.id_product_item,class:"px-0"},{prepend:t(()=>[e($e,{size:"40",color:P(l.item),variant:"tonal"},{default:t(()=>{var le;return[e(_,{icon:(le=l.item)!=null&&le.inventory&&l.item.inventory.current_stock>=l.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(ue,{color:P(l.item),variant:"tonal",size:"small"},{default:t(()=>[c(r(N(l.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(rt,{class:"font-weight-medium"},{default:t(()=>{var le;return[c(r(((le=l.item)==null?void 0:le.name)||"Unknown Item")+" ",1),l.is_critical?(m(),F(ue,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>a[27]||(a[27]=[c(" Kritis ")])),_:1,__:[27]})):W("",!0)]}),_:2},1024),e(dt,null,{default:t(()=>{var le,L;return[o("div",Nl,[o("div",Ol,[e(_,{icon:"mdi-scale",size:"14",class:"mr-1"}),o("span",null," Kebutuhan: "+r(Number(l.quantity_needed||0).toLocaleString("id-ID"))+" "+r(l.unit),1)]),o("div",jl,[e(_,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),o("span",{class:lt(x(l.item))}," Stok: "+r(Number(((L=(le=l.item)==null?void 0:le.inventory)==null?void 0:L.current_stock)||0).toLocaleString("id-ID"))+" "+r(l.unit),3)]),l.formatted_total_cost?(m(),Z("div",Jl,[e(_,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),o("span",Wl,r(l.formatted_total_cost),1)])):W("",!0)])]}),_:2},1024),u<v.value.items.length-1?(m(),F(He,{key:0,class:"mt-3"})):W("",!0)]),_:2},1024))),128))]),_:1})):(m(),Z("div",Ql,[e(_,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),a[28]||(a[28]=o("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(De,{class:"mt-4"},{default:t(()=>[e(S,{cols:"12",md:"2"},{default:t(()=>[e(ae,{variant:"outlined",color:"primary"},{default:t(()=>[e(oe,{class:"text-center"},{default:t(()=>[e(_,{icon:"mdi-format-list-bulleted",size:"24",class:"mb-2"}),o("div",Gl,r(v.value.totalItems||0),1),a[29]||(a[29]=o("div",{class:"text-caption"},"Total Item",-1))]),_:1,__:[29]})]),_:1})]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(ae,{variant:"outlined",color:"warning"},{default:t(()=>[e(oe,{class:"text-center"},{default:t(()=>{var l;return[e(_,{icon:"mdi-alert",size:"24",class:"mb-2"}),o("div",Xl,r(((l=v.value.items)==null?void 0:l.filter(u=>u.is_critical).length)||0),1),a[30]||(a[30]=o("div",{class:"text-caption"},"Item Kritis",-1))]}),_:1,__:[30]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(ae,{variant:"outlined",color:"info"},{default:t(()=>[e(oe,{class:"text-center"},{default:t(()=>[e(_,{icon:"mdi-calculator",size:"24",class:"mb-2"}),o("div",Zl,r(E(Ke)(v.value.hpp||v.value.cost||0)),1),a[31]||(a[31]=o("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[31]})]),_:1})]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(ae,{variant:"outlined",color:"success"},{default:t(()=>[e(oe,{class:"text-center"},{default:t(()=>[e(_,{icon:"mdi-currency-usd",size:"24",class:"mb-2"}),o("div",Yl,r(E(Ke)(v.value.price||0)),1),a[32]||(a[32]=o("div",{class:"text-caption"},"Harga Jual",-1))]),_:1,__:[32]})]),_:1})]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(ae,{variant:"outlined",color:"purple"},{default:t(()=>[e(oe,{class:"text-center"},{default:t(()=>[e(_,{icon:"mdi-trending-up",size:"24",class:"mb-2"}),o("div",eo,r(E(Ke)((v.value.price||0)-(v.value.hpp||v.value.cost||0))),1),a[33]||(a[33]=o("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[33]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):W("",!0),e(He),e(je,{class:"pa-4"},{default:t(()=>[e(Qe),e(R,{variant:"outlined",onClick:a[9]||(a[9]=l=>f.value=!1)},{default:t(()=>a[34]||(a[34]=[c(" Tutup ")])),_:1,__:[34]}),e(R,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:a[10]||(a[10]=()=>{f.value=!1,H(v.value)})},{default:t(()=>a[35]||(a[35]=[c(" Kelola Komposisi ")])),_:1,__:[35]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Oe,{modelValue:Q.value,"onUpdate:modelValue":a[13]||(a[13]=l=>Q.value=l),"max-width":"600px",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-between pa-4"},{default:t(()=>[a[36]||(a[36]=o("span",{class:"text-h6"},"Pilih Produk untuk Komposisi",-1)),e(R,{variant:"text",icon:"mdi-close",size:"small",onClick:a[12]||(a[12]=l=>Q.value=!1)})]),_:1,__:[36]}),e(oe,{class:"pa-4"},{default:t(()=>[e(cl,{onSelect:ne})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),ao=Je(to,[["__scopeId","data-v-e2cb9847"]]),lo={class:"d-flex align-center gap-2"},oo={class:"text-white"},io={class:"text-h6 mb-4 d-flex align-center gap-2"},so={class:"text-h6 mb-4 d-flex align-center gap-2"},no={class:"d-flex flex-column gap-2"},ro={key:0,class:"d-flex align-center gap-2"},uo={class:"d-flex align-center gap-2 mb-2"},co={class:"d-flex gap-2"},mo={class:"d-flex gap-2"},vo={class:"d-flex align-center justify-space-between"},po={class:"d-flex align-center gap-2"},fo={class:"text-end"},go={class:"text-h6 font-weight-bold"},_o={class:"text-caption"},ko={class:"text-h6 mb-4 d-flex align-center gap-2"},yo={class:"text-h6 mb-4 d-flex align-center gap-2"},bo={class:"image-upload-container"},ho={key:0,class:"mb-4"},xo={class:"text-center mt-2"},wo={class:"text-h6 mb-4 d-flex align-center gap-2"},Po={class:"text-h6 mb-4 d-flex align-center gap-2"},Vo={class:"text-h6 mb-4 d-flex align-center gap-2"},Co={class:"d-flex align-center"},So={class:"text-subtitle-1"},Io={class:"text-body-1"},$o={class:"d-flex align-center"},Do={class:"text-subtitle-1"},zo=qe({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup(I,{emit:be}){var B,k,s;const q=At(),{nameRules:D,categoryRules:J}=Ht(),{getProductHPPBreakdown:f}=wt(),Q=$(!1),T=$(!1),b=async()=>{if(!(!p.editMode||!H.id))try{const a=await fetch(`/api/products/${H.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(a.ok){const l=await a.json();T.value=l.success&&l.data&&l.data.length>0}}catch(a){console.error("Error checking HPP status:",a)}},v=async()=>{if(H.id)try{Q.value=!0;const a=await f(H.id,"latest");a&&(H.cost=a.total_hpp,ce("update-form","cost",a.total_hpp))}catch(a){console.error("Error refreshing HPP:",a)}finally{Q.value=!1}},j=()=>{},p=I,U=ve(()=>p.errorMessage),ce=be,ke=$(),H=xt({...p.formData,available_in_kitchen:!!p.formData.available_in_kitchen,available_in_bar:!!p.formData.available_in_bar});Ce(()=>p.formData,a=>{const l={...a,available_in_kitchen:!!a.available_in_kitchen,available_in_bar:!!a.available_in_bar};Object.assign(H,l)},{deep:!0}),Ce(H,a=>{Object.keys(a).forEach(l=>{ce("update-form",l,a[l])})},{deep:!0}),Ce(()=>p.modelValue,a=>{a&&p.editMode&&b()});const te=xt({length:((B=p.formData.dimensions)==null?void 0:B.length)||null,width:((k=p.formData.dimensions)==null?void 0:k.width)||null,height:((s=p.formData.dimensions)==null?void 0:s.height)||null});Ce(te,a=>{const l=a.length!==null||a.width!==null||a.height!==null;H.dimensions=l?{length:a.length!==null?a.length:void 0,width:a.width!==null?a.width:void 0,height:a.height!==null?a.height:void 0}:{}},{deep:!0});const ne=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],G=ve(()=>{if(!H.price||!H.cost||H.cost<=0)return 0;const a=(H.price-H.cost)/H.cost*100;return Math.ceil(a)}),pe=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),z=a=>a<10?"error":a<25?"warning":a<50?"success":"info",w=a=>a<10?"tabler-trending-down":a<25?"tabler-trending-up":a<50?"tabler-trending-up-2":"tabler-trending-up-3",h=a=>!a||a===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),g=a=>{if(!a||a.trim()===""||a==="Rp 0")return 0;const u=a.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(u)||0},Y=$(!1),fe=a=>{const l=g(a);H.price=l},ge=()=>{Y.value=!0},P=()=>{Y.value=!1},N=async()=>{var l;const{valid:a}=await((l=ke.value)==null?void 0:l.validate());a&&ce("submit",H)},x=a=>{ce("image-change",a)},O=()=>{ce("remove-image")};return(a,l)=>(m(),F(Oe,{"model-value":a.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":l[27]||(l[27]=u=>a.$emit("update:modelValue",u))},{default:t(()=>[e(ae,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[o("div",lo,[e(_,{icon:a.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),o("span",oo,r(a.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(R,{icon:"tabler-x",variant:"text",color:"white",onClick:l[0]||(l[0]=u=>a.$emit("close"))})]),_:1}),e(He),e(oe,{class:"pa-6"},{default:t(()=>[e(Ct,{ref_key:"formRef",ref:ke,onSubmit:Pt(N,["prevent"])},{default:t(()=>[e(De,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[o("h6",io,[e(_,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),l[28]||(l[28]=c(" Informasi Dasar "))])]),_:1}),e(S,{cols:"12",md:"8"},{default:t(()=>[e(we,{modelValue:H.name,"onUpdate:modelValue":l[1]||(l[1]=u=>H.name=u),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:E(D),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(we,{modelValue:H.sku,"onUpdate:modelValue":l[2]||(l[2]=u=>H.sku=u),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(zt,{modelValue:H.description,"onUpdate:modelValue":l[3]||(l[3]=u=>H.description=u),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(Re,{"model-value":H.category_id,"onUpdate:modelValue":l[4]||(l[4]=u=>H.category_id=u),items:a.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:E(J),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(we,{modelValue:H.brand,"onUpdate:modelValue":l[5]||(l[5]=u=>H.brand=u),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[o("h6",so,[e(_,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),l[29]||(l[29]=c(" Harga & Biaya "))])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(we,{"model-value":h(H.price),"onUpdate:modelValue":l[6]||(l[6]=u=>fe(u)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:ge,onBlur:P},null,8,["model-value"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[o("div",no,[e(we,{"model-value":h(H.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),a.editMode?(m(),Z("div",ro,[e(ue,{color:T.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e(_,{icon:T.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),c(" "+r(T.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),T.value?(m(),F(R,{key:0,size:"small",variant:"outlined",color:"primary",onClick:v,loading:Q.value},{default:t(()=>[e(_,{icon:"tabler-refresh",size:"14",class:"me-1"}),l[30]||(l[30]=c(" Update HPP "))]),_:1,__:[30]},8,["loading"])):(m(),F(Ee,{key:1},{activator:t(({props:u})=>[e(ue,xe(u,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e(_,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),l[31]||(l[31]=c(" Belum Ada Resep "))]),_:2,__:[31]},1040)]),default:t(()=>[l[32]||(l[32]=o("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[32]}))])):W("",!0)])]),_:1}),a.editMode?(m(),F(S,{key:0,cols:"12"},{default:t(()=>[T.value?(m(),F(Fe,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(_t,null,{default:t(()=>[e(_,{icon:"tabler-info-circle",class:"me-2"}),l[33]||(l[33]=c(" HPP Otomatis Aktif "))]),_:1,__:[33]}),l[34]||(l[34]=o("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[34]})):(m(),F(Fe,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(_t,null,{default:t(()=>[e(_,{icon:"tabler-alert-triangle",class:"me-2"}),l[35]||(l[35]=c(" HPP Manual "))]),_:1,__:[35]}),l[36]||(l[36]=o("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[36]}))]),_:1})):W("",!0),e(S,{cols:"12"},{default:t(()=>[T.value&&a.editMode?(m(),F(Fe,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[o("div",uo,[e(_,{icon:"tabler-check-circle"}),l[37]||(l[37]=o("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),l[40]||(l[40]=o("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),o("div",co,[e(R,{size:"small",color:"primary",variant:"outlined",onClick:j},{default:t(()=>[e(_,{icon:"tabler-edit",size:"14",class:"me-1"}),l[38]||(l[38]=c(" Edit Resep "))]),_:1,__:[38]}),e(R,{size:"small",variant:"outlined",color:"info",onClick:v,loading:Q.value},{default:t(()=>[e(_,{icon:"tabler-refresh",size:"14",class:"me-1"}),l[39]||(l[39]=c(" Refresh HPP "))]),_:1,__:[39]},8,["loading"])])]),_:1,__:[40]})):!T.value&&a.editMode?(m(),F(Fe,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[o("div",mo,[e(R,{size:"small",variant:"outlined",color:"info",onClick:l[7]||(l[7]=u=>E(q).push("/hpp-management"))},{default:t(()=>[e(_,{icon:"tabler-calculator",size:"14",class:"me-1"}),l[41]||(l[41]=c(" Lihat HPP Management "))]),_:1,__:[41]})])]),_:1})):W("",!0)]),_:1}),e(S,{cols:"12"},{default:t(()=>[H.price&&H.cost&&H.cost>0?(m(),F(Fe,{key:0,color:z(G.value),variant:"tonal",class:"mb-0"},{default:t(()=>[o("div",vo,[o("div",po,[e(_,{icon:w(G.value)},null,8,["icon"]),l[42]||(l[42]=o("span",{class:"font-weight-medium"},"Profit Margin",-1))]),o("div",fo,[o("div",go,r(Math.round(G.value))+"%",1),o("div",_o," Keuntungan: "+r(pe(H.price-H.cost)),1)])])]),_:1},8,["color"])):W("",!0)]),_:1}),e(S,{cols:"12"},{default:t(()=>[o("h6",ko,[e(_,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),l[43]||(l[43]=c(" Dimensi (cm) "))])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(we,{modelValue:te.length,"onUpdate:modelValue":l[8]||(l[8]=u=>te.length=u),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(we,{modelValue:te.width,"onUpdate:modelValue":l[9]||(l[9]=u=>te.width=u),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(we,{modelValue:te.height,"onUpdate:modelValue":l[10]||(l[10]=u=>te.height=u),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[o("h6",yo,[e(_,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),l[44]||(l[44]=c(" Gambar Produk "))])]),_:1}),e(S,{cols:"12"},{default:t(()=>[o("div",bo,[a.imagePreview?(m(),Z("div",ho,[e(ka,{src:a.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),o("div",xo,[e(R,{size:"small",color:"error",variant:"outlined",onClick:O},{default:t(()=>l[45]||(l[45]=[c(" Hapus Gambar ")])),_:1,__:[45]})])])):W("",!0),e(ya,{"model-value":a.selectedImage,"onUpdate:modelValue":l[11]||(l[11]=u=>x(Array.isArray(u)?u:[u])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),l[46]||(l[46]=o("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e(S,{cols:"12"},{default:t(()=>[o("h6",wo,[e(_,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),l[47]||(l[47]=c(" Pengaturan "))])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(Re,{"model-value":H.status,"onUpdate:modelValue":l[12]||(l[12]=u=>H.status=u),items:ne,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(nt,{"model-value":H.active,"onUpdate:modelValue":l[13]||(l[13]=u=>H.active=u??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(S,{cols:"12",md:"4"},{default:t(()=>[e(nt,{"model-value":H.featured,"onUpdate:modelValue":l[14]||(l[14]=u=>H.featured=u??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[o("h6",Po,[e(_,{icon:"tabler-tools-kitchen-2",size:"20",class:"coffee-icon"}),l[48]||(l[48]=c(" Ketersediaan Station "))])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(nt,{"model-value":H.available_in_kitchen,"onUpdate:modelValue":l[15]||(l[15]=u=>H.available_in_kitchen=!!u),label:"Tersedia di Kitchen",color:"coffee",inset:""},{prepend:t(()=>[e(_,{icon:"tabler-chef-hat",class:"me-2",color:H.available_in_kitchen?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(nt,{"model-value":H.available_in_bar,"onUpdate:modelValue":l[16]||(l[16]=u=>H.available_in_bar=!!u),label:"Tersedia di Bar",color:"coffee",inset:""},{prepend:t(()=>[e(_,{icon:"tabler-glass-cocktail",class:"me-2",color:H.available_in_bar?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[o("h6",Vo,[e(_,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),l[49]||(l[49]=c(" SEO (Opsional) "))])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(we,{modelValue:H.meta_title,"onUpdate:modelValue":l[17]||(l[17]=u=>H.meta_title=u),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(zt,{modelValue:H.meta_description,"onUpdate:modelValue":l[18]||(l[18]=u=>H.meta_description=u),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(Ta,{"model-value":H.tags,"onUpdate:modelValue":l[19]||(l[19]=u=>H.tags=u),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(He),e(je,{class:"pa-6"},{default:t(()=>[e(Qe),e(R,{variant:"outlined",class:"coffee-secondary",onClick:l[20]||(l[20]=u=>a.$emit("close"))},{default:t(()=>l[50]||(l[50]=[c(" Batal ")])),_:1,__:[50]}),e(R,{color:"primary",class:"coffee-primary",loading:a.loading,onClick:N},{default:t(()=>[c(r(a.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),a.useDialogError?W("",!0):(m(),F(ct,{key:0,"model-value":!!U.value,"onUpdate:modelValue":l[22]||(l[22]=u=>!u&&a.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(R,{icon:"tabler-x",size:"small",variant:"text",onClick:l[21]||(l[21]=u=>a.$emit("clear-error"))})]),default:t(()=>[o("div",Co,[e(_,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),o("div",null,[l[51]||(l[51]=o("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),o("div",So,r(U.value),1)])])]),_:1},8,["model-value"])),a.useDialogError?(m(),F(Oe,{key:1,"model-value":!!U.value,"onUpdate:modelValue":l[24]||(l[24]=u=>!u&&a.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center text-error"},{default:t(()=>[e(_,{icon:"tabler-alert-circle",class:"me-2"}),l[52]||(l[52]=c(" Error Occurred "))]),_:1,__:[52]}),e(He),e(oe,{class:"py-4"},{default:t(()=>[o("div",Io,r(U.value),1)]),_:1}),e(He),e(je,{class:"justify-end pa-4"},{default:t(()=>[e(R,{color:"error",variant:"outlined",onClick:l[23]||(l[23]=u=>a.$emit("clear-error"))},{default:t(()=>l[53]||(l[53]=[c(" Close ")])),_:1,__:[53]})]),_:1})]),_:1})]),_:1},8,["model-value"])):W("",!0),e(ct,{"model-value":!!a.successMessage,"onUpdate:modelValue":l[26]||(l[26]=u=>!u&&a.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(R,{icon:"tabler-x",size:"small",variant:"text",onClick:l[25]||(l[25]=u=>a.$emit("clear-success"))})]),default:t(()=>[o("div",$o,[e(_,{icon:"tabler-check-circle",class:"me-3",size:"28"}),o("div",null,[l[54]||(l[54]=o("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),o("div",Do,r(a.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),To=Je(zo,[["__scopeId","data-v-333cc50b"]]),Uo={key:0,class:"mt-4"},Ao={class:"d-flex align-center gap-2 mb-2"},Ho={class:"d-flex flex-wrap gap-2"},Mo=qe({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup(I,{emit:be}){const q=I,D=be,{categories:J,loading:f,fetchAllCategories:Q}=ba(),T=$(!1),b=$("");ut(async()=>{await Q(),b.value=v.search||""});const v=xt({...q.filters});Ce(()=>q.filters,h=>{Object.assign(v,h),b.value=h.search||""},{deep:!0});const j=()=>{const h=b.value.trim();(h.length>=3||h.length===0)&&(T.value=!0,v.search=h,D("search",h),te(),setTimeout(()=>{T.value=!1},500))},p=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],U=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],ce=[{title:"Kitchen Only",value:"kitchen"},{title:"Bar Only",value:"bar"},{title:"Kitchen & Bar",value:"both"}],ke=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],H=ve(()=>!!(b.value||v.category_id||v.active||v.stock_status||v.station||v.featured!==null||v.min_price||v.max_price)),te=()=>{D("update:filters",{...v})},ne=()=>{b.value="",v.search="",D("search",""),te()},G=()=>{b.value="",Object.assign(v,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),te()},pe=h=>{const g=J.value.find(Y=>Y.id_category===h);return(g==null?void 0:g.name)||"Unknown"},z=h=>{if(!h)return"Semua";const g=p.find(Y=>Y.value===h);return(g==null?void 0:g.title)||String(h)},w=h=>{const g=U.find(Y=>Y.value===h);return(g==null?void 0:g.title)||h};return(h,g)=>(m(),F(ae,{class:"mb-6"},{default:t(()=>[e(Pe,{class:"d-flex align-center gap-2"},{default:t(()=>[e(_,{icon:"tabler-filter",class:"coffee-icon"}),g[11]||(g[11]=c(" Filter & Pencarian Produk "))]),_:1,__:[11]}),e(oe,null,{default:t(()=>[e(De,null,{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>[e(we,{modelValue:b.value,"onUpdate:modelValue":g[0]||(g[0]=Y=>b.value=Y),label:"Tekan Enter Untuk Mencari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:T.value,clearable:"",variant:"outlined",hint:b.value.length>0&&b.value.length<3?`Ketik ${3-b.value.length} karakter lagi untuk mencari`:"","persistent-hint":"",onKeydown:ea(j,["enter"]),"onClick:clear":ne},null,8,["modelValue","loading","hint"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Re,{modelValue:v.category_id,"onUpdate:modelValue":[g[1]||(g[1]=Y=>v.category_id=Y),te],items:E(J),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:E(f),clearable:"",variant:"outlined"},{"no-data":t(()=>[e(Ge,null,{default:t(()=>[e(rt,null,{default:t(()=>[c(r(E(f)?"Memuat kategori...":"Tidak ada kategori"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Re,{modelValue:v.active,"onUpdate:modelValue":[g[2]||(g[2]=Y=>v.active=Y),te],items:p,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Re,{modelValue:v.stock_status,"onUpdate:modelValue":[g[3]||(g[3]=Y=>v.stock_status=Y),te],items:U,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Re,{modelValue:v.station,"onUpdate:modelValue":[g[4]||(g[4]=Y=>v.station=Y),te],items:ce,label:"Station",placeholder:"Semua station","prepend-inner-icon":"tabler-tools-kitchen-2",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(R,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:G})]),_:1})]),_:1}),e(De,{class:"mt-3"},{default:t(()=>[e(S,{cols:"12",md:"3"},{default:t(()=>[e(we,{modelValue:v.min_price,"onUpdate:modelValue":g[5]||(g[5]=Y=>v.min_price=Y),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:te},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(we,{modelValue:v.max_price,"onUpdate:modelValue":g[6]||(g[6]=Y=>v.max_price=Y),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:te},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(Re,{modelValue:v.sort_order,"onUpdate:modelValue":[g[7]||(g[7]=Y=>v.sort_order=Y),te],items:ke,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),H.value?(m(),Z("div",Uo,[o("div",Ao,[e(_,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),g[12]||(g[12]=o("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),o("div",Ho,[b.value?(m(),F(ue,{key:0,closable:"",size:"small",color:"coffee","onClick:close":ne},{default:t(()=>[c(" Pencarian: "+r(b.value),1)]),_:1})):W("",!0),v.category_id?(m(),F(ue,{key:1,closable:"",size:"small",color:"coffee","onClick:close":g[8]||(g[8]=Y=>{v.category_id=null,te()})},{default:t(()=>[c(" Kategori: "+r(pe(v.category_id)),1)]),_:1})):W("",!0),v.active?(m(),F(ue,{key:2,closable:"",size:"small",color:"coffee","onClick:close":g[9]||(g[9]=Y=>{v.active=null,te()})},{default:t(()=>[c(" Status: "+r(z(v.active)),1)]),_:1})):W("",!0),v.stock_status?(m(),F(ue,{key:3,closable:"",size:"small",color:"coffee","onClick:close":g[10]||(g[10]=Y=>{v.stock_status=null,te()})},{default:t(()=>[c(" Stok: "+r(w(v.stock_status)),1)]),_:1})):W("",!0)])])):W("",!0)]),_:1})]),_:1}))}}),Ko=Je(Mo,[["__scopeId","data-v-e18734da"]]),Eo={class:"d-flex align-center gap-2"},Bo={class:"text-h6"},Fo={class:"d-flex align-center gap-2"},Ro={class:"text-h6"},Lo={class:"d-flex align-center gap-2"},qo={class:"text-h6"},No={class:"d-flex align-center gap-2"},Oo={class:"text-h6"},jo={class:"d-flex align-center gap-2"},Jo={class:"text-h6"},Wo={class:"d-flex align-center gap-2"},Qo={class:"text-h6"},Go={class:"d-flex align-center gap-2"},Xo={class:"text-h6"},Zo={class:"d-flex align-center gap-2"},Yo={class:"text-h6"},ei=qe({__name:"ProductStatsCards",props:{stats:{}},setup(I){const be=D=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(D),q=D=>`${D.toFixed(1)}%`;return(D,J)=>(m(),F(De,{class:"mb-6"},{default:t(()=>[e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(oe,{class:"d-flex align-center"},{default:t(()=>{var f;return[e($e,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-package"})]),_:1}),o("div",null,[J[0]||(J[0]=o("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),o("div",Eo,[o("h6",Bo,r(((f=D.stats)==null?void 0:f.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(oe,{class:"d-flex align-center"},{default:t(()=>{var f;return[e($e,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-check"})]),_:1}),o("div",null,[J[1]||(J[1]=o("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),o("div",Fo,[o("h6",Ro,r(((f=D.stats)==null?void 0:f.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(oe,{class:"d-flex align-center"},{default:t(()=>{var f;return[e($e,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-star"})]),_:1}),o("div",null,[J[2]||(J[2]=o("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),o("div",Lo,[o("h6",qo,r(((f=D.stats)==null?void 0:f.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(oe,{class:"d-flex align-center"},{default:t(()=>{var f;return[e($e,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-alert-triangle"})]),_:1}),o("div",null,[J[3]||(J[3]=o("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),o("div",No,[o("h6",Oo,r(((f=D.stats)==null?void 0:f.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(oe,{class:"d-flex align-center"},{default:t(()=>{var f;return[e($e,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-currency-dollar"})]),_:1}),o("div",null,[J[4]||(J[4]=o("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),o("div",jo,[o("h6",Jo,r(be(((f=D.stats)==null?void 0:f.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(oe,{class:"d-flex align-center"},{default:t(()=>{var f;return[e($e,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-chart-line"})]),_:1}),o("div",null,[J[5]||(J[5]=o("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),o("div",Wo,[o("h6",Qo,r(be(((f=D.stats)==null?void 0:f.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(oe,{class:"d-flex align-center"},{default:t(()=>{var f;return[e($e,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-trending-up"})]),_:1}),o("div",null,[J[6]||(J[6]=o("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),o("div",Go,[o("h6",Xo,r(q(((f=D.stats)==null?void 0:f.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ae,{class:"stats-card"},{default:t(()=>[e(oe,{class:"d-flex align-center"},{default:t(()=>{var f;return[e($e,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e(_,{icon:"tabler-x-circle"})]),_:1}),o("div",null,[J[7]||(J[7]=o("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),o("div",Zo,[o("h6",Yo,r(((f=D.stats)==null?void 0:f.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),ti=Je(ei,[["__scopeId","data-v-124783ae"]]),ai={class:"d-flex align-center gap-2"},li={class:"d-flex align-center gap-2"},oi={class:"text-center py-8"},ii={class:"d-flex align-center gap-3 py-2"},si={class:"font-weight-medium"},ni={class:"text-caption text-medium-emphasis"},ri={class:"text-end"},ui={class:"font-weight-medium"},di={class:"text-caption text-medium-emphasis d-flex align-center justify-end gap-1"},ci={class:"text-center profit-margin-container"},mi={class:"text-center"},vi={key:0,class:"text-caption text-medium-emphasis mt-1"},pi={class:"d-flex align-center gap-2"},fi={class:"d-flex gap-2 align-center"},gi={class:"text-body-2"},_i={class:"text-caption text-medium-emphasis"},ki={class:"d-flex align-center gap-1"},yi=300*1e3,bi=1e3,hi=qe({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","toggle-kitchen","toggle-bar","bulk-delete","update:options","update:selected-products"],setup(I,{expose:be,emit:q}){const D=I,J=q,{currentHPPBreakdown:f,getProductHPPBreakdown:Q}=wt(),T=$({}),b=$({}),v=$({}),j=$(new Set),p=$(new Set);let U=null;const ce=P=>{const N=v.value[P];return N?Date.now()-N.timestamp<yi:!1},ke=async()=>{if(p.value.size===0)return;const P=Array.from(p.value);p.value.clear();const N=P.filter(O=>{const B=D.products.find(k=>(k.id_product||k.id)===O);return B&&(B.hpp===void 0||B.hpp===null)});if(N.length===0)return;const x=3;for(let O=0;O<N.length;O+=x){const k=N.slice(O,O+x).map(async s=>{var a;if(!(b.value[s]||ce(s))){b.value[s]=!0,j.value.add(s);try{if(await Q(s,"latest"),(a=f.value)!=null&&a.total_hpp){const l=f.value.total_hpp;T.value[s]=l,v.value[s]={data:l,timestamp:Date.now(),attempted:!0}}else v.value[s]={data:0,timestamp:Date.now(),attempted:!0}}catch(l){console.warn(`Could not load HPP for product ${s}:`,l),v.value[s]={data:0,timestamp:Date.now(),attempted:!0}}finally{b.value[s]=!1}}});await Promise.all(k),O+x<P.length&&await new Promise(s=>setTimeout(s,500))}},H=P=>{if(ce(P)){T.value[P]=v.value[P].data;return}j.value.has(P)||(p.value.add(P),U&&clearTimeout(U),U=setTimeout(()=>{ke()},bi))},te=()=>{for(const P of D.products){const N=P.id_product||P.id;N&&(ce(N)?T.value[N]=v.value[N].data:!j.value.has(N)&&!b.value[N]&&H(N))}},ne=P=>{const N=P.id_product||P.id;return T.value[N]||P.cost||0},G=P=>{const N=ne(P),x=P.price||0;return x<=0||N<=0?0:Math.round((x-N)/x*100)};ta(()=>{D.products&&D.products.length>0&&te()}),ut(()=>{D.products&&D.products.length>0&&te()}),be({refreshHPPData:async P=>{P?(delete v.value[P],delete T.value[P],j.value.delete(P),D.products.find(x=>(x.id_product||x.id)===P)&&H(P)):(v.value={},T.value={},j.value.clear(),p.value.clear(),te())}});const z=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Station",key:"station_availability",sortable:!1,width:"150px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],w=P=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(P),h=P=>new Date(P).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),g=P=>new Date(P).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),Y=P=>P<10?"error":P<25?"warning":P<50?"success":"info",fe=P=>{J("toggle-kitchen",P)},ge=P=>{J("toggle-bar",P)};return(P,N)=>(m(),F(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",ai,[e(_,{icon:"tabler-list",class:"coffee-icon"}),N[5]||(N[5]=c(" Data Produk ")),P.totalItems?(m(),F(ue,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[c(r(P.totalItems)+" item ",1)]),_:1})):W("",!0)]),o("div",li,[P.selectedProducts.length>0?(m(),F(R,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:N[0]||(N[0]=x=>P.$emit("bulk-delete"))},{default:t(()=>[c(" Hapus Terpilih ("+r(P.selectedProducts.length)+") ",1)]),_:1})):W("",!0),e(R,{"prepend-icon":"tabler-plus",color:"coffee",onClick:N[1]||(N[1]=x=>P.$emit("add-product"))},{default:t(()=>N[6]||(N[6]=[c(" Tambah Produk ")])),_:1,__:[6]})])]),_:1}),e(He),e(Sa,{"model-value":P.selectedProducts,"onUpdate:modelValue":N[3]||(N[3]=x=>P.$emit("update:selected-products",x)),headers:z,items:P.products,"items-length":P.totalItems,loading:P.loading,"items-per-page":P.itemsPerPage,page:P.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:options":N[4]||(N[4]=x=>P.$emit("update:options",x))},{loading:t(()=>[e(Ia,{type:"table-row@10"})]),"no-data":t(()=>[o("div",oi,[e(_,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),N[8]||(N[8]=o("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),N[9]||(N[9]=o("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(R,{"prepend-icon":"tabler-plus",color:"coffee",onClick:N[2]||(N[2]=x=>P.$emit("add-product"))},{default:t(()=>N[7]||(N[7]=[c(" Tambah Produk Pertama ")])),_:1,__:[7]})])]),"item.name":t(({item:x})=>[o("div",ii,[e($e,{image:x.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[x.image_url?W("",!0):(m(),F(_,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),o("div",null,[o("div",si,r(x.name),1),o("div",ni," SKU: "+r(x.sku||"-"),1)])])]),"item.category":t(({item:x})=>[e(ue,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var O;return[c(r(((O=x.category)==null?void 0:O.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:x})=>[o("div",ri,[o("div",ui,r(w(x.price)),1),o("div",di,[o("span",null,"HPP: "+r(w(ne(x))),1),b.value[x.id_product||x.id]&&ne(x)>0?(m(),F(pt,{key:0,indeterminate:"",size:"12",width:"2"})):W("",!0)])])]),"item.profit_margin":t(({item:x})=>[o("div",ci,[e(ue,{color:Y(G(x)),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[c(r(G(x))+"% ",1)]),_:2},1032,["color"])])]),"item.stock":t(({item:x})=>[o("div",mi,[e(ue,{color:x.stock_status==="out_of_stock"?"error":x.stock_status==="low_stock"?"warning":"success",size:"small",variant:"tonal"},{default:t(()=>[c(r(x.stock_status==="out_of_stock"?"Habis":x.stock_status==="low_stock"?"Rendah":"Aman"),1)]),_:2},1032,["color"]),x.min_stock?(m(),Z("div",vi," Min: "+r(x.min_stock),1)):W("",!0)])]),"item.active":t(({item:x})=>[o("div",pi,[e(ue,{color:x.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[c(r(x.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),x.featured?(m(),F(Ee,{key:0,text:"Produk Unggulan"},{activator:t(({props:O})=>[e(_,xe(O,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):W("",!0)])]),"item.station_availability":t(({item:x})=>[o("div",fi,[e(Ee,{location:"top"},{activator:t(({props:O})=>{var B,k,s;return[e(ue,xe(O,{color:x.available_in_kitchen?"success":"error",variant:"flat",size:"small",class:["station-chip cursor-pointer",{"station-chip-loading":(B=P.toggleLoading)==null?void 0:B[x.id_product]}],onClick:a=>fe(x),loading:((k=P.toggleLoading)==null?void 0:k[x.id_product])||!1,disabled:((s=P.toggleLoading)==null?void 0:s[x.id_product])||!1}),{prepend:t(()=>[e(_,{icon:x.available_in_kitchen?"tabler-check":"tabler-x",size:"14",color:"white"},null,8,["icon"])]),default:t(()=>[N[10]||(N[10]=o("span",{style:{color:"white !important","font-weight":"600 !important"}}," Kitchen ",-1))]),_:2,__:[10]},1040,["color","class","onClick","loading","disabled"])]}),default:t(()=>[o("span",null,r(x.available_in_kitchen?"Tersedia di Kitchen":"Tidak tersedia di Kitchen"),1)]),_:2},1024),e(Ee,{location:"top"},{activator:t(({props:O})=>{var B,k,s;return[e(ue,xe(O,{color:x.available_in_bar?"success":"error",variant:"flat",size:"small",class:["station-chip cursor-pointer",{"station-chip-loading":(B=P.toggleLoading)==null?void 0:B[x.id_product]}],onClick:a=>ge(x),loading:((k=P.toggleLoading)==null?void 0:k[x.id_product])||!1,disabled:((s=P.toggleLoading)==null?void 0:s[x.id_product])||!1}),{prepend:t(()=>[e(_,{icon:x.available_in_bar?"tabler-check":"tabler-x",size:"14",color:"white"},null,8,["icon"])]),default:t(()=>[N[11]||(N[11]=o("span",{style:{color:"white !important","font-weight":"600 !important"}}," Bar ",-1))]),_:2,__:[11]},1040,["color","class","onClick","loading","disabled"])]}),default:t(()=>[o("span",null,r(x.available_in_bar?"Tersedia di Bar":"Tidak tersedia di Bar"),1)]),_:2},1024)])]),"item.created_at":t(({item:x})=>[o("div",gi,r(h(x.created_at??"")),1),o("div",_i,r(g((x==null?void 0:x.created_at)??"")),1)]),"item.actions":t(({item:x})=>[o("div",ki,[e(Ee,{text:"Kelola Komposisi"},{activator:t(({props:O})=>[e(R,xe(O,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:B=>P.$emit("open-composition-dialog",x)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Kelola Variant"},{activator:t(({props:O})=>[e(R,xe(O,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:B=>P.$emit("open-variant-dialog",x)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Edit Produk"},{activator:t(({props:O})=>[e(R,xe(O,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:B=>P.$emit("edit-product",x)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:x.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:O})=>{var B;return[e(R,xe(O,{icon:x.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:x.active?"success":"error",loading:((B=P.toggleLoading)==null?void 0:B[x.id_product])||!1,onClick:k=>P.$emit("toggle-active",x)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Ee,{text:x.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:O})=>[e(R,xe(O,{icon:x.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:x.featured?"warning":"default",onClick:B=>P.$emit("toggle-featured",x)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Ee,{text:"Hapus Produk"},{activator:t(({props:O})=>[e(R,xe(O,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:B=>P.$emit("delete-product",x)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),xi=Je(hi,[["__scopeId","data-v-e3fcb175"]]),wi={class:"d-flex align-center gap-3"},Pi={class:"text-h5 font-weight-bold"},Vi={class:"text-h6"},Ci={class:"text-body-1"},Si={class:"d-flex flex-column"},Ii={class:"font-weight-medium"},$i={class:"text-caption text-grey-darken-1"},Di={class:"font-weight-medium"},zi={key:0,class:"text-caption"},Ti={key:1,class:"text-grey-lighten-1 text-caption"},Ui={class:"v-data-table__footer"},Ai={class:"pa-4 d-flex justify-space-between align-center"},Hi={class:"text-subtitle-1 font-weight-bold"},Mi={class:"text-subtitle-2 text-uppercase"},Ki={class:"text-h6 font-weight-bold my-2"},Ei={class:"text-caption"},Kt=qe({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup(I,{emit:be}){const q=I,D=be,J=$(!1),f=$(null),Q=$(null),T=$(!1),b=$(!1),v=$("latest"),j=$(0),p=$(0),U=$(""),ce=$(0),ke=$(!1),H=$(!1),te=$(""),ne=$(""),G=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],pe=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],z=B=>!B||B===0?"":new Intl.NumberFormat("id-ID").format(B),w=B=>{if(!B)return 0;const k=B.replace(/[^\d]/g,"");return parseInt(k)||0},h=B=>{var s;const k=w(B);if(p.value=k,U.value=z(k),(s=f.value)!=null&&s.total_hpp&&k>0){const a=f.value.total_hpp;j.value=a>0?Math.round((k-a)/a*100):0}else j.value=0},g=B=>Ke(B),Y=async(B,k)=>{J.value=!0;try{await new Promise(s=>setTimeout(s,500)),f.value={total_hpp:15e4,method:k,calculated_at:new Date().toISOString(),items:[{item_name:"Tepung Terigu",item_code:"TPNG001",quantity_needed:.5,unit:"kg",cost_per_unit:15e3,total_cost:7500,is_critical:!1,notes:null},{item_name:"Gula Pasir",item_code:"GUL001",quantity_needed:.25,unit:"kg",cost_per_unit:12e3,total_cost:3e3,is_critical:!1,notes:null},{item_name:"Telur Ayam",item_code:"TLR001",quantity_needed:3,unit:"pcs",cost_per_unit:3e3,total_cost:9e3,is_critical:!0,notes:"Price volatile"}]},T.value=!0}catch(s){console.error("Error loading HPP breakdown:",s),T.value=!1}finally{J.value=!1}},fe=async(B,k)=>{J.value=!0;try{if(await new Promise(s=>setTimeout(s,1e3)),f.value){switch(k){case"latest":f.value.total_hpp=Math.round(f.value.total_hpp*1.1);break;case"average":f.value.total_hpp=Math.round(f.value.total_hpp*1.05);break;default:f.value.total_hpp=Math.round(f.value.total_hpp*1.03)}f.value.calculated_at=new Date().toISOString()}}catch(s){throw s}finally{J.value=!1}},ge=async(B,k,s,a,l)=>{J.value=!0;try{return await new Promise(u=>setTimeout(u,1e3)),{data:{new_price:s,markup_percentage:f.value?Math.round((s-f.value.total_hpp)/f.value.total_hpp*100):0}}}catch(u){throw u}finally{J.value=!1}},P=async()=>{var B,k,s;if(q.variantId)try{const a=localStorage.getItem("token"),l=await We.get(`/api/variants/${q.variantId}`,{headers:{Authorization:`Bearer ${a}`,Accept:"application/json"}});if(l.data.success&&l.data.data){const u=l.data.data;if(u.price&&u.price>0)p.value=Number(u.price),U.value=z(Number(u.price));else if((B=f.value)!=null&&B.total_hpp){const le=Math.round(f.value.total_hpp*1.2);p.value=le,U.value=z(le)}if((k=f.value)!=null&&k.total_hpp&&p.value>0){const le=f.value.total_hpp;j.value=le>0?Math.round((p.value-le)/le*100):0}ce.value+=1}}catch(a){console.warn("Could not load target price, using default:",a),(s=f.value)!=null&&s.total_hpp&&(p.value=Math.round(f.value.total_hpp*1.2))}},N=async()=>{q.variantId&&(await Y(q.variantId,v.value),await P())},x=async()=>{var B,k;if(q.variantId)try{await fe(q.variantId,v.value),te.value=`HPP successfully updated using ${v.value} method!`,ke.value=!0,D("hpp-updated"),await N()}catch(s){console.error("Error updating HPP:",s),ne.value=((k=(B=s==null?void 0:s.response)==null?void 0:B.data)==null?void 0:k.message)||"Failed to update HPP",H.value=!0}},O=async()=>{var B,k,s,a,l,u,le,L,me,Te;if(q.variantId&&((B=f.value)!=null&&B.total_hpp)&&p.value)try{const ie=await ge(q.variantId,v.value,p.value,!0,!0);if((k=ie==null?void 0:ie.data)!=null&&k.new_price){if(p.value=ie.data.new_price,U.value=z(ie.data.new_price),((s=ie==null?void 0:ie.data)==null?void 0:s.markup_percentage)!==void 0)j.value=ie.data.markup_percentage;else{const ze=f.value.total_hpp;j.value=ze>0?Math.round((ie.data.new_price-ze)/ze*100):0}ce.value+=1,await ht()}q.variantId&&await Y(q.variantId,v.value),te.value=`Price successfully updated to ${g(((a=ie==null?void 0:ie.data)==null?void 0:a.new_price)||p.value)}!`,ke.value=!0,D("price-updated",{variantId:q.variantId,oldPrice:(l=ie==null?void 0:ie.data)==null?void 0:l.old_price,newPrice:(u=ie==null?void 0:ie.data)==null?void 0:u.new_price,hpp:(le=ie==null?void 0:ie.data)==null?void 0:le.hpp,markupPercentage:(L=ie==null?void 0:ie.data)==null?void 0:L.markup_percentage})}catch(ie){console.error("Error applying price suggestion:",ie),ne.value=((Te=(me=ie==null?void 0:ie.response)==null?void 0:me.data)==null?void 0:Te.message)||"Failed to update variant price",H.value=!0}};return Ce(()=>q.modelValue,B=>{B&&q.variantId&&N()}),Ce(()=>q.variantId,B=>{B&&q.modelValue&&N()}),Ce(v,async()=>{q.variantId&&await N()}),Ce([()=>{var B;return(B=f.value)==null?void 0:B.total_hpp},p],()=>{var B;if((B=f.value)!=null&&B.total_hpp&&p.value>0){const k=f.value.total_hpp;j.value=k>0?Math.round((p.value-k)/k*100):0}else j.value=0}),Ce(p,B=>{B!==w(U.value)&&(U.value=z(B))}),(B,k)=>(m(),Z(Ue,null,[e(Oe,{"model-value":B.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":k[6]||(k[6]=s=>B.$emit("update:modelValue",s))},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",wi,[e(_,{icon:"mdi-calculator-variant",size:"24"}),o("span",null,"HPP Breakdown - "+r(B.variantName||"Variant"),1)]),e(R,{icon:"mdi-close",size:"small",variant:"text",onClick:k[0]||(k[0]=s=>B.$emit("update:modelValue",!1))})]),_:1}),e(oe,null,{default:t(()=>[e(De,{class:"mb-4"},{default:t(()=>[e(S,{cols:"12",md:"6"},{default:t(()=>[e(Re,{modelValue:v.value,"onUpdate:modelValue":[k[1]||(k[1]=s=>v.value=s),N],items:G,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(R,{color:"primary",variant:"elevated",loading:J.value,"prepend-icon":"mdi-update",block:"",onClick:x},{default:t(()=>[c(" Update HPP with "+r(v.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),T.value?(m(),F(ae,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(oe,null,{default:t(()=>[e(De,{align:"center"},{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>{var s;return[k[11]||(k[11]=o("div",{class:"text-subtitle-2"}," Total HPP ",-1)),o("div",Pi,r(g(((s=f.value)==null?void 0:s.total_hpp)||0)),1)]}),_:1,__:[11]}),e(S,{cols:"12",md:"4"},{default:t(()=>{var s;return[k[12]||(k[12]=o("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),o("div",Vi,r((s=G.find(a=>{var l;return a.value===((l=f.value)==null?void 0:l.method)}))==null?void 0:s.title),1)]}),_:1,__:[12]}),e(S,{cols:"12",md:"4"},{default:t(()=>{var s;return[k[13]||(k[13]=o("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),o("div",Ci,r((s=f.value)!=null&&s.calculated_at?new Date(f.value.calculated_at).toLocaleString():"-"),1)]}),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):W("",!0),T.value?(m(),F(ae,{key:1},{default:t(()=>{var s;return[e(Pe,null,{default:t(()=>{var a,l;return[e(_,{icon:"mdi-format-list-bulleted",class:"me-2"}),c(" Item Breakdown ("+r(((l=(a=f.value)==null?void 0:a.items)==null?void 0:l.length)||0)+" items) ",1)]}),_:1}),e(va,{headers:pe,items:((s=f.value)==null?void 0:s.items)||[],"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:a})=>[o("div",Si,[o("span",Ii,r(a.item_name),1),o("span",$i,r(a.item_code),1)])]),"item.quantity_needed":t(({item:a})=>[o("span",Di,r(a.quantity_needed)+" "+r(a.unit),1)]),"item.cost_per_unit":t(({item:a})=>[o("span",null,r(g(a.cost_per_unit)),1)]),"item.total_cost":t(({item:a})=>[e(ue,{color:a.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[c(r(g(a.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:a})=>[e(ue,{color:a.is_critical?"error":"success","prepend-icon":a.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[c(r(a.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:a})=>[a.notes?(m(),Z("span",zi,r(a.notes),1)):(m(),Z("span",Ti,"â€”"))]),bottom:t(()=>{var a;return[o("div",Ui,[e(He),o("div",Ai,[o("div",Hi," Total HPP: "+r(g(((a=f.value)==null?void 0:a.total_hpp)||0)),1),e(ue,{color:"info",variant:"elevated"},{default:t(()=>{var l,u;return[c(r(((u=(l=f.value)==null?void 0:l.items)==null?void 0:u.length)||0)+" items ",1)]}),_:1})])])]}),_:1},8,["items"])]}),_:1})):W("",!0),T.value?(m(),F(ae,{key:2,class:"mt-4"},{default:t(()=>[e(Pe,null,{default:t(()=>[e(_,{icon:"mdi-cash-multiple",class:"me-2"}),k[14]||(k[14]=c(" Price Suggestion "))]),_:1,__:[14]}),e(oe,null,{default:t(()=>[e(De,null,{default:t(()=>[e(S,{cols:"12",md:"6"},{default:t(()=>{var s;return[(m(),F(we,{key:ce.value,modelValue:U.value,"onUpdate:modelValue":[k[2]||(k[2]=a=>U.value=a),h],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${g(((s=f.value)==null?void 0:s.total_hpp)||0)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>{var s;return[(m(),F(we,{key:ce.value,modelValue:j.value,"onUpdate:modelValue":k[3]||(k[3]=a=>j.value=a),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${g(p.value-(((s=f.value)==null?void 0:s.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e(De,{class:"mt-2"},{default:t(()=>[e(S,{cols:"12",md:"12"},{default:t(()=>[e(R,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:J.value,disabled:!p.value||p.value<=0,block:"",onClick:O},{default:t(()=>k[15]||(k[15]=[c(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):W("",!0),b.value?(m(),F(ae,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(Pe,null,{default:t(()=>[e(_,{icon:"mdi-lightbulb",class:"me-2"}),k[16]||(k[16]=c(" Price Suggestions "))]),_:1,__:[16]}),e(oe,null,{default:t(()=>[e(De,null,{default:t(()=>[(m(!0),Z(Ue,null,Ye(Q.value.suggestions,(s,a)=>(m(),F(S,{key:a,cols:"12",md:"4"},{default:t(()=>[e(ae,{variant:"elevated"},{default:t(()=>[e(oe,{class:"text-center"},{default:t(()=>[o("div",Mi,r(a)+" Method ",1),o("div",Ki,r(g(s.suggested_price)),1),o("div",Ei,[c(" HPP: "+r(g(s.hpp)),1),k[17]||(k[17]=o("br",null,null,-1)),c(" Markup: "+r(s.markup_percentage.toFixed(1))+"%",1),k[18]||(k[18]=o("br",null,null,-1)),c(" Margin: "+r(s.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):W("",!0),!T.value&&!J.value?(m(),F(ae,{key:4,variant:"outlined"},{default:t(()=>[e(oe,{class:"text-center py-8"},{default:t(()=>[e(_,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),k[20]||(k[20]=o("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),k[21]||(k[21]=o("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:k[4]||(k[4]=s=>B.$emit("update:modelValue",!1))},{default:t(()=>k[19]||(k[19]=[c(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):W("",!0)]),_:1}),e(je,{class:"pa-4"},{default:t(()=>[e(Qe),e(R,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:k[5]||(k[5]=s=>B.$emit("update:modelValue",!1))},{default:t(()=>k[22]||(k[22]=[c(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(ct,{modelValue:ke.value,"onUpdate:modelValue":k[8]||(k[8]=s=>ke.value=s),color:"success",location:"top"},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:k[7]||(k[7]=s=>ke.value=!1)},{default:t(()=>k[23]||(k[23]=[c(" Close ")])),_:1,__:[23]})]),default:t(()=>[c(r(te.value)+" ",1)]),_:1},8,["modelValue"]),e(ct,{modelValue:H.value,"onUpdate:modelValue":k[10]||(k[10]=s=>H.value=s),color:"error",location:"top"},{actions:t(()=>[e(R,{color:"white",variant:"text",onClick:k[9]||(k[9]=s=>H.value=!1)},{default:t(()=>k[24]||(k[24]=[c(" Close ")])),_:1,__:[24]})]),default:t(()=>[c(r(ne.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),Bi={class:"d-flex align-center gap-2"},Fi={class:"pa-4",style:{"background-color":"#2A2A2A"}},Ri={key:0,class:"d-flex align-center gap-3"},Li={class:"text-h6 text-white font-weight-bold"},qi={class:"d-flex align-center gap-4 mt-1"},Ni={class:"text-caption text-grey-lighten-1"},Oi={class:"text-caption text-grey-lighten-1"},ji={class:"pa-4 add-item-form"},Ji={class:"d-flex align-center justify-space-between mb-4"},Wi={class:"d-flex align-center gap-2"},Qi={class:"text-h6"},Gi={key:0,class:"text-error"},Xi={key:1},Zi={class:"d-flex align-center"},Yi={class:"pa-4 text-center"},es={class:"pa-4 pt-0"},ts={class:"d-flex align-center justify-between mb-4"},as={class:"text-h6"},ls={key:0,class:"composition-list"},os={class:"d-flex align-center justify-between"},is={class:"d-flex align-center gap-3"},ss={class:"font-weight-medium"},ns={class:"text-caption text-medium-emphasis"},rs={class:"font-weight-medium text-primary"},us={class:"d-flex align-center gap-2"},ds={class:"text-center"},cs={key:0,class:"text-body-2 text-medium-emphasis"},ms={class:"text-center"},vs={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},ps=qe({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup(I,{emit:be}){const q=I,D=be,J=$(),f=$(!1),Q=$(!1),T=$([]),b=$([]),v=$(!1),j=$(null),p=$(!1),U=$(null),ce=$(!1),ke=$(!1),H=$(""),te=$(""),ne=$("success"),G=$(!1),pe=ve({get:()=>q.modelValue,set:n=>{D("update:modelValue",n)}}),z=()=>({item_id:null,quantity:1,is_critical:!1}),w=$(z()),h=ve(()=>!w.value.item_id||!Array.isArray(T.value)?null:T.value.find(n=>n.id_item===w.value.item_id)),g=ve(()=>!h.value||v.value&&j.value!==null?null:b.value.find(n=>{var i,y;return n.name===((i=h.value)==null?void 0:i.name)||n.id&&((y=h.value)==null?void 0:y.id_item)&&n.id===h.value.id_item})),Y=ve(()=>{if(!h.value)return"";if(v.value&&j.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(g.value){const n=g.value;return`Item sudah ada dengan quantity ${n.quantity} ${n.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${ge(h.value)} ${h.value.unit}`}),fe=ve(()=>Array.isArray(T.value)?T.value.filter(n=>ge(n)>0):[]),ge=n=>{var i,y;return((i=n.inventory)==null?void 0:i.current_stock)||((y=n.inventory)==null?void 0:y.available_stock)||n.current_stock||0},P=()=>Q.value?"Memuat items...":!T.value||T.value.length===0?"Tidak ada item tersedia":fe.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",N=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),x=n=>{switch(n){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},O=n=>{switch(n){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},B=(n,i,y)=>{var C,se,re,he,Se,Ve,Ae,Le;if(!i)return!0;const M=i.toLowerCase().trim(),K=((se=(C=y==null?void 0:y.raw)==null?void 0:C.name)==null?void 0:se.toLowerCase())||"",d=((he=(re=y==null?void 0:y.raw)==null?void 0:re.item_code)==null?void 0:he.toLowerCase())||"",A=((Ve=(Se=y==null?void 0:y.raw)==null?void 0:Se.unit)==null?void 0:Ve.toLowerCase())||"",X=((Le=(Ae=y==null?void 0:y.raw)==null?void 0:Ae.description)==null?void 0:Le.toLowerCase())||"";return K.includes(M)||d.includes(M)||A.includes(M)||X.includes(M)},k=async()=>{var n,i,y;Q.value=!0;try{const M=await We.get("/api/items?per_page=all&include=inventory"),K=((i=(n=M.data)==null?void 0:n.data)==null?void 0:i.data)||((y=M.data)==null?void 0:y.data)||M.data||[];T.value=Array.isArray(K)?K:[]}catch(M){console.error("Error loading items:",M),M!=null&&M.response&&(console.error("API Error Status:",M.response.status),console.error("API Error Data:",M.response.data)),T.value=[]}finally{Q.value=!1}},s=async()=>{var n,i,y,M,K;if(!(!((n=q.variant)!=null&&n.id)&&!((i=q.variant)!=null&&i.id_variant)))try{const d=q.variant.id||q.variant.id_variant,A=await We.get(`/api/variant-items/variant/${d}`),X=((M=(y=A.data)==null?void 0:y.data)==null?void 0:M.composition)||((K=A.data)==null?void 0:K.composition)||[];if(!Array.isArray(X)){console.warn("API response composition is not an array:",X),b.value=[];return}b.value=X.map(C=>{var se,re,he,Se,Ve,Ae,Le,et,Ze,de;return{id:C.id_variant_item||C.id,name:((se=C.item)==null?void 0:se.name)||C.name,quantity:parseFloat(C.quantity_needed||C.quantity||C.qty||"1"),unit:C.unit||((re=C.item)==null?void 0:re.unit)||"pcs",stock:((Se=(he=C.item)==null?void 0:he.inventory)==null?void 0:Se.current_stock)||((Ae=(Ve=C.item)==null?void 0:Ve.inventory)==null?void 0:Ae.available_stock)||((Le=C.item)==null?void 0:Le.current_stock)||C.stock||0,price:parseFloat(((et=C.item)==null?void 0:et.cost_per_unit)||((Ze=C.item)==null?void 0:Ze.price)||C.price||"0"),is_critical:C.is_critical||!1,inventory:(de=C.item)!=null&&de.inventory?{current_stock:C.item.inventory.current_stock||0,available_stock:C.item.inventory.available_stock||0,stock_status:C.item.inventory.stock_status||"unknown",reorder_level:C.item.inventory.reorder_level||0}:null}})}catch(d){console.error("Error loading composition items:",d),d!=null&&d.response&&(console.error("API Error Status:",d.response.status),console.error("API Error Data:",d.response.data)),b.value=[]}},a=async()=>{var K,d;const{valid:n}=await J.value.validate();if(!n||!h.value)return;const i=h.value.name,y=h.value.id_item,M=w.value.quantity;if(v.value&&j.value!==null)b.value[j.value].quantity,b.value[j.value].quantity=M,b.value[j.value].is_critical=w.value.is_critical,v.value=!1,j.value=null;else{const A=b.value.findIndex(X=>X.name===i||X.id&&y&&X.id===y);if(A!==-1){const se=b.value[A].quantity+M;b.value[A].quantity=se}else{const X={name:i,quantity:M,unit:h.value.unit,stock:((K=h.value.inventory)==null?void 0:K.current_stock)||((d=h.value.inventory)==null?void 0:d.available_stock)||h.value.current_stock||0,price:h.value.cost_per_unit||0,is_critical:w.value.is_critical,inventory:h.value.inventory?{current_stock:h.value.inventory.current_stock||0,available_stock:h.value.inventory.available_stock||0,stock_status:h.value.inventory.stock_status||"unknown",reorder_level:h.value.inventory.reorder_level||0}:null};b.value.push(X)}}w.value=z()},l=(n,i)=>{const y=T.value.find(M=>M.name===n.name||M.id_item===n.id);y?(v.value=!0,j.value=i,w.value={item_id:y.id_item,quantity:n.quantity,is_critical:n.is_critical||!1},setTimeout(()=>{const M=document.querySelector(".add-item-form");M&&M.scrollIntoView({behavior:"smooth",block:"start"})},100)):console.error("âŒ Could not find item in available items")},u=()=>{v.value=!1,j.value=null,w.value=z()},le=(n,i)=>{U.value={item:n,index:i},p.value=!0},L=async()=>{var M,K,d;if(!U.value)return;const{item:n,index:i}=U.value;n.name;const y=n.id;ce.value=!0;try{y&&await We.delete(`/api/variant-items/${y}`),p.value=!1,U.value=null,await s(),D("save")}catch(A){console.error("âŒ Error deleting item:",A),console.error("âŒ Error details:",(M=A.response)==null?void 0:M.data),alert("Gagal menghapus item: "+(((d=(K=A.response)==null?void 0:K.data)==null?void 0:d.message)||A.message))}finally{ce.value=!1}},me=()=>{p.value=!1,U.value=null},Te=()=>{switch(ne.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},ie=()=>{switch(ne.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},ze=()=>{switch(ne.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},Me=()=>{switch(ne.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},ot=async()=>{var n,i,y,M;if(!((n=q.variant)!=null&&n.id)&&!((i=q.variant)!=null&&i.id_variant)){console.error("No variant ID found");return}f.value=!0;try{const K=q.variant.id||q.variant.id_variant;if(b.value.some(A=>A.id)){const A={items:b.value.map(C=>{const se=T.value.find(re=>re.name===C.name);return{id_variant_item:C.id,quantity_needed:Number(C.quantity),unit:C.unit,is_critical:C.is_critical||!1}}).filter(C=>C.id_variant_item&&C.quantity_needed>0)},X=await We.post("/api/variant-items/bulk-update",A)}else{const A={id_variant:K,items:b.value.map(C=>{const se=T.value.find(re=>re.name===C.name);return{id_item:se==null?void 0:se.id_item,quantity_needed:Number(C.quantity),unit:C.unit,is_critical:C.is_critical||!1}}).filter(C=>C.id_item&&C.quantity_needed>0)},X=await We.post("/api/variant-items/bulk-store",A)}D("save"),V()}catch(K){console.error("Error saving composition:",K),alert("Gagal menyimpan komposisi: "+(((M=(y=K.response)==null?void 0:y.data)==null?void 0:M.message)||K.message))}finally{f.value=!1}},Xe=()=>{G.value=!0},V=()=>{pe.value=!1,w.value=z(),b.value=[],v.value=!1,j.value=null};return Ce(()=>q.modelValue,n=>{n?(w.value=z(),k(),s()):(v.value=!1,j.value=null)}),Ce(()=>w.value.item_id,n=>{n&&h.value}),ut(()=>{k()}),(n,i)=>{var y,M,K;return m(),Z(Ue,null,[e(Oe,{modelValue:pe.value,"onUpdate:modelValue":i[3]||(i[3]=d=>pe.value=d),"max-width":"1000px",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[o("div",Bi,[e(_,{icon:"mdi-delete",color:"white"}),i[9]||(i[9]=o("span",null,"Kelola Komposisi Item",-1))]),e(R,{icon:"mdi-close",variant:"text",color:"white",onClick:V,disabled:f.value},null,8,["disabled"])]),_:1}),e(oe,{class:"pa-0"},{default:t(()=>[o("div",Fi,[n.variant?(m(),Z("div",Ri,[e(_,{icon:"mdi-coffee",size:"32",color:"white"}),o("div",null,[o("h3",Li,r(n.variant.name),1),o("div",qi,[o("span",Ni,"SKU: "+r(n.variant.sku),1),o("span",Oi,"Harga: "+r(N(n.variant.price||0)),1),e(ue,{color:"success",size:"small",variant:"tonal"},{default:t(()=>i[10]||(i[10]=[c(" Stok Aman ")])),_:1,__:[10]})])])])):W("",!0)]),o("div",ji,[o("div",Ji,[o("div",Wi,[e(_,{icon:"mdi-plus-circle",color:"success"}),o("h4",Qi,r(v.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(Ct,{ref_key:"form",ref:J,onSubmit:Pt(a,["prevent"])},{default:t(()=>[e(De,null,{default:t(()=>[e(S,{cols:"12",md:"4"},{default:t(()=>[e(Vt,{modelValue:w.value.item_id,"onUpdate:modelValue":i[0]||(i[0]=d=>w.value.item_id=d),items:fe.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[d=>!!d||"Item wajib dipilih"],loading:Q.value,disabled:Q.value||T.value&&T.value.length===0,"no-data-text":P(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":B},{"prepend-inner":t(()=>[e(_,{icon:"mdi-package",size:"16"})]),item:t(({props:d,item:A})=>[e(Ge,xe(d,{title:A.raw.name,disabled:ge(A.raw)<=0,class:["pa-3",{"text-disabled":ge(A.raw)<=0}]}),{prepend:t(()=>[e(_,{icon:"mdi-package-variant",color:ge(A.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[o("div",{class:lt(["text-caption",ge(A.raw)<=0?"text-disabled":"text-medium-emphasis"])},[ge(A.raw)<=0?(m(),Z("span",Gi,[e(_,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),i[11]||(i[11]=c(" Stok Habis "))])):(m(),Z("span",Xi," Stok: "+r(ge(A.raw))+" "+r(A.raw.unit),1))],2)]),append:t(()=>{var X;return[ge(A.raw)>0?(m(),F(ue,{key:0,size:"x-small",color:x(((X=A.raw.inventory)==null?void 0:X.stock_status)||A.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var C;return[c(r(O(((C=A.raw.inventory)==null?void 0:C.stock_status)||A.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(m(),F(ue,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>i[12]||(i[12]=[c(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:d})=>[o("div",Zi,[e(_,{icon:"mdi-package-variant",size:"16",class:"me-2"}),o("span",null,r(d.raw.name),1)])]),"no-data":t(()=>[o("div",Yi,[e(_,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),i[13]||(i[13]=o("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),i[14]||(i[14]=o("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>[e(we,{modelValue:w.value.quantity,"onUpdate:modelValue":i[1]||(i[1]=d=>w.value.quantity=d),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[d=>!!d||"Jumlah wajib diisi",d=>d>0||"Jumlah harus lebih dari 0"],hint:Y.value,"persistent-hint":"",color:g.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e(S,{cols:"12",md:"2"},{default:t(()=>{var d;return[e(we,{"model-value":((d=h.value)==null?void 0:d.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!h.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e(_,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e(S,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(nt,{modelValue:w.value.is_critical,"onUpdate:modelValue":i[2]||(i[2]=d=>w.value.is_critical=d),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(R,{color:v.value?"primary":g.value?"warning":"#D4A574",onClick:a,loading:f.value,disabled:!w.value.item_id||!w.value.quantity,block:""},{default:t(()=>[e(_,{icon:v.value?"mdi-content-save":g.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),c(" "+r(v.value?"Update":g.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),v.value?(m(),F(R,{key:0,color:"grey",variant:"outlined",onClick:u,size:"small",block:""},{default:t(()=>[e(_,{icon:"mdi-close",class:"me-1"}),i[15]||(i[15]=c(" Batal "))]),_:1,__:[15]})):W("",!0)]),_:1})]),_:1})]),_:1},512)]),o("div",es,[o("div",ts,[o("h4",as,"Daftar Item Komposisi ("+r(b.value.length)+")",1)]),b.value.length>0?(m(),Z("div",ls,[(m(!0),Z(Ue,null,Ye(b.value,(d,A)=>(m(),F(ae,{key:A,variant:"outlined",class:"mb-3"},{default:t(()=>[e(oe,{class:"pa-3"},{default:t(()=>{var X,C,se,re,he,Se,Ve;return[o("div",os,[o("div",is,[e(_,{icon:"mdi-check-circle",color:"success"}),o("div",null,[o("div",ss,r(d.name),1),o("div",ns,[o("span",rs,"Dibutuhkan: "+r(d.quantity)+" "+r(d.unit),1),i[16]||(i[16]=c(" â€¢ ")),o("span",{class:lt({"text-success":(((X=d.inventory)==null?void 0:X.current_stock)??0)>(((C=d.inventory)==null?void 0:C.reorder_level)??0),"text-warning":(((se=d.inventory)==null?void 0:se.current_stock)??0)<=(((re=d.inventory)==null?void 0:re.reorder_level)??0)&&(((he=d.inventory)==null?void 0:he.current_stock)??0)>0,"text-error":(((Se=d.inventory)==null?void 0:Se.current_stock)??0)<=0})}," Stok: "+r(((Ve=d.inventory)==null?void 0:Ve.current_stock)||d.stock||0)+" "+r(d.unit),3),c(" â€¢ "+r(N(d.price)),1)])])]),o("div",us,[e(R,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:Ae=>l(d,A)},null,8,["onClick"]),e(R,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Ae=>le(d,A)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(m(),F(ae,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e(_,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),i[17]||(i[17]=o("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(je,{class:"px-6 pb-6"},{default:t(()=>[e(R,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:Xe},{default:t(()=>i[18]||(i[18]=[c(" Setting HPP ")])),_:1,__:[18]}),e(Qe),e(R,{variant:"outlined",onClick:V,disabled:f.value},{default:t(()=>i[19]||(i[19]=[c(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(R,{color:"#D4A574",onClick:ot,loading:f.value,disabled:b.value.length===0},{default:t(()=>i[20]||(i[20]=[c(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Kt,{modelValue:G.value,"onUpdate:modelValue":i[4]||(i[4]=d=>G.value=d),"variant-id":((y=n.variant)==null?void 0:y.id)||((M=n.variant)==null?void 0:M.id_variant),"variant-name":(K=n.variant)==null?void 0:K.name,onHppUpdated:i[5]||(i[5]=d=>D("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Oe,{modelValue:p.value,"onUpdate:modelValue":i[6]||(i[6]=d=>p.value=d),"max-width":"400px",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e(_,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),i[21]||(i[21]=c(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(He),e(oe,{class:"pa-6"},{default:t(()=>[o("div",ds,[e(_,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),i[24]||(i[24]=o("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),U.value?(m(),Z("div",cs,[o("strong",null,r(U.value.item.name),1),i[22]||(i[22]=o("br",null,null,-1)),c(" Dibutuhkan: "+r(U.value.item.quantity)+" "+r(U.value.item.unit),1)])):W("",!0),e(Fe,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>i[23]||(i[23]=[o("strong",null,"Perhatian:",-1),c(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(je,{class:"px-6 pb-6"},{default:t(()=>[e(R,{variant:"outlined",onClick:me,disabled:ce.value,class:"flex-grow-1"},{default:t(()=>i[25]||(i[25]=[c(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(R,{color:"error",onClick:L,loading:ce.value,class:"flex-grow-1"},{default:t(()=>i[26]||(i[26]=[c(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Oe,{modelValue:ke.value,"onUpdate:modelValue":i[8]||(i[8]=d=>ke.value=d),"max-width":"450px",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:lt(["d-flex align-center justify-center text-h6",ze()])},{default:t(()=>[e(_,{icon:Te(),color:ie(),class:"me-2",size:"24"},null,8,["icon","color"]),c(" "+r(te.value),1)]),_:1},8,["class"]),e(He),e(oe,{class:"pa-6"},{default:t(()=>[o("div",ms,[e(_,{icon:Te(),color:ie(),size:"64",class:"mb-4"},null,8,["icon","color"]),o("div",vs,r(H.value),1),e(Fe,{type:ne.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[ne.value==="success"?(m(),Z(Ue,{key:0},[i[27]||(i[27]=o("strong",null,"Berhasil!",-1)),i[28]||(i[28]=c(" Perubahan telah disimpan. "))],64)):ne.value==="info"?(m(),Z(Ue,{key:1},[i[29]||(i[29]=o("strong",null,"Informasi:",-1)),i[30]||(i[30]=c(" Item telah diperbarui sesuai permintaan. "))],64)):(m(),Z(Ue,{key:2},[i[31]||(i[31]=o("strong",null,"Perhatian:",-1)),i[32]||(i[32]=c(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(je,{class:"px-6 pb-6"},{default:t(()=>[e(Qe),e(R,{color:Me(),onClick:i[7]||(i[7]=d=>ke.value=!1),class:"px-6"},{default:t(()=>[e(_,{icon:"mdi-check",class:"me-1"}),i[33]||(i[33]=c(" OK "))]),_:1,__:[33]},8,["color"]),e(Qe)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),fs=Je(ps,[["__scopeId","data-v-d2ce0c17"]]),gs={class:"d-flex align-center gap-2"},_s={class:"mt-2"},ks={key:0,class:"mt-1 font-weight-medium"},ys={key:1,class:"mt-1 text-warning"},bs=qe({__name:"CreateVariantDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save"],setup(I,{emit:be}){const q=I,D=be,J=$(),f=$(!1),Q=$(!1),T=$([]),b=$({name:"",selectedProduct:null,selectedProductId:null,active:!0}),v=[z=>!!z||"Nama variant wajib diisi",z=>z.length>=3||"Nama variant minimal 3 karakter"],j=[z=>!!z||"Produk wajib dipilih"],p=(z,w="success")=>{const h=document.createElement("div");h.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${w==="success"?"#4CAF50":"#f44336"};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 9999;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
  `;const g=document.createElement("span");if(g.innerHTML=w==="success"?"âœ“":"âœ•",g.style.cssText=`
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    font-weight: bold;
  `,h.appendChild(g),h.appendChild(document.createTextNode(z)),!document.querySelector("#snackbar-styles")){const Y=document.createElement("style");Y.id="snackbar-styles",Y.textContent=`
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `,document.head.appendChild(Y)}document.body.appendChild(h),setTimeout(()=>{h.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{h.parentNode&&h.parentNode.removeChild(h)},300)},3e3)},U=async()=>{Q.value=!0;try{const z=await We.get("/api/products");T.value=z.data.data||z.data||[]}catch(z){console.error("Gagal mengambil data produk:",z),T.value=[]}finally{Q.value=!1}},ce=z=>{!z&&T.value.length===0&&U()},ke=z=>{b.value.selectedProduct=z,z?b.value.selectedProductId=z.id:b.value.selectedProductId=null},H=ve(()=>b.value.selectedProduct?b.value.selectedProduct:b.value.selectedProductId&&T.value.length>0?T.value.find(w=>w.id===b.value.selectedProductId):null),te=()=>{const z=H.value;if(!z||!b.value.name)return"";const w=z.sku||"PROD",h=b.value.name.replace(/\s+/g,"").toUpperCase().substring(0,3),g=Date.now().toString().slice(-4);return`${w}-${h}-${g}`},ne=async()=>{var h,g;if(f.value)return;const{valid:z}=await J.value.validate();if(!z)return;const w=H.value;if(!w){p("Produk tidak ditemukan","error");return}if(!w.id&&!w.id_product){p("ID Produk tidak valid","error"),console.error("Product missing ID:",w);return}f.value=!0;try{const Y={id_product:w.id||w.id_product,name:b.value.name,sku:te(),price:0,cost_price:null,barcode:null,variant_values:[],active:b.value.active},fe=await We.post("/api/variants",Y);if(fe.data.success!==!1&&(fe.status===200||fe.status===201))p("Variant berhasil dibuat!","success"),D("save"),pe();else throw new Error(fe.data.message||"Gagal membuat variant")}catch(Y){const fe=((g=(h=Y.response)==null?void 0:h.data)==null?void 0:g.message)||Y.message||"Gagal membuat variant";p(fe,"error"),console.error("Save variant error:",Y)}finally{f.value=!1}},G=()=>{var z;b.value={name:"",selectedProduct:null,selectedProductId:null,active:!0},(z=J.value)==null||z.resetValidation()},pe=()=>{D("update:modelValue",!1),G()};return Ce(()=>q.modelValue,z=>{z&&(G(),U())}),(z,w)=>(m(),F(Oe,{"model-value":z.modelValue,"onUpdate:modelValue":w[3]||(w[3]=h=>z.$emit("update:modelValue",h)),"max-width":"600px",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"bg-primary text-white"},{default:t(()=>[e(_,{icon:"mdi-plus-circle",class:"me-2"}),w[4]||(w[4]=c(" Tambah Variant Baru ")),e(Qe),e(R,{icon:"mdi-close",variant:"text",color:"white",onClick:pe})]),_:1,__:[4]}),e(Ct,{ref_key:"formRef",ref:J,onSubmit:Pt(ne,["prevent"])},{default:t(()=>[e(oe,{class:"pa-6"},{default:t(()=>[e(De,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(Vt,{modelValue:b.value.selectedProduct,"onUpdate:modelValue":[w[0]||(w[0]=h=>b.value.selectedProduct=h),ke],items:T.value,loading:Q.value,"item-title":"name","return-object":"",label:"Pilih Produk *",placeholder:"Cari produk...",variant:"outlined",rules:j,required:"","no-data-text":"Tidak ada produk ditemukan","onUpdate:search":ce},{item:t(({props:h,item:g})=>[e(Ge,aa(la(h)),{prepend:t(()=>[e($e,{image:g.raw.image_url,size:"40"},{default:t(()=>[g.raw.image_url?W("",!0):(m(),F(_,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"])]),default:t(()=>[e(rt,null,{default:t(()=>[c(r(g.raw.name),1)]),_:2},1024),e(dt,null,{default:t(()=>[c("SKU: "+r(g.raw.sku||"-"),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:h})=>[o("div",gs,[e($e,{image:h.raw.image_url,size:"24"},{default:t(()=>[h.raw.image_url?W("",!0):(m(),F(_,{key:0,icon:"mdi-coffee",size:"16"}))]),_:2},1032,["image"]),o("span",null,r(h.raw.name),1)])]),_:1},8,["modelValue","items","loading"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(we,{modelValue:b.value.name,"onUpdate:modelValue":w[1]||(w[1]=h=>b.value.name=h),label:"Nama Variant *",placeholder:"Contoh: Large Hot, Medium Cold, dll",variant:"outlined",rules:v,required:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(Fe,{color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(_t,null,{default:t(()=>[e(_,{icon:"mdi-information",class:"me-2"}),w[5]||(w[5]=c(" SKU Otomatis "))]),_:1,__:[5]}),o("div",_s,[w[6]||(w[6]=c(" SKU variant akan dibuat otomatis berdasarkan nama produk dan variant ")),b.value.name&&(b.value.selectedProduct||b.value.selectedProductId)?(m(),Z("div",ks," Preview SKU: "+r(te()),1)):b.value.name&&!b.value.selectedProduct&&!b.value.selectedProductId?(m(),Z("div",ys," Pilih produk terlebih dahulu untuk melihat preview SKU ")):W("",!0)])]),_:1})]),_:1}),e(S,{cols:"12"},{default:t(()=>[e(nt,{modelValue:b.value.active,"onUpdate:modelValue":w[2]||(w[2]=h=>b.value.active=h),label:"Variant Aktif",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(He),e(je,{class:"pa-6"},{default:t(()=>[e(Qe),e(R,{variant:"outlined",onClick:pe,disabled:f.value},{default:t(()=>w[7]||(w[7]=[c(" Batal ")])),_:1,__:[7]},8,["disabled"]),e(R,{type:"submit",color:"primary",loading:f.value},{default:t(()=>w[8]||(w[8]=[c(" Simpan Variant ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),hs=Je(bs,[["__scopeId","data-v-5477c365"]]),xs={class:"product-variant-tab"},ws={class:"d-flex gap-2"},Ps={key:0,class:"mt-4 d-flex align-center gap-2"},Vs={key:1,class:"text-center pa-12"},Cs={key:2,class:"text-center pa-12"},Ss={class:"d-flex align-center gap-3"},Is={class:"flex-grow-1 min-width-0"},$s={class:"text-h6 font-weight-bold text-truncate"},Ds={class:"text-body-2 text-medium-emphasis mb-0"},zs={class:"d-flex flex-column gap-1"},Ts={class:"text-xs"},Us={class:"d-flex align-center gap-2"},As={class:"text-primary font-weight-medium"},Hs={class:"d-flex gap-1"},Ms={class:"d-flex align-center justify-space-between w-100"},Ks={class:"d-flex gap-1"},Es=qe({__name:"ProductVariantTab",props:{loading:{type:Boolean}},emits:["refresh"],setup(I,{emit:be}){const q=be,D=$(!1),J=$([]),f=$(!1),Q=$(!1),T=$(null),b=$(!1),v=$(!1),j=$(!1),p=$({search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}),U=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],ce=[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Variant Terbanyak",value:"variants_desc"},{title:"Variant Tersedikit",value:"variants_asc"}],ke=ve(()=>!!(p.value.search||p.value.stockStatus||p.value.activeStatus!==null||p.value.sortBy!=="name_asc")),H=ve(()=>{const s={};return J.value.forEach(a=>{const l=a.id_product;s[l]||(s[l]={product:a.product||{id:a.id_product,id_product:a.id_product,name:`Product ${a.id_product}`,sku:""},variants:[]}),s[l].variants.push(a)}),Object.values(s)}),te=ve(()=>{let s=[...H.value];if(p.value.search){const a=p.value.search.toLowerCase();s=s.filter(l=>{var u;return l.product.name.toLowerCase().includes(a)||((u=l.product.sku)==null?void 0:u.toLowerCase().includes(a))||l.variants.some(le=>le.name.toLowerCase().includes(a)||le.sku.toLowerCase().includes(a))})}switch(p.value.stockStatus&&(s=s.filter(a=>a.variants.some(l=>{var le;return(((le=l.composition_summary)==null?void 0:le.stock_status)||"safe")===p.value.stockStatus}))),p.value.activeStatus!==null&&(s=s.filter(a=>a.variants.some(l=>l.is_active===p.value.activeStatus))),p.value.sortBy){case"name_asc":s.sort((a,l)=>a.product.name.localeCompare(l.product.name));break;case"name_desc":s.sort((a,l)=>l.product.name.localeCompare(a.product.name));break;case"variants_desc":s.sort((a,l)=>l.variants.length-a.variants.length);break;case"variants_asc":s.sort((a,l)=>a.variants.length-l.variants.length);break}return s}),ne=(s,a="success")=>{},G=async s=>{try{const a=J.value.findIndex(l=>l.id_variant===s.variantId);a!==-1&&(J.value[a]={...J.value[a],price:s.newPrice,cost:s.hpp}),ne(`Price updated to ${new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(s.newPrice)}`,"success")}catch(a){console.error("Error handling price update:",a),await pe()}},pe=async()=>{var s,a,l;D.value=!0;try{const u=await We.get("/api/variants",{params:{per_page:1e3,with_product:!0,with_composition:!0}});if(u.data.success===!1)throw new Error(u.data.message||"Failed to load variants");const le=((s=u.data.data)==null?void 0:s.data)||u.data.data||[];J.value=le.map(L=>({...L,is_active:L.active!==void 0?L.active:L.is_active,id:L.id_variant||L.id,id_product:L.id_product||L.product_id}))}catch(u){(l=(a=u.response)==null?void 0:a.data)!=null&&l.message||u.message,J.value=[]}finally{D.value=!1}},z=s=>{T.value=s,b.value=!0},w=s=>{s&&(T.value=s,v.value=!0)},h=s=>{T.value=s,f.value=!0},g=()=>{j.value=!0},Y=async()=>{var s,a;if(T.value)try{Q.value=!0,await We.delete(`/api/variants/${T.value.id_variant}`),ne("Variant berhasil dihapus","success"),await pe(),f.value=!1}catch(l){(a=(s=l.response)==null?void 0:s.data)!=null&&a.message}finally{Q.value=!1}},fe=s=>{switch(s){case"critical":return"error";case"out":return"error";case"safe":return"success";default:return"primary"}},ge=s=>{switch(s){case"critical":return"Kritis";case"out":return"Habis";case"safe":return"Aman";default:return"Normal"}},P=s=>{const a=s.filter(l=>l.is_active).length;return a===0?"error":a===s.length?"success":"warning"},N=s=>s.some(a=>{var u;const l=(u=a.composition_summary)==null?void 0:u.stock_status;return l==="critical"||l==="out"}),x=s=>{const a=s.filter(u=>u.is_active).length,l=s.filter(u=>{var L;const le=(L=u.composition_summary)==null?void 0:L.stock_status;return le==="critical"||le==="out"}).length;return l>0?{text:`${l} Stok Kritis`,color:"error",icon:"mdi-alert-circle"}:a===s.length?{text:"Semua Aktif",color:"success",icon:"mdi-check-circle"}:a===0?{text:"Semua Nonaktif",color:"error",icon:"mdi-close-circle"}:{text:`${a}/${s.length} Aktif`,color:"warning",icon:"mdi-minus-circle"}},O=()=>{p.value={search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}},B=()=>{pe(),q("refresh")},k=()=>{pe(),q("refresh")};return ut(()=>{pe()}),(s,a)=>{var l,u,le;return m(),Z("div",xs,[e(ae,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(Pe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a[14]||(a[14]=o("div",null,[o("h2",{class:"text-h5 font-weight-bold"},"Variant Produk"),o("p",{class:"text-body-2 text-medium-emphasis"}," Kelola variant dan komposisi untuk produk Anda ")],-1)),o("div",ws,[e(R,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:pe,loading:D.value},{default:t(()=>a[12]||(a[12]=[c(" Refresh ")])),_:1,__:[12]},8,["loading"]),e(R,{color:"primary","prepend-icon":"mdi-plus",onClick:g},{default:t(()=>a[13]||(a[13]=[c(" Tambah Variant ")])),_:1,__:[13]})])]),_:1,__:[14]})]),_:1}),e(ae,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(oe,null,{default:t(()=>[e(De,null,{default:t(()=>[e(S,{cols:"12",md:"3"},{default:t(()=>[e(we,{modelValue:p.value.search,"onUpdate:modelValue":a[0]||(a[0]=L=>p.value.search=L),label:"Cari Variant",placeholder:"Nama variant, SKU, atau produk...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Re,{modelValue:p.value.stockStatus,"onUpdate:modelValue":a[1]||(a[1]=L=>p.value.stockStatus=L),items:U,label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Re,{modelValue:p.value.activeStatus,"onUpdate:modelValue":a[2]||(a[2]=L=>p.value.activeStatus=L),items:[{title:"Semua Status",value:null},{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Status Aktif",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(S,{cols:"12",md:"3"},{default:t(()=>[e(Re,{modelValue:p.value.sortBy,"onUpdate:modelValue":a[3]||(a[3]=L=>p.value.sortBy=L),items:ce,label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),ke.value?(m(),Z("div",Ps,[a[16]||(a[16]=o("span",{class:"text-body-2"},"Filter aktif:",-1)),p.value.search?(m(),F(ue,{key:0,size:"small",closable:"","onClick:close":a[4]||(a[4]=L=>p.value.search="")},{default:t(()=>[c(" Pencarian: "+r(p.value.search),1)]),_:1})):W("",!0),p.value.stockStatus?(m(),F(ue,{key:1,size:"small",closable:"","onClick:close":a[5]||(a[5]=L=>p.value.stockStatus="")},{default:t(()=>{var L;return[c(" Stok: "+r((L=U.find(me=>me.value===p.value.stockStatus))==null?void 0:L.title),1)]}),_:1})):W("",!0),p.value.activeStatus!==null?(m(),F(ue,{key:2,size:"small",closable:"","onClick:close":a[6]||(a[6]=L=>p.value.activeStatus=null)},{default:t(()=>[c(" Status: "+r(p.value.activeStatus?"Aktif":"Nonaktif"),1)]),_:1})):W("",!0),e(R,{variant:"text",size:"small",color:"error",onClick:O},{default:t(()=>a[15]||(a[15]=[c(" Hapus Semua Filter ")])),_:1,__:[15]})])):W("",!0)]),_:1})]),_:1}),!D.value&&te.value.length===0&&ke.value?(m(),F(Fe,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada variant yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):W("",!0),D.value?(m(),Z("div",Vs,[e(pt,{color:"primary",indeterminate:"",size:"64"}),a[17]||(a[17]=o("div",{class:"mt-4 text-h6"},"Memuat variant...",-1))])):H.value.length===0?(m(),Z("div",Cs,[e(_,{icon:"mdi-tune-variant",size:"96",class:"text-disabled mb-6"}),a[19]||(a[19]=o("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Variant Produk",-1)),a[20]||(a[20]=o("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat variant untuk produk Anda agar dapat menawarkan pilihan yang beragam ",-1)),e(R,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:g},{default:t(()=>a[18]||(a[18]=[c(" Buat Variant Pertama ")])),_:1,__:[18]})])):(m(),F(De,{key:3},{default:t(()=>[(m(!0),Z(Ue,null,Ye(te.value,L=>(m(),F(S,{key:L.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ae,{class:lt(["variant-group-card h-100",{"border-error":N(L.variants)}]),elevation:"2"},{default:t(()=>[e(Pe,{class:"pa-4 pb-2"},{default:t(()=>[o("div",Ss,[e($e,{image:L.product.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[L.product.image_url?W("",!0):(m(),F(_,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),o("div",Is,[o("h3",$s,r(L.product.name),1),o("p",Ds," SKU: "+r(L.product.sku||"-"),1)]),e(ue,{color:P(L.variants),size:"small",variant:"tonal"},{default:t(()=>[c(r(L.variants.length)+" Variant ",1)]),_:2},1032,["color"])])]),_:2},1024),e(He),e(oe,{class:"pa-4"},{default:t(()=>[e(ft,{class:"pa-0"},{default:t(()=>[(m(!0),Z(Ue,null,Ye(L.variants,(me,Te)=>(m(),F(Ge,{key:me.id_variant,class:lt(["pa-2 rounded-lg variant-item",{"mb-2":Te<L.variants.length-1}])},{prepend:t(()=>[e($e,{size:"32",color:me.is_active?"success":"error",variant:"tonal"},{default:t(()=>[e(_,{icon:me.is_active?"mdi-check":"mdi-close",size:"16"},null,8,["icon"])]),_:2},1032,["color"])]),append:t(()=>[o("div",Hs,[e(Ee,{text:"Kelola Komposisi"},{activator:t(({props:ie})=>[e(R,xe({ref_for:!0},ie,{icon:"mdi-chef-hat",size:"small",variant:"text",color:"primary",onClick:ze=>z(me)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Hapus Variant"},{activator:t(({props:ie})=>[e(R,xe({ref_for:!0},ie,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:ze=>h(me)}),null,16,["onClick"])]),_:2},1024)])]),default:t(()=>[e(rt,{class:"text-sm font-weight-medium"},{default:t(()=>[c(r(me.name),1)]),_:2},1024),e(dt,null,{default:t(()=>[o("div",zs,[o("span",Ts,"SKU: "+r(me.sku),1),o("div",Us,[o("span",As,r(E(Ke)(me.price||0)),1),me.composition_summary?(m(),F(ue,{key:0,color:fe(me.composition_summary.stock_status),size:"x-small",variant:"tonal"},{default:t(()=>[c(r(ge(me.composition_summary.stock_status)),1)]),_:2},1032,["color"])):W("",!0)])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:2},1024)]),_:2},1024),e(He),e(je,{class:"pa-4"},{default:t(()=>[o("div",Ms,[o("div",null,[e(ue,{color:x(L.variants).color,size:"small",variant:"tonal"},{default:t(()=>[e(_,{icon:x(L.variants).icon,size:"14",class:"me-1"},null,8,["icon"]),c(" "+r(x(L.variants).text),1)]),_:2},1032,["color"])]),o("div",Ks,[e(Ee,{text:"Setting HPP Produk"},{activator:t(({props:me})=>[e(R,xe({ref_for:!0},me,{icon:"mdi-calculator-variant",size:"small",variant:"text",color:"warning",onClick:Te=>w(L.variants[0])}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Tambah Variant"},{activator:t(({props:me})=>[e(R,xe({ref_for:!0},me,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:g}),null,16)]),_:1}),e(Ee,{text:"Pengaturan Produk (Coming Soon)"},{activator:t(({props:me})=>[e(R,xe({ref_for:!0},me,{icon:"mdi-cog",size:"small",variant:"text",color:"secondary",disabled:""}),null,16)]),_:1})])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(fs,{modelValue:b.value,"onUpdate:modelValue":a[7]||(a[7]=L=>b.value=L),variant:T.value,onSave:B},null,8,["modelValue","variant"]),e(Kt,{modelValue:v.value,"onUpdate:modelValue":a[8]||(a[8]=L=>v.value=L),"variant-id":(l=T.value)==null?void 0:l.id_variant,"variant-name":(u=T.value)==null?void 0:u.name,onHppUpdated:pe,onPriceUpdated:G},null,8,["modelValue","variant-id","variant-name"]),e(hs,{modelValue:j.value,"onUpdate:modelValue":a[9]||(a[9]=L=>j.value=L),onSave:k},null,8,["modelValue"]),e(Ut,{modelValue:f.value,"onUpdate:modelValue":a[10]||(a[10]=L=>f.value=L),title:"Konfirmasi Hapus Variant","item-name":(le=T.value)==null?void 0:le.name,loading:Q.value,"confirm-text":"Hapus Variant",onConfirm:Y,onCancel:a[11]||(a[11]=L=>f.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),Tt=Je(Es,[["__scopeId","data-v-22b81d4b"]]),Bs={class:"product-management"},Fs={class:"d-flex justify-space-between align-center mb-6"},Rs={class:"d-flex gap-3 align-center"},Ls={key:0,class:"d-flex gap-2"},qs={class:"d-flex align-center"},Ns=qe({__name:"products-management",setup(I){At();const{productsList:be,categories:q,loading:D,saveLoading:J,deleteLoading:f,toggleLoading:Q,stats:T,dialog:b,deleteDialog:v,editMode:j,selectedProduct:p,selectedProducts:U,currentPage:ce,totalItems:ke,itemsPerPage:H,filters:te,errorMessage:ne,successMessage:G,modalErrorMessage:pe,formData:z,selectedImage:w,imagePreview:h,canCreateEdit:g,hasSelectedProducts:Y,fetchProductsList:fe,fetchCategories:ge,fetchStats:P,saveProduct:N,deleteProduct:x,bulkDeleteProducts:O,toggleActiveStatus:B,toggleFeaturedStatus:k,toggleKitchenAvailability:s,toggleBarAvailability:a,openCreateDialog:l,openEditDialog:u,openDeleteDialog:le,closeDialog:L,handleImageUpload:me,clearModalError:Te,updateOptions:ie}=Ht(),{dialog:ze,editMode:Me,formData:ot,availableItems:Xe,saveLoading:V,modalErrorMessage:n,openCreateDialog:i,closeDialog:y,saveRecipe:M,clearModalError:K,fetchAvailableItems:d}=fa(),{productItemsList:A,loading:X,fetchProductItemsForComposition:C}=Et(),se=$("products"),re=$(),he=$(!1),Se=$(null),Ve=$(!1),Ae=$(null),Le=async()=>{await x()},et=async()=>{await O()},Ze=ye=>{const ee=ye.id_product||ye.id;i(ee)},de=async ye=>{Se.value=ye;try{await C({page:1,per_page:100,critical_only:!1})}catch{}he.value=!0},Ie=ye=>{Ae.value=ye,Ve.value=!0},Ne=ye=>{if(!ye)return[];const ee=ye.id_product||ye.id;return A.value.filter(at=>{var _e;return((_e=at.product)==null?void 0:_e.id_product)===ee||at.product_id===ee})||[]},Be=async()=>{if(await C({page:1,per_page:100,critical_only:!1}),await fe(),Se.value&&re.value){const ye=Se.value.id_product||Se.value.id;await re.value.refreshHPPData(ye)}},tt=ye=>{Object.assign(te,ye),fe()},it=ye=>{console.log("Search query received:",ye),te.search=ye,console.log("Filters after search update:",te),fe()},st=()=>{w.value=null,h.value&&(h.value="")};return Ce(se,async ye=>{ye==="compositions"&&await C({page:1,per_page:100,critical_only:!1})},{immediate:!1}),ut(()=>{fe(),ge(),P(),d(),C({page:1,per_page:100,critical_only:!1})}),(ye,ee)=>{var at;return m(),Z("div",Bs,[o("div",Fs,[ee[18]||(ee[18]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),o("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),o("div",Rs,[E(Y)&&se.value==="products"?(m(),Z("div",Ls,[e(ue,{color:"primary",size:"small"},{default:t(()=>[c(r(E(U).length)+" dipilih ",1)]),_:1}),e(R,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:et},{default:t(()=>ee[16]||(ee[16]=[c(" Hapus Terpilih ")])),_:1,__:[16]})])):W("",!0),E(g)&&se.value==="products"?(m(),F(R,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:E(l)},{default:t(()=>ee[17]||(ee[17]=[c(" Tambah Produk ")])),_:1,__:[17]},8,["onClick"])):W("",!0)])]),e($a,{modelValue:se.value,"onUpdate:modelValue":ee[0]||(ee[0]=_e=>se.value=_e),class:"mb-6"},{default:t(()=>[e(yt,{value:"products"},{default:t(()=>[e(_,{icon:"mdi-coffee",class:"me-2"}),ee[19]||(ee[19]=c(" Produk "))]),_:1,__:[19]}),e(yt,{value:"compositions"},{default:t(()=>[e(_,{icon:"mdi-chef-hat",class:"me-2"}),ee[20]||(ee[20]=c(" Komposisi Produk "))]),_:1,__:[20]}),e(yt,{value:"variants"},{default:t(()=>[e(_,{icon:"mdi-tune-variant",class:"me-2"}),ee[21]||(ee[21]=c(" Variant Produk "))]),_:1,__:[21]})]),_:1},8,["modelValue"]),E(ne)?(m(),F(Fe,{key:0,type:"error",variant:"outlined",class:"mb-4",text:E(ne),closable:"","onClick:close":ee[1]||(ee[1]=_e=>ne.value="")},null,8,["text"])):W("",!0),E(G)?(m(),F(Fe,{key:1,type:"success",variant:"outlined",class:"mb-4",text:E(G),closable:"","onClick:close":ee[2]||(ee[2]=_e=>G.value="")},null,8,["text"])):W("",!0),e(Da,{modelValue:se.value,"onUpdate:modelValue":ee[4]||(ee[4]=_e=>se.value=_e)},{default:t(()=>[e(bt,{value:"products"},{default:t(()=>[e(ti,{stats:E(T)},null,8,["stats"]),e(Ko,{filters:E(te),"onUpdate:filters":tt,onSearch:it},null,8,["filters"]),e(xi,{ref_key:"productTableRef",ref:re,products:E(be),loading:E(D),"current-page":E(ce),"total-items":E(ke),"items-per-page":E(H),"selected-products":E(U),"toggle-loading":E(Q),"onUpdate:options":E(ie),onAddProduct:E(l),onEditProduct:E(u),onOpenRecipeDialog:Ze,onOpenCompositionDialog:de,onOpenVariantDialog:Ie,onDeleteProduct:E(le),onToggleActive:E(B),onToggleFeatured:E(k),onToggleKitchen:E(s),onToggleBar:E(a),"onUpdate:selectedProducts":ee[3]||(ee[3]=_e=>U.value=_e)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:options","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured","onToggleKitchen","onToggleBar"])]),_:1}),e(bt,{value:"compositions"},{default:t(()=>[e(ao,{"product-items":E(A),loading:E(X),onRefresh:E(C)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(bt,{value:"variants"},{default:t(()=>[e(Tt,{loading:E(D),onRefresh:E(fe)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(To,{modelValue:E(b),"onUpdate:modelValue":[ee[5]||(ee[5]=_e=>kt(b)?b.value=_e:null),ee[6]||(ee[6]=_e=>b.value=_e)],"edit-mode":E(j),"form-data":E(z),categories:E(q),loading:E(J),"error-message":E(pe),"selected-image":E(w)?[E(w)]:[],"image-preview":E(h),onClose:E(L),onSubmit:E(N),onImageChange:E(me),onRemoveImage:st,onClearError:E(Te),onUpdateForm:ee[7]||(ee[7]=(_e,St)=>E(z)[_e]=St)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(ga,{modelValue:E(ze),"onUpdate:modelValue":[ee[8]||(ee[8]=_e=>kt(ze)?ze.value=_e:null),ee[9]||(ee[9]=_e=>ze.value=_e)],"edit-mode":E(Me),"form-data":E(ot),"available-items":E(Xe),loading:E(V),"error-message":E(n),onClose:E(y),onSave:E(M),onClearError:E(K)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(Ut,{modelValue:E(v),"onUpdate:modelValue":ee[10]||(ee[10]=_e=>kt(v)?v.value=_e:null),title:"Konfirmasi Hapus Produk","item-name":(at=E(p))==null?void 0:at.name,loading:E(f),"confirm-text":"Hapus Produk",onConfirm:Le,onCancel:ee[11]||(ee[11]=_e=>v.value=!1)},null,8,["modelValue","item-name","loading"]),e(Mt,{modelValue:he.value,"onUpdate:modelValue":ee[12]||(ee[12]=_e=>he.value=_e),product:Se.value,items:Ne(Se.value),onSave:Be,onRefresh:Be},null,8,["modelValue","product","items"]),e(Oe,{modelValue:Ve.value,"onUpdate:modelValue":ee[15]||(ee[15]=_e=>Ve.value=_e),"max-width":"1400px",persistent:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Pe,{class:"d-flex justify-between align-center"},{default:t(()=>{var _e;return[o("div",qs,[e(_,{icon:"tabler-versions",class:"me-2"}),c(" Kelola Variant - "+r((_e=Ae.value)==null?void 0:_e.name),1)]),e(R,{icon:"tabler-x",variant:"text",onClick:ee[13]||(ee[13]=St=>Ve.value=!1)})]}),_:1}),e(He),e(oe,{class:"pa-0"},{default:t(()=>[Ae.value?(m(),F(Tt,{key:0,product:Ae.value},null,8,["product"])):W("",!0)]),_:1}),e(He),e(je,null,{default:t(()=>[e(Qe),e(R,{color:"grey-darken-1",variant:"outlined",onClick:ee[14]||(ee[14]=_e=>Ve.value=!1)},{default:t(()=>[e(_,{icon:"mdi-close",class:"me-1"}),ee[22]||(ee[22]=c(" Tutup "))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Mn=Je(Ns,[["__scopeId","data-v-0500c9fb"]]);export{Mn as default};
