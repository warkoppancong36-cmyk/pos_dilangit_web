import{b as se,c as te,g as le,h as ie,d as re,i as ue}from"./VTextField-Cj1TfF2L.js";import{f as ce}from"./forwardRefs-B931MWyl.js";import{a8 as ve,a9 as de,af as ge,aN as fe,bi as oe,V as v,co as ne,r as n,W as me,aH as pe,w as he,aa as Ce,c5 as Ee,b as h,p as W,F as Y,b8 as Se,c2 as ye,au as De}from"./main-Ck3oUqWb.js";import{V as Ae}from"./VChip-BFHVzcUj.js";import{C as m}from"./CategoriesApi-BXVgm5-H.js";const Ie=de({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:a=>typeof a=="boolean"||[1e3,1024].includes(Number(a))},...re({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:a=>a.multiple?[]:null,validator:a=>oe(a).every(d=>d!=null&&typeof d=="object")},...ie({clearable:!0})},"VFileInput"),Pe=ve()({name:"VFileInput",inheritAttrs:!1,props:Ie(),emits:{"click:control":a=>!0,"mousedown:control":a=>!0,"update:focused":a=>!0,"update:modelValue":a=>!0},setup(a,d){let{attrs:k,emit:P,slots:u}=d;const{t:V}=ge(),s=fe(a,"modelValue",a.modelValue,e=>oe(e),e=>!a.multiple&&Array.isArray(e)?e[0]:e),{isFocused:D,focus:b,blur:C}=se(a),E=v(()=>typeof a.showSize!="boolean"?a.showSize:void 0),S=v(()=>(s.value??[]).reduce((e,o)=>{let{size:y=0}=o;return e+y},0)),T=v(()=>ne(S.value,E.value)),A=v(()=>(s.value??[]).map(e=>{const{name:o="",size:y=0}=e;return a.showSize?`${o} (${ne(y,E.value)})`:o})),z=v(()=>{var o;const e=((o=s.value)==null?void 0:o.length)??0;return a.showSize?V(a.counterSizeString,e,T.value):V(a.counterString,e)}),B=n(),I=n(),i=n(),R=me(()=>D.value||a.active),p=v(()=>["plain","underlined"].includes(a.variant)),g=pe(!1);function M(){var e;i.value!==document.activeElement&&((e=i.value)==null||e.focus()),D.value||b()}function L(e){var o;(o=i.value)==null||o.click()}function O(e){P("mousedown:control",e)}function j(e){var o;(o=i.value)==null||o.click(),P("click:control",e)}function N(e){e.stopPropagation(),M(),Se(()=>{s.value=[],ye(a["onClick:clear"],e)})}function H(e){e.preventDefault(),e.stopImmediatePropagation(),g.value=!0}function $(e){e.preventDefault(),g.value=!1}function f(e){var y,_;if(e.preventDefault(),e.stopImmediatePropagation(),g.value=!1,!((_=(y=e.dataTransfer)==null?void 0:y.files)!=null&&_.length)||!i.value)return;const o=new DataTransfer;for(const x of e.dataTransfer.files)o.items.add(x);i.value.files=o.files,i.value.dispatchEvent(new Event("change",{bubbles:!0}))}return he(s,e=>{(!Array.isArray(e)||!e.length)&&i.value&&(i.value.value="")}),Ce(()=>{const e=!!(u.counter||a.counter),o=!!(e||u.details),[y,_]=Ee(k),{modelValue:x,...Z}=te.filterProps(a),J=le.filterProps(a);return h(te,W({ref:B,modelValue:a.multiple?s.value:s.value[0],class:["v-file-input",{"v-file-input--chips":!!a.chips,"v-file-input--dragging":g.value,"v-file-input--hide":a.hideInput,"v-input--plain-underlined":p.value},a.class],style:a.style,"onClick:prepend":L},y,Z,{centerAffix:!p.value,focused:D.value}),{...u,default:G=>{let{id:U,isDisabled:F,isDirty:K,isReadonly:q,isValid:X}=G;return h(le,W({ref:I,"prepend-icon":a.prependIcon,onMousedown:O,onClick:j,"onClick:clear":N,"onClick:prependInner":a["onClick:prependInner"],"onClick:appendInner":a["onClick:appendInner"]},J,{id:U.value,active:R.value||K.value,dirty:K.value||a.dirty,disabled:F.value,focused:D.value,error:X.value===!1,onDragover:H,onDrop:f}),{...u,default:ee=>{var r;let{props:{class:t,...l}}=ee;return h(Y,null,[h("input",W({ref:i,type:"file",readonly:q.value,disabled:F.value,multiple:a.multiple,name:a.name,onClick:c=>{c.stopPropagation(),q.value&&c.preventDefault(),M()},onChange:c=>{if(!c.target)return;const Q=c.target;s.value=[...Q.files??[]]},onDragleave:$,onFocus:M,onBlur:C},l,_),null),h("div",{class:t},[!!((r=s.value)!=null&&r.length)&&!a.hideInput&&(u.selection?u.selection({fileNames:A.value,totalBytes:S.value,totalBytesReadable:T.value}):a.chips?A.value.map(c=>h(Ae,{key:c,size:"small",text:c},null)):A.value.join(", "))])])}})},details:o?G=>{var U,F;return h(Y,null,[(U=u.details)==null?void 0:U.call(u,G),e&&h(Y,null,[h("span",null,null),h(ue,{active:!!((F=s.value)!=null&&F.length),value:z.value,disabled:a.disabled},u.counter)])])}:void 0})}),ce({},B,I,i)}}),w={SUCCESS:{CREATED:"Kategori berhasil ditambahkan",UPDATED:"Kategori berhasil diperbarui",DELETED:"Kategori berhasil dihapus",ACTIVATED:"Status kategori berhasil diaktifkan",DEACTIVATED:"Status kategori berhasil dinonaktifkan"},ERROR:{FETCH:"Terjadi kesalahan saat mengambil data kategori",SAVE:"Terjadi kesalahan saat menyimpan kategori",DELETE:"Terjadi kesalahan saat menghapus kategori",TOGGLE:"Terjadi kesalahan saat mengubah status kategori",IMAGE_TYPE:"File harus berupa gambar",IMAGE_SIZE:"Ukuran file maksimal 2MB",REQUIRED_NAME:"Nama kategori wajib diisi"}},Ve=()=>{const a=De(),d=n([]),k=n(!1),P=n(!1),u=n(!1),V=n({}),s=n(!1),D=n(!1),b=n(!1),C=n(null),E=n({name:"",description:"",image:null,active:!0}),S=n(null),T=n(""),A=n("all"),z=n(10),B=n("grid"),I=n(1),i=n({current_page:1,last_page:1,per_page:10,total:0}),R=n(""),p=n(""),g=n(""),M=v(()=>{var t,l,r,c;return((l=(t=a.user)==null?void 0:t.role)==null?void 0:l.name)==="admin"||((c=(r=a.user)==null?void 0:r.role)==null?void 0:c.name)==="manager"}),L=v(()=>s.value),O=v(()=>i.value.last_page),j=v(()=>d.value.length),N=v(()=>d.value.filter(t=>t.active).length),H=v(()=>d.value.filter(t=>!t.active).length),$=v(()=>i.value.total),f=()=>{setTimeout(()=>{R.value="",p.value=""},5e3)},e=async()=>{var t;k.value=!0;try{const l={page:I.value,per_page:z.value,search:((t=T.value)==null?void 0:t.trim())||void 0,status:A.value!=="all"?A.value:void 0};console.log("=== CATEGORIES FETCH ==="),console.log("Search value:",T.value),console.log("Status filter:",A.value),console.log("Params sent:",l);const r=await m.getCategories(l);console.log("Categories API response:",r),r.success?(d.value=r.data,i.value=r.pagination,console.log("Categories loaded:",d.value.length)):(p.value=r.message||w.ERROR.FETCH,f())}catch(l){console.error("Error fetching categories:",l),p.value=m.handleError(l),f()}finally{k.value=!1}};return{categories:d,loading:k,saveLoading:P,deleteLoading:u,toggleLoading:V,dialog:s,deleteDialog:D,editMode:b,selectedCategory:C,formData:E,imagePreview:S,search:T,statusFilter:A,perPage:z,viewMode:B,currentPage:I,pagination:i,successMessage:R,errorMessage:p,modalErrorMessage:g,canCreateEdit:M,isDialogOpen:L,totalPages:O,totalCategories:j,activeCategories:N,inactiveCategories:H,totalData:$,fetchCategories:e,fetchAllCategories:async()=>{try{k.value=!0;const t={page:1,per_page:100,status:"active"},l=await m.getCategories(t);l.success?(d.value=l.data,l.pagination&&(i.value=l.pagination)):(p.value=l.message||w.ERROR.FETCH,f())}catch(t){p.value=m.handleError(t),f()}finally{k.value=!1}},handleImageUpload:t=>{const l=t[0];if(l){const r=m.validateImage(l);if(!r.valid){g.value=r.error;return}E.value.image=l;const c=new FileReader;c.onload=Q=>{var ae;S.value=(ae=Q.target)==null?void 0:ae.result},c.readAsDataURL(l)}},removeImage:()=>{E.value.image=null,S.value=null;const t=document.querySelector('input[type="file"]');t&&(t.value="")},saveCategory:async t=>{P.value=!0,g.value="";try{const l=t||E.value;(b.value&&C.value?await m.updateCategory(C.value.id_category,l):await m.createCategory(l)).success&&(await e(),s.value=!1,R.value=b.value?w.SUCCESS.UPDATED:w.SUCCESS.CREATED,f())}catch(l){g.value=m.handleError(l)}finally{P.value=!1}},deleteCategory:t=>{C.value=t,D.value=!0},confirmDelete:async()=>{if(C.value){u.value=!0;try{(await m.deleteCategory(C.value.id_category)).success&&(await e(),D.value=!1,R.value=w.SUCCESS.DELETED,f())}catch(t){p.value=m.handleError(t),f()}finally{u.value=!1}}},toggleActiveStatus:async t=>{V.value[t.id_category]=!0;try{(await m.toggleActiveStatus(t.id_category)).success&&(await e(),R.value=t.active?w.SUCCESS.DEACTIVATED:w.SUCCESS.ACTIVATED,f())}catch(l){p.value=m.handleError(l),f()}finally{V.value[t.id_category]=!1}},openCreateDialog:()=>{b.value=!1,g.value="",E.value={name:"",description:"",image:null,active:!0},S.value=null,s.value=!0},openEditDialog:t=>{b.value=!0,C.value=t,g.value="",E.value={name:t.name,description:t.description||"",image:null,active:t.active},S.value=t.image?t.image_url||`/storage/categories/${t.image}`:null,s.value=!0},closeDialog:()=>{s.value=!1,g.value="",S.value=null},onPageChange:t=>{I.value=t,e()},onSearch:()=>{console.log("=== CATEGORIES SEARCH TRIGGERED ==="),console.log("Current search value:",T.value),I.value=1,e()},onFilterChange:()=>{I.value=1,e()},clearMessages:f}};export{Pe as V,Ve as u};
