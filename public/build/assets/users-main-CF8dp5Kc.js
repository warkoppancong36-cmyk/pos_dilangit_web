import{r as g,ax as te,V as y,d as se,D as ae,c,e,b as oe,s as A,t as p,m as q,H as F,ci as re,cv as G,F as O,i as V,o as u,l as ne,v as Q}from"./main-C6EDb_mB.js";import{$ as S}from"./api-DfItBZU5.js";import{u as le,_ as ie}from"./SimpleConfirmDialog.vue_vue_type_script_setup_true_lang-D-D30XT5.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D-EbNoF1.js";function ce(){const f=g([]),h=g(null),v=g(!1),m=g(null),D=g({current_page:1,last_page:1,per_page:15,total:0,from:0,to:0}),k=te({search:"",is_active:void 0,role_id:void 0,sort_by:"name",sort_order:"asc"}),T=y(()=>f.value.length>0),E=y(()=>!v.value&&f.value.length===0),M=y(()=>f.value.filter(o=>o.is_active)),b=y(()=>f.value.filter(o=>!o.is_active)),_=async(o=1,d={})=>{var i,r;v.value=!0,m.value=null;try{const l=new URLSearchParams({page:o.toString(),per_page:D.value.per_page.toString(),...Object.fromEntries(Object.entries(k).filter(([U,C])=>C!==void 0&&C!==""&&C!==null)),...d}),n=await S(`/api/users?${l}`);n.data&&(f.value=n.data.data||n.data,n.meta&&(D.value={current_page:n.meta.current_page,last_page:n.meta.last_page,per_page:n.meta.per_page,total:n.meta.total,from:n.meta.from,to:n.meta.to}))}catch(l){m.value=((r=(i=l.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to fetch users",console.error("Error fetching users:",l)}finally{v.value=!1}},H=async o=>{var d,i;v.value=!0,m.value=null;try{const r=await S(`/api/users/${o}`);return h.value=r.data,r.data}catch(r){throw m.value=((i=(d=r.response)==null?void 0:d.data)==null?void 0:i.message)||"Failed to fetch user",console.error("Error fetching user:",r),r}finally{v.value=!1}},L=async o=>{var d,i;v.value=!0,m.value=null;try{const r=await S("/api/users",{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}});return f.value.unshift(r.data),r.data}catch(r){throw m.value=((i=(d=r.response)==null?void 0:d.data)==null?void 0:i.message)||"Failed to create user",console.error("Error creating user:",r),r}finally{v.value=!1}},z=async(o,d)=>{var i,r,l;v.value=!0,m.value=null;try{const n=await S(`/api/users/${o}`,{method:"PUT",body:JSON.stringify(d),headers:{"Content-Type":"application/json"}}),U=f.value.findIndex(C=>C.id===o);return U!==-1&&(f.value[U]=n.data),((i=h.value)==null?void 0:i.id)===o&&(h.value=n.data),n.data}catch(n){throw m.value=((l=(r=n.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to update user",console.error("Error updating user:",n),n}finally{v.value=!1}};return{users:f,user:h,loading:v,error:m,pagination:D,filters:k,hasUsers:T,isEmpty:E,activeUsers:M,inactiveUsers:b,fetchUsers:_,fetchUser:H,createUser:L,updateUser:z,deleteUser:async o=>{var d,i,r;v.value=!0,m.value=null;try{await S(`/api/users/${o}`,{method:"DELETE"});const l=f.value.findIndex(n=>n.id===o);l!==-1&&f.value.splice(l,1),((d=h.value)==null?void 0:d.id)===o&&(h.value=null)}catch(l){throw m.value=((r=(i=l.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to delete user",console.error("Error deleting user:",l),l}finally{v.value=!1}},updateUserStatus:async(o,d)=>z(o,{is_active:d}),assignRoles:async(o,d)=>{var i,r;v.value=!0,m.value=null;try{const l=await S(`/api/users/${o}/roles`,{method:"POST",body:JSON.stringify({role_ids:d}),headers:{"Content-Type":"application/json"}}),n=f.value.findIndex(U=>U.id===o);return n!==-1&&(f.value[n]=l.data),l.data}catch(l){throw m.value=((r=(i=l.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to assign roles",console.error("Error assigning roles:",l),l}finally{v.value=!1}},searchUsers:async o=>(k.search=o,_(1)),filterUsers:async o=>(Object.assign(k,o),_(1)),resetFilters:()=>{Object.assign(k,{search:"",is_active:void 0,role_id:void 0,sort_by:"name",sort_order:"asc"})}}}const ue={class:"user-management"},ve={class:"page-header"},me={class:"flex justify-between items-center mb-6"},ge={class:"flex gap-3"},fe={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6"},pe={class:"bg-white rounded-lg shadow p-6"},xe={class:"flex items-center"},he={class:"ml-5 w-0 flex-1"},ye={class:"text-lg font-medium text-gray-900"},_e={class:"bg-white rounded-lg shadow p-6"},we={class:"flex items-center"},ke={class:"ml-5 w-0 flex-1"},be={class:"text-lg font-medium text-gray-900"},Ue={class:"bg-white rounded-lg shadow p-6"},Ce={class:"flex items-center"},Me={class:"ml-5 w-0 flex-1"},je={class:"text-lg font-medium text-gray-900"},Se={class:"bg-white rounded-lg shadow p-6"},De={class:"flex items-center"},$e={class:"ml-5 w-0 flex-1"},Te={class:"text-lg font-medium text-gray-900"},ze={class:"bg-white rounded-lg shadow mb-6"},Be={class:"px-6 py-4 border-b border-gray-200"},Ee={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},He={class:"flex flex-col sm:flex-row items-start sm:items-center gap-3 w-full sm:w-auto"},Le=["value"],Re={key:0,class:"p-6 text-center"},Ae={key:1,class:"p-12 text-center"},Fe={key:2,class:"overflow-x-auto"},Oe={class:"min-w-full divide-y divide-gray-200"},Ve={class:"bg-white divide-y divide-gray-200"},Ie={class:"px-6 py-4 whitespace-nowrap"},Ne={class:"flex items-center"},Pe={class:"flex-shrink-0 h-10 w-10"},Je=["src","alt"],qe={key:1,class:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center"},Ge={class:"text-sm font-medium text-gray-700"},Qe={class:"ml-4"},Ke={class:"text-sm font-medium text-gray-900"},We={class:"text-sm text-gray-500"},Xe={class:"px-6 py-4 whitespace-nowrap"},Ye={class:"flex flex-wrap gap-1"},Ze=["onClick"],et={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},tt={key:0},st={class:"text-xs text-gray-400"},at={key:1,class:"text-gray-400"},ot={class:"px-6 py-4 whitespace-nowrap"},rt={class:"flex items-center"},nt={key:0,class:"ml-2 flex-shrink-0 w-2 h-2 bg-green-400 rounded-full",title:"Online"},lt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},it={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},dt={class:"flex items-center justify-end space-x-2"},ct=["onClick"],ut=["onClick"],vt=["onClick","title"],mt={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},gt={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ft=["onClick"],pt=se({__name:"users-main",setup(f){const{users:h,loading:v,fetchUsers:m,deleteUser:D,updateUser:k}=ce(),{roles:T,fetchRoles:E}=le(),M=g(""),b=g(""),_=g(""),H=g(!1),L=g(!1),z=g(!1),I=g(!1),$=g(!1),B=g(null),j=g(null),N=y(()=>v.value),R=y(()=>{let a=h.value;if(M.value){const t=M.value.toLowerCase();a=a.filter(x=>x.name.toLowerCase().includes(t)||x.email.toLowerCase().includes(t))}return b.value&&(b.value==="active"?a=a.filter(t=>t.is_active):b.value==="inactive"&&(a=a.filter(t=>!t.is_active))),_.value&&(a=a.filter(t=>{var x;return(x=t.roles)==null?void 0:x.some(s=>s.id===parseInt(_.value))})),a}),o=y(()=>h.value.filter(a=>a.is_active).length),d=y(()=>T.value.length),i=y(()=>h.value.filter(a=>P(a)).length),r=async()=>{await Promise.all([m(),E()])},l=a=>{B.value=a,L.value=!0},n=a=>{B.value=a,z.value=!0},U=a=>{B.value=a,I.value=!0},C=a=>{j.value=a,$.value=!0},K=async()=>{j.value&&(await D(j.value.id),$.value=!1,j.value=null)},W=async a=>{await k(a.id,{is_active:!a.is_active})},X=a=>a.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),Y=a=>a.is_active?a.email_verified_at?"Active":"Pending":"Inactive",Z=a=>a.is_active?a.email_verified_at?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800",P=a=>{if(!a.last_activity_at)return!1;const t=new Date,x=new Date(a.last_activity_at);return(t.getTime()-x.getTime())/(1e3*60)<5},J=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),ee=a=>{const t=new Date,x=new Date(a),s=(t.getTime()-x.getTime())/(1e3*60*60);return s<1?"Less than an hour ago":s<24?`${Math.floor(s)} hours ago`:s<168?`${Math.floor(s/24)} days ago`:`${Math.floor(s/168)} weeks ago`};return ae(()=>{r()}),(a,t)=>{var x;return u(),c("div",ue,[e("div",ve,[e("div",me,[t[7]||(t[7]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"User Management"),e("p",{class:"text-gray-600"},"Manage system users and their permissions")],-1)),e("div",ge,[e("button",{onClick:t[0]||(t[0]=s=>H.value=!0),class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2"},t[5]||(t[5]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),A(" Add User ")])),e("button",{onClick:r,class:"bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 flex items-center gap-2"},t[6]||(t[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),A(" Refresh ")]))])]),e("div",fe,[e("div",pe,[e("div",xe,[t[9]||(t[9]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})])])],-1)),e("div",he,[e("dl",null,[t[8]||(t[8]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Users",-1)),e("dd",ye,p(q(h).length),1)])])])]),e("div",_e,[e("div",we,[t[11]||(t[11]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])])],-1)),e("div",ke,[e("dl",null,[t[10]||(t[10]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Active Users",-1)),e("dd",be,p(o.value),1)])])])]),e("div",Ue,[e("div",Ce,[t[13]||(t[13]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})])])],-1)),e("div",Me,[e("dl",null,[t[12]||(t[12]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Total Roles",-1)),e("dd",je,p(d.value),1)])])])]),e("div",Se,[e("div",De,[t[15]||(t[15]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})])])],-1)),e("div",$e,[e("dl",null,[t[14]||(t[14]=e("dt",{class:"text-sm font-medium text-gray-500 truncate"},"Online Now",-1)),e("dd",Te,p(i.value),1)])])])])])]),e("div",ze,[e("div",Be,[e("div",Ee,[t[18]||(t[18]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Users",-1)),e("div",He,[F(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>M.value=s),type:"text",placeholder:"Search users...",class:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full sm:w-64"},null,512),[[re,M.value]]),F(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>b.value=s),class:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},t[16]||(t[16]=[e("option",{value:""},"All Status",-1),e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1)]),512),[[G,b.value]]),F(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>_.value=s),class:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[17]||(t[17]=e("option",{value:""},"All Roles",-1)),(u(!0),c(O,null,V(q(T),s=>(u(),c("option",{key:s.id,value:s.id},p(s.display_name||s.name),9,Le))),128))],512),[[G,_.value]])])])]),N.value?(u(),c("div",Re,t[19]||(t[19]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),e("p",{class:"text-gray-600 mt-2"},"Loading users...",-1)]))):R.value.length?(u(),c("div",Fe,[e("table",Oe,[t[26]||(t[26]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," User "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Roles "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Last Login "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Created "),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Ve,[(u(!0),c(O,null,V(R.value,s=>(u(),c("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",Ie,[e("div",Ne,[e("div",Pe,[s.avatar?(u(),c("img",{key:0,src:s.avatar,alt:s.name,class:"h-10 w-10 rounded-full object-cover"},null,8,Je)):(u(),c("div",qe,[e("span",Ge,p(X(s.name)),1)]))]),e("div",Qe,[e("div",Ke,p(s.name),1),e("div",We,p(s.email),1)])])]),e("td",Xe,[e("div",Ye,[(u(!0),c(O,null,V(s.roles,w=>(u(),c("span",{key:w.id,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},p(w.display_name||w.name),1))),128)),e("button",{onClick:w=>n(s),class:"text-blue-600 hover:text-blue-800 text-xs"}," Manage ",8,Ze)])]),e("td",et,[s.last_login_at?(u(),c("div",tt,[A(p(J(s.last_login_at))+" ",1),e("div",st,p(ee(s.last_login_at)),1)])):(u(),c("span",at,"Never"))]),e("td",ot,[e("div",rt,[e("span",{class:Q(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",Z(s)])},p(Y(s)),3),P(s)?(u(),c("div",nt)):ne("",!0)])]),e("td",lt,p(J(s.created_at)),1),e("td",it,[e("div",dt,[e("button",{onClick:w=>l(s),class:"text-blue-600 hover:text-blue-900",title:"Edit User"},t[21]||(t[21]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,ct),e("button",{onClick:w=>U(s),class:"text-purple-600 hover:text-purple-900",title:"Manage Permissions"},t[22]||(t[22]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})],-1)]),8,ut),e("button",{onClick:w=>W(s),class:Q(s.is_active?"text-red-600 hover:text-red-900":"text-green-600 hover:text-green-900"),title:s.is_active?"Deactivate":"Activate"},[s.is_active?(u(),c("svg",mt,t[23]||(t[23]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)]))):(u(),c("svg",gt,t[24]||(t[24]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])))],10,vt),e("button",{onClick:w=>C(s),class:"text-red-600 hover:text-red-900",title:"Delete User"},t[25]||(t[25]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,ft)])])]))),128))])])])):(u(),c("div",Ae,t[20]||(t[20]=[e("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})],-1),e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No users found",-1),e("p",{class:"mt-1 text-sm text-gray-500"},"Get started by adding your first user.",-1)])))]),oe(ie,{show:$.value,title:"Delete User",message:`Are you sure you want to delete '${(x=j.value)==null?void 0:x.name}'? This action cannot be undone.`,"confirm-text":"Delete","confirm-class":"bg-red-600 hover:bg-red-700",onConfirm:K,onCancel:t[4]||(t[4]=s=>$.value=!1)},null,8,["show","message"])])}}}),kt=de(pt,[["__scopeId","data-v-92804544"]]);export{kt as default};
