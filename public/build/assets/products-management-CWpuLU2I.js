import{D as Lt}from"./DeleteConfirmationDialog-BhyEubJo.js";import{f as Ae}from"./formatters-BD6tdLx_.js";import{P as yt,u as ia}from"./useProductItems-DuancFcC.js";import{I as ra}from"./ItemsApi-efuJ0A1J.js";import{u as Dt,H as ua}from"./HPPBreakdownDialog-DT4PDvSG.js";import{V as Ne}from"./VDialog-Bl480fUx.js";import{V as ne,b as Ve,c as Ke}from"./VCard-CjyTzbY9.js";import{cq as Ot,a8 as st,a9 as nt,as as da,aF as ca,af as Nt,bT as ma,r as M,V as de,aG as Xe,w as we,W as Ge,b as e,a0 as K,aa as it,ak as va,ab as jt,ac as Wt,H as Gt,ba as fa,L as pa,N as Xt,bZ as ga,b_ as _a,b9 as ht,aJ as St,I as ka,ag as Jt,aM as xt,bj as ya,bt as Bt,p as ye,be as Tt,cr as ba,c8 as Ft,bh as ha,F as $e,X as D,cp as xa,c9 as wa,aI as Pa,s as _,cs as Va,a$ as Ca,ad as Sa,aH as Ia,b3 as $a,b5 as Da,d as qe,D as dt,c as se,f as t,e as l,t as d,g as N,l as Y,m as L,aw as Pt,i as Je,v as Ye,o as w,ax as It,$ as Ut,j as Yt,ct as Ta,aQ as Ua,aA as Oe,ap as za,aq as Aa,a5 as Ct}from"./main-B1aqd0Vn.js";import{V as ue}from"./VCardText-BbBK60TB.js";import{V as Se}from"./VAvatar-2w9SeItb.js";import{V as pe,m as Ha,b as Rt}from"./VChip-DnC3cq7z.js";import{V as Ce,a as H}from"./VRow-C4K8Zx7m.js";import{V as zt}from"./VAutocomplete-CArct3BB.js";import{u as Ma,e as Ea,t as mt,V as Vt,a as Qe,b as ft,d as pt}from"./VList-ZmEmsTKm.js";import{u as Ba,V as xe,m as Fa}from"./VTextField-7RUAZ8_f.js";import{V as gt}from"./VSwitch-D7_N2OSj.js";import{a as wt,V as Be}from"./VAlert-CUYzWRSG.js";import{V as je}from"./VSpacer-DhS8yAXj.js";import{V as ut}from"./VSnackbar-CLiiBbjb.js";import{_ as We}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Ra,m as Ka,a as qa,V as Fe}from"./VSelect-BnIzapXZ.js";import{V as La}from"./VCheckbox-B-UaLmLY.js";import{V as ze}from"./VDivider-B15MkpeQ.js";import{V as Oa}from"./VContainer-PLp5IAqb.js";import{a as Qt,u as Na,P as ja}from"./useProducts-DoTceV8x.js";import{V as At}from"./VForm-DQbOO8ON.js";import{V as Kt}from"./VTextarea-DUvcUbov.js";import{V as Ee}from"./VTooltip-D7ZxFtq4.js";import{M as Wa,m as Ga,V as Xa}from"./VImg-Bko2yg7S.js";import{V as Ja,u as Ya}from"./useCategories-C069zeWd.js";import{u as Qa,m as Za,h as el}from"./filter-g16zMtTU.js";import{f as Zt,a as tl,s as al}from"./forwardRefs-B931MWyl.js";import{V as ll}from"./VMenu-C3XY-0Fo.js";import{V as ol}from"./VCheckboxBtn-_cdcMevY.js";import{V as sl}from"./VDataTableServer-C2D-p3Xh.js";import{V as nl}from"./VSkeletonLoader-B8Txt4em.js";import{V as il}from"./VDataTable-D1hj7rC9.js";import{c as rl,d as ul,u as dl}from"./VOverlay-B-mghzwU.js";import"./ProductsApi-CV554CR4.js";import"./api-CRCcMQQB.js";import"./index-D-EbNoF1.js";/* empty css              */import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-BTGCNmAu.js";import"./VTable-BogPIozf.js";const cl=s=>{const{touchstartX:R,touchendX:g,touchstartY:m,touchendY:z}=s,p=.5,I=16;s.offsetX=g-R,s.offsetY=z-m,Math.abs(s.offsetY)<p*Math.abs(s.offsetX)&&(s.left&&g<R-I&&s.left(s),s.right&&g>R+I&&s.right(s)),Math.abs(s.offsetX)<p*Math.abs(s.offsetY)&&(s.up&&z<m-I&&s.up(s),s.down&&z>m+I&&s.down(s))};function ml(s,R){var m;const g=s.changedTouches[0];R.touchstartX=g.clientX,R.touchstartY=g.clientY,(m=R.start)==null||m.call(R,{originalEvent:s,...R})}function vl(s,R){var m;const g=s.changedTouches[0];R.touchendX=g.clientX,R.touchendY=g.clientY,(m=R.end)==null||m.call(R,{originalEvent:s,...R}),cl(R)}function fl(s,R){var m;const g=s.changedTouches[0];R.touchmoveX=g.clientX,R.touchmoveY=g.clientY,(m=R.move)==null||m.call(R,{originalEvent:s,...R})}function pl(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const R={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:s.left,right:s.right,up:s.up,down:s.down,start:s.start,move:s.move,end:s.end};return{touchstart:g=>ml(g,R),touchend:g=>vl(g,R),touchmove:g=>fl(g,R)}}function gl(s,R){var S;const g=R.value,m=g!=null&&g.parent?s.parentElement:s,z=(g==null?void 0:g.options)??{passive:!0},p=(S=R.instance)==null?void 0:S.$.uid;if(!m||!p)return;const I=pl(R.value);m._touchHandlers=m._touchHandlers??Object.create(null),m._touchHandlers[p]=I,Ot(I).forEach(c=>{m.addEventListener(c,I[c],z)})}function _l(s,R){var p,I;const g=(p=R.value)!=null&&p.parent?s.parentElement:s,m=(I=R.instance)==null?void 0:I.$.uid;if(!(g!=null&&g._touchHandlers)||!m)return;const z=g._touchHandlers[m];Ot(z).forEach(S=>{g.removeEventListener(S,z[S])}),delete g._touchHandlers[m]}const ea={mounted:gl,unmounted:_l},ta=Symbol.for("vuetify:v-window"),aa=Symbol.for("vuetify:v-window-group"),la=nt({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:s=>typeof s=="boolean"||s==="hover"},touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},...Wt(),...jt(),...va()},"VWindow"),$t=st()({name:"VWindow",directives:{Touch:ea},props:la(),emits:{"update:modelValue":s=>!0},setup(s,R){let{slots:g}=R;const{themeClasses:m}=da(s),{isRtl:z}=ca(),{t:p}=Nt(),I=ma(s,aa),S=M(),c=de(()=>z.value?!s.reverse:s.reverse),k=Xe(!1),ee=de(()=>{const r=s.direction==="vertical"?"y":"x",U=(c.value?!k.value:k.value)?"-reverse":"";return`v-window-${r}${U}-transition`}),h=Xe(0),O=M(void 0),te=de(()=>I.items.value.findIndex(r=>I.selected.value.includes(r.id)));we(te,(r,v)=>{const U=I.items.value.length,f=U-1;U<=2?k.value=r<v:r===f&&v===0?k.value=!0:r===0&&v===f?k.value=!1:k.value=r<v}),pa(ta,{transition:ee,isReversed:k,transitionCount:h,transitionHeight:O,rootRef:S});const J=Ge(()=>s.continuous||te.value!==0),E=Ge(()=>s.continuous||te.value!==I.items.value.length-1);function ce(){J.value&&I.prev()}function ve(){E.value&&I.next()}const W=de(()=>{const r=[],v={icon:z.value?s.nextIcon:s.prevIcon,class:`v-window__${c.value?"right":"left"}`,onClick:I.prev,"aria-label":p("$vuetify.carousel.prev")};r.push(J.value?g.prev?g.prev({props:v}):e(K,v,null):e("div",null,null));const U={icon:z.value?s.prevIcon:s.nextIcon,class:`v-window__${c.value?"left":"right"}`,onClick:I.next,"aria-label":p("$vuetify.carousel.next")};return r.push(E.value?g.next?g.next({props:U}):e(K,U,null):e("div",null,null)),r}),X=de(()=>s.touch===!1?s.touch:{...{left:()=>{c.value?ce():ve()},right:()=>{c.value?ve():ce()},start:v=>{let{originalEvent:U}=v;U.stopPropagation()}},...s.touch===!0?{}:s.touch});return it(()=>Gt(e(s.tag,{ref:S,class:["v-window",{"v-window--show-arrows-on-hover":s.showArrows==="hover"},m.value,s.class],style:s.style},{default:()=>{var r,v;return[e("div",{class:"v-window__container",style:{height:O.value}},[(r=g.default)==null?void 0:r.call(g,{group:I}),s.showArrows!==!1&&e("div",{class:"v-window__controls"},[W.value])]),(v=g.additional)==null?void 0:v.call(g,{group:I})]}}),[[fa("touch"),X.value]])),{group:I}}}),oa=nt({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...Wt(),..._a(),...ul()},"VWindowItem"),vt=st()({name:"VWindowItem",directives:{Touch:ea},props:oa(),emits:{"group:selected":s=>!0},setup(s,R){let{slots:g}=R;const m=Xt(ta),z=ga(s,aa),{isBooted:p}=Ma();if(!m||!z)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const I=Xe(!1),S=de(()=>p.value&&(m.isReversed.value?s.reverseTransition!==!1:s.transition!==!1));function c(){!I.value||!m||(I.value=!1,m.transitionCount.value>0&&(m.transitionCount.value-=1,m.transitionCount.value===0&&(m.transitionHeight.value=void 0)))}function k(){var J;I.value||!m||(I.value=!0,m.transitionCount.value===0&&(m.transitionHeight.value=St((J=m.rootRef.value)==null?void 0:J.clientHeight)),m.transitionCount.value+=1)}function ee(){c()}function h(J){I.value&&ht(()=>{!S.value||!I.value||!m||(m.transitionHeight.value=St(J.clientHeight))})}const O=de(()=>{const J=m.isReversed.value?s.reverseTransition:s.transition;return S.value?{name:typeof J!="string"?m.transition.value:J,onBeforeEnter:k,onAfterEnter:c,onEnterCancelled:ee,onBeforeLeave:k,onAfterLeave:c,onLeaveCancelled:ee,onEnter:h}:!1}),{hasContent:te}=rl(s,z.isSelected);return it(()=>e(Wa,{transition:O.value,disabled:!p.value},{default:()=>{var J;return[Gt(e("div",{class:["v-window-item",z.selectedClass.value,s.class],style:s.style},[te.value&&((J=g.default)==null?void 0:J.call(g))]),[[ka,z.isSelected.value]])]}})),{groupItem:z}}}),kl=nt({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Za({filterKeys:["title"]}),...Ka({hideNoData:!0,returnObject:!0}),...Tt(Fa({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Ga({transition:!1})},"VCombobox"),yl=st()({name:"VCombobox",props:kl(),emits:{"update:focused":s=>!0,"update:modelValue":s=>!0,"update:search":s=>!0,"update:menu":s=>!0},setup(s,R){var u;let{emit:g,slots:m}=R;const{t:z}=Nt(),p=M(),I=Xe(!1),S=Xe(!0),c=Xe(!1),k=M(),ee=M(),h=Xe(-1);let O=!1;const{items:te,transformIn:J,transformOut:E}=Ea(s),{textColorClasses:ce,textColorStyles:ve}=Jt(()=>{var a;return(a=p.value)==null?void 0:a.color}),W=xt(s,"modelValue",[],a=>J(ya(a)),a=>{const b=E(a);return s.multiple?b:b[0]??null}),X=Ba(s),r=de(()=>!!(s.chips||m.chip)),v=de(()=>r.value||!!m.selection),U=Xe(!s.multiple&&!v.value?((u=W.value[0])==null?void 0:u.title)??"":""),f=de({get:()=>U.value,set:a=>{var b;if(U.value=a??"",!s.multiple&&!v.value&&(W.value=[mt(s,a)]),a&&s.multiple&&((b=s.delimiters)!=null&&b.length)){const F=a.split(new RegExp(`(?:${s.delimiters.join("|")})+`));F.length>1&&(F.forEach(q=>{q=q.trim(),q&&Ie(mt(s,q))}),U.value="")}a||(h.value=-1),S.value=!a}}),P=de(()=>typeof s.counterValue=="function"?s.counterValue(W.value):typeof s.counterValue=="number"?s.counterValue:s.multiple?W.value.length:f.value.length),{filteredItems:n,getMatches:x}=Qa(s,te,()=>S.value?"":f.value),B=de(()=>s.hideSelected?n.value.filter(a=>!W.value.some(b=>b.value===a.value)):n.value),ae=de(()=>s.hideNoData&&!B.value.length||X.isReadonly.value||X.isDisabled.value),ge=xt(s,"menu"),me=de({get:()=>ge.value,set:a=>{var b;ge.value&&!a&&((b=k.value)!=null&&b.Î¨openChildren.size)||a&&ae.value||(ge.value=a)}}),G=Ge(()=>me.value?s.closeText:s.openText);we(U,a=>{O?ht(()=>O=!1):I.value&&!me.value&&(me.value=!0),g("update:search",a)}),we(W,a=>{var b;!s.multiple&&!v.value&&(U.value=((b=a[0])==null?void 0:b.title)??"")});const A=de(()=>W.value.map(a=>a.value)),y=de(()=>{var b;return(s.autoSelectFirst===!0||s.autoSelectFirst==="exact"&&f.value===((b=B.value[0])==null?void 0:b.title))&&B.value.length>0&&!S.value&&!c.value}),o=M(),i=Ra(o,p);function T(a){O=!0,s.openOnClear&&(me.value=!0)}function _e(){ae.value||(me.value=!0)}function Q(a){ae.value||(I.value&&(a.preventDefault(),a.stopPropagation()),me.value=!me.value)}function ke(a){var b;a.key!==" "&&Ft(a)&&((b=p.value)==null||b.focus())}function Te(a){var q,$,V,j;if(ba(a)||X.isReadonly.value)return;const b=(q=p.value)==null?void 0:q.selectionStart,F=W.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(a.key)&&a.preventDefault(),["Enter","ArrowDown"].includes(a.key)&&(me.value=!0),["Escape"].includes(a.key)&&(me.value=!1),["Enter","Escape","Tab"].includes(a.key)&&(y.value&&["Enter","Tab"].includes(a.key)&&!W.value.some(C=>{let{value:re}=C;return re===B.value[0].value})&&Ie(n.value[0]),S.value=!0),a.key==="ArrowDown"&&y.value&&(($=o.value)==null||$.focus("next")),a.key==="Enter"&&f.value&&(Ie(mt(s,f.value)),v.value&&(U.value="")),["Backspace","Delete"].includes(a.key)){if(!s.multiple&&v.value&&W.value.length>0&&!f.value)return Ie(W.value[0],!1);if(~h.value){a.preventDefault();const C=h.value;Ie(W.value[h.value],!1),h.value=C>=F-1?F-2:C}else a.key==="Backspace"&&!f.value&&(h.value=F-1);return}if(s.multiple)if(a.key==="ArrowLeft"){if(h.value<0&&b&&b>0)return;const C=h.value>-1?h.value-1:F-1;W.value[C]?h.value=C:(h.value=-1,(V=p.value)==null||V.setSelectionRange(f.value.length,f.value.length))}else if(a.key==="ArrowRight"){if(h.value<0)return;const C=h.value+1;W.value[C]?h.value=C:(h.value=-1,(j=p.value)==null||j.setSelectionRange(0,0))}else~h.value&&Ft(a)&&(h.value=-1)}function ie(){var a;s.eager&&((a=ee.value)==null||a.calculateVisibleItems())}function Me(){var a;I.value&&(S.value=!0,(a=p.value)==null||a.focus())}function Ie(a){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!a||a.props.disabled))if(s.multiple){const F=W.value.findIndex($=>(s.valueComparator||Bt)($.value,a.value)),q=b??!~F;if(~F){const $=q?[...W.value,a]:[...W.value];$.splice(F,1),W.value=$}else q&&(W.value=[...W.value,a]);s.clearOnSelect&&(f.value="")}else{const F=b!==!1;W.value=F?[a]:[],U.value=F&&!v.value?a.title:"",ht(()=>{me.value=!1,S.value=!0})}}function Ze(a){I.value=!0,setTimeout(()=>{c.value=!0})}function et(a){c.value=!1}function Re(a){(a==null||a===""&&!s.multiple&&!v.value)&&(W.value=[])}return we(I,(a,b)=>{if(!(a||a===b)&&(h.value=-1,me.value=!1,f.value)){if(s.multiple){Ie(mt(s,f.value));return}if(!v.value)return;W.value.some(F=>{let{title:q}=F;return q===f.value})?U.value="":Ie(mt(s,f.value))}}),we(me,()=>{if(!s.hideSelected&&me.value&&W.value.length){const a=B.value.findIndex(b=>W.value.some(F=>(s.valueComparator||Bt)(F.value,b.value)));ha&&window.requestAnimationFrame(()=>{var b;a>=0&&((b=ee.value)==null||b.scrollToIndex(a))})}}),we(()=>s.items,(a,b)=>{me.value||I.value&&!b.length&&a.length&&(me.value=!0)}),it(()=>{const a=!!(!s.hideNoData||B.value.length||m["prepend-item"]||m["append-item"]||m["no-data"]),b=W.value.length>0,F=xe.filterProps(s);return e(xe,ye({ref:p},F,{modelValue:f.value,"onUpdate:modelValue":[q=>f.value=q,Re],focused:I.value,"onUpdate:focused":q=>I.value=q,validationValue:W.externalValue,counterValue:P.value,dirty:b,class:["v-combobox",{"v-combobox--active-menu":me.value,"v-combobox--chips":!!s.chips,"v-combobox--selection-slot":!!v.value,"v-combobox--selecting-index":h.value>-1,[`v-combobox--${s.multiple?"multiple":"single"}`]:!0},s.class],style:s.style,readonly:X.isReadonly.value,placeholder:b?void 0:s.placeholder,"onClick:clear":T,"onMousedown:control":_e,onKeydown:Te}),{...m,default:()=>e($e,null,[e(ll,ye({ref:k,modelValue:me.value,"onUpdate:modelValue":q=>me.value=q,activator:"parent",contentClass:"v-combobox__content",disabled:ae.value,eager:s.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:s.transition,onAfterEnter:ie,onAfterLeave:Me},s.menuProps),{default:()=>[a&&e(Vt,ye({ref:o,selected:A.value,selectStrategy:s.multiple?"independent":"single-independent",onMousedown:q=>q.preventDefault(),onKeydown:ke,onFocusin:Ze,onFocusout:et,tabindex:"-1","aria-live":"polite",color:s.itemColor??s.color},i,s.listProps),{default:()=>{var q,$,V;return[(q=m["prepend-item"])==null?void 0:q.call(m),!B.value.length&&!s.hideNoData&&((($=m["no-data"])==null?void 0:$.call(m))??e(Qe,{key:"no-data",title:z(s.noDataText)},null)),e(qa,{ref:ee,renderless:!0,items:B.value,itemKey:"value"},{default:j=>{var Pe;let{item:C,index:re,itemRef:fe}=j;const he=ye(C.props,{ref:fe,key:C.value,active:y.value&&re===0?!0:void 0,onClick:()=>Ie(C,null)});return((Pe=m.item)==null?void 0:Pe.call(m,{item:C,index:re,props:he}))??e(Qe,ye(he,{role:"option"}),{prepend:De=>{let{isSelected:He}=De;return e($e,null,[s.multiple&&!s.hideSelected?e(ol,{key:C.value,modelValue:He,ripple:!1,tabindex:"-1"},null):void 0,C.props.prependAvatar&&e(Se,{image:C.props.prependAvatar},null),C.props.prependIcon&&e(D,{icon:C.props.prependIcon},null)])},title:()=>{var De;return S.value?C.title:el("v-combobox",C.title,(De=x(C))==null?void 0:De.title)}})}}),(V=m["append-item"])==null?void 0:V.call(m)]}})]}),W.value.map((q,$)=>{function V(fe){fe.stopPropagation(),fe.preventDefault(),Ie(q,!1)}const j={"onClick:close":V,onKeydown(fe){fe.key!=="Enter"&&fe.key!==" "||(fe.preventDefault(),fe.stopPropagation(),V(fe))},onMousedown(fe){fe.preventDefault(),fe.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},C=r.value?!!m.chip:!!m.selection,re=C?wa(r.value?m.chip({item:q,index:$,props:j}):m.selection({item:q,index:$})):void 0;if(!(C&&!re))return e("div",{key:q.value,class:["v-combobox__selection",$===h.value&&["v-combobox__selection--selected",ce.value]],style:$===h.value?ve.value:{}},[r.value?m.chip?e(Pa,{key:"chip-defaults",defaults:{VChip:{closable:s.closableChips,size:"small",text:q.title}}},{default:()=>[re]}):e(pe,ye({key:"chip",closable:s.closableChips,size:"small",text:q.title,disabled:q.props.disabled},j),null):re??e("span",{class:"v-combobox__selection-text"},[q.title,s.multiple&&$<W.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[_(",")])])])})]),"append-inner":function(){var j,C;for(var q=arguments.length,$=new Array(q),V=0;V<q;V++)$[V]=arguments[V];return e($e,null,[(j=m["append-inner"])==null?void 0:j.call(m,...$),(!s.hideNoData||s.items.length)&&s.menuIcon?e(D,{class:"v-combobox__menu-icon",color:(C=p.value)==null?void 0:C.fieldIconColor,icon:s.menuIcon,onMousedown:Q,onClick:xa,"aria-label":z(G.value),title:z(G.value),tabindex:"-1"},null):void 0])}})}),Zt({isFocused:I,isPristine:S,menu:me,search:f,selectionIndex:h,filteredItems:n,select:Ie},p)}}),Ht=Symbol.for("vuetify:v-tabs"),bl=nt({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...Tt(Va({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),bt=st()({name:"VTab",props:bl(),setup(s,R){let{slots:g,attrs:m}=R;const{textColorClasses:z,textColorStyles:p}=Jt(()=>s.sliderColor),I=M(),S=M(),c=de(()=>s.direction==="horizontal"),k=de(()=>{var h,O;return((O=(h=I.value)==null?void 0:h.group)==null?void 0:O.isSelected.value)??!1});function ee(h){var te,J;let{value:O}=h;if(O){const E=(J=(te=I.value)==null?void 0:te.$el.parentElement)==null?void 0:J.querySelector(".v-tab--selected .v-tab__slider"),ce=S.value;if(!E||!ce)return;const ve=getComputedStyle(E).color,W=E.getBoundingClientRect(),X=ce.getBoundingClientRect(),r=c.value?"x":"y",v=c.value?"X":"Y",U=c.value?"right":"bottom",f=c.value?"width":"height",P=W[r],n=X[r],x=P>n?W[U]-X[U]:W[r]-X[r],B=Math.sign(x)>0?c.value?"right":"bottom":Math.sign(x)<0?c.value?"left":"top":"center",ge=(Math.abs(x)+(Math.sign(x)<0?W[f]:X[f]))/Math.max(W[f],X[f])||0,me=W[f]/X[f]||0,G=1.5;tl(ce,{backgroundColor:[ve,"currentcolor"],transform:[`translate${v}(${x}px) scale${v}(${me})`,`translate${v}(${x/G}px) scale${v}(${(ge-1)/G+1})`,"none"],transformOrigin:Array(3).fill(B)},{duration:225,easing:al})}}return it(()=>{const h=K.filterProps(s);return e(K,ye({symbol:Ht,ref:I,class:["v-tab",s.class],style:s.style,tabindex:k.value?0:-1,role:"tab","aria-selected":String(k.value),active:!1},h,m,{block:s.fixed,maxWidth:s.fixed?300:void 0,"onGroup:selected":ee}),{...g,default:()=>{var O;return e($e,null,[((O=g.default)==null?void 0:O.call(g))??s.text,!s.hideSlider&&e("div",{ref:S,class:["v-tab__slider",z.value],style:p.value},null)])}})}),Zt({},I)}}),hl=nt({...Tt(la(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),xl=st()({name:"VTabsWindow",props:hl(),emits:{"update:modelValue":s=>!0},setup(s,R){let{slots:g}=R;const m=Xt(Ht,null),z=xt(s,"modelValue"),p=de({get(){var I;return z.value!=null||!m?z.value:(I=m.items.value.find(S=>m.selected.value.includes(S.id)))==null?void 0:I.value},set(I){z.value=I}});return it(()=>{const I=$t.filterProps(s);return e($t,ye({_as:"VTabsWindow"},I,{modelValue:p.value,"onUpdate:modelValue":S=>p.value=S,class:["v-tabs-window",s.class],style:s.style,mandatory:!1,touch:!1}),g)}),{}}}),wl=nt({...oa()},"VTabsWindowItem"),Pl=st()({name:"VTabsWindowItem",props:wl(),setup(s,R){let{slots:g}=R;return it(()=>{const m=vt.filterProps(s);return e(vt,ye({_as:"VTabsWindowItem"},m,{class:["v-tabs-window-item",s.class],style:s.style}),g)}),{}}});function Vl(s){return s?s.map(R=>Da(R)?R:{text:R,value:R}):[]}const Cl=nt({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...Ha({mandatory:"force",selectedClass:"v-tab-item--selected"}),...$a(),...jt()},"VTabs"),Sl=st()({name:"VTabs",props:Cl(),emits:{"update:modelValue":s=>!0},setup(s,R){let{attrs:g,slots:m}=R;const z=xt(s,"modelValue"),p=de(()=>Vl(s.items)),{densityClasses:I}=Ca(s),{backgroundColorClasses:S,backgroundColorStyles:c}=Sa(()=>s.bgColor),{scopeId:k}=dl();return Ia({VTab:{color:Ge(()=>s.color),direction:Ge(()=>s.direction),stacked:Ge(()=>s.stacked),fixed:Ge(()=>s.fixedTabs),sliderColor:Ge(()=>s.sliderColor),hideSlider:Ge(()=>s.hideSlider)}}),it(()=>{const ee=Rt.filterProps(s),h=!!(m.window||s.items.length>0);return e($e,null,[e(Rt,ye(ee,{modelValue:z.value,"onUpdate:modelValue":O=>z.value=O,class:["v-tabs",`v-tabs--${s.direction}`,`v-tabs--align-tabs-${s.alignTabs}`,{"v-tabs--fixed-tabs":s.fixedTabs,"v-tabs--grow":s.grow,"v-tabs--stacked":s.stacked},I.value,S.value,s.class],style:[{"--v-tabs-height":St(s.height)},c.value,s.style],role:"tablist",symbol:Ht},k,g),{default:()=>{var O;return[((O=m.default)==null?void 0:O.call(m))??p.value.map(te=>{var J;return((J=m.tab)==null?void 0:J.call(m,{item:te}))??e(bt,ye(te,{key:te.text,value:te.value}),{default:m[`tab.${te.value}`]?()=>{var E;return(E=m[`tab.${te.value}`])==null?void 0:E.call(m,{item:te})}:void 0})})]}}),h&&e(xl,ye({modelValue:z.value,"onUpdate:modelValue":O=>z.value=O,key:"tabs-window"},k),{default:()=>{var O;return[p.value.map(te=>{var J;return((J=m.item)==null?void 0:J.call(m,{item:te}))??e(Pl,{value:te.value},{default:()=>{var E;return(E=m[`item.${te.value}`])==null?void 0:E.call(m,{item:te})}})}),(O=m.window)==null?void 0:O.call(m)]}})])}),{}}}),Il={class:"d-flex align-center gap-3"},$l={class:"text-body-2 ma-0 opacity-90"},Dl={class:"d-flex align-center gap-4"},Tl={class:"flex-grow-1"},Ul={class:"text-h6 font-weight-bold mb-1"},zl={class:"text-body-2 text-medium-emphasis mb-1"},Al={class:"d-flex align-center gap-4 mb-0"},Hl={class:"text-body-2 text-medium-emphasis mb-0"},Ml={class:"text-body-2 text-info mb-0 font-weight-medium"},El={key:0,class:"text-body-2 text-success mb-0 font-weight-medium"},Bl={class:"text-body-1 font-weight-bold"},Fl={class:"text-body-1 font-weight-bold"},Rl={class:"text-body-1 font-weight-bold"},Kl={class:"text-body-1 font-weight-bold"},ql={class:"d-flex align-center justify-space-between w-100"},Ll={class:"d-flex align-center"},Ol={key:0,class:"text-warning"},Nl={key:1},jl={key:0,class:"text-center pa-8"},Wl={class:"d-flex align-center gap-4 mt-1"},Gl={key:1,class:"text-primary"},Xl={class:"d-flex gap-2"},Jl=qe({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup(s,{emit:R}){const g=s,m=R,z=de({get:()=>g.modelValue,set:u=>m("update:modelValue",u)}),p=M(!1),I=M([]),S=M(!1),c=M(!1),k=M(""),ee=M(""),h=M(!1),O=M(-1),te=M(!1),{loading:J,currentHPPBreakdown:E,getProductHPPBreakdown:ce}=Dt(),ve=de(()=>{var u,a,b;return((u=E.value)==null?void 0:u.total_hpp)||((a=g.product)==null?void 0:a.hpp)||((b=g.product)==null?void 0:b.cost)||0}),W=de(()=>{var b;const u=((b=g.product)==null?void 0:b.price)||0,a=ve.value;return u-a}),X=de(()=>{var b;const u=((b=g.product)==null?void 0:b.price)||0,a=ve.value;return u<=0?0:Math.round((u-a)/u*100)}),r=M({itemId:null,quantity:1,unit:"pcs",isCritical:!1}),v=M([]),U=M(!1),f=M([]),P=async()=>{var u;if(g.product)try{const a=g.product.id_product||g.product.id;console.log("ðŸ”„ Fetching composition for product ID:",a);const b=await yt.getAll({product_id:a,page:1,per_page:1e5});b.success&&((u=b.data)!=null&&u.data)&&(I.value=b.data.data,f.value=JSON.parse(JSON.stringify(b.data.data)),console.log("âœ… Initial composition loaded:",f.value.length,"items"))}catch(a){console.error("Error fetching product composition:",a)}},n=async()=>{var u;U.value=!0;try{const a=await ra.getAll({page:1,per_page:1e5,active:!0});a.success&&((u=a.data)!=null&&u.data)&&(v.value=a.data.data.map(b=>{var F,q,$;return{id:((F=b.id_item)==null?void 0:F.toString())||((q=b.id)==null?void 0:q.toString()),name:b.name,current_stock:(($=b.inventory)==null?void 0:$.current_stock)||0,unit:b.unit||"pcs"}}))}catch(a){console.error("Error fetching available items:",a),v.value=[]}finally{U.value=!1}},x=de(()=>r.value.itemId&&r.value.quantity>0&&r.value.unit.trim().length>0),B=de(()=>{if(!r.value.itemId)return null;const u=v.value.find(a=>a.id===r.value.itemId);return(u==null?void 0:u.unit)||null}),ae=de(()=>{if(!r.value.itemId)return null;const u=v.value.find(a=>a.id===r.value.itemId);return u?G(u):null}),ge=de(()=>ae.value!==null&&ae.value<=0),me=de(()=>Array.isArray(v.value)?v.value:[]),G=u=>u.current_stock||u.stock||0,A=()=>U.value?"Memuat items...":!v.value||v.value.length===0?"Tidak ada item tersedia":"Tidak ada item yang ditemukan",y=u=>{const a=G(u);return a>50?"success":a>20?"warning":a>0?"error":"grey"},o=u=>{const a=G(u);return a>50?"Aman":a>20?"Rendah":a>0?"Kritis":"Habis"};we(()=>r.value.itemId,u=>{if(u){const a=v.value.find(b=>b.id===u);a!=null&&a.unit&&(r.value.unit=a.unit)}}),we(()=>g.items,u=>{u&&u.length>0,I.value=[...u]},{immediate:!0}),we(()=>g.modelValue,async u=>{u&&g.product&&(P(),await i())});const i=async()=>{if(g.product&&(g.product.id_product||g.product.id))try{const u=parseInt(String(g.product.id_product||g.product.id));await ce(u,"latest")}catch(u){console.warn("Could not load HPP data:",u)}};dt(()=>{n()});const T=()=>{te.value=!0},_e=async()=>{await i(),m("refresh")},Q=()=>I.value.some(a=>{var b;return((b=a.item)==null?void 0:b.inventory)&&a.item.inventory.current_stock<a.quantity_needed})?"error":"success",ke=()=>I.value.some(a=>{var b;return((b=a.item)==null?void 0:b.inventory)&&a.item.inventory.current_stock<a.quantity_needed})?"Stok Kritis":"Stok Aman",Te=()=>{if(!x.value)return;const u=v.value.find(F=>F.id===r.value.itemId);if(!u)return;if(I.value.find(F=>{var q;return((q=F.item)==null?void 0:q.id)===u.id})){k.value=`Item "${u.name}" sudah ada dalam komposisi produk ini`,S.value=!0;return}const b={id_product_item:`temp_${Date.now()}`,item:{id:String(u.id),name:u.name,inventory:{current_stock:u.current_stock||0}},quantity_needed:r.value.quantity,unit:r.value.unit,is_critical:r.value.isCritical};I.value.push(b),Ie()},ie=(u,a)=>{var q;if(console.log("ðŸ” EditItem called with:",u),console.log("ðŸ” Item structure:",JSON.stringify(u,null,2)),v.value.length===0){console.warn("âš ï¸ Available items not loaded yet, fetching..."),n().then(()=>{console.log("âœ… Available items loaded, retrying edit"),ie(u,a)});return}h.value=!0,O.value=a;let b=((q=u.item)==null?void 0:q.id)||null;b!==null&&(b=b.toString()),console.log("ðŸŽ¯ Found itemId (converted to string):",b),console.log("ðŸ” Available items for reference:",v.value.map($=>({id:$.id,name:$.name}))),r.value={itemId:b,quantity:parseFloat(u.quantity_needed.toString())||0,unit:u.unit,isCritical:u.is_critical},console.log("ðŸ“ Form data set for edit:",{original_quantity:u.quantity_needed,parsed_quantity:parseFloat(u.quantity_needed.toString()),form_data:r.value});const F=v.value.find($=>$.id===b);if(F)console.log("âœ… Item found in available items:",F.name);else{console.warn("âš ï¸ Item ID not found in available items, trying alternative matching...");const $=v.value.find(V=>{var j;return V.name===((j=u.item)==null?void 0:j.name)});$?(console.log("âœ… Found item by name matching, using ID:",$.id),r.value.itemId=$.id):console.error("âŒ Could not find item in available items by ID or name")}},Me=()=>{if(!x.value||O.value===-1)return;const u=v.value.find(a=>a.id===r.value.itemId);u&&(I.value[O.value]={...I.value[O.value],item:{id:String(u.id),name:u.name,inventory:{current_stock:u.current_stock||0}},quantity_needed:r.value.quantity,unit:r.value.unit,is_critical:r.value.isCritical},Ie())},Ie=()=>{h.value=!1,O.value=-1,r.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},Ze=u=>{I.value.splice(u,1)},et=async()=>{var u,a,b,F,q,$,V,j,C,re,fe,he,Pe,De,He,Le,tt,at,lt,ct,_t,kt;if(g.product){p.value=!0;try{console.log("ðŸ’¾ Saving composition for product:",g.product.name),console.log("ðŸ“¦ Items to save:",I.value);const rt=parseInt(String(((u=g.product)==null?void 0:u.id_product)||((a=g.product)==null?void 0:a.id)||"0")),be=f.value||[],Z=I.value;console.log("ðŸ”„ Comparing items for save:",{existing_count:be.length,current_count:Z.length,existing_items:be.map(le=>{var oe,Ue;return{id:le.id_product_item,item_id:(oe=le.item)==null?void 0:oe.id,item_name:(Ue=le.item)==null?void 0:Ue.name}}),current_items:Z.map(le=>{var oe,Ue;return{id:le.id_product_item,item_id:(oe=le.item)==null?void 0:oe.id,item_name:(Ue=le.item)==null?void 0:Ue.name,quantity:le.quantity_needed,unit:le.unit}})}),console.log("ðŸ”„ Starting to process",Z.length,"items for save...");for(const le of Z){const oe=be.find(ot=>{var Mt,Et;return!!(ot.id_product_item===le.id_product_item||le.id_product_item&&!le.id_product_item.toString().startsWith("temp_")&&((Mt=ot.item)==null?void 0:Mt.id)===((Et=le.item)==null?void 0:Et.id))});if(console.log("ðŸ” Processing item:",{item_name:(b=le.item)==null?void 0:b.name,item_id_product_item:le.id_product_item,existing_found:!!oe,existing_id:oe==null?void 0:oe.id_product_item,is_temp:(F=le.id_product_item)==null?void 0:F.toString().startsWith("temp_"),matching_strategy:oe?oe.id_product_item===le.id_product_item?"exact_id":"item_product_match":"no_match"}),!((q=le.item)!=null&&q.id)||parseInt(le.item.id)===0){console.warn("âš ï¸ Skipping item with invalid item_id:",{item_name:($=le.item)==null?void 0:$.name,item_id:(V=le.item)==null?void 0:V.id,full_item:le});continue}const Ue={product_id:rt,item_id:parseInt(((j=le.item)==null?void 0:j.id)||"0"),quantity_needed:parseFloat(le.quantity_needed.toString()),unit:le.unit,is_critical:le.is_critical,notes:le.notes||""};console.log("ðŸ“¤ API Data for item:",(C=le.item)==null?void 0:C.name,{raw_item_id:(re=le.item)==null?void 0:re.id,parsed_item_id:parseInt(((fe=le.item)==null?void 0:fe.id)||"0"),api_data:Ue,full_item_data:{id_product_item:le.id_product_item,item_name:(he=le.item)==null?void 0:he.name,quantity:le.quantity_needed,unit:le.unit}});try{oe&&!((Pe=le.id_product_item)!=null&&Pe.toString().startsWith("temp_"))?(console.log("âœï¸ Updating existing item:",{id:oe.id_product_item,item_name:(De=le.item)==null?void 0:De.name,current_stock:(Le=(He=le.item)==null?void 0:He.inventory)==null?void 0:Le.current_stock}),await yt.update(parseInt(oe.id_product_item||"0"),Ue)):(console.log("âž• Creating new item:",{item_name:(tt=le.item)==null?void 0:tt.name,current_stock:(lt=(at=le.item)==null?void 0:at.inventory)==null?void 0:lt.current_stock,id_product_item:le.id_product_item,is_temp:(ct=le.id_product_item)==null?void 0:ct.toString().startsWith("temp_"),existing_item_found:!!oe}),await yt.create(Ue))}catch(ot){throw console.error("âŒ Error processing item:",ot),(_t=ot.message)!=null&&_t.includes("already assigned")?k.value=`Item "${(kt=le.item)==null?void 0:kt.name}" sudah ditambahkan ke produk ini`:k.value=ot.message||"Terjadi kesalahan saat menyimpan item",S.value=!0,ot}}for(const le of be)if(!Z.find(Ue=>Ue.id_product_item===le.id_product_item)&&le.id_product_item)try{console.log("ðŸ—‘ï¸ Deleting item:",le.id_product_item),await yt.delete(parseInt(le.id_product_item))}catch(Ue){console.error("âŒ Error deleting item:",Ue),k.value=`Gagal menghapus item: ${Ue.message}`,S.value=!0}console.log("âœ… Composition saved successfully!"),ee.value="Komposisi produk berhasil disimpan!",c.value=!0,m("save",{product:g.product,items:I.value}),m("refresh"),Re()}catch(rt){console.error("âŒ Error saving composition:",rt),S.value||(k.value=rt.message||"Terjadi kesalahan saat menyimpan komposisi",S.value=!0)}finally{p.value=!1}}},Re=()=>{z.value=!1,setTimeout(()=>{I.value=[...g.items],Ie()},300)};return(u,a)=>{var b,F,q,$;return w(),se($e,null,[e(Ne,{modelValue:z.value,"onUpdate:modelValue":a[9]||(a[9]=V=>z.value=V),"max-width":"900",persistent:""},{default:t(()=>[e(ne,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var V;return[l("div",Il,[e(D,{icon:"mdi-chef-hat",size:"24"}),l("div",null,[a[12]||(a[12]=l("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),l("p",$l,d(((V=u.product)==null?void 0:V.name)||"Produk"),1)])]),e(K,{icon:"mdi-close",variant:"text",size:"small",onClick:Re})]}),_:1}),e(ue,{class:"pa-6"},{default:t(()=>[e(ne,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(ue,{class:"pa-4"},{default:t(()=>{var V,j,C,re,fe,he;return[l("div",Dl,[e(Se,{image:(V=u.product)==null?void 0:V.image_url,size:"64"},{default:t(()=>{var Pe;return[(Pe=u.product)!=null&&Pe.image_url?Y("",!0):(w(),N(D,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),l("div",Tl,[l("h4",Ul,d((j=u.product)==null?void 0:j.name),1),l("p",zl," SKU: "+d(((C=u.product)==null?void 0:C.sku)||"SKU-"+((re=u.product)==null?void 0:re.id_product)),1),l("div",Al,[l("p",Hl," Harga: "+d(L(Ae)(((fe=u.product)==null?void 0:fe.price)||0)),1),l("p",Ml," HPP: "+d(L(Ae)(ve.value)),1),(he=u.product)!=null&&he.price&&ve.value?(w(),se("p",El," Margin: "+d(L(Ae)(W.value)),1)):Y("",!0)])]),e(pe,{color:Q(),variant:"tonal"},{default:t(()=>[_(d(ke()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e(Ce,{class:"mb-6"},{default:t(()=>[e(H,{cols:"12",md:"3"},{default:t(()=>[e(ne,{variant:"outlined",color:"info"},{default:t(()=>[e(ue,{class:"text-center pa-3"},{default:t(()=>[e(D,{icon:"mdi-calculator",size:"20",class:"mb-1"}),l("div",Bl,[_(d(L(Ae)(ve.value))+" ",1),L(J)?(w(),N(Pt,{key:0,indeterminate:"",size:"12",width:"2",class:"ml-1"})):Y("",!0)]),a[13]||(a[13]=l("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[13]})]),_:1})]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(ne,{variant:"outlined",color:"primary"},{default:t(()=>[e(ue,{class:"text-center pa-3"},{default:t(()=>{var V;return[e(D,{icon:"mdi-currency-usd",size:"20",class:"mb-1"}),l("div",Fl,d(L(Ae)(((V=u.product)==null?void 0:V.price)||0)),1),a[14]||(a[14]=l("div",{class:"text-caption"},"Harga Jual",-1))]}),_:1,__:[14]})]),_:1})]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(ne,{variant:"outlined",color:"success"},{default:t(()=>[e(ue,{class:"text-center pa-3"},{default:t(()=>[e(D,{icon:"mdi-trending-up",size:"20",class:"mb-1"}),l("div",Rl,d(L(Ae)(W.value)),1),a[15]||(a[15]=l("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[15]})]),_:1})]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(ne,{variant:"outlined",color:"warning"},{default:t(()=>[e(ue,{class:"text-center pa-3"},{default:t(()=>[e(D,{icon:"mdi-percent",size:"20",class:"mb-1"}),l("div",Kl,d(X.value)+"% ",1),a[16]||(a[16]=l("div",{class:"text-caption"},"Margin %",-1))]),_:1,__:[16]})]),_:1})]),_:1})]),_:1}),e(ne,{class:"mb-6",elevation:"2"},{default:t(()=>[e(Ve,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[l("div",ql,[l("div",Ll,[e(D,{icon:h.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),_(" "+d(h.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(ue,{class:"pa-4"},{default:t(()=>[e(Ce,null,{default:t(()=>[e(H,{cols:"12",md:"4"},{default:t(()=>[e(zt,{modelValue:r.value.itemId,"onUpdate:modelValue":a[0]||(a[0]=V=>r.value.itemId=V),items:me.value,loading:U.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item (termasuk yang stok kosong)...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":A()},{item:t(({props:V,item:j})=>[e(Qe,ye(V,{class:{"text-medium-emphasis":G(j.raw)<=0}}),{prepend:t(()=>[e(Se,{size:"32",class:"me-3",color:G(j.raw)<=0?"warning":"primary",variant:"tonal"},{default:t(()=>[e(D,{icon:"mdi-package-variant",color:G(j.raw)<=0?"warning":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[G(j.raw)>0?(w(),N(pe,{key:0,size:"x-small",color:y(j.raw),variant:"tonal"},{default:t(()=>[_(d(o(j.raw)),1)]),_:2},1032,["color"])):(w(),N(pe,{key:1,size:"x-small",color:"warning",variant:"tonal","prepend-icon":"mdi-alert"},{default:t(()=>a[18]||(a[18]=[_(" Kosong ")])),_:1,__:[18]}))]),default:t(()=>[e(ft,null,{default:t(()=>[_(d(j.raw.name),1)]),_:2},1024),e(pt,{class:"text-medium-emphasis"},{default:t(()=>[G(j.raw)<=0?(w(),se("span",Ol,[e(D,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),a[17]||(a[17]=_(" Stok Kosong - Masih bisa digunakan "))])):(w(),se("span",Nl," Stok: "+d(G(j.raw))+" "+d(j.raw.unit),1))]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:r.value.quantity,"onUpdate:modelValue":a[1]||(a[1]=V=>r.value.quantity=V),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:r.value.unit,"onUpdate:modelValue":a[2]||(a[2]=V=>r.value.unit=V),label:"Satuan",variant:"outlined",placeholder:"kg, pcs, ml",readonly:!!B.value,hint:B.value?`Satuan dari item: ${B.value}`:"","persistent-hint":""},null,8,["modelValue","readonly","hint"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(gt,{modelValue:r.value.isCritical,"onUpdate:modelValue":a[3]||(a[3]=V=>r.value.isCritical=V),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(K,{color:h.value?"success":"primary",block:"","prepend-icon":h.value?"mdi-check":"mdi-plus",onClick:a[4]||(a[4]=V=>h.value?Me():Te()),disabled:!x.value},{default:t(()=>[_(d(h.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),h.value?(w(),N(K,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:Ie},{default:t(()=>a[19]||(a[19]=[_(" Batal ")])),_:1,__:[19]})):Y("",!0)]),_:1})]),_:1}),ge.value?(w(),N(Be,{key:0,color:"warning",variant:"tonal",class:"mt-4","prepend-icon":"mdi-alert"},{default:t(()=>[e(wt,null,{default:t(()=>a[20]||(a[20]=[_("Item Stok Kosong")])),_:1,__:[20]}),a[21]||(a[21]=l("div",null,"Item yang dipilih sedang kosong stok, namun masih bisa ditambahkan ke komposisi. Pastikan untuk memperbarui stok sebelum produksi.",-1))]),_:1,__:[21]})):Y("",!0)]),_:1})]),_:1}),e(ne,{elevation:"2"},{default:t(()=>[e(Ve,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e(D,{icon:"mdi-format-list-bulleted",class:"me-2"}),_(" Daftar Item Komposisi ("+d(I.value.length)+") ",1)]),_:1}),e(ue,{class:"pa-0"},{default:t(()=>[I.value.length===0?(w(),se("div",jl,[e(D,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),a[22]||(a[22]=l("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),a[23]||(a[23]=l("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(w(),N(Vt,{key:1},{default:t(()=>[(w(!0),se($e,null,Je(I.value,(V,j)=>(w(),N(Qe,{key:V.id||j,class:"border-b"},{prepend:t(()=>[e(Se,{size:"40",class:"me-3"},{default:t(()=>{var C,re;return[e(D,{icon:(C=V.item)!=null&&C.inventory&&V.item.inventory.current_stock>=V.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(re=V.item)!=null&&re.inventory&&V.item.inventory.current_stock>=V.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[l("div",Xl,[e(K,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:C=>ie(V,j)},null,8,["onClick"]),e(K,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:C=>Ze(j)},null,8,["onClick"])])]),default:t(()=>[e(ft,{class:"font-weight-medium"},{default:t(()=>{var C;return[_(d(((C=V.item)==null?void 0:C.name)||"Item tidak ditemukan")+" ",1),V.is_critical?(w(),N(pe,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>a[24]||(a[24]=[_(" Kritis ")])),_:1,__:[24]})):Y("",!0)]}),_:2},1024),e(pt,null,{default:t(()=>{var C;return[l("div",Wl,[l("span",null,"Dibutuhkan: "+d(parseFloat(V.quantity_needed))+" "+d(V.unit),1),(C=V.item)!=null&&C.inventory?(w(),se("span",{key:0,class:Ye(V.item.inventory.current_stock>=V.quantity_needed?"text-success":"text-error")}," Stok: "+d(V.item.inventory.current_stock)+" "+d(V.unit),3)):Y("",!0),V.formatted_total_cost?(w(),se("span",Gl,d(V.formatted_total_cost),1)):Y("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(Ke,{class:"pa-6 pt-0"},{default:t(()=>[e(K,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:T},{default:t(()=>a[25]||(a[25]=[_(" Setting HPP ")])),_:1,__:[25]}),e(je),e(K,{variant:"outlined",onClick:Re},{default:t(()=>a[26]||(a[26]=[_(" Batal ")])),_:1,__:[26]}),e(K,{color:"primary",onClick:et,loading:p.value},{default:t(()=>a[27]||(a[27]=[_(" Simpan Komposisi ")])),_:1,__:[27]},8,["loading"])]),_:1})]),_:1}),e(ut,{modelValue:S.value,"onUpdate:modelValue":a[6]||(a[6]=V=>S.value=V),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(K,{color:"white",variant:"text",onClick:a[5]||(a[5]=V=>S.value=!1)},{default:t(()=>a[28]||(a[28]=[_(" Tutup ")])),_:1,__:[28]})]),default:t(()=>[_(d(k.value)+" ",1)]),_:1},8,["modelValue"]),e(ut,{modelValue:c.value,"onUpdate:modelValue":a[8]||(a[8]=V=>c.value=V),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(K,{color:"white",variant:"text",onClick:a[7]||(a[7]=V=>c.value=!1)},{default:t(()=>a[29]||(a[29]=[_(" Tutup ")])),_:1,__:[29]})]),default:t(()=>[_(d(ee.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(ua,{modelValue:te.value,"onUpdate:modelValue":a[10]||(a[10]=V=>te.value=V),"product-id":parseInt(String(((b=u.product)==null?void 0:b.id_product)||((F=u.product)==null?void 0:F.id)||"0")),"product-name":((q=u.product)==null?void 0:q.product_name)||(($=u.product)==null?void 0:$.name),onHppUpdated:_e,onPriceUpdated:a[11]||(a[11]=V=>m("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),sa=We(Jl,[["__scopeId","data-v-9c392eac"]]),Yl={class:"composition-cards"},Ql={key:1,class:"text-center pa-12"},Zl={key:2,class:"text-center pa-12"},eo={class:"d-flex align-center gap-3"},to={class:"flex-grow-1 min-width-0"},ao={class:"text-h6 font-weight-bold text-truncate"},lo={class:"text-caption text-medium-emphasis mb-0"},oo={class:"d-flex align-center gap-2 mb-3"},so={class:"text-body-2 font-weight-medium"},no={class:"composition-items"},io={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},ro={class:"text-body-2 text-truncate"},uo={class:"text-end flex-shrink-0"},co={class:"text-body-2 font-weight-medium"},mo={key:0,class:"text-caption text-success"},vo={key:1,class:"text-caption text-primary"},fo={class:"d-flex justify-between align-center mb-3"},po={class:"text-h6 font-weight-bold text-primary"},go={class:"d-flex gap-2"},_o={class:"d-flex align-center"},ko={class:"d-flex align-center gap-4"},yo={class:"flex-grow-1"},bo={class:"text-h5 font-weight-bold mb-2"},ho={class:"d-flex align-center gap-4 mb-2"},xo={class:"text-body-2"},wo={class:"d-flex align-center gap-4"},Po={class:"text-h6 text-primary font-weight-bold"},Vo={class:"text-body-2 text-info font-weight-medium"},Co={key:0,class:"text-body-2 text-success font-weight-medium"},So={class:"d-flex align-center mt-1 gap-4"},Io={class:"d-flex align-center"},$o={class:"d-flex align-center"},Do={key:0,class:"d-flex align-center"},To={class:"text-primary font-weight-medium"},Uo={key:1,class:"text-center py-8"},zo={class:"text-h6 font-weight-bold"},Ao={class:"text-h6 font-weight-bold"},Ho={class:"text-h6 font-weight-bold"},Mo={class:"text-h6 font-weight-bold"},Eo={class:"text-h6 font-weight-bold"},Bo=qe({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup(s,{emit:R}){const g=s,m=R,z=M(!1),p=M(!1),I=M(null),S=M([]),c=M(null),k=M({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),ee=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],h=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],O=P=>{I.value=P,S.value=P.items||[],z.value=!0},te=P=>{c.value=P,p.value=!0},J=P=>{console.log("Composition saved:",P),m("refresh")},E=()=>{k.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},ce=de(()=>!!(k.value.search||k.value.stockStatus||k.value.itemType||k.value.criticalOnly||k.value.sortBy!=="name_asc")),ve=de(()=>{let P=0;return k.value.search&&P++,k.value.stockStatus&&P++,k.value.itemType&&P++,k.value.criticalOnly&&P++,k.value.sortBy!=="name_asc"&&P++,P}),W=de(()=>{const P=new Map;g.productItems.forEach(x=>{if(!x.product)return;const B=x.product.id_product||x.product.id;P.has(B)||P.set(B,{...x.product,items:[],totalItems:0}),P.get(B).items.push(x),P.get(B).totalItems++});let n=Array.from(P.values());if(k.value.search){const x=k.value.search.toLowerCase();n=n.filter(B=>B.name.toLowerCase().includes(x)||B.sku&&B.sku.toLowerCase().includes(x)||B.items.some(ae=>{var ge;return(ge=ae.item)==null?void 0:ge.name.toLowerCase().includes(x)}))}return k.value.stockStatus&&(n=n.filter(x=>{const B=X(x);switch(k.value.stockStatus){case"safe":return B.color==="success";case"critical":return B.color==="warning";case"out":return B.color==="error";default:return!0}})),k.value.criticalOnly&&(n=n.filter(x=>x.items.some(B=>B.is_critical))),n.sort((x,B)=>{switch(k.value.sortBy){case"name_asc":return x.name.localeCompare(B.name);case"name_desc":return B.name.localeCompare(x.name);case"price_asc":return(x.price||0)-(B.price||0);case"price_desc":return(B.price||0)-(x.price||0);case"items_asc":return x.totalItems-B.totalItems;case"items_desc":return B.totalItems-x.totalItems;default:return x.name.localeCompare(B.name)}}),n}),X=P=>{let n=!1,x=!1;return P.items.forEach(B=>{var ae;if((ae=B.item)!=null&&ae.inventory){const ge=B.item.inventory.current_stock||0,me=B.quantity_needed||0;ge<=0?n=!0:(ge<me||B.is_critical)&&(x=!0)}}),n?{text:"Stok Habis",color:"error"}:x?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},r=P=>{if(!(P!=null&&P.inventory))return"grey";const n=P.inventory.current_stock||0;return n<=0?"error":n<=10?"warning":"success"},v=P=>{if(!(P!=null&&P.inventory))return"Tidak ada data";const n=P.inventory.current_stock||0;return n<=0?"Habis":n<=10?"Rendah":"Aman"},U=P=>{const n=r(P);return{"text-error":n==="error","text-warning":n==="warning","text-success":n==="success","text-grey":n==="grey"}},f=P=>`Item Komposisi (${P})`;return(P,n)=>(w(),se("div",Yl,[e(ne,{class:"mb-6"},{default:t(()=>[e(Ve,{class:"d-flex align-center justify-between"},{default:t(()=>[n[12]||(n[12]=l("div",null,[l("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),l("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),e(K,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:n[0]||(n[0]=x=>m("refresh")),loading:P.loading},{default:t(()=>n[11]||(n[11]=[_(" Refresh ")])),_:1,__:[11]},8,["loading"])]),_:1,__:[12]})]),_:1}),e(ne,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ue,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(H,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:k.value.search,"onUpdate:modelValue":n[1]||(n[1]=x=>k.value.search=x),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:k.value.stockStatus,"onUpdate:modelValue":n[2]||(n[2]=x=>k.value.stockStatus=x),items:ee,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:k.value.sortBy,"onUpdate:modelValue":n[3]||(n[3]=x=>k.value.sortBy=x),items:h,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(La,{modelValue:k.value.criticalOnly,"onUpdate:modelValue":n[4]||(n[4]=x=>k.value.criticalOnly=x),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Ce,{class:"mt-3"},{default:t(()=>[e(H,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(K,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:E,disabled:!ce.value},{default:t(()=>n[13]||(n[13]=[_(" Reset Filter ")])),_:1,__:[13]},8,["disabled"]),ce.value?(w(),N(pe,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[_(d(ve.value)+" filter aktif ",1)]),_:1})):Y("",!0)]),_:1}),e(H,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(pe,{color:W.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[_(d(W.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!P.loading&&W.value.length===0&&ce.value?(w(),N(Be,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):Y("",!0),P.loading?(w(),se("div",Ql,[e(Pt,{color:"primary",indeterminate:"",size:"64"}),n[14]||(n[14]=l("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):W.value.length===0?(w(),se("div",Zl,[e(D,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),n[16]||(n[16]=l("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),n[17]||(n[17]=l("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(K,{color:"primary",size:"large","prepend-icon":"mdi-plus"},{default:t(()=>n[15]||(n[15]=[_(" Buat Komposisi Pertama ")])),_:1,__:[15]})])):(w(),N(Ce,{key:3},{default:t(()=>[(w(!0),se($e,null,Je(W.value,x=>(w(),N(H,{key:x.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ne,{class:Ye(["composition-card h-100",{"border-error":X(x).color==="error"}]),elevation:"2"},{default:t(()=>[e(Ve,{class:"pa-4 pb-2"},{default:t(()=>[l("div",eo,[e(Se,{image:x.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[x.image_url?Y("",!0):(w(),N(D,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),l("div",to,[l("h3",ao,d(x.name),1),l("p",lo,d(x.sku||"SKU-"+x.id_product),1)])])]),_:2},1024),e(ue,{class:"py-2"},{default:t(()=>[e(pe,{color:X(x).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[_(d(X(x).text),1)]),_:2},1032,["color"]),l("div",oo,[e(D,{icon:"mdi-format-list-bulleted",size:"16"}),l("span",so,d(f(x.totalItems)),1)]),l("div",no,[(w(!0),se($e,null,Je(x.items,B=>{var ae,ge,me,G;return w(),se("div",{key:B.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[l("div",io,[e(D,{icon:(ae=B.item)!=null&&ae.inventory&&B.item.inventory.current_stock>=B.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(ge=B.item)!=null&&ge.inventory&&B.item.inventory.current_stock>=B.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),l("span",ro,d(((me=B.item)==null?void 0:me.name)||"Item tidak ditemukan"),1),B.is_critical?(w(),N(pe,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>n[18]||(n[18]=[_(" Kritis ")])),_:1,__:[18]})):Y("",!0)]),l("div",uo,[l("div",co,d(parseFloat(B.quantity_needed))+" "+d(B.unit),1),(G=B.item)!=null&&G.inventory?(w(),se("div",mo," Stok: "+d(B.item.inventory.current_stock)+" "+d(B.unit),1)):Y("",!0),B.formatted_total_cost?(w(),se("div",vo,d(B.formatted_total_cost),1)):Y("",!0)])])}),128))])]),_:2},1024),e(ue,{class:"pt-0"},{default:t(()=>[e(ze,{class:"mb-3"}),l("div",fo,[n[19]||(n[19]=l("span",{class:"text-body-2"},"Harga:",-1)),l("span",po,d(L(Ae)(x.price||0)),1)]),l("div",go,[e(K,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:B=>te(x)},{default:t(()=>n[20]||(n[20]=[_(" Detail ")])),_:2,__:[20]},1032,["onClick"]),e(K,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:B=>O(x)},{default:t(()=>n[21]||(n[21]=[_(" Kelola ")])),_:2,__:[21]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(sa,{modelValue:z.value,"onUpdate:modelValue":n[5]||(n[5]=x=>z.value=x),product:I.value,items:S.value,onSave:J,onRefresh:n[6]||(n[6]=x=>m("refresh"))},null,8,["modelValue","product","items"]),e(Ne,{modelValue:p.value,"onUpdate:modelValue":n[10]||(n[10]=x=>p.value=x),"max-width":"900",scrollable:""},{default:t(()=>[e(ne,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",_o,[e(D,{icon:"mdi-eye",class:"mr-2",color:"primary"}),n[22]||(n[22]=l("span",null,"Detail Komposisi Produk",-1))]),e(K,{icon:"",variant:"text",onClick:n[7]||(n[7]=x=>p.value=!1)},{default:t(()=>[e(D,{icon:"mdi-close"})]),_:1})]),_:1}),e(ze),c.value?(w(),N(ue,{key:0},{default:t(()=>[e(Oa,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(H,{cols:"12"},{default:t(()=>[e(ne,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(ue,null,{default:t(()=>[l("div",ko,[e(Se,{image:c.value.image_url,size:"80"},{default:t(()=>[c.value.image_url?Y("",!0):(w(),N(D,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),l("div",yo,[l("h2",bo,d(c.value.name),1),l("div",ho,[e(pe,{color:X(c.value).color,variant:"tonal",size:"small"},{default:t(()=>[_(d(X(c.value).text),1)]),_:1},8,["color"]),l("span",xo,"SKU: "+d(c.value.sku||"-"),1)]),l("div",wo,[l("div",Po,d(L(Ae)(c.value.price||0)),1),l("div",Vo," HPP: "+d(L(Ae)(c.value.hpp||c.value.cost||0)),1),c.value.price&&(c.value.hpp||c.value.cost)?(w(),se("div",Co," Margin: "+d(L(Ae)((c.value.price||0)-(c.value.hpp||c.value.cost||0))),1)):Y("",!0)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e(Ce,null,{default:t(()=>[e(H,{cols:"12"},{default:t(()=>[e(ne,{variant:"outlined"},{default:t(()=>[e(Ve,{class:"text-h6"},{default:t(()=>[e(D,{icon:"mdi-format-list-bulleted",class:"mr-2"}),_(" Komposisi Item ("+d(c.value.totalItems||0)+") ",1)]),_:1}),e(ue,null,{default:t(()=>[c.value.items&&c.value.items.length>0?(w(),N(Vt,{key:0},{default:t(()=>[(w(!0),se($e,null,Je(c.value.items,(x,B)=>(w(),N(Qe,{key:x.id_product_item,class:"px-0"},{prepend:t(()=>[e(Se,{size:"40",color:r(x.item),variant:"tonal"},{default:t(()=>{var ae;return[e(D,{icon:(ae=x.item)!=null&&ae.inventory&&x.item.inventory.current_stock>=x.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(pe,{color:r(x.item),variant:"tonal",size:"small"},{default:t(()=>[_(d(v(x.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(ft,{class:"font-weight-medium"},{default:t(()=>{var ae;return[_(d(((ae=x.item)==null?void 0:ae.name)||"Unknown Item")+" ",1),x.is_critical?(w(),N(pe,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>n[23]||(n[23]=[_(" Kritis ")])),_:1,__:[23]})):Y("",!0)]}),_:2},1024),e(pt,null,{default:t(()=>{var ae,ge;return[l("div",So,[l("div",Io,[e(D,{icon:"mdi-scale",size:"14",class:"mr-1"}),l("span",null," Kebutuhan: "+d(Number(x.quantity_needed||0).toLocaleString("id-ID"))+" "+d(x.unit),1)]),l("div",$o,[e(D,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),l("span",{class:Ye(U(x.item))}," Stok: "+d(Number(((ge=(ae=x.item)==null?void 0:ae.inventory)==null?void 0:ge.current_stock)||0).toLocaleString("id-ID"))+" "+d(x.unit),3)]),x.formatted_total_cost?(w(),se("div",Do,[e(D,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),l("span",To,d(x.formatted_total_cost),1)])):Y("",!0)])]}),_:2},1024),B<c.value.items.length-1?(w(),N(ze,{key:0,class:"mt-3"})):Y("",!0)]),_:2},1024))),128))]),_:1})):(w(),se("div",Uo,[e(D,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),n[24]||(n[24]=l("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e(Ce,{class:"mt-4"},{default:t(()=>[e(H,{cols:"12",md:"2"},{default:t(()=>[e(ne,{variant:"outlined",color:"primary"},{default:t(()=>[e(ue,{class:"text-center"},{default:t(()=>[e(D,{icon:"mdi-format-list-bulleted",size:"24",class:"mb-2"}),l("div",zo,d(c.value.totalItems||0),1),n[25]||(n[25]=l("div",{class:"text-caption"},"Total Item",-1))]),_:1,__:[25]})]),_:1})]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(ne,{variant:"outlined",color:"warning"},{default:t(()=>[e(ue,{class:"text-center"},{default:t(()=>{var x;return[e(D,{icon:"mdi-alert",size:"24",class:"mb-2"}),l("div",Ao,d(((x=c.value.items)==null?void 0:x.filter(B=>B.is_critical).length)||0),1),n[26]||(n[26]=l("div",{class:"text-caption"},"Item Kritis",-1))]}),_:1,__:[26]})]),_:1})]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(ne,{variant:"outlined",color:"info"},{default:t(()=>[e(ue,{class:"text-center"},{default:t(()=>[e(D,{icon:"mdi-calculator",size:"24",class:"mb-2"}),l("div",Ho,d(L(Ae)(c.value.hpp||c.value.cost||0)),1),n[27]||(n[27]=l("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[27]})]),_:1})]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(ne,{variant:"outlined",color:"success"},{default:t(()=>[e(ue,{class:"text-center"},{default:t(()=>[e(D,{icon:"mdi-currency-usd",size:"24",class:"mb-2"}),l("div",Mo,d(L(Ae)(c.value.price||0)),1),n[28]||(n[28]=l("div",{class:"text-caption"},"Harga Jual",-1))]),_:1,__:[28]})]),_:1})]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(ne,{variant:"outlined",color:"purple"},{default:t(()=>[e(ue,{class:"text-center"},{default:t(()=>[e(D,{icon:"mdi-trending-up",size:"24",class:"mb-2"}),l("div",Eo,d(L(Ae)((c.value.price||0)-(c.value.hpp||c.value.cost||0))),1),n[29]||(n[29]=l("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[29]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):Y("",!0),e(ze),e(Ke,{class:"pa-4"},{default:t(()=>[e(je),e(K,{variant:"outlined",onClick:n[8]||(n[8]=x=>p.value=!1)},{default:t(()=>n[30]||(n[30]=[_(" Tutup ")])),_:1,__:[30]}),e(K,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:n[9]||(n[9]=()=>{p.value=!1,O(c.value)})},{default:t(()=>n[31]||(n[31]=[_(" Kelola Komposisi ")])),_:1,__:[31]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),Fo=We(Bo,[["__scopeId","data-v-4b5ad2d5"]]),Ro={class:"d-flex align-center gap-2"},Ko={class:"text-white"},qo={class:"text-h6 mb-4 d-flex align-center gap-2"},Lo={class:"text-h6 mb-4 d-flex align-center gap-2"},Oo={class:"d-flex flex-column gap-2"},No={key:0,class:"d-flex align-center gap-2"},jo={class:"d-flex align-center gap-2 mb-2"},Wo={class:"d-flex gap-2"},Go={class:"d-flex gap-2"},Xo={class:"d-flex align-center justify-space-between"},Jo={class:"d-flex align-center gap-2"},Yo={class:"text-end"},Qo={class:"text-h6 font-weight-bold"},Zo={class:"text-caption"},es={class:"text-h6 mb-4 d-flex align-center gap-2"},ts={class:"text-h6 mb-4 d-flex align-center gap-2"},as={class:"image-upload-container"},ls={key:0,class:"mb-4"},os={class:"text-center mt-2"},ss={class:"text-h6 mb-4 d-flex align-center gap-2"},ns={class:"text-h6 mb-4 d-flex align-center gap-2"},is={class:"d-flex align-center"},rs={class:"text-subtitle-1"},us={class:"text-body-1"},ds={class:"d-flex align-center"},cs={class:"text-subtitle-1"},ms=qe({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup(s,{emit:R}){var G,A,y;const g=Yt(),{nameRules:m,categoryRules:z}=Qt(),{getProductHPPBreakdown:p}=Dt(),I=M(!1),S=M(!1),c=async()=>{if(!(!h.editMode||!E.id))try{const o=await fetch(`/api/products/${E.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(o.ok){const i=await o.json();S.value=i.success&&i.data&&i.data.length>0}}catch(o){console.error("Error checking HPP status:",o)}},k=async()=>{if(E.id)try{I.value=!0;const o=await p(E.id,"latest");o&&(E.cost=o.total_hpp,te("update-form","cost",o.total_hpp))}catch(o){console.error("Error refreshing HPP:",o)}finally{I.value=!1}},ee=()=>{console.log("Open items setup for product:",E.id)},h=s,O=de(()=>h.errorMessage),te=R,J=M(),E=It({...h.formData});we(()=>h.formData,o=>{Object.assign(E,o)},{deep:!0}),we(E,o=>{Object.keys(o).forEach(i=>{te("update-form",i,o[i])})},{deep:!0}),we(()=>h.modelValue,o=>{o&&h.editMode&&c()});const ce=It({length:((G=h.formData.dimensions)==null?void 0:G.length)||null,width:((A=h.formData.dimensions)==null?void 0:A.width)||null,height:((y=h.formData.dimensions)==null?void 0:y.height)||null});we(ce,o=>{const i=o.length!==null||o.width!==null||o.height!==null;E.dimensions=i?{length:o.length!==null?o.length:void 0,width:o.width!==null?o.width:void 0,height:o.height!==null?o.height:void 0}:{}},{deep:!0});const ve=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],W=de(()=>{if(!E.price||!E.cost||E.cost<=0)return 0;const o=(E.price-E.cost)/E.cost*100;return Math.ceil(o)}),X=o=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),r=o=>o<10?"error":o<25?"warning":o<50?"success":"info",v=o=>o<10?"tabler-trending-down":o<25?"tabler-trending-up":o<50?"tabler-trending-up-2":"tabler-trending-up-3",U=o=>!o||o===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),f=o=>{if(!o||o.trim()===""||o==="Rp 0")return 0;const T=o.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(T)||0},P=M(!1),n=o=>{const i=f(o);E.price=i},x=()=>{P.value=!0},B=()=>{P.value=!1},ae=async()=>{var i;const{valid:o}=await((i=J.value)==null?void 0:i.validate());o&&te("submit",E)},ge=o=>{te("image-change",o)},me=()=>{te("remove-image")};return(o,i)=>(w(),N(Ne,{"model-value":o.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":i[25]||(i[25]=T=>o.$emit("update:modelValue",T))},{default:t(()=>[e(ne,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[l("div",Ro,[e(D,{icon:o.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),l("span",Ko,d(o.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(K,{icon:"tabler-x",variant:"text",color:"white",onClick:i[0]||(i[0]=T=>o.$emit("close"))})]),_:1}),e(ze),e(ue,{class:"pa-6"},{default:t(()=>[e(At,{ref_key:"formRef",ref:J,onSubmit:Ut(ae,["prevent"])},{default:t(()=>[e(Ce,null,{default:t(()=>[e(H,{cols:"12"},{default:t(()=>[l("h6",qo,[e(D,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),i[26]||(i[26]=_(" Informasi Dasar "))])]),_:1}),e(H,{cols:"12",md:"8"},{default:t(()=>[e(xe,{modelValue:E.name,"onUpdate:modelValue":i[1]||(i[1]=T=>E.name=T),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:L(m),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:E.sku,"onUpdate:modelValue":i[2]||(i[2]=T=>E.sku=T),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(Kt,{modelValue:E.description,"onUpdate:modelValue":i[3]||(i[3]=T=>E.description=T),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"6"},{default:t(()=>[e(Fe,{"model-value":E.category_id,"onUpdate:modelValue":i[4]||(i[4]=T=>E.category_id=T),items:o.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:L(z),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e(H,{cols:"12",md:"6"},{default:t(()=>[e(xe,{modelValue:E.brand,"onUpdate:modelValue":i[5]||(i[5]=T=>E.brand=T),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[l("h6",Lo,[e(D,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),i[27]||(i[27]=_(" Harga & Biaya "))])]),_:1}),e(H,{cols:"12",md:"6"},{default:t(()=>[e(xe,{"model-value":U(E.price),"onUpdate:modelValue":i[6]||(i[6]=T=>n(T)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:x,onBlur:B},null,8,["model-value"])]),_:1}),e(H,{cols:"12",md:"6"},{default:t(()=>[l("div",Oo,[e(xe,{"model-value":U(E.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),o.editMode?(w(),se("div",No,[e(pe,{color:S.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e(D,{icon:S.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),_(" "+d(S.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),S.value?(w(),N(K,{key:0,size:"small",variant:"outlined",color:"primary",onClick:k,loading:I.value},{default:t(()=>[e(D,{icon:"tabler-refresh",size:"14",class:"me-1"}),i[28]||(i[28]=_(" Update HPP "))]),_:1,__:[28]},8,["loading"])):(w(),N(Ee,{key:1},{activator:t(({props:T})=>[e(pe,ye(T,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e(D,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),i[29]||(i[29]=_(" Belum Ada Resep "))]),_:2,__:[29]},1040)]),default:t(()=>[i[30]||(i[30]=l("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[30]}))])):Y("",!0)])]),_:1}),o.editMode?(w(),N(H,{key:0,cols:"12"},{default:t(()=>[S.value?(w(),N(Be,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(wt,null,{default:t(()=>[e(D,{icon:"tabler-info-circle",class:"me-2"}),i[31]||(i[31]=_(" HPP Otomatis Aktif "))]),_:1,__:[31]}),i[32]||(i[32]=l("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[32]})):(w(),N(Be,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(wt,null,{default:t(()=>[e(D,{icon:"tabler-alert-triangle",class:"me-2"}),i[33]||(i[33]=_(" HPP Manual "))]),_:1,__:[33]}),i[34]||(i[34]=l("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[34]}))]),_:1})):Y("",!0),e(H,{cols:"12"},{default:t(()=>[S.value&&o.editMode?(w(),N(Be,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[l("div",jo,[e(D,{icon:"tabler-check-circle"}),i[35]||(i[35]=l("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),i[38]||(i[38]=l("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),l("div",Wo,[e(K,{size:"small",color:"primary",variant:"outlined",onClick:ee},{default:t(()=>[e(D,{icon:"tabler-edit",size:"14",class:"me-1"}),i[36]||(i[36]=_(" Edit Resep "))]),_:1,__:[36]}),e(K,{size:"small",variant:"outlined",color:"info",onClick:k,loading:I.value},{default:t(()=>[e(D,{icon:"tabler-refresh",size:"14",class:"me-1"}),i[37]||(i[37]=_(" Refresh HPP "))]),_:1,__:[37]},8,["loading"])])]),_:1,__:[38]})):!S.value&&o.editMode?(w(),N(Be,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[l("div",Go,[e(K,{size:"small",variant:"outlined",color:"info",onClick:i[7]||(i[7]=T=>L(g).push("/hpp-management"))},{default:t(()=>[e(D,{icon:"tabler-calculator",size:"14",class:"me-1"}),i[39]||(i[39]=_(" Lihat HPP Management "))]),_:1,__:[39]})])]),_:1})):Y("",!0)]),_:1}),e(H,{cols:"12"},{default:t(()=>[E.price&&E.cost&&E.cost>0?(w(),N(Be,{key:0,color:r(W.value),variant:"tonal",class:"mb-0"},{default:t(()=>[l("div",Xo,[l("div",Jo,[e(D,{icon:v(W.value)},null,8,["icon"]),i[40]||(i[40]=l("span",{class:"font-weight-medium"},"Profit Margin",-1))]),l("div",Yo,[l("div",Qo,d(Math.round(W.value))+"%",1),l("div",Zo," Keuntungan: "+d(X(E.price-E.cost)),1)])])]),_:1},8,["color"])):Y("",!0)]),_:1}),e(H,{cols:"12"},{default:t(()=>[l("h6",es,[e(D,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),i[41]||(i[41]=_(" Dimensi (cm) "))])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:ce.length,"onUpdate:modelValue":i[8]||(i[8]=T=>ce.length=T),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:ce.width,"onUpdate:modelValue":i[9]||(i[9]=T=>ce.width=T),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:ce.height,"onUpdate:modelValue":i[10]||(i[10]=T=>ce.height=T),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[l("h6",ts,[e(D,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),i[42]||(i[42]=_(" Gambar Produk "))])]),_:1}),e(H,{cols:"12"},{default:t(()=>[l("div",as,[o.imagePreview?(w(),se("div",ls,[e(Xa,{src:o.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),l("div",os,[e(K,{size:"small",color:"error",variant:"outlined",onClick:me},{default:t(()=>i[43]||(i[43]=[_(" Hapus Gambar ")])),_:1,__:[43]})])])):Y("",!0),e(Ja,{"model-value":o.selectedImage,"onUpdate:modelValue":i[11]||(i[11]=T=>ge(Array.isArray(T)?T:[T])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),i[44]||(i[44]=l("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e(H,{cols:"12"},{default:t(()=>[l("h6",ss,[e(D,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),i[45]||(i[45]=_(" Pengaturan "))])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(Fe,{"model-value":E.status,"onUpdate:modelValue":i[12]||(i[12]=T=>E.status=T),items:ve,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(gt,{"model-value":E.active,"onUpdate:modelValue":i[13]||(i[13]=T=>E.active=T??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(H,{cols:"12",md:"4"},{default:t(()=>[e(gt,{"model-value":E.featured,"onUpdate:modelValue":i[14]||(i[14]=T=>E.featured=T??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[l("h6",ns,[e(D,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),i[46]||(i[46]=_(" SEO (Opsional) "))])]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(xe,{modelValue:E.meta_title,"onUpdate:modelValue":i[15]||(i[15]=T=>E.meta_title=T),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(Kt,{modelValue:E.meta_description,"onUpdate:modelValue":i[16]||(i[16]=T=>E.meta_description=T),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(yl,{"model-value":E.tags,"onUpdate:modelValue":i[17]||(i[17]=T=>E.tags=T),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(ze),e(Ke,{class:"pa-6"},{default:t(()=>[e(je),e(K,{variant:"outlined",class:"coffee-secondary",onClick:i[18]||(i[18]=T=>o.$emit("close"))},{default:t(()=>i[47]||(i[47]=[_(" Batal ")])),_:1,__:[47]}),e(K,{color:"primary",class:"coffee-primary",loading:o.loading,onClick:ae},{default:t(()=>[_(d(o.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),o.useDialogError?Y("",!0):(w(),N(ut,{key:0,"model-value":!!O.value,"onUpdate:modelValue":i[20]||(i[20]=T=>!T&&o.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(K,{icon:"tabler-x",size:"small",variant:"text",onClick:i[19]||(i[19]=T=>o.$emit("clear-error"))})]),default:t(()=>[l("div",is,[e(D,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),l("div",null,[i[48]||(i[48]=l("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),l("div",rs,d(O.value),1)])])]),_:1},8,["model-value"])),o.useDialogError?(w(),N(Ne,{key:1,"model-value":!!O.value,"onUpdate:modelValue":i[22]||(i[22]=T=>!T&&o.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(ne,null,{default:t(()=>[e(Ve,{class:"d-flex align-center text-error"},{default:t(()=>[e(D,{icon:"tabler-alert-circle",class:"me-2"}),i[49]||(i[49]=_(" Error Occurred "))]),_:1,__:[49]}),e(ze),e(ue,{class:"py-4"},{default:t(()=>[l("div",us,d(O.value),1)]),_:1}),e(ze),e(Ke,{class:"justify-end pa-4"},{default:t(()=>[e(K,{color:"error",variant:"outlined",onClick:i[21]||(i[21]=T=>o.$emit("clear-error"))},{default:t(()=>i[50]||(i[50]=[_(" Close ")])),_:1,__:[50]})]),_:1})]),_:1})]),_:1},8,["model-value"])):Y("",!0),e(ut,{"model-value":!!o.successMessage,"onUpdate:modelValue":i[24]||(i[24]=T=>!T&&o.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(K,{icon:"tabler-x",size:"small",variant:"text",onClick:i[23]||(i[23]=T=>o.$emit("clear-success"))})]),default:t(()=>[l("div",ds,[e(D,{icon:"tabler-check-circle",class:"me-3",size:"28"}),l("div",null,[i[51]||(i[51]=l("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),l("div",cs,d(o.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),vs=We(ms,[["__scopeId","data-v-66fc4b3b"]]),fs={key:0,class:"mt-4"},ps={class:"d-flex align-center gap-2 mb-2"},gs={class:"d-flex flex-wrap gap-2"},_s=qe({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup(s,{emit:R}){const g=s,m=R,{categories:z,loading:p,fetchCategories:I}=Ya(),S=M(!1),c=M("");dt(()=>{I(),c.value=k.search||""});const k=It({...g.filters});we(()=>g.filters,X=>{Object.assign(k,X),c.value=X.search||""},{deep:!0}),Ta(c,X=>{console.log("ðŸ” Search query changed:",X),k.search=X,X.length>=3||X.length===0?(console.log("âœ… Triggering search with query:",X),S.value=!0,m("search",X),J(),setTimeout(()=>{S.value=!1},500)):console.log("â³ Query too short, waiting for more characters:",X.length)},{debounce:500,maxWait:1e3});const ee=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],h=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],O=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],te=de(()=>!!(c.value||k.category_id||k.active||k.stock_status||k.featured!==null||k.min_price||k.max_price)),J=()=>{m("update:filters",{...k})},E=()=>{c.value="",Object.assign(k,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),J()},ce=X=>{const r=z.value.find(v=>v.id_category===X);return(r==null?void 0:r.name)||"Unknown"},ve=X=>{if(!X)return"Semua";const r=ee.find(v=>v.value===X);return(r==null?void 0:r.title)||String(X)},W=X=>{const r=h.find(v=>v.value===X);return(r==null?void 0:r.title)||X};return(X,r)=>(w(),N(ne,{class:"mb-6"},{default:t(()=>[e(Ve,{class:"d-flex align-center gap-2"},{default:t(()=>[e(D,{icon:"tabler-filter",class:"coffee-icon"}),r[11]||(r[11]=_(" Filter & Pencarian Produk "))]),_:1,__:[11]}),e(ue,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(H,{cols:"12",md:"4"},{default:t(()=>[e(xe,{modelValue:c.value,"onUpdate:modelValue":r[0]||(r[0]=v=>c.value=v),label:"Cari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:S.value,clearable:"",variant:"outlined",hint:c.value.length>0&&c.value.length<3?`Ketik ${3-c.value.length} karakter lagi untuk mencari`:"","persistent-hint":""},null,8,["modelValue","loading","hint"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:k.category_id,"onUpdate:modelValue":[r[1]||(r[1]=v=>k.category_id=v),J],items:L(z),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:L(p),clearable:"",variant:"outlined"},null,8,["modelValue","items","loading"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(Fe,{modelValue:k.active,"onUpdate:modelValue":[r[2]||(r[2]=v=>k.active=v),J],items:ee,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(Fe,{modelValue:k.stock_status,"onUpdate:modelValue":[r[3]||(r[3]=v=>k.stock_status=v),J],items:h,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(K,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:E})]),_:1})]),_:1}),e(Ce,{class:"mt-3"},{default:t(()=>[e(H,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:k.min_price,"onUpdate:modelValue":r[4]||(r[4]=v=>k.min_price=v),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:J},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:k.max_price,"onUpdate:modelValue":r[5]||(r[5]=v=>k.max_price=v),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:J},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(Fe,{modelValue:k.sort_order,"onUpdate:modelValue":[r[6]||(r[6]=v=>k.sort_order=v),J],items:O,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),te.value?(w(),se("div",fs,[l("div",ps,[e(D,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),r[12]||(r[12]=l("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),l("div",gs,[c.value?(w(),N(pe,{key:0,closable:"",size:"small",color:"coffee","onClick:close":r[7]||(r[7]=v=>{c.value="",k.search="",J()})},{default:t(()=>[_(" Pencarian: "+d(c.value),1)]),_:1})):Y("",!0),k.category_id?(w(),N(pe,{key:1,closable:"",size:"small",color:"coffee","onClick:close":r[8]||(r[8]=v=>{k.category_id=null,J()})},{default:t(()=>[_(" Kategori: "+d(ce(k.category_id)),1)]),_:1})):Y("",!0),k.active?(w(),N(pe,{key:2,closable:"",size:"small",color:"coffee","onClick:close":r[9]||(r[9]=v=>{k.active=null,J()})},{default:t(()=>[_(" Status: "+d(ve(k.active)),1)]),_:1})):Y("",!0),k.stock_status?(w(),N(pe,{key:3,closable:"",size:"small",color:"coffee","onClick:close":r[10]||(r[10]=v=>{k.stock_status=null,J()})},{default:t(()=>[_(" Stok: "+d(W(k.stock_status)),1)]),_:1})):Y("",!0)])])):Y("",!0)]),_:1})]),_:1}))}}),ks=We(_s,[["__scopeId","data-v-1afc3ae3"]]),ys={class:"d-flex align-center gap-2"},bs={class:"text-h6"},hs={class:"d-flex align-center gap-2"},xs={class:"text-h6"},ws={class:"d-flex align-center gap-2"},Ps={class:"text-h6"},Vs={class:"d-flex align-center gap-2"},Cs={class:"text-h6"},Ss={class:"d-flex align-center gap-2"},Is={class:"text-h6"},$s={class:"d-flex align-center gap-2"},Ds={class:"text-h6"},Ts={class:"d-flex align-center gap-2"},Us={class:"text-h6"},zs={class:"d-flex align-center gap-2"},As={class:"text-h6"},Hs=qe({__name:"ProductStatsCards",props:{stats:{}},setup(s){const R=m=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),g=m=>`${m.toFixed(1)}%`;return(m,z)=>(w(),N(Ce,{class:"mb-6"},{default:t(()=>[e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ne,{class:"stats-card"},{default:t(()=>[e(ue,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-package"})]),_:1}),l("div",null,[z[0]||(z[0]=l("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),l("div",ys,[l("h6",bs,d(((p=m.stats)==null?void 0:p.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ne,{class:"stats-card"},{default:t(()=>[e(ue,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-check"})]),_:1}),l("div",null,[z[1]||(z[1]=l("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),l("div",hs,[l("h6",xs,d(((p=m.stats)==null?void 0:p.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ne,{class:"stats-card"},{default:t(()=>[e(ue,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-star"})]),_:1}),l("div",null,[z[2]||(z[2]=l("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),l("div",ws,[l("h6",Ps,d(((p=m.stats)==null?void 0:p.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ne,{class:"stats-card"},{default:t(()=>[e(ue,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-alert-triangle"})]),_:1}),l("div",null,[z[3]||(z[3]=l("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),l("div",Vs,[l("h6",Cs,d(((p=m.stats)==null?void 0:p.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ne,{class:"stats-card"},{default:t(()=>[e(ue,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-currency-dollar"})]),_:1}),l("div",null,[z[4]||(z[4]=l("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),l("div",Ss,[l("h6",Is,d(R(((p=m.stats)==null?void 0:p.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ne,{class:"stats-card"},{default:t(()=>[e(ue,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-chart-line"})]),_:1}),l("div",null,[z[5]||(z[5]=l("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),l("div",$s,[l("h6",Ds,d(R(((p=m.stats)==null?void 0:p.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ne,{class:"stats-card"},{default:t(()=>[e(ue,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-trending-up"})]),_:1}),l("div",null,[z[6]||(z[6]=l("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),l("div",Ts,[l("h6",Us,d(g(((p=m.stats)==null?void 0:p.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e(H,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(ne,{class:"stats-card"},{default:t(()=>[e(ue,{class:"d-flex align-center"},{default:t(()=>{var p;return[e(Se,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e(D,{icon:"tabler-x-circle"})]),_:1}),l("div",null,[z[7]||(z[7]=l("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),l("div",zs,[l("h6",As,d(((p=m.stats)==null?void 0:p.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),Ms=We(Hs,[["__scopeId","data-v-124783ae"]]),Es={class:"d-flex align-center gap-2"},Bs={class:"d-flex align-center gap-2"},Fs={class:"text-center py-8"},Rs={class:"d-flex align-center gap-3 py-2"},Ks={class:"font-weight-medium"},qs={class:"text-caption text-medium-emphasis"},Ls={class:"text-end"},Os={class:"font-weight-medium"},Ns={class:"text-caption text-medium-emphasis d-flex align-center justify-end gap-1"},js={class:"text-center profit-margin-container"},Ws={class:"text-center"},Gs={key:0,class:"text-caption text-medium-emphasis mt-1"},Xs={class:"d-flex align-center gap-2"},Js={class:"text-body-2"},Ys={class:"text-caption text-medium-emphasis"},Qs={class:"d-flex align-center gap-1"},Zs=300*1e3,en=1e3,tn=qe({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","bulk-delete","update:page","update:items-per-page","update:sort-by","update:selected-products"],setup(s,{expose:R}){const g=s,{currentHPPBreakdown:m,getProductHPPBreakdown:z}=Dt(),p=M({}),I=M({}),S=M({}),c=M(new Set),k=M(new Set);let ee=null;const h=f=>{const P=S.value[f];return P?Date.now()-P.timestamp<Zs:!1},O=async()=>{if(k.value.size===0)return;const f=Array.from(k.value);k.value.clear(),console.log(`Loading HPP for ${f.length} products in batch`);const P=3;for(let n=0;n<f.length;n+=P){const B=f.slice(n,n+P).map(async ae=>{var ge;if(!(I.value[ae]||h(ae))){I.value[ae]=!0,c.value.add(ae);try{if(await z(ae,"latest"),(ge=m.value)!=null&&ge.total_hpp){const me=m.value.total_hpp;p.value[ae]=me,S.value[ae]={data:me,timestamp:Date.now(),attempted:!0}}else S.value[ae]={data:0,timestamp:Date.now(),attempted:!0}}catch(me){console.warn(`Could not load HPP for product ${ae}:`,me),S.value[ae]={data:0,timestamp:Date.now(),attempted:!0}}finally{I.value[ae]=!1}}});await Promise.all(B),n+P<f.length&&await new Promise(ae=>setTimeout(ae,500))}},te=f=>{if(h(f)){p.value[f]=S.value[f].data;return}c.value.has(f)||(k.value.add(f),ee&&clearTimeout(ee),ee=setTimeout(()=>{O()},en))},J=()=>{for(const f of g.products){const P=f.id_product||f.id;P&&(h(P)?p.value[P]=S.value[P].data:!c.value.has(P)&&!I.value[P]&&te(P))}},E=f=>{const P=f.id_product||f.id;return p.value[P]||f.cost||0},ce=f=>{const P=E(f),n=f.price||0;return n<=0||P<=0?0:Math.round((n-P)/n*100)};Ua(()=>{g.products&&g.products.length>0&&J()}),dt(()=>{g.products&&g.products.length>0&&J()}),R({refreshHPPData:async f=>{f?(delete S.value[f],delete p.value[f],c.value.delete(f),g.products.find(n=>(n.id_product||n.id)===f)&&te(f)):(S.value={},p.value={},c.value.clear(),k.value.clear(),J())}});const W=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],X=f=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(f),r=f=>new Date(f).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),v=f=>new Date(f).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),U=f=>f<10?"error":f<25?"warning":f<50?"success":"info";return(f,P)=>(w(),N(ne,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",Es,[e(D,{icon:"tabler-list",class:"coffee-icon"}),P[7]||(P[7]=_(" Data Produk ")),f.totalItems?(w(),N(pe,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[_(d(f.totalItems)+" item ",1)]),_:1})):Y("",!0)]),l("div",Bs,[f.selectedProducts.length>0?(w(),N(K,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:P[0]||(P[0]=n=>f.$emit("bulk-delete"))},{default:t(()=>[_(" Hapus Terpilih ("+d(f.selectedProducts.length)+") ",1)]),_:1})):Y("",!0),e(K,{"prepend-icon":"tabler-plus",color:"coffee",onClick:P[1]||(P[1]=n=>f.$emit("add-product"))},{default:t(()=>P[8]||(P[8]=[_(" Tambah Produk ")])),_:1,__:[8]})])]),_:1}),e(ze),e(sl,{"model-value":f.selectedProducts,"onUpdate:modelValue":P[3]||(P[3]=n=>f.$emit("update:selected-products",n)),headers:W,items:f.products,"items-length":f.totalItems,loading:f.loading,"items-per-page":f.itemsPerPage,page:f.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:page":P[4]||(P[4]=n=>f.$emit("update:page",n)),"onUpdate:itemsPerPage":P[5]||(P[5]=n=>f.$emit("update:items-per-page",n)),"onUpdate:sortBy":P[6]||(P[6]=n=>f.$emit("update:sort-by",n))},{loading:t(()=>[e(nl,{type:"table-row@10"})]),"no-data":t(()=>[l("div",Fs,[e(D,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),P[10]||(P[10]=l("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),P[11]||(P[11]=l("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(K,{"prepend-icon":"tabler-plus",color:"coffee",onClick:P[2]||(P[2]=n=>f.$emit("add-product"))},{default:t(()=>P[9]||(P[9]=[_(" Tambah Produk Pertama ")])),_:1,__:[9]})])]),"item.name":t(({item:n})=>[l("div",Rs,[e(Se,{image:n.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[n.image_url?Y("",!0):(w(),N(D,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),l("div",null,[l("div",Ks,d(n.name),1),l("div",qs," SKU: "+d(n.sku||"-"),1)])])]),"item.category":t(({item:n})=>[e(pe,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var x;return[_(d(((x=n.category)==null?void 0:x.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:n})=>[l("div",Ls,[l("div",Os,d(X(n.price)),1),l("div",Ns,[l("span",null,"HPP: "+d(X(E(n))),1),I.value[n.id_product||n.id]&&E(n)>0?(w(),N(Pt,{key:0,indeterminate:"",size:"12",width:"2"})):Y("",!0)])])]),"item.profit_margin":t(({item:n})=>[l("div",js,[e(pe,{color:U(ce(n)),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[_(d(ce(n))+"% ",1)]),_:2},1032,["color"])])]),"item.stock":t(({item:n})=>[l("div",Ws,[e(pe,{color:n.stock_status==="out_of_stock"?"error":n.stock_status==="low_stock"?"warning":"success",size:"small",variant:"tonal"},{default:t(()=>[_(d(n.stock_status==="out_of_stock"?"Habis":n.stock_status==="low_stock"?"Rendah":"Aman"),1)]),_:2},1032,["color"]),n.min_stock?(w(),se("div",Gs," Min: "+d(n.min_stock),1)):Y("",!0)])]),"item.active":t(({item:n})=>[l("div",Xs,[e(pe,{color:n.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[_(d(n.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),n.featured?(w(),N(Ee,{key:0,text:"Produk Unggulan"},{activator:t(({props:x})=>[e(D,ye(x,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):Y("",!0)])]),"item.created_at":t(({item:n})=>[l("div",Js,d(r(n.created_at??"")),1),l("div",Ys,d(v((n==null?void 0:n.created_at)??"")),1)]),"item.actions":t(({item:n})=>[l("div",Qs,[e(Ee,{text:"Kelola Komposisi"},{activator:t(({props:x})=>[e(K,ye(x,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:B=>f.$emit("open-composition-dialog",n)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Kelola Variant"},{activator:t(({props:x})=>[e(K,ye(x,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:B=>f.$emit("open-variant-dialog",n)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Edit Produk"},{activator:t(({props:x})=>[e(K,ye(x,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:B=>f.$emit("edit-product",n)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:n.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:x})=>{var B;return[e(K,ye(x,{icon:n.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:n.active?"success":"error",loading:((B=f.toggleLoading)==null?void 0:B[n.id_product])||!1,onClick:ae=>f.$emit("toggle-active",n)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Ee,{text:n.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:x})=>[e(K,ye(x,{icon:n.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:n.featured?"warning":"default",onClick:B=>f.$emit("toggle-featured",n)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Ee,{text:"Hapus Produk"},{activator:t(({props:x})=>[e(K,ye(x,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:B=>f.$emit("delete-product",n)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),an=We(tn,[["__scopeId","data-v-0c7f2165"]]),ln={class:"d-flex align-center gap-3"},on={class:"text-h5 font-weight-bold"},sn={class:"text-h6"},nn={class:"text-body-1"},rn={class:"d-flex flex-column"},un={class:"font-weight-medium"},dn={class:"text-caption text-grey-darken-1"},cn={class:"font-weight-medium"},mn={key:0,class:"text-caption"},vn={key:1,class:"text-grey-lighten-1 text-caption"},fn={class:"v-data-table__footer"},pn={class:"pa-4 d-flex justify-space-between align-center"},gn={class:"text-subtitle-1 font-weight-bold"},_n={class:"text-subtitle-2 text-uppercase"},kn={class:"text-h6 font-weight-bold my-2"},yn={class:"text-caption"},na=qe({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup(s,{emit:R}){const g=s,m=R,z=M(!1),p=M(null),I=M(null),S=M(!1),c=M(!1),k=M("latest"),ee=M(0),h=M(0),O=M(""),te=M(0),J=M(!1),E=M(!1),ce=M(""),ve=M(""),W=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],X=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],r=G=>!G||G===0?"":new Intl.NumberFormat("id-ID").format(G),v=G=>{if(!G)return 0;const A=G.replace(/[^\d]/g,"");return parseInt(A)||0},U=G=>{var y;const A=v(G);if(h.value=A,O.value=r(A),(y=p.value)!=null&&y.total_hpp&&A>0){const o=p.value.total_hpp;ee.value=o>0?Math.round((A-o)/o*100):0}else ee.value=0},f=G=>Ae(G),P=async(G,A)=>{z.value=!0;try{await new Promise(y=>setTimeout(y,500)),p.value={total_hpp:15e4,method:A,calculated_at:new Date().toISOString(),items:[{item_name:"Tepung Terigu",item_code:"TPNG001",quantity_needed:.5,unit:"kg",cost_per_unit:15e3,total_cost:7500,is_critical:!1,notes:null},{item_name:"Gula Pasir",item_code:"GUL001",quantity_needed:.25,unit:"kg",cost_per_unit:12e3,total_cost:3e3,is_critical:!1,notes:null},{item_name:"Telur Ayam",item_code:"TLR001",quantity_needed:3,unit:"pcs",cost_per_unit:3e3,total_cost:9e3,is_critical:!0,notes:"Price volatile"}]},S.value=!0}catch(y){console.error("Error loading HPP breakdown:",y),S.value=!1}finally{z.value=!1}},n=async(G,A)=>{z.value=!0;try{if(await new Promise(y=>setTimeout(y,1e3)),p.value){switch(A){case"latest":p.value.total_hpp=Math.round(p.value.total_hpp*1.1);break;case"average":p.value.total_hpp=Math.round(p.value.total_hpp*1.05);break;default:p.value.total_hpp=Math.round(p.value.total_hpp*1.03)}p.value.calculated_at=new Date().toISOString()}}catch(y){throw y}finally{z.value=!1}},x=async(G,A,y,o,i)=>{z.value=!0;try{return await new Promise(T=>setTimeout(T,1e3)),{data:{new_price:y,markup_percentage:p.value?Math.round((y-p.value.total_hpp)/p.value.total_hpp*100):0}}}catch(T){throw T}finally{z.value=!1}},B=async()=>{var G,A,y;if(g.variantId)try{const o=localStorage.getItem("token"),i=await Oe.get(`/api/variants/${g.variantId}`,{headers:{Authorization:`Bearer ${o}`,Accept:"application/json"}});if(i.data.success&&i.data.data){const T=i.data.data;if(T.price&&T.price>0)h.value=Number(T.price),O.value=r(Number(T.price));else if((G=p.value)!=null&&G.total_hpp){const _e=Math.round(p.value.total_hpp*1.2);h.value=_e,O.value=r(_e)}if((A=p.value)!=null&&A.total_hpp&&h.value>0){const _e=p.value.total_hpp;ee.value=_e>0?Math.round((h.value-_e)/_e*100):0}te.value+=1}}catch(o){console.warn("Could not load target price, using default:",o),(y=p.value)!=null&&y.total_hpp&&(h.value=Math.round(p.value.total_hpp*1.2))}},ae=async()=>{g.variantId&&(await P(g.variantId,k.value),await B())},ge=async()=>{var G,A;if(g.variantId)try{await n(g.variantId,k.value),ce.value=`HPP successfully updated using ${k.value} method!`,J.value=!0,m("hpp-updated"),await ae()}catch(y){console.error("Error updating HPP:",y),ve.value=((A=(G=y==null?void 0:y.response)==null?void 0:G.data)==null?void 0:A.message)||"Failed to update HPP",E.value=!0}},me=async()=>{var G,A,y,o,i,T,_e,Q,ke,Te;if(g.variantId&&((G=p.value)!=null&&G.total_hpp)&&h.value)try{const ie=await x(g.variantId,k.value,h.value,!0,!0);if((A=ie==null?void 0:ie.data)!=null&&A.new_price){if(h.value=ie.data.new_price,O.value=r(ie.data.new_price),((y=ie==null?void 0:ie.data)==null?void 0:y.markup_percentage)!==void 0)ee.value=ie.data.markup_percentage;else{const Me=p.value.total_hpp;ee.value=Me>0?Math.round((ie.data.new_price-Me)/Me*100):0}te.value+=1,await ht()}g.variantId&&await P(g.variantId,k.value),ce.value=`Price successfully updated to ${f(((o=ie==null?void 0:ie.data)==null?void 0:o.new_price)||h.value)}!`,J.value=!0,m("price-updated",{variantId:g.variantId,oldPrice:(i=ie==null?void 0:ie.data)==null?void 0:i.old_price,newPrice:(T=ie==null?void 0:ie.data)==null?void 0:T.new_price,hpp:(_e=ie==null?void 0:ie.data)==null?void 0:_e.hpp,markupPercentage:(Q=ie==null?void 0:ie.data)==null?void 0:Q.markup_percentage}),console.log("âœ… Price update successful - dialog remains open for user confirmation")}catch(ie){console.error("Error applying price suggestion:",ie),ve.value=((Te=(ke=ie==null?void 0:ie.response)==null?void 0:ke.data)==null?void 0:Te.message)||"Failed to update variant price",E.value=!0}};return we(()=>g.modelValue,G=>{G&&g.variantId&&ae()}),we(()=>g.variantId,G=>{G&&g.modelValue&&ae()}),we(k,async()=>{g.variantId&&await ae()}),we([()=>{var G;return(G=p.value)==null?void 0:G.total_hpp},h],()=>{var G;if((G=p.value)!=null&&G.total_hpp&&h.value>0){const A=p.value.total_hpp;ee.value=A>0?Math.round((h.value-A)/A*100):0}else ee.value=0}),we(h,G=>{G!==v(O.value)&&(O.value=r(G))}),(G,A)=>(w(),se($e,null,[e(Ne,{"model-value":G.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":A[6]||(A[6]=y=>G.$emit("update:modelValue",y))},{default:t(()=>[e(ne,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[l("div",ln,[e(D,{icon:"mdi-calculator-variant",size:"24"}),l("span",null,"HPP Breakdown - "+d(G.variantName||"Variant"),1)]),e(K,{icon:"mdi-close",size:"small",variant:"text",onClick:A[0]||(A[0]=y=>G.$emit("update:modelValue",!1))})]),_:1}),e(ue,null,{default:t(()=>[e(Ce,{class:"mb-4"},{default:t(()=>[e(H,{cols:"12",md:"6"},{default:t(()=>[e(Fe,{modelValue:k.value,"onUpdate:modelValue":[A[1]||(A[1]=y=>k.value=y),ae],items:W,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"6"},{default:t(()=>[e(K,{color:"primary",variant:"elevated",loading:z.value,"prepend-icon":"mdi-update",block:"",onClick:ge},{default:t(()=>[_(" Update HPP with "+d(k.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),S.value?(w(),N(ne,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(ue,null,{default:t(()=>[e(Ce,{align:"center"},{default:t(()=>[e(H,{cols:"12",md:"4"},{default:t(()=>{var y;return[A[11]||(A[11]=l("div",{class:"text-subtitle-2"}," Total HPP ",-1)),l("div",on,d(f(((y=p.value)==null?void 0:y.total_hpp)||0)),1)]}),_:1,__:[11]}),e(H,{cols:"12",md:"4"},{default:t(()=>{var y;return[A[12]||(A[12]=l("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),l("div",sn,d((y=W.find(o=>{var i;return o.value===((i=p.value)==null?void 0:i.method)}))==null?void 0:y.title),1)]}),_:1,__:[12]}),e(H,{cols:"12",md:"4"},{default:t(()=>{var y;return[A[13]||(A[13]=l("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),l("div",nn,d((y=p.value)!=null&&y.calculated_at?new Date(p.value.calculated_at).toLocaleString():"-"),1)]}),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):Y("",!0),S.value?(w(),N(ne,{key:1},{default:t(()=>{var y;return[e(Ve,null,{default:t(()=>{var o,i;return[e(D,{icon:"mdi-format-list-bulleted",class:"me-2"}),_(" Item Breakdown ("+d(((i=(o=p.value)==null?void 0:o.items)==null?void 0:i.length)||0)+" items) ",1)]}),_:1}),e(il,{headers:X,items:((y=p.value)==null?void 0:y.items)||[],"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:o})=>[l("div",rn,[l("span",un,d(o.item_name),1),l("span",dn,d(o.item_code),1)])]),"item.quantity_needed":t(({item:o})=>[l("span",cn,d(o.quantity_needed)+" "+d(o.unit),1)]),"item.cost_per_unit":t(({item:o})=>[l("span",null,d(f(o.cost_per_unit)),1)]),"item.total_cost":t(({item:o})=>[e(pe,{color:o.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[_(d(f(o.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:o})=>[e(pe,{color:o.is_critical?"error":"success","prepend-icon":o.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[_(d(o.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:o})=>[o.notes?(w(),se("span",mn,d(o.notes),1)):(w(),se("span",vn,"â€”"))]),bottom:t(()=>{var o;return[l("div",fn,[e(ze),l("div",pn,[l("div",gn," Total HPP: "+d(f(((o=p.value)==null?void 0:o.total_hpp)||0)),1),e(pe,{color:"info",variant:"elevated"},{default:t(()=>{var i,T;return[_(d(((T=(i=p.value)==null?void 0:i.items)==null?void 0:T.length)||0)+" items ",1)]}),_:1})])])]}),_:1},8,["items"])]}),_:1})):Y("",!0),S.value?(w(),N(ne,{key:2,class:"mt-4"},{default:t(()=>[e(Ve,null,{default:t(()=>[e(D,{icon:"mdi-cash-multiple",class:"me-2"}),A[14]||(A[14]=_(" Price Suggestion "))]),_:1,__:[14]}),e(ue,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(H,{cols:"12",md:"6"},{default:t(()=>{var y;return[(w(),N(xe,{key:te.value,modelValue:O.value,"onUpdate:modelValue":[A[2]||(A[2]=o=>O.value=o),U],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${f(((y=p.value)==null?void 0:y.total_hpp)||0)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1}),e(H,{cols:"12",md:"6"},{default:t(()=>{var y;return[(w(),N(xe,{key:te.value,modelValue:ee.value,"onUpdate:modelValue":A[3]||(A[3]=o=>ee.value=o),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${f(h.value-(((y=p.value)==null?void 0:y.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e(Ce,{class:"mt-2"},{default:t(()=>[e(H,{cols:"12",md:"12"},{default:t(()=>[e(K,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:z.value,disabled:!h.value||h.value<=0,block:"",onClick:me},{default:t(()=>A[15]||(A[15]=[_(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):Y("",!0),c.value?(w(),N(ne,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(Ve,null,{default:t(()=>[e(D,{icon:"mdi-lightbulb",class:"me-2"}),A[16]||(A[16]=_(" Price Suggestions "))]),_:1,__:[16]}),e(ue,null,{default:t(()=>[e(Ce,null,{default:t(()=>[(w(!0),se($e,null,Je(I.value.suggestions,(y,o)=>(w(),N(H,{key:o,cols:"12",md:"4"},{default:t(()=>[e(ne,{variant:"elevated"},{default:t(()=>[e(ue,{class:"text-center"},{default:t(()=>[l("div",_n,d(o)+" Method ",1),l("div",kn,d(f(y.suggested_price)),1),l("div",yn,[_(" HPP: "+d(f(y.hpp)),1),A[17]||(A[17]=l("br",null,null,-1)),_(" Markup: "+d(y.markup_percentage.toFixed(1))+"%",1),A[18]||(A[18]=l("br",null,null,-1)),_(" Margin: "+d(y.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):Y("",!0),!S.value&&!z.value?(w(),N(ne,{key:4,variant:"outlined"},{default:t(()=>[e(ue,{class:"text-center py-8"},{default:t(()=>[e(D,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),A[20]||(A[20]=l("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),A[21]||(A[21]=l("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(K,{color:"primary","prepend-icon":"mdi-plus",onClick:A[4]||(A[4]=y=>G.$emit("update:modelValue",!1))},{default:t(()=>A[19]||(A[19]=[_(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):Y("",!0)]),_:1}),e(Ke,{class:"pa-4"},{default:t(()=>[e(je),e(K,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:A[5]||(A[5]=y=>G.$emit("update:modelValue",!1))},{default:t(()=>A[22]||(A[22]=[_(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(ut,{modelValue:J.value,"onUpdate:modelValue":A[8]||(A[8]=y=>J.value=y),color:"success",location:"top"},{actions:t(()=>[e(K,{color:"white",variant:"text",onClick:A[7]||(A[7]=y=>J.value=!1)},{default:t(()=>A[23]||(A[23]=[_(" Close ")])),_:1,__:[23]})]),default:t(()=>[_(d(ce.value)+" ",1)]),_:1},8,["modelValue"]),e(ut,{modelValue:E.value,"onUpdate:modelValue":A[10]||(A[10]=y=>E.value=y),color:"error",location:"top"},{actions:t(()=>[e(K,{color:"white",variant:"text",onClick:A[9]||(A[9]=y=>E.value=!1)},{default:t(()=>A[24]||(A[24]=[_(" Close ")])),_:1,__:[24]})]),default:t(()=>[_(d(ve.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),bn={class:"d-flex align-center gap-2"},hn={class:"pa-4",style:{"background-color":"#2A2A2A"}},xn={key:0,class:"d-flex align-center gap-3"},wn={class:"text-h6 text-white font-weight-bold"},Pn={class:"d-flex align-center gap-4 mt-1"},Vn={class:"text-caption text-grey-lighten-1"},Cn={class:"text-caption text-grey-lighten-1"},Sn={class:"pa-4 add-item-form"},In={class:"d-flex align-center justify-space-between mb-4"},$n={class:"d-flex align-center gap-2"},Dn={class:"text-h6"},Tn={key:0,class:"text-error"},Un={key:1},zn={class:"d-flex align-center"},An={class:"pa-4 text-center"},Hn={class:"pa-4 pt-0"},Mn={class:"d-flex align-center justify-between mb-4"},En={class:"text-h6"},Bn={key:0,class:"composition-list"},Fn={class:"d-flex align-center justify-between"},Rn={class:"d-flex align-center gap-3"},Kn={class:"font-weight-medium"},qn={class:"text-caption text-medium-emphasis"},Ln={class:"font-weight-medium text-primary"},On={class:"d-flex align-center gap-2"},Nn={class:"text-center"},jn={key:0,class:"text-body-2 text-medium-emphasis"},Wn={class:"text-center"},Gn={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},Xn=qe({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup(s,{emit:R}){const g=s,m=R,z=M(),p=M(!1),I=M(!1),S=M([]),c=M([]),k=M(!1),ee=M(null),h=M(!1),O=M(null),te=M(!1),J=M(!1),E=M(""),ce=M(""),ve=M("success"),W=M(!1),X=de({get:()=>(console.log("ðŸ”µ [DEBUG] Dialog getter called, props.modelValue:",g.modelValue),g.modelValue),set:u=>{console.log("ðŸ”µ [DEBUG] Dialog setter called with value:",u),m("update:modelValue",u)}}),r=()=>({item_id:null,quantity:1,is_critical:!1}),v=M(r()),U=de(()=>!v.value.item_id||!Array.isArray(S.value)?null:S.value.find(u=>u.id_item===v.value.item_id)),f=de(()=>!U.value||k.value&&ee.value!==null?null:c.value.find(u=>{var a,b;return u.name===((a=U.value)==null?void 0:a.name)||u.id&&((b=U.value)==null?void 0:b.id_item)&&u.id===U.value.id_item})),P=de(()=>{if(!U.value)return"";if(k.value&&ee.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(f.value){const u=f.value;return`Item sudah ada dengan quantity ${u.quantity} ${u.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${x(U.value)} ${U.value.unit}`}),n=de(()=>Array.isArray(S.value)?S.value.filter(u=>x(u)>0):[]),x=u=>{var a,b;return((a=u.inventory)==null?void 0:a.current_stock)||((b=u.inventory)==null?void 0:b.available_stock)||u.current_stock||0},B=()=>I.value?"Memuat items...":!S.value||S.value.length===0?"Tidak ada item tersedia":n.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",ae=u=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(u),ge=u=>{switch(u){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},me=u=>{switch(u){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},G=(u,a,b)=>{var C,re,fe,he,Pe,De,He,Le;if(!a)return!0;const F=a.toLowerCase().trim(),q=((re=(C=b==null?void 0:b.raw)==null?void 0:C.name)==null?void 0:re.toLowerCase())||"",$=((he=(fe=b==null?void 0:b.raw)==null?void 0:fe.item_code)==null?void 0:he.toLowerCase())||"",V=((De=(Pe=b==null?void 0:b.raw)==null?void 0:Pe.unit)==null?void 0:De.toLowerCase())||"",j=((Le=(He=b==null?void 0:b.raw)==null?void 0:He.description)==null?void 0:Le.toLowerCase())||"";return q.includes(F)||$.includes(F)||V.includes(F)||j.includes(F)},A=async()=>{var u,a,b;I.value=!0,console.log("Loading available items...");try{const F=await Oe.get("/api/items?per_page=all&include=inventory");console.log("Items API response:",F.data);const q=((a=(u=F.data)==null?void 0:u.data)==null?void 0:a.data)||((b=F.data)==null?void 0:b.data)||F.data||[];S.value=Array.isArray(q)?q:[],console.log("Available items loaded:",S.value.length,"items"),console.log("Sample items with inventory:",S.value.slice(0,3))}catch(F){console.error("Error loading items:",F),F!=null&&F.response&&(console.error("API Error Status:",F.response.status),console.error("API Error Data:",F.response.data)),S.value=[]}finally{I.value=!1}},y=async()=>{var u,a,b,F,q;if(!(!((u=g.variant)!=null&&u.id)&&!((a=g.variant)!=null&&a.id_variant)))try{const $=g.variant.id||g.variant.id_variant;console.log("Loading composition items for variant:",$);const V=await Oe.get(`/api/variant-items/variant/${$}`);console.log("Composition API response:",V.data);const j=((F=(b=V.data)==null?void 0:b.data)==null?void 0:F.composition)||((q=V.data)==null?void 0:q.composition)||[];if(!Array.isArray(j)){console.warn("API response composition is not an array:",j),c.value=[];return}c.value=j.map(C=>{var re,fe,he,Pe,De,He,Le,tt,at,lt;return{id:C.id_variant_item||C.id,name:((re=C.item)==null?void 0:re.name)||C.name,quantity:parseFloat(C.quantity_needed||C.quantity||C.qty||"1"),unit:C.unit||((fe=C.item)==null?void 0:fe.unit)||"pcs",stock:((Pe=(he=C.item)==null?void 0:he.inventory)==null?void 0:Pe.current_stock)||((He=(De=C.item)==null?void 0:De.inventory)==null?void 0:He.available_stock)||((Le=C.item)==null?void 0:Le.current_stock)||C.stock||0,price:parseFloat(((tt=C.item)==null?void 0:tt.cost_per_unit)||((at=C.item)==null?void 0:at.price)||C.price||"0"),is_critical:C.is_critical||!1,inventory:(lt=C.item)!=null&&lt.inventory?{current_stock:C.item.inventory.current_stock||0,available_stock:C.item.inventory.available_stock||0,stock_status:C.item.inventory.stock_status||"unknown",reorder_level:C.item.inventory.reorder_level||0}:null}}),console.log("Composition items loaded:",c.value)}catch($){console.error("Error loading composition items:",$),$!=null&&$.response&&(console.error("API Error Status:",$.response.status),console.error("API Error Data:",$.response.data)),c.value=[]}},o=async()=>{var q,$;const{valid:u}=await z.value.validate();if(!u||!U.value)return;const a=U.value.name,b=U.value.id_item,F=v.value.quantity;if(console.log("ðŸ” Handle save - Mode:",k.value?"EDIT":"ADD"),console.log("ðŸ” Item:",a,"ID:",b),console.log("ðŸ” Quantity:",F),k.value&&ee.value!==null){console.log("âœï¸ Edit mode: Updating existing item at index",ee.value);const j=c.value[ee.value].quantity;console.log(`ðŸ“ Updating item "${a}":`),console.log(`   - Old quantity: ${j}`),console.log(`   - New quantity: ${F}`),c.value[ee.value].quantity=F,c.value[ee.value].is_critical=v.value.is_critical,console.log("âœ… Item updated successfully in edit mode"),k.value=!1,ee.value=null}else{console.log("âž• Add mode: Checking for existing item");const V=c.value.findIndex(j=>j.name===a||j.id&&b&&j.id===b);if(V!==-1){const C=c.value[V].quantity,re=C+F;console.log("ðŸ“¦ Item already exists! Accumulating quantity:"),console.log(`   - Item: ${a}`),console.log(`   - Old quantity: ${C}`),console.log(`   - Adding: ${F}`),console.log(`   - New quantity: ${re}`),c.value[V].quantity=re}else{console.log("âž• Adding new item to composition:",a);const j={name:a,quantity:F,unit:U.value.unit,stock:((q=U.value.inventory)==null?void 0:q.current_stock)||(($=U.value.inventory)==null?void 0:$.available_stock)||U.value.current_stock||0,price:U.value.cost_per_unit||0,is_critical:v.value.is_critical,inventory:U.value.inventory?{current_stock:U.value.inventory.current_stock||0,available_stock:U.value.inventory.available_stock||0,stock_status:U.value.inventory.stock_status||"unknown",reorder_level:U.value.inventory.reorder_level||0}:null};c.value.push(j),console.log("âœ… New item added successfully")}}v.value=r(),console.log("ðŸ”„ Form reset")},i=(u,a)=>{console.log("ðŸ” Edit item called:",u,a);const b=S.value.find(F=>F.name===u.name||F.id_item===u.id);b?(console.log("âœ… Found item in available items:",b),k.value=!0,ee.value=a,v.value={item_id:b.id_item,quantity:u.quantity,is_critical:u.is_critical||!1},console.log("ðŸ“ Edit mode activated!"),console.log("ðŸ“ Form data set:",v.value),console.log("ðŸ“ Editing item at index:",a),setTimeout(()=>{const F=document.querySelector(".add-item-form");F&&F.scrollIntoView({behavior:"smooth",block:"start"})},100)):(console.error("âŒ Could not find item in available items"),console.log("Available items:",S.value.map(F=>({id:F.id_item,name:F.name}))),console.log("Looking for item:",{id:u.id,name:u.name}))},T=()=>{console.log("âŒ Edit mode cancelled"),k.value=!1,ee.value=null,v.value=r()},_e=(u,a)=>{O.value={item:u,index:a},h.value=!0},Q=async()=>{var q,$,V;if(!O.value)return;const{item:u,index:a}=O.value,b=u.name,F=u.id;te.value=!0,console.log("ðŸš€ Starting delete process for:",b,"ID:",F,"Index:",a);try{F?(console.log("ðŸ—‘ï¸ Deleting item from database:",b,"with ID:",F),await Oe.delete(`/api/variant-items/${F}`),console.log("âœ… Item deleted from database successfully")):console.log("ðŸ“ Item has no ID, removing from local list only"),h.value=!1,O.value=null,console.log("âœ… Delete dialog closed"),console.log("ðŸ”„ Force refreshing composition list..."),await y(),console.log("âœ… Composition list refreshed from server. New count:",c.value.length),console.log("ðŸ“¡ Emitting save event to parent component..."),m("save"),console.log("âœ… Save event emitted to parent component"),console.log("ðŸŽ‰ Item successfully deleted:",b)}catch(j){console.error("âŒ Error deleting item:",j),console.error("âŒ Error details:",(q=j.response)==null?void 0:q.data),alert("Gagal menghapus item: "+(((V=($=j.response)==null?void 0:$.data)==null?void 0:V.message)||j.message))}finally{te.value=!1,console.log("ðŸ Delete process completed")}},ke=()=>{h.value=!1,O.value=null},Te=()=>{switch(ve.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},ie=()=>{switch(ve.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Me=()=>{switch(ve.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},Ie=()=>{switch(ve.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Ze=async()=>{var u,a,b,F;if(!((u=g.variant)!=null&&u.id)&&!((a=g.variant)!=null&&a.id_variant)){console.error("No variant ID found");return}p.value=!0;try{const q=g.variant.id||g.variant.id_variant;console.log("ðŸ” [DEBUG] Composition items count:",c.value.length),console.log("ðŸ” [DEBUG] Raw composition items:",JSON.stringify(c.value,null,2));const $=c.value.some(V=>V.id);if(console.log("ðŸ” [DEBUG] Has existing items:",$),$){console.log("ï¿½ [EDIT MODE] Updating existing composition");const V={items:c.value.map(C=>{const re=S.value.find(fe=>fe.name===C.name);return console.log(`Mapping item "${C.name}":`),console.log("  - Found item:",re==null?void 0:re.id_item),console.log("  - Original ID (id_variant_item):",C.id),console.log("  - Quantity:",C.quantity),console.log("  - Unit:",C.unit),console.log("  - Is critical:",C.is_critical),{id_variant_item:C.id,quantity_needed:Number(C.quantity),unit:C.unit,is_critical:C.is_critical||!1}}).filter(C=>C.id_variant_item&&C.quantity_needed>0)};console.log("Edit payload:",JSON.stringify(V,null,2));const j=await Oe.post("/api/variant-items/bulk-update",V);console.log("Composition updated successfully:",j.data)}else{console.log("âœ¨ [CREATE MODE] Creating new composition");const V={id_variant:q,items:c.value.map(C=>{const re=S.value.find(fe=>fe.name===C.name);return console.log(`Mapping item "${C.name}":`),console.log("  - Found item:",re==null?void 0:re.id_item),console.log("  - Quantity:",C.quantity),console.log("  - Unit:",C.unit),console.log("  - Is critical:",C.is_critical),{id_item:re==null?void 0:re.id_item,quantity_needed:Number(C.quantity),unit:C.unit,is_critical:C.is_critical||!1}}).filter(C=>C.id_item&&C.quantity_needed>0)};console.log("Create payload:",JSON.stringify(V,null,2));const j=await Oe.post("/api/variant-items/bulk-store",V);console.log("Composition created successfully:",j.data)}m("save"),Re()}catch(q){console.error("Error saving composition:",q),alert("Gagal menyimpan komposisi: "+(((F=(b=q.response)==null?void 0:b.data)==null?void 0:F.message)||q.message))}finally{p.value=!1}},et=()=>{W.value=!0},Re=()=>{X.value=!1,v.value=r(),c.value=[],k.value=!1,ee.value=null};return we(()=>g.modelValue,u=>{u?(v.value=r(),A(),y()):(k.value=!1,ee.value=null)}),we(()=>v.value.item_id,u=>{u&&U.value&&console.log("Item selected:",U.value.name,"Unit:",U.value.unit)}),dt(()=>{A()}),(u,a)=>{var b,F,q;return w(),se($e,null,[e(Ne,{modelValue:X.value,"onUpdate:modelValue":a[3]||(a[3]=$=>X.value=$),"max-width":"1000px",persistent:""},{default:t(()=>[e(ne,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[l("div",bn,[e(D,{icon:"mdi-delete",color:"white"}),a[9]||(a[9]=l("span",null,"Kelola Komposisi Item",-1))]),e(K,{icon:"mdi-close",variant:"text",color:"white",onClick:Re,disabled:p.value},null,8,["disabled"])]),_:1}),e(ue,{class:"pa-0"},{default:t(()=>[l("div",hn,[u.variant?(w(),se("div",xn,[e(D,{icon:"mdi-coffee",size:"32",color:"white"}),l("div",null,[l("h3",wn,d(u.variant.name),1),l("div",Pn,[l("span",Vn,"SKU: "+d(u.variant.sku),1),l("span",Cn,"Harga: "+d(ae(u.variant.price||0)),1),e(pe,{color:"success",size:"small",variant:"tonal"},{default:t(()=>a[10]||(a[10]=[_(" Stok Aman ")])),_:1,__:[10]})])])])):Y("",!0)]),l("div",Sn,[l("div",In,[l("div",$n,[e(D,{icon:"mdi-plus-circle",color:"success"}),l("h4",Dn,d(k.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(At,{ref_key:"form",ref:z,onSubmit:Ut(o,["prevent"])},{default:t(()=>[e(Ce,null,{default:t(()=>[e(H,{cols:"12",md:"4"},{default:t(()=>[e(zt,{modelValue:v.value.item_id,"onUpdate:modelValue":a[0]||(a[0]=$=>v.value.item_id=$),items:n.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[$=>!!$||"Item wajib dipilih"],loading:I.value,disabled:I.value||S.value&&S.value.length===0,"no-data-text":B(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":G},{"prepend-inner":t(()=>[e(D,{icon:"mdi-package",size:"16"})]),item:t(({props:$,item:V})=>[e(Qe,ye($,{title:V.raw.name,disabled:x(V.raw)<=0,class:["pa-3",{"text-disabled":x(V.raw)<=0}]}),{prepend:t(()=>[e(D,{icon:"mdi-package-variant",color:x(V.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[l("div",{class:Ye(["text-caption",x(V.raw)<=0?"text-disabled":"text-medium-emphasis"])},[x(V.raw)<=0?(w(),se("span",Tn,[e(D,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),a[11]||(a[11]=_(" Stok Habis "))])):(w(),se("span",Un," Stok: "+d(x(V.raw))+" "+d(V.raw.unit),1))],2)]),append:t(()=>{var j;return[x(V.raw)>0?(w(),N(pe,{key:0,size:"x-small",color:ge(((j=V.raw.inventory)==null?void 0:j.stock_status)||V.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var C;return[_(d(me(((C=V.raw.inventory)==null?void 0:C.stock_status)||V.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(w(),N(pe,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>a[12]||(a[12]=[_(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:$})=>[l("div",zn,[e(D,{icon:"mdi-package-variant",size:"16",class:"me-2"}),l("span",null,d($.raw.name),1)])]),"no-data":t(()=>[l("div",An,[e(D,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),a[13]||(a[13]=l("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),a[14]||(a[14]=l("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>[e(xe,{modelValue:v.value.quantity,"onUpdate:modelValue":a[1]||(a[1]=$=>v.value.quantity=$),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[$=>!!$||"Jumlah wajib diisi",$=>$>0||"Jumlah harus lebih dari 0"],hint:P.value,"persistent-hint":"",color:f.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e(H,{cols:"12",md:"2"},{default:t(()=>{var $;return[e(xe,{"model-value":(($=U.value)==null?void 0:$.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!U.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e(D,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e(H,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(gt,{modelValue:v.value.is_critical,"onUpdate:modelValue":a[2]||(a[2]=$=>v.value.is_critical=$),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(K,{color:k.value?"primary":f.value?"warning":"#D4A574",onClick:o,loading:p.value,disabled:!v.value.item_id||!v.value.quantity,block:""},{default:t(()=>[e(D,{icon:k.value?"mdi-content-save":f.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),_(" "+d(k.value?"Update":f.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),k.value?(w(),N(K,{key:0,color:"grey",variant:"outlined",onClick:T,size:"small",block:""},{default:t(()=>[e(D,{icon:"mdi-close",class:"me-1"}),a[15]||(a[15]=_(" Batal "))]),_:1,__:[15]})):Y("",!0)]),_:1})]),_:1})]),_:1},512)]),l("div",Hn,[l("div",Mn,[l("h4",En,"Daftar Item Komposisi ("+d(c.value.length)+")",1)]),c.value.length>0?(w(),se("div",Bn,[(w(!0),se($e,null,Je(c.value,($,V)=>(w(),N(ne,{key:V,variant:"outlined",class:"mb-3"},{default:t(()=>[e(ue,{class:"pa-3"},{default:t(()=>{var j,C,re,fe,he,Pe,De;return[l("div",Fn,[l("div",Rn,[e(D,{icon:"mdi-check-circle",color:"success"}),l("div",null,[l("div",Kn,d($.name),1),l("div",qn,[l("span",Ln,"Dibutuhkan: "+d($.quantity)+" "+d($.unit),1),a[16]||(a[16]=_(" â€¢ ")),l("span",{class:Ye({"text-success":(((j=$.inventory)==null?void 0:j.current_stock)??0)>(((C=$.inventory)==null?void 0:C.reorder_level)??0),"text-warning":(((re=$.inventory)==null?void 0:re.current_stock)??0)<=(((fe=$.inventory)==null?void 0:fe.reorder_level)??0)&&(((he=$.inventory)==null?void 0:he.current_stock)??0)>0,"text-error":(((Pe=$.inventory)==null?void 0:Pe.current_stock)??0)<=0})}," Stok: "+d(((De=$.inventory)==null?void 0:De.current_stock)||$.stock||0)+" "+d($.unit),3),_(" â€¢ "+d(ae($.price)),1)])])]),l("div",On,[e(K,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:He=>i($,V)},null,8,["onClick"]),e(K,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:He=>_e($,V)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(w(),N(ne,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e(D,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),a[17]||(a[17]=l("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(Ke,{class:"px-6 pb-6"},{default:t(()=>[e(K,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:et},{default:t(()=>a[18]||(a[18]=[_(" Setting HPP ")])),_:1,__:[18]}),e(je),e(K,{variant:"outlined",onClick:Re,disabled:p.value},{default:t(()=>a[19]||(a[19]=[_(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(K,{color:"#D4A574",onClick:Ze,loading:p.value,disabled:c.value.length===0},{default:t(()=>a[20]||(a[20]=[_(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(na,{modelValue:W.value,"onUpdate:modelValue":a[4]||(a[4]=$=>W.value=$),"variant-id":((b=u.variant)==null?void 0:b.id)||((F=u.variant)==null?void 0:F.id_variant),"variant-name":(q=u.variant)==null?void 0:q.name,onHppUpdated:a[5]||(a[5]=$=>m("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Ne,{modelValue:h.value,"onUpdate:modelValue":a[6]||(a[6]=$=>h.value=$),"max-width":"400px",persistent:""},{default:t(()=>[e(ne,null,{default:t(()=>[e(Ve,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e(D,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),a[21]||(a[21]=_(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(ze),e(ue,{class:"pa-6"},{default:t(()=>[l("div",Nn,[e(D,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),a[24]||(a[24]=l("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),O.value?(w(),se("div",jn,[l("strong",null,d(O.value.item.name),1),a[22]||(a[22]=l("br",null,null,-1)),_(" Dibutuhkan: "+d(O.value.item.quantity)+" "+d(O.value.item.unit),1)])):Y("",!0),e(Be,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>a[23]||(a[23]=[l("strong",null,"Perhatian:",-1),_(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(Ke,{class:"px-6 pb-6"},{default:t(()=>[e(K,{variant:"outlined",onClick:ke,disabled:te.value,class:"flex-grow-1"},{default:t(()=>a[25]||(a[25]=[_(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(K,{color:"error",onClick:Q,loading:te.value,class:"flex-grow-1"},{default:t(()=>a[26]||(a[26]=[_(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ne,{modelValue:J.value,"onUpdate:modelValue":a[8]||(a[8]=$=>J.value=$),"max-width":"450px",persistent:""},{default:t(()=>[e(ne,null,{default:t(()=>[e(Ve,{class:Ye(["d-flex align-center justify-center text-h6",Me()])},{default:t(()=>[e(D,{icon:Te(),color:ie(),class:"me-2",size:"24"},null,8,["icon","color"]),_(" "+d(ce.value),1)]),_:1},8,["class"]),e(ze),e(ue,{class:"pa-6"},{default:t(()=>[l("div",Wn,[e(D,{icon:Te(),color:ie(),size:"64",class:"mb-4"},null,8,["icon","color"]),l("div",Gn,d(E.value),1),e(Be,{type:ve.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[ve.value==="success"?(w(),se($e,{key:0},[a[27]||(a[27]=l("strong",null,"Berhasil!",-1)),a[28]||(a[28]=_(" Perubahan telah disimpan. "))],64)):ve.value==="info"?(w(),se($e,{key:1},[a[29]||(a[29]=l("strong",null,"Informasi:",-1)),a[30]||(a[30]=_(" Item telah diperbarui sesuai permintaan. "))],64)):(w(),se($e,{key:2},[a[31]||(a[31]=l("strong",null,"Perhatian:",-1)),a[32]||(a[32]=_(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(Ke,{class:"px-6 pb-6"},{default:t(()=>[e(je),e(K,{color:Ie(),onClick:a[7]||(a[7]=$=>J.value=!1),class:"px-6"},{default:t(()=>[e(D,{icon:"mdi-check",class:"me-1"}),a[33]||(a[33]=_(" OK "))]),_:1,__:[33]},8,["color"]),e(je)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Jn=We(Xn,[["__scopeId","data-v-df449ced"]]),Yn={class:"d-flex align-center gap-2"},Qn={class:"mt-2"},Zn={key:0,class:"mt-1 font-weight-medium"},ei={key:1,class:"mt-1 text-warning"},ti=qe({__name:"CreateVariantDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save"],setup(s,{emit:R}){const g=s,m=R,z=M(),p=M(!1),I=M(!1),S=M([]),c=M({name:"",selectedProduct:null,selectedProductId:null,active:!0}),k=[r=>!!r||"Nama variant wajib diisi",r=>r.length>=3||"Nama variant minimal 3 karakter"],ee=[r=>!!r||"Produk wajib dipilih"],h=(r,v="success")=>{const U=document.createElement("div");U.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${v==="success"?"#4CAF50":"#f44336"};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 9999;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
  `;const f=document.createElement("span");if(f.innerHTML=v==="success"?"âœ“":"âœ•",f.style.cssText=`
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    font-weight: bold;
  `,U.appendChild(f),U.appendChild(document.createTextNode(r)),!document.querySelector("#snackbar-styles")){const P=document.createElement("style");P.id="snackbar-styles",P.textContent=`
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `,document.head.appendChild(P)}document.body.appendChild(U),setTimeout(()=>{U.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{U.parentNode&&U.parentNode.removeChild(U)},300)},3e3),console.log(`${v}: ${r}`)},O=async()=>{I.value=!0;try{const r=await Oe.get("/api/products");S.value=r.data.data||r.data||[],console.log("Fetched products:",S.value),console.log("First product structure:",S.value[0])}catch(r){console.error("Gagal mengambil data produk:",r),S.value=[]}finally{I.value=!1}},te=r=>{!r&&S.value.length===0&&O()},J=r=>{console.log("Product object changed:",r),c.value.selectedProduct=r,r?c.value.selectedProductId=r.id:c.value.selectedProductId=null},E=de(()=>{if(console.log("Computing selected product info..."),console.log("form.selectedProduct:",c.value.selectedProduct),console.log("form.selectedProductId:",c.value.selectedProductId),c.value.selectedProduct)return console.log("Using selectedProduct object:",c.value.selectedProduct),c.value.selectedProduct;if(c.value.selectedProductId&&S.value.length>0){console.log("Searching for product with ID:",c.value.selectedProductId),console.log("Product IDs available:",S.value.map(v=>({id:v.id,name:v.name})));const r=S.value.find(v=>v.id===c.value.selectedProductId);return console.log("Found selected product by ID:",r),r}return console.log("No product selected or no products available"),null}),ce=()=>{console.log("Generating SKU...");const r=E.value;if(console.log("Product info for SKU:",r),console.log("Form name:",c.value.name),console.log("Form selectedProductId:",c.value.selectedProductId),!r||!c.value.name)return console.log("Missing productInfo or name, returning empty SKU"),"";const v=r.sku||"PROD",U=c.value.name.replace(/\s+/g,"").toUpperCase().substring(0,3),f=Date.now().toString().slice(-4),P=`${v}-${U}-${f}`;return console.log("Generated SKU:",P),P},ve=async()=>{var U,f;if(p.value)return;const{valid:r}=await z.value.validate();if(!r)return;const v=E.value;if(console.log("Product info in saveVariant:",v),!v){h("Produk tidak ditemukan","error");return}if(!v.id&&!v.id_product){h("ID Produk tidak valid","error"),console.error("Product missing ID:",v);return}p.value=!0;try{const P={id_product:v.id||v.id_product,name:c.value.name,sku:ce(),price:0,cost_price:null,barcode:null,variant_values:[],active:c.value.active};console.log("Payload being sent:",P),console.log("Payload JSON:",JSON.stringify(P));const n=await Oe.post("/api/variants",P);if(console.log("API Response:",n.data),console.log("Response Status:",n.status),n.data.success!==!1&&(n.status===200||n.status===201))h("Variant berhasil dibuat!","success"),console.log("Created variant data:",n.data.data),m("save"),X();else throw new Error(n.data.message||"Gagal membuat variant")}catch(P){const n=((f=(U=P.response)==null?void 0:U.data)==null?void 0:f.message)||P.message||"Gagal membuat variant";h(n,"error"),console.error("Save variant error:",P)}finally{p.value=!1}},W=()=>{var r;c.value={name:"",selectedProduct:null,selectedProductId:null,active:!0},(r=z.value)==null||r.resetValidation()},X=()=>{m("update:modelValue",!1),W()};return we(()=>g.modelValue,r=>{r&&(W(),O())}),(r,v)=>(w(),N(Ne,{"model-value":r.modelValue,"onUpdate:modelValue":v[3]||(v[3]=U=>r.$emit("update:modelValue",U)),"max-width":"600px",persistent:""},{default:t(()=>[e(ne,null,{default:t(()=>[e(Ve,{class:"bg-primary text-white"},{default:t(()=>[e(D,{icon:"mdi-plus-circle",class:"me-2"}),v[4]||(v[4]=_(" Tambah Variant Baru ")),e(je),e(K,{icon:"mdi-close",variant:"text",color:"white",onClick:X})]),_:1,__:[4]}),e(At,{ref_key:"formRef",ref:z,onSubmit:Ut(ve,["prevent"])},{default:t(()=>[e(ue,{class:"pa-6"},{default:t(()=>[e(Ce,null,{default:t(()=>[e(H,{cols:"12"},{default:t(()=>[e(zt,{modelValue:c.value.selectedProduct,"onUpdate:modelValue":[v[0]||(v[0]=U=>c.value.selectedProduct=U),J],items:S.value,loading:I.value,"item-title":"name","return-object":"",label:"Pilih Produk *",placeholder:"Cari produk...",variant:"outlined",rules:ee,required:"","no-data-text":"Tidak ada produk ditemukan","onUpdate:search":te},{item:t(({props:U,item:f})=>[e(Qe,za(Aa(U)),{prepend:t(()=>[e(Se,{image:f.raw.image_url,size:"40"},{default:t(()=>[f.raw.image_url?Y("",!0):(w(),N(D,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"])]),default:t(()=>[e(ft,null,{default:t(()=>[_(d(f.raw.name),1)]),_:2},1024),e(pt,null,{default:t(()=>[_("SKU: "+d(f.raw.sku||"-"),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:U})=>[l("div",Yn,[e(Se,{image:U.raw.image_url,size:"24"},{default:t(()=>[U.raw.image_url?Y("",!0):(w(),N(D,{key:0,icon:"mdi-coffee",size:"16"}))]),_:2},1032,["image"]),l("span",null,d(U.raw.name),1)])]),_:1},8,["modelValue","items","loading"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(xe,{modelValue:c.value.name,"onUpdate:modelValue":v[1]||(v[1]=U=>c.value.name=U),label:"Nama Variant *",placeholder:"Contoh: Large Hot, Medium Cold, dll",variant:"outlined",rules:k,required:""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(Be,{color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(wt,null,{default:t(()=>[e(D,{icon:"mdi-information",class:"me-2"}),v[5]||(v[5]=_(" SKU Otomatis "))]),_:1,__:[5]}),l("div",Qn,[v[6]||(v[6]=_(" SKU variant akan dibuat otomatis berdasarkan nama produk dan variant ")),c.value.name&&(c.value.selectedProduct||c.value.selectedProductId)?(w(),se("div",Zn," Preview SKU: "+d(ce()),1)):c.value.name&&!c.value.selectedProduct&&!c.value.selectedProductId?(w(),se("div",ei," Pilih produk terlebih dahulu untuk melihat preview SKU ")):Y("",!0)])]),_:1})]),_:1}),e(H,{cols:"12"},{default:t(()=>[e(gt,{modelValue:c.value.active,"onUpdate:modelValue":v[2]||(v[2]=U=>c.value.active=U),label:"Variant Aktif",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ze),e(Ke,{class:"pa-6"},{default:t(()=>[e(je),e(K,{variant:"outlined",onClick:X,disabled:p.value},{default:t(()=>v[7]||(v[7]=[_(" Batal ")])),_:1,__:[7]},8,["disabled"]),e(K,{type:"submit",color:"primary",loading:p.value},{default:t(()=>v[8]||(v[8]=[_(" Simpan Variant ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),ai=We(ti,[["__scopeId","data-v-6f78bbf1"]]),li={class:"product-variant-tab"},oi={class:"d-flex gap-2"},si={key:0,class:"mt-4 d-flex align-center gap-2"},ni={key:1,class:"text-center pa-12"},ii={key:2,class:"text-center pa-12"},ri={class:"d-flex align-center gap-3"},ui={class:"flex-grow-1 min-width-0"},di={class:"text-h6 font-weight-bold text-truncate"},ci={class:"text-body-2 text-medium-emphasis mb-0"},mi={class:"d-flex flex-column gap-1"},vi={class:"text-xs"},fi={class:"d-flex align-center gap-2"},pi={class:"text-primary font-weight-medium"},gi={class:"d-flex gap-1"},_i={class:"d-flex align-center justify-space-between w-100"},ki={class:"d-flex gap-1"},yi=qe({__name:"ProductVariantTab",props:{loading:{type:Boolean}},emits:["refresh"],setup(s,{emit:R}){const g=R,m=M(!1),z=M([]),p=M(!1),I=M(!1),S=M(null),c=M(!1),k=M(!1),ee=M(!1),h=M({search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}),O=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],te=[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Variant Terbanyak",value:"variants_desc"},{title:"Variant Tersedikit",value:"variants_asc"}],J=de(()=>!!(h.value.search||h.value.stockStatus||h.value.activeStatus!==null||h.value.sortBy!=="name_asc")),E=de(()=>{const y={};return z.value.forEach(o=>{const i=o.id_product;y[i]||(y[i]={product:o.product||{id:o.id_product,id_product:o.id_product,name:`Product ${o.id_product}`,sku:""},variants:[]}),y[i].variants.push(o)}),Object.values(y)}),ce=de(()=>{let y=[...E.value];if(h.value.search){const o=h.value.search.toLowerCase();y=y.filter(i=>{var T;return i.product.name.toLowerCase().includes(o)||((T=i.product.sku)==null?void 0:T.toLowerCase().includes(o))||i.variants.some(_e=>_e.name.toLowerCase().includes(o)||_e.sku.toLowerCase().includes(o))})}switch(h.value.stockStatus&&(y=y.filter(o=>o.variants.some(i=>{var _e;return(((_e=i.composition_summary)==null?void 0:_e.stock_status)||"safe")===h.value.stockStatus}))),h.value.activeStatus!==null&&(y=y.filter(o=>o.variants.some(i=>i.is_active===h.value.activeStatus))),h.value.sortBy){case"name_asc":y.sort((o,i)=>o.product.name.localeCompare(i.product.name));break;case"name_desc":y.sort((o,i)=>i.product.name.localeCompare(o.product.name));break;case"variants_desc":y.sort((o,i)=>i.variants.length-o.variants.length);break;case"variants_asc":y.sort((o,i)=>o.variants.length-i.variants.length);break}return y}),ve=(y,o="success")=>{},W=async y=>{try{console.log("ðŸ”„ Updating variant price from HPP dialog:",y);const o=z.value.findIndex(i=>i.id_variant===y.variantId);o!==-1&&(z.value[o]={...z.value[o],price:y.newPrice,cost:y.hpp},console.log("âœ… Variant price updated locally without reloading")),ve(`Price updated to ${new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(y.newPrice)}`,"success")}catch(o){console.error("Error handling price update:",o),await X()}},X=async()=>{var y,o,i;m.value=!0;try{const T=await Oe.get("/api/variants",{params:{per_page:1e3,with_product:!0,with_composition:!0}});if(T.data.success===!1)throw new Error(T.data.message||"Failed to load variants");const _e=((y=T.data.data)==null?void 0:y.data)||T.data.data||[];z.value=_e.map(Q=>({...Q,is_active:Q.active!==void 0?Q.active:Q.is_active,id:Q.id_variant||Q.id,id_product:Q.id_product||Q.product_id}))}catch(T){(i=(o=T.response)==null?void 0:o.data)!=null&&i.message||T.message,z.value=[]}finally{m.value=!1}},r=y=>{S.value=y,c.value=!0},v=y=>{y&&(S.value=y,k.value=!0)},U=y=>{S.value=y,p.value=!0},f=()=>{ee.value=!0},P=async()=>{var y,o;if(S.value)try{I.value=!0,await Oe.delete(`/api/variants/${S.value.id_variant}`),ve("Variant berhasil dihapus","success"),await X(),p.value=!1}catch(i){(o=(y=i.response)==null?void 0:y.data)!=null&&o.message}finally{I.value=!1}},n=y=>{switch(y){case"critical":return"error";case"out":return"error";case"safe":return"success";default:return"primary"}},x=y=>{switch(y){case"critical":return"Kritis";case"out":return"Habis";case"safe":return"Aman";default:return"Normal"}},B=y=>{const o=y.filter(i=>i.is_active).length;return o===0?"error":o===y.length?"success":"warning"},ae=y=>y.some(o=>{var T;const i=(T=o.composition_summary)==null?void 0:T.stock_status;return i==="critical"||i==="out"}),ge=y=>{const o=y.filter(T=>T.is_active).length,i=y.filter(T=>{var Q;const _e=(Q=T.composition_summary)==null?void 0:Q.stock_status;return _e==="critical"||_e==="out"}).length;return i>0?{text:`${i} Stok Kritis`,color:"error",icon:"mdi-alert-circle"}:o===y.length?{text:"Semua Aktif",color:"success",icon:"mdi-check-circle"}:o===0?{text:"Semua Nonaktif",color:"error",icon:"mdi-close-circle"}:{text:`${o}/${y.length} Aktif`,color:"warning",icon:"mdi-minus-circle"}},me=()=>{h.value={search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}},G=()=>{X(),g("refresh")},A=()=>{console.log("Variant created, refreshing data..."),X(),g("refresh")};return dt(()=>{X()}),(y,o)=>{var i,T,_e;return w(),se("div",li,[e(ne,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(Ve,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o[14]||(o[14]=l("div",null,[l("h2",{class:"text-h5 font-weight-bold"},"Variant Produk"),l("p",{class:"text-body-2 text-medium-emphasis"}," Kelola variant dan komposisi untuk produk Anda ")],-1)),l("div",oi,[e(K,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:X,loading:m.value},{default:t(()=>o[12]||(o[12]=[_(" Refresh ")])),_:1,__:[12]},8,["loading"]),e(K,{color:"primary","prepend-icon":"mdi-plus",onClick:f},{default:t(()=>o[13]||(o[13]=[_(" Tambah Variant ")])),_:1,__:[13]})])]),_:1,__:[14]})]),_:1}),e(ne,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(ue,null,{default:t(()=>[e(Ce,null,{default:t(()=>[e(H,{cols:"12",md:"3"},{default:t(()=>[e(xe,{modelValue:h.value.search,"onUpdate:modelValue":o[0]||(o[0]=Q=>h.value.search=Q),label:"Cari Variant",placeholder:"Nama variant, SKU, atau produk...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:h.value.stockStatus,"onUpdate:modelValue":o[1]||(o[1]=Q=>h.value.stockStatus=Q),items:O,label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:h.value.activeStatus,"onUpdate:modelValue":o[2]||(o[2]=Q=>h.value.activeStatus=Q),items:[{title:"Semua Status",value:null},{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Status Aktif",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e(H,{cols:"12",md:"3"},{default:t(()=>[e(Fe,{modelValue:h.value.sortBy,"onUpdate:modelValue":o[3]||(o[3]=Q=>h.value.sortBy=Q),items:te,label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),J.value?(w(),se("div",si,[o[16]||(o[16]=l("span",{class:"text-body-2"},"Filter aktif:",-1)),h.value.search?(w(),N(pe,{key:0,size:"small",closable:"","onClick:close":o[4]||(o[4]=Q=>h.value.search="")},{default:t(()=>[_(" Pencarian: "+d(h.value.search),1)]),_:1})):Y("",!0),h.value.stockStatus?(w(),N(pe,{key:1,size:"small",closable:"","onClick:close":o[5]||(o[5]=Q=>h.value.stockStatus="")},{default:t(()=>{var Q;return[_(" Stok: "+d((Q=O.find(ke=>ke.value===h.value.stockStatus))==null?void 0:Q.title),1)]}),_:1})):Y("",!0),h.value.activeStatus!==null?(w(),N(pe,{key:2,size:"small",closable:"","onClick:close":o[6]||(o[6]=Q=>h.value.activeStatus=null)},{default:t(()=>[_(" Status: "+d(h.value.activeStatus?"Aktif":"Nonaktif"),1)]),_:1})):Y("",!0),e(K,{variant:"text",size:"small",color:"error",onClick:me},{default:t(()=>o[15]||(o[15]=[_(" Hapus Semua Filter ")])),_:1,__:[15]})])):Y("",!0)]),_:1})]),_:1}),!m.value&&ce.value.length===0&&J.value?(w(),N(Be,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada variant yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):Y("",!0),m.value?(w(),se("div",ni,[e(Pt,{color:"primary",indeterminate:"",size:"64"}),o[17]||(o[17]=l("div",{class:"mt-4 text-h6"},"Memuat variant...",-1))])):E.value.length===0?(w(),se("div",ii,[e(D,{icon:"mdi-tune-variant",size:"96",class:"text-disabled mb-6"}),o[19]||(o[19]=l("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Variant Produk",-1)),o[20]||(o[20]=l("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat variant untuk produk Anda agar dapat menawarkan pilihan yang beragam ",-1)),e(K,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:f},{default:t(()=>o[18]||(o[18]=[_(" Buat Variant Pertama ")])),_:1,__:[18]})])):(w(),N(Ce,{key:3},{default:t(()=>[(w(!0),se($e,null,Je(ce.value,Q=>(w(),N(H,{key:Q.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(ne,{class:Ye(["variant-group-card h-100",{"border-error":ae(Q.variants)}]),elevation:"2"},{default:t(()=>[e(Ve,{class:"pa-4 pb-2"},{default:t(()=>[l("div",ri,[e(Se,{image:Q.product.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[Q.product.image_url?Y("",!0):(w(),N(D,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),l("div",ui,[l("h3",di,d(Q.product.name),1),l("p",ci," SKU: "+d(Q.product.sku||"-"),1)]),e(pe,{color:B(Q.variants),size:"small",variant:"tonal"},{default:t(()=>[_(d(Q.variants.length)+" Variant ",1)]),_:2},1032,["color"])])]),_:2},1024),e(ze),e(ue,{class:"pa-4"},{default:t(()=>[e(Vt,{class:"pa-0"},{default:t(()=>[(w(!0),se($e,null,Je(Q.variants,(ke,Te)=>(w(),N(Qe,{key:ke.id_variant,class:Ye(["pa-2 rounded-lg variant-item",{"mb-2":Te<Q.variants.length-1}])},{prepend:t(()=>[e(Se,{size:"32",color:ke.is_active?"success":"error",variant:"tonal"},{default:t(()=>[e(D,{icon:ke.is_active?"mdi-check":"mdi-close",size:"16"},null,8,["icon"])]),_:2},1032,["color"])]),append:t(()=>[l("div",gi,[e(Ee,{text:"Kelola Komposisi"},{activator:t(({props:ie})=>[e(K,ye({ref_for:!0},ie,{icon:"mdi-chef-hat",size:"small",variant:"text",color:"primary",onClick:Me=>r(ke)}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Hapus Variant"},{activator:t(({props:ie})=>[e(K,ye({ref_for:!0},ie,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Me=>U(ke)}),null,16,["onClick"])]),_:2},1024)])]),default:t(()=>[e(ft,{class:"text-sm font-weight-medium"},{default:t(()=>[_(d(ke.name),1)]),_:2},1024),e(pt,null,{default:t(()=>[l("div",mi,[l("span",vi,"SKU: "+d(ke.sku),1),l("div",fi,[l("span",pi,d(L(Ae)(ke.price||0)),1),ke.composition_summary?(w(),N(pe,{key:0,color:n(ke.composition_summary.stock_status),size:"x-small",variant:"tonal"},{default:t(()=>[_(d(x(ke.composition_summary.stock_status)),1)]),_:2},1032,["color"])):Y("",!0)])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:2},1024)]),_:2},1024),e(ze),e(Ke,{class:"pa-4"},{default:t(()=>[l("div",_i,[l("div",null,[e(pe,{color:ge(Q.variants).color,size:"small",variant:"tonal"},{default:t(()=>[e(D,{icon:ge(Q.variants).icon,size:"14",class:"me-1"},null,8,["icon"]),_(" "+d(ge(Q.variants).text),1)]),_:2},1032,["color"])]),l("div",ki,[e(Ee,{text:"Setting HPP Produk"},{activator:t(({props:ke})=>[e(K,ye({ref_for:!0},ke,{icon:"mdi-calculator-variant",size:"small",variant:"text",color:"warning",onClick:Te=>v(Q.variants[0])}),null,16,["onClick"])]),_:2},1024),e(Ee,{text:"Tambah Variant"},{activator:t(({props:ke})=>[e(K,ye({ref_for:!0},ke,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:f}),null,16)]),_:1}),e(Ee,{text:"Pengaturan Produk (Coming Soon)"},{activator:t(({props:ke})=>[e(K,ye({ref_for:!0},ke,{icon:"mdi-cog",size:"small",variant:"text",color:"secondary",disabled:""}),null,16)]),_:1})])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(Jn,{modelValue:c.value,"onUpdate:modelValue":o[7]||(o[7]=Q=>c.value=Q),variant:S.value,onSave:G},null,8,["modelValue","variant"]),e(na,{modelValue:k.value,"onUpdate:modelValue":o[8]||(o[8]=Q=>k.value=Q),"variant-id":(i=S.value)==null?void 0:i.id_variant,"variant-name":(T=S.value)==null?void 0:T.name,onHppUpdated:X,onPriceUpdated:W},null,8,["modelValue","variant-id","variant-name"]),e(ai,{modelValue:ee.value,"onUpdate:modelValue":o[9]||(o[9]=Q=>ee.value=Q),onSave:A},null,8,["modelValue"]),e(Lt,{modelValue:p.value,"onUpdate:modelValue":o[10]||(o[10]=Q=>p.value=Q),title:"Konfirmasi Hapus Variant","item-name":(_e=S.value)==null?void 0:_e.name,loading:I.value,"confirm-text":"Hapus Variant",onConfirm:P,onCancel:o[11]||(o[11]=Q=>p.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),qt=We(yi,[["__scopeId","data-v-edd5278d"]]),bi={class:"product-management"},hi={class:"d-flex justify-space-between align-center mb-6"},xi={class:"d-flex gap-3 align-center"},wi={key:0,class:"d-flex gap-2"},Pi={class:"d-flex align-center"},Vi=qe({__name:"products-management",setup(s){Yt();const{productsList:R,categories:g,loading:m,saveLoading:z,deleteLoading:p,toggleLoading:I,stats:S,dialog:c,deleteDialog:k,editMode:ee,selectedProduct:h,selectedProducts:O,currentPage:te,totalItems:J,itemsPerPage:E,filters:ce,errorMessage:ve,successMessage:W,modalErrorMessage:X,formData:r,selectedImage:v,imagePreview:U,canCreateEdit:f,hasSelectedProducts:P,fetchProductsList:n,fetchCategories:x,fetchStats:B,saveProduct:ae,deleteProduct:ge,bulkDeleteProducts:me,toggleActiveStatus:G,toggleFeaturedStatus:A,openCreateDialog:y,openEditDialog:o,openDeleteDialog:i,closeDialog:T,handleImageUpload:_e,clearModalError:Q,onPageChange:ke}=Qt(),{dialog:Te,editMode:ie,formData:Me,availableItems:Ie,saveLoading:Ze,modalErrorMessage:et,openCreateDialog:Re,closeDialog:u,saveRecipe:a,clearModalError:b,fetchAvailableItems:F}=Na(),{productItemsList:q,loading:$,fetchProductItemsForComposition:V}=ia(),j=M("products"),C=M(),re=M(!1),fe=M(null),he=M(!1),Pe=M(null),De=async()=>{await ge()},He=async()=>{await me()},Le=be=>{const Z=be.id_product||be.id;Re(Z)},tt=async be=>{fe.value=be;try{await V({page:1,per_page:50,critical_only:!1})}catch{}re.value=!0},at=be=>{Pe.value=be,he.value=!0},lt=be=>{if(!be)return[];const Z=be.id_product||be.id;return q.value.filter(le=>{var oe;return((oe=le.product)==null?void 0:oe.id_product)===Z||le.product_id===Z})||[]},ct=async()=>{if(await V({page:1,per_page:50,critical_only:!1}),await n(),fe.value&&C.value){const be=fe.value.id_product||fe.value.id;await C.value.refreshHPPData(be)}},_t=be=>{Object.assign(ce,be),n()},kt=be=>{ce.search=be,n()},rt=()=>{v.value=null,U.value&&(U.value="")};return we(j,async be=>{be==="compositions"&&await V({page:1,per_page:15,critical_only:!1})},{immediate:!1}),dt(()=>{n(),x(),B(),F()}),(be,Z)=>{var le;return w(),se("div",bi,[l("div",hi,[Z[18]||(Z[18]=l("div",null,[l("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),l("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),l("div",xi,[L(P)&&j.value==="products"?(w(),se("div",wi,[e(pe,{color:"primary",size:"small"},{default:t(()=>[_(d(L(O).length)+" dipilih ",1)]),_:1}),e(K,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:He},{default:t(()=>Z[16]||(Z[16]=[_(" Hapus Terpilih ")])),_:1,__:[16]})])):Y("",!0),L(f)&&j.value==="products"?(w(),N(K,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:L(y)},{default:t(()=>Z[17]||(Z[17]=[_(" Tambah Produk ")])),_:1,__:[17]},8,["onClick"])):Y("",!0)])]),e(Sl,{modelValue:j.value,"onUpdate:modelValue":Z[0]||(Z[0]=oe=>j.value=oe),class:"mb-6"},{default:t(()=>[e(bt,{value:"products"},{default:t(()=>[e(D,{icon:"mdi-coffee",class:"me-2"}),Z[19]||(Z[19]=_(" Produk "))]),_:1,__:[19]}),e(bt,{value:"compositions"},{default:t(()=>[e(D,{icon:"mdi-chef-hat",class:"me-2"}),Z[20]||(Z[20]=_(" Komposisi Produk "))]),_:1,__:[20]}),e(bt,{value:"variants"},{default:t(()=>[e(D,{icon:"mdi-tune-variant",class:"me-2"}),Z[21]||(Z[21]=_(" Variant Produk "))]),_:1,__:[21]})]),_:1},8,["modelValue"]),L(ve)?(w(),N(Be,{key:0,type:"error",variant:"outlined",class:"mb-4",text:L(ve),closable:"","onClick:close":Z[1]||(Z[1]=oe=>ve.value="")},null,8,["text"])):Y("",!0),L(W)?(w(),N(Be,{key:1,type:"success",variant:"outlined",class:"mb-4",text:L(W),closable:"","onClick:close":Z[2]||(Z[2]=oe=>W.value="")},null,8,["text"])):Y("",!0),e($t,{modelValue:j.value,"onUpdate:modelValue":Z[4]||(Z[4]=oe=>j.value=oe)},{default:t(()=>[e(vt,{value:"products"},{default:t(()=>[e(Ms,{stats:L(S)},null,8,["stats"]),e(ks,{filters:L(ce),"onUpdate:filters":_t,onSearch:kt},null,8,["filters"]),e(an,{ref_key:"productTableRef",ref:C,products:L(R),loading:L(m),"current-page":L(te),"total-items":L(J),"items-per-page":L(E),"selected-products":L(O),"toggle-loading":L(I),"onUpdate:page":L(ke),onAddProduct:L(y),onEditProduct:L(o),onOpenRecipeDialog:Le,onOpenCompositionDialog:tt,onOpenVariantDialog:at,onDeleteProduct:L(i),onToggleActive:L(G),onToggleFeatured:L(A),"onUpdate:selectedProducts":Z[3]||(Z[3]=oe=>O.value=oe)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:page","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured"])]),_:1}),e(vt,{value:"compositions"},{default:t(()=>[e(Fo,{"product-items":L(q),loading:L($),onRefresh:L(V)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(vt,{value:"variants"},{default:t(()=>[e(qt,{loading:L(m),onRefresh:L(n)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(vs,{modelValue:L(c),"onUpdate:modelValue":[Z[5]||(Z[5]=oe=>Ct(c)?c.value=oe:null),Z[6]||(Z[6]=oe=>c.value=oe)],"edit-mode":L(ee),"form-data":L(r),categories:L(g),loading:L(z),"error-message":L(X),"selected-image":L(v)?[L(v)]:[],"image-preview":L(U),onClose:L(T),onSubmit:L(ae),onImageChange:L(_e),onRemoveImage:rt,onClearError:L(Q),onUpdateForm:Z[7]||(Z[7]=(oe,Ue)=>L(r)[oe]=Ue)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(ja,{modelValue:L(Te),"onUpdate:modelValue":[Z[8]||(Z[8]=oe=>Ct(Te)?Te.value=oe:null),Z[9]||(Z[9]=oe=>Te.value=oe)],"edit-mode":L(ie),"form-data":L(Me),"available-items":L(Ie),loading:L(Ze),"error-message":L(et),onClose:L(u),onSave:L(a),onClearError:L(b)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(Lt,{modelValue:L(k),"onUpdate:modelValue":Z[10]||(Z[10]=oe=>Ct(k)?k.value=oe:null),title:"Konfirmasi Hapus Produk","item-name":(le=L(h))==null?void 0:le.name,loading:L(p),"confirm-text":"Hapus Produk",onConfirm:De,onCancel:Z[11]||(Z[11]=oe=>k.value=!1)},null,8,["modelValue","item-name","loading"]),e(sa,{modelValue:re.value,"onUpdate:modelValue":Z[12]||(Z[12]=oe=>re.value=oe),product:fe.value,items:lt(fe.value),onSave:ct,onRefresh:ct},null,8,["modelValue","product","items"]),e(Ne,{modelValue:he.value,"onUpdate:modelValue":Z[15]||(Z[15]=oe=>he.value=oe),"max-width":"1400px",persistent:""},{default:t(()=>[e(ne,null,{default:t(()=>[e(Ve,{class:"d-flex justify-between align-center"},{default:t(()=>{var oe;return[l("div",Pi,[e(D,{icon:"tabler-versions",class:"me-2"}),_(" Kelola Variant - "+d((oe=Pe.value)==null?void 0:oe.name),1)]),e(K,{icon:"tabler-x",variant:"text",onClick:Z[13]||(Z[13]=Ue=>he.value=!1)})]}),_:1}),e(ze),e(ue,{class:"pa-0"},{default:t(()=>[Pe.value?(w(),N(qt,{key:0,product:Pe.value},null,8,["product"])):Y("",!0)]),_:1}),e(ze),e(Ke,null,{default:t(()=>[e(je),e(K,{color:"grey-darken-1",variant:"outlined",onClick:Z[14]||(Z[14]=oe=>he.value=!1)},{default:t(()=>[e(D,{icon:"mdi-close",class:"me-1"}),Z[22]||(Z[22]=_(" Tutup "))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),_r=We(Vi,[["__scopeId","data-v-9db14e64"]]);export{_r as default};
