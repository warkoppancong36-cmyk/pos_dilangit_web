import{g as A,f as w,r as k,au as I,V as x,w as M,a as Q,o as a,b as p,e,$ as T,X as S,s as V,t as r,c as n,l as c,H as y,v,F,i as N,ct as D,ci as E,cu as z}from"./main-D2pCXjJt.js";import{u as O}from"./baseProduct-DMyy4ndu.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as H}from"./VDialog-uubol7yt.js";import{V as K}from"./VCard-Ow_twZA2.js";import"./api-BFpxaMgs.js";import"./index-D-EbNoF1.js";import"./CategoriesApi-BZU19ZH_.js";import"./VOverlay-DQQA9shm.js";import"./forwardRefs-B931MWyl.js";import"./VImg-De3ZT4Uu.js";import"./VAvatar-CNDK7ytP.js";import"./VCardText-CxOTFAQ-.js";const L={name:"CompositionModal",props:{show:{type:Boolean,default:!1},composition:{type:Object,default:null},products:{type:Array,default:()=>[]},baseProducts:{type:Array,default:()=>[]}},emits:["close","saved"],setup(m,{emit:o}){const g=O(),t=k(!1),f=k({}),u=k(null),i=I({product_id:"",base_product_id:"",quantity:"",notes:"",is_active:!0}),b=x(()=>!!m.composition),s=x(()=>i.product_id&&i.base_product_id&&i.quantity>0),j=x(()=>!u.value||!i.quantity?0:parseFloat(u.value.cost_per_unit)*parseFloat(i.quantity)),U=x(()=>{if(!u.value||!i.quantity)return 0;const d=parseFloat(u.value.current_stock)||0,l=parseFloat(i.quantity)||0;return l>0?Math.floor(d/l):0}),C=()=>{Object.keys(i).forEach(d=>{d==="is_active"?i[d]=!0:i[d]=""}),u.value=null,f.value={}},P=()=>{const d=i.base_product_id;d?u.value=m.baseProducts.find(l=>l.id_base_product==d):u.value=null};return M(()=>m.composition,d=>{d?(Object.keys(i).forEach(l=>{i[l]=d[l]||(l==="is_active"?!0:"")}),P()):C(),f.value={}},{immediate:!0}),{loading:t,errors:f,selectedBaseProduct:u,form:i,isEdit:b,canSubmit:s,calculatedCost:j,maxProducibleQuantity:U,updateSelectedBaseProduct:P,calculateCost:()=>{},formatNumber:d=>new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:3}).format(d||0),formatCurrency:d=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(d||0),handleSubmit:async()=>{var d,l,B,q;t.value=!0,f.value={};try{const _={product_id:i.product_id,base_product_id:i.base_product_id,quantity:parseFloat(i.quantity),notes:i.notes||null,is_active:i.is_active};let h;b.value?h=await g.updateComposition(m.composition.id_composition,_):h=await g.createComposition(_),o("saved",h.data)}catch(_){console.error("Error saving composition:",_),(l=(d=_.response)==null?void 0:d.data)!=null&&l.errors?f.value=_.response.data.errors:f.value={general:[((q=(B=_.response)==null?void 0:B.data)==null?void 0:q.message)||"An error occurred"]}}finally{t.value=!1}},resetForm:C}}},X={class:"flex items-center"},G={class:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-indigo-100"},J={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left flex-1"},W={class:"text-sm text-gray-500"},Y={class:"mt-6 space-y-6"},Z=["disabled"],$=["value"],tt={key:0,class:"mt-1 text-sm text-red-600"},et={key:1,class:"mt-1 text-sm text-gray-500"},ot=["disabled"],st=["value"],rt={key:0,class:"mt-1 text-sm text-red-600"},it={key:1,class:"mt-1 text-sm text-gray-500"},dt={key:0,class:"bg-gray-50 p-4 rounded-md"},at={class:"flex items-center space-x-3"},nt=["src","alt"],lt={key:1,class:"h-12 w-12 rounded-lg bg-gray-200 flex items-center justify-center"},ct={class:"flex-1"},ut={class:"font-medium text-gray-900"},mt={class:"text-sm text-gray-500"},ft={class:"text-sm text-gray-500"},bt={class:"text-sm text-gray-500"},_t={class:"mt-1 relative rounded-md shadow-sm"},gt={class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},yt={class:"text-gray-500 sm:text-sm"},xt={key:0,class:"mt-1 text-sm text-red-600"},pt={key:1,class:"bg-blue-50 p-4 rounded-md"},vt={class:"text-sm text-blue-800 space-y-1"},ht={class:"font-medium border-t border-blue-200 pt-1"},wt={key:2,class:"bg-green-50 p-4 rounded-md"},kt={class:"text-sm text-green-800 space-y-1"},Ct={class:"font-medium border-t border-green-200 pt-1"},Pt={key:0,class:"mt-1 text-sm text-red-600"},Bt={class:"flex items-center"},qt={class:"mt-6 flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-3"},St=["disabled"],Vt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"};function Ft(m,o,g,t,f,u){const i=Q("DialogTitle");return a(),A(H,{"model-value":g.show,"max-width":"800px",persistent:"","onUpdate:modelValue":o[9]||(o[9]=b=>!b&&m.$emit("close"))},{default:w(()=>[p(K,null,{default:w(()=>{var b;return[e("form",{onSubmit:o[8]||(o[8]=T((...s)=>t.handleSubmit&&t.handleSubmit(...s),["prevent"]))},[e("div",null,[e("div",X,[e("div",G,[p(S,{icon:"tabler-assembly",class:"h-6 w-6 text-indigo-600"})]),e("div",J,[p(i,{as:"h3",class:"text-lg font-medium leading-6 text-gray-900"},{default:w(()=>[V(r(t.isEdit?"Edit Product Composition":"Create Product Composition"),1)]),_:1}),e("p",W,r(t.isEdit?"Update the composition details.":"Define which base products are needed for this product."),1)])]),e("div",Y,[e("div",null,[o[11]||(o[11]=e("label",{for:"product_id",class:"block text-sm font-medium text-gray-700"}," Product * ",-1)),y(e("select",{id:"product_id","onUpdate:modelValue":o[0]||(o[0]=s=>t.form.product_id=s),required:"",disabled:t.isEdit,class:v(["mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm disabled:bg-gray-100",{"border-red-300":t.errors.product_id}])},[o[10]||(o[10]=e("option",{value:""},"Select Product",-1)),(a(!0),n(F,null,N(g.products,s=>(a(),n("option",{key:s.id_product,value:s.id_product},r(s.name),9,$))),128))],10,Z),[[D,t.form.product_id]]),t.errors.product_id?(a(),n("p",tt,r(t.errors.product_id[0]),1)):c("",!0),t.isEdit?(a(),n("p",et,"Product cannot be changed when editing")):c("",!0)]),e("div",null,[o[13]||(o[13]=e("label",{for:"base_product_id",class:"block text-sm font-medium text-gray-700"}," Base Product * ",-1)),y(e("select",{id:"base_product_id","onUpdate:modelValue":o[1]||(o[1]=s=>t.form.base_product_id=s),required:"",disabled:t.isEdit,class:v(["mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm disabled:bg-gray-100",{"border-red-300":t.errors.base_product_id}]),onChange:o[2]||(o[2]=(...s)=>t.updateSelectedBaseProduct&&t.updateSelectedBaseProduct(...s))},[o[12]||(o[12]=e("option",{value:""},"Select Base Product",-1)),(a(!0),n(F,null,N(g.baseProducts,s=>(a(),n("option",{key:s.id_base_product,value:s.id_base_product},r(s.name)+" ("+r(s.current_stock)+" "+r(s.unit)+" available) ",9,st))),128))],42,ot),[[D,t.form.base_product_id]]),t.errors.base_product_id?(a(),n("p",rt,r(t.errors.base_product_id[0]),1)):c("",!0),t.isEdit?(a(),n("p",it,"Base product cannot be changed when editing")):c("",!0)]),t.selectedBaseProduct?(a(),n("div",dt,[e("div",at,[t.selectedBaseProduct.image_url?(a(),n("img",{key:0,src:t.selectedBaseProduct.image_url,alt:t.selectedBaseProduct.name,class:"h-12 w-12 rounded-lg object-cover"},null,8,nt)):(a(),n("div",lt,[p(S,{icon:"tabler-package",class:"h-6 w-6 text-gray-400"})])),e("div",ct,[e("h4",ut,r(t.selectedBaseProduct.name),1),e("p",mt,"SKU: "+r(t.selectedBaseProduct.sku),1),e("p",ft,"Cost: "+r(t.selectedBaseProduct.formatted_cost)+" per "+r(t.selectedBaseProduct.unit),1),e("p",bt,"Available: "+r(t.formatNumber(t.selectedBaseProduct.current_stock))+" "+r(t.selectedBaseProduct.unit),1)])])])):c("",!0),e("div",null,[o[14]||(o[14]=e("label",{for:"quantity",class:"block text-sm font-medium text-gray-700"}," Quantity Required * ",-1)),e("div",_t,[y(e("input",{id:"quantity","onUpdate:modelValue":o[3]||(o[3]=s=>t.form.quantity=s),type:"number",step:"0.001",min:"0",required:"",class:v(["block w-full pr-16 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300":t.errors.quantity}]),onInput:o[4]||(o[4]=(...s)=>t.calculateCost&&t.calculateCost(...s))},null,34),[[E,t.form.quantity]]),e("div",gt,[e("span",yt,r(((b=t.selectedBaseProduct)==null?void 0:b.unit)||"unit"),1)])]),t.errors.quantity?(a(),n("p",xt,r(t.errors.quantity[0]),1)):c("",!0),o[15]||(o[15]=e("p",{class:"mt-1 text-sm text-gray-500"}," Quantity of base product needed to produce 1 unit of the selected product ",-1))]),t.form.quantity&&t.selectedBaseProduct?(a(),n("div",pt,[o[16]||(o[16]=e("h4",{class:"text-sm font-medium text-blue-900 mb-2"},"Cost Calculation",-1)),e("div",vt,[e("p",null,"Cost per unit: "+r(t.selectedBaseProduct.formatted_cost),1),e("p",null,"Quantity needed: "+r(t.formatNumber(t.form.quantity))+" "+r(t.selectedBaseProduct.unit),1),e("p",ht," Total cost per product: "+r(t.formatCurrency(t.calculatedCost)),1)])])):c("",!0),t.form.quantity&&t.selectedBaseProduct?(a(),n("div",wt,[o[17]||(o[17]=e("h4",{class:"text-sm font-medium text-green-900 mb-2"},"Production Capacity",-1)),e("div",kt,[e("p",null,"Available stock: "+r(t.formatNumber(t.selectedBaseProduct.current_stock))+" "+r(t.selectedBaseProduct.unit),1),e("p",null,"Required per product: "+r(t.formatNumber(t.form.quantity))+" "+r(t.selectedBaseProduct.unit),1),e("p",Ct," Can produce: "+r(t.formatNumber(t.maxProducibleQuantity))+" products ",1)])])):c("",!0),e("div",null,[o[18]||(o[18]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"}," Notes ",-1)),y(e("textarea",{id:"notes","onUpdate:modelValue":o[5]||(o[5]=s=>t.form.notes=s),rows:"3",placeholder:"Additional notes about this composition...",class:v(["mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",{"border-red-300":t.errors.notes}])},null,2),[[E,t.form.notes]]),t.errors.notes?(a(),n("p",Pt,r(t.errors.notes[0]),1)):c("",!0)]),e("div",Bt,[y(e("input",{id:"is_active","onUpdate:modelValue":o[6]||(o[6]=s=>t.form.is_active=s),type:"checkbox",class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"},null,512),[[z,t.form.is_active]]),o[19]||(o[19]=e("label",{for:"is_active",class:"ml-2 block text-sm text-gray-900"}," Active ",-1))])])]),e("div",qt,[e("button",{type:"button",onClick:o[7]||(o[7]=s=>m.$emit("close")),class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm"}," Cancel "),e("button",{type:"submit",disabled:t.loading||!t.canSubmit,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"},[t.loading?(a(),n("svg",Vt,o[20]||(o[20]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):c("",!0),V(" "+r(t.loading?"Saving...":t.isEdit?"Update":"Create"),1)],8,St)])],32)]}),_:1})]),_:1},8,["model-value"])}const Gt=R(L,[["render",Ft]]);export{Gt as default};
