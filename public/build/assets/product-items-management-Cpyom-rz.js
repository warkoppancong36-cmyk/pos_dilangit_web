import{D as Je}from"./DeleteConfirmationDialog-BMw8MP43.js";import{d as se,r as ie,V as j,w as We,g as C,f as t,b as e,e as o,t as m,a1 as I,l as S,at as z,cw as R,s as f,a0 as Ye,p as Ze,o as p,a as Qe,c as V,F as Q,i as X,X as h,v as me,_ as Ce,ax as Xe,D as Ge,m as d,a3 as et,j as tt}from"./main-CB2I6xMV.js";import{V as pe}from"./VDialog-B6cC2nlh.js";import{b as O,c as ne,V as F}from"./VCard-kftbvHmf.js";import{V as M}from"./VDivider-DwA1QPln.js";import{V as A}from"./VCardText-BfCVZfsH.js";import{V as at}from"./VForm-BZABAsaR.js";import{V as B,a as w}from"./VRow-GRjXWUI7.js";import{V as G}from"./VSelect-hlAyRJts.js";import{a as Ve,V as lt,b as ot,d as it}from"./VList-VjqlGNmq.js";import{V as E,b as st}from"./VChip-CXoDuQ6k.js";import{V as ce}from"./VTextField-Datxr734.js";import{V as xe}from"./VCheckbox-CET2lmpw.js";import{V as nt}from"./VTextarea-BROs2Myi.js";import{V as re}from"./VSpacer-E_xV2pSV.js";import{V as ue}from"./VTooltip-CR32dyC_.js";import{a as rt,V as dt}from"./VDataTable-B_aJPoAP.js";import{u as ut}from"./useProductItems-0XM_xVTW.js";import{V as mt}from"./VContainer-DSbNMF-c.js";import{V as ct}from"./VAvatar-D5c5G9iR.js";import"./VOverlay-3Ss5mR2i.js";import"./forwardRefs-B931MWyl.js";import"./VImg-DwwCzJBL.js";/* empty css              */import"./VMenu-DDyD7LK0.js";import"./VCheckboxBtn-BKcWcRAi.js";import"./VTable-Czu5oa5q.js";import"./filter-Bmzh0E9F.js";import"./ItemsApi-DHgCfB0A.js";import"./ProductsApi-JbunZ9YS.js";const pt={class:"text-h5"},ft={class:"text-body-2"},gt={class:"d-flex align-center justify-space-between"},_t=se({__name:"ProductItemDialog",props:{dialog:{type:Boolean},editMode:{type:Boolean},formData:{},loading:{type:Boolean},products:{},items:{},errorMessage:{}},emits:["update:dialog","update:errorMessage","update:formData","save","itemChange"],setup(J,{emit:q}){const k=J,D=q,T=ie(),K=ie(!1),P=j({get:()=>k.dialog,set:a=>D("update:dialog",a)}),U=j({get:()=>k.formData,set:a=>D("update:formData",a)}),$={required:a=>!!a||"This field is required",positiveNumber:a=>a>0||"Must be greater than 0",stockValidation:a=>{if(!a||a<=0)return"Jumlah harus lebih dari 0";const i=b();if(!i)return!0;const s=g(i);return a<=s||`Jumlah tidak boleh melebihi stok tersedia (${s})`}},b=()=>k.items.find(a=>a.id_item===k.formData.item_id),g=a=>a?a.inventory?a.inventory.available_stock||a.inventory.current_stock||0:a.current_stock||a.available_stock||0:0,r=()=>{const a=b();return!a||!k.formData.quantity_needed?!1:k.formData.quantity_needed>g(a)},v=()=>{const a=b();if(!a||!k.formData.quantity_needed)return"primary";const i=g(a),s=k.formData.quantity_needed,y=s/i*100;return s>i?"error":y>80?"warning":"primary"},ee=()=>{const a=b();if(!a)return"";const i=g(a),s=k.formData.quantity_needed||0,y=i>0?(s/i*100).toFixed(1):"0";return`Stok tersedia: ${i} | Akan menggunakan: ${y}%`},te=j(()=>k.items.map(a=>{const i=g(a),s=i<=0?"OUT_OF_STOCK":i<=10?"LOW_STOCK":"IN_STOCK",y=s==="OUT_OF_STOCK"?"error":s==="LOW_STOCK"?"warning":"success",L=s==="OUT_OF_STOCK"?"Habis":s==="LOW_STOCK"?`${i} (Rendah)`:`${i}`,W=new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a.cost_per_unit||0);return{...a,displayName:`${a.name} (${i} ${a.unit})`,stockStatus:s,stockChipColor:y,stockText:L,formattedCost:W}})),N=(a,i)=>{const s={...k.formData,[a]:i};D("update:formData",s)},n=a=>{N("item_id",a),D("itemChange",a)},u=async()=>{var i;const{valid:a}=await((i=T.value)==null?void 0:i.validate());a&&D("save")};return We(P,a=>{a||D("update:errorMessage","")}),(a,i)=>(p(),C(pe,{modelValue:P.value,"onUpdate:modelValue":i[9]||(i[9]=s=>P.value=s),persistent:"","max-width":"600px",scrollable:""},{default:t(()=>[e(F,null,{default:t(()=>[e(O,{class:"d-flex justify-space-between align-center"},{default:t(()=>[o("span",pt,m(a.editMode?"Edit Komposisi Produk":"Tambah Komposisi Produk"),1),e(I,{icon:"tabler-x",size:"small",variant:"text",onClick:i[0]||(i[0]=s=>P.value=!1)})]),_:1}),e(M),e(A,null,{default:t(()=>[a.errorMessage?(p(),C(z,{key:0,type:"error",variant:"outlined",class:"mb-4",text:a.errorMessage,closable:"","onClick:close":i[1]||(i[1]=()=>D("update:errorMessage",""))},null,8,["text"])):S("",!0),r()?(p(),C(z,{key:1,type:"warning",variant:"tonal",density:"compact",class:"mb-4"},{default:t(()=>[e(R,{class:"mb-2"},{default:t(()=>i[10]||(i[10]=[f("Peringatan Stok")])),_:1,__:[10]}),o("div",ft,[f(" Jumlah yang dibutuhkan ("+m(a.formData.quantity_needed)+") melebihi stok tersedia ("+m(b()?g(b()):0)+"). ",1),i[11]||(i[11]=o("br",null,null,-1)),i[12]||(i[12]=f(" Silakan kurangi jumlah yang dibutuhkan atau pastikan stok mencukupi. "))])]),_:1})):S("",!0),e(at,{ref_key:"formRef",ref:T,modelValue:K.value,"onUpdate:modelValue":i[7]||(i[7]=s=>K.value=s),onSubmit:Ye(u,["prevent"])},{default:t(()=>[e(B,null,{default:t(()=>[e(w,{cols:"12"},{default:t(()=>[e(G,{"model-value":U.value.product_id,items:a.products,"item-title":"name","item-value":"id_product",label:"Produk *",rules:[$.required],variant:"outlined",clearable:"",disabled:a.editMode,"no-data-text":"Tidak ada produk tersedia","onUpdate:modelValue":i[2]||(i[2]=s=>N("product_id",s))},null,8,["model-value","items","rules","disabled"])]),_:1}),e(w,{cols:"12"},{default:t(()=>[e(G,{"model-value":U.value.item_id,items:te.value,"item-title":"displayName","item-value":"id_item",label:"Item *",rules:[$.required],variant:"outlined",clearable:"",disabled:a.editMode,"no-data-text":"Tidak ada item tersedia","onUpdate:modelValue":n},{item:t(({props:s,item:y})=>[e(Ve,Ze(s,{disabled:y.raw.stockStatus==="OUT_OF_STOCK"}),{title:t(()=>[f(m(y.raw.name),1)]),subtitle:t(()=>[o("div",gt,[o("span",null,m(y.raw.unit)+" â€¢ "+m(y.raw.formattedCost),1),e(E,{color:y.raw.stockChipColor,size:"x-small",variant:"tonal"},{default:t(()=>[f(m(y.raw.stockText),1)]),_:2},1032,["color"])])]),_:2},1040,["disabled"])]),_:1},8,["model-value","items","rules","disabled"])]),_:1}),e(w,{cols:"6"},{default:t(()=>[e(ce,{"model-value":U.value.quantity_needed,type:"number",label:"Jumlah Dibutuhkan *",rules:[$.required,$.positiveNumber,$.stockValidation],variant:"outlined",min:"1",step:"1",max:b()?g(b()):void 0,color:v(),error:r(),"error-messages":r()?`Stok tidak cukup (${b()?g(b()):0} tersedia)`:[],hint:ee(),"persistent-hint":"","onUpdate:modelValue":i[3]||(i[3]=s=>N("quantity_needed",s?parseInt(s):0))},null,8,["model-value","rules","max","color","error","error-messages","hint"])]),_:1}),e(w,{cols:"6"},{default:t(()=>[e(ce,{"model-value":U.value.unit,label:"Satuan *",rules:[$.required],variant:"outlined",placeholder:"e.g., kg, liter, pcs","onUpdate:modelValue":i[4]||(i[4]=s=>N("unit",s))},null,8,["model-value","rules"])]),_:1}),e(w,{cols:"12"},{default:t(()=>[e(xe,{"model-value":U.value.is_critical,label:"Item Kritis",hint:"Tandai jika item ini sangat penting untuk produksi","onUpdate:modelValue":i[5]||(i[5]=s=>N("is_critical",s))},null,8,["model-value"])]),_:1}),e(w,{cols:"12"},{default:t(()=>[e(nt,{"model-value":U.value.notes,label:"Catatan",variant:"outlined",rows:"3",placeholder:"Catatan tambahan tentang hubungan produk-item ini...","onUpdate:modelValue":i[6]||(i[6]=s=>N("notes",s))},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(M),e(ne,{class:"px-6 py-4"},{default:t(()=>[e(re),e(I,{variant:"text",onClick:i[8]||(i[8]=s=>P.value=!1)},{default:t(()=>i[13]||(i[13]=[f(" Batal ")])),_:1,__:[13]}),e(I,{color:"primary",loading:a.loading,disabled:!K.value||r(),onClick:u},{default:t(()=>[f(m(a.editMode?"Perbarui":"Simpan"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),vt={class:"product-item-group-view pa-4"},kt={class:"d-flex justify-space-between align-start mb-3"},yt={class:"flex-grow-1"},bt={class:"text-h6 font-weight-bold mb-1"},Ct={class:"text-body-2 text-grey mb-0"},Vt={class:"items-list"},xt={class:"text-subtitle-2 font-weight-bold mb-3 text-grey-darken-1"},wt={class:"d-flex justify-space-between align-center"},Dt={class:"flex-grow-1"},$t={class:"d-flex align-center mb-1"},St={class:"text-body-1 font-weight-medium"},It={class:"d-flex align-center text-body-2 text-grey"},Pt={class:"d-flex align-center"},ht={class:"text-caption text-grey"},Tt={key:3,class:"d-flex justify-center mt-4"},Ut=se({__name:"ProductItemGroupView",props:{productItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},totalItems:{},products:{},items:{}},emits:["edit","delete","check-capacity","view-hpp","view-detail","update:page"],setup(J,{emit:q}){const k=J,D=q,T=n=>{var u;console.log("ðŸ”§ EDIT CLICKED!",n),console.log(`EDIT CLICKED: ${(u=n.item)==null?void 0:u.name}`),D("edit",n)},K=n=>{var u;console.log("ðŸ—‘ï¸ DELETE CLICKED!",n),console.log(`DELETE CLICKED: ${(u=n.item)==null?void 0:u.name}`),D("delete",n)},P=n=>{console.log("ðŸ“Š CAPACITY CLICKED!",n),console.log(`CAPACITY CLICKED: ${n.name}`),D("check-capacity",n)},U=n=>{console.log("ðŸ‘ï¸ DETAIL CLICKED!",n),console.log(`DETAIL CLICKED: ${n.name}`),D("view-detail",n)},$=j(()=>{console.log("ðŸ” Grouping product items..."),console.log("ðŸ“¦ Available products:",k.products.length),console.log("ðŸ§° Available items:",k.items.length),console.log("ðŸ”— Product items to group:",k.productItems.length);const n={};k.productItems.forEach(a=>{const i=a.product_id;let s=a.product||k.products.find(L=>L.id_product===i);console.log(`Looking for product ID ${i}:`,s?`Found: ${s.name}`:"NOT FOUND"),n[i]||(n[i]={product:s||{id_product:i,name:"Unknown Product",sku:"N/A"},items:[]});const y=a.item||k.items.find(L=>L.id_item===a.item_id);console.log(`Looking for item ID ${a.item_id}:`,y?`Found: ${y.name}`:"NOT FOUND"),n[i].items.push({...a,item:y})});const u=Object.values(n);return console.log("âœ… Final grouped result:",u),u}),b=n=>{if(n==null||n==="")return"0";const u=typeof n=="string"?Number.parseFloat(n):n;return isNaN(u)?"0":new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:3}).format(u)},g=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),r=n=>n.some(u=>{var a;return(a=u.item)==null?void 0:a.is_low_stock}),v=n=>r(n)?"warning":"success",ee=n=>r(n)?"Stok Rendah":"Stok Aman",te=n=>{var u;return(u=n.inventory)!=null&&u.is_low_stock||n.is_low_stock?"text-warning":"text-success"},N=n=>{var u;return(u=n.inventory)!=null&&u.is_low_stock||n.is_low_stock?"mdi-alert-circle":"mdi-check-circle"};return(n,u)=>{const a=Qe("VSkeleton");return p(),V("div",vt,[n.loading?(p(),C(B,{key:0},{default:t(()=>[(p(),V(Q,null,X(3,i=>e(w,{key:i,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(F,{elevation:"0",variant:"outlined",class:"mb-4"},{default:t(()=>[e(A,null,{default:t(()=>[e(a,{type:"text",width:"60%",class:"mb-2"}),e(a,{type:"text",width:"40%",class:"mb-4"}),(p(),V(Q,null,X(3,s=>e(a,{key:s,type:"text",width:"100%",class:"mb-1"})),64))]),_:1})]),_:1})]),_:2},1024)),64))]),_:1})):$.value.length===0?(p(),C(F,{key:1,elevation:"0",variant:"outlined",class:"text-center pa-8"},{default:t(()=>[e(h,{icon:"mdi-package-variant-closed",size:"64",color:"grey-lighten-1",class:"mb-4"}),u[1]||(u[1]=o("h3",{class:"text-h6 text-grey-darken-1 mb-2"}," Belum Ada Komposisi Produk ",-1)),u[2]||(u[2]=o("p",{class:"text-body-2 text-grey"}," Mulai tambahkan komposisi produk untuk mengelola item yang dibutuhkan ",-1))]),_:1,__:[1,2]})):(p(),C(B,{key:2},{default:t(()=>[(p(!0),V(Q,null,X($.value,i=>(p(),C(w,{key:i.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(F,{elevation:"1",variant:"flat",class:me(["mb-4 product-card",{"border-warning":r(i.items)}])},{default:t(()=>[e(A,{class:"pb-2"},{default:t(()=>[o("div",kt,[o("div",yt,[o("h3",bt,m(i.product.name),1),o("p",Ct,m(i.product.sku),1)]),e(E,{color:v(i.items),variant:"tonal",size:"small"},{default:t(()=>[f(m(ee(i.items)),1)]),_:2},1032,["color"])]),e(M,{class:"my-3"}),o("div",Vt,[o("h4",xt," Item Komposisi ("+m(i.items.length)+") ",1),(p(!0),V(Q,null,X(i.items,s=>{var y,L,W,le;return p(),V("div",{key:s.id_product_item,class:"item-row mb-3"},[o("div",wt,[o("div",Dt,[o("div",$t,[o("h5",St,m(((y=s.item)==null?void 0:y.name)||"Unknown Item"),1),s.is_critical?(p(),C(E,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>u[3]||(u[3]=[f(" Kritis ")])),_:1,__:[3]})):S("",!0)]),o("div",It,[e(h,{icon:"mdi-scale",size:"16",class:"mr-1"}),o("span",null,m(b(s.quantity_needed))+" "+m((L=s.item)==null?void 0:L.unit),1)]),s.item?(p(),V("div",{key:0,class:me(["d-flex align-center text-caption mt-1",te(s.item)])},[e(h,{icon:N(s.item),size:"12",class:"mr-1"},null,8,["icon"]),o("span",null," Stok: "+m(b((W=s.item.inventory)==null?void 0:W.current_stock))+" "+m(s.item.unit),1)],2)):S("",!0)]),o("div",Pt,[e(I,{icon:"",variant:"text",size:"small",color:"primary",onClick:oe=>T(s)},{default:t(()=>[e(h,{icon:"mdi-pencil",size:"16"}),e(ue,{activator:"parent",location:"top"},{default:t(()=>u[4]||(u[4]=[f(" Edit ")])),_:1,__:[4]})]),_:2},1032,["onClick"]),e(I,{icon:"",variant:"text",size:"small",color:"info",disabled:!((le=s.item)!=null&&le.id_item),onClick:oe=>P(i.product)},{default:t(()=>[e(h,{icon:"mdi-calculator",size:"16"}),e(ue,{activator:"parent",location:"top"},{default:t(()=>u[5]||(u[5]=[f(" Cek Kapasitas ")])),_:1,__:[5]})]),_:2},1032,["disabled","onClick"]),e(I,{icon:"",variant:"text",size:"small",color:"error",onClick:oe=>K(s)},{default:t(()=>[e(h,{icon:"mdi-delete",size:"16"}),e(ue,{activator:"parent",location:"top"},{default:t(()=>u[6]||(u[6]=[f(" Hapus ")])),_:1,__:[6]})]),_:2},1032,["onClick"])])]),i.items.indexOf(s)<i.items.length-1?(p(),C(M,{key:0,class:"mt-2"})):S("",!0)])}),128))])]),_:2},1024),e(ne,{class:"pt-0 px-4 pb-3"},{default:t(()=>[e(I,{variant:"outlined",color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:s=>U(i.product)},{default:t(()=>u[7]||(u[7]=[f(" Detail ")])),_:2,__:[7]},1032,["onClick"]),e(I,{variant:"tonal",color:"orange",size:"small","prepend-icon":"mdi-calculator-variant",onClick:s=>n.$emit("view-hpp",i.product)},{default:t(()=>u[8]||(u[8]=[f(" Setting HPP ")])),_:2,__:[8]},1032,["onClick"]),e(re),o("div",ht," Harga: "+m(g(i.product.price||0)),1)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),n.totalItems>n.itemsPerPage?(p(),V("div",Tt,[e(rt,{"model-value":n.currentPage,length:Math.ceil(n.totalItems/n.itemsPerPage),"onUpdate:modelValue":u[0]||(u[0]=i=>n.$emit("update:page",i))},null,8,["model-value","length"])])):S("",!0)])}}}),Lt=Ce(Ut,[["__scopeId","data-v-83596925"]]),Ft={key:0,class:"text-center py-8"},Kt={key:1},Nt={class:"mt-2"},zt={class:"text-h4 font-weight-bold"},At={key:0,class:"mb-6"},Et={class:"d-flex align-center gap-2"},Ot={class:"font-weight-medium"},Mt={class:"text-caption text-medium-emphasis"},qt={class:"text-end"},Bt={class:"font-weight-medium"},Ht={class:"text-end"},Rt={class:"font-weight-medium"},jt={class:"text-end"},Jt={class:"mt-6"},Wt={key:0},Yt={key:1},Zt={key:2},Qt={key:2},Xt=se({__name:"ProductionCapacityDialog",props:{dialog:{type:Boolean},loading:{type:Boolean},productionCapacity:{},selectedProduct:{}},emits:["update:dialog"],setup(J,{emit:q}){const k=J,D=q,T=j({get:()=>k.dialog,set:g=>D("update:dialog",g)}),K=[{title:"Item",value:"item_name",sortable:!1},{title:"Available",value:"available_stock",align:"end"},{title:"Needed/Unit",value:"needed_per_product",align:"end"},{title:"Can Produce",value:"can_produce",align:"end"},{title:"Status",value:"status",align:"center"}],P=g=>new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:2}).format(g),U=g=>g.can_produce===0?"tabler-alert-triangle":g.can_produce<5?"tabler-alert-circle":"tabler-check-circle",$=g=>g.can_produce===0?"error":g.can_produce<5?"warning":"success",b=g=>g.can_produce===0?"Out of Stock":g.can_produce<5?"Low Stock":"Sufficient";return(g,r)=>(p(),C(pe,{modelValue:T.value,"onUpdate:modelValue":r[2]||(r[2]=v=>T.value=v),persistent:"","max-width":"800px",scrollable:""},{default:t(()=>[e(F,null,{default:t(()=>[e(O,{class:"d-flex justify-space-between align-center"},{default:t(()=>[r[3]||(r[3]=o("span",{class:"text-h5"},"Production Capacity Analysis",-1)),e(I,{icon:"tabler-x",size:"small",variant:"text",onClick:r[0]||(r[0]=v=>T.value=!1)})]),_:1,__:[3]}),e(M),e(A,null,{default:t(()=>[g.loading?(p(),V("div",Ft,[e(Xe,{indeterminate:"",color:"primary",size:"64"}),r[4]||(r[4]=o("div",{class:"mt-4"},"Calculating production capacity...",-1))])):g.productionCapacity?(p(),V("div",Kt,[e(z,{color:g.productionCapacity.can_produce>0?"success":"error",variant:"tonal",class:"mb-6"},{default:t(()=>[e(R,null,{default:t(()=>{var v;return[f(m(((v=g.selectedProduct)==null?void 0:v.name)||"Product")+" - Production Capacity ",1)]}),_:1}),o("div",Nt,[o("div",zt,m(P(g.productionCapacity.can_produce))+" units ",1),r[5]||(r[5]=o("div",{class:"text-body-2"}," Maximum production with current inventory ",-1))])]),_:1},8,["color"]),g.productionCapacity.limiting_items.length>0?(p(),V("div",At,[e(O,{class:"px-0"},{default:t(()=>r[6]||(r[6]=[f("Limiting Factors")])),_:1,__:[6]}),e(z,{color:"warning",variant:"tonal",class:"mb-4"},{default:t(()=>[e(R,null,{default:t(()=>r[7]||(r[7]=[f("Production Limited By:")])),_:1,__:[7]}),e(st,{class:"mt-2"},{default:t(()=>[(p(!0),V(Q,null,X(g.productionCapacity.limiting_items,v=>(p(),C(E,{key:v,color:"warning",size:"small",variant:"tonal"},{default:t(()=>[f(m(v),1)]),_:2},1024))),128))]),_:1})]),_:1})])):S("",!0),e(O,{class:"px-0 mb-4"},{default:t(()=>r[8]||(r[8]=[f("Item Requirements Analysis")])),_:1,__:[8]}),e(dt,{headers:K,items:g.productionCapacity.details,"items-per-page":10,class:"elevation-1"},{"item.item_name":t(({item:v})=>[o("div",Et,[e(h,{icon:U(v),color:$(v),size:"20"},null,8,["icon","color"]),o("div",null,[o("div",Ot,m(v.item_name),1),o("div",Mt," ID: "+m(v.item_id),1)])])]),"item.available_stock":t(({item:v})=>[o("div",qt,[o("div",Bt,m(P(v.available_stock)),1),r[9]||(r[9]=o("div",{class:"text-caption text-medium-emphasis"},"Available",-1))])]),"item.needed_per_product":t(({item:v})=>[o("div",Ht,[o("div",Rt,m(P(v.needed_per_product)),1),r[10]||(r[10]=o("div",{class:"text-caption text-medium-emphasis"},"Per unit",-1))])]),"item.can_produce":t(({item:v})=>[o("div",jt,[e(E,{color:v.can_produce>=g.productionCapacity.can_produce?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[f(m(P(v.can_produce)),1)]),_:2},1032,["color"])])]),"item.status":t(({item:v})=>[e(E,{color:$(v),size:"small",variant:"tonal"},{default:t(()=>[f(m(b(v)),1)]),_:2},1032,["color"])]),_:1},8,["items"]),o("div",Jt,[e(O,{class:"px-0"},{default:t(()=>r[11]||(r[11]=[f("Recommendations")])),_:1,__:[11]}),g.productionCapacity.can_produce===0?(p(),V("div",Wt,[e(z,{color:"error",variant:"tonal"},{default:t(()=>[e(R,null,{default:t(()=>r[12]||(r[12]=[f("Cannot Produce")])),_:1,__:[12]}),r[13]||(r[13]=o("div",null,"One or more critical items are out of stock. Please restock the limiting items listed above.",-1))]),_:1,__:[13]})])):g.productionCapacity.can_produce<10?(p(),V("div",Yt,[e(z,{color:"warning",variant:"tonal"},{default:t(()=>[e(R,null,{default:t(()=>r[14]||(r[14]=[f("Low Production Capacity")])),_:1,__:[14]}),r[15]||(r[15]=o("div",null,"Consider restocking items to increase production capacity.",-1))]),_:1,__:[15]})])):(p(),V("div",Zt,[e(z,{color:"success",variant:"tonal"},{default:t(()=>[e(R,null,{default:t(()=>r[16]||(r[16]=[f("Good Production Capacity")])),_:1,__:[16]}),r[17]||(r[17]=o("div",null,"Sufficient inventory for production. Consider planning production batches.",-1))]),_:1,__:[17]})]))])])):(p(),V("div",Qt,[e(z,{color:"info",variant:"tonal"},{default:t(()=>[e(R,null,{default:t(()=>r[18]||(r[18]=[f("No Data Available")])),_:1,__:[18]}),r[19]||(r[19]=o("div",null,"Unable to calculate production capacity. Please ensure the product has items configured.",-1))]),_:1,__:[19]})]))]),_:1}),e(M),e(ne,{class:"pa-4"},{default:t(()=>[e(re),e(I,{color:"primary",variant:"outlined",onClick:r[1]||(r[1]=v=>T.value=!1)},{default:t(()=>r[20]||(r[20]=[f(" Close ")])),_:1,__:[20]})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Gt={class:"product-item-management"},ea={class:"d-flex justify-space-between align-center mb-6"},ta={class:"d-flex gap-3 align-center"},aa={class:"d-flex align-center"},la={class:"text-h5 font-weight-bold mb-2"},oa={class:"mb-3"},ia={class:"ml-2"},sa={class:"mb-3"},na={class:"ml-2"},ra={class:"mb-3"},da={class:"ml-2"},ua={class:"mb-3"},ma={class:"ml-2"},ca={key:0},pa={class:"mt-1 text-body-2"},fa={class:"mb-3"},ga={class:"ml-2 text-h6 text-primary"},_a={class:"mb-3"},va={class:"ml-2"},ka={class:"mb-3"},ya={class:"ml-2"},ba={class:"mb-3"},Ca={class:"ml-2"},Va={class:"d-flex align-center mt-1"},xa={class:"mr-4"},wa={key:1,class:"text-center py-8"},Da=se({__name:"product-items-management",setup(J){const q=tt(),{productItemsList:k,products:D,items:T,loading:K,saveLoading:P,deleteLoading:U,dialog:$,deleteDialog:b,capacityDialog:g,editMode:r,selectedProductItem:v,selectedProduct:ee,productionCapacity:te,currentPage:N,totalItems:n,itemsPerPage:u,filters:a,errorMessage:i,successMessage:s,modalErrorMessage:y,formData:L,canCreateEdit:W,productOptions:le,itemOptions:oe,fetchProductItemsList:we,fetchProducts:De,fetchItems:$e,saveProductItem:Se,deleteProductItem:Ie,openCreateDialog:Pe,openEditDialog:he,openDeleteDialog:Te,openCapacityDialog:Ue,onItemChange:Le,onPageChange:Fe,handleFiltersUpdate:H}=ut(),Y=ie(!1),x=ie(null),Ke=j(()=>!!(a.search||a.product_id||a.item_id||a.critical_only||a.stock_status||a.sort_by)),Ne=j(()=>{let _=0;return a.search&&_++,a.product_id&&_++,a.item_id&&_++,a.critical_only&&_++,a.stock_status&&_++,a.sort_by&&_++,_}),ze=()=>{a.search="",a.product_id=null,a.item_id=null,a.critical_only=!1,a.stock_status=null,a.sort_by=null,H()},de=_=>k.value.filter(l=>l.product_id===_),fe=_=>{if(!(_!=null&&_.inventory))return"grey";const l=_.inventory.current_stock||0,Z=_.min_stock||0;return l<=0?"error":l<=Z?"warning":"success"},Ae=_=>{if(!(_!=null&&_.inventory))return"Tidak ada data";const l=_.inventory.current_stock||0,Z=_.min_stock||0;return l<=0?"Habis":l<=Z?"Rendah":"Aman"},Ee=_=>{const l=fe(_);return{"text-error":l==="error","text-warning":l==="warning","text-success":l==="success","text-grey":l==="grey"}},Oe=async()=>{await Ie()},Me=_=>{he(_)},qe=_=>{Te(_)},Be=_=>{Ue(_)},He=_=>{q.push("/hpp-management")},Re=_=>{x.value=_,Y.value=!0};return Ge(async()=>{await Promise.all([De(),$e()]),await we()}),(_,l)=>{var Z,ge,_e,ve;return p(),V("div",Gt,[o("div",ea,[l[19]||(l[19]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold coffee-title"}," Komposisi Produk "),o("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"}," Kelola hubungan antara produk dan item yang dibutuhkan untuk produksi ")],-1)),o("div",ta,[d(W)?(p(),C(I,{key:0,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:d(Pe)},{default:t(()=>l[18]||(l[18]=[f(" Tambah Komposisi ")])),_:1,__:[18]},8,["onClick"])):S("",!0)])]),d(i)?(p(),C(z,{key:0,type:"error",variant:"outlined",class:"mb-4",text:d(i),closable:"","onClick:close":l[0]||(l[0]=c=>i.value="")},null,8,["text"])):S("",!0),d(s)?(p(),C(z,{key:1,type:"success",variant:"outlined",class:"mb-4",text:d(s),closable:"","onClick:close":l[1]||(l[1]=c=>s.value="")},null,8,["text"])):S("",!0),e(F,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(A,null,{default:t(()=>[e(B,null,{default:t(()=>[e(w,{cols:"12",md:"3"},{default:t(()=>[e(ce,{modelValue:d(a).search,"onUpdate:modelValue":[l[2]||(l[2]=c=>d(a).search=c),d(H)],label:"Cari Produk",placeholder:"Nama produk atau SKU...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(w,{cols:"12",md:"3"},{default:t(()=>[e(G,{modelValue:d(a).product_id,"onUpdate:modelValue":[l[3]||(l[3]=c=>d(a).product_id=c),d(H)],items:d(le),label:"Filter Produk",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),e(w,{cols:"12",md:"3"},{default:t(()=>[e(G,{modelValue:d(a).item_id,"onUpdate:modelValue":[l[4]||(l[4]=c=>d(a).item_id=c),d(H)],items:d(oe),label:"Filter Item",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),e(w,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(xe,{modelValue:d(a).critical_only,"onUpdate:modelValue":[l[5]||(l[5]=c=>d(a).critical_only=c),d(H)],label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1}),e(B,{class:"mt-3"},{default:t(()=>[e(w,{cols:"12",md:"3"},{default:t(()=>[e(G,{modelValue:d(a).stock_status,"onUpdate:modelValue":[l[6]||(l[6]=c=>d(a).stock_status=c),d(H)],items:[{title:"Semua Status",value:null},{title:"Stok Aman",value:"safe"},{title:"Stok Rendah",value:"low"},{title:"Stok Habis",value:"out"}],label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(w,{cols:"12",md:"3"},{default:t(()=>[e(G,{modelValue:d(a).sort_by,"onUpdate:modelValue":[l[7]||(l[7]=c=>d(a).sort_by=c),d(H)],items:[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Terbaru Dibuat",value:"created_desc"},{title:"Terlama Dibuat",value:"created_asc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"}],label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(w,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(I,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:ze},{default:t(()=>l[20]||(l[20]=[f(" Reset Filter ")])),_:1,__:[20]}),Ke.value?(p(),C(E,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[f(m(Ne.value)+" filter aktif ",1)]),_:1})):S("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(F,{elevation:"0",variant:"outlined"},{default:t(()=>[e(A,{class:"pa-0"},{default:t(()=>[e(Lt,{"product-items":d(k),loading:d(K),"current-page":d(N),"items-per-page":d(u),"total-items":d(n),products:d(D),items:d(T),onEdit:Me,onDelete:qe,onCheckCapacity:Be,onViewHpp:He,onViewDetail:Re,"onUpdate:page":d(Fe)},null,8,["product-items","loading","current-page","items-per-page","total-items","products","items","onUpdate:page"])]),_:1})]),_:1}),e(_t,{dialog:d($),"edit-mode":d(r),loading:d(P),"form-data":d(L),products:d(D),items:d(T),"error-message":d(y),onSave:d(Se),"onUpdate:dialog":l[8]||(l[8]=c=>$.value=c),"onUpdate:errorMessage":l[9]||(l[9]=c=>y.value=c),"onUpdate:formData":l[10]||(l[10]=c=>Object.assign(d(L),c)),onItemChange:d(Le)},null,8,["dialog","edit-mode","loading","form-data","products","items","error-message","onSave","onItemChange"]),e(Je,{modelValue:d(b),"onUpdate:modelValue":l[11]||(l[11]=c=>et(b)?b.value=c:null),loading:d(U),"item-name":`${(ge=(Z=d(v))==null?void 0:Z.product)==null?void 0:ge.name} - ${(ve=(_e=d(v))==null?void 0:_e.item)==null?void 0:ve.name}`||"","item-type":"komposisi",onConfirm:Oe,onCancel:l[12]||(l[12]=c=>b.value=!1)},null,8,["modelValue","loading","item-name"]),e(Xt,{dialog:d(g),"selected-product":d(ee),"production-capacity":d(te),loading:d(K),"onUpdate:dialog":l[13]||(l[13]=c=>g.value=c)},null,8,["dialog","selected-product","production-capacity","loading"]),e(pe,{modelValue:Y.value,"onUpdate:modelValue":l[17]||(l[17]=c=>Y.value=c),"max-width":"800",scrollable:""},{default:t(()=>[e(F,null,{default:t(()=>[e(O,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",aa,[e(h,{icon:"mdi-eye",class:"mr-2",color:"primary"}),l[21]||(l[21]=o("span",null,"Detail Produk",-1))]),e(I,{icon:"",variant:"text",onClick:l[14]||(l[14]=c=>Y.value=!1)},{default:t(()=>[e(h,{icon:"mdi-close"})]),_:1})]),_:1}),e(M),x.value?(p(),C(A,{key:0},{default:t(()=>[e(mt,null,{default:t(()=>[e(B,null,{default:t(()=>[e(w,{cols:"12"},{default:t(()=>[o("h2",la,m(x.value.name),1),e(E,{color:x.value.active?"success":"error",variant:"tonal",size:"small",class:"mb-4"},{default:t(()=>[f(m(x.value.active?"Aktif":"Tidak Aktif"),1)]),_:1},8,["color"])]),_:1})]),_:1}),e(B,null,{default:t(()=>[e(w,{cols:"12",md:"6"},{default:t(()=>[e(F,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(O,{class:"text-h6"},{default:t(()=>l[22]||(l[22]=[f(" Informasi Dasar ")])),_:1,__:[22]}),e(A,null,{default:t(()=>{var c;return[o("div",oa,[l[23]||(l[23]=o("strong",null,"SKU:",-1)),o("span",ia,m(x.value.sku||"-"),1)]),o("div",sa,[l[24]||(l[24]=o("strong",null,"Barcode:",-1)),o("span",na,m(x.value.barcode||"-"),1)]),o("div",ra,[l[25]||(l[25]=o("strong",null,"Brand:",-1)),o("span",da,m(x.value.brand||"-"),1)]),o("div",ua,[l[26]||(l[26]=o("strong",null,"Kategori:",-1)),o("span",ma,m(((c=x.value.category)==null?void 0:c.name)||"-"),1)]),x.value.description?(p(),V("div",ca,[l[27]||(l[27]=o("strong",null,"Deskripsi:",-1)),o("p",pa,m(x.value.description),1)])):S("",!0)]}),_:1})]),_:1})]),_:1}),e(w,{cols:"12",md:"6"},{default:t(()=>[e(F,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(O,{class:"text-h6"},{default:t(()=>l[28]||(l[28]=[f(" Harga & Stok ")])),_:1,__:[28]}),e(A,null,{default:t(()=>[o("div",fa,[l[29]||(l[29]=o("strong",null,"Harga Jual:",-1)),o("span",ga,"Rp "+m(Number(x.value.price||0).toLocaleString("id-ID")),1)]),o("div",_a,[l[30]||(l[30]=o("strong",null,"Harga Pokok:",-1)),o("span",va,"Rp "+m(Number(x.value.cost||0).toLocaleString("id-ID")),1)]),o("div",ka,[l[31]||(l[31]=o("strong",null,"Markup:",-1)),o("span",ya,m(x.value.markup_percentage||0)+"%",1)]),o("div",ba,[l[32]||(l[32]=o("strong",null,"Berat:",-1)),o("span",Ca,m(x.value.weight||"-")+" gram",1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(B,null,{default:t(()=>[e(w,{cols:"12"},{default:t(()=>[e(F,{variant:"outlined"},{default:t(()=>[e(O,{class:"text-h6"},{default:t(()=>[e(h,{icon:"mdi-format-list-bulleted",class:"mr-2"}),l[33]||(l[33]=f(" Komposisi Item "))]),_:1,__:[33]}),e(A,null,{default:t(()=>[de(x.value.id_product).length>0?(p(),C(lt,{key:0},{default:t(()=>[(p(!0),V(Q,null,X(de(x.value.id_product),(c,je)=>(p(),C(Ve,{key:c.id_product_item,class:"px-0"},{prepend:t(()=>[e(ct,{size:"40",color:"primary",variant:"tonal"},{default:t(()=>[e(h,{icon:"mdi-package-variant"})]),_:1})]),append:t(()=>[e(E,{color:fe(c.item),variant:"tonal",size:"small"},{default:t(()=>[f(m(Ae(c.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(ot,{class:"font-weight-medium"},{default:t(()=>{var ae;return[f(m(((ae=c.item)==null?void 0:ae.name)||"Unknown Item")+" ",1),c.is_critical?(p(),C(E,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>l[34]||(l[34]=[f(" Kritis ")])),_:1,__:[34]})):S("",!0)]}),_:2},1024),e(it,null,{default:t(()=>{var ae,ke,ye,be;return[o("div",Va,[e(h,{icon:"mdi-scale",size:"14",class:"mr-1"}),o("span",xa," Kebutuhan: "+m(Number(c.quantity_needed||0).toLocaleString("id-ID"))+" "+m((ae=c.item)==null?void 0:ae.unit),1),e(h,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),o("span",{class:me(Ee(c.item))}," Stok: "+m(Number(((ye=(ke=c.item)==null?void 0:ke.inventory)==null?void 0:ye.current_stock)||0).toLocaleString("id-ID"))+" "+m((be=c.item)==null?void 0:be.unit),3)])]}),_:2},1024),je<de(x.value.id_product).length-1?(p(),C(M,{key:0,class:"mt-3"})):S("",!0)]),_:2},1024))),128))]),_:1})):(p(),V("div",wa,[e(h,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),l[35]||(l[35]=o("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):S("",!0),e(M),e(ne,{class:"pa-4"},{default:t(()=>[e(re),e(I,{variant:"outlined",onClick:l[15]||(l[15]=c=>Y.value=!1)},{default:t(()=>l[36]||(l[36]=[f(" Tutup ")])),_:1,__:[36]}),e(I,{color:"primary",variant:"elevated","prepend-icon":"mdi-pencil",onClick:l[16]||(l[16]=()=>{Y.value=!1,d(q).push(`/products-management?edit=${x.value.id_product}`)})},{default:t(()=>l[37]||(l[37]=[f(" Edit Produk ")])),_:1,__:[37]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),al=Ce(Da,[["__scopeId","data-v-c2e9b2f3"]]);export{al as default};
