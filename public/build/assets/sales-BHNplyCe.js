import{d as ct,r as T,V as mt,D as _t,c as v,e as r,b as t,m as Re,a1 as me,f as l,ax as pt,g as M,l as $,X as y,au as Z,av as vt,j as yt,o as m,s as f,t as u,F as J,i as z,as as _e,a5 as ht,_ as gt}from"./main-24jsE5B8.js";import{C as ft}from"./auto-Cz6uSJnr.js";import{V as x,b as O}from"./VCard-81xWS9tH.js";import{V as C,a as p}from"./VRow-VuVxoIUW.js";import{V as w}from"./VCardText-Coho3Kj4.js";import{V as pe}from"./VSelect-DuX3cw0o.js";import{V as ee}from"./VTextField-DwGkqUgg.js";import{V as B}from"./VChip-CqH5M1on.js";import{V as bt}from"./VDivider-CEqkt4Xn.js";import{V as se}from"./VDataTable-BXi48pCg.js";import{b as Ie}from"./route-block-B_A1xBdJ.js";import"./VAvatar-Boabezwh.js";import"./VImg-BwGI18en.js";/* empty css              */import"./forwardRefs-B931MWyl.js";import"./VList-BZJmnVxE.js";import"./VOverlay-CFVhjsOG.js";import"./VMenu-u44_zTt1.js";import"./VCheckboxBtn-DuT5ftrk.js";import"./VTable-CNZWrnp_.js";import"./filter-aVFjFGO-.js";const xt={class:"sales-report-page"},wt={class:"d-flex flex-column flex-md-row justify-space-between align-start align-md-center mb-6 ga-4"},kt={class:"d-flex align-center mb-2"},Tt={key:0,class:"text-center py-8"},St={key:1},Dt={class:"text-h5 font-weight-bold text-purple"},Pt={class:"text-caption text-medium-emphasis mt-1"},At={class:"text-h5 font-weight-bold text-success"},Rt={class:"text-caption text-medium-emphasis mt-1"},It={class:"text-h5 font-weight-bold text-indigo"},Ot={class:"text-caption text-medium-emphasis mt-1"},Ct={key:0},Nt={class:"d-flex align-center"},Vt={class:"text-body-2"},Et={class:"text-end"},Ft={class:"text-body-2 font-weight-bold"},Mt={class:"text-caption text-medium-emphasis"},$t={key:1,class:"text-center py-4"},Ht={key:0},jt={class:"d-flex align-center"},Lt={class:"text-body-2 text-capitalize"},Jt={class:"text-end"},zt={class:"text-body-2 font-weight-bold"},Bt={class:"text-caption text-medium-emphasis"},Ut={key:1,class:"text-center py-4"},Kt={class:"text-h5 font-weight-bold text-success"},qt={key:0,class:"mt-1"},Gt={class:"text-h5 font-weight-bold text-primary"},Yt={class:"text-caption text-medium-emphasis mt-1"},Qt={class:"text-h5 font-weight-bold text-info"},Wt={class:"text-caption text-medium-emphasis mt-1"},Xt={class:"text-h5 font-weight-bold text-warning"},Zt={class:"text-caption text-medium-emphasis mt-1"},ea={key:0},ta={key:1,class:"text-center py-8"},aa={class:"top-products-container"},sa={class:"d-flex justify-space-between align-center"},la={class:"d-flex align-center"},oa={class:"font-weight-medium"},ra={class:"text-caption text-medium-emphasis"},na={class:"text-end"},ia={class:"font-weight-bold text-success"},ua={class:"font-weight-bold text-success"},da={class:"font-weight-bold text-success"},ca={class:"d-flex align-center gap-2"},ma={class:"font-weight-bold text-success"},_a={class:"text-body-2"},pa={key:0},va={class:"d-flex justify-space-between align-center"},ya={class:"d-flex align-center gap-2"},ha={class:"font-weight-medium"},ga={class:"text-end"},fa={class:"text-body-2 font-weight-bold"},ba={class:"text-caption text-success"},xa={key:1,class:"text-center py-4"},wa={key:0},ka={class:"d-flex justify-space-between align-center mb-1"},Ta={class:"d-flex align-center gap-2"},Sa={class:"font-weight-medium"},Da={class:"text-end"},Pa={class:"d-flex justify-space-between align-center"},Aa={class:"text-body-2"},Ra={class:"text-body-2 font-weight-bold text-success"},Ia={key:1,class:"text-center py-4"},Oa={class:"text-center"},Ca={class:"text-h6 font-weight-bold text-primary"},Na={class:"text-caption text-medium-emphasis mb-1"},Va={class:"text-body-2 font-weight-medium text-success"},Ea={class:"d-flex align-center gap-2"},Fa={class:"font-weight-medium"},Ma={class:"font-weight-bold"},$a={class:"font-weight-bold text-success"},Ha={class:"text-body-2"},ja={key:2,class:"text-center py-12"},Oe=ct({__name:"sales",setup(La){const Ce=yt(),j=T(!1),le=T(!1),o=T(null),U=T({total_sales:0,total_orders:0,avg_order_value:0}),K=T([]),q=T([]),g=T("today"),G=T(new Date().getFullYear()),k=T(""),S=T(""),D=T(""),N=T(""),V=T(""),oe=T(""),re=T();let ne=null;const Ne=[{title:"Hari Ini",value:"today"},{title:"Filter per Bulan",value:"month"},{title:"Custom Range",value:"custom"}],Ve=new Date().getFullYear(),Ee=Array.from({length:6},(s,e)=>Ve-e),Fe=mt(()=>{const s=G.value;return[{title:"Januari",value:`${s}-01`},{title:"Februari",value:`${s}-02`},{title:"Maret",value:`${s}-03`},{title:"April",value:`${s}-04`},{title:"Mei",value:`${s}-05`},{title:"Juni",value:`${s}-06`},{title:"Juli",value:`${s}-07`},{title:"Agustus",value:`${s}-08`},{title:"September",value:`${s}-09`},{title:"Oktober",value:`${s}-10`},{title:"November",value:`${s}-11`},{title:"Desember",value:`${s}-12`}]}),Me=[{title:"Customer",key:"name",align:"start"},{title:"Total Order",key:"orders",align:"center"},{title:"Total Belanja",key:"revenue",align:"end"},{title:"AOV",key:"avg_order",align:"end"}],$e=[{title:"Tanggal",key:"date",align:"start"},{title:"Pendapatan",key:"total",align:"end"}],He=[{title:"Kategori",key:"category",align:"start"},{title:"Order",key:"orders_count",align:"center"},{title:"Qty Terjual",key:"quantity_sold",align:"center"},{title:"Revenue",key:"revenue",align:"end"},{title:"Harga Rata2",key:"avg_price",align:"end"}],je=[{title:"No",key:"no",align:"start",sortable:!1},{title:"Nama Produk",key:"name",align:"start"},{title:"Jumlah Terjual",key:"quantity",align:"center"},{title:"Total Pendapatan",key:"revenue",align:"end"},{title:"Harga Rata-rata",key:"avg_price",align:"end"}],P=s=>{if(typeof s=="string"){if(s.trim().startsWith("Rp"))return s;const e=s.trim(),a=(e.match(/,/g)||[]).length,d=(e.match(/\./g)||[]).length;let h=0;a>0&&d>0?e.lastIndexOf(",")>e.lastIndexOf(".")?h=parseFloat(e.replace(/\./g,"").replace(/,/g,"."))||0:h=parseFloat(e.replace(/,/g,""))||0:d>1?h=parseFloat(e.replace(/\./g,""))||0:a>1?h=parseFloat(e.replace(/,/g,""))||0:a===1&&d===0?h=parseFloat(e.replace(/,/g,"."))||0:h=parseFloat(e)||0;const I=Math.round(h);return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(I)}return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)},Y=s=>new Date(s).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),Le=s=>["warning","success","info","secondary","primary"][s]||"primary",ve=s=>s.sort((e,a)=>a.order_count-e.order_count).slice(0,5),Je=(s,e)=>{const a=Math.max(...e.map(d=>d.order_count));return a>0?s/a*100:0},ze=(s,e)=>{const a=Math.max(...e.map(d=>d.order_count));return a>0?s/a*100:0},Be=s=>s>=6&&s<12?"mdi-weather-sunny":s>=12&&s<18?"mdi-weather-partly-cloudy":(s>=18&&s<22,"mdi-weather-night"),ye=s=>{switch(s==null?void 0:s.toLowerCase()){case"cash":case"tunai":return"mdi-cash";case"card":case"kartu":return"mdi-credit-card";case"digital":case"e-wallet":return"mdi-cellphone";case"transfer":return"mdi-bank-transfer";default:return"mdi-credit-card-outline"}},te=s=>{switch(s==null?void 0:s.toLowerCase()){case"cash":return"Tunai";case"card":return"Kartu";case"digital":return"Digital";case"transfer":return"Transfer";default:return s||"Lainnya"}},Ue=s=>{const e=["#1976D2","#388E3C","#F57C00","#7B1FA2","#D32F2F","#303F9F","#00796B","#F57F17","#5D4037","#616161"];return e[s%e.length]},Ke=s=>{const e=["#2E7D32","#1565C0","#E65100","#6A1B9A","#C62828","#283593","#00695C","#F9A825","#4E342E","#424242"];return e[s%e.length]},qe=()=>{var a,d,h;if(((d=(a=o.value)==null?void 0:a.summary)==null?void 0:d.daily_average_sales)!==void 0)return o.value.summary.daily_average_sales;if(!((h=o.value)!=null&&h.daily_sales)||!Array.isArray(o.value.daily_sales))return 0;const s=o.value.daily_sales.filter(I=>parseFloat(I.revenue)>0);return s.length===0?0:s.reduce((I,ae)=>I+(parseFloat(ae.revenue)||0),0)/s.length},Ge=()=>{var s,e,a;return((e=(s=o.value)==null?void 0:s.summary)==null?void 0:e.active_days_count)!==void 0?o.value.summary.active_days_count:!((a=o.value)!=null&&a.daily_sales)||!Array.isArray(o.value.daily_sales)?0:o.value.daily_sales.filter(d=>parseFloat(d.revenue)>0).length},he=()=>{if(g.value==="custom"&&S.value&&D.value)return`${Y(S.value)} - ${Y(D.value)}`;if(g.value==="today"){const s=new Date().toISOString().slice(0,10);return`${Y(s)}`}else if(g.value==="month"&&k.value){const[s,e]=k.value.split("-");return`${["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][parseInt(e)-1]} ${s}`}return g.value},Ye=()=>{if(g.value==="month")k.value=`${G.value}-${String(new Date().getMonth()+1).padStart(2,"0")}`;else if(g.value==="today"){const s=new Date().toISOString().slice(0,10);S.value=s,D.value=s}H()},Qe=()=>{const s=k.value.split("-")[1]||"01";k.value=`${G.value}-${s}`,H()},ge=()=>{(N.value&&V.value||!N.value&&!V.value)&&H()},fe=()=>{let s={};if(g.value==="custom")S.value&&D.value&&(s.start_date=S.value,s.end_date=D.value);else if(g.value==="month")k.value&&(s.month=k.value);else if(g.value==="today"){const e=new Date().toISOString().slice(0,10);s.start_date=e,s.end_date=e}return N.value&&V.value&&(s.hour_start=N.value,s.hour_end=V.value),s},We=()=>{const s={};if(g.value==="custom")S.value&&D.value&&(s.start_date=S.value,s.end_date=D.value);else if(k.value){const[e,a]=k.value.split("-"),d=new Date(Number(e),Number(a)-1,1),h=new Date(Number(e),Number(a),0);s.start_date=d.toISOString().slice(0,10),s.end_date=h.toISOString().slice(0,10)}return N.value&&V.value&&(s.hour_start=N.value,s.hour_end=V.value),s},H=async()=>{if(!j.value){j.value=!0;try{const s=fe();if(g.value==="custom"&&(!S.value||!D.value)){j.value=!1;return}if(g.value==="month"&&!k.value){j.value=!1;return}const e=await Z.get("/api/reports/sales",{params:s});if(e.data.success){o.value=e.data.data;const a=We();o.value&&o.value.summary&&(U.value={total_sales:o.value.summary.total_revenue||0,total_orders:o.value.summary.total_orders||0,avg_order_value:o.value.summary.average_order||0}),await Xe(a);const d=fe();await Ze(d),await et(d),await vt(),setTimeout(()=>{tt()},100)}}catch(s){console.error("Error loading sales report:",s)}finally{j.value=!1}}},Xe=async(s={})=>{try{const e=await Z.get("/api/dashboard/analytics",{params:s});if(e.data.success){const a=e.data.data.summary||{},d=a.today_sales||{},h=a.today_orders||{};U.value={total_sales:d.value||0,total_orders:h.value||0,avg_order_value:d.value&&h.value?Math.round(d.value/Math.max(1,h.value)):0};return}}catch(e){console.error("Error loading today sales:",e),U.value={total_sales:0,total_orders:0,avg_order_value:0}}},Ze=async(s={})=>{try{const e=await Z.get("/api/reports/payment-methods",{params:s});console.log("Payment Methods Response:",e.data),e.data.success?K.value=e.data.data.data||[]:K.value=[]}catch(e){console.error("Error loading payment method analytics:",e),K.value=[]}},et=async(s={})=>{try{const e=await Z.get("/api/reports/order-types",{params:s});console.log("Order Types Response:",e.data),e.data.success?q.value=e.data.data.data||[]:q.value=[]}catch(e){console.error("Error loading order type analytics:",e),q.value=[]}},tt=()=>{if(!re.value||!o.value)return;ne&&ne.destroy();const s=re.value.getContext("2d");if(!s)return;const e=o.value.daily_sales.map(d=>Y(d.date)),a=o.value.daily_sales.map(d=>{if(typeof d.total=="string"&&d.total.includes("Rp")){const h=d.total.replace(/\D/g,"");return parseInt(h,10)||0}return typeof d.total=="number"?d.total:0});ne=new ft(s,{type:"line",data:{labels:e,datasets:[{label:"Pendapatan Harian",data:a,borderColor:"rgb(76, 175, 80)",backgroundColor:"rgba(76, 175, 80, 0.1)",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:function(d){return P(d)}}}}}})},at=async()=>{var e,a,d,h,I,ae,be,xe;if(!o.value){console.warn("No data to export");return}le.value=!0;const s=c=>{if(!c&&c!==0)return"Rp 0";let b=0;try{if(typeof c=="string"&&c.includes("Rp")){const ie=c.replace(/\D/g,"");b=parseInt(ie,10)}else typeof c=="string"?b=parseFloat(c.replace(/[^\d.]/g,"")):typeof c=="number"&&(b=c);return(isNaN(b)||!isFinite(b)||b<0)&&(b=0),`Rp ${b.toLocaleString("id-ID").replace(/,/g,".")}`}catch{return"Rp 0"}};try{const c=await ht(()=>import("./xlsx-CfQreh1U.js"),[]);let b=[];try{let n={};g.value==="custom"?S.value&&D.value&&(n.start_date=S.value,n.end_date=D.value):k.value&&(n.month=k.value),N.value&&V.value&&(n.hour_start=N.value,n.hour_end=V.value),n.per_page=500,console.log("ðŸš€ Fetching transaction history (FAST MODE) with params:",n);const _=performance.now(),i=await Z.get("/api/pos/orders/history/export",{params:n,timeout:15e3}),E=Math.round(performance.now()-_);console.log(`âš¡ Transaction data loaded in ${E}ms`),console.log("Transaction response:",i.data),i.data&&i.data.data&&(b=Array.isArray(i.data.data)?i.data.data:[]),console.log(`âœ… Fetched ${b.length} transactions for export`)}catch(n){console.error("âŒ Failed to fetch transaction history:",n),n.code==="ECONNABORTED"&&console.warn("â±ï¸ Request timeout"),b=[]}const A=g.value==="custom"?`${S.value} s/d ${D.value}`:g.value==="month"?`Bulan ${k.value}`:`Hari Ini (${new Date().toLocaleDateString("id-ID")})`,ie=[["LAPORAN PENJUALAN ENHANCED"],["Periode:",A],["Tanggal Export:",new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})],[],["RINGKASAN PENJUALAN"],["Total Order:",o.value.summary.total_orders],["Total Pendapatan:",s(o.value.summary.total_revenue)],["Rata-rata Order (AOV):",s(o.value.summary.average_order)],["Total Item Terjual:",o.value.summary.total_items],["Order Selesai:",o.value.summary.completed_orders],["Order Dibatalkan:",o.value.summary.cancelled_orders],o.value.summary.growth_percentage!==void 0?["Growth vs Periode Sebelumnya:",`${o.value.summary.growth_percentage}%`]:[],[],["ANALISIS CUSTOMER"],["Customer Baru:",((e=o.value.customer_behavior)==null?void 0:e.new_customers)||0],["Returning Customer:",((a=o.value.customer_behavior)==null?void 0:a.returning_customers)||0],["One-time Customer:",((d=o.value.customer_behavior)==null?void 0:d.one_time_customers)||0],["Retention Rate:",`${((h=o.value.customer_behavior)==null?void 0:h.retention_rate)||0}%`],[]],R=c.utils.book_new(),we=c.utils.aoa_to_sheet(ie);if(we["!cols"]=[{wch:20},{wch:25}],c.utils.book_append_sheet(R,we,"Ringkasan"),o.value.daily_sales&&o.value.daily_sales.length>0){const n=[["PENJUALAN HARIAN"],["Periode:",A],[],["Tanggal","Total Penjualan"],...o.value.daily_sales.map(i=>[new Date(i.date).toLocaleDateString("id-ID"),s(i.total)])],_=c.utils.aoa_to_sheet(n);_["!cols"]=[{wch:15},{wch:20}],c.utils.book_append_sheet(R,_,"Penjualan Harian")}if(o.value.top_products&&o.value.top_products.length>0){const n=[["TOP 20 PRODUK TERLARIS"],["Periode:",A],[],["No","Nama Produk","Jumlah Terjual","Total Pendapatan","Harga Rata-rata"],...o.value.top_products.map((i,E)=>[E+1,i.name,i.quantity,s(i.revenue),i.avg_price||"-"])],_=c.utils.aoa_to_sheet(n);_["!cols"]=[{wch:5},{wch:30},{wch:15},{wch:20},{wch:18}],c.utils.book_append_sheet(R,_,"Top 20 Produk")}if(o.value.all_products&&o.value.all_products.length>0){const n=[["SEMUA PRODUK TERJUAL"],["Periode:",A],["Total Produk:",o.value.all_products.length],[],["No","Nama Produk","Jumlah Terjual","Total Pendapatan","Harga Rata-rata"],...o.value.all_products.map((i,E)=>[E+1,i.name,i.quantity,s(i.revenue),i.avg_price||"-"])],_=c.utils.aoa_to_sheet(n);_["!cols"]=[{wch:5},{wch:30},{wch:15},{wch:20},{wch:18}],c.utils.book_append_sheet(R,_,"Semua Produk")}if(o.value.top_customers&&o.value.top_customers.length>0){const n=[["CUSTOMER TERBAIK - ANALISIS LENGKAP"],["Periode:",A],[],["No","Nama Customer","Jumlah Order","Total Belanja","AOV","Customer Lifetime (hari)"],...o.value.top_customers.map((i,E)=>[E+1,i.name,i.orders,s(i.revenue),s(i.avg_order),i.customer_lifetime||0])],_=c.utils.aoa_to_sheet(n);_["!cols"]=[{wch:5},{wch:25},{wch:15},{wch:20},{wch:15},{wch:20}],c.utils.book_append_sheet(R,_,"Customer Analytics")}if(o.value.peak_hours&&o.value.peak_hours.length>0){const n=[["ANALISIS JAM RAMAI"],["Periode:",A],[],["Jam","Jumlah Order","Total Revenue","AOV"],...o.value.peak_hours.map(i=>[i.hour_display,i.order_count,s(i.revenue),s(i.avg_order)])],_=c.utils.aoa_to_sheet(n);_["!cols"]=[{wch:10},{wch:15},{wch:20},{wch:15}],c.utils.book_append_sheet(R,_,"Peak Hours")}if(o.value.sales_by_day&&o.value.sales_by_day.length>0){const n=[["ANALISIS PENJUALAN PER HARI"],["Periode:",A],[],["Hari","Jumlah Order","Total Revenue","AOV"],...o.value.sales_by_day.map(i=>[i.day_name,i.order_count,s(i.revenue),s(i.avg_order)])],_=c.utils.aoa_to_sheet(n);_["!cols"]=[{wch:15},{wch:15},{wch:20},{wch:15}],c.utils.book_append_sheet(R,_,"Sales by Day")}if(o.value.payment_methods&&o.value.payment_methods.length>0){const n=[["ANALISIS METODE PEMBAYARAN"],["Periode:",A],[],["Metode","Jumlah Order","Total Revenue","AOV","Persentase"],...o.value.payment_methods.map(i=>[te(i.method),i.order_count,s(i.revenue),s(i.avg_order),`${i.percentage}%`])],_=c.utils.aoa_to_sheet(n);_["!cols"]=[{wch:15},{wch:15},{wch:20},{wch:15},{wch:12}],c.utils.book_append_sheet(R,_,"Payment Methods")}if(o.value.category_performance&&o.value.category_performance.length>0){const n=[["PERFORMA KATEGORI PRODUK"],["Periode:",A],[],["Kategori","Order dengan Kategori","Qty Terjual","Total Revenue","Harga Rata-rata"],...o.value.category_performance.map(i=>[i.category,i.orders_count,i.quantity_sold,s(i.revenue),s(i.avg_price)])],_=c.utils.aoa_to_sheet(n);_["!cols"]=[{wch:20},{wch:18},{wch:15},{wch:20},{wch:18}],c.utils.book_append_sheet(R,_,"Category Performance")}console.log("ðŸ“Š Creating Transaction History Sheet with",b.length,"transactions");const st=["No","Order ID","Tanggal","Jam","Customer","Table","Tipe Order","Total","Pembayaran","Status"];let Q=0;b&&b.length>0&&b.forEach(n=>{var i;const _=((i=n.items)==null?void 0:i.length)||0;_>Q&&(Q=_)});const ke=[];for(let n=1;n<=Q;n++)ke.push(`Item ${n}`);const lt=[...st,...ke],ue=[["RIWAYAT TRANSAKSI"],["Periode:",A],[],lt];b&&b.length>0?b.forEach((n,_)=>{try{const i=n.order_date||n.created_at,E=new Date(i),rt=E.toLocaleDateString("id-ID"),nt=n.order_time?new Date(`2000-01-01 ${n.order_time}`).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}):E.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),it=n.customer_name||"Guest",ut=n.table_number||"-";let de="Dine In";n.order_type==="takeaway"?de="Takeaway":n.order_type==="delivery"&&(de="Delivery");let W="Cash";if(n.payment_methods){const L=n.payment_methods.split(",")[0];L==="qris"?W="QRIS":L==="debit"?W="Debit Card":L==="credit"?W="Credit Card":L==="transfer"&&(W="Transfer Bank")}let F=n.status||"pending";F==="completed"?F="Selesai":F==="cancelled"?F="Dibatalkan":F==="pending"?F="Pending":F==="processing"&&(F="Diproses");const ce=[_+1,n.order_number||n.id_order||n.id,rt,nt,it,ut,de,s(n.total_amount||n.total),W,F],Ae=n.items||[];for(let X=0;X<Q;X++)if(X<Ae.length){const L=Ae[X],dt=`${L.name} (${L.quantity}x)`;ce.push(dt)}else ce.push("");ue.push(ce)}catch(i){console.error("Error processing order:",n,i)}}):ue.push(["","Tidak ada data transaksi untuk periode ini"]);const Te=c.utils.aoa_to_sheet(ue),Se=[{wch:5},{wch:12},{wch:12},{wch:8},{wch:20},{wch:10},{wch:12},{wch:18},{wch:15},{wch:12}];for(let n=0;n<Q;n++)Se.push({wch:30});Te["!cols"]=Se,c.utils.book_append_sheet(R,Te,"Riwayat Transaksi"),console.log("âœ… Transaction History Sheet added to workbook");const ot=[["BUSINESS INSIGHTS & RECOMMENDATIONS"],["Periode:",A],[],["RINGKASAN PERFORMA"],["Growth Rate:",o.value.summary.growth_percentage!==void 0?`${o.value.summary.growth_percentage}%`:"N/A"],["Customer Retention:",`${((I=o.value.customer_behavior)==null?void 0:I.retention_rate)||0}%`],[],["TOP PERFORMERS"],["Jam Tersibuk:",o.value.peak_hours&&o.value.peak_hours.length>0?(ae=ve(o.value.peak_hours)[0])==null?void 0:ae.hour_display:"N/A"],["Hari Terbaik:",o.value.sales_by_day&&o.value.sales_by_day.length>0?(be=o.value.sales_by_day.sort((n,_)=>_.order_count-n.order_count)[0])==null?void 0:be.day_name:"N/A"],["Metode Bayar Favorit:",o.value.payment_methods&&o.value.payment_methods.length>0?te((xe=o.value.payment_methods[0])==null?void 0:xe.method):"N/A"],[],["REKOMENDASI BISNIS"],["1. Optimasi Operasional:","Focus staff scheduling pada jam dan hari ramai"],["2. Customer Retention:","Implementasi loyalty program untuk meningkatkan retention"],["3. Product Strategy:","Push produk top-selling dan evaluasi slow-moving items"],["4. Payment Strategy:","Optimalkan metode pembayaran yang paling disukai customer"],["5. Marketing Time:","Jalankan promosi saat jam dan hari dengan traffic rendah"]],De=c.utils.aoa_to_sheet(ot);De["!cols"]=[{wch:25},{wch:50}],c.utils.book_append_sheet(R,De,"Business Insights");const Pe=`laporan-penjualan-enhanced-analytics-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.xlsx`;c.writeFile(R,Pe),console.log("âœ… Enhanced Sales Analytics report exported successfully:",Pe)}catch(c){console.error("Error exporting sales report:",c)}finally{le.value=!1}};return _t(()=>{const s=new Date,e=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;if(g.value==="today"){const a=s.toISOString().slice(0,10);S.value=a,D.value=a}else g.value==="month"&&(k.value=e);H()}),(s,e)=>(m(),v("div",xt,[r("div",wt,[r("div",null,[r("div",kt,[t(me,{icon:"mdi-arrow-left",variant:"text",size:"small",onClick:e[0]||(e[0]=a=>Re(Ce).back()),class:"me-2"}),e[9]||(e[9]=r("h1",{class:"text-h4 font-weight-bold"},"Laporan Penjualan",-1))]),e[10]||(e[10]=r("p",{class:"text-body-1 text-medium-emphasis"}," Analisis lengkap penjualan dan performa produk ",-1))]),t(me,{color:"success","prepend-icon":"mdi-file-excel",onClick:at,loading:le.value},{default:l(()=>e[11]||(e[11]=[f(" Export Excel ")])),_:1,__:[11]},8,["loading"])]),t(x,{class:"mb-6"},{default:l(()=>[t(w,null,{default:l(()=>[t(C,null,{default:l(()=>[t(p,{cols:"12",md:"3"},{default:l(()=>[t(pe,{modelValue:g.value,"onUpdate:modelValue":[e[1]||(e[1]=a=>g.value=a),Ye],items:Ne,"item-title":"title","item-value":"value",label:"Pilih Periode",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),g.value==="month"?(m(),M(p,{key:0,cols:"12",md:"2"},{default:l(()=>[t(pe,{modelValue:G.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>G.value=a),Qe],items:Re(Ee),label:"Tahun",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1})):$("",!0),g.value==="custom"?(m(),M(p,{key:1,cols:"12",md:"3"},{default:l(()=>[t(ee,{modelValue:S.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>S.value=a),H],type:"date",label:"Tanggal Mulai",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})):$("",!0),g.value==="custom"?(m(),M(p,{key:2,cols:"12",md:"3"},{default:l(()=>[t(ee,{modelValue:D.value,"onUpdate:modelValue":[e[4]||(e[4]=a=>D.value=a),H],type:"date",label:"Tanggal Akhir",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})):$("",!0),g.value==="month"?(m(),M(p,{key:3,cols:"12",md:"3"},{default:l(()=>[t(pe,{modelValue:k.value,"onUpdate:modelValue":[e[5]||(e[5]=a=>k.value=a),H],items:Fe.value,"item-title":"title","item-value":"value",label:"Pilih Bulan",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1})):$("",!0),t(p,{cols:"12",md:"2"},{default:l(()=>[t(ee,{modelValue:N.value,"onUpdate:modelValue":[e[6]||(e[6]=a=>N.value=a),ge],type:"time",label:"Jam Mulai",variant:"outlined",density:"compact",clearable:""},{"prepend-inner":l(()=>[t(y,{icon:"mdi-clock-outline",size:"20"})]),_:1},8,["modelValue"])]),_:1}),t(p,{cols:"12",md:"2"},{default:l(()=>[t(ee,{modelValue:V.value,"onUpdate:modelValue":[e[7]||(e[7]=a=>V.value=a),ge],type:"time",label:"Jam Akhir",variant:"outlined",density:"compact",clearable:""},{"prepend-inner":l(()=>[t(y,{icon:"mdi-clock-outline",size:"20"})]),_:1},8,["modelValue"])]),_:1}),t(p,{cols:"12",md:"2"},{default:l(()=>[t(me,{color:"primary",block:"",onClick:H,loading:j.value},{default:l(()=>e[12]||(e[12]=[f(" Refresh ")])),_:1,__:[12]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),j.value?(m(),v("div",Tt,[t(pt,{indeterminate:"",color:"primary",size:"64"}),e[13]||(e[13]=r("p",{class:"text-body-1 mt-4"},"Memuat data laporan...",-1))])):o.value?(m(),v("div",St,[t(C,{class:"mb-6"},{default:l(()=>[t(p,{cols:"12",md:"4"},{default:l(()=>[t(x,null,{default:l(()=>[t(w,{class:"text-center"},{default:l(()=>[t(y,{icon:"mdi-calendar-today",size:"32",class:"text-purple mb-2"}),r("div",Dt,u(P(U.value.total_sales)),1),e[14]||(e[14]=r("div",{class:"text-body-2 text-medium-emphasis"},"Penjualan Hari Ini",-1)),r("div",Pt,u(U.value.total_orders)+" order | "+u(he()),1)]),_:1,__:[14]})]),_:1})]),_:1}),t(p,{cols:"12",md:"4"},{default:l(()=>[t(x,null,{default:l(()=>[t(w,{class:"text-center"},{default:l(()=>{var a,d,h,I;return[t(y,{icon:"mdi-filter-variant",size:"32",class:"text-success mb-2"}),r("div",At,u(P(((d=(a=o.value)==null?void 0:a.summary)==null?void 0:d.total_revenue)||0)),1),e[15]||(e[15]=r("div",{class:"text-body-2 text-medium-emphasis"},"Total Penjualan (Filter)",-1)),r("div",Rt,u(((I=(h=o.value)==null?void 0:h.summary)==null?void 0:I.total_orders)||0)+" order | "+u(he()),1)]}),_:1,__:[15]})]),_:1})]),_:1}),t(p,{cols:"12",md:"4"},{default:l(()=>[t(x,null,{default:l(()=>[t(w,{class:"text-center"},{default:l(()=>[t(y,{icon:"mdi-chart-bar",size:"32",class:"text-indigo mb-2"}),r("div",It,u(P(qe())),1),e[16]||(e[16]=r("div",{class:"text-body-2 text-medium-emphasis"},"Rata-rata Penjualan Harian",-1)),r("div",Ot," Per "+u(Ge())+" hari aktif ",1)]),_:1,__:[16]})]),_:1})]),_:1})]),_:1}),t(C,{class:"mb-6"},{default:l(()=>[t(p,{cols:"12",md:"6"},{default:l(()=>[t(x,null,{default:l(()=>[t(O,{class:"pb-2"},{default:l(()=>[t(y,{icon:"mdi-credit-card",class:"me-2"}),e[17]||(e[17]=f(" Metode Pembayaran "))]),_:1,__:[17]}),t(w,null,{default:l(()=>[K.value.length>0?(m(),v("div",Ct,[(m(!0),v(J,null,z(K.value,(a,d)=>(m(),v("div",{key:d,class:"d-flex justify-space-between align-center mb-3"},[r("div",Nt,[t(y,{icon:ye(a.payment_method),color:Ue(d),class:"me-2"},null,8,["icon","color"]),r("span",Vt,u(te(a.payment_method)),1)]),r("div",Et,[r("div",Ft,u(a.total_amount_formatted),1),r("div",Mt,u(a.order_count)+" order",1)])]))),128))])):(m(),v("div",$t,[t(y,{icon:"mdi-cash-off",size:"48",class:"text-grey-lighten-1 mb-2"}),e[18]||(e[18]=r("div",{class:"text-body-2 text-medium-emphasis"},"Tidak ada pembayaran hari ini",-1)),e[19]||(e[19]=r("div",{class:"text-h6 font-weight-bold text-grey"},"Rp 0",-1))]))]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",md:"6"},{default:l(()=>[t(x,null,{default:l(()=>[t(O,{class:"pb-2"},{default:l(()=>[t(y,{icon:"mdi-food",class:"me-2"}),e[20]||(e[20]=f(" Tipe Order "))]),_:1,__:[20]}),t(w,null,{default:l(()=>[q.value.length>0?(m(),v("div",Ht,[(m(!0),v(J,null,z(q.value,(a,d)=>(m(),v("div",{key:d,class:"d-flex justify-space-between align-center mb-3"},[r("div",jt,[t(y,{icon:"mdi-food",color:Ke(d),class:"me-2"},null,8,["color"]),r("span",Lt,u(a.order_type),1)]),r("div",Jt,[r("div",zt,u(a.total_amount_formatted),1),r("div",Bt,u(a.order_count)+" order",1)])]))),128))])):(m(),v("div",Ut,[t(y,{icon:"mdi-food-off",size:"48",class:"text-grey-lighten-1 mb-2"}),e[21]||(e[21]=r("div",{class:"text-body-2 text-medium-emphasis"},"Tidak ada pesanan hari ini",-1)),e[22]||(e[22]=r("div",{class:"text-h6 font-weight-bold text-grey"},"Rp 0",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),t(C,{class:"mb-6"},{default:l(()=>[t(p,{cols:"6",md:"3"},{default:l(()=>[t(x,null,{default:l(()=>[t(w,{class:"text-center"},{default:l(()=>[t(y,{icon:"mdi-currency-usd",size:"32",class:"text-success mb-2"}),r("div",Kt,u(P(o.value.summary.total_revenue)),1),e[23]||(e[23]=r("div",{class:"text-body-2 text-medium-emphasis"},"Total Pendapatan",-1)),o.value.summary.growth_percentage!==void 0?(m(),v("div",qt,[t(B,{color:o.value.summary.growth_percentage>=0?"success":"error",size:"x-small",variant:"tonal"},{default:l(()=>[f(u(o.value.summary.growth_percentage>=0?"+":"")+u(o.value.summary.growth_percentage)+"% ",1)]),_:1},8,["color"])])):$("",!0)]),_:1,__:[23]})]),_:1})]),_:1}),t(p,{cols:"6",md:"3"},{default:l(()=>[t(x,null,{default:l(()=>[t(w,{class:"text-center"},{default:l(()=>[t(y,{icon:"mdi-cart",size:"32",class:"text-primary mb-2"}),r("div",Gt,u(o.value.summary.total_orders),1),e[24]||(e[24]=r("div",{class:"text-body-2 text-medium-emphasis"},"Total Order",-1)),r("div",Yt," AOV: "+u(P(o.value.summary.average_order)),1)]),_:1,__:[24]})]),_:1})]),_:1}),t(p,{cols:"6",md:"3"},{default:l(()=>[t(x,null,{default:l(()=>[t(w,{class:"text-center"},{default:l(()=>[t(y,{icon:"mdi-package",size:"32",class:"text-info mb-2"}),r("div",Qt,u(o.value.summary.total_items),1),e[25]||(e[25]=r("div",{class:"text-body-2 text-medium-emphasis"},"Total Item",-1)),r("div",Wt,u(o.value.summary.completed_orders)+" selesai ",1)]),_:1,__:[25]})]),_:1})]),_:1}),t(p,{cols:"6",md:"3"},{default:l(()=>[t(x,null,{default:l(()=>[t(w,{class:"text-center"},{default:l(()=>{var a,d;return[t(y,{icon:"mdi-account-group",size:"32",class:"text-warning mb-2"}),r("div",Xt,u(((a=o.value.customer_behavior)==null?void 0:a.new_customers)||0),1),e[26]||(e[26]=r("div",{class:"text-body-2 text-medium-emphasis"},"Customer Baru",-1)),r("div",Zt," Retention: "+u(((d=o.value.customer_behavior)==null?void 0:d.retention_rate)||0)+"% ",1)]}),_:1,__:[26]})]),_:1})]),_:1})]),_:1}),t(C,{class:"mb-6"},{default:l(()=>[t(p,{cols:"12"},{default:l(()=>[t(x,null,{default:l(()=>[t(O,null,{default:l(()=>e[27]||(e[27]=[f("Trend Penjualan Harian")])),_:1,__:[27]}),t(w,null,{default:l(()=>[o.value&&o.value.daily_sales&&o.value.daily_sales.length>0?(m(),v("div",ea,[r("canvas",{ref_key:"dailySalesChart",ref:re,class:"w-100",style:{"max-height":"300px"}},null,512)])):(m(),v("div",ta,[t(y,{icon:"mdi-chart-line",size:"48",class:"text-medium-emphasis mb-2"}),e[28]||(e[28]=r("p",{class:"text-body-2 text-medium-emphasis"},"Tidak ada data penjualan harian",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),t(C,{class:"mb-6"},{default:l(()=>[t(p,{cols:"12",md:"4"},{default:l(()=>[t(x,null,{default:l(()=>[t(O,null,{default:l(()=>e[29]||(e[29]=[f("Top 5 Produk")])),_:1,__:[29]}),t(w,null,{default:l(()=>[r("div",aa,[(m(!0),v(J,null,z(o.value.top_products,(a,d)=>(m(),v("div",{key:a.id,class:"mb-3"},[r("div",sa,[r("div",la,[t(B,{color:Le(d),size:"small",class:"me-2"},{default:l(()=>[f(u(d+1),1)]),_:2},1032,["color"]),r("div",null,[r("div",oa,u(a.name),1),r("div",ra,u(a.quantity)+" terjual ",1)])]),r("div",na,[r("div",ia,u(P(a.revenue)),1)])]),d<o.value.top_products.length-1?(m(),M(bt,{key:0,class:"mt-3"})):$("",!0)]))),128))])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",md:"4"},{default:l(()=>[t(x,null,{default:l(()=>[t(O,null,{default:l(()=>e[30]||(e[30]=[f("Top Customer")])),_:1,__:[30]}),t(w,null,{default:l(()=>[t(se,{headers:Me,items:o.value.top_customers,"items-per-page":5,class:"elevation-0","no-data-text":"Tidak ada data customer"},{"item.orders":l(({item:a})=>[t(B,{size:"small",color:"primary",variant:"tonal"},{default:l(()=>[f(u(a.orders),1)]),_:2},1024)]),"item.revenue":l(({item:a})=>[r("span",ua,u(P(a.revenue)),1)]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",md:"4"},{default:l(()=>[t(x,null,{default:l(()=>[t(O,null,{default:l(()=>e[31]||(e[31]=[f("Penjualan per Hari")])),_:1,__:[31]}),t(w,null,{default:l(()=>[t(se,{headers:$e,items:o.value.daily_sales,"items-per-page":7,class:"elevation-0","no-data-text":"Tidak ada data penjualan"},{"item.date":l(({item:a})=>[f(u(Y(a.date)),1)]),"item.total":l(({item:a})=>[r("span",da,u(P(a.total)),1)]),_:1},8,["items"])]),_:1})]),_:1})]),_:1})]),_:1}),o.value.all_products&&o.value.all_products.length>0?(m(),M(C,{key:0,class:"mb-6"},{default:l(()=>[t(p,{cols:"12"},{default:l(()=>[t(x,null,{default:l(()=>[t(O,{class:"d-flex align-center justify-space-between"},{default:l(()=>[r("div",ca,[t(y,{icon:"mdi-package-variant"}),f(" Semua Produk Terjual ("+u(o.value.all_products.length)+" produk) ",1)]),t(ee,{modelValue:oe.value,"onUpdate:modelValue":e[8]||(e[8]=a=>oe.value=a),"prepend-inner-icon":"mdi-magnify",label:"Cari produk...",placeholder:"Ketik nama produk","single-line":"","hide-details":"",density:"compact",variant:"outlined",clearable:"",style:{"max-width":"300px"}},null,8,["modelValue"])]),_:1}),t(w,null,{default:l(()=>[t(se,{headers:je,items:o.value.all_products,search:oe.value,"items-per-page":10,class:"elevation-0","no-data-text":"Tidak ada data produk"},{"item.no":l(({index:a})=>[f(u(a+1),1)]),"item.quantity":l(({item:a})=>[t(B,{size:"small",color:"primary",variant:"tonal"},{default:l(()=>[f(u(a.quantity),1)]),_:2},1024)]),"item.revenue":l(({item:a})=>[r("span",ma,u(a.revenue),1)]),"item.avg_price":l(({item:a})=>[r("span",_a,u(a.avg_price),1)]),_:1},8,["items","search"])]),_:1})]),_:1})]),_:1})]),_:1})):$("",!0),t(C,{class:"mb-6"},{default:l(()=>[t(p,{cols:"12",md:"6"},{default:l(()=>[t(x,null,{default:l(()=>[t(O,{class:"d-flex align-center gap-2"},{default:l(()=>[t(y,{icon:"mdi-clock-outline"}),e[32]||(e[32]=f(" Jam Ramai (Peak Hours) "))]),_:1,__:[32]}),t(w,null,{default:l(()=>[o.value.peak_hours&&o.value.peak_hours.length>0?(m(),v("div",pa,[(m(!0),v(J,null,z(ve(o.value.peak_hours),a=>(m(),v("div",{key:a.hour,class:"mb-2"},[r("div",va,[r("div",ya,[t(y,{icon:Be(a.hour),size:"16"},null,8,["icon"]),r("span",ha,u(a.hour_display),1)]),r("div",ga,[r("div",fa,u(a.order_count)+" order",1),r("div",ba,u(P(a.revenue)),1)])]),t(_e,{"model-value":Je(a.order_count,o.value.peak_hours),color:"primary",height:"4",class:"mt-1"},null,8,["model-value"])]))),128))])):(m(),v("div",xa,e[33]||(e[33]=[r("p",{class:"text-body-2 text-medium-emphasis"},"Tidak ada data jam ramai",-1)])))]),_:1})]),_:1})]),_:1}),t(p,{cols:"12",md:"6"},{default:l(()=>[t(x,null,{default:l(()=>[t(O,{class:"d-flex align-center gap-2"},{default:l(()=>[t(y,{icon:"mdi-credit-card-outline"}),e[34]||(e[34]=f(" Metode Pembayaran "))]),_:1,__:[34]}),t(w,null,{default:l(()=>[o.value.payment_methods&&o.value.payment_methods.length>0?(m(),v("div",wa,[(m(!0),v(J,null,z(o.value.payment_methods,a=>(m(),v("div",{key:a.method,class:"mb-3"},[r("div",ka,[r("div",Ta,[t(y,{icon:ye(a.method),size:"16"},null,8,["icon"]),r("span",Sa,u(te(a.method)),1)]),r("div",Da,[t(B,{size:"small",color:"primary",variant:"tonal"},{default:l(()=>[f(u(a.percentage)+"% ",1)]),_:2},1024)])]),r("div",Pa,[r("span",Aa,u(a.order_count)+" transaksi",1),r("span",Ra,u(P(a.revenue)),1)]),t(_e,{"model-value":a.percentage,color:"success",height:"4",class:"mt-1"},null,8,["model-value"])]))),128))])):(m(),v("div",Ia,e[35]||(e[35]=[r("p",{class:"text-body-2 text-medium-emphasis"},"Tidak ada data metode pembayaran",-1)])))]),_:1})]),_:1})]),_:1})]),_:1}),o.value.sales_by_day&&o.value.sales_by_day.length>0?(m(),M(C,{key:1,class:"mb-6"},{default:l(()=>[t(p,{cols:"12"},{default:l(()=>[t(x,null,{default:l(()=>[t(O,{class:"d-flex align-center gap-2"},{default:l(()=>[t(y,{icon:"mdi-calendar-week"}),e[36]||(e[36]=f(" Performa Penjualan per Hari "))]),_:1,__:[36]}),t(w,null,{default:l(()=>[t(C,null,{default:l(()=>[(m(!0),v(J,null,z(o.value.sales_by_day,a=>(m(),M(p,{key:a.day_name,cols:"6",md:"1.7"},{default:l(()=>[r("div",Oa,[r("div",Ca,u(a.order_count),1),r("div",Na,u(a.day_name),1),r("div",Va,u(P(a.revenue)),1),t(_e,{"model-value":ze(a.order_count,o.value.sales_by_day),color:"primary",height:"3",class:"mt-1"},null,8,["model-value"])])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):$("",!0),o.value.category_performance&&o.value.category_performance.length>0?(m(),M(C,{key:2,class:"mb-6"},{default:l(()=>[t(p,{cols:"12"},{default:l(()=>[t(x,null,{default:l(()=>[t(O,{class:"d-flex align-center gap-2"},{default:l(()=>[t(y,{icon:"mdi-shape-outline"}),e[37]||(e[37]=f(" Performa Kategori Produk "))]),_:1,__:[37]}),t(w,null,{default:l(()=>[t(se,{headers:He,items:o.value.category_performance,"items-per-page":10,class:"elevation-0","no-data-text":"Tidak ada data kategori"},{"item.category":l(({item:a})=>[r("div",Ea,[t(y,{icon:"mdi-tag",size:"16",color:"primary"}),r("span",Fa,u(a.category),1)])]),"item.orders_count":l(({item:a})=>[t(B,{size:"small",color:"info",variant:"tonal"},{default:l(()=>[f(u(a.orders_count),1)]),_:2},1024)]),"item.quantity_sold":l(({item:a})=>[r("span",Ma,u(a.quantity_sold),1)]),"item.revenue":l(({item:a})=>[r("span",$a,u(P(a.revenue)),1)]),"item.avg_price":l(({item:a})=>[r("span",Ha,u(P(a.avg_price)),1)]),_:1},8,["items"])]),_:1})]),_:1})]),_:1})]),_:1})):$("",!0)])):(m(),v("div",ja,[t(y,{icon:"mdi-chart-line-variant",size:"64",class:"text-medium-emphasis mb-4"}),e[38]||(e[38]=r("h3",{class:"text-h6 mb-2"},"Tidak ada data laporan",-1)),e[39]||(e[39]=r("p",{class:"text-body-2 text-medium-emphasis"}," Silakan pilih periode yang berbeda atau periksa kembali filter Anda ",-1))]))]))}});typeof Ie=="function"&&Ie(Oe);const ds=gt(Oe,[["__scopeId","data-v-698a0465"]]);export{ds as default};
