import{_ as G,c as d,e as t,b as f,s as B,X as v,t as a,H as D,cu as I,F as S,i as N,l as q,a as H,ay as O,V as E,r as j,az as X,D as J,o as l,v as U}from"./main-BijUd6T-.js";import K from"./CompositionModal-DxXhrvax.js";import{u as Q}from"./baseProduct-DhXNdRGc.js";import"./VDialog-Gxx-FZyb.js";import"./VOverlay-DKEOQQcg.js";import"./forwardRefs-B931MWyl.js";import"./VImg-CKFZa8w1.js";import"./VCard-CMT1c5nk.js";import"./VAvatar-DgN_TwIn.js";import"./VCardText-DbpZjpmZ.js";import"./api-BAVwcYA_.js";import"./index-D-EbNoF1.js";import"./CategoriesApi-BqhiV-Lj.js";const R={name:"ProductCompositionsManagement",components:{CompositionModal:K},setup(){const m=Q(),{showSuccess:o,showError:A}=O(),s=E(()=>m.loading),F=E(()=>m.compositions),x=E(()=>m.pagination),y=j([]),e=j([]),p=j(!1),i=j(null),b=X({product_id:"",base_product_id:"",is_active:""}),h=E(()=>{const n={};return F.value.forEach(r=>{var g;const c=((g=r.product)==null?void 0:g.name)||"Unknown Product";n[c]||(n[c]=[]),n[c].push(r)}),n}),u=async(n=1)=>{try{const r={page:n,per_page:x.value.per_page,...b};Object.keys(r).forEach(c=>{(r[c]===""||r[c]===null||r[c]===void 0)&&delete r[c]}),await m.fetchCompositions(r)}catch(r){console.error("Error loading compositions:",r),A("Failed to load compositions")}},w=async()=>{try{const n=await m.fetchProducts();y.value=n.data}catch(n){console.error("Error loading products:",n)}},C=async()=>{try{const n=await m.fetchAvailableBaseProducts();e.value=n.data}catch(n){console.error("Error loading base products:",n)}},k=n=>{n>=1&&n<=x.value.last_page&&u(n)},P=()=>{i.value=null,p.value=!0},M=n=>{i.value=n,p.value=!0},_=()=>{p.value=!1,i.value=null},V=()=>{_(),u(x.value.current_page),o("Composition saved successfully")},z=async n=>{var r,c;if(confirm("Are you sure you want to delete this composition?"))try{await m.deleteComposition(n.id_composition),o("Composition deleted successfully"),u(x.value.current_page)}catch(g){console.error("Error deleting composition:",g),A(((c=(r=g.response)==null?void 0:r.data)==null?void 0:c.message)||"Failed to delete composition")}},L=(n,r)=>{const c=parseFloat(n)||0,g=parseFloat(r)||0;return c>=g?"text-green-600":c>0?"text-yellow-600":"text-red-600"},T=n=>new Intl.NumberFormat("id-ID",{minimumFractionDigits:0,maximumFractionDigits:3}).format(n||0);return J(()=>{u(),w(),C()}),{loading:s,compositions:F,products:y,baseProducts:e,showModal:p,selectedComposition:i,filters:b,pagination:x,groupedCompositions:h,loadCompositions:u,changePage:k,openCreateModal:P,openEditModal:M,closeModal:_,handleSaved:V,deleteComposition:z,getStockStatusClass:L,formatNumber:T}}},W={class:"product-compositions-management"},Y={class:"bg-white shadow"},Z={class:"px-4 sm:px-6 lg:max-w-6xl lg:mx-auto lg:px-8"},$={class:"py-6 md:flex md:items-center md:justify-between lg:border-t lg:border-gray-200"},tt={class:"flex-1 min-w-0"},ot={class:"flex items-center"},st={class:"mt-6 flex flex-col sm:ml-3 sm:mt-1 sm:flex-row sm:flex-wrap"},et={class:"flex items-center text-sm text-gray-500 font-medium capitalize sm:mr-6"},nt={class:"mt-6 flex space-x-3 md:mt-0 md:ml-4"},it={class:"bg-white shadow mb-6"},at={class:"px-4 sm:px-6 lg:max-w-6xl lg:mx-auto lg:px-8 py-4"},rt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},dt=["value"],lt=["value"],ct={class:"px-4 sm:px-6 lg:max-w-6xl lg:mx-auto lg:px-8"},mt={key:0,class:"text-center py-12"},ut={key:1,class:"text-center py-12"},pt={class:"mt-6"},gt={key:2,class:"space-y-6"},xt={class:"px-4 py-5 sm:px-6 bg-gray-50"},ft={class:"text-lg leading-6 font-medium text-gray-900"},bt={class:"mt-1 max-w-2xl text-sm text-gray-500"},_t={class:"border-t border-gray-200"},vt={class:"text-sm font-medium text-gray-500 flex items-center"},yt=["src","alt"],ht={key:1,class:"h-8 w-8 rounded bg-gray-200 flex items-center justify-center mr-3"},wt={class:"font-medium"},Ct={class:"text-xs text-gray-400"},kt={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-1"},Pt={class:"flex items-center justify-between"},Mt={class:"font-medium"},St={class:"text-xs text-gray-500"},Nt={class:"text-right"},Et={class:"text-sm font-medium text-gray-900"},jt={class:"mt-2"},At={class:"flex items-center justify-between text-xs"},Ft={class:"flex items-center justify-between text-xs"},Vt={class:"font-medium text-gray-900"},Bt={class:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-1 flex items-center justify-end space-x-2"},Dt={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"},It=["onClick"],qt=["onClick"],Ut={key:0,class:"bg-white px-4 py-3 border-t border-gray-200 sm:px-6"},zt={class:"flex justify-between items-center"},Lt={class:"text-sm text-gray-700"},Tt={class:"flex space-x-2"},Gt=["disabled"],Ht=["disabled"];function Ot(m,o,A,s,F,x){const y=H("CompositionModal");return l(),d("div",W,[t("div",Y,[t("div",Z,[t("div",$,[t("div",tt,[t("div",ot,[t("div",null,[o[11]||(o[11]=t("div",{class:"flex items-center"},[t("h1",{class:"ml-3 text-2xl font-bold leading-7 text-gray-900 sm:leading-9 sm:truncate"}," Product Compositions ")],-1)),t("dl",st,[o[10]||(o[10]=t("dt",{class:"sr-only"},"Total",-1)),t("dd",et,[f(v,{icon:"tabler-check",class:"flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400"}),B(" "+a(s.pagination.total||0)+" compositions ",1)])])])])]),t("div",nt,[t("button",{onClick:o[0]||(o[0]=(...e)=>s.openCreateModal&&s.openCreateModal(...e)),type:"button",class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[f(v,{icon:"tabler-plus",class:"-ml-1 mr-2 h-5 w-5"}),o[12]||(o[12]=B(" Add Composition "))])])])])]),t("div",it,[t("div",at,[t("div",rt,[t("div",null,[o[14]||(o[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"Product",-1)),D(t("select",{"onUpdate:modelValue":o[1]||(o[1]=e=>s.filters.product_id=e),onChange:o[2]||(o[2]=(...e)=>s.loadCompositions&&s.loadCompositions(...e)),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},[o[13]||(o[13]=t("option",{value:""},"All Products",-1)),(l(!0),d(S,null,N(s.products,e=>(l(),d("option",{key:e.id_product,value:e.id_product},a(e.name),9,dt))),128))],544),[[I,s.filters.product_id]])]),t("div",null,[o[16]||(o[16]=t("label",{class:"block text-sm font-medium text-gray-700"},"Base Product",-1)),D(t("select",{"onUpdate:modelValue":o[3]||(o[3]=e=>s.filters.base_product_id=e),onChange:o[4]||(o[4]=(...e)=>s.loadCompositions&&s.loadCompositions(...e)),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},[o[15]||(o[15]=t("option",{value:""},"All Base Products",-1)),(l(!0),d(S,null,N(s.baseProducts,e=>(l(),d("option",{key:e.id_base_product,value:e.id_base_product},a(e.name),9,lt))),128))],544),[[I,s.filters.base_product_id]])]),t("div",null,[o[18]||(o[18]=t("label",{class:"block text-sm font-medium text-gray-700"},"Status",-1)),D(t("select",{"onUpdate:modelValue":o[5]||(o[5]=e=>s.filters.is_active=e),onChange:o[6]||(o[6]=(...e)=>s.loadCompositions&&s.loadCompositions(...e)),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},o[17]||(o[17]=[t("option",{value:""},"All",-1),t("option",{value:"true"},"Active",-1),t("option",{value:"false"},"Inactive",-1)]),544),[[I,s.filters.is_active]])])])])]),t("div",ct,[s.loading?(l(),d("div",mt,o[19]||(o[19]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1),t("p",{class:"mt-2 text-sm text-gray-500"},"Loading compositions...",-1)]))):s.compositions.length?(l(),d("div",gt,[(l(!0),d(S,null,N(s.groupedCompositions,(e,p)=>(l(),d("div",{key:p,class:"bg-white shadow overflow-hidden sm:rounded-lg"},[t("div",xt,[t("h3",ft,a(p),1),t("p",bt,a(e.length)+" base product"+a(e.length!==1?"s":"")+" composition ",1)]),t("div",_t,[t("dl",null,[(l(!0),d(S,null,N(e,(i,b)=>{var h,u,w,C,k,P,M,_;return l(),d("div",{key:i.id_composition,class:U([{"bg-gray-50":b%2===0,"bg-white":b%2!==0},"px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"])},[t("dt",vt,[(h=i.base_product)!=null&&h.image_url?(l(),d("img",{key:0,src:i.base_product.image_url,alt:i.base_product.name,class:"h-8 w-8 rounded object-cover mr-3"},null,8,yt)):(l(),d("div",ht,[f(v,{icon:"tabler-package",class:"h-4 w-4 text-gray-400"})])),t("div",null,[t("p",wt,a((u=i.base_product)==null?void 0:u.name),1),t("p",Ct,a((w=i.base_product)==null?void 0:w.sku),1)])]),t("dd",kt,[t("div",Pt,[t("div",null,[t("p",Mt,a(s.formatNumber(i.quantity))+" "+a((C=i.base_product)==null?void 0:C.unit),1),t("p",St,"per 1 "+a((k=i.product)==null?void 0:k.name),1)]),t("div",Nt,[t("p",Et,a(i.formatted_cost_per_unit),1),o[23]||(o[23]=t("p",{class:"text-xs text-gray-500"},"Cost contribution",-1))])]),t("div",jt,[t("div",At,[o[24]||(o[24]=t("span",{class:"text-gray-500"},"Available stock:",-1)),t("span",{class:U([s.getStockStatusClass((P=i.base_product)==null?void 0:P.current_stock,i.quantity),"font-medium"])},a(s.formatNumber(((M=i.base_product)==null?void 0:M.current_stock)||0))+" "+a((_=i.base_product)==null?void 0:_.unit),3)]),t("div",Ft,[o[25]||(o[25]=t("span",{class:"text-gray-500"},"Can produce:",-1)),t("span",Vt,a(s.formatNumber(i.max_producible_quantity))+" units ",1)])])]),t("dd",Bt,[i.is_active?q("",!0):(l(),d("span",Dt," Inactive ")),t("button",{onClick:V=>s.openEditModal(i),class:"text-indigo-600 hover:text-indigo-900 text-sm font-medium"}," Edit ",8,It),t("button",{onClick:V=>s.deleteComposition(i),class:"text-red-600 hover:text-red-900 text-sm font-medium"}," Delete ",8,qt)])],2)}),128))])])]))),128)),s.pagination.last_page>1?(l(),d("div",Ut,[t("div",zt,[t("div",Lt," Showing "+a(s.pagination.from)+" to "+a(s.pagination.to)+" of "+a(s.pagination.total)+" results ",1),t("div",Tt,[t("button",{onClick:o[8]||(o[8]=e=>s.changePage(s.pagination.current_page-1)),disabled:s.pagination.current_page===1,class:"px-3 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed"}," Previous ",8,Gt),t("button",{onClick:o[9]||(o[9]=e=>s.changePage(s.pagination.current_page+1)),disabled:s.pagination.current_page===s.pagination.last_page,class:"px-3 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed"}," Next ",8,Ht)])])])):q("",!0)])):(l(),d("div",ut,[f(v,{icon:"tabler-assembly",class:"mx-auto h-12 w-12 text-gray-400"}),o[21]||(o[21]=t("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No compositions",-1)),o[22]||(o[22]=t("p",{class:"mt-1 text-sm text-gray-500"},"Get started by creating a product composition.",-1)),t("div",pt,[t("button",{onClick:o[7]||(o[7]=(...e)=>s.openCreateModal&&s.openCreateModal(...e)),type:"button",class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700"},[f(v,{icon:"tabler-plus",class:"-ml-1 mr-2 h-5 w-5"}),o[20]||(o[20]=B(" Add Composition "))])])]))]),f(y,{show:s.showModal,composition:s.selectedComposition,products:s.products,"base-products":s.baseProducts,onClose:s.closeModal,onSaved:s.handleSaved},null,8,["show","composition","products","base-products","onClose","onSaved"])])}const no=G(R,[["render",Ot]]);export{no as default};
