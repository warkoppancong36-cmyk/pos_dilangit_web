import{d as ot,r as g,D as nt,c as h,e as o,b as e,m as it,a1 as B,f as a,ax as rt,X as T,au as ut,av as dt,j as ct,o as d,s as p,g as C,l as O,t as u,F as H,i as U,as as mt,a5 as pt,_ as _t}from"./main-BSot2PSW.js";import{C as ft}from"./auto-Cz6uSJnr.js";import{V as v,b as I}from"./VCard-CntLK-da.js";import{V as A,a as c}from"./VRow-B8J-UV2y.js";import{V as y}from"./VCardText-gLuGfMFN.js";import{V as J}from"./VSelect-C_bH1oM6.js";import{V as j}from"./VTextField-wWXOwPK2.js";import{V as E}from"./VChip-CC_Yj0AV.js";import{V as K}from"./VDataTable-CtHXI7Es.js";import{V as ht}from"./VDivider-D7aBqlnY.js";import{b as Y}from"./route-block-B_A1xBdJ.js";import"./VAvatar-BwNGwouH.js";import"./VImg-Bfn9cTMg.js";/* empty css              */import"./forwardRefs-B931MWyl.js";import"./VList-Cx_N5rQy.js";import"./VOverlay-DXY5RMM5.js";import"./VMenu-DU4op0ll.js";import"./VCheckboxBtn-4fnD8q4v.js";import"./VTable-6uBVkQOk.js";import"./filter-eM4tYQUF.js";const vt={class:"purchase-report-page"},yt={class:"d-flex flex-column flex-md-row justify-space-between align-start align-md-center mb-6 ga-4"},gt={class:"d-flex align-center mb-2"},bt={key:0,class:"text-center py-8"},xt={key:1},wt={class:"text-h5 font-weight-bold text-primary"},kt={class:"text-h5 font-weight-bold text-success"},Pt={class:"text-h5 font-weight-bold text-info"},Dt={class:"text-h5 font-weight-bold text-warning"},Tt={key:0},Vt={key:1,class:"text-center py-8"},St={class:"d-flex justify-space-between align-center mb-1"},It={class:"d-flex align-center"},At={class:"text-caption"},Ct={class:"font-weight-bold"},Et={class:"font-weight-bold text-primary"},Nt={class:"top-items-container"},Rt={class:"d-flex justify-space-between align-center"},Lt={class:"d-flex align-center"},$t={class:"font-weight-medium"},Bt={class:"text-caption text-medium-emphasis"},Mt={class:"text-end"},Ft={class:"font-weight-bold text-primary"},zt={class:"font-weight-bold text-primary"},Ot={key:2,class:"text-center py-12"},X=ot({__name:"purchases",setup(Ht){const G=ct(),b=g(!1),N=g(!1),s=g(null),x=g("month"),w=g(""),V=g(""),S=g(""),R=g();let L=null;const W=[{title:"Filter per Bulan",value:"month"},{title:"Custom Range",value:"custom"}],m=new Date().getFullYear(),Z=[{title:"Januari",value:`${m}-01`},{title:"Februari",value:`${m}-02`},{title:"Maret",value:`${m}-03`},{title:"April",value:`${m}-04`},{title:"Mei",value:`${m}-05`},{title:"Juni",value:`${m}-06`},{title:"Juli",value:`${m}-07`},{title:"Agustus",value:`${m}-08`},{title:"September",value:`${m}-09`},{title:"Oktober",value:`${m}-10`},{title:"November",value:`${m}-11`},{title:"Desember",value:`${m}-12`}],q=[{title:"Supplier",key:"name",align:"start"},{title:"Total Purchase",key:"total_purchases",align:"center"},{title:"Total Amount",key:"total_amount",align:"end"}],Q=[{title:"Tanggal",key:"date",align:"start"},{title:"Purchase",key:"purchase_count",align:"center"},{title:"Total Amount",key:"total_amount",align:"end"}],k=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),M=n=>new Date(n).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),F=n=>({pending:"warning",approved:"info",received:"success",cancelled:"error"})[n.toLowerCase()]||"primary",tt=n=>["warning","success","info","secondary","primary"][n]||"primary",et=()=>{if(x.value==="month"){const n=new Date().toISOString().slice(0,7);w.value=n}D()},D=async()=>{if(!b.value){b.value=!0;try{let n={};if(x.value==="custom")if(V.value&&S.value)n.start_date=V.value,n.end_date=S.value;else{b.value=!1;return}else if(w.value)n.month=w.value;else{b.value=!1;return}const t=await ut.get("/api/reports/purchases",{params:n});t.data.success&&(s.value=t.data.data,await dt(),setTimeout(()=>{at()},100))}catch(n){console.error("Error loading purchase report:",n)}finally{b.value=!1}}},at=()=>{if(!R.value||!s.value)return;L&&L.destroy();const n=R.value.getContext("2d");if(!n)return;const t=s.value.daily_purchases.map(i=>M(i.date)),l=s.value.daily_purchases.map(i=>{if(typeof i.total_amount=="string"&&i.total_amount.includes("Rp")){const f=i.total_amount.replace(/\D/g,"");return parseInt(f,10)||0}return typeof i.total_amount=="number"?i.total_amount:0});L=new ft(n,{type:"line",data:{labels:t,datasets:[{label:"Pembelian Harian",data:l,borderColor:"rgb(33, 150, 243)",backgroundColor:"rgba(33, 150, 243, 0.1)",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:function(i){return k(i)}}}}}})},lt=async()=>{if(!s.value)return;const n=t=>{if(!t&&t!==0)return"Rp 0";let l=0;try{if(typeof t=="string"&&t.includes("Rp")){const f=t.replace(/\D/g,"");l=parseInt(f,10)}else typeof t=="string"?l=parseFloat(t.replace(/[^\d]/g,"")):typeof t=="number"&&(l=t);return(isNaN(l)||!isFinite(l)||l<0)&&(l=0),`Rp ${l.toLocaleString("id-ID").replace(/,/g,".")}`}catch{return"Rp 0"}};N.value=!0;try{const t=await pt(()=>import("./xlsx-CfQreh1U.js"),[]),l=x.value==="custom"?`${V.value} s/d ${S.value}`:`Bulan ${w.value}`,i=[["LAPORAN PEMBELIAN"],["Periode:",l],["Tanggal Export:",new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})],[],["RINGKASAN PEMBELIAN"],["Total Purchase:",s.value.summary.total_purchases||0],["Total Amount:",n(s.value.summary.total_amount)],["Rata-rata Purchase:",n(s.value.summary.avg_purchase_value)],["Purchase Selesai:",s.value.summary.completed_purchases||0],["Purchase Pending:",s.value.summary.pending_purchases||0],["Purchase Dibatalkan:",s.value.summary.cancelled_purchases||0],[]],f=t.utils.book_new(),z=t.utils.aoa_to_sheet(i);if(z["!cols"]=[{wch:20},{wch:25}],t.utils.book_append_sheet(f,z,"Ringkasan"),s.value.daily_purchases&&s.value.daily_purchases.length>0){const P=[["PEMBELIAN HARIAN"],["Periode:",l],[],["Tanggal","Jumlah Purchase","Total Amount"],...s.value.daily_purchases.map(r=>[new Date(r.date).toLocaleDateString("id-ID"),r.purchase_count||0,n(r.total_amount||0)])],_=t.utils.aoa_to_sheet(P);_["!cols"]=[{wch:15},{wch:15},{wch:20},{wch:20}],t.utils.book_append_sheet(f,_,"Pembelian Harian")}if(s.value.status_breakdown&&s.value.status_breakdown.length>0){const P=[["BREAKDOWN STATUS PEMBELIAN"],["Periode:",l],[],["Status","Jumlah Purchase","Total Amount"],...s.value.status_breakdown.map(r=>[r.status,r.purchase_count||0,n(r.total_amount||0)])],_=t.utils.aoa_to_sheet(P);_["!cols"]=[{wch:20},{wch:15},{wch:20}],t.utils.book_append_sheet(f,_,"Status Breakdown")}if(s.value.top_items&&s.value.top_items.length>0){const P=[["ITEM PALING BANYAK DIBELI"],["Periode:",l],[],["No","Nama Item","Total Dibeli","Total Amount","Rata-rata Unit Cost"],...s.value.top_items.map((r,$)=>[$+1,r.name||"",Math.round(parseFloat(r.total_purchased||0)),n(r.total_amount||0),n(r.avg_unit_cost||0)])],_=t.utils.aoa_to_sheet(P);_["!cols"]=[{wch:5},{wch:35},{wch:15},{wch:20},{wch:20}],t.utils.book_append_sheet(f,_,"Top Items")}if(s.value.top_suppliers&&s.value.top_suppliers.length>0){const P=[["SUPPLIER TERBAIK"],["Periode:",l],[],["No","Nama Supplier","Jumlah Purchase","Total Amount"],...s.value.top_suppliers.map((r,$)=>[$+1,r.name||"",r.total_purchases||0,n(r.total_amount||0)])],_=t.utils.aoa_to_sheet(P);_["!cols"]=[{wch:5},{wch:30},{wch:15},{wch:20}],t.utils.book_append_sheet(f,_,"Top Suppliers")}const st=`laporan-pembelian-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.xlsx`;t.writeFile(f,st)}catch{}finally{N.value=!1}};return nt(()=>{const n=new Date,t=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`;w.value=t,D()}),(n,t)=>(d(),h("div",vt,[o("div",yt,[o("div",null,[o("div",gt,[e(B,{icon:"mdi-arrow-left",variant:"text",size:"small",onClick:t[0]||(t[0]=l=>it(G).back()),class:"me-2"}),t[5]||(t[5]=o("h1",{class:"text-h4 font-weight-bold"},"Laporan Pembelian",-1))]),t[6]||(t[6]=o("p",{class:"text-body-1 text-medium-emphasis"}," Analisis lengkap pembelian dan performa supplier ",-1))]),e(B,{color:"primary","prepend-icon":"mdi-file-excel",onClick:lt,loading:N.value},{default:a(()=>t[7]||(t[7]=[p(" Export Excel ")])),_:1,__:[7]},8,["loading"])]),e(v,{class:"mb-6"},{default:a(()=>[e(y,null,{default:a(()=>[e(A,null,{default:a(()=>[e(c,{cols:"12",md:"4"},{default:a(()=>[e(J,{modelValue:x.value,"onUpdate:modelValue":[t[1]||(t[1]=l=>x.value=l),et],items:W,label:"Pilih Periode",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),x.value==="custom"?(d(),C(c,{key:0,cols:"12",md:"3"},{default:a(()=>[e(j,{modelValue:V.value,"onUpdate:modelValue":[t[2]||(t[2]=l=>V.value=l),D],type:"date",label:"Tanggal Mulai",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})):O("",!0),x.value==="custom"?(d(),C(c,{key:1,cols:"12",md:"3"},{default:a(()=>[e(j,{modelValue:S.value,"onUpdate:modelValue":[t[3]||(t[3]=l=>S.value=l),D],type:"date",label:"Tanggal Akhir",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})):(d(),C(c,{key:2,cols:"12",md:"3"},{default:a(()=>[e(J,{modelValue:w.value,"onUpdate:modelValue":[t[4]||(t[4]=l=>w.value=l),D],items:Z,label:"Pilih Bulan",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})),e(c,{cols:"12",md:"2"},{default:a(()=>[e(B,{color:"primary",block:"",onClick:D,loading:b.value},{default:a(()=>t[8]||(t[8]=[p(" Refresh ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),b.value?(d(),h("div",bt,[e(rt,{indeterminate:"",color:"primary",size:"64"}),t[9]||(t[9]=o("p",{class:"text-body-1 mt-4"},"Memuat data laporan...",-1))])):s.value?(d(),h("div",xt,[e(A,{class:"mb-6"},{default:a(()=>[e(c,{cols:"6",md:"3"},{default:a(()=>[e(v,null,{default:a(()=>[e(y,{class:"text-center"},{default:a(()=>[e(T,{icon:"mdi-currency-usd",size:"32",class:"text-primary mb-2"}),o("div",wt,u(k(s.value.summary.total_amount)),1),t[10]||(t[10]=o("div",{class:"text-body-2 text-medium-emphasis"},"Total Pembelian",-1))]),_:1,__:[10]})]),_:1})]),_:1}),e(c,{cols:"6",md:"3"},{default:a(()=>[e(v,null,{default:a(()=>[e(y,{class:"text-center"},{default:a(()=>[e(T,{icon:"mdi-cart",size:"32",class:"text-success mb-2"}),o("div",kt,u(s.value.summary.total_purchases),1),t[11]||(t[11]=o("div",{class:"text-body-2 text-medium-emphasis"},"Total Purchase",-1))]),_:1,__:[11]})]),_:1})]),_:1}),e(c,{cols:"6",md:"3"},{default:a(()=>[e(v,null,{default:a(()=>[e(y,{class:"text-center"},{default:a(()=>[e(T,{icon:"mdi-package",size:"32",class:"text-info mb-2"}),o("div",Pt,u(s.value.summary.total_items),1),t[12]||(t[12]=o("div",{class:"text-body-2 text-medium-emphasis"},"Total Item",-1))]),_:1,__:[12]})]),_:1})]),_:1}),e(c,{cols:"6",md:"3"},{default:a(()=>[e(v,null,{default:a(()=>[e(y,{class:"text-center"},{default:a(()=>[e(T,{icon:"mdi-calculator",size:"32",class:"text-warning mb-2"}),o("div",Dt,u(k(s.value.summary.avg_purchase_value)),1),t[13]||(t[13]=o("div",{class:"text-body-2 text-medium-emphasis"},"Rata-rata Purchase",-1))]),_:1,__:[13]})]),_:1})]),_:1})]),_:1}),e(A,{class:"mb-6"},{default:a(()=>[e(c,{cols:"12",md:"8"},{default:a(()=>[e(v,null,{default:a(()=>[e(I,null,{default:a(()=>t[14]||(t[14]=[p("Trend Pembelian Harian")])),_:1,__:[14]}),e(y,null,{default:a(()=>[s.value&&s.value.daily_purchases&&s.value.daily_purchases.length>0?(d(),h("div",Tt,[o("canvas",{ref_key:"dailyPurchaseChart",ref:R,class:"w-100",style:{"max-height":"300px"}},null,512)])):(d(),h("div",Vt,[e(T,{icon:"mdi-chart-line",size:"48",class:"text-medium-emphasis mb-2"}),t[15]||(t[15]=o("p",{class:"text-body-2 text-medium-emphasis"},"Tidak ada data pembelian harian",-1))]))]),_:1})]),_:1})]),_:1}),e(c,{cols:"12",md:"4"},{default:a(()=>[e(v,null,{default:a(()=>[e(I,null,{default:a(()=>t[16]||(t[16]=[p("Status Pembelian")])),_:1,__:[16]}),e(y,null,{default:a(()=>[(d(!0),h(H,null,U(s.value.status_breakdown,l=>(d(),h("div",{key:l.status,class:"mb-3"},[o("div",St,[o("div",It,[e(E,{color:F(l.status),size:"small",variant:"tonal",class:"me-2"},{default:a(()=>[p(u(l.status),1)]),_:2},1032,["color"]),o("span",At,u(l.count)+" purchase",1)]),o("span",Ct,u(k(l.total_amount)),1)]),e(mt,{"model-value":l.total_amount/s.value.summary.total_amount*100,color:F(l.status),height:"4",rounded:""},null,8,["model-value","color"])]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(A,{class:"mb-6"},{default:a(()=>[e(c,{cols:"12",md:"6"},{default:a(()=>[e(v,null,{default:a(()=>[e(I,null,{default:a(()=>t[17]||(t[17]=[p("Top Supplier")])),_:1,__:[17]}),e(y,null,{default:a(()=>[e(K,{headers:q,items:s.value.top_suppliers,"items-per-page":5,class:"elevation-0","no-data-text":"Tidak ada data supplier"},{"item.total_purchases":a(({item:l})=>[e(E,{size:"small",color:"primary",variant:"tonal"},{default:a(()=>[p(u(l.total_purchases),1)]),_:2},1024)]),"item.total_amount":a(({item:l})=>[o("span",Et,u(k(l.total_amount)),1)]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),e(c,{cols:"12",md:"6"},{default:a(()=>[e(v,null,{default:a(()=>[e(I,null,{default:a(()=>t[18]||(t[18]=[p("Top Item Dibeli")])),_:1,__:[18]}),e(y,null,{default:a(()=>[o("div",Nt,[(d(!0),h(H,null,U(s.value.top_items,(l,i)=>(d(),h("div",{key:l.id,class:"mb-3"},[o("div",Rt,[o("div",Lt,[e(E,{color:tt(i),size:"small",class:"me-2"},{default:a(()=>[p(u(i+1),1)]),_:2},1032,["color"]),o("div",null,[o("div",$t,u(l.name),1),o("div",Bt,u(l.total_purchased)+" dibeli ",1)])]),o("div",Mt,[o("div",Ft,u(k(l.total_amount)),1)])]),i<s.value.top_items.length-1?(d(),C(ht,{key:0,class:"mt-3"})):O("",!0)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),e(A,null,{default:a(()=>[e(c,{cols:"12"},{default:a(()=>[e(v,null,{default:a(()=>[e(I,null,{default:a(()=>t[19]||(t[19]=[p("Pembelian per Hari")])),_:1,__:[19]}),e(y,null,{default:a(()=>[e(K,{headers:Q,items:s.value.daily_purchases,"items-per-page":10,class:"elevation-0","no-data-text":"Tidak ada data pembelian"},{"item.date":a(({item:l})=>[p(u(M(l.date)),1)]),"item.purchase_count":a(({item:l})=>[e(E,{size:"small",color:"info",variant:"tonal"},{default:a(()=>[p(u(l.purchase_count),1)]),_:2},1024)]),"item.total_amount":a(({item:l})=>[o("span",zt,u(k(l.total_amount)),1)]),_:1},8,["items"])]),_:1})]),_:1})]),_:1})]),_:1})])):(d(),h("div",Ot,[e(T,{icon:"mdi-cart-variant",size:"64",class:"text-medium-emphasis mb-4"}),t[20]||(t[20]=o("h3",{class:"text-h6 mb-2"},"Tidak ada data laporan",-1)),t[21]||(t[21]=o("p",{class:"text-body-2 text-medium-emphasis"}," Silakan pilih periode yang berbeda atau periksa kembali filter Anda ",-1))]))]))}});typeof Y=="function"&&Y(X);const ce=_t(X,[["__scopeId","data-v-8f5db4ac"]]);export{ce as default};
