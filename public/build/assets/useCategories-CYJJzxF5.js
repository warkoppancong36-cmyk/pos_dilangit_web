import{b as oe,c as ae,g as te,h as se,d as ie,i as ue}from"./VTextField-QSgLTJ1H.js";import{f as re}from"./forwardRefs-B931MWyl.js";import{a8 as ce,a9 as ve,af as de,aM as fe,bj as ne,V as c,cj as le,r as l,W as ge,aG as me,w as pe,aa as he,c5 as Ce,b as m,p as Y,F as Z,b9 as Ee,c2 as Se,au as ye}from"./main-ClWRoyJh.js";import{V as De}from"./VChip-DGlteMQN.js";import{C as p}from"./CategoriesApi-BDmGQ_d6.js";const ke=ve({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:a=>typeof a=="boolean"||[1e3,1024].includes(Number(a))},...ie({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:a=>a.multiple?[]:null,validator:a=>ne(a).every(d=>d!=null&&typeof d=="object")},...se({clearable:!0})},"VFileInput"),Ve=ce()({name:"VFileInput",inheritAttrs:!1,props:ke(),emits:{"click:control":a=>!0,"mousedown:control":a=>!0,"update:focused":a=>!0,"update:modelValue":a=>!0},setup(a,d){let{attrs:F,emit:w,slots:u}=d;const{t:V}=de(),s=fe(a,"modelValue",a.modelValue,e=>ne(e),e=>!a.multiple&&Array.isArray(e)?e[0]:e),{isFocused:D,focus:I,blur:h}=oe(a),C=c(()=>typeof a.showSize!="boolean"?a.showSize:void 0),E=c(()=>(s.value??[]).reduce((e,o)=>{let{size:y=0}=o;return e+y},0)),M=c(()=>le(E.value,C.value)),A=c(()=>(s.value??[]).map(e=>{const{name:o="",size:y=0}=e;return a.showSize?`${o} (${le(y,C.value)})`:o})),B=c(()=>{var o;const e=((o=s.value)==null?void 0:o.length)??0;return a.showSize?V(a.counterSizeString,e,M.value):V(a.counterString,e)}),j=l(),k=l(),i=l(),T=ge(()=>D.value||a.active),S=c(()=>["plain","underlined"].includes(a.variant)),v=me(!1);function _(){var e;i.value!==document.activeElement&&((e=i.value)==null||e.focus()),D.value||I()}function G(e){var o;(o=i.value)==null||o.click()}function O(e){w("mousedown:control",e)}function $(e){var o;(o=i.value)==null||o.click(),w("click:control",e)}function x(e){e.stopPropagation(),_(),Ee(()=>{s.value=[],Se(a["onClick:clear"],e)})}function K(e){e.preventDefault(),e.stopImmediatePropagation(),v.value=!0}function H(e){e.preventDefault(),v.value=!1}function f(e){var y,U;if(e.preventDefault(),e.stopImmediatePropagation(),v.value=!1,!((U=(y=e.dataTransfer)==null?void 0:y.files)!=null&&U.length)||!i.value)return;const o=new DataTransfer;for(const q of e.dataTransfer.files)o.items.add(q);i.value.files=o.files,i.value.dispatchEvent(new Event("change",{bubbles:!0}))}return pe(s,e=>{(!Array.isArray(e)||!e.length)&&i.value&&(i.value.value="")}),he(()=>{const e=!!(u.counter||a.counter),o=!!(e||u.details),[y,U]=Ce(F),{modelValue:q,...J}=ae.filterProps(a),X=te.filterProps(a);return m(ae,Y({ref:j,modelValue:a.multiple?s.value:s.value[0],class:["v-file-input",{"v-file-input--chips":!!a.chips,"v-file-input--dragging":v.value,"v-file-input--hide":a.hideInput,"v-input--plain-underlined":S.value},a.class],style:a.style,"onClick:prepend":G},y,J,{centerAffix:!S.value,focused:D.value}),{...u,default:L=>{let{id:z,isDisabled:P,isDirty:Q,isReadonly:W,isValid:ee}=L;return m(te,Y({ref:k,"prepend-icon":a.prependIcon,onMousedown:O,onClick:$,"onClick:clear":x,"onClick:prependInner":a["onClick:prependInner"],"onClick:appendInner":a["onClick:appendInner"]},X,{id:z.value,active:T.value||Q.value,dirty:Q.value||a.dirty,disabled:P.value,focused:D.value,error:ee.value===!1,onDragover:K,onDrop:f}),{...u,default:t=>{var b;let{props:{class:n,...r}}=t;return m(Z,null,[m("input",Y({ref:i,type:"file",readonly:W.value,disabled:P.value,multiple:a.multiple,name:a.name,onClick:g=>{g.stopPropagation(),W.value&&g.preventDefault(),_()},onChange:g=>{if(!g.target)return;const N=g.target;s.value=[...N.files??[]]},onDragleave:H,onFocus:_,onBlur:h},r,U),null),m("div",{class:n},[!!((b=s.value)!=null&&b.length)&&!a.hideInput&&(u.selection?u.selection({fileNames:A.value,totalBytes:E.value,totalBytesReadable:M.value}):a.chips?A.value.map(g=>m(De,{key:g,size:"small",text:g},null)):A.value.join(", "))])])}})},details:o?L=>{var z,P;return m(Z,null,[(z=u.details)==null?void 0:z.call(u,L),e&&m(Z,null,[m("span",null,null),m(ue,{active:!!((P=s.value)!=null&&P.length),value:B.value,disabled:a.disabled},u.counter)])])}:void 0})}),re({},j,k,i)}}),R={SUCCESS:{CREATED:"Kategori berhasil ditambahkan",UPDATED:"Kategori berhasil diperbarui",DELETED:"Kategori berhasil dihapus",ACTIVATED:"Status kategori berhasil diaktifkan",DEACTIVATED:"Status kategori berhasil dinonaktifkan"},ERROR:{FETCH:"Terjadi kesalahan saat mengambil data kategori",SAVE:"Terjadi kesalahan saat menyimpan kategori",DELETE:"Terjadi kesalahan saat menghapus kategori",TOGGLE:"Terjadi kesalahan saat mengubah status kategori",IMAGE_TYPE:"File harus berupa gambar",IMAGE_SIZE:"Ukuran file maksimal 2MB",REQUIRED_NAME:"Nama kategori wajib diisi"}},Pe=()=>{const a=ye(),d=l([]),F=l(!1),w=l(!1),u=l(!1),V=l({}),s=l(!1),D=l(!1),I=l(!1),h=l(null),C=l({name:"",description:"",image:null,active:!0}),E=l(null),M=l(""),A=l("all"),B=l(10),j=l("grid"),k=l(1),i=l({current_page:1,last_page:1,per_page:10,total:0}),T=l(""),S=l(""),v=l(""),_=c(()=>{var t,n,r,b;return((n=(t=a.user)==null?void 0:t.role)==null?void 0:n.name)==="admin"||((b=(r=a.user)==null?void 0:r.role)==null?void 0:b.name)==="manager"}),G=c(()=>s.value),O=c(()=>i.value.last_page),$=c(()=>d.value.length),x=c(()=>d.value.filter(t=>t.active).length),K=c(()=>d.value.filter(t=>!t.active).length),H=c(()=>i.value.total),f=()=>{setTimeout(()=>{T.value="",S.value=""},5e3)},e=async()=>{var t;F.value=!0;try{const n={page:k.value,per_page:B.value,search:((t=M.value)==null?void 0:t.trim())||void 0,status:A.value!=="all"?A.value:void 0},r=await p.getCategories(n);r.success?(d.value=r.data,i.value=r.pagination):(S.value=r.message||R.ERROR.FETCH,f())}catch(n){S.value=p.handleError(n),f()}finally{F.value=!1}};return{categories:d,loading:F,saveLoading:w,deleteLoading:u,toggleLoading:V,dialog:s,deleteDialog:D,editMode:I,selectedCategory:h,formData:C,imagePreview:E,search:M,statusFilter:A,perPage:B,viewMode:j,currentPage:k,pagination:i,successMessage:T,errorMessage:S,modalErrorMessage:v,canCreateEdit:_,isDialogOpen:G,totalPages:O,totalCategories:$,activeCategories:x,inactiveCategories:K,totalData:H,fetchCategories:e,handleImageUpload:t=>{const n=t[0];if(n){const r=p.validateImage(n);if(!r.valid){v.value=r.error;return}C.value.image=n;const b=new FileReader;b.onload=g=>{var N;E.value=(N=g.target)==null?void 0:N.result},b.readAsDataURL(n)}},removeImage:()=>{C.value.image=null,E.value=null;const t=document.querySelector('input[type="file"]');t&&(t.value="")},saveCategory:async t=>{w.value=!0,v.value="";try{const n=t||C.value;(I.value&&h.value?await p.updateCategory(h.value.id_category,n):await p.createCategory(n)).success&&(await e(),s.value=!1,T.value=I.value?R.SUCCESS.UPDATED:R.SUCCESS.CREATED,f())}catch(n){v.value=p.handleError(n)}finally{w.value=!1}},deleteCategory:t=>{h.value=t,D.value=!0},confirmDelete:async()=>{if(h.value){u.value=!0;try{(await p.deleteCategory(h.value.id_category)).success&&(await e(),D.value=!1,T.value=R.SUCCESS.DELETED,f())}catch(t){S.value=p.handleError(t),f()}finally{u.value=!1}}},toggleActiveStatus:async t=>{V.value[t.id_category]=!0;try{(await p.toggleActiveStatus(t.id_category)).success&&(await e(),T.value=t.active?R.SUCCESS.DEACTIVATED:R.SUCCESS.ACTIVATED,f())}catch(n){S.value=p.handleError(n),f()}finally{V.value[t.id_category]=!1}},openCreateDialog:()=>{I.value=!1,v.value="",C.value={name:"",description:"",image:null,active:!0},E.value=null,s.value=!0},openEditDialog:t=>{I.value=!0,h.value=t,v.value="",C.value={name:t.name,description:t.description||"",image:null,active:t.active},E.value=t.image?t.image_url||`/storage/categories/${t.image}`:null,s.value=!0},closeDialog:()=>{s.value=!1,v.value="",E.value=null},onPageChange:t=>{k.value=t,e()},onSearch:()=>{k.value=1,e()},onFilterChange:()=>{k.value=1,e()},clearMessages:f}};export{Ve as V,Pe as u};
