import{d as h,r as S,V as R,w as aa,g as n,f as a,o,l as u,b as t,e as d,s as i,X as V,t as s,a0 as B,m as I,c as w,F as L,i as G,ay as ta,av as q}from"./main-BDjA8ZE0.js";import{f as P}from"./helpers-B-vn2Qqf.js";import{V as ea}from"./VDialog-kKqt15qI.js";import{V as b,b as D,c as la}from"./VCard-Af9i-cHC.js";import{V as N}from"./VDivider-CNJRCtTw.js";import{V as g}from"./VCardText-pusdEz6_.js";import{V as J,a as z}from"./VRow-B_tm1uSD.js";import{V as j,a as m,b as f,d as _}from"./VList-BUBOvLR6.js";import{V as y}from"./VChip-DmPw7oBU.js";import{V as ia}from"./VAvatar-BJUFvcQH.js";import{V as oa}from"./VImg-DavVY8Sw.js";import{V as sa}from"./VAlert-BUxPj0YW.js";import{V as na}from"./VSpacer-P6zft6lJ.js";const ra={class:"d-flex align-center justify-space-between"},ua={class:"d-flex align-center"},da={class:"d-flex align-center"},ma={class:"d-flex justify-between align-center mb-3"},fa={key:0,class:"text-end"},_a={class:"text-h6 font-weight-bold"},va={class:"text-end"},ca={class:"font-weight-medium"},pa={key:0},ka={class:"d-flex justify-between align-center"},ga={key:0},Ka=h({__name:"VariantDetailDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue"],setup(O,{emit:X}){const v=O,Q=X,T=S(!1),K=S(!1),C=S([]),A=S(null),p=S(null),H=(l,e="error")=>{console.log(`${e.toUpperCase()}: ${l}`)},M=R({get:()=>v.modelValue,set:l=>Q("update:modelValue",l)}),U=R(()=>{var l;return(l=v.variant)!=null&&l.attributes?Object.entries(v.variant.attributes).map(([e,r])=>({name:e,value:r})):[]}),$=async()=>{var l;if((l=v.variant)!=null&&l.id){T.value=!0;try{const e=await q.get(`/api/variant-items/variant/${v.variant.id}`);C.value=e.data;const r=C.value.reduce((c,x)=>c+x.total_cost,0);A.value={total_cost:r}}catch(e){console.error("Error loading composition details:",e),H("Gagal memuat detail komposisi")}finally{T.value=!1}}},W=async()=>{var l;if((l=v.variant)!=null&&l.id){K.value=!0;try{const e=await q.get(`/api/variants/${v.variant.id}/production-capacity`);p.value=e.data}catch(e){console.error("Error checking production capacity:",e),H("Gagal mengecek kapasitas produksi")}finally{K.value=!1}}},E=()=>{M.value=!1,C.value=[],A.value=null,p.value=null},Y=(l,e)=>l<=0?"error":l<=e?"warning":"success",Z=(l,e)=>{const r=(l-e)/l*100;return r<10?"error":r<20?"warning":"success"};return aa(()=>v.modelValue,l=>{l&&v.variant&&v.variant.variant_items_count&&v.variant.variant_items_count>0&&$()}),(l,e)=>(o(),n(ea,{modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=r=>M.value=r),"max-width":"900px"},{default:a(()=>[l.variant?(o(),n(b,{key:0},{default:a(()=>[t(D,{class:"text-h5"},{default:a(()=>[d("div",ra,[d("div",ua,[t(V,{icon:"mdi-information",class:"me-2"}),i(" Detail Variant: "+s(l.variant.name),1)]),t(B,{icon:"mdi-close",variant:"text",onClick:E})])]),_:1}),t(N),t(g,{class:"pt-4"},{default:a(()=>[t(J,null,{default:a(()=>[t(z,{cols:"12",md:"6"},{default:a(()=>[t(b,{variant:"outlined"},{default:a(()=>[t(D,{class:"text-h6"},{default:a(()=>e[1]||(e[1]=[i("Informasi Dasar")])),_:1,__:[1]}),t(g,null,{default:a(()=>[t(j,{density:"compact"},{default:a(()=>[t(m,null,{default:a(()=>[t(f,null,{default:a(()=>e[2]||(e[2]=[i("Nama Variant")])),_:1,__:[2]}),t(_,null,{default:a(()=>[i(s(l.variant.name),1)]),_:1})]),_:1}),t(m,null,{default:a(()=>[t(f,null,{default:a(()=>e[3]||(e[3]=[i("SKU")])),_:1,__:[3]}),t(_,null,{default:a(()=>[i(s(l.variant.sku),1)]),_:1})]),_:1}),l.variant.product?(o(),n(m,{key:0},{default:a(()=>[t(f,null,{default:a(()=>e[4]||(e[4]=[i("Produk")])),_:1,__:[4]}),t(_,null,{default:a(()=>[i(s(l.variant.product.name),1)]),_:1})]),_:1})):u("",!0),t(m,null,{default:a(()=>[t(f,null,{default:a(()=>e[5]||(e[5]=[i("Status")])),_:1,__:[5]}),t(_,null,{default:a(()=>[t(y,{color:l.variant.is_active?"success":"error",size:"small"},{default:a(()=>[i(s(l.variant.is_active?"Aktif":"Tidak Aktif"),1)]),_:1},8,["color"])]),_:1})]),_:1}),l.variant.description?(o(),n(m,{key:1},{default:a(()=>[t(f,null,{default:a(()=>e[6]||(e[6]=[i("Deskripsi")])),_:1,__:[6]}),t(_,null,{default:a(()=>[i(s(l.variant.description),1)]),_:1})]),_:1})):u("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(z,{cols:"12",md:"6"},{default:a(()=>[t(b,{variant:"outlined"},{default:a(()=>[t(D,{class:"text-h6"},{default:a(()=>e[7]||(e[7]=[i("Informasi Harga & Stok")])),_:1,__:[7]}),t(g,null,{default:a(()=>[t(j,{density:"compact"},{default:a(()=>[t(m,null,{default:a(()=>[t(f,null,{default:a(()=>e[8]||(e[8]=[i("Harga Jual")])),_:1,__:[8]}),t(_,{class:"text-h6 font-weight-bold"},{default:a(()=>[i(s(I(P)(l.variant.price)),1)]),_:1})]),_:1}),l.variant.cost_from_composition?(o(),n(m,{key:0},{default:a(()=>[t(f,null,{default:a(()=>e[9]||(e[9]=[i("HPP dari Komposisi")])),_:1,__:[9]}),t(_,null,{default:a(()=>[i(s(I(P)(l.variant.cost_from_composition)),1)]),_:1})]),_:1})):u("",!0),l.variant.cost_from_composition?(o(),n(m,{key:1},{default:a(()=>[t(f,null,{default:a(()=>e[10]||(e[10]=[i("Margin")])),_:1,__:[10]}),t(_,null,{default:a(()=>[t(y,{color:Z(l.variant.price,l.variant.cost_from_composition),size:"small"},{default:a(()=>[i(s(((l.variant.price-l.variant.cost_from_composition)/l.variant.price*100).toFixed(1))+"% ",1)]),_:1},8,["color"])]),_:1})]),_:1})):u("",!0),t(m,null,{default:a(()=>[t(f,null,{default:a(()=>e[11]||(e[11]=[i("Stok Saat Ini")])),_:1,__:[11]}),t(_,null,{default:a(()=>[t(y,{color:Y(l.variant.current_stock,l.variant.min_stock),size:"small"},{default:a(()=>[i(s(l.variant.current_stock),1)]),_:1},8,["color"])]),_:1})]),_:1}),t(m,null,{default:a(()=>[t(f,null,{default:a(()=>e[12]||(e[12]=[i("Minimum Stok")])),_:1,__:[12]}),t(_,null,{default:a(()=>[i(s(l.variant.min_stock),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),U.value.length>0?(o(),n(z,{key:0,cols:"12"},{default:a(()=>[t(b,{variant:"outlined"},{default:a(()=>[t(D,{class:"text-h6"},{default:a(()=>[t(V,{icon:"mdi-tag-multiple",class:"me-2"}),e[13]||(e[13]=i(" Atribut Variant "))]),_:1,__:[13]}),t(g,null,{default:a(()=>[t(J,null,{default:a(()=>[(o(!0),w(L,null,G(U.value,r=>(o(),n(z,{key:r.name,cols:"12",md:"6"},{default:a(()=>[t(m,null,{default:a(()=>[t(f,null,{default:a(()=>[i(s(r.name),1)]),_:2},1024),t(_,null,{default:a(()=>[t(y,{color:"primary",variant:"outlined",size:"small"},{default:a(()=>[i(s(r.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})):u("",!0),t(z,{cols:"12"},{default:a(()=>[t(b,{variant:"outlined"},{default:a(()=>[t(D,{class:"d-flex justify-between align-center"},{default:a(()=>[d("div",da,[t(V,{icon:"mdi-puzzle",class:"me-2"}),e[14]||(e[14]=i(" Ringkasan Komposisi "))]),l.variant.variant_items_count>0?(o(),n(B,{key:0,onClick:$,loading:T.value,variant:"outlined",size:"small"},{default:a(()=>e[15]||(e[15]=[i(" Lihat Detail ")])),_:1,__:[15]},8,["loading"])):u("",!0)]),_:1}),T.value?(o(),n(g,{key:0,class:"text-center py-4"},{default:a(()=>[t(ta,{indeterminate:"",size:"24"}),e[16]||(e[16]=d("span",{class:"ml-2"},"Memuat komposisi...",-1))]),_:1,__:[16]})):l.variant.variant_items_count===0?(o(),n(g,{key:1,class:"text-center py-4"},{default:a(()=>[t(V,{icon:"mdi-package-variant-closed",size:"48",class:"text-medium-emphasis mb-2"}),e[17]||(e[17]=d("div",{class:"text-medium-emphasis"},"Belum ada komposisi",-1))]),_:1,__:[17]})):(o(),n(g,{key:2},{default:a(()=>{var r;return[d("div",ma,[d("div",null,[t(y,{color:"info",variant:"elevated"},{default:a(()=>[i(s(l.variant.variant_items_count)+" Item Komposisi ",1)]),_:1})]),(r=A.value)!=null&&r.total_cost?(o(),w("div",fa,[d("div",_a,s(I(P)(A.value.total_cost)),1),e[18]||(e[18]=d("div",{class:"text-caption text-medium-emphasis"},"Total HPP",-1))])):u("",!0)]),C.value.length>0?(o(),n(j,{key:0,density:"compact"},{default:a(()=>[(o(!0),w(L,null,G(C.value,(c,x)=>(o(),w(L,{key:c.id},[t(m,null,{prepend:a(()=>[t(ia,{size:"32"},{default:a(()=>{var k;return[t(oa,{src:((k=c.item)==null?void 0:k.image)||"/images/default-item.png"},null,8,["src"])]}),_:2},1024)]),append:a(()=>[d("div",va,[d("div",ca,s(I(P)(c.total_cost)),1),c.stock_status==="critical"?(o(),n(y,{key:0,color:"error",size:"x-small"},{default:a(()=>e[19]||(e[19]=[i(" Kritis ")])),_:1,__:[19]})):c.stock_status==="low"?(o(),n(y,{key:1,color:"warning",size:"x-small"},{default:a(()=>e[20]||(e[20]=[i(" Rendah ")])),_:1,__:[20]})):u("",!0)])]),default:a(()=>[t(f,null,{default:a(()=>{var k;return[i(s((k=c.item)==null?void 0:k.name),1)]}),_:2},1024),t(_,null,{default:a(()=>{var k,F;return[i(s(c.quantity)+" "+s((k=c.item)==null?void 0:k.unit)+" Ã— "+s(I(P)(((F=c.item)==null?void 0:F.cost)||0)),1)]}),_:2},1024)]),_:2},1024),x<C.value.length-1?(o(),n(N,{key:0})):u("",!0)],64))),128))]),_:1})):u("",!0)]}),_:1}))]),_:1})]),_:1}),l.variant.variant_items_count>0?(o(),n(z,{key:1,cols:"12"},{default:a(()=>[t(b,{variant:"outlined"},{default:a(()=>[t(D,{class:"text-h6"},{default:a(()=>[t(V,{icon:"mdi-factory",class:"me-2"}),e[21]||(e[21]=i(" Kapasitas Produksi "))]),_:1,__:[21]}),t(g,null,{default:a(()=>[t(B,{onClick:W,loading:K.value,color:"info",variant:"outlined",class:"mb-3"},{default:a(()=>[t(V,{icon:"mdi-calculator",class:"me-1"}),e[22]||(e[22]=i(" Cek Kapasitas "))]),_:1,__:[22]},8,["loading"]),p.value?(o(),w("div",pa,[t(sa,{type:p.value.can_produce>0?"success":"error",variant:"tonal"},{default:a(()=>[d("div",ka,[d("div",null,[d("strong",null,s(p.value.can_produce>0?"Dapat Memproduksi":"Tidak Dapat Memproduksi"),1),p.value.can_produce>0?(o(),w("div",ga," Maksimal "+s(p.value.can_produce)+" unit variant ",1)):u("",!0)]),t(y,{color:p.value.can_produce>0?"success":"error",variant:"elevated"},{default:a(()=>[i(s(p.value.can_produce)+" Unit ",1)]),_:1},8,["color"])])]),_:1},8,["type"])])):u("",!0)]),_:1})]),_:1})]),_:1})):u("",!0)]),_:1})]),_:1}),t(N),t(la,null,{default:a(()=>[t(na),t(B,{color:"primary",variant:"outlined",onClick:E},{default:a(()=>[t(V,{icon:"mdi-close",class:"me-1"}),e[23]||(e[23]=i(" Tutup "))]),_:1,__:[23]})]),_:1})]),_:1})):u("",!0)]),_:1},8,["modelValue"]))}});export{Ka as _};
