import{D as St}from"./DeleteConfirmationDialog-OYWWg2N2.js";import{f as He}from"./formatters-BD6tdLx_.js";import{P as dt,u as Mt}from"./useProductItems-Dvt9pna1.js";import{I as Kt}from"./ItemsApi-BNhrZMUg.js";import{u as _t,H as Bt}from"./HPPBreakdownDialog-B3ZGyJQk.js";import{V as Ee}from"./VDialog-DmUF7axg.js";import{V as Y,b as xe,c as Re}from"./VCard-DNWsWdnv.js";import{a5 as Ft,a6 as Et,ac as Rt,r as I,aF as ot,ad as qt,aL as wt,bi as Lt,V as me,W as Nt,w as we,bt as Pt,b8 as ft,a7 as Ot,b as e,p as Ce,bd as jt,cv as Jt,c8 as Vt,bg as Wt,F as ze,X as k,cm as Gt,c9 as Qt,aH as Xt,s as d,d as Fe,D as et,c as G,f as t,e as o,t as r,a0 as E,g as A,l as L,m as K,at as it,i as We,v as Ge,o as m,au as gt,$ as kt,j as It,cw as Zt,aP as Yt,av as Ne,am as ea,an as ta,a2 as mt}from"./main-D_Yf1sUk.js";import{V as te}from"./VCardText-B50SHFcA.js";import{V as Ve}from"./VAvatar-COQPu6oE.js";import{V as ie}from"./VChip-CuVRC6tY.js";import{V as $e,a as $}from"./VRow-EOFRYi_v.js";import{V as yt}from"./VAutocomplete-Bfmhhkxp.js";import{e as aa,t as st,V as nt,a as je,b as Ye,d as tt}from"./VList-BUgVqE8B.js";import{u as la,V as he,m as oa}from"./VTextField-BBYjdLuP.js";import{V as Ze}from"./VSwitch-CqS759VN.js";import{a as ct,V as Ke}from"./VAlert-BIm4BRab.js";import{V as Oe}from"./VSpacer-YDY0k4UT.js";import{V as at}from"./VSnackbar-CY4uRLNE.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as sa}from"./ProductsApi-MfxW4JeA.js";import{u as ia,m as na,a as ra,V as Be}from"./VSelect-CZhGOgof.js";import{V as ua}from"./VCheckbox-BQ-hlXJk.js";import{V as Te}from"./VDivider-etI1ZXgB.js";import{a as da,V as ca}from"./VDataTable-Dpu9zgWh.js";import{V as ma}from"./VContainer-9VXj06mq.js";import{a as Dt,u as va,P as pa}from"./useProducts-CPg6jShs.js";import{V as bt}from"./VForm-SKJ-VfX5.js";import{V as Ct}from"./VTextarea-xqIviU8_.js";import{V as Me}from"./VTooltip-Bk_xJMPD.js";import{m as fa,V as ga}from"./VImg-BCTqvx8U.js";import{V as _a,u as ka}from"./useCategories-CPa8b8T4.js";import{u as ya,m as ba,h as ha}from"./filter-qN0DDjpG.js";import{f as xa}from"./forwardRefs-B931MWyl.js";import{V as wa}from"./VMenu-BQ5MRj_3.js";import{V as Pa}from"./VCheckboxBtn-thuWkTbl.js";import{V as Va}from"./VDataTableServer-DbdkMTZ5.js";import{V as Ca}from"./VSkeletonLoader-BB7DLF8Q.js";import{V as $a,a as Sa,b as vt,c as pt}from"./VTabs-C5aq4IQT.js";import"./api-CE7s5J2D.js";import"./index-D-EbNoF1.js";import"./VOverlay-DOEhD25F.js";/* empty css              */import"./VTable-BPNiE3uk.js";import"./helpers-B-vn2Qqf.js";import"./CategoriesApi-DEtFZu8d.js";const Ia=Et({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...ba({filterKeys:["title"]}),...na({hideNoData:!0,returnObject:!0}),...jt(oa({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...fa({transition:!1})},"VCombobox"),Da=Ft()({name:"VCombobox",props:Ia(),emits:{"update:focused":S=>!0,"update:modelValue":S=>!0,"update:search":S=>!0,"update:menu":S=>!0},setup(S,ye){var n;let{emit:H,slots:U}=ye;const{t:O}=Rt(),g=I(),j=ot(!1),z=ot(!0),x=ot(!1),f=I(),N=I(),_=ot(-1);let M=!1;const{items:ve,transformIn:ge,transformOut:V}=aa(S),{textColorClasses:re,textColorStyles:ue}=qt(()=>{var s;return(s=g.value)==null?void 0:s.color}),W=wt(S,"modelValue",[],s=>ge(Lt(s)),s=>{const w=V(s);return S.multiple?w:w[0]??null}),de=la(S),b=me(()=>!!(S.chips||U.chip)),v=me(()=>b.value||!!U.selection),y=ot(!S.multiple&&!v.value?((n=W.value[0])==null?void 0:n.title)??"":""),p=me({get:()=>y.value,set:s=>{var w;if(y.value=s??"",!S.multiple&&!v.value&&(W.value=[st(S,s)]),s&&S.multiple&&((w=S.delimiters)!=null&&w.length)){const B=s.split(new RegExp(`(?:${S.delimiters.join("|")})+`));B.length>1&&(B.forEach(F=>{F=F.trim(),F&&Ae(st(S,F))}),y.value="")}s||(_.value=-1),z.value=!s}}),R=me(()=>typeof S.counterValue=="function"?S.counterValue(W.value):typeof S.counterValue=="number"?S.counterValue:S.multiple?W.value.length:p.value.length),{filteredItems:h,getMatches:X}=ya(S,ve,()=>z.value?"":p.value),ne=me(()=>S.hideSelected?h.value.filter(s=>!W.value.some(w=>w.value===s.value)):h.value),ke=me(()=>S.hideNoData&&!ne.value.length||de.isReadonly.value||de.isDisabled.value),fe=wt(S,"menu"),ae=me({get:()=>fe.value,set:s=>{var w;fe.value&&!s&&((w=f.value)!=null&&w.ΨopenChildren.size)||s&&ke.value||(fe.value=s)}}),J=Nt(()=>ae.value?S.closeText:S.openText);we(y,s=>{M?ft(()=>M=!1):j.value&&!ae.value&&(ae.value=!0),H("update:search",s)}),we(W,s=>{var w;!S.multiple&&!v.value&&(y.value=((w=s[0])==null?void 0:w.title)??"")});const C=me(()=>W.value.map(s=>s.value)),i=me(()=>{var w;return(S.autoSelectFirst===!0||S.autoSelectFirst==="exact"&&p.value===((w=ne.value[0])==null?void 0:w.title))&&ne.value.length>0&&!z.value&&!x.value}),a=I(),l=ia(a,g);function u(s){M=!0,S.openOnClear&&(ae.value=!0)}function ee(){ke.value||(ae.value=!0)}function q(s){ke.value||(j.value&&(s.preventDefault(),s.stopPropagation()),ae.value=!ae.value)}function ce(s){var w;s.key!==" "&&Vt(s)&&((w=g.value)==null||w.focus())}function Pe(s){var F,c,T,Q;if(Jt(s)||de.isReadonly.value)return;const w=(F=g.value)==null?void 0:F.selectionStart,B=W.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(s.key)&&s.preventDefault(),["Enter","ArrowDown"].includes(s.key)&&(ae.value=!0),["Escape"].includes(s.key)&&(ae.value=!1),["Enter","Escape","Tab"].includes(s.key)&&(i.value&&["Enter","Tab"].includes(s.key)&&!W.value.some(P=>{let{value:pe}=P;return pe===ne.value[0].value})&&Ae(h.value[0]),z.value=!0),s.key==="ArrowDown"&&i.value&&((c=a.value)==null||c.focus("next")),s.key==="Enter"&&p.value&&(Ae(st(S,p.value)),v.value&&(y.value="")),["Backspace","Delete"].includes(s.key)){if(!S.multiple&&v.value&&W.value.length>0&&!p.value)return Ae(W.value[0],!1);if(~_.value){s.preventDefault();const P=_.value;Ae(W.value[_.value],!1),_.value=P>=B-1?B-2:P}else s.key==="Backspace"&&!p.value&&(_.value=B-1);return}if(S.multiple)if(s.key==="ArrowLeft"){if(_.value<0&&w&&w>0)return;const P=_.value>-1?_.value-1:B-1;W.value[P]?_.value=P:(_.value=-1,(T=g.value)==null||T.setSelectionRange(p.value.length,p.value.length))}else if(s.key==="ArrowRight"){if(_.value<0)return;const P=_.value+1;W.value[P]?_.value=P:(_.value=-1,(Q=g.value)==null||Q.setSelectionRange(0,0))}else~_.value&&Vt(s)&&(_.value=-1)}function le(){var s;S.eager&&((s=N.value)==null||s.calculateVisibleItems())}function Ue(){var s;j.value&&(z.value=!0,(s=g.value)==null||s.focus())}function Ae(s){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!s||s.props.disabled))if(S.multiple){const B=W.value.findIndex(c=>(S.valueComparator||Pt)(c.value,s.value)),F=w??!~B;if(~B){const c=F?[...W.value,s]:[...W.value];c.splice(B,1),W.value=c}else F&&(W.value=[...W.value,s]);S.clearOnSelect&&(p.value="")}else{const B=w!==!1;W.value=B?[s]:[],y.value=B&&!v.value?s.title:"",ft(()=>{ae.value=!1,z.value=!0})}}function Qe(s){j.value=!0,setTimeout(()=>{x.value=!0})}function Je(s){x.value=!1}function D(s){(s==null||s===""&&!S.multiple&&!v.value)&&(W.value=[])}return we(j,(s,w)=>{if(!(s||s===w)&&(_.value=-1,ae.value=!1,p.value)){if(S.multiple){Ae(st(S,p.value));return}if(!v.value)return;W.value.some(B=>{let{title:F}=B;return F===p.value})?y.value="":Ae(st(S,p.value))}}),we(ae,()=>{if(!S.hideSelected&&ae.value&&W.value.length){const s=ne.value.findIndex(w=>W.value.some(B=>(S.valueComparator||Pt)(B.value,w.value)));Wt&&window.requestAnimationFrame(()=>{var w;s>=0&&((w=N.value)==null||w.scrollToIndex(s))})}}),we(()=>S.items,(s,w)=>{ae.value||j.value&&!w.length&&s.length&&(ae.value=!0)}),Ot(()=>{const s=!!(!S.hideNoData||ne.value.length||U["prepend-item"]||U["append-item"]||U["no-data"]),w=W.value.length>0,B=he.filterProps(S);return e(he,Ce({ref:g},B,{modelValue:p.value,"onUpdate:modelValue":[F=>p.value=F,D],focused:j.value,"onUpdate:focused":F=>j.value=F,validationValue:W.externalValue,counterValue:R.value,dirty:w,class:["v-combobox",{"v-combobox--active-menu":ae.value,"v-combobox--chips":!!S.chips,"v-combobox--selection-slot":!!v.value,"v-combobox--selecting-index":_.value>-1,[`v-combobox--${S.multiple?"multiple":"single"}`]:!0},S.class],style:S.style,readonly:de.isReadonly.value,placeholder:w?void 0:S.placeholder,"onClick:clear":u,"onMousedown:control":ee,onKeydown:Pe}),{...U,default:()=>e(ze,null,[e(wa,Ce({ref:f,modelValue:ae.value,"onUpdate:modelValue":F=>ae.value=F,activator:"parent",contentClass:"v-combobox__content",disabled:ke.value,eager:S.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:S.transition,onAfterEnter:le,onAfterLeave:Ue},S.menuProps),{default:()=>[s&&e(nt,Ce({ref:a,selected:C.value,selectStrategy:S.multiple?"independent":"single-independent",onMousedown:F=>F.preventDefault(),onKeydown:ce,onFocusin:Qe,onFocusout:Je,tabindex:"-1","aria-live":"polite",color:S.itemColor??S.color},l,S.listProps),{default:()=>{var F,c,T;return[(F=U["prepend-item"])==null?void 0:F.call(U),!ne.value.length&&!S.hideNoData&&(((c=U["no-data"])==null?void 0:c.call(U))??e(je,{key:"no-data",title:O(S.noDataText)},null)),e(ra,{ref:N,renderless:!0,items:ne.value,itemKey:"value"},{default:Q=>{var Se;let{item:P,index:pe,itemRef:se}=Q;const oe=Ce(P.props,{ref:se,key:P.value,active:i.value&&pe===0?!0:void 0,onClick:()=>Ae(P,null)});return((Se=U.item)==null?void 0:Se.call(U,{item:P,index:pe,props:oe}))??e(je,Ce(oe,{role:"option"}),{prepend:be=>{let{isSelected:De}=be;return e(ze,null,[S.multiple&&!S.hideSelected?e(Pa,{key:P.value,modelValue:De,ripple:!1,tabindex:"-1"},null):void 0,P.props.prependAvatar&&e(Ve,{image:P.props.prependAvatar},null),P.props.prependIcon&&e(k,{icon:P.props.prependIcon},null)])},title:()=>{var be;return z.value?P.title:ha("v-combobox",P.title,(be=X(P))==null?void 0:be.title)}})}}),(T=U["append-item"])==null?void 0:T.call(U)]}})]}),W.value.map((F,c)=>{function T(se){se.stopPropagation(),se.preventDefault(),Ae(F,!1)}const Q={"onClick:close":T,onKeydown(se){se.key!=="Enter"&&se.key!==" "||(se.preventDefault(),se.stopPropagation(),T(se))},onMousedown(se){se.preventDefault(),se.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},P=b.value?!!U.chip:!!U.selection,pe=P?Qt(b.value?U.chip({item:F,index:c,props:Q}):U.selection({item:F,index:c})):void 0;if(!(P&&!pe))return e("div",{key:F.value,class:["v-combobox__selection",c===_.value&&["v-combobox__selection--selected",re.value]],style:c===_.value?ue.value:{}},[b.value?U.chip?e(Xt,{key:"chip-defaults",defaults:{VChip:{closable:S.closableChips,size:"small",text:F.title}}},{default:()=>[pe]}):e(ie,Ce({key:"chip",closable:S.closableChips,size:"small",text:F.title,disabled:F.props.disabled},Q),null):pe??e("span",{class:"v-combobox__selection-text"},[F.title,S.multiple&&c<W.value.length-1&&e("span",{class:"v-combobox__selection-comma"},[d(",")])])])})]),"append-inner":function(){var Q,P;for(var F=arguments.length,c=new Array(F),T=0;T<F;T++)c[T]=arguments[T];return e(ze,null,[(Q=U["append-inner"])==null?void 0:Q.call(U,...c),(!S.hideNoData||S.items.length)&&S.menuIcon?e(k,{class:"v-combobox__menu-icon",color:(P=g.value)==null?void 0:P.fieldIconColor,icon:S.menuIcon,onMousedown:q,onClick:Gt,"aria-label":O(J.value),title:O(J.value),tabindex:"-1"},null):void 0])}})}),xa({isFocused:j,isPristine:z,menu:ae,search:p,selectionIndex:_,filteredItems:h,select:Ae},g)}}),za={class:"d-flex align-center gap-3"},Ta={class:"text-body-2 ma-0 opacity-90"},Ua={class:"d-flex align-center gap-4"},Aa={class:"flex-grow-1"},Ha={class:"text-h6 font-weight-bold mb-1"},Ma={class:"text-body-2 text-medium-emphasis mb-1"},Ka={class:"d-flex align-center gap-4 mb-0"},Ba={class:"text-body-2 text-medium-emphasis mb-0"},Fa={class:"text-body-2 text-info mb-0 font-weight-medium"},Ea={key:0,class:"text-body-2 text-success mb-0 font-weight-medium"},Ra={class:"text-body-1 font-weight-bold"},qa={class:"text-body-1 font-weight-bold"},La={class:"text-body-1 font-weight-bold"},Na={class:"text-body-1 font-weight-bold"},Oa={class:"d-flex align-center justify-space-between w-100"},ja={class:"d-flex align-center"},Ja={key:0,class:"text-warning"},Wa={key:1},Ga={key:0,class:"text-center pa-8"},Qa={class:"d-flex align-center gap-4 mt-1"},Xa={key:1,class:"text-primary"},Za={class:"d-flex gap-2"},Ya=Fe({__name:"ProductCompositionDialog",props:{modelValue:{type:Boolean},product:{},items:{}},emits:["update:modelValue","save","refresh"],setup(S,{emit:ye}){const H=S,U=ye,O=me({get:()=>H.modelValue,set:D=>U("update:modelValue",D)}),g=I(!1),j=I([]),z=I(!1),x=I(!1),f=I(""),N=I(""),_=I(!1),M=I(-1),ve=I(!1),{loading:ge,currentHPPBreakdown:V,getProductHPPBreakdown:re}=_t(),ue=me(()=>{var D,n,s;return((D=V.value)==null?void 0:D.total_hpp)||((n=H.product)==null?void 0:n.hpp)||((s=H.product)==null?void 0:s.cost)||0}),W=me(()=>{var s;const D=((s=H.product)==null?void 0:s.price)||0,n=ue.value;return D-n}),de=me(()=>{var s;const D=((s=H.product)==null?void 0:s.price)||0,n=ue.value;return D<=0?0:Math.round((D-n)/D*100)}),b=I({itemId:null,quantity:1,isCritical:!1}),v=I([]),y=I(!1),p=I([]),R=async()=>{var D;if(H.product)try{const n=H.product.id_product||H.product.id,s=await dt.getAll({product_id:n,page:1,per_page:1e5});s.success&&((D=s.data)!=null&&D.data)&&(j.value=s.data.data,p.value=JSON.parse(JSON.stringify(s.data.data)))}catch(n){console.error("Error fetching product composition:",n)}},h=async()=>{var D;y.value=!0;try{const n=await Kt.getAll({page:1,per_page:1e5,active:!0});n.success&&((D=n.data)!=null&&D.data)&&(v.value=n.data.data.map(s=>{var w,B,F;return{id:((w=s.id_item)==null?void 0:w.toString())||((B=s.id)==null?void 0:B.toString()),name:s.name,current_stock:((F=s.inventory)==null?void 0:F.current_stock)||0,unit:s.unit||"pcs"}}))}catch(n){console.error("Error fetching available items:",n),v.value=[]}finally{y.value=!1}},X=me(()=>b.value.itemId&&b.value.quantity>0);me(()=>{if(!b.value.itemId)return null;const D=v.value.find(n=>n.id===b.value.itemId);return(D==null?void 0:D.unit)||null});const ne=me(()=>{if(!b.value.itemId)return null;const D=v.value.find(n=>n.id===b.value.itemId);return D?ae(D):null}),ke=me(()=>ne.value!==null&&ne.value<=0),fe=me(()=>Array.isArray(v.value)?v.value:[]),ae=D=>D.current_stock||D.stock||0,J=()=>y.value?"Memuat items...":!v.value||v.value.length===0?"Tidak ada item tersedia":"Tidak ada item yang ditemukan",C=D=>{const n=ae(D);return n>50?"success":n>20?"warning":n>0?"error":"grey"},i=D=>{const n=ae(D);return n>50?"Aman":n>20?"Rendah":n>0?"Kritis":"Habis"};we(()=>H.items,D=>{D&&D.length>0,j.value=[...D]},{immediate:!0}),we(()=>H.modelValue,async D=>{D&&H.product&&(R(),await a())});const a=async()=>{if(H.product&&(H.product.id_product||H.product.id))try{const D=parseInt(String(H.product.id_product||H.product.id));await re(D,"latest")}catch(D){console.warn("Could not load HPP data:",D)}};et(()=>{h()});const l=()=>{ve.value=!0},u=async()=>{await a(),U("refresh")},ee=()=>j.value.some(n=>{var s;return((s=n.item)==null?void 0:s.inventory)&&n.item.inventory.current_stock<n.quantity_needed})?"error":"success",q=()=>j.value.some(n=>{var s;return((s=n.item)==null?void 0:s.inventory)&&n.item.inventory.current_stock<n.quantity_needed})?"Stok Kritis":"Stok Aman",ce=()=>{if(!X.value)return;const D=v.value.find(w=>w.id===b.value.itemId);if(!D)return;if(j.value.find(w=>{var B;return((B=w.item)==null?void 0:B.id)===D.id})){f.value=`Item "${D.name}" sudah ada dalam komposisi produk ini`,z.value=!0;return}const s={id_product_item:`temp_${Date.now()}`,item:{id:String(D.id),name:D.name,inventory:{current_stock:D.current_stock||0}},quantity_needed:b.value.quantity,unit:b.value.unit,is_critical:b.value.isCritical};j.value.push(s),Ue()},Pe=(D,n)=>{var B;if(v.value.length===0){console.warn("⚠️ Available items not loaded yet, fetching..."),h().then(()=>{Pe(D,n)});return}_.value=!0,M.value=n;let s=((B=D.item)==null?void 0:B.id)||null;if(s!==null&&(s=s.toString()),b.value={itemId:s,quantity:parseFloat(D.quantity_needed.toString())||0,unit:D.unit,isCritical:D.is_critical},!v.value.find(F=>F.id===s)){console.warn("⚠️ Item ID not found in available items, trying alternative matching...");const F=v.value.find(c=>{var T;return c.name===((T=D.item)==null?void 0:T.name)});F?b.value.itemId=F.id:console.error("❌ Could not find item in available items by ID or name")}},le=()=>{if(!X.value||M.value===-1)return;const D=v.value.find(n=>n.id===b.value.itemId);D&&(j.value[M.value]={...j.value[M.value],item:{id:String(D.id),name:D.name,inventory:{current_stock:D.current_stock||0}},quantity_needed:b.value.quantity,unit:b.value.unit,is_critical:b.value.isCritical},Ue())},Ue=()=>{_.value=!1,M.value=-1,b.value={itemId:null,quantity:1,unit:"pcs",isCritical:!1}},Ae=D=>{j.value.splice(D,1)},Qe=async()=>{var D,n,s,w,B,F,c,T,Q;if(H.product){g.value=!0;try{const P=parseInt(String(((D=H.product)==null?void 0:D.id_product)||((n=H.product)==null?void 0:n.id)||"0")),pe=p.value||[],se=j.value;for(const oe of se){const Se=pe.find(De=>{var Le,Xe;return!!(De.id_product_item===oe.id_product_item||oe.id_product_item&&!oe.id_product_item.toString().startsWith("temp_")&&((Le=De.item)==null?void 0:Le.id)===((Xe=oe.item)==null?void 0:Xe.id))});if(!((s=oe.item)!=null&&s.id)||parseInt(oe.item.id)===0){console.warn("⚠️ Skipping item with invalid item_id:",{item_name:(w=oe.item)==null?void 0:w.name,item_id:(B=oe.item)==null?void 0:B.id,full_item:oe});continue}const be={product_id:P,item_id:parseInt(((F=oe.item)==null?void 0:F.id)||"0"),quantity_needed:parseFloat(oe.quantity_needed.toString()),is_critical:oe.is_critical,notes:oe.notes||""};try{Se&&!((c=oe.id_product_item)!=null&&c.toString().startsWith("temp_"))?await dt.update(parseInt(Se.id_product_item||"0"),be):await dt.create(be)}catch(De){throw console.error("❌ Error processing item:",De),(T=De.message)!=null&&T.includes("already assigned")?f.value=`Item "${(Q=oe.item)==null?void 0:Q.name}" sudah ditambahkan ke produk ini`:f.value=De.message||"Terjadi kesalahan saat menyimpan item",z.value=!0,De}}for(const oe of pe)if(!se.find(be=>be.id_product_item===oe.id_product_item)&&oe.id_product_item)try{await dt.delete(parseInt(oe.id_product_item))}catch(be){console.error("❌ Error deleting item:",be),f.value=`Gagal menghapus item: ${be.message}`,z.value=!0}N.value="Komposisi produk berhasil disimpan!",x.value=!0,U("save",{product:H.product,items:j.value}),U("refresh"),Je()}catch(P){console.error("❌ Error saving composition:",P),z.value||(f.value=P.message||"Terjadi kesalahan saat menyimpan komposisi",z.value=!0)}finally{g.value=!1}}},Je=()=>{O.value=!1,setTimeout(()=>{j.value=[...H.items],Ue()},300)};return(D,n)=>{var s,w,B,F;return m(),G(ze,null,[e(Ee,{modelValue:O.value,"onUpdate:modelValue":n[8]||(n[8]=c=>O.value=c),"max-width":"900",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-between bg-primary text-white"},{default:t(()=>{var c;return[o("div",za,[e(k,{icon:"mdi-chef-hat",size:"24"}),o("div",null,[n[11]||(n[11]=o("h3",{class:"text-h6 font-weight-bold"},"Kelola Komposisi Item",-1)),o("p",Ta,r(((c=D.product)==null?void 0:c.name)||"Produk"),1)])]),e(E,{icon:"mdi-close",variant:"text",size:"small",onClick:Je})]}),_:1}),e(te,{class:"pa-6"},{default:t(()=>[e(Y,{variant:"tonal",class:"mb-6"},{default:t(()=>[e(te,{class:"pa-4"},{default:t(()=>{var c,T,Q,P,pe,se;return[o("div",Ua,[e(Ve,{image:(c=D.product)==null?void 0:c.image_url,size:"64"},{default:t(()=>{var oe;return[(oe=D.product)!=null&&oe.image_url?L("",!0):(m(),A(k,{key:0,icon:"mdi-coffee"}))]}),_:1},8,["image"]),o("div",Aa,[o("h4",Ha,r((T=D.product)==null?void 0:T.name),1),o("p",Ma," SKU: "+r(((Q=D.product)==null?void 0:Q.sku)||"SKU-"+((P=D.product)==null?void 0:P.id_product)),1),o("div",Ka,[o("p",Ba," Harga: "+r(K(He)(((pe=D.product)==null?void 0:pe.price)||0)),1),o("p",Fa," HPP: "+r(K(He)(ue.value)),1),(se=D.product)!=null&&se.price&&ue.value?(m(),G("p",Ea," Margin: "+r(K(He)(W.value)),1)):L("",!0)])]),e(ie,{color:ee(),variant:"tonal"},{default:t(()=>[d(r(q()),1)]),_:1},8,["color"])])]}),_:1})]),_:1}),e($e,{class:"mb-6"},{default:t(()=>[e($,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"info"},{default:t(()=>[e(te,{class:"text-center pa-3"},{default:t(()=>[e(k,{icon:"mdi-calculator",size:"20",class:"mb-1"}),o("div",Ra,[d(r(K(He)(ue.value))+" ",1),K(ge)?(m(),A(it,{key:0,indeterminate:"",size:"12",width:"2",class:"ml-1"})):L("",!0)]),n[12]||(n[12]=o("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[12]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"primary"},{default:t(()=>[e(te,{class:"text-center pa-3"},{default:t(()=>{var c;return[e(k,{icon:"mdi-currency-usd",size:"20",class:"mb-1"}),o("div",qa,r(K(He)(((c=D.product)==null?void 0:c.price)||0)),1),n[13]||(n[13]=o("div",{class:"text-caption"},"Harga Jual",-1))]}),_:1,__:[13]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"success"},{default:t(()=>[e(te,{class:"text-center pa-3"},{default:t(()=>[e(k,{icon:"mdi-trending-up",size:"20",class:"mb-1"}),o("div",La,r(K(He)(W.value)),1),n[14]||(n[14]=o("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[14]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"warning"},{default:t(()=>[e(te,{class:"text-center pa-3"},{default:t(()=>[e(k,{icon:"mdi-percent",size:"20",class:"mb-1"}),o("div",Na,r(de.value)+"% ",1),n[15]||(n[15]=o("div",{class:"text-caption"},"Margin %",-1))]),_:1,__:[15]})]),_:1})]),_:1})]),_:1}),e(Y,{class:"mb-6",elevation:"2"},{default:t(()=>[e(xe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[o("div",Oa,[o("div",ja,[e(k,{icon:_.value?"mdi-pencil-circle":"mdi-plus-circle",class:"me-2"},null,8,["icon"]),d(" "+r(_.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])])]),_:1}),e(te,{class:"pa-4"},{default:t(()=>[e($e,null,{default:t(()=>[e($,{cols:"12",md:"4"},{default:t(()=>[e(yt,{modelValue:b.value.itemId,"onUpdate:modelValue":n[0]||(n[0]=c=>b.value.itemId=c),items:fe.value,loading:y.value,"item-title":"name","item-value":"id",label:"Pilih Item",placeholder:"Cari item (termasuk yang stok kosong)...","prepend-inner-icon":"mdi-magnify",variant:"outlined",clearable:"","no-data-text":J()},{item:t(({props:c,item:T})=>[e(je,Ce(c,{class:{"text-medium-emphasis":ae(T.raw)<=0}}),{prepend:t(()=>[e(Ve,{size:"32",class:"me-3",color:ae(T.raw)<=0?"warning":"primary",variant:"tonal"},{default:t(()=>[e(k,{icon:"mdi-package-variant",color:ae(T.raw)<=0?"warning":"primary"},null,8,["color"])]),_:2},1032,["color"])]),append:t(()=>[ae(T.raw)>0?(m(),A(ie,{key:0,size:"x-small",color:C(T.raw),variant:"tonal"},{default:t(()=>[d(r(i(T.raw)),1)]),_:2},1032,["color"])):(m(),A(ie,{key:1,size:"x-small",color:"warning",variant:"tonal","prepend-icon":"mdi-alert"},{default:t(()=>n[17]||(n[17]=[d(" Kosong ")])),_:1,__:[17]}))]),default:t(()=>[e(Ye,null,{default:t(()=>[d(r(T.raw.name),1)]),_:2},1024),e(tt,{class:"text-medium-emphasis"},{default:t(()=>[ae(T.raw)<=0?(m(),G("span",Ja,[e(k,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),n[16]||(n[16]=d(" Stok Kosong - Masih bisa digunakan "))])):(m(),G("span",Wa," Stok: "+r(ae(T.raw))+" "+r(T.raw.unit),1))]),_:2},1024)]),_:2},1040,["class"])]),_:1},8,["modelValue","items","loading","no-data-text"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(he,{modelValue:b.value.quantity,"onUpdate:modelValue":n[1]||(n[1]=c=>b.value.quantity=c),modelModifiers:{number:!0},type:"number",label:"Jumlah",variant:"outlined",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Ze,{modelValue:b.value.isCritical,"onUpdate:modelValue":n[2]||(n[2]=c=>b.value.isCritical=c),label:"Item Kritis",color:"error","hide-details":""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(E,{color:_.value?"success":"primary",block:"","prepend-icon":_.value?"mdi-check":"mdi-plus",onClick:n[3]||(n[3]=c=>_.value?le():ce()),disabled:!X.value},{default:t(()=>[d(r(_.value?"Update":"Tambah"),1)]),_:1},8,["color","prepend-icon","disabled"]),_.value?(m(),A(E,{key:0,color:"error",variant:"outlined",block:"","prepend-icon":"mdi-close",class:"mt-2",onClick:Ue},{default:t(()=>n[18]||(n[18]=[d(" Batal ")])),_:1,__:[18]})):L("",!0)]),_:1})]),_:1}),ke.value?(m(),A(Ke,{key:0,color:"warning",variant:"tonal",class:"mt-4","prepend-icon":"mdi-alert"},{default:t(()=>[e(ct,null,{default:t(()=>n[19]||(n[19]=[d("Item Stok Kosong")])),_:1,__:[19]}),n[20]||(n[20]=o("div",null,"Item yang dipilih sedang kosong stok, namun masih bisa ditambahkan ke komposisi. Pastikan untuk memperbarui stok sebelum produksi.",-1))]),_:1,__:[20]})):L("",!0)]),_:1})]),_:1}),e(Y,{elevation:"2"},{default:t(()=>[e(xe,{class:"bg-grey-lighten-4 py-3"},{default:t(()=>[e(k,{icon:"mdi-format-list-bulleted",class:"me-2"}),d(" Daftar Item Komposisi ("+r(j.value.length)+") ",1)]),_:1}),e(te,{class:"pa-0"},{default:t(()=>[j.value.length===0?(m(),G("div",Ga,[e(k,{icon:"mdi-package-variant-closed",size:"64",class:"text-disabled mb-4"}),n[21]||(n[21]=o("h4",{class:"text-h6 mb-2"},"Belum ada item komposisi",-1)),n[22]||(n[22]=o("p",{class:"text-body-2 text-medium-emphasis"}," Tambahkan item yang dibutuhkan untuk membuat produk ini ",-1))])):(m(),A(nt,{key:1},{default:t(()=>[(m(!0),G(ze,null,We(j.value,(c,T)=>(m(),A(je,{key:c.id||T,class:"border-b"},{prepend:t(()=>[e(Ve,{size:"40",class:"me-3"},{default:t(()=>{var Q,P;return[e(k,{icon:(Q=c.item)!=null&&Q.inventory&&c.item.inventory.current_stock>=c.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(P=c.item)!=null&&P.inventory&&c.item.inventory.current_stock>=c.quantity_needed?"success":"error"},null,8,["icon","color"])]}),_:2},1024)]),append:t(()=>[o("div",Za,[e(E,{icon:"mdi-pencil",variant:"text",size:"small",color:"primary",onClick:Q=>Pe(c,T)},null,8,["onClick"]),e(E,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:Q=>Ae(T)},null,8,["onClick"])])]),default:t(()=>[e(Ye,{class:"font-weight-medium"},{default:t(()=>{var Q;return[d(r(((Q=c.item)==null?void 0:Q.name)||"Item tidak ditemukan")+" ",1),c.is_critical?(m(),A(ie,{key:0,color:"error",size:"x-small",variant:"tonal",class:"ms-2"},{default:t(()=>n[23]||(n[23]=[d(" Kritis ")])),_:1,__:[23]})):L("",!0)]}),_:2},1024),e(tt,null,{default:t(()=>{var Q;return[o("div",Qa,[o("span",null,"Dibutuhkan: "+r(parseFloat(c.quantity_needed))+" "+r(c.unit),1),(Q=c.item)!=null&&Q.inventory?(m(),G("span",{key:0,class:Ge(c.item.inventory.current_stock>=c.quantity_needed?"text-success":"text-error")}," Stok: "+r(c.item.inventory.current_stock)+" "+r(c.unit),3)):L("",!0),c.formatted_total_cost?(m(),G("span",Xa,r(c.formatted_total_cost),1)):L("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1}),e(Re,{class:"pa-6 pt-0"},{default:t(()=>[e(E,{color:"warning",variant:"outlined","prepend-icon":"mdi-calculator",onClick:l},{default:t(()=>n[24]||(n[24]=[d(" Setting HPP ")])),_:1,__:[24]}),e(Oe),e(E,{variant:"outlined",onClick:Je},{default:t(()=>n[25]||(n[25]=[d(" Batal ")])),_:1,__:[25]}),e(E,{color:"primary",onClick:Qe,loading:g.value},{default:t(()=>n[26]||(n[26]=[d(" Simpan Komposisi ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1}),e(at,{modelValue:z.value,"onUpdate:modelValue":n[5]||(n[5]=c=>z.value=c),color:"error",location:"top",timeout:5e3},{actions:t(()=>[e(E,{color:"white",variant:"text",onClick:n[4]||(n[4]=c=>z.value=!1)},{default:t(()=>n[27]||(n[27]=[d(" Tutup ")])),_:1,__:[27]})]),default:t(()=>[d(r(f.value)+" ",1)]),_:1},8,["modelValue"]),e(at,{modelValue:x.value,"onUpdate:modelValue":n[7]||(n[7]=c=>x.value=c),color:"success",location:"top",timeout:3e3},{actions:t(()=>[e(E,{color:"white",variant:"text",onClick:n[6]||(n[6]=c=>x.value=!1)},{default:t(()=>n[28]||(n[28]=[d(" Tutup ")])),_:1,__:[28]})]),default:t(()=>[d(r(N.value)+" ",1)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(Bt,{modelValue:ve.value,"onUpdate:modelValue":n[9]||(n[9]=c=>ve.value=c),"product-id":parseInt(String(((s=D.product)==null?void 0:s.id_product)||((w=D.product)==null?void 0:w.id)||"0")),"product-name":((B=D.product)==null?void 0:B.product_name)||((F=D.product)==null?void 0:F.name),onHppUpdated:u,onPriceUpdated:n[10]||(n[10]=c=>U("refresh"))},null,8,["modelValue","product-id","product-name"])],64)}}}),zt=qe(Ya,[["__scopeId","data-v-8422e870"]]),el={class:"product-selection"},tl={key:0,class:"text-center pa-4"},al={key:1,class:"product-list",style:{"max-height":"400px","overflow-y":"auto"}},ll={class:"d-flex flex-column align-end"},ol={key:0,class:"text-body-2 text-primary font-weight-medium"},sl={key:2,class:"text-center pa-8"},il={class:"text-h6 mt-2 text-medium-emphasis"},nl={class:"text-body-2 text-medium-emphasis"},rl=Fe({__name:"ProductSelectionList",emits:["select"],setup(S,{emit:ye}){const H=ye,U=I([]),O=I(!1),g=I(""),j=async()=>{try{O.value=!0;const x=await sa.getAll({per_page:100,search:g.value,active:!0});x.success&&(U.value=x.data||[])}catch(x){console.error("Error fetching products:",x)}finally{O.value=!1}},z=x=>{H("select",x)};return et(()=>{j()}),(x,f)=>(m(),G("div",el,[e(he,{modelValue:g.value,"onUpdate:modelValue":[f[0]||(f[0]=N=>g.value=N),j],label:"Cari produk...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",class:"mb-3"},null,8,["modelValue"]),O.value?(m(),G("div",tl,[e(it,{indeterminate:"",color:"primary"}),f[1]||(f[1]=o("div",{class:"mt-2"},"Memuat produk...",-1))])):U.value.length>0?(m(),G("div",al,[e(nt,{density:"compact"},{default:t(()=>[(m(!0),G(ze,null,We(U.value,N=>(m(),A(je,{key:N.id_product||N.id,class:"product-item",onClick:_=>z(N),style:{cursor:"pointer"},ripple:!0},{prepend:t(()=>[N.image_url?(m(),A(Ve,{key:0,image:N.image_url,size:"32",class:"me-3"},null,8,["image"])):(m(),A(k,{key:1,icon:"mdi-package-variant",size:"32",color:"grey-lighten-1",class:"me-3"}))]),append:t(()=>[o("div",ll,[N.price?(m(),G("div",ol,r(N.formatted_price||K(He)(N.price)),1)):L("",!0),e(k,{icon:"mdi-chevron-right",size:"16",color:"grey-lighten-1"})])]),default:t(()=>[e(Ye,{class:"text-body-2"},{default:t(()=>[d(r(N.name),1)]),_:2},1024),N.sku?(m(),A(tt,{key:0,class:"text-caption"},{default:t(()=>[d(" SKU: "+r(N.sku),1)]),_:2},1024)):L("",!0)]),_:2},1032,["onClick"]))),128))]),_:1})])):(m(),G("div",sl,[e(k,{icon:"mdi-package-variant-closed",size:"64",color:"grey-lighten-2"}),o("div",il,r(g.value?"Tidak ada produk ditemukan":"Belum ada produk"),1),o("div",nl,r(g.value?"Coba ubah kata kunci pencarian":"Tambah produk terlebih dahulu"),1)]))]))}}),ul=qe(rl,[["__scopeId","data-v-1280b878"]]),dl={class:"composition-cards"},cl={class:"d-flex gap-2"},ml={key:1,class:"text-center pa-12"},vl={key:2,class:"text-center pa-12"},pl={class:"d-flex align-center gap-3"},fl={class:"flex-grow-1 min-width-0"},gl={class:"text-h6 font-weight-bold text-truncate"},_l={class:"text-caption text-medium-emphasis mb-0"},kl={class:"d-flex align-center gap-2 mb-3"},yl={class:"text-body-2 font-weight-medium"},bl={class:"composition-items"},hl={class:"d-flex align-center gap-2 flex-grow-1 min-width-0"},xl={class:"text-body-2 text-truncate"},wl={class:"text-end flex-shrink-0"},Pl={class:"text-body-2 font-weight-medium"},Vl={key:0,class:"text-caption text-success"},Cl={key:1,class:"text-caption text-primary"},$l={class:"d-flex justify-between align-center mb-3"},Sl={class:"text-h6 font-weight-bold text-primary"},Il={class:"d-flex gap-2"},Dl={key:4,class:"d-flex justify-center mt-6"},zl={key:5,class:"text-center mt-4"},Tl={class:"d-flex align-center"},Ul={class:"d-flex align-center gap-4"},Al={class:"flex-grow-1"},Hl={class:"text-h5 font-weight-bold mb-2"},Ml={class:"d-flex align-center gap-4 mb-2"},Kl={class:"text-body-2"},Bl={class:"d-flex align-center gap-4"},Fl={class:"text-h6 text-primary font-weight-bold"},El={class:"text-body-2 text-info font-weight-medium"},Rl={key:0,class:"text-body-2 text-success font-weight-medium"},ql={class:"d-flex align-center mt-1 gap-4"},Ll={class:"d-flex align-center"},Nl={class:"d-flex align-center"},Ol={key:0,class:"d-flex align-center"},jl={class:"text-primary font-weight-medium"},Jl={key:1,class:"text-center py-8"},Wl={class:"text-h6 font-weight-bold"},Gl={class:"text-h6 font-weight-bold"},Ql={class:"text-h6 font-weight-bold"},Xl={class:"text-h6 font-weight-bold"},Zl={class:"text-h6 font-weight-bold"},Yl=Fe({__name:"ProductCompositionCards",props:{productItems:{},loading:{type:Boolean}},emits:["refresh","edit-composition","view-details"],setup(S,{emit:ye}){const H=S,U=ye,O=I(!1),g=I(!1),j=I(!1),z=I(null),x=I([]),f=I(null),N=I(1),_=I(12),M=I({search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}),ve=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],ge=[{title:"Nama A-Z",value:"name_asc"},{title:"Nama Z-A",value:"name_desc"},{title:"Harga Tertinggi",value:"price_desc"},{title:"Harga Terendah",value:"price_asc"},{title:"Item Terbanyak",value:"items_desc"},{title:"Item Tersedikit",value:"items_asc"}],V=i=>{z.value=i,x.value=i.items||[],O.value=!0},re=()=>{j.value=!0},ue=i=>{z.value=i,x.value=[],j.value=!1,O.value=!0},W=()=>{U("refresh"),C()},de=i=>{f.value=i,g.value=!0},b=()=>{M.value={search:"",stockStatus:"",itemType:"",criticalOnly:!1,sortBy:"name_asc"}},v=me(()=>!!(M.value.search||M.value.stockStatus||M.value.itemType||M.value.criticalOnly||M.value.sortBy!=="name_asc")),y=me(()=>{let i=0;return M.value.search&&i++,M.value.stockStatus&&i++,M.value.itemType&&i++,M.value.criticalOnly&&i++,M.value.sortBy!=="name_asc"&&i++,i}),p=me(()=>{const i=new Map;H.productItems.forEach(l=>{if(!l.product)return;const u=l.product.id_product||l.product.id;i.has(u)||i.set(u,{...l.product,items:[],totalItems:0}),i.get(u).items.push(l),i.get(u).totalItems++});let a=Array.from(i.values());if(M.value.search){const l=M.value.search.toLowerCase();a=a.filter(u=>u.name.toLowerCase().includes(l)||u.sku&&u.sku.toLowerCase().includes(l)||u.items.some(ee=>{var q;return(q=ee.item)==null?void 0:q.name.toLowerCase().includes(l)}))}return M.value.stockStatus&&(a=a.filter(l=>{const u=X(l);switch(M.value.stockStatus){case"safe":return u.color==="success";case"critical":return u.color==="warning";case"out":return u.color==="error";default:return!0}})),M.value.criticalOnly&&(a=a.filter(l=>l.items.some(u=>u.is_critical))),a.sort((l,u)=>{switch(M.value.sortBy){case"name_asc":return l.name.localeCompare(u.name);case"name_desc":return u.name.localeCompare(l.name);case"price_asc":return(l.price||0)-(u.price||0);case"price_desc":return(u.price||0)-(l.price||0);case"items_asc":return l.totalItems-u.totalItems;case"items_desc":return u.totalItems-l.totalItems;default:return l.name.localeCompare(u.name)}}),a}),R=me(()=>Math.ceil(p.value.length/_.value)),h=me(()=>{const i=(N.value-1)*_.value,a=i+_.value;return p.value.slice(i,a)}),X=i=>{let a=!1,l=!1;return i.items.forEach(u=>{var ee;if((ee=u.item)!=null&&ee.inventory){const q=u.item.inventory.current_stock||0,ce=u.quantity_needed||0;q<=0?a=!0:(q<ce||u.is_critical)&&(l=!0)}}),a?{text:"Stok Habis",color:"error"}:l?{text:"Stok Kritis",color:"warning"}:{text:"Stok Aman",color:"success"}},ne=i=>{if(!(i!=null&&i.inventory))return"grey";const a=i.inventory.current_stock||0;return a<=0?"error":a<=10?"warning":"success"},ke=i=>{if(!(i!=null&&i.inventory))return"Tidak ada data";const a=i.inventory.current_stock||0;return a<=0?"Habis":a<=10?"Rendah":"Aman"},fe=i=>{const a=ne(i);return{"text-error":a==="error","text-warning":a==="warning","text-success":a==="success","text-grey":a==="grey"}},ae=i=>`Item Komposisi (${i})`,J=i=>{N.value=i},C=()=>{N.value=1};return we(()=>[M.value.search,M.value.stockStatus,M.value.criticalOnly,M.value.sortBy],()=>{C()}),(i,a)=>(m(),G("div",dl,[e(Y,{class:"mb-6"},{default:t(()=>[e(xe,{class:"d-flex align-center justify-between"},{default:t(()=>[a[16]||(a[16]=o("div",null,[o("h2",{class:"text-h5 font-weight-bold"},"Komposisi Produk"),o("p",{class:"text-body-2 text-medium-emphasis"}," Kelola komposisi bahan untuk setiap produk ")],-1)),o("div",cl,[e(E,{color:"primary","prepend-icon":"mdi-plus",onClick:re},{default:t(()=>a[14]||(a[14]=[d(" Tambah Komposisi ")])),_:1,__:[14]}),e(E,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:a[0]||(a[0]=l=>U("refresh")),loading:i.loading},{default:t(()=>a[15]||(a[15]=[d(" Refresh ")])),_:1,__:[15]},8,["loading"])])]),_:1,__:[16]})]),_:1}),e(Y,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(te,null,{default:t(()=>[e($e,null,{default:t(()=>[e($,{cols:"12",md:"3"},{default:t(()=>[e(he,{modelValue:M.value.search,"onUpdate:modelValue":a[1]||(a[1]=l=>M.value.search=l),label:"Cari Produk",placeholder:"Nama produk, SKU, atau item...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:M.value.stockStatus,"onUpdate:modelValue":a[2]||(a[2]=l=>M.value.stockStatus=l),items:ve,label:"Status Stok",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-chart-line","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:M.value.sortBy,"onUpdate:modelValue":a[3]||(a[3]=l=>M.value.sortBy=l),items:ge,label:"Urutkan",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-sort","hide-details":""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3",class:"d-flex align-center"},{default:t(()=>[e(ua,{modelValue:M.value.criticalOnly,"onUpdate:modelValue":a[4]||(a[4]=l=>M.value.criticalOnly=l),label:"Hanya Item Kritis",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e($e,{class:"mt-3"},{default:t(()=>[e($,{cols:"12",md:"6",class:"d-flex align-center gap-2"},{default:t(()=>[e(E,{variant:"outlined",color:"grey",size:"small","prepend-icon":"mdi-filter-off",onClick:b,disabled:!v.value},{default:t(()=>a[17]||(a[17]=[d(" Reset Filter ")])),_:1,__:[17]},8,["disabled"]),v.value?(m(),A(ie,{key:0,color:"primary",variant:"tonal",size:"small"},{default:t(()=>[d(r(y.value)+" filter aktif ",1)]),_:1})):L("",!0)]),_:1}),e($,{cols:"12",md:"6",class:"d-flex align-center justify-end"},{default:t(()=>[e(ie,{color:p.value.length>0?"success":"default",variant:"tonal","prepend-icon":"mdi-package-variant"},{default:t(()=>[d(r(p.value.length)+" Produk dengan Komposisi ",1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),!i.loading&&p.value.length===0&&v.value?(m(),A(Ke,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada produk yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):L("",!0),i.loading?(m(),G("div",ml,[e(it,{color:"primary",indeterminate:"",size:"64"}),a[18]||(a[18]=o("div",{class:"mt-4 text-h6"},"Memuat komposisi...",-1))])):p.value.length===0?(m(),G("div",vl,[e(k,{icon:"mdi-chef-hat-off",size:"96",class:"text-disabled mb-6"}),a[20]||(a[20]=o("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Komposisi Produk",-1)),a[21]||(a[21]=o("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat komposisi untuk produk Anda agar dapat melihat detail bahan yang dibutuhkan ",-1)),e(E,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:re},{default:t(()=>a[19]||(a[19]=[d(" Buat Komposisi Pertama ")])),_:1,__:[19]})])):(m(),A($e,{key:3},{default:t(()=>[(m(!0),G(ze,null,We(h.value,l=>(m(),A($,{key:l.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(Y,{class:Ge(["composition-card h-100",{"border-error":X(l).color==="error"}]),elevation:"2"},{default:t(()=>[e(xe,{class:"pa-4 pb-2"},{default:t(()=>[o("div",pl,[e(Ve,{image:l.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[l.image_url?L("",!0):(m(),A(k,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),o("div",fl,[o("h3",gl,r(l.name),1),o("p",_l,r(l.sku||"SKU-"+l.id_product),1)])])]),_:2},1024),e(te,{class:"py-2"},{default:t(()=>[e(ie,{color:X(l).color,size:"small",variant:"tonal",class:"mb-3"},{default:t(()=>[d(r(X(l).text),1)]),_:2},1032,["color"]),o("div",kl,[e(k,{icon:"mdi-format-list-bulleted",size:"16"}),o("span",yl,r(ae(l.totalItems)),1)]),o("div",bl,[(m(!0),G(ze,null,We(l.items,u=>{var ee,q,ce,Pe;return m(),G("div",{key:u.id_product_item,class:"composition-item d-flex align-center justify-between mb-2"},[o("div",hl,[e(k,{icon:(ee=u.item)!=null&&ee.inventory&&u.item.inventory.current_stock>=u.quantity_needed?"mdi-check-circle":"mdi-alert-circle",color:(q=u.item)!=null&&q.inventory&&u.item.inventory.current_stock>=u.quantity_needed?"success":"error",size:"16"},null,8,["icon","color"]),o("span",xl,r(((ce=u.item)==null?void 0:ce.name)||"Item tidak ditemukan"),1),u.is_critical?(m(),A(ie,{key:0,color:"error",size:"x-small",variant:"tonal"},{default:t(()=>a[22]||(a[22]=[d(" Kritis ")])),_:1,__:[22]})):L("",!0)]),o("div",wl,[o("div",Pl,r(parseFloat(u.quantity_needed))+" "+r(u.unit),1),(Pe=u.item)!=null&&Pe.inventory?(m(),G("div",Vl," Stok: "+r(u.item.inventory.current_stock)+" "+r(u.unit),1)):L("",!0),u.formatted_total_cost?(m(),G("div",Cl,r(u.formatted_total_cost),1)):L("",!0)])])}),128))])]),_:2},1024),e(te,{class:"pt-0"},{default:t(()=>[e(Te,{class:"mb-3"}),o("div",$l,[a[23]||(a[23]=o("span",{class:"text-body-2"},"Harga:",-1)),o("span",Sl,r(K(He)(l.price||0)),1)]),o("div",Il,[e(E,{color:"primary",size:"small","prepend-icon":"mdi-eye",onClick:u=>de(l)},{default:t(()=>a[24]||(a[24]=[d(" Detail ")])),_:2,__:[24]},1032,["onClick"]),e(E,{color:"secondary",variant:"outlined",size:"small","prepend-icon":"mdi-cog",onClick:u=>V(l)},{default:t(()=>a[25]||(a[25]=[d(" Kelola ")])),_:2,__:[25]},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),p.value.length>_.value?(m(),G("div",Dl,[e(da,{modelValue:N.value,"onUpdate:modelValue":[a[5]||(a[5]=l=>N.value=l),J],length:R.value,"total-visible":i.$vuetify.display.smAndDown?5:7,size:"small"},null,8,["modelValue","length","total-visible"])])):L("",!0),p.value.length>0?(m(),G("div",zl,[e(ie,{variant:"tonal",color:"primary",size:"small"},{default:t(()=>[d(" Menampilkan "+r((N.value-1)*_.value+1)+"-"+r(Math.min(N.value*_.value,p.value.length))+" dari "+r(p.value.length)+" produk ",1)]),_:1})])):L("",!0),e(zt,{modelValue:O.value,"onUpdate:modelValue":a[6]||(a[6]=l=>O.value=l),product:z.value,items:x.value,onSave:W,onRefresh:a[7]||(a[7]=l=>U("refresh"))},null,8,["modelValue","product","items"]),e(Ee,{modelValue:g.value,"onUpdate:modelValue":a[11]||(a[11]=l=>g.value=l),"max-width":"900",scrollable:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",Tl,[e(k,{icon:"mdi-eye",class:"mr-2",color:"primary"}),a[26]||(a[26]=o("span",null,"Detail Komposisi Produk",-1))]),e(E,{icon:"",variant:"text",onClick:a[8]||(a[8]=l=>g.value=!1)},{default:t(()=>[e(k,{icon:"mdi-close"})]),_:1})]),_:1}),e(Te),f.value?(m(),A(te,{key:0},{default:t(()=>[e(ma,null,{default:t(()=>[e($e,null,{default:t(()=>[e($,{cols:"12"},{default:t(()=>[e(Y,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(te,null,{default:t(()=>[o("div",Ul,[e(Ve,{image:f.value.image_url,size:"80"},{default:t(()=>[f.value.image_url?L("",!0):(m(),A(k,{key:0,icon:"mdi-coffee",size:"40"}))]),_:1},8,["image"]),o("div",Al,[o("h2",Hl,r(f.value.name),1),o("div",Ml,[e(ie,{color:X(f.value).color,variant:"tonal",size:"small"},{default:t(()=>[d(r(X(f.value).text),1)]),_:1},8,["color"]),o("span",Kl,"SKU: "+r(f.value.sku||"-"),1)]),o("div",Bl,[o("div",Fl,r(K(He)(f.value.price||0)),1),o("div",El," HPP: "+r(K(He)(f.value.hpp||f.value.cost||0)),1),f.value.price&&(f.value.hpp||f.value.cost)?(m(),G("div",Rl," Margin: "+r(K(He)((f.value.price||0)-(f.value.hpp||f.value.cost||0))),1)):L("",!0)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e($e,null,{default:t(()=>[e($,{cols:"12"},{default:t(()=>[e(Y,{variant:"outlined"},{default:t(()=>[e(xe,{class:"text-h6"},{default:t(()=>[e(k,{icon:"mdi-format-list-bulleted",class:"mr-2"}),d(" Komposisi Item ("+r(f.value.totalItems||0)+") ",1)]),_:1}),e(te,null,{default:t(()=>[f.value.items&&f.value.items.length>0?(m(),A(nt,{key:0},{default:t(()=>[(m(!0),G(ze,null,We(f.value.items,(l,u)=>(m(),A(je,{key:l.id_product_item,class:"px-0"},{prepend:t(()=>[e(Ve,{size:"40",color:ne(l.item),variant:"tonal"},{default:t(()=>{var ee;return[e(k,{icon:(ee=l.item)!=null&&ee.inventory&&l.item.inventory.current_stock>=l.quantity_needed?"mdi-check":"mdi-alert"},null,8,["icon"])]}),_:2},1032,["color"])]),append:t(()=>[e(ie,{color:ne(l.item),variant:"tonal",size:"small"},{default:t(()=>[d(r(ke(l.item)),1)]),_:2},1032,["color"])]),default:t(()=>[e(Ye,{class:"font-weight-medium"},{default:t(()=>{var ee;return[d(r(((ee=l.item)==null?void 0:ee.name)||"Unknown Item")+" ",1),l.is_critical?(m(),A(ie,{key:0,color:"error",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>a[27]||(a[27]=[d(" Kritis ")])),_:1,__:[27]})):L("",!0)]}),_:2},1024),e(tt,null,{default:t(()=>{var ee,q;return[o("div",ql,[o("div",Ll,[e(k,{icon:"mdi-scale",size:"14",class:"mr-1"}),o("span",null," Kebutuhan: "+r(Number(l.quantity_needed||0).toLocaleString("id-ID"))+" "+r(l.unit),1)]),o("div",Nl,[e(k,{icon:"mdi-warehouse",size:"14",class:"mr-1"}),o("span",{class:Ge(fe(l.item))}," Stok: "+r(Number(((q=(ee=l.item)==null?void 0:ee.inventory)==null?void 0:q.current_stock)||0).toLocaleString("id-ID"))+" "+r(l.unit),3)]),l.formatted_total_cost?(m(),G("div",Ol,[e(k,{icon:"mdi-currency-usd",size:"14",class:"mr-1"}),o("span",jl,r(l.formatted_total_cost),1)])):L("",!0)])]}),_:2},1024),u<f.value.items.length-1?(m(),A(Te,{key:0,class:"mt-3"})):L("",!0)]),_:2},1024))),128))]),_:1})):(m(),G("div",Jl,[e(k,{icon:"mdi-package-variant-closed",size:"48",color:"grey-lighten-1",class:"mb-2"}),a[28]||(a[28]=o("p",{class:"text-body-1 text-grey"}," Belum ada komposisi item untuk produk ini ",-1))]))]),_:1})]),_:1})]),_:1})]),_:1}),e($e,{class:"mt-4"},{default:t(()=>[e($,{cols:"12",md:"2"},{default:t(()=>[e(Y,{variant:"outlined",color:"primary"},{default:t(()=>[e(te,{class:"text-center"},{default:t(()=>[e(k,{icon:"mdi-format-list-bulleted",size:"24",class:"mb-2"}),o("div",Wl,r(f.value.totalItems||0),1),a[29]||(a[29]=o("div",{class:"text-caption"},"Total Item",-1))]),_:1,__:[29]})]),_:1})]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Y,{variant:"outlined",color:"warning"},{default:t(()=>[e(te,{class:"text-center"},{default:t(()=>{var l;return[e(k,{icon:"mdi-alert",size:"24",class:"mb-2"}),o("div",Gl,r(((l=f.value.items)==null?void 0:l.filter(u=>u.is_critical).length)||0),1),a[30]||(a[30]=o("div",{class:"text-caption"},"Item Kritis",-1))]}),_:1,__:[30]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"info"},{default:t(()=>[e(te,{class:"text-center"},{default:t(()=>[e(k,{icon:"mdi-calculator",size:"24",class:"mb-2"}),o("div",Ql,r(K(He)(f.value.hpp||f.value.cost||0)),1),a[31]||(a[31]=o("div",{class:"text-caption"},"HPP",-1))]),_:1,__:[31]})]),_:1})]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Y,{variant:"outlined",color:"success"},{default:t(()=>[e(te,{class:"text-center"},{default:t(()=>[e(k,{icon:"mdi-currency-usd",size:"24",class:"mb-2"}),o("div",Xl,r(K(He)(f.value.price||0)),1),a[32]||(a[32]=o("div",{class:"text-caption"},"Harga Jual",-1))]),_:1,__:[32]})]),_:1})]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Y,{variant:"outlined",color:"purple"},{default:t(()=>[e(te,{class:"text-center"},{default:t(()=>[e(k,{icon:"mdi-trending-up",size:"24",class:"mb-2"}),o("div",Zl,r(K(He)((f.value.price||0)-(f.value.hpp||f.value.cost||0))),1),a[33]||(a[33]=o("div",{class:"text-caption"},"Margin",-1))]),_:1,__:[33]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):L("",!0),e(Te),e(Re,{class:"pa-4"},{default:t(()=>[e(Oe),e(E,{variant:"outlined",onClick:a[9]||(a[9]=l=>g.value=!1)},{default:t(()=>a[34]||(a[34]=[d(" Tutup ")])),_:1,__:[34]}),e(E,{color:"secondary",variant:"outlined","prepend-icon":"mdi-cog",onClick:a[10]||(a[10]=()=>{g.value=!1,V(f.value)})},{default:t(()=>a[35]||(a[35]=[d(" Kelola Komposisi ")])),_:1,__:[35]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ee,{modelValue:j.value,"onUpdate:modelValue":a[13]||(a[13]=l=>j.value=l),"max-width":"600px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-between pa-4"},{default:t(()=>[a[36]||(a[36]=o("span",{class:"text-h6"},"Pilih Produk untuk Komposisi",-1)),e(E,{variant:"text",icon:"mdi-close",size:"small",onClick:a[12]||(a[12]=l=>j.value=!1)})]),_:1,__:[36]}),e(te,{class:"pa-4"},{default:t(()=>[e(ul,{onSelect:ue})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),eo=qe(Yl,[["__scopeId","data-v-e2cb9847"]]),to={class:"d-flex align-center gap-2"},ao={class:"text-white"},lo={class:"text-h6 mb-4 d-flex align-center gap-2"},oo={class:"text-h6 mb-4 d-flex align-center gap-2"},so={class:"d-flex flex-column gap-2"},io={key:0,class:"d-flex align-center gap-2"},no={class:"d-flex align-center gap-2 mb-2"},ro={class:"d-flex gap-2"},uo={class:"d-flex gap-2"},co={class:"d-flex align-center justify-space-between"},mo={class:"d-flex align-center gap-2"},vo={class:"text-end"},po={class:"text-h6 font-weight-bold"},fo={class:"text-caption"},go={class:"text-h6 mb-4 d-flex align-center gap-2"},_o={class:"text-h6 mb-4 d-flex align-center gap-2"},ko={class:"image-upload-container"},yo={key:0,class:"mb-4"},bo={class:"text-center mt-2"},ho={class:"text-h6 mb-4 d-flex align-center gap-2"},xo={class:"text-h6 mb-4 d-flex align-center gap-2"},wo={class:"text-h6 mb-4 d-flex align-center gap-2"},Po={class:"d-flex align-center"},Vo={class:"text-subtitle-1"},Co={class:"text-body-1"},$o={class:"d-flex align-center"},So={class:"text-subtitle-1"},Io=Fe({__name:"ProductDialog",props:{modelValue:{type:Boolean},editMode:{type:Boolean},formData:{},categories:{},loading:{type:Boolean},errorMessage:{},successMessage:{},selectedImage:{},imagePreview:{},useDialogError:{type:Boolean}},emits:["update:modelValue","close","submit","image-change","remove-image","clear-error","clear-success","update-form"],setup(S,{emit:ye}){var J,C,i;const H=It(),{nameRules:U,categoryRules:O}=Dt(),{getProductHPPBreakdown:g}=_t(),j=I(!1),z=I(!1),x=async()=>{if(!(!_.editMode||!V.id))try{const a=await fetch(`/api/products/${V.id}/items`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(a.ok){const l=await a.json();z.value=l.success&&l.data&&l.data.length>0}}catch(a){console.error("Error checking HPP status:",a)}},f=async()=>{if(V.id)try{j.value=!0;const a=await g(V.id,"latest");a&&(V.cost=a.total_hpp,ve("update-form","cost",a.total_hpp))}catch(a){console.error("Error refreshing HPP:",a)}finally{j.value=!1}},N=()=>{},_=S,M=me(()=>_.errorMessage),ve=ye,ge=I(),V=gt({..._.formData,available_in_kitchen:!!_.formData.available_in_kitchen,available_in_bar:!!_.formData.available_in_bar});we(()=>_.formData,a=>{const l={...a,available_in_kitchen:!!a.available_in_kitchen,available_in_bar:!!a.available_in_bar};Object.assign(V,l)},{deep:!0}),we(V,a=>{Object.keys(a).forEach(l=>{ve("update-form",l,a[l])})},{deep:!0}),we(()=>_.modelValue,a=>{a&&_.editMode&&x()});const re=gt({length:((J=_.formData.dimensions)==null?void 0:J.length)||null,width:((C=_.formData.dimensions)==null?void 0:C.width)||null,height:((i=_.formData.dimensions)==null?void 0:i.height)||null});we(re,a=>{const l=a.length!==null||a.width!==null||a.height!==null;V.dimensions=l?{length:a.length!==null?a.length:void 0,width:a.width!==null?a.width:void 0,height:a.height!==null?a.height:void 0}:{}},{deep:!0});const ue=[{title:"Draft",value:"draft"},{title:"Published",value:"published"},{title:"Archived",value:"archived"}],W=me(()=>{if(!V.price||!V.cost||V.cost<=0)return 0;const a=(V.price-V.cost)/V.cost*100;return Math.ceil(a)}),de=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),b=a=>a<10?"error":a<25?"warning":a<50?"success":"info",v=a=>a<10?"tabler-trending-down":a<25?"tabler-trending-up":a<50?"tabler-trending-up-2":"tabler-trending-up-3",y=a=>!a||a===0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),p=a=>{if(!a||a.trim()===""||a==="Rp 0")return 0;const u=a.replace(/[^\d,.-]/g,"").replace(/\./g,"").replace(",",".");return parseFloat(u)||0},R=I(!1),h=a=>{const l=p(a);V.price=l},X=()=>{R.value=!0},ne=()=>{R.value=!1},ke=async()=>{var l;const{valid:a}=await((l=ge.value)==null?void 0:l.validate());a&&ve("submit",V)},fe=a=>{ve("image-change",a)},ae=()=>{ve("remove-image")};return(a,l)=>(m(),A(Ee,{"model-value":a.modelValue,"max-width":"900px",persistent:"",scrollable:"","onUpdate:modelValue":l[27]||(l[27]=u=>a.$emit("update:modelValue",u))},{default:t(()=>[e(Y,{class:"product-dialog coffee-dialog"},{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between coffee-header"},{default:t(()=>[o("div",to,[e(k,{icon:a.editMode?"tabler-edit":"tabler-plus",class:"text-white"},null,8,["icon"]),o("span",ao,r(a.editMode?"Edit Produk":"Tambah Produk Baru"),1)]),e(E,{icon:"tabler-x",variant:"text",color:"white",onClick:l[0]||(l[0]=u=>a.$emit("close"))})]),_:1}),e(Te),e(te,{class:"pa-6"},{default:t(()=>[e(bt,{ref_key:"formRef",ref:ge,onSubmit:kt(ke,["prevent"])},{default:t(()=>[e($e,null,{default:t(()=>[e($,{cols:"12"},{default:t(()=>[o("h6",lo,[e(k,{icon:"tabler-info-circle",size:"20",class:"coffee-icon"}),l[28]||(l[28]=d(" Informasi Dasar "))])]),_:1}),e($,{cols:"12",md:"8"},{default:t(()=>[e(he,{modelValue:V.name,"onUpdate:modelValue":l[1]||(l[1]=u=>V.name=u),label:"Nama Produk",placeholder:"Masukkan nama produk",rules:K(U),required:"",variant:"outlined"},null,8,["modelValue","rules"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:V.sku,"onUpdate:modelValue":l[2]||(l[2]=u=>V.sku=u),label:"SKU",placeholder:"Auto generate jika kosong",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ct,{modelValue:V.description,"onUpdate:modelValue":l[3]||(l[3]=u=>V.description=u),label:"Deskripsi Produk",placeholder:"Masukkan deskripsi produk",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(Be,{"model-value":V.category_id,"onUpdate:modelValue":l[4]||(l[4]=u=>V.category_id=u),items:a.categories,"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Pilih kategori",rules:K(O),required:"",variant:"outlined"},null,8,["model-value","items","rules"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(he,{modelValue:V.brand,"onUpdate:modelValue":l[5]||(l[5]=u=>V.brand=u),label:"Brand/Merek",placeholder:"Masukkan brand produk",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",oo,[e(k,{icon:"tabler-currency-dollar",size:"20",class:"coffee-icon"}),l[29]||(l[29]=d(" Harga & Biaya "))])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(he,{"model-value":y(V.price),"onUpdate:modelValue":l[6]||(l[6]=u=>h(u)),label:"Harga Jual",placeholder:"Rp 0",required:"",variant:"outlined",onFocus:X,onBlur:ne},null,8,["model-value"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[o("div",so,[e(he,{"model-value":y(V.cost),label:"Harga Pokok Penjualan (HPP)",placeholder:"Auto-calculated dari bahan baku",variant:"outlined",readonly:"","append-inner-icon":"mdi-calculator",hint:"HPP dihitung otomatis berdasarkan harga bahan baku","persistent-hint":""},null,8,["model-value"]),a.editMode?(m(),G("div",io,[e(ie,{color:z.value?"success":"warning",size:"small",variant:"tonal"},{default:t(()=>[e(k,{icon:z.value?"tabler-calculator":"tabler-alert-circle",size:"14",class:"me-1"},null,8,["icon"]),d(" "+r(z.value?"Auto HPP Active":"Setup Required"),1)]),_:1},8,["color"]),z.value?(m(),A(E,{key:0,size:"small",variant:"outlined",color:"primary",onClick:f,loading:j.value},{default:t(()=>[e(k,{icon:"tabler-refresh",size:"14",class:"me-1"}),l[30]||(l[30]=d(" Update HPP "))]),_:1,__:[30]},8,["loading"])):(m(),A(Me,{key:1},{activator:t(({props:u})=>[e(ie,Ce(u,{color:"warning",size:"small",variant:"tonal"}),{default:t(()=>[e(k,{icon:"tabler-alert-circle",size:"14",class:"me-1"}),l[31]||(l[31]=d(" Belum Ada Resep "))]),_:2,__:[31]},1040)]),default:t(()=>[l[32]||(l[32]=o("span",null,"Setup resep produk untuk menghitung HPP otomatis",-1))]),_:1,__:[32]}))])):L("",!0)])]),_:1}),a.editMode?(m(),A($,{key:0,cols:"12"},{default:t(()=>[z.value?(m(),A(Ke,{key:0,color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ct,null,{default:t(()=>[e(k,{icon:"tabler-info-circle",class:"me-2"}),l[33]||(l[33]=d(" HPP Otomatis Aktif "))]),_:1,__:[33]}),l[34]||(l[34]=o("div",{class:"mt-2"}," HPP produk ini dihitung otomatis berdasarkan item/bahan yang digunakan. Untuk mengubah HPP, silakan update harga item di menu Item Management. ",-1))]),_:1,__:[34]})):(m(),A(Ke,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ct,null,{default:t(()=>[e(k,{icon:"tabler-alert-triangle",class:"me-2"}),l[35]||(l[35]=d(" HPP Manual "))]),_:1,__:[35]}),l[36]||(l[36]=o("div",{class:"mt-2"}," Produk ini menggunakan HPP manual. Untuk perhitungan otomatis, tambahkan item/bahan yang digunakan untuk produk ini. ",-1))]),_:1,__:[36]}))]),_:1})):L("",!0),e($,{cols:"12"},{default:t(()=>[z.value&&a.editMode?(m(),A(Ke,{key:0,color:"success",variant:"tonal",class:"mb-4"},{default:t(()=>[o("div",no,[e(k,{icon:"tabler-check-circle"}),l[37]||(l[37]=o("span",{class:"font-weight-medium"},"HPP Otomatis Aktif",-1))]),l[40]||(l[40]=o("div",{class:"text-body-2 mb-3"}," Produk ini sudah memiliki resep dan HPP dihitung otomatis berdasarkan harga bahan baku terkini. HPP akan update secara otomatis saat harga bahan baku berubah. ",-1)),o("div",ro,[e(E,{size:"small",color:"primary",variant:"outlined",onClick:N},{default:t(()=>[e(k,{icon:"tabler-edit",size:"14",class:"me-1"}),l[38]||(l[38]=d(" Edit Resep "))]),_:1,__:[38]}),e(E,{size:"small",variant:"outlined",color:"info",onClick:f,loading:j.value},{default:t(()=>[e(k,{icon:"tabler-refresh",size:"14",class:"me-1"}),l[39]||(l[39]=d(" Refresh HPP "))]),_:1,__:[39]},8,["loading"])])]),_:1,__:[40]})):!z.value&&a.editMode?(m(),A(Ke,{key:1,color:"warning",variant:"tonal",class:"mb-0"},{default:t(()=>[o("div",uo,[e(E,{size:"small",variant:"outlined",color:"info",onClick:l[7]||(l[7]=u=>K(H).push("/hpp-management"))},{default:t(()=>[e(k,{icon:"tabler-calculator",size:"14",class:"me-1"}),l[41]||(l[41]=d(" Lihat HPP Management "))]),_:1,__:[41]})])]),_:1})):L("",!0)]),_:1}),e($,{cols:"12"},{default:t(()=>[V.price&&V.cost&&V.cost>0?(m(),A(Ke,{key:0,color:b(W.value),variant:"tonal",class:"mb-0"},{default:t(()=>[o("div",co,[o("div",mo,[e(k,{icon:v(W.value)},null,8,["icon"]),l[42]||(l[42]=o("span",{class:"font-weight-medium"},"Profit Margin",-1))]),o("div",vo,[o("div",po,r(Math.round(W.value))+"%",1),o("div",fo," Keuntungan: "+r(de(V.price-V.cost)),1)])])]),_:1},8,["color"])):L("",!0)]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",go,[e(k,{icon:"tabler-ruler",size:"20",class:"coffee-icon"}),l[43]||(l[43]=d(" Dimensi (cm) "))])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:re.length,"onUpdate:modelValue":l[8]||(l[8]=u=>re.length=u),modelModifiers:{number:!0},label:"Panjang",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:re.width,"onUpdate:modelValue":l[9]||(l[9]=u=>re.width=u),modelModifiers:{number:!0},label:"Lebar",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:re.height,"onUpdate:modelValue":l[10]||(l[10]=u=>re.height=u),modelModifiers:{number:!0},label:"Tinggi",placeholder:"0",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",_o,[e(k,{icon:"tabler-photo",size:"20",class:"coffee-icon"}),l[44]||(l[44]=d(" Gambar Produk "))])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("div",ko,[a.imagePreview?(m(),G("div",yo,[e(ga,{src:a.imagePreview,"max-width":"200","max-height":"200",class:"mx-auto rounded"},null,8,["src"]),o("div",bo,[e(E,{size:"small",color:"error",variant:"outlined",onClick:ae},{default:t(()=>l[45]||(l[45]=[d(" Hapus Gambar ")])),_:1,__:[45]})])])):L("",!0),e(_a,{"model-value":a.selectedImage,"onUpdate:modelValue":l[11]||(l[11]=u=>fe(Array.isArray(u)?u:[u])),label:"Upload Gambar","prepend-icon":"tabler-camera",accept:"image/*",variant:"outlined"},null,8,["model-value"]),l[46]||(l[46]=o("div",{class:"text-caption text-medium-emphasis mt-1"}," Format: JPG, JPEG, PNG, GIF. Maksimal 2MB. ",-1))])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",ho,[e(k,{icon:"tabler-settings",size:"20",class:"coffee-icon"}),l[47]||(l[47]=d(" Pengaturan "))])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(Be,{"model-value":V.status,"onUpdate:modelValue":l[12]||(l[12]=u=>V.status=u),items:ue,label:"Status Publikasi",variant:"outlined"},null,8,["model-value"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(Ze,{"model-value":V.active,"onUpdate:modelValue":l[13]||(l[13]=u=>V.active=u??!1),label:"Produk Aktif",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(Ze,{"model-value":V.featured,"onUpdate:modelValue":l[14]||(l[14]=u=>V.featured=u??!1),label:"Produk Unggulan",color:"coffee",inset:""},null,8,["model-value"])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",xo,[e(k,{icon:"tabler-tools-kitchen-2",size:"20",class:"coffee-icon"}),l[48]||(l[48]=d(" Ketersediaan Station "))])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(Ze,{"model-value":V.available_in_kitchen,"onUpdate:modelValue":l[15]||(l[15]=u=>V.available_in_kitchen=!!u),label:"Tersedia di Kitchen",color:"coffee",inset:""},{prepend:t(()=>[e(k,{icon:"tabler-chef-hat",class:"me-2",color:V.available_in_kitchen?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(Ze,{"model-value":V.available_in_bar,"onUpdate:modelValue":l[16]||(l[16]=u=>V.available_in_bar=!!u),label:"Tersedia di Bar",color:"coffee",inset:""},{prepend:t(()=>[e(k,{icon:"tabler-glass-cocktail",class:"me-2",color:V.available_in_bar?"success":"grey"},null,8,["color"])]),_:1},8,["model-value"])]),_:1}),e($,{cols:"12"},{default:t(()=>[o("h6",wo,[e(k,{icon:"tabler-seo",size:"20",class:"coffee-icon"}),l[49]||(l[49]=d(" SEO (Opsional) "))])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(he,{modelValue:V.meta_title,"onUpdate:modelValue":l[17]||(l[17]=u=>V.meta_title=u),label:"Meta Title",placeholder:"Judul untuk SEO",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ct,{modelValue:V.meta_description,"onUpdate:modelValue":l[18]||(l[18]=u=>V.meta_description=u),label:"Meta Description",placeholder:"Deskripsi untuk SEO",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Da,{"model-value":V.tags,"onUpdate:modelValue":l[19]||(l[19]=u=>V.tags=u),label:"Tags",placeholder:"Tambah tag dan tekan Enter",multiple:"",chips:"",variant:"outlined"},null,8,["model-value"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(Te),e(Re,{class:"pa-6"},{default:t(()=>[e(Oe),e(E,{variant:"outlined",class:"coffee-secondary",onClick:l[20]||(l[20]=u=>a.$emit("close"))},{default:t(()=>l[50]||(l[50]=[d(" Batal ")])),_:1,__:[50]}),e(E,{color:"primary",class:"coffee-primary",loading:a.loading,onClick:ke},{default:t(()=>[d(r(a.editMode?"Perbarui":"Simpan")+" Produk ",1)]),_:1},8,["loading"])]),_:1})]),_:1}),a.useDialogError?L("",!0):(m(),A(at,{key:0,"model-value":!!M.value,"onUpdate:modelValue":l[22]||(l[22]=u=>!u&&a.$emit("clear-error")),color:"error",location:"top right",timeout:6e3,vertical:"","multi-line":"","min-width":"320","max-width":"500"},{actions:t(()=>[e(E,{icon:"tabler-x",size:"small",variant:"text",onClick:l[21]||(l[21]=u=>a.$emit("clear-error"))})]),default:t(()=>[o("div",Po,[e(k,{icon:"tabler-alert-circle",class:"me-3",size:"28"}),o("div",null,[l[51]||(l[51]=o("div",{class:"text-h6 font-weight-bold"},"Error!",-1)),o("div",Vo,r(M.value),1)])])]),_:1},8,["model-value"])),a.useDialogError?(m(),A(Ee,{key:1,"model-value":!!M.value,"onUpdate:modelValue":l[24]||(l[24]=u=>!u&&a.$emit("clear-error")),"max-width":"400",persistent:"",class:"error-dialog"},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center text-error"},{default:t(()=>[e(k,{icon:"tabler-alert-circle",class:"me-2"}),l[52]||(l[52]=d(" Error Occurred "))]),_:1,__:[52]}),e(Te),e(te,{class:"py-4"},{default:t(()=>[o("div",Co,r(M.value),1)]),_:1}),e(Te),e(Re,{class:"justify-end pa-4"},{default:t(()=>[e(E,{color:"error",variant:"outlined",onClick:l[23]||(l[23]=u=>a.$emit("clear-error"))},{default:t(()=>l[53]||(l[53]=[d(" Close ")])),_:1,__:[53]})]),_:1})]),_:1})]),_:1},8,["model-value"])):L("",!0),e(at,{"model-value":!!a.successMessage,"onUpdate:modelValue":l[26]||(l[26]=u=>!u&&a.$emit("clear-success")),color:"success",location:"top right",timeout:4e3,vertical:"","min-width":"320","max-width":"500"},{actions:t(()=>[e(E,{icon:"tabler-x",size:"small",variant:"text",onClick:l[25]||(l[25]=u=>a.$emit("clear-success"))})]),default:t(()=>[o("div",$o,[e(k,{icon:"tabler-check-circle",class:"me-3",size:"28"}),o("div",null,[l[54]||(l[54]=o("div",{class:"text-h6 font-weight-bold"},"Berhasil!",-1)),o("div",So,r(a.successMessage),1)])])]),_:1},8,["model-value"])]),_:1},8,["model-value"]))}}),Do=qe(Io,[["__scopeId","data-v-333cc50b"]]),zo={key:0,class:"mt-4"},To={class:"d-flex align-center gap-2 mb-2"},Uo={class:"d-flex flex-wrap gap-2"},Ao=Fe({__name:"ProductSearchFilters",props:{filters:{}},emits:["update:filters","search"],setup(S,{emit:ye}){const H=S,U=ye,{categories:O,loading:g,fetchAllCategories:j}=ka(),z=I(!1),x=I("");et(async()=>{await j(),x.value=f.search||""});const f=gt({...H.filters});we(()=>H.filters,b=>{Object.assign(f,b),x.value=b.search||""},{deep:!0}),Zt(x,b=>{f.search=b,(b.length>=3||b.length===0)&&(z.value=!0,U("search",b),V(),setTimeout(()=>{z.value=!1},500))},{debounce:500,maxWait:1e3});const N=[{title:"Aktif",value:"active"},{title:"Tidak Aktif",value:"inactive"}],_=[{title:"Tersedia",value:"in_stock"},{title:"Stok Rendah",value:"low_stock"},{title:"Habis",value:"out_of_stock"}],M=[{title:"Kitchen Only",value:"kitchen"},{title:"Bar Only",value:"bar"},{title:"Kitchen & Bar",value:"both"}],ve=[{title:"Terbaru",value:"desc"},{title:"Terlama",value:"asc"}],ge=me(()=>!!(x.value||f.category_id||f.active||f.stock_status||f.station||f.featured!==null||f.min_price||f.max_price)),V=()=>{U("update:filters",{...f})},re=()=>{x.value="",Object.assign(f,{search:"",category_id:null,active:null,stock_status:null,featured:null,min_price:null,max_price:null,sort_by:"created_at",sort_order:"desc"}),V()},ue=b=>{const v=O.value.find(y=>y.id_category===b);return(v==null?void 0:v.name)||"Unknown"},W=b=>{if(!b)return"Semua";const v=N.find(y=>y.value===b);return(v==null?void 0:v.title)||String(b)},de=b=>{const v=_.find(y=>y.value===b);return(v==null?void 0:v.title)||b};return(b,v)=>(m(),A(Y,{class:"mb-6"},{default:t(()=>[e(xe,{class:"d-flex align-center gap-2"},{default:t(()=>[e(k,{icon:"tabler-filter",class:"coffee-icon"}),v[12]||(v[12]=d(" Filter & Pencarian Produk "))]),_:1,__:[12]}),e(te,null,{default:t(()=>[e($e,null,{default:t(()=>[e($,{cols:"12",md:"4"},{default:t(()=>[e(he,{modelValue:x.value,"onUpdate:modelValue":v[0]||(v[0]=y=>x.value=y),label:"Cari produk...",placeholder:"Nama, SKU, atau deskripsi (min. 3 karakter)","prepend-inner-icon":"tabler-search",loading:z.value,clearable:"",variant:"outlined",hint:x.value.length>0&&x.value.length<3?`Ketik ${3-x.value.length} karakter lagi untuk mencari`:"","persistent-hint":""},null,8,["modelValue","loading","hint"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:f.category_id,"onUpdate:modelValue":[v[1]||(v[1]=y=>f.category_id=y),V],items:K(O),"item-title":"name","item-value":"id_category",label:"Kategori",placeholder:"Semua kategori","prepend-inner-icon":"tabler-category",loading:K(g),clearable:"",variant:"outlined"},{"no-data":t(()=>[e(je,null,{default:t(()=>[e(Ye,null,{default:t(()=>[d(r(K(g)?"Memuat kategori...":"Tidak ada kategori"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:f.active,"onUpdate:modelValue":[v[2]||(v[2]=y=>f.active=y),V],items:N,label:"Status",placeholder:"Semua status","prepend-inner-icon":"tabler-toggle-left",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:f.stock_status,"onUpdate:modelValue":[v[3]||(v[3]=y=>f.stock_status=y),V],items:_,label:"Stok",placeholder:"Semua stok","prepend-inner-icon":"tabler-package",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:f.station,"onUpdate:modelValue":[v[4]||(v[4]=y=>f.station=y),V],items:M,label:"Station",placeholder:"Semua station","prepend-inner-icon":"tabler-tools-kitchen-2",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"1",class:"d-flex align-center"},{default:t(()=>[e(E,{icon:"tabler-refresh",variant:"outlined",color:"coffee",onClick:re})]),_:1})]),_:1}),e($e,{class:"mt-3"},{default:t(()=>[e($,{cols:"12",md:"3"},{default:t(()=>[e(he,{modelValue:f.min_price,"onUpdate:modelValue":v[5]||(v[5]=y=>f.min_price=y),label:"Harga Minimum",placeholder:"0","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:V},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(he,{modelValue:f.max_price,"onUpdate:modelValue":v[6]||(v[6]=y=>f.max_price=y),label:"Harga Maksimum",placeholder:"Tidak terbatas","prepend-inner-icon":"tabler-currency-dollar",type:"number",variant:"outlined",onInput:V},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(Be,{modelValue:f.sort_order,"onUpdate:modelValue":[v[7]||(v[7]=y=>f.sort_order=y),V],items:ve,label:"Urutan",placeholder:"Terbaru","prepend-inner-icon":"tabler-arrow-up",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),ge.value?(m(),G("div",zo,[o("div",To,[e(k,{icon:"tabler-filter-check",size:"small",class:"coffee-icon"}),v[13]||(v[13]=o("span",{class:"text-sm font-weight-medium"},"Filter Aktif:",-1))]),o("div",Uo,[x.value?(m(),A(ie,{key:0,closable:"",size:"small",color:"coffee","onClick:close":v[8]||(v[8]=y=>{x.value="",f.search="",V()})},{default:t(()=>[d(" Pencarian: "+r(x.value),1)]),_:1})):L("",!0),f.category_id?(m(),A(ie,{key:1,closable:"",size:"small",color:"coffee","onClick:close":v[9]||(v[9]=y=>{f.category_id=null,V()})},{default:t(()=>[d(" Kategori: "+r(ue(f.category_id)),1)]),_:1})):L("",!0),f.active?(m(),A(ie,{key:2,closable:"",size:"small",color:"coffee","onClick:close":v[10]||(v[10]=y=>{f.active=null,V()})},{default:t(()=>[d(" Status: "+r(W(f.active)),1)]),_:1})):L("",!0),f.stock_status?(m(),A(ie,{key:3,closable:"",size:"small",color:"coffee","onClick:close":v[11]||(v[11]=y=>{f.stock_status=null,V()})},{default:t(()=>[d(" Stok: "+r(de(f.stock_status)),1)]),_:1})):L("",!0)])])):L("",!0)]),_:1})]),_:1}))}}),Ho=qe(Ao,[["__scopeId","data-v-d597dc7f"]]),Mo={class:"d-flex align-center gap-2"},Ko={class:"text-h6"},Bo={class:"d-flex align-center gap-2"},Fo={class:"text-h6"},Eo={class:"d-flex align-center gap-2"},Ro={class:"text-h6"},qo={class:"d-flex align-center gap-2"},Lo={class:"text-h6"},No={class:"d-flex align-center gap-2"},Oo={class:"text-h6"},jo={class:"d-flex align-center gap-2"},Jo={class:"text-h6"},Wo={class:"d-flex align-center gap-2"},Go={class:"text-h6"},Qo={class:"d-flex align-center gap-2"},Xo={class:"text-h6"},Zo=Fe({__name:"ProductStatsCards",props:{stats:{}},setup(S){const ye=U=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(U),H=U=>`${U.toFixed(1)}%`;return(U,O)=>(m(),A($e,{class:"mb-6"},{default:t(()=>[e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(te,{class:"d-flex align-center"},{default:t(()=>{var g;return[e(Ve,{size:"44",rounded:"",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-package"})]),_:1}),o("div",null,[O[0]||(O[0]=o("span",{class:"text-sm text-medium-emphasis"},"Total Produk",-1)),o("div",Mo,[o("h6",Ko,r(((g=U.stats)==null?void 0:g.total_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(te,{class:"d-flex align-center"},{default:t(()=>{var g;return[e(Ve,{size:"44",rounded:"",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-check"})]),_:1}),o("div",null,[O[1]||(O[1]=o("span",{class:"text-sm text-medium-emphasis"},"Produk Aktif",-1)),o("div",Bo,[o("h6",Fo,r(((g=U.stats)==null?void 0:g.active_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(te,{class:"d-flex align-center"},{default:t(()=>{var g;return[e(Ve,{size:"44",rounded:"",color:"warning",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-star"})]),_:1}),o("div",null,[O[2]||(O[2]=o("span",{class:"text-sm text-medium-emphasis"},"Produk Unggulan",-1)),o("div",Eo,[o("h6",Ro,r(((g=U.stats)==null?void 0:g.featured_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(te,{class:"d-flex align-center"},{default:t(()=>{var g;return[e(Ve,{size:"44",rounded:"",color:"error",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-alert-triangle"})]),_:1}),o("div",null,[O[3]||(O[3]=o("span",{class:"text-sm text-medium-emphasis"},"Stok Rendah",-1)),o("div",qo,[o("h6",Lo,r(((g=U.stats)==null?void 0:g.low_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(te,{class:"d-flex align-center"},{default:t(()=>{var g;return[e(Ve,{size:"44",rounded:"",color:"info",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-currency-dollar"})]),_:1}),o("div",null,[O[4]||(O[4]=o("span",{class:"text-sm text-medium-emphasis"},"Nilai Stok",-1)),o("div",No,[o("h6",Oo,r(ye(((g=U.stats)==null?void 0:g.total_stock_value)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(te,{class:"d-flex align-center"},{default:t(()=>{var g;return[e(Ve,{size:"44",rounded:"",color:"secondary",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-chart-line"})]),_:1}),o("div",null,[O[5]||(O[5]=o("span",{class:"text-sm text-medium-emphasis"},"Harga Rata-rata",-1)),o("div",jo,[o("h6",Jo,r(ye(((g=U.stats)==null?void 0:g.average_price)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(te,{class:"d-flex align-center"},{default:t(()=>{var g;return[e(Ve,{size:"44",rounded:"",color:"coffee",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-trending-up"})]),_:1}),o("div",null,[O[6]||(O[6]=o("span",{class:"text-sm text-medium-emphasis"},"Margin Rata-rata",-1)),o("div",Wo,[o("h6",Go,r(H(((g=U.stats)==null?void 0:g.average_margin)||0)),1)])])]}),_:1})]),_:1})]),_:1}),e($,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(Y,{class:"stats-card"},{default:t(()=>[e(te,{class:"d-flex align-center"},{default:t(()=>{var g;return[e(Ve,{size:"44",rounded:"",color:"surface",variant:"tonal",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-x-circle"})]),_:1}),o("div",null,[O[7]||(O[7]=o("span",{class:"text-sm text-medium-emphasis"},"Stok Habis",-1)),o("div",Qo,[o("h6",Xo,r(((g=U.stats)==null?void 0:g.out_of_stock_products)||0),1)])])]}),_:1})]),_:1})]),_:1})]),_:1}))}}),Yo=qe(Zo,[["__scopeId","data-v-124783ae"]]),es={class:"d-flex align-center gap-2"},ts={class:"d-flex align-center gap-2"},as={class:"text-center py-8"},ls={class:"d-flex align-center gap-3 py-2"},os={class:"font-weight-medium"},ss={class:"text-caption text-medium-emphasis"},is={class:"text-end"},ns={class:"font-weight-medium"},rs={class:"text-caption text-medium-emphasis d-flex align-center justify-end gap-1"},us={class:"text-center profit-margin-container"},ds={class:"text-center"},cs={key:0,class:"text-caption text-medium-emphasis mt-1"},ms={class:"d-flex align-center gap-2"},vs={class:"d-flex flex-column gap-1"},ps={key:2,class:"text-caption text-medium-emphasis"},fs={class:"text-body-2"},gs={class:"text-caption text-medium-emphasis"},_s={class:"d-flex align-center gap-1"},ks=300*1e3,ys=1e3,bs=Fe({__name:"ProductTable",props:{products:{},totalItems:{},loading:{type:Boolean},currentPage:{},itemsPerPage:{},selectedProducts:{},toggleLoading:{}},emits:["add-product","view-product","edit-product","manage-recipes","open-recipe-dialog","open-composition-dialog","open-variant-dialog","delete-product","toggle-active","toggle-featured","bulk-delete","update:options","update:selected-products"],setup(S,{expose:ye}){const H=S,{currentHPPBreakdown:U,getProductHPPBreakdown:O}=_t(),g=I({}),j=I({}),z=I({}),x=I(new Set),f=I(new Set);let N=null;const _=p=>{const R=z.value[p];return R?Date.now()-R.timestamp<ks:!1},M=async()=>{if(f.value.size===0)return;const p=Array.from(f.value);f.value.clear();const R=p.filter(X=>{const ne=H.products.find(ke=>(ke.id_product||ke.id)===X);return ne&&(ne.hpp===void 0||ne.hpp===null)});if(R.length===0)return;const h=3;for(let X=0;X<R.length;X+=h){const ke=R.slice(X,X+h).map(async fe=>{var ae;if(!(j.value[fe]||_(fe))){j.value[fe]=!0,x.value.add(fe);try{if(await O(fe,"latest"),(ae=U.value)!=null&&ae.total_hpp){const J=U.value.total_hpp;g.value[fe]=J,z.value[fe]={data:J,timestamp:Date.now(),attempted:!0}}else z.value[fe]={data:0,timestamp:Date.now(),attempted:!0}}catch(J){console.warn(`Could not load HPP for product ${fe}:`,J),z.value[fe]={data:0,timestamp:Date.now(),attempted:!0}}finally{j.value[fe]=!1}}});await Promise.all(ke),X+h<p.length&&await new Promise(fe=>setTimeout(fe,500))}},ve=p=>{if(_(p)){g.value[p]=z.value[p].data;return}x.value.has(p)||(f.value.add(p),N&&clearTimeout(N),N=setTimeout(()=>{M()},ys))},ge=()=>{for(const p of H.products){const R=p.id_product||p.id;R&&(_(R)?g.value[R]=z.value[R].data:!x.value.has(R)&&!j.value[R]&&ve(R))}},V=p=>{const R=p.id_product||p.id;return g.value[R]||p.cost||0},re=p=>{const R=V(p),h=p.price||0;return h<=0||R<=0?0:Math.round((h-R)/h*100)};Yt(()=>{H.products&&H.products.length>0&&ge()}),et(()=>{H.products&&H.products.length>0&&ge()}),ye({refreshHPPData:async p=>{p?(delete z.value[p],delete g.value[p],x.value.delete(p),H.products.find(h=>(h.id_product||h.id)===p)&&ve(p)):(z.value={},g.value={},x.value.clear(),f.value.clear(),ge())}});const W=[{title:"Produk",key:"name",sortable:!0,width:"250px"},{title:"Kategori",key:"category",sortable:!1,width:"120px"},{title:"Harga",key:"price",sortable:!0,align:"end",width:"130px"},{title:"Margin",key:"profit_margin",sortable:!0,align:"center",width:"100px"},{title:"Stok",key:"stock",sortable:!0,align:"center",width:"100px"},{title:"Status",key:"active",sortable:!0,width:"140px"},{title:"Station",key:"station_availability",sortable:!1,width:"150px"},{title:"Dibuat",key:"created_at",sortable:!0,width:"120px"},{title:"Aksi",key:"actions",sortable:!1,align:"center",width:"200px"}],de=p=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(p),b=p=>new Date(p).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),v=p=>new Date(p).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),y=p=>p<10?"error":p<25?"warning":p<50?"success":"info";return(p,R)=>(m(),A(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",es,[e(k,{icon:"tabler-list",class:"coffee-icon"}),R[5]||(R[5]=d(" Data Produk ")),p.totalItems?(m(),A(ie,{key:0,size:"small",color:"coffee",variant:"tonal"},{default:t(()=>[d(r(p.totalItems)+" item ",1)]),_:1})):L("",!0)]),o("div",ts,[p.selectedProducts.length>0?(m(),A(E,{key:0,"prepend-icon":"tabler-trash",color:"error",variant:"outlined",onClick:R[0]||(R[0]=h=>p.$emit("bulk-delete"))},{default:t(()=>[d(" Hapus Terpilih ("+r(p.selectedProducts.length)+") ",1)]),_:1})):L("",!0),e(E,{"prepend-icon":"tabler-plus",color:"coffee",onClick:R[1]||(R[1]=h=>p.$emit("add-product"))},{default:t(()=>R[6]||(R[6]=[d(" Tambah Produk ")])),_:1,__:[6]})])]),_:1}),e(Te),e(Va,{"model-value":p.selectedProducts,"onUpdate:modelValue":R[3]||(R[3]=h=>p.$emit("update:selected-products",h)),headers:W,items:p.products,"items-length":p.totalItems,loading:p.loading,"items-per-page":p.itemsPerPage,page:p.currentPage,"show-select":"","item-value":"id",class:"products-table","onUpdate:options":R[4]||(R[4]=h=>p.$emit("update:options",h))},{loading:t(()=>[e(Ca,{type:"table-row@10"})]),"no-data":t(()=>[o("div",as,[e(k,{icon:"tabler-package-off",size:"64",class:"mb-4 text-disabled"}),R[8]||(R[8]=o("h6",{class:"text-h6 mb-2"}," Tidak ada produk ",-1)),R[9]||(R[9]=o("p",{class:"text-body-2 text-medium-emphasis mb-4"}," Belum ada produk yang ditambahkan atau sesuai dengan filter yang dipilih. ",-1)),e(E,{"prepend-icon":"tabler-plus",color:"coffee",onClick:R[2]||(R[2]=h=>p.$emit("add-product"))},{default:t(()=>R[7]||(R[7]=[d(" Tambah Produk Pertama ")])),_:1,__:[7]})])]),"item.name":t(({item:h})=>[o("div",ls,[e(Ve,{image:h.image_url,size:"40",rounded:"",class:"product-avatar"},{default:t(()=>[h.image_url?L("",!0):(m(),A(k,{key:0,icon:"tabler-package"}))]),_:2},1032,["image"]),o("div",null,[o("div",os,r(h.name),1),o("div",ss," SKU: "+r(h.sku||"-"),1)])])]),"item.category":t(({item:h})=>[e(ie,{color:"coffee",size:"small",variant:"tonal"},{default:t(()=>{var X;return[d(r(((X=h.category)==null?void 0:X.name)||"-"),1)]}),_:2},1024)]),"item.price":t(({item:h})=>[o("div",is,[o("div",ns,r(de(h.price)),1),o("div",rs,[o("span",null,"HPP: "+r(de(V(h))),1),j.value[h.id_product||h.id]&&V(h)>0?(m(),A(it,{key:0,indeterminate:"",size:"12",width:"2"})):L("",!0)])])]),"item.profit_margin":t(({item:h})=>[o("div",us,[e(ie,{color:y(re(h)),size:"small",variant:"tonal",class:"profit-margin-chip"},{default:t(()=>[d(r(re(h))+"% ",1)]),_:2},1032,["color"])])]),"item.stock":t(({item:h})=>[o("div",ds,[e(ie,{color:h.stock_status==="out_of_stock"?"error":h.stock_status==="low_stock"?"warning":"success",size:"small",variant:"tonal"},{default:t(()=>[d(r(h.stock_status==="out_of_stock"?"Habis":h.stock_status==="low_stock"?"Rendah":"Aman"),1)]),_:2},1032,["color"]),h.min_stock?(m(),G("div",cs," Min: "+r(h.min_stock),1)):L("",!0)])]),"item.active":t(({item:h})=>[o("div",ms,[e(ie,{color:h.active?"success":"error",size:"small",variant:"tonal"},{default:t(()=>[d(r(h.active?"Aktif":"Tidak Aktif"),1)]),_:2},1032,["color"]),h.featured?(m(),A(Me,{key:0,text:"Produk Unggulan"},{activator:t(({props:X})=>[e(k,Ce(X,{icon:"tabler-star-filled",color:"warning",size:"small"}),null,16)]),_:1})):L("",!0)])]),"item.station_availability":t(({item:h})=>[o("div",vs,[h.available_in_kitchen?(m(),A(ie,{key:0,color:"orange",size:"x-small",variant:"tonal"},{default:t(()=>[e(k,{icon:"tabler-tools-kitchen-2",size:"12",class:"me-1"}),R[10]||(R[10]=d(" Kitchen "))]),_:1,__:[10]})):L("",!0),h.available_in_bar?(m(),A(ie,{key:1,color:"purple",size:"x-small",variant:"tonal"},{default:t(()=>[e(k,{icon:"tabler-glass-cocktail",size:"12",class:"me-1"}),R[11]||(R[11]=d(" Bar "))]),_:1,__:[11]})):L("",!0),!h.available_in_kitchen&&!h.available_in_bar?(m(),G("div",ps," Tidak Tersedia ")):L("",!0)])]),"item.created_at":t(({item:h})=>[o("div",fs,r(b(h.created_at??"")),1),o("div",gs,r(v((h==null?void 0:h.created_at)??"")),1)]),"item.actions":t(({item:h})=>[o("div",_s,[e(Me,{text:"Kelola Komposisi"},{activator:t(({props:X})=>[e(E,Ce(X,{icon:"tabler-chef-hat",size:"small",variant:"text",color:"primary",onClick:ne=>p.$emit("open-composition-dialog",h)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Kelola Variant"},{activator:t(({props:X})=>[e(E,Ce(X,{icon:"tabler-versions",size:"small",variant:"text",color:"secondary",onClick:ne=>p.$emit("open-variant-dialog",h)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Edit Produk"},{activator:t(({props:X})=>[e(E,Ce(X,{icon:"tabler-edit",size:"small",variant:"text",color:"coffee",onClick:ne=>p.$emit("edit-product",h)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:h.active?"Nonaktifkan":"Aktifkan"},{activator:t(({props:X})=>{var ne;return[e(E,Ce(X,{icon:h.active?"tabler-toggle-right":"tabler-toggle-left",size:"small",variant:"text",color:h.active?"success":"error",loading:((ne=p.toggleLoading)==null?void 0:ne[h.id_product])||!1,onClick:ke=>p.$emit("toggle-active",h)}),null,16,["icon","color","loading","onClick"])]}),_:2},1032,["text"]),e(Me,{text:h.featured?"Hapus dari Unggulan":"Jadikan Unggulan"},{activator:t(({props:X})=>[e(E,Ce(X,{icon:h.featured?"tabler-star-filled":"tabler-star",size:"small",variant:"text",color:h.featured?"warning":"default",onClick:ne=>p.$emit("toggle-featured",h)}),null,16,["icon","color","onClick"])]),_:2},1032,["text"]),e(Me,{text:"Hapus Produk"},{activator:t(({props:X})=>[e(E,Ce(X,{icon:"tabler-trash",size:"small",variant:"text",color:"error",onClick:ne=>p.$emit("delete-product",h)}),null,16,["onClick"])]),_:2},1024)])]),_:1},8,["model-value","items","items-length","loading","items-per-page","page"])]),_:1}))}}),hs=qe(bs,[["__scopeId","data-v-a8142619"]]),xs={class:"d-flex align-center gap-3"},ws={class:"text-h5 font-weight-bold"},Ps={class:"text-h6"},Vs={class:"text-body-1"},Cs={class:"d-flex flex-column"},$s={class:"font-weight-medium"},Ss={class:"text-caption text-grey-darken-1"},Is={class:"font-weight-medium"},Ds={key:0,class:"text-caption"},zs={key:1,class:"text-grey-lighten-1 text-caption"},Ts={class:"v-data-table__footer"},Us={class:"pa-4 d-flex justify-space-between align-center"},As={class:"text-subtitle-1 font-weight-bold"},Hs={class:"text-subtitle-2 text-uppercase"},Ms={class:"text-h6 font-weight-bold my-2"},Ks={class:"text-caption"},Tt=Fe({__name:"HPPVariantBreakdownDialog",props:{modelValue:{type:Boolean},variantId:{},variantName:{default:""}},emits:["update:modelValue","hpp-updated","price-updated"],setup(S,{emit:ye}){const H=S,U=ye,O=I(!1),g=I(null),j=I(null),z=I(!1),x=I(!1),f=I("latest"),N=I(0),_=I(0),M=I(""),ve=I(0),ge=I(!1),V=I(!1),re=I(""),ue=I(""),W=[{title:"Current Cost",value:"current"},{title:"Latest Purchase",value:"latest"},{title:"Average Purchase",value:"average"}],de=[{title:"Item",value:"item_name",sortable:!0},{title:"Quantity",value:"quantity_needed",align:"end"},{title:"Cost/Unit",value:"cost_per_unit",align:"end"},{title:"Total Cost",value:"total_cost",align:"end"},{title:"Priority",value:"is_critical",align:"center"},{title:"Notes",value:"notes"}],b=J=>!J||J===0?"":new Intl.NumberFormat("id-ID").format(J),v=J=>{if(!J)return 0;const C=J.replace(/[^\d]/g,"");return parseInt(C)||0},y=J=>{var i;const C=v(J);if(_.value=C,M.value=b(C),(i=g.value)!=null&&i.total_hpp&&C>0){const a=g.value.total_hpp;N.value=a>0?Math.round((C-a)/a*100):0}else N.value=0},p=J=>He(J),R=async(J,C)=>{O.value=!0;try{await new Promise(i=>setTimeout(i,500)),g.value={total_hpp:15e4,method:C,calculated_at:new Date().toISOString(),items:[{item_name:"Tepung Terigu",item_code:"TPNG001",quantity_needed:.5,unit:"kg",cost_per_unit:15e3,total_cost:7500,is_critical:!1,notes:null},{item_name:"Gula Pasir",item_code:"GUL001",quantity_needed:.25,unit:"kg",cost_per_unit:12e3,total_cost:3e3,is_critical:!1,notes:null},{item_name:"Telur Ayam",item_code:"TLR001",quantity_needed:3,unit:"pcs",cost_per_unit:3e3,total_cost:9e3,is_critical:!0,notes:"Price volatile"}]},z.value=!0}catch(i){console.error("Error loading HPP breakdown:",i),z.value=!1}finally{O.value=!1}},h=async(J,C)=>{O.value=!0;try{if(await new Promise(i=>setTimeout(i,1e3)),g.value){switch(C){case"latest":g.value.total_hpp=Math.round(g.value.total_hpp*1.1);break;case"average":g.value.total_hpp=Math.round(g.value.total_hpp*1.05);break;default:g.value.total_hpp=Math.round(g.value.total_hpp*1.03)}g.value.calculated_at=new Date().toISOString()}}catch(i){throw i}finally{O.value=!1}},X=async(J,C,i,a,l)=>{O.value=!0;try{return await new Promise(u=>setTimeout(u,1e3)),{data:{new_price:i,markup_percentage:g.value?Math.round((i-g.value.total_hpp)/g.value.total_hpp*100):0}}}catch(u){throw u}finally{O.value=!1}},ne=async()=>{var J,C,i;if(H.variantId)try{const a=localStorage.getItem("token"),l=await Ne.get(`/api/variants/${H.variantId}`,{headers:{Authorization:`Bearer ${a}`,Accept:"application/json"}});if(l.data.success&&l.data.data){const u=l.data.data;if(u.price&&u.price>0)_.value=Number(u.price),M.value=b(Number(u.price));else if((J=g.value)!=null&&J.total_hpp){const ee=Math.round(g.value.total_hpp*1.2);_.value=ee,M.value=b(ee)}if((C=g.value)!=null&&C.total_hpp&&_.value>0){const ee=g.value.total_hpp;N.value=ee>0?Math.round((_.value-ee)/ee*100):0}ve.value+=1}}catch(a){console.warn("Could not load target price, using default:",a),(i=g.value)!=null&&i.total_hpp&&(_.value=Math.round(g.value.total_hpp*1.2))}},ke=async()=>{H.variantId&&(await R(H.variantId,f.value),await ne())},fe=async()=>{var J,C;if(H.variantId)try{await h(H.variantId,f.value),re.value=`HPP successfully updated using ${f.value} method!`,ge.value=!0,U("hpp-updated"),await ke()}catch(i){console.error("Error updating HPP:",i),ue.value=((C=(J=i==null?void 0:i.response)==null?void 0:J.data)==null?void 0:C.message)||"Failed to update HPP",V.value=!0}},ae=async()=>{var J,C,i,a,l,u,ee,q,ce,Pe;if(H.variantId&&((J=g.value)!=null&&J.total_hpp)&&_.value)try{const le=await X(H.variantId,f.value,_.value,!0,!0);if((C=le==null?void 0:le.data)!=null&&C.new_price){if(_.value=le.data.new_price,M.value=b(le.data.new_price),((i=le==null?void 0:le.data)==null?void 0:i.markup_percentage)!==void 0)N.value=le.data.markup_percentage;else{const Ue=g.value.total_hpp;N.value=Ue>0?Math.round((le.data.new_price-Ue)/Ue*100):0}ve.value+=1,await ft()}H.variantId&&await R(H.variantId,f.value),re.value=`Price successfully updated to ${p(((a=le==null?void 0:le.data)==null?void 0:a.new_price)||_.value)}!`,ge.value=!0,U("price-updated",{variantId:H.variantId,oldPrice:(l=le==null?void 0:le.data)==null?void 0:l.old_price,newPrice:(u=le==null?void 0:le.data)==null?void 0:u.new_price,hpp:(ee=le==null?void 0:le.data)==null?void 0:ee.hpp,markupPercentage:(q=le==null?void 0:le.data)==null?void 0:q.markup_percentage})}catch(le){console.error("Error applying price suggestion:",le),ue.value=((Pe=(ce=le==null?void 0:le.response)==null?void 0:ce.data)==null?void 0:Pe.message)||"Failed to update variant price",V.value=!0}};return we(()=>H.modelValue,J=>{J&&H.variantId&&ke()}),we(()=>H.variantId,J=>{J&&H.modelValue&&ke()}),we(f,async()=>{H.variantId&&await ke()}),we([()=>{var J;return(J=g.value)==null?void 0:J.total_hpp},_],()=>{var J;if((J=g.value)!=null&&J.total_hpp&&_.value>0){const C=g.value.total_hpp;N.value=C>0?Math.round((_.value-C)/C*100):0}else N.value=0}),we(_,J=>{J!==v(M.value)&&(M.value=b(J))}),(J,C)=>(m(),G(ze,null,[e(Ee,{"model-value":J.modelValue,"max-width":"1200",scrollable:"","onUpdate:modelValue":C[6]||(C[6]=i=>J.$emit("update:modelValue",i))},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[o("div",xs,[e(k,{icon:"mdi-calculator-variant",size:"24"}),o("span",null,"HPP Breakdown - "+r(J.variantName||"Variant"),1)]),e(E,{icon:"mdi-close",size:"small",variant:"text",onClick:C[0]||(C[0]=i=>J.$emit("update:modelValue",!1))})]),_:1}),e(te,null,{default:t(()=>[e($e,{class:"mb-4"},{default:t(()=>[e($,{cols:"12",md:"6"},{default:t(()=>[e(Be,{modelValue:f.value,"onUpdate:modelValue":[C[1]||(C[1]=i=>f.value=i),ke],items:W,label:"HPP Calculation Method",variant:"outlined"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(E,{color:"primary",variant:"elevated",loading:O.value,"prepend-icon":"mdi-update",block:"",onClick:fe},{default:t(()=>[d(" Update HPP with "+r(f.value),1)]),_:1},8,["loading"])]),_:1})]),_:1}),z.value?(m(),A(Y,{key:0,variant:"tonal",color:"primary",class:"mb-4"},{default:t(()=>[e(te,null,{default:t(()=>[e($e,{align:"center"},{default:t(()=>[e($,{cols:"12",md:"4"},{default:t(()=>{var i;return[C[11]||(C[11]=o("div",{class:"text-subtitle-2"}," Total HPP ",-1)),o("div",ws,r(p(((i=g.value)==null?void 0:i.total_hpp)||0)),1)]}),_:1,__:[11]}),e($,{cols:"12",md:"4"},{default:t(()=>{var i;return[C[12]||(C[12]=o("div",{class:"text-subtitle-2"}," Calculation Method ",-1)),o("div",Ps,r((i=W.find(a=>{var l;return a.value===((l=g.value)==null?void 0:l.method)}))==null?void 0:i.title),1)]}),_:1,__:[12]}),e($,{cols:"12",md:"4"},{default:t(()=>{var i;return[C[13]||(C[13]=o("div",{class:"text-subtitle-2"}," Last Calculated ",-1)),o("div",Vs,r((i=g.value)!=null&&i.calculated_at?new Date(g.value.calculated_at).toLocaleString():"-"),1)]}),_:1,__:[13]})]),_:1})]),_:1})]),_:1})):L("",!0),z.value?(m(),A(Y,{key:1},{default:t(()=>{var i;return[e(xe,null,{default:t(()=>{var a,l;return[e(k,{icon:"mdi-format-list-bulleted",class:"me-2"}),d(" Item Breakdown ("+r(((l=(a=g.value)==null?void 0:a.items)==null?void 0:l.length)||0)+" items) ",1)]}),_:1}),e(ca,{headers:de,items:((i=g.value)==null?void 0:i.items)||[],"items-per-page":10,class:"elevation-0"},{"item.item_name":t(({item:a})=>[o("div",Cs,[o("span",$s,r(a.item_name),1),o("span",Ss,r(a.item_code),1)])]),"item.quantity_needed":t(({item:a})=>[o("span",Is,r(a.quantity_needed)+" "+r(a.unit),1)]),"item.cost_per_unit":t(({item:a})=>[o("span",null,r(p(a.cost_per_unit)),1)]),"item.total_cost":t(({item:a})=>[e(ie,{color:a.is_critical?"error":"primary",variant:"elevated",size:"small"},{default:t(()=>[d(r(p(a.total_cost)),1)]),_:2},1032,["color"])]),"item.is_critical":t(({item:a})=>[e(ie,{color:a.is_critical?"error":"success","prepend-icon":a.is_critical?"mdi-alert":"mdi-check",variant:"tonal",size:"small"},{default:t(()=>[d(r(a.is_critical?"Critical":"Normal"),1)]),_:2},1032,["color","prepend-icon"])]),"item.notes":t(({item:a})=>[a.notes?(m(),G("span",Ds,r(a.notes),1)):(m(),G("span",zs,"—"))]),bottom:t(()=>{var a;return[o("div",Ts,[e(Te),o("div",Us,[o("div",As," Total HPP: "+r(p(((a=g.value)==null?void 0:a.total_hpp)||0)),1),e(ie,{color:"info",variant:"elevated"},{default:t(()=>{var l,u;return[d(r(((u=(l=g.value)==null?void 0:l.items)==null?void 0:u.length)||0)+" items ",1)]}),_:1})])])]}),_:1},8,["items"])]}),_:1})):L("",!0),z.value?(m(),A(Y,{key:2,class:"mt-4"},{default:t(()=>[e(xe,null,{default:t(()=>[e(k,{icon:"mdi-cash-multiple",class:"me-2"}),C[14]||(C[14]=d(" Price Suggestion "))]),_:1,__:[14]}),e(te,null,{default:t(()=>[e($e,null,{default:t(()=>[e($,{cols:"12",md:"6"},{default:t(()=>{var i;return[(m(),A(he,{key:ve.value,modelValue:M.value,"onUpdate:modelValue":[C[2]||(C[2]=a=>M.value=a),y],label:"Target Selling Price",variant:"outlined",prefix:"Rp",hint:`Current HPP: ${p(((i=g.value)==null?void 0:i.total_hpp)||0)}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>{var i;return[(m(),A(he,{key:ve.value,modelValue:N.value,"onUpdate:modelValue":C[3]||(C[3]=a=>N.value=a),label:"Markup Percentage",variant:"outlined",type:"number",min:"0",step:"5",suffix:"%",readonly:"",hint:`Profit: ${p(_.value-(((i=g.value)==null?void 0:i.total_hpp)||0))}`,"persistent-hint":""},null,8,["modelValue","hint"]))]}),_:1})]),_:1}),e($e,{class:"mt-2"},{default:t(()=>[e($,{cols:"12",md:"12"},{default:t(()=>[e(E,{color:"success",variant:"elevated","prepend-icon":"mdi-check-circle",loading:O.value,disabled:!_.value||_.value<=0,block:"",onClick:ae},{default:t(()=>C[15]||(C[15]=[d(" Apply Price ")])),_:1,__:[15]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})):L("",!0),x.value?(m(),A(Y,{key:3,variant:"tonal",color:"success",class:"mt-4"},{default:t(()=>[e(xe,null,{default:t(()=>[e(k,{icon:"mdi-lightbulb",class:"me-2"}),C[16]||(C[16]=d(" Price Suggestions "))]),_:1,__:[16]}),e(te,null,{default:t(()=>[e($e,null,{default:t(()=>[(m(!0),G(ze,null,We(j.value.suggestions,(i,a)=>(m(),A($,{key:a,cols:"12",md:"4"},{default:t(()=>[e(Y,{variant:"elevated"},{default:t(()=>[e(te,{class:"text-center"},{default:t(()=>[o("div",Hs,r(a)+" Method ",1),o("div",Ms,r(p(i.suggested_price)),1),o("div",Ks,[d(" HPP: "+r(p(i.hpp)),1),C[17]||(C[17]=o("br",null,null,-1)),d(" Markup: "+r(i.markup_percentage.toFixed(1))+"%",1),C[18]||(C[18]=o("br",null,null,-1)),d(" Margin: "+r(i.profit_margin.toFixed(1))+"% ",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):L("",!0),!z.value&&!O.value?(m(),A(Y,{key:4,variant:"outlined"},{default:t(()=>[e(te,{class:"text-center py-8"},{default:t(()=>[e(k,{icon:"mdi-calculator-variant-outline",size:"64",color:"grey",class:"mb-4"}),C[20]||(C[20]=o("div",{class:"text-h6 mb-2"}," No HPP Data Available ",-1)),C[21]||(C[21]=o("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add composition items first, then calculate HPP using the method above. ",-1)),e(E,{color:"primary","prepend-icon":"mdi-plus",onClick:C[4]||(C[4]=i=>J.$emit("update:modelValue",!1))},{default:t(()=>C[19]||(C[19]=[d(" Add Composition Items ")])),_:1,__:[19]})]),_:1,__:[20,21]})]),_:1})):L("",!0)]),_:1}),e(Re,{class:"pa-4"},{default:t(()=>[e(Oe),e(E,{variant:"outlined",color:"grey","prepend-icon":"mdi-close",onClick:C[5]||(C[5]=i=>J.$emit("update:modelValue",!1))},{default:t(()=>C[22]||(C[22]=[d(" Batal ")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["model-value"]),e(at,{modelValue:ge.value,"onUpdate:modelValue":C[8]||(C[8]=i=>ge.value=i),color:"success",location:"top"},{actions:t(()=>[e(E,{color:"white",variant:"text",onClick:C[7]||(C[7]=i=>ge.value=!1)},{default:t(()=>C[23]||(C[23]=[d(" Close ")])),_:1,__:[23]})]),default:t(()=>[d(r(re.value)+" ",1)]),_:1},8,["modelValue"]),e(at,{modelValue:V.value,"onUpdate:modelValue":C[10]||(C[10]=i=>V.value=i),color:"error",location:"top"},{actions:t(()=>[e(E,{color:"white",variant:"text",onClick:C[9]||(C[9]=i=>V.value=!1)},{default:t(()=>C[24]||(C[24]=[d(" Close ")])),_:1,__:[24]})]),default:t(()=>[d(r(ue.value)+" ",1)]),_:1},8,["modelValue"])],64))}}),Bs={class:"d-flex align-center gap-2"},Fs={class:"pa-4",style:{"background-color":"#2A2A2A"}},Es={key:0,class:"d-flex align-center gap-3"},Rs={class:"text-h6 text-white font-weight-bold"},qs={class:"d-flex align-center gap-4 mt-1"},Ls={class:"text-caption text-grey-lighten-1"},Ns={class:"text-caption text-grey-lighten-1"},Os={class:"pa-4 add-item-form"},js={class:"d-flex align-center justify-space-between mb-4"},Js={class:"d-flex align-center gap-2"},Ws={class:"text-h6"},Gs={key:0,class:"text-error"},Qs={key:1},Xs={class:"d-flex align-center"},Zs={class:"pa-4 text-center"},Ys={class:"pa-4 pt-0"},ei={class:"d-flex align-center justify-between mb-4"},ti={class:"text-h6"},ai={key:0,class:"composition-list"},li={class:"d-flex align-center justify-between"},oi={class:"d-flex align-center gap-3"},si={class:"font-weight-medium"},ii={class:"text-caption text-medium-emphasis"},ni={class:"font-weight-medium text-primary"},ri={class:"d-flex align-center gap-2"},ui={class:"text-center"},di={key:0,class:"text-body-2 text-medium-emphasis"},ci={class:"text-center"},mi={class:"text-body-1 mb-2",style:{"white-space":"pre-line"}},vi=Fe({__name:"AddItemCompositionDialog",props:{modelValue:{type:Boolean},variant:{}},emits:["update:modelValue","save"],setup(S,{emit:ye}){const H=S,U=ye,O=I(),g=I(!1),j=I(!1),z=I([]),x=I([]),f=I(!1),N=I(null),_=I(!1),M=I(null),ve=I(!1),ge=I(!1),V=I(""),re=I(""),ue=I("success"),W=I(!1),de=me({get:()=>H.modelValue,set:n=>{U("update:modelValue",n)}}),b=()=>({item_id:null,quantity:1,is_critical:!1}),v=I(b()),y=me(()=>!v.value.item_id||!Array.isArray(z.value)?null:z.value.find(n=>n.id_item===v.value.item_id)),p=me(()=>!y.value||f.value&&N.value!==null?null:x.value.find(n=>{var s,w;return n.name===((s=y.value)==null?void 0:s.name)||n.id&&((w=y.value)==null?void 0:w.id_item)&&n.id===y.value.id_item})),R=me(()=>{if(!y.value)return"";if(f.value&&N.value!==null)return"Mode Edit: Mengubah quantity item yang dipilih";if(p.value){const n=p.value;return`Item sudah ada dengan quantity ${n.quantity} ${n.unit}. Quantity akan ditambahkan.`}return`Stok tersedia: ${X(y.value)} ${y.value.unit}`}),h=me(()=>Array.isArray(z.value)?z.value.filter(n=>X(n)>0):[]),X=n=>{var s,w;return((s=n.inventory)==null?void 0:s.current_stock)||((w=n.inventory)==null?void 0:w.available_stock)||n.current_stock||0},ne=()=>j.value?"Memuat items...":!z.value||z.value.length===0?"Tidak ada item tersedia":h.value.length===0?"Semua item sedang stok habis":"Tidak ada item yang ditemukan",ke=n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(n),fe=n=>{switch(n){case"overstock":return"success";case"in_stock":return"primary";case"low_stock":return"warning";case"out_of_stock":return"error";default:return"grey"}},ae=n=>{switch(n){case"overstock":return"Berlebih";case"in_stock":return"Tersedia";case"low_stock":return"Menipis";case"out_of_stock":return"Habis";default:return"Unknown"}},J=(n,s,w)=>{var P,pe,se,oe,Se,be,De,Le;if(!s)return!0;const B=s.toLowerCase().trim(),F=((pe=(P=w==null?void 0:w.raw)==null?void 0:P.name)==null?void 0:pe.toLowerCase())||"",c=((oe=(se=w==null?void 0:w.raw)==null?void 0:se.item_code)==null?void 0:oe.toLowerCase())||"",T=((be=(Se=w==null?void 0:w.raw)==null?void 0:Se.unit)==null?void 0:be.toLowerCase())||"",Q=((Le=(De=w==null?void 0:w.raw)==null?void 0:De.description)==null?void 0:Le.toLowerCase())||"";return F.includes(B)||c.includes(B)||T.includes(B)||Q.includes(B)},C=async()=>{var n,s,w;j.value=!0;try{const B=await Ne.get("/api/items?per_page=all&include=inventory"),F=((s=(n=B.data)==null?void 0:n.data)==null?void 0:s.data)||((w=B.data)==null?void 0:w.data)||B.data||[];z.value=Array.isArray(F)?F:[]}catch(B){console.error("Error loading items:",B),B!=null&&B.response&&(console.error("API Error Status:",B.response.status),console.error("API Error Data:",B.response.data)),z.value=[]}finally{j.value=!1}},i=async()=>{var n,s,w,B,F;if(!(!((n=H.variant)!=null&&n.id)&&!((s=H.variant)!=null&&s.id_variant)))try{const c=H.variant.id||H.variant.id_variant,T=await Ne.get(`/api/variant-items/variant/${c}`),Q=((B=(w=T.data)==null?void 0:w.data)==null?void 0:B.composition)||((F=T.data)==null?void 0:F.composition)||[];if(!Array.isArray(Q)){console.warn("API response composition is not an array:",Q),x.value=[];return}x.value=Q.map(P=>{var pe,se,oe,Se,be,De,Le,Xe,rt,ut;return{id:P.id_variant_item||P.id,name:((pe=P.item)==null?void 0:pe.name)||P.name,quantity:parseFloat(P.quantity_needed||P.quantity||P.qty||"1"),unit:P.unit||((se=P.item)==null?void 0:se.unit)||"pcs",stock:((Se=(oe=P.item)==null?void 0:oe.inventory)==null?void 0:Se.current_stock)||((De=(be=P.item)==null?void 0:be.inventory)==null?void 0:De.available_stock)||((Le=P.item)==null?void 0:Le.current_stock)||P.stock||0,price:parseFloat(((Xe=P.item)==null?void 0:Xe.cost_per_unit)||((rt=P.item)==null?void 0:rt.price)||P.price||"0"),is_critical:P.is_critical||!1,inventory:(ut=P.item)!=null&&ut.inventory?{current_stock:P.item.inventory.current_stock||0,available_stock:P.item.inventory.available_stock||0,stock_status:P.item.inventory.stock_status||"unknown",reorder_level:P.item.inventory.reorder_level||0}:null}})}catch(c){console.error("Error loading composition items:",c),c!=null&&c.response&&(console.error("API Error Status:",c.response.status),console.error("API Error Data:",c.response.data)),x.value=[]}},a=async()=>{var F,c;const{valid:n}=await O.value.validate();if(!n||!y.value)return;const s=y.value.name,w=y.value.id_item,B=v.value.quantity;if(f.value&&N.value!==null)x.value[N.value].quantity,x.value[N.value].quantity=B,x.value[N.value].is_critical=v.value.is_critical,f.value=!1,N.value=null;else{const T=x.value.findIndex(Q=>Q.name===s||Q.id&&w&&Q.id===w);if(T!==-1){const pe=x.value[T].quantity+B;x.value[T].quantity=pe}else{const Q={name:s,quantity:B,unit:y.value.unit,stock:((F=y.value.inventory)==null?void 0:F.current_stock)||((c=y.value.inventory)==null?void 0:c.available_stock)||y.value.current_stock||0,price:y.value.cost_per_unit||0,is_critical:v.value.is_critical,inventory:y.value.inventory?{current_stock:y.value.inventory.current_stock||0,available_stock:y.value.inventory.available_stock||0,stock_status:y.value.inventory.stock_status||"unknown",reorder_level:y.value.inventory.reorder_level||0}:null};x.value.push(Q)}}v.value=b()},l=(n,s)=>{const w=z.value.find(B=>B.name===n.name||B.id_item===n.id);w?(f.value=!0,N.value=s,v.value={item_id:w.id_item,quantity:n.quantity,is_critical:n.is_critical||!1},setTimeout(()=>{const B=document.querySelector(".add-item-form");B&&B.scrollIntoView({behavior:"smooth",block:"start"})},100)):console.error("❌ Could not find item in available items")},u=()=>{f.value=!1,N.value=null,v.value=b()},ee=(n,s)=>{M.value={item:n,index:s},_.value=!0},q=async()=>{var B,F,c;if(!M.value)return;const{item:n,index:s}=M.value;n.name;const w=n.id;ve.value=!0;try{w&&await Ne.delete(`/api/variant-items/${w}`),_.value=!1,M.value=null,await i(),U("save")}catch(T){console.error("❌ Error deleting item:",T),console.error("❌ Error details:",(B=T.response)==null?void 0:B.data),alert("Gagal menghapus item: "+(((c=(F=T.response)==null?void 0:F.data)==null?void 0:c.message)||T.message))}finally{ve.value=!1}},ce=()=>{_.value=!1,M.value=null},Pe=()=>{switch(ue.value){case"success":return"mdi-check-circle";case"info":return"mdi-information";case"warning":return"mdi-alert";default:return"mdi-check-circle"}},le=()=>{switch(ue.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Ue=()=>{switch(ue.value){case"success":return"text-success";case"info":return"text-info";case"warning":return"text-warning";default:return"text-success"}},Ae=()=>{switch(ue.value){case"success":return"success";case"info":return"info";case"warning":return"warning";default:return"success"}},Qe=async()=>{var n,s,w,B;if(!((n=H.variant)!=null&&n.id)&&!((s=H.variant)!=null&&s.id_variant)){console.error("No variant ID found");return}g.value=!0;try{const F=H.variant.id||H.variant.id_variant;if(x.value.some(T=>T.id)){const T={items:x.value.map(P=>{const pe=z.value.find(se=>se.name===P.name);return{id_variant_item:P.id,quantity_needed:Number(P.quantity),unit:P.unit,is_critical:P.is_critical||!1}}).filter(P=>P.id_variant_item&&P.quantity_needed>0)},Q=await Ne.post("/api/variant-items/bulk-update",T)}else{const T={id_variant:F,items:x.value.map(P=>{const pe=z.value.find(se=>se.name===P.name);return{id_item:pe==null?void 0:pe.id_item,quantity_needed:Number(P.quantity),unit:P.unit,is_critical:P.is_critical||!1}}).filter(P=>P.id_item&&P.quantity_needed>0)},Q=await Ne.post("/api/variant-items/bulk-store",T)}U("save"),D()}catch(F){console.error("Error saving composition:",F),alert("Gagal menyimpan komposisi: "+(((B=(w=F.response)==null?void 0:w.data)==null?void 0:B.message)||F.message))}finally{g.value=!1}},Je=()=>{W.value=!0},D=()=>{de.value=!1,v.value=b(),x.value=[],f.value=!1,N.value=null};return we(()=>H.modelValue,n=>{n?(v.value=b(),C(),i()):(f.value=!1,N.value=null)}),we(()=>v.value.item_id,n=>{n&&y.value}),et(()=>{C()}),(n,s)=>{var w,B,F;return m(),G(ze,null,[e(Ee,{modelValue:de.value,"onUpdate:modelValue":s[3]||(s[3]=c=>de.value=c),"max-width":"1000px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between",style:{"background-color":"#D4A574",color:"white"}},{default:t(()=>[o("div",Bs,[e(k,{icon:"mdi-delete",color:"white"}),s[9]||(s[9]=o("span",null,"Kelola Komposisi Item",-1))]),e(E,{icon:"mdi-close",variant:"text",color:"white",onClick:D,disabled:g.value},null,8,["disabled"])]),_:1}),e(te,{class:"pa-0"},{default:t(()=>[o("div",Fs,[n.variant?(m(),G("div",Es,[e(k,{icon:"mdi-coffee",size:"32",color:"white"}),o("div",null,[o("h3",Rs,r(n.variant.name),1),o("div",qs,[o("span",Ls,"SKU: "+r(n.variant.sku),1),o("span",Ns,"Harga: "+r(ke(n.variant.price||0)),1),e(ie,{color:"success",size:"small",variant:"tonal"},{default:t(()=>s[10]||(s[10]=[d(" Stok Aman ")])),_:1,__:[10]})])])])):L("",!0)]),o("div",Os,[o("div",js,[o("div",Js,[e(k,{icon:"mdi-plus-circle",color:"success"}),o("h4",Ws,r(f.value?"Edit Item Komposisi":"Tambah Item Komposisi"),1)])]),e(bt,{ref_key:"form",ref:O,onSubmit:kt(a,["prevent"])},{default:t(()=>[e($e,null,{default:t(()=>[e($,{cols:"12",md:"4"},{default:t(()=>[e(yt,{modelValue:v.value.item_id,"onUpdate:modelValue":s[0]||(s[0]=c=>v.value.item_id=c),items:h.value,"item-title":"name","item-value":"id_item",label:"Pilih Item",variant:"outlined",density:"compact",rules:[c=>!!c||"Item wajib dipilih"],loading:j.value,disabled:j.value||z.value&&z.value.length===0,"no-data-text":ne(),placeholder:"Ketik untuk mencari item dengan stok...",clearable:"","menu-props":{maxHeight:"300px"},"hide-details":"auto","custom-filter":J},{"prepend-inner":t(()=>[e(k,{icon:"mdi-package",size:"16"})]),item:t(({props:c,item:T})=>[e(je,Ce(c,{title:T.raw.name,disabled:X(T.raw)<=0,class:["pa-3",{"text-disabled":X(T.raw)<=0}]}),{prepend:t(()=>[e(k,{icon:"mdi-package-variant",color:X(T.raw)<=0?"grey-darken-2":"grey-lighten-1",class:"me-3"},null,8,["color"])]),subtitle:t(()=>[o("div",{class:Ge(["text-caption",X(T.raw)<=0?"text-disabled":"text-medium-emphasis"])},[X(T.raw)<=0?(m(),G("span",Gs,[e(k,{icon:"mdi-alert-circle",size:"12",class:"me-1"}),s[11]||(s[11]=d(" Stok Habis "))])):(m(),G("span",Qs," Stok: "+r(X(T.raw))+" "+r(T.raw.unit),1))],2)]),append:t(()=>{var Q;return[X(T.raw)>0?(m(),A(ie,{key:0,size:"x-small",color:fe(((Q=T.raw.inventory)==null?void 0:Q.stock_status)||T.raw.stock_status||"unknown"),variant:"tonal"},{default:t(()=>{var P;return[d(r(ae(((P=T.raw.inventory)==null?void 0:P.stock_status)||T.raw.stock_status||"unknown")),1)]}),_:2},1032,["color"])):(m(),A(ie,{key:1,size:"x-small",color:"error",variant:"outlined","prepend-icon":"mdi-close-circle"},{default:t(()=>s[12]||(s[12]=[d(" Habis ")])),_:1,__:[12]}))]}),_:2},1040,["title","disabled","class"])]),selection:t(({item:c})=>[o("div",Xs,[e(k,{icon:"mdi-package-variant",size:"16",class:"me-2"}),o("span",null,r(c.raw.name),1)])]),"no-data":t(()=>[o("div",Zs,[e(k,{icon:"mdi-magnify",size:"48",color:"grey",class:"mb-2"}),s[13]||(s[13]=o("div",{class:"text-body-2 text-medium-emphasis"}," Tidak ada item yang ditemukan ",-1)),s[14]||(s[14]=o("div",{class:"text-caption text-disabled"}," Coba kata kunci yang berbeda ",-1))])]),_:1},8,["modelValue","items","rules","loading","disabled","no-data-text"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>[e(he,{modelValue:v.value.quantity,"onUpdate:modelValue":s[1]||(s[1]=c=>v.value.quantity=c),modelModifiers:{number:!0},label:"Jumlah",variant:"outlined",density:"compact",type:"number",min:"0.01",step:"0.01",rules:[c=>!!c||"Jumlah wajib diisi",c=>c>0||"Jumlah harus lebih dari 0"],hint:R.value,"persistent-hint":"",color:p.value?"warning":"primary"},null,8,["modelValue","rules","hint","color"])]),_:1}),e($,{cols:"12",md:"2"},{default:t(()=>{var c;return[e(he,{"model-value":((c=y.value)==null?void 0:c.unit)||"pcs",label:"Satuan",variant:"outlined",density:"compact",readonly:"",disabled:!y.value,placeholder:"Pilih item terlebih dahulu"},{"prepend-inner":t(()=>[e(k,{icon:"mdi-weight",size:"16"})]),_:1},8,["model-value","disabled"])]}),_:1}),e($,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[e(Ze,{modelValue:v.value.is_critical,"onUpdate:modelValue":s[2]||(s[2]=c=>v.value.is_critical=c),label:"Item Kritis",color:"warning",density:"compact","true-value":!0,"false-value":!1},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2",class:"d-flex flex-column gap-2"},{default:t(()=>[e(E,{color:f.value?"primary":p.value?"warning":"#D4A574",onClick:a,loading:g.value,disabled:!v.value.item_id||!v.value.quantity,block:""},{default:t(()=>[e(k,{icon:f.value?"mdi-content-save":p.value?"mdi-plus-box-multiple":"mdi-plus",class:"me-1"},null,8,["icon"]),d(" "+r(f.value?"Update":p.value?"Akumulasi":"Tambah"),1)]),_:1},8,["color","loading","disabled"]),f.value?(m(),A(E,{key:0,color:"grey",variant:"outlined",onClick:u,size:"small",block:""},{default:t(()=>[e(k,{icon:"mdi-close",class:"me-1"}),s[15]||(s[15]=d(" Batal "))]),_:1,__:[15]})):L("",!0)]),_:1})]),_:1})]),_:1},512)]),o("div",Ys,[o("div",ei,[o("h4",ti,"Daftar Item Komposisi ("+r(x.value.length)+")",1)]),x.value.length>0?(m(),G("div",ai,[(m(!0),G(ze,null,We(x.value,(c,T)=>(m(),A(Y,{key:T,variant:"outlined",class:"mb-3"},{default:t(()=>[e(te,{class:"pa-3"},{default:t(()=>{var Q,P,pe,se,oe,Se,be;return[o("div",li,[o("div",oi,[e(k,{icon:"mdi-check-circle",color:"success"}),o("div",null,[o("div",si,r(c.name),1),o("div",ii,[o("span",ni,"Dibutuhkan: "+r(c.quantity)+" "+r(c.unit),1),s[16]||(s[16]=d(" • ")),o("span",{class:Ge({"text-success":(((Q=c.inventory)==null?void 0:Q.current_stock)??0)>(((P=c.inventory)==null?void 0:P.reorder_level)??0),"text-warning":(((pe=c.inventory)==null?void 0:pe.current_stock)??0)<=(((se=c.inventory)==null?void 0:se.reorder_level)??0)&&(((oe=c.inventory)==null?void 0:oe.current_stock)??0)>0,"text-error":(((Se=c.inventory)==null?void 0:Se.current_stock)??0)<=0})}," Stok: "+r(((be=c.inventory)==null?void 0:be.current_stock)||c.stock||0)+" "+r(c.unit),3),d(" • "+r(ke(c.price)),1)])])]),o("div",ri,[e(E,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:De=>l(c,T)},null,8,["onClick"]),e(E,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:De=>ee(c,T)},null,8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))])):(m(),A(Y,{key:1,variant:"outlined",class:"text-center pa-6"},{default:t(()=>[e(k,{icon:"mdi-package-variant-closed",size:"48",color:"grey",class:"mb-3"}),s[17]||(s[17]=o("div",{class:"text-body-2 text-medium-emphasis"}," Belum ada item komposisi ditambahkan ",-1))]),_:1,__:[17]}))])]),_:1}),e(Re,{class:"px-6 pb-6"},{default:t(()=>[e(E,{variant:"outlined",color:"secondary","prepend-icon":"mdi-wrench",onClick:Je},{default:t(()=>s[18]||(s[18]=[d(" Setting HPP ")])),_:1,__:[18]}),e(Oe),e(E,{variant:"outlined",onClick:D,disabled:g.value},{default:t(()=>s[19]||(s[19]=[d(" Batal ")])),_:1,__:[19]},8,["disabled"]),e(E,{color:"#D4A574",onClick:Qe,loading:g.value,disabled:x.value.length===0},{default:t(()=>s[20]||(s[20]=[d(" Simpan Komposisi ")])),_:1,__:[20]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Tt,{modelValue:W.value,"onUpdate:modelValue":s[4]||(s[4]=c=>W.value=c),"variant-id":((w=n.variant)==null?void 0:w.id)||((B=n.variant)==null?void 0:B.id_variant),"variant-name":(F=n.variant)==null?void 0:F.name,onHppUpdated:s[5]||(s[5]=c=>U("save"))},null,8,["modelValue","variant-id","variant-name"]),e(Ee,{modelValue:_.value,"onUpdate:modelValue":s[6]||(s[6]=c=>_.value=c),"max-width":"400px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex align-center justify-center text-h6 text-error"},{default:t(()=>[e(k,{icon:"mdi-alert-circle",color:"error",class:"me-2"}),s[21]||(s[21]=d(" Konfirmasi Hapus "))]),_:1,__:[21]}),e(Te),e(te,{class:"pa-6"},{default:t(()=>[o("div",ui,[e(k,{icon:"mdi-delete-alert",size:"64",color:"error",class:"mb-4"}),s[24]||(s[24]=o("p",{class:"text-body-1 mb-2"}," Apakah Anda yakin ingin menghapus item ini? ",-1)),M.value?(m(),G("div",di,[o("strong",null,r(M.value.item.name),1),s[22]||(s[22]=o("br",null,null,-1)),d(" Dibutuhkan: "+r(M.value.item.quantity)+" "+r(M.value.item.unit),1)])):L("",!0),e(Ke,{type:"warning",variant:"tonal",class:"mt-4 text-start"},{default:t(()=>s[23]||(s[23]=[o("strong",null,"Perhatian:",-1),d(" Item yang sudah dihapus tidak dapat dikembalikan! ")])),_:1,__:[23]})])]),_:1}),e(Re,{class:"px-6 pb-6"},{default:t(()=>[e(E,{variant:"outlined",onClick:ce,disabled:ve.value,class:"flex-grow-1"},{default:t(()=>s[25]||(s[25]=[d(" Batal ")])),_:1,__:[25]},8,["disabled"]),e(E,{color:"error",onClick:q,loading:ve.value,class:"flex-grow-1"},{default:t(()=>s[26]||(s[26]=[d(" Hapus ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ee,{modelValue:ge.value,"onUpdate:modelValue":s[8]||(s[8]=c=>ge.value=c),"max-width":"450px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:Ge(["d-flex align-center justify-center text-h6",Ue()])},{default:t(()=>[e(k,{icon:Pe(),color:le(),class:"me-2",size:"24"},null,8,["icon","color"]),d(" "+r(re.value),1)]),_:1},8,["class"]),e(Te),e(te,{class:"pa-6"},{default:t(()=>[o("div",ci,[e(k,{icon:Pe(),color:le(),size:"64",class:"mb-4"},null,8,["icon","color"]),o("div",mi,r(V.value),1),e(Ke,{type:ue.value,variant:"tonal",class:"mt-4 text-start"},{default:t(()=>[ue.value==="success"?(m(),G(ze,{key:0},[s[27]||(s[27]=o("strong",null,"Berhasil!",-1)),s[28]||(s[28]=d(" Perubahan telah disimpan. "))],64)):ue.value==="info"?(m(),G(ze,{key:1},[s[29]||(s[29]=o("strong",null,"Informasi:",-1)),s[30]||(s[30]=d(" Item telah diperbarui sesuai permintaan. "))],64)):(m(),G(ze,{key:2},[s[31]||(s[31]=o("strong",null,"Perhatian:",-1)),s[32]||(s[32]=d(" Silakan periksa kembali informasi. "))],64))]),_:1},8,["type"])])]),_:1}),e(Re,{class:"px-6 pb-6"},{default:t(()=>[e(Oe),e(E,{color:Ae(),onClick:s[7]||(s[7]=c=>ge.value=!1),class:"px-6"},{default:t(()=>[e(k,{icon:"mdi-check",class:"me-1"}),s[33]||(s[33]=d(" OK "))]),_:1,__:[33]},8,["color"]),e(Oe)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),pi=qe(vi,[["__scopeId","data-v-d2ce0c17"]]),fi={class:"d-flex align-center gap-2"},gi={class:"mt-2"},_i={key:0,class:"mt-1 font-weight-medium"},ki={key:1,class:"mt-1 text-warning"},yi=Fe({__name:"CreateVariantDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save"],setup(S,{emit:ye}){const H=S,U=ye,O=I(),g=I(!1),j=I(!1),z=I([]),x=I({name:"",selectedProduct:null,selectedProductId:null,active:!0}),f=[b=>!!b||"Nama variant wajib diisi",b=>b.length>=3||"Nama variant minimal 3 karakter"],N=[b=>!!b||"Produk wajib dipilih"],_=(b,v="success")=>{const y=document.createElement("div");y.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${v==="success"?"#4CAF50":"#f44336"};
    color: white;
    padding: 16px 24px;
    border-radius: 8px;
    z-index: 9999;
    font-family: 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: slideIn 0.3s ease-out;
    min-width: 300px;
  `;const p=document.createElement("span");if(p.innerHTML=v==="success"?"✓":"✕",p.style.cssText=`
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    font-weight: bold;
  `,y.appendChild(p),y.appendChild(document.createTextNode(b)),!document.querySelector("#snackbar-styles")){const R=document.createElement("style");R.id="snackbar-styles",R.textContent=`
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `,document.head.appendChild(R)}document.body.appendChild(y),setTimeout(()=>{y.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{y.parentNode&&y.parentNode.removeChild(y)},300)},3e3)},M=async()=>{j.value=!0;try{const b=await Ne.get("/api/products");z.value=b.data.data||b.data||[]}catch(b){console.error("Gagal mengambil data produk:",b),z.value=[]}finally{j.value=!1}},ve=b=>{!b&&z.value.length===0&&M()},ge=b=>{x.value.selectedProduct=b,b?x.value.selectedProductId=b.id:x.value.selectedProductId=null},V=me(()=>x.value.selectedProduct?x.value.selectedProduct:x.value.selectedProductId&&z.value.length>0?z.value.find(v=>v.id===x.value.selectedProductId):null),re=()=>{const b=V.value;if(!b||!x.value.name)return"";const v=b.sku||"PROD",y=x.value.name.replace(/\s+/g,"").toUpperCase().substring(0,3),p=Date.now().toString().slice(-4);return`${v}-${y}-${p}`},ue=async()=>{var y,p;if(g.value)return;const{valid:b}=await O.value.validate();if(!b)return;const v=V.value;if(!v){_("Produk tidak ditemukan","error");return}if(!v.id&&!v.id_product){_("ID Produk tidak valid","error"),console.error("Product missing ID:",v);return}g.value=!0;try{const R={id_product:v.id||v.id_product,name:x.value.name,sku:re(),price:0,cost_price:null,barcode:null,variant_values:[],active:x.value.active},h=await Ne.post("/api/variants",R);if(h.data.success!==!1&&(h.status===200||h.status===201))_("Variant berhasil dibuat!","success"),U("save"),de();else throw new Error(h.data.message||"Gagal membuat variant")}catch(R){const h=((p=(y=R.response)==null?void 0:y.data)==null?void 0:p.message)||R.message||"Gagal membuat variant";_(h,"error"),console.error("Save variant error:",R)}finally{g.value=!1}},W=()=>{var b;x.value={name:"",selectedProduct:null,selectedProductId:null,active:!0},(b=O.value)==null||b.resetValidation()},de=()=>{U("update:modelValue",!1),W()};return we(()=>H.modelValue,b=>{b&&(W(),M())}),(b,v)=>(m(),A(Ee,{"model-value":b.modelValue,"onUpdate:modelValue":v[3]||(v[3]=y=>b.$emit("update:modelValue",y)),"max-width":"600px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"bg-primary text-white"},{default:t(()=>[e(k,{icon:"mdi-plus-circle",class:"me-2"}),v[4]||(v[4]=d(" Tambah Variant Baru ")),e(Oe),e(E,{icon:"mdi-close",variant:"text",color:"white",onClick:de})]),_:1,__:[4]}),e(bt,{ref_key:"formRef",ref:O,onSubmit:kt(ue,["prevent"])},{default:t(()=>[e(te,{class:"pa-6"},{default:t(()=>[e($e,null,{default:t(()=>[e($,{cols:"12"},{default:t(()=>[e(yt,{modelValue:x.value.selectedProduct,"onUpdate:modelValue":[v[0]||(v[0]=y=>x.value.selectedProduct=y),ge],items:z.value,loading:j.value,"item-title":"name","return-object":"",label:"Pilih Produk *",placeholder:"Cari produk...",variant:"outlined",rules:N,required:"","no-data-text":"Tidak ada produk ditemukan","onUpdate:search":ve},{item:t(({props:y,item:p})=>[e(je,ea(ta(y)),{prepend:t(()=>[e(Ve,{image:p.raw.image_url,size:"40"},{default:t(()=>[p.raw.image_url?L("",!0):(m(),A(k,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"])]),default:t(()=>[e(Ye,null,{default:t(()=>[d(r(p.raw.name),1)]),_:2},1024),e(tt,null,{default:t(()=>[d("SKU: "+r(p.raw.sku||"-"),1)]),_:2},1024)]),_:2},1040)]),selection:t(({item:y})=>[o("div",fi,[e(Ve,{image:y.raw.image_url,size:"24"},{default:t(()=>[y.raw.image_url?L("",!0):(m(),A(k,{key:0,icon:"mdi-coffee",size:"16"}))]),_:2},1032,["image"]),o("span",null,r(y.raw.name),1)])]),_:1},8,["modelValue","items","loading"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(he,{modelValue:x.value.name,"onUpdate:modelValue":v[1]||(v[1]=y=>x.value.name=y),label:"Nama Variant *",placeholder:"Contoh: Large Hot, Medium Cold, dll",variant:"outlined",rules:f,required:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ke,{color:"info",variant:"tonal",class:"mb-0"},{default:t(()=>[e(ct,null,{default:t(()=>[e(k,{icon:"mdi-information",class:"me-2"}),v[5]||(v[5]=d(" SKU Otomatis "))]),_:1,__:[5]}),o("div",gi,[v[6]||(v[6]=d(" SKU variant akan dibuat otomatis berdasarkan nama produk dan variant ")),x.value.name&&(x.value.selectedProduct||x.value.selectedProductId)?(m(),G("div",_i," Preview SKU: "+r(re()),1)):x.value.name&&!x.value.selectedProduct&&!x.value.selectedProductId?(m(),G("div",ki," Pilih produk terlebih dahulu untuk melihat preview SKU ")):L("",!0)])]),_:1})]),_:1}),e($,{cols:"12"},{default:t(()=>[e(Ze,{modelValue:x.value.active,"onUpdate:modelValue":v[2]||(v[2]=y=>x.value.active=y),label:"Variant Aktif",color:"primary",inset:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Te),e(Re,{class:"pa-6"},{default:t(()=>[e(Oe),e(E,{variant:"outlined",onClick:de,disabled:g.value},{default:t(()=>v[7]||(v[7]=[d(" Batal ")])),_:1,__:[7]},8,["disabled"]),e(E,{type:"submit",color:"primary",loading:g.value},{default:t(()=>v[8]||(v[8]=[d(" Simpan Variant ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model-value"]))}}),bi=qe(yi,[["__scopeId","data-v-5477c365"]]),hi={class:"product-variant-tab"},xi={class:"d-flex gap-2"},wi={key:0,class:"mt-4 d-flex align-center gap-2"},Pi={key:1,class:"text-center pa-12"},Vi={key:2,class:"text-center pa-12"},Ci={class:"d-flex align-center gap-3"},$i={class:"flex-grow-1 min-width-0"},Si={class:"text-h6 font-weight-bold text-truncate"},Ii={class:"text-body-2 text-medium-emphasis mb-0"},Di={class:"d-flex flex-column gap-1"},zi={class:"text-xs"},Ti={class:"d-flex align-center gap-2"},Ui={class:"text-primary font-weight-medium"},Ai={class:"d-flex gap-1"},Hi={class:"d-flex align-center justify-space-between w-100"},Mi={class:"d-flex gap-1"},Ki=Fe({__name:"ProductVariantTab",props:{loading:{type:Boolean}},emits:["refresh"],setup(S,{emit:ye}){const H=ye,U=I(!1),O=I([]),g=I(!1),j=I(!1),z=I(null),x=I(!1),f=I(!1),N=I(!1),_=I({search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}),M=[{title:"Semua Status",value:""},{title:"Stok Aman",value:"safe"},{title:"Stok Kritis",value:"critical"},{title:"Stok Habis",value:"out"}],ve=[{title:"Nama Produk A-Z",value:"name_asc"},{title:"Nama Produk Z-A",value:"name_desc"},{title:"Variant Terbanyak",value:"variants_desc"},{title:"Variant Tersedikit",value:"variants_asc"}],ge=me(()=>!!(_.value.search||_.value.stockStatus||_.value.activeStatus!==null||_.value.sortBy!=="name_asc")),V=me(()=>{const i={};return O.value.forEach(a=>{const l=a.id_product;i[l]||(i[l]={product:a.product||{id:a.id_product,id_product:a.id_product,name:`Product ${a.id_product}`,sku:""},variants:[]}),i[l].variants.push(a)}),Object.values(i)}),re=me(()=>{let i=[...V.value];if(_.value.search){const a=_.value.search.toLowerCase();i=i.filter(l=>{var u;return l.product.name.toLowerCase().includes(a)||((u=l.product.sku)==null?void 0:u.toLowerCase().includes(a))||l.variants.some(ee=>ee.name.toLowerCase().includes(a)||ee.sku.toLowerCase().includes(a))})}switch(_.value.stockStatus&&(i=i.filter(a=>a.variants.some(l=>{var ee;return(((ee=l.composition_summary)==null?void 0:ee.stock_status)||"safe")===_.value.stockStatus}))),_.value.activeStatus!==null&&(i=i.filter(a=>a.variants.some(l=>l.is_active===_.value.activeStatus))),_.value.sortBy){case"name_asc":i.sort((a,l)=>a.product.name.localeCompare(l.product.name));break;case"name_desc":i.sort((a,l)=>l.product.name.localeCompare(a.product.name));break;case"variants_desc":i.sort((a,l)=>l.variants.length-a.variants.length);break;case"variants_asc":i.sort((a,l)=>a.variants.length-l.variants.length);break}return i}),ue=(i,a="success")=>{},W=async i=>{try{const a=O.value.findIndex(l=>l.id_variant===i.variantId);a!==-1&&(O.value[a]={...O.value[a],price:i.newPrice,cost:i.hpp}),ue(`Price updated to ${new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(i.newPrice)}`,"success")}catch(a){console.error("Error handling price update:",a),await de()}},de=async()=>{var i,a,l;U.value=!0;try{const u=await Ne.get("/api/variants",{params:{per_page:1e3,with_product:!0,with_composition:!0}});if(u.data.success===!1)throw new Error(u.data.message||"Failed to load variants");const ee=((i=u.data.data)==null?void 0:i.data)||u.data.data||[];O.value=ee.map(q=>({...q,is_active:q.active!==void 0?q.active:q.is_active,id:q.id_variant||q.id,id_product:q.id_product||q.product_id}))}catch(u){(l=(a=u.response)==null?void 0:a.data)!=null&&l.message||u.message,O.value=[]}finally{U.value=!1}},b=i=>{z.value=i,x.value=!0},v=i=>{i&&(z.value=i,f.value=!0)},y=i=>{z.value=i,g.value=!0},p=()=>{N.value=!0},R=async()=>{var i,a;if(z.value)try{j.value=!0,await Ne.delete(`/api/variants/${z.value.id_variant}`),ue("Variant berhasil dihapus","success"),await de(),g.value=!1}catch(l){(a=(i=l.response)==null?void 0:i.data)!=null&&a.message}finally{j.value=!1}},h=i=>{switch(i){case"critical":return"error";case"out":return"error";case"safe":return"success";default:return"primary"}},X=i=>{switch(i){case"critical":return"Kritis";case"out":return"Habis";case"safe":return"Aman";default:return"Normal"}},ne=i=>{const a=i.filter(l=>l.is_active).length;return a===0?"error":a===i.length?"success":"warning"},ke=i=>i.some(a=>{var u;const l=(u=a.composition_summary)==null?void 0:u.stock_status;return l==="critical"||l==="out"}),fe=i=>{const a=i.filter(u=>u.is_active).length,l=i.filter(u=>{var q;const ee=(q=u.composition_summary)==null?void 0:q.stock_status;return ee==="critical"||ee==="out"}).length;return l>0?{text:`${l} Stok Kritis`,color:"error",icon:"mdi-alert-circle"}:a===i.length?{text:"Semua Aktif",color:"success",icon:"mdi-check-circle"}:a===0?{text:"Semua Nonaktif",color:"error",icon:"mdi-close-circle"}:{text:`${a}/${i.length} Aktif`,color:"warning",icon:"mdi-minus-circle"}},ae=()=>{_.value={search:"",stockStatus:"",activeStatus:null,sortBy:"name_asc"}},J=()=>{de(),H("refresh")},C=()=>{de(),H("refresh")};return et(()=>{de()}),(i,a)=>{var l,u,ee;return m(),G("div",hi,[e(Y,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(xe,{class:"d-flex align-center justify-space-between"},{default:t(()=>[a[14]||(a[14]=o("div",null,[o("h2",{class:"text-h5 font-weight-bold"},"Variant Produk"),o("p",{class:"text-body-2 text-medium-emphasis"}," Kelola variant dan komposisi untuk produk Anda ")],-1)),o("div",xi,[e(E,{variant:"outlined","prepend-icon":"mdi-refresh",onClick:de,loading:U.value},{default:t(()=>a[12]||(a[12]=[d(" Refresh ")])),_:1,__:[12]},8,["loading"]),e(E,{color:"primary","prepend-icon":"mdi-plus",onClick:p},{default:t(()=>a[13]||(a[13]=[d(" Tambah Variant ")])),_:1,__:[13]})])]),_:1,__:[14]})]),_:1}),e(Y,{class:"mb-6",elevation:"0",variant:"outlined"},{default:t(()=>[e(te,null,{default:t(()=>[e($e,null,{default:t(()=>[e($,{cols:"12",md:"3"},{default:t(()=>[e(he,{modelValue:_.value.search,"onUpdate:modelValue":a[0]||(a[0]=q=>_.value.search=q),label:"Cari Variant",placeholder:"Nama variant, SKU, atau produk...",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-magnify","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:_.value.stockStatus,"onUpdate:modelValue":a[1]||(a[1]=q=>_.value.stockStatus=q),items:M,label:"Status Stok",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:_.value.activeStatus,"onUpdate:modelValue":a[2]||(a[2]=q=>_.value.activeStatus=q),items:[{title:"Semua Status",value:null},{title:"Aktif",value:!0},{title:"Nonaktif",value:!1}],label:"Status Aktif",variant:"outlined",density:"compact","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(Be,{modelValue:_.value.sortBy,"onUpdate:modelValue":a[3]||(a[3]=q=>_.value.sortBy=q),items:ve,label:"Urutkan",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),ge.value?(m(),G("div",wi,[a[16]||(a[16]=o("span",{class:"text-body-2"},"Filter aktif:",-1)),_.value.search?(m(),A(ie,{key:0,size:"small",closable:"","onClick:close":a[4]||(a[4]=q=>_.value.search="")},{default:t(()=>[d(" Pencarian: "+r(_.value.search),1)]),_:1})):L("",!0),_.value.stockStatus?(m(),A(ie,{key:1,size:"small",closable:"","onClick:close":a[5]||(a[5]=q=>_.value.stockStatus="")},{default:t(()=>{var q;return[d(" Stok: "+r((q=M.find(ce=>ce.value===_.value.stockStatus))==null?void 0:q.title),1)]}),_:1})):L("",!0),_.value.activeStatus!==null?(m(),A(ie,{key:2,size:"small",closable:"","onClick:close":a[6]||(a[6]=q=>_.value.activeStatus=null)},{default:t(()=>[d(" Status: "+r(_.value.activeStatus?"Aktif":"Nonaktif"),1)]),_:1})):L("",!0),e(E,{variant:"text",size:"small",color:"error",onClick:ae},{default:t(()=>a[15]||(a[15]=[d(" Hapus Semua Filter ")])),_:1,__:[15]})])):L("",!0)]),_:1})]),_:1}),!U.value&&re.value.length===0&&ge.value?(m(),A(Ke,{key:0,type:"info",variant:"outlined",class:"mb-6",title:"Tidak ada hasil",text:"Tidak ada variant yang sesuai dengan filter yang dipilih. Coba ubah filter pencarian."})):L("",!0),U.value?(m(),G("div",Pi,[e(it,{color:"primary",indeterminate:"",size:"64"}),a[17]||(a[17]=o("div",{class:"mt-4 text-h6"},"Memuat variant...",-1))])):V.value.length===0?(m(),G("div",Vi,[e(k,{icon:"mdi-tune-variant",size:"96",class:"text-disabled mb-6"}),a[19]||(a[19]=o("h3",{class:"text-h5 font-weight-bold mb-4"},"Belum Ada Variant Produk",-1)),a[20]||(a[20]=o("p",{class:"text-body-1 text-medium-emphasis mb-6"}," Buat variant untuk produk Anda agar dapat menawarkan pilihan yang beragam ",-1)),e(E,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:p},{default:t(()=>a[18]||(a[18]=[d(" Buat Variant Pertama ")])),_:1,__:[18]})])):(m(),A($e,{key:3},{default:t(()=>[(m(!0),G(ze,null,We(re.value,q=>(m(),A($,{key:q.product.id_product,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(Y,{class:Ge(["variant-group-card h-100",{"border-error":ke(q.variants)}]),elevation:"2"},{default:t(()=>[e(xe,{class:"pa-4 pb-2"},{default:t(()=>[o("div",Ci,[e(Ve,{image:q.product.image_url,size:"48",class:"flex-shrink-0"},{default:t(()=>[q.product.image_url?L("",!0):(m(),A(k,{key:0,icon:"mdi-coffee"}))]),_:2},1032,["image"]),o("div",$i,[o("h3",Si,r(q.product.name),1),o("p",Ii," SKU: "+r(q.product.sku||"-"),1)]),e(ie,{color:ne(q.variants),size:"small",variant:"tonal"},{default:t(()=>[d(r(q.variants.length)+" Variant ",1)]),_:2},1032,["color"])])]),_:2},1024),e(Te),e(te,{class:"pa-4"},{default:t(()=>[e(nt,{class:"pa-0"},{default:t(()=>[(m(!0),G(ze,null,We(q.variants,(ce,Pe)=>(m(),A(je,{key:ce.id_variant,class:Ge(["pa-2 rounded-lg variant-item",{"mb-2":Pe<q.variants.length-1}])},{prepend:t(()=>[e(Ve,{size:"32",color:ce.is_active?"success":"error",variant:"tonal"},{default:t(()=>[e(k,{icon:ce.is_active?"mdi-check":"mdi-close",size:"16"},null,8,["icon"])]),_:2},1032,["color"])]),append:t(()=>[o("div",Ai,[e(Me,{text:"Kelola Komposisi"},{activator:t(({props:le})=>[e(E,Ce({ref_for:!0},le,{icon:"mdi-chef-hat",size:"small",variant:"text",color:"primary",onClick:Ue=>b(ce)}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Hapus Variant"},{activator:t(({props:le})=>[e(E,Ce({ref_for:!0},le,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:Ue=>y(ce)}),null,16,["onClick"])]),_:2},1024)])]),default:t(()=>[e(Ye,{class:"text-sm font-weight-medium"},{default:t(()=>[d(r(ce.name),1)]),_:2},1024),e(tt,null,{default:t(()=>[o("div",Di,[o("span",zi,"SKU: "+r(ce.sku),1),o("div",Ti,[o("span",Ui,r(K(He)(ce.price||0)),1),ce.composition_summary?(m(),A(ie,{key:0,color:h(ce.composition_summary.stock_status),size:"x-small",variant:"tonal"},{default:t(()=>[d(r(X(ce.composition_summary.stock_status)),1)]),_:2},1032,["color"])):L("",!0)])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:2},1024)]),_:2},1024),e(Te),e(Re,{class:"pa-4"},{default:t(()=>[o("div",Hi,[o("div",null,[e(ie,{color:fe(q.variants).color,size:"small",variant:"tonal"},{default:t(()=>[e(k,{icon:fe(q.variants).icon,size:"14",class:"me-1"},null,8,["icon"]),d(" "+r(fe(q.variants).text),1)]),_:2},1032,["color"])]),o("div",Mi,[e(Me,{text:"Setting HPP Produk"},{activator:t(({props:ce})=>[e(E,Ce({ref_for:!0},ce,{icon:"mdi-calculator-variant",size:"small",variant:"text",color:"warning",onClick:Pe=>v(q.variants[0])}),null,16,["onClick"])]),_:2},1024),e(Me,{text:"Tambah Variant"},{activator:t(({props:ce})=>[e(E,Ce({ref_for:!0},ce,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:p}),null,16)]),_:1}),e(Me,{text:"Pengaturan Produk (Coming Soon)"},{activator:t(({props:ce})=>[e(E,Ce({ref_for:!0},ce,{icon:"mdi-cog",size:"small",variant:"text",color:"secondary",disabled:""}),null,16)]),_:1})])])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),e(pi,{modelValue:x.value,"onUpdate:modelValue":a[7]||(a[7]=q=>x.value=q),variant:z.value,onSave:J},null,8,["modelValue","variant"]),e(Tt,{modelValue:f.value,"onUpdate:modelValue":a[8]||(a[8]=q=>f.value=q),"variant-id":(l=z.value)==null?void 0:l.id_variant,"variant-name":(u=z.value)==null?void 0:u.name,onHppUpdated:de,onPriceUpdated:W},null,8,["modelValue","variant-id","variant-name"]),e(bi,{modelValue:N.value,"onUpdate:modelValue":a[9]||(a[9]=q=>N.value=q),onSave:C},null,8,["modelValue"]),e(St,{modelValue:g.value,"onUpdate:modelValue":a[10]||(a[10]=q=>g.value=q),title:"Konfirmasi Hapus Variant","item-name":(ee=z.value)==null?void 0:ee.name,loading:j.value,"confirm-text":"Hapus Variant",onConfirm:R,onCancel:a[11]||(a[11]=q=>g.value=!1)},null,8,["modelValue","item-name","loading"])])}}}),$t=qe(Ki,[["__scopeId","data-v-22b81d4b"]]),Bi={class:"product-management"},Fi={class:"d-flex justify-space-between align-center mb-6"},Ei={class:"d-flex gap-3 align-center"},Ri={key:0,class:"d-flex gap-2"},qi={class:"d-flex align-center"},Li=Fe({__name:"products-management",setup(S){It();const{productsList:ye,categories:H,loading:U,saveLoading:O,deleteLoading:g,toggleLoading:j,stats:z,dialog:x,deleteDialog:f,editMode:N,selectedProduct:_,selectedProducts:M,currentPage:ve,totalItems:ge,itemsPerPage:V,filters:re,errorMessage:ue,successMessage:W,modalErrorMessage:de,formData:b,selectedImage:v,imagePreview:y,canCreateEdit:p,hasSelectedProducts:R,fetchProductsList:h,fetchCategories:X,fetchStats:ne,saveProduct:ke,deleteProduct:fe,bulkDeleteProducts:ae,toggleActiveStatus:J,toggleFeaturedStatus:C,openCreateDialog:i,openEditDialog:a,openDeleteDialog:l,closeDialog:u,handleImageUpload:ee,clearModalError:q,updateOptions:ce}=Dt(),{dialog:Pe,editMode:le,formData:Ue,availableItems:Ae,saveLoading:Qe,modalErrorMessage:Je,openCreateDialog:D,closeDialog:n,saveRecipe:s,clearModalError:w,fetchAvailableItems:B}=va(),{productItemsList:F,loading:c,fetchProductItemsForComposition:T}=Mt(),Q=I("products"),P=I(),pe=I(!1),se=I(null),oe=I(!1),Se=I(null),be=async()=>{await fe()},De=async()=>{await ae()},Le=Ie=>{const Z=Ie.id_product||Ie.id;D(Z)},Xe=async Ie=>{se.value=Ie;try{await T({page:1,per_page:100,critical_only:!1})}catch{}pe.value=!0},rt=Ie=>{Se.value=Ie,oe.value=!0},ut=Ie=>{if(!Ie)return[];const Z=Ie.id_product||Ie.id;return F.value.filter(lt=>{var _e;return((_e=lt.product)==null?void 0:_e.id_product)===Z||lt.product_id===Z})||[]},ht=async()=>{if(await T({page:1,per_page:100,critical_only:!1}),await h(),se.value&&P.value){const Ie=se.value.id_product||se.value.id;await P.value.refreshHPPData(Ie)}},Ut=Ie=>{Object.assign(re,Ie),h()},At=Ie=>{console.log("Search query received:",Ie),re.search=Ie,console.log("Filters after search update:",re),h()},Ht=()=>{v.value=null,y.value&&(y.value="")};return we(Q,async Ie=>{Ie==="compositions"&&await T({page:1,per_page:100,critical_only:!1})},{immediate:!1}),et(()=>{h(),X(),ne(),B(),T({page:1,per_page:100,critical_only:!1})}),(Ie,Z)=>{var lt;return m(),G("div",Bi,[o("div",Fi,[Z[18]||(Z[18]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold coffee-title"},"Kelola Produk & Komposisi"),o("p",{class:"text-body-1 text-medium-emphasis coffee-subtitle"},"Kelola produk dan komposisi untuk coffee shop Anda")],-1)),o("div",Ei,[K(R)&&Q.value==="products"?(m(),G("div",Ri,[e(ie,{color:"primary",size:"small"},{default:t(()=>[d(r(K(M).length)+" dipilih ",1)]),_:1}),e(E,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-delete",onClick:De},{default:t(()=>Z[16]||(Z[16]=[d(" Hapus Terpilih ")])),_:1,__:[16]})])):L("",!0),K(p)&&Q.value==="products"?(m(),A(E,{key:1,color:"primary","prepend-icon":"mdi-plus",class:"coffee-btn",onClick:K(i)},{default:t(()=>Z[17]||(Z[17]=[d(" Tambah Produk ")])),_:1,__:[17]},8,["onClick"])):L("",!0)])]),e($a,{modelValue:Q.value,"onUpdate:modelValue":Z[0]||(Z[0]=_e=>Q.value=_e),class:"mb-6"},{default:t(()=>[e(vt,{value:"products"},{default:t(()=>[e(k,{icon:"mdi-coffee",class:"me-2"}),Z[19]||(Z[19]=d(" Produk "))]),_:1,__:[19]}),e(vt,{value:"compositions"},{default:t(()=>[e(k,{icon:"mdi-chef-hat",class:"me-2"}),Z[20]||(Z[20]=d(" Komposisi Produk "))]),_:1,__:[20]}),e(vt,{value:"variants"},{default:t(()=>[e(k,{icon:"mdi-tune-variant",class:"me-2"}),Z[21]||(Z[21]=d(" Variant Produk "))]),_:1,__:[21]})]),_:1},8,["modelValue"]),K(ue)?(m(),A(Ke,{key:0,type:"error",variant:"outlined",class:"mb-4",text:K(ue),closable:"","onClick:close":Z[1]||(Z[1]=_e=>ue.value="")},null,8,["text"])):L("",!0),K(W)?(m(),A(Ke,{key:1,type:"success",variant:"outlined",class:"mb-4",text:K(W),closable:"","onClick:close":Z[2]||(Z[2]=_e=>W.value="")},null,8,["text"])):L("",!0),e(Sa,{modelValue:Q.value,"onUpdate:modelValue":Z[4]||(Z[4]=_e=>Q.value=_e)},{default:t(()=>[e(pt,{value:"products"},{default:t(()=>[e(Yo,{stats:K(z)},null,8,["stats"]),e(Ho,{filters:K(re),"onUpdate:filters":Ut,onSearch:At},null,8,["filters"]),e(hs,{ref_key:"productTableRef",ref:P,products:K(ye),loading:K(U),"current-page":K(ve),"total-items":K(ge),"items-per-page":K(V),"selected-products":K(M),"toggle-loading":K(j),"onUpdate:options":K(ce),onAddProduct:K(i),onEditProduct:K(a),onOpenRecipeDialog:Le,onOpenCompositionDialog:Xe,onOpenVariantDialog:rt,onDeleteProduct:K(l),onToggleActive:K(J),onToggleFeatured:K(C),"onUpdate:selectedProducts":Z[3]||(Z[3]=_e=>M.value=_e)},null,8,["products","loading","current-page","total-items","items-per-page","selected-products","toggle-loading","onUpdate:options","onAddProduct","onEditProduct","onDeleteProduct","onToggleActive","onToggleFeatured"])]),_:1}),e(pt,{value:"compositions"},{default:t(()=>[e(eo,{"product-items":K(F),loading:K(c),onRefresh:K(T)},null,8,["product-items","loading","onRefresh"])]),_:1}),e(pt,{value:"variants"},{default:t(()=>[e($t,{loading:K(U),onRefresh:K(h)},null,8,["loading","onRefresh"])]),_:1})]),_:1},8,["modelValue"]),e(Do,{modelValue:K(x),"onUpdate:modelValue":[Z[5]||(Z[5]=_e=>mt(x)?x.value=_e:null),Z[6]||(Z[6]=_e=>x.value=_e)],"edit-mode":K(N),"form-data":K(b),categories:K(H),loading:K(O),"error-message":K(de),"selected-image":K(v)?[K(v)]:[],"image-preview":K(y),onClose:K(u),onSubmit:K(ke),onImageChange:K(ee),onRemoveImage:Ht,onClearError:K(q),onUpdateForm:Z[7]||(Z[7]=(_e,xt)=>K(b)[_e]=xt)},null,8,["modelValue","edit-mode","form-data","categories","loading","error-message","selected-image","image-preview","onClose","onSubmit","onImageChange","onClearError"]),e(pa,{modelValue:K(Pe),"onUpdate:modelValue":[Z[8]||(Z[8]=_e=>mt(Pe)?Pe.value=_e:null),Z[9]||(Z[9]=_e=>Pe.value=_e)],"edit-mode":K(le),"form-data":K(Ue),"available-items":K(Ae),loading:K(Qe),"error-message":K(Je),onClose:K(n),onSave:K(s),onClearError:K(w)},null,8,["modelValue","edit-mode","form-data","available-items","loading","error-message","onClose","onSave","onClearError"]),e(St,{modelValue:K(f),"onUpdate:modelValue":Z[10]||(Z[10]=_e=>mt(f)?f.value=_e:null),title:"Konfirmasi Hapus Produk","item-name":(lt=K(_))==null?void 0:lt.name,loading:K(g),"confirm-text":"Hapus Produk",onConfirm:be,onCancel:Z[11]||(Z[11]=_e=>f.value=!1)},null,8,["modelValue","item-name","loading"]),e(zt,{modelValue:pe.value,"onUpdate:modelValue":Z[12]||(Z[12]=_e=>pe.value=_e),product:se.value,items:ut(se.value),onSave:ht,onRefresh:ht},null,8,["modelValue","product","items"]),e(Ee,{modelValue:oe.value,"onUpdate:modelValue":Z[15]||(Z[15]=_e=>oe.value=_e),"max-width":"1400px",persistent:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(xe,{class:"d-flex justify-between align-center"},{default:t(()=>{var _e;return[o("div",qi,[e(k,{icon:"tabler-versions",class:"me-2"}),d(" Kelola Variant - "+r((_e=Se.value)==null?void 0:_e.name),1)]),e(E,{icon:"tabler-x",variant:"text",onClick:Z[13]||(Z[13]=xt=>oe.value=!1)})]}),_:1}),e(Te),e(te,{class:"pa-0"},{default:t(()=>[Se.value?(m(),A($t,{key:0,product:Se.value},null,8,["product"])):L("",!0)]),_:1}),e(Te),e(Re,null,{default:t(()=>[e(Oe),e(E,{color:"grey-darken-1",variant:"outlined",onClick:Z[14]||(Z[14]=_e=>oe.value=!1)},{default:t(()=>[e(k,{icon:"mdi-close",class:"me-1"}),Z[22]||(Z[22]=d(" Tutup "))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Kn=qe(Li,[["__scopeId","data-v-008f27a7"]]);export{Kn as default};
