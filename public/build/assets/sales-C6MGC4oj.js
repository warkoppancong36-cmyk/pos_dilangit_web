import{d as te,r as y,D as ae,c as g,e as o,b as t,m as le,a1 as E,f as a,ax as se,X as T,au as oe,av as re,j as ne,o as m,s as p,g as C,l as M,t as c,F as ie,i as ue,a5 as de,_ as me}from"./main-CB2I6xMV.js";import{C as ce}from"./auto-Cz6uSJnr.js";import{V as v,b as S}from"./VCard-kftbvHmf.js";import{V as A,a as u}from"./VRow-GRjXWUI7.js";import{V as _}from"./VCardText-BfCVZfsH.js";import{V as L}from"./VSelect-hlAyRJts.js";import{V as B}from"./VTextField-Datxr734.js";import{V as z}from"./VChip-CXoDuQ6k.js";import{V as pe}from"./VDivider-DwA1QPln.js";import{V as U}from"./VDataTable-B_aJPoAP.js";import{b as J}from"./route-block-B_A1xBdJ.js";import"./VAvatar-D5c5G9iR.js";import"./VImg-DwwCzJBL.js";/* empty css              */import"./forwardRefs-B931MWyl.js";import"./VList-VjqlGNmq.js";import"./VOverlay-3Ss5mR2i.js";import"./VMenu-DDyD7LK0.js";import"./VCheckboxBtn-BKcWcRAi.js";import"./VTable-Czu5oa5q.js";import"./filter-Bmzh0E9F.js";const ve={class:"sales-report-page"},_e={class:"d-flex flex-column flex-md-row justify-space-between align-start align-md-center mb-6 ga-4"},fe={class:"d-flex align-center mb-2"},ye={key:0,class:"text-center py-8"},ge={key:1},he={class:"text-h5 font-weight-bold text-success"},xe={class:"text-h5 font-weight-bold text-primary"},be={class:"text-h5 font-weight-bold text-info"},ke={class:"text-h5 font-weight-bold text-warning"},we={key:0},Te={key:1,class:"text-center py-8"},Ve={class:"top-products-container"},De={class:"d-flex justify-space-between align-center"},Pe={class:"d-flex align-center"},Ce={class:"font-weight-medium"},Se={class:"text-caption text-medium-emphasis"},Ae={class:"text-end"},Ne={class:"font-weight-bold text-success"},Re={class:"font-weight-bold text-success"},$e={class:"font-weight-bold text-success"},Ie={key:2,class:"text-center py-12"},H=te({__name:"sales",setup(je){const K=ne(),h=y(!1),N=y(!1),s=y(null),x=y("month"),b=y(""),V=y(""),D=y(""),R=y();let $=null;const X=[{title:"Filter per Bulan",value:"month"},{title:"Custom Range",value:"custom"}],d=new Date().getFullYear(),Y=[{title:"Januari",value:`${d}-01`},{title:"Februari",value:`${d}-02`},{title:"Maret",value:`${d}-03`},{title:"April",value:`${d}-04`},{title:"Mei",value:`${d}-05`},{title:"Juni",value:`${d}-06`},{title:"Juli",value:`${d}-07`},{title:"Agustus",value:`${d}-08`},{title:"September",value:`${d}-09`},{title:"Oktober",value:`${d}-10`},{title:"November",value:`${d}-11`},{title:"Desember",value:`${d}-12`}],q=[{title:"Customer",key:"name",align:"start"},{title:"Total Order",key:"orders",align:"center"},{title:"Total Belanja",key:"revenue",align:"end"}],G=[{title:"Tanggal",key:"date",align:"start"},{title:"Pendapatan",key:"total",align:"end"}],k=l=>typeof l=="string"?l.startsWith("Rp")?l:`Rp ${l}`:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),F=l=>new Date(l).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),W=l=>["warning","success","info","secondary","primary"][l]||"primary",Z=()=>{if(x.value==="month"){const l=new Date().toISOString().slice(0,7);b.value=l}w()},w=async()=>{if(!h.value){h.value=!0;try{let l={};if(x.value==="custom")if(V.value&&D.value)l.start_date=V.value,l.end_date=D.value;else{h.value=!1;return}else if(b.value)l.month=b.value;else{h.value=!1;return}const e=await oe.get("/api/reports/sales",{params:l});e.data.success&&(s.value=e.data.data,await re(),setTimeout(()=>{Q()},100))}catch(l){console.error("Error loading sales report:",l)}finally{h.value=!1}}},Q=()=>{if(!R.value||!s.value)return;$&&$.destroy();const l=R.value.getContext("2d");if(!l)return;const e=s.value.daily_sales.map(n=>F(n.date)),r=s.value.daily_sales.map(n=>(typeof n.total=="string"?parseFloat(n.total.replace(/[^\d.-]/g,"")):n.total)||0);$=new ce(l,{type:"line",data:{labels:e,datasets:[{label:"Pendapatan Harian",data:r,borderColor:"rgb(76, 175, 80)",backgroundColor:"rgba(76, 175, 80, 0.1)",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:function(n){return k(n)}}}}}})},ee=async()=>{if(!s.value){console.warn("No data to export");return}N.value=!0;try{const l=await de(()=>import("./xlsx-CfQreh1U.js"),[]),e=x.value==="custom"?`${V.value} s/d ${D.value}`:`Bulan ${b.value}`,r=[["LAPORAN PENJUALAN"],["Periode:",e],["Tanggal Export:",new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})],[],["RINGKASAN PENJUALAN"],["Total Order:",s.value.summary.total_orders],["Total Pendapatan:",Math.round(parseFloat(s.value.summary.total_revenue.replace(/[^\d.-]/g,"")))],["Rata-rata Order:",Math.round(parseFloat(s.value.summary.average_order.replace(/[^\d.-]/g,"")))],["Total Item Terjual:",s.value.summary.total_items],["Order Selesai:",s.value.summary.completed_orders],["Order Dibatalkan:",s.value.summary.cancelled_orders],[]],n=l.utils.book_new(),I=l.utils.aoa_to_sheet(r);if(I["!cols"]=[{wch:20},{wch:25}],l.utils.book_append_sheet(n,I,"Ringkasan"),s.value.daily_sales&&s.value.daily_sales.length>0){const P=[["PENJUALAN HARIAN"],["Periode:",e],[],["Tanggal","Total Penjualan"],...s.value.daily_sales.map(i=>[new Date(i.date).toLocaleDateString("id-ID"),Math.round(typeof i.total=="string"?parseFloat(i.total.replace(/[^\d.-]/g,"")):i.total)])],f=l.utils.aoa_to_sheet(P);f["!cols"]=[{wch:15},{wch:20}],l.utils.book_append_sheet(n,f,"Penjualan Harian")}if(s.value.top_products&&s.value.top_products.length>0){const P=[["PRODUK TERLARIS"],["Periode:",e],[],["No","Nama Produk","Jumlah Terjual","Total Pendapatan"],...s.value.top_products.map((i,j)=>[j+1,i.name,i.quantity,Math.round(typeof i.revenue=="string"?parseFloat(i.revenue.replace(/[^\d.-]/g,"")):i.revenue||0)])],f=l.utils.aoa_to_sheet(P);f["!cols"]=[{wch:5},{wch:30},{wch:15},{wch:20}],l.utils.book_append_sheet(n,f,"Produk Terlaris")}if(s.value.top_customers&&s.value.top_customers.length>0){const P=[["CUSTOMER TERBAIK"],["Periode:",e],[],["No","Nama Customer","Jumlah Order","Total Belanja"],...s.value.top_customers.map((i,j)=>[j+1,i.name,i.orders,Math.round(typeof i.revenue=="string"?parseFloat(i.revenue.replace(/[^\d.-]/g,"")):i.revenue||0)])],f=l.utils.aoa_to_sheet(P);f["!cols"]=[{wch:5},{wch:25},{wch:15},{wch:20}],l.utils.book_append_sheet(n,f,"Customer Terbaik")}const O=`laporan-penjualan-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.xlsx`;l.writeFile(n,O),console.log("âœ… Sales report exported successfully:",O)}catch(l){console.error("Error exporting sales report:",l)}finally{N.value=!1}};return ae(()=>{const l=new Date,e=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`;b.value=e,w()}),(l,e)=>(m(),g("div",ve,[o("div",_e,[o("div",null,[o("div",fe,[t(E,{icon:"mdi-arrow-left",variant:"text",size:"small",onClick:e[0]||(e[0]=r=>le(K).back()),class:"me-2"}),e[5]||(e[5]=o("h1",{class:"text-h4 font-weight-bold"},"Laporan Penjualan",-1))]),e[6]||(e[6]=o("p",{class:"text-body-1 text-medium-emphasis"}," Analisis lengkap penjualan dan performa produk ",-1))]),t(E,{color:"success","prepend-icon":"mdi-file-excel",onClick:ee,loading:N.value},{default:a(()=>e[7]||(e[7]=[p(" Export Excel ")])),_:1,__:[7]},8,["loading"])]),t(v,{class:"mb-6"},{default:a(()=>[t(_,null,{default:a(()=>[t(A,null,{default:a(()=>[t(u,{cols:"12",md:"4"},{default:a(()=>[t(L,{modelValue:x.value,"onUpdate:modelValue":[e[1]||(e[1]=r=>x.value=r),Z],items:X,label:"Pilih Periode",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),x.value==="custom"?(m(),C(u,{key:0,cols:"12",md:"3"},{default:a(()=>[t(B,{modelValue:V.value,"onUpdate:modelValue":[e[2]||(e[2]=r=>V.value=r),w],type:"date",label:"Tanggal Mulai",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})):M("",!0),x.value==="custom"?(m(),C(u,{key:1,cols:"12",md:"3"},{default:a(()=>[t(B,{modelValue:D.value,"onUpdate:modelValue":[e[3]||(e[3]=r=>D.value=r),w],type:"date",label:"Tanggal Akhir",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})):(m(),C(u,{key:2,cols:"12",md:"3"},{default:a(()=>[t(L,{modelValue:b.value,"onUpdate:modelValue":[e[4]||(e[4]=r=>b.value=r),w],items:Y,label:"Pilih Bulan",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})),t(u,{cols:"12",md:"2"},{default:a(()=>[t(E,{color:"primary",block:"",onClick:w,loading:h.value},{default:a(()=>e[8]||(e[8]=[p(" Refresh ")])),_:1,__:[8]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),h.value?(m(),g("div",ye,[t(se,{indeterminate:"",color:"primary",size:"64"}),e[9]||(e[9]=o("p",{class:"text-body-1 mt-4"},"Memuat data laporan...",-1))])):s.value?(m(),g("div",ge,[t(A,{class:"mb-6"},{default:a(()=>[t(u,{cols:"6",md:"3"},{default:a(()=>[t(v,null,{default:a(()=>[t(_,{class:"text-center"},{default:a(()=>[t(T,{icon:"mdi-currency-usd",size:"32",class:"text-success mb-2"}),o("div",he,c(k(s.value.summary.total_revenue)),1),e[10]||(e[10]=o("div",{class:"text-body-2 text-medium-emphasis"},"Total Pendapatan",-1))]),_:1,__:[10]})]),_:1})]),_:1}),t(u,{cols:"6",md:"3"},{default:a(()=>[t(v,null,{default:a(()=>[t(_,{class:"text-center"},{default:a(()=>[t(T,{icon:"mdi-cart",size:"32",class:"text-primary mb-2"}),o("div",xe,c(s.value.summary.total_orders),1),e[11]||(e[11]=o("div",{class:"text-body-2 text-medium-emphasis"},"Total Order",-1))]),_:1,__:[11]})]),_:1})]),_:1}),t(u,{cols:"6",md:"3"},{default:a(()=>[t(v,null,{default:a(()=>[t(_,{class:"text-center"},{default:a(()=>[t(T,{icon:"mdi-package",size:"32",class:"text-info mb-2"}),o("div",be,c(s.value.summary.total_items),1),e[12]||(e[12]=o("div",{class:"text-body-2 text-medium-emphasis"},"Total Item",-1))]),_:1,__:[12]})]),_:1})]),_:1}),t(u,{cols:"6",md:"3"},{default:a(()=>[t(v,null,{default:a(()=>[t(_,{class:"text-center"},{default:a(()=>[t(T,{icon:"mdi-calculator",size:"32",class:"text-warning mb-2"}),o("div",ke,c(k(s.value.summary.average_order)),1),e[13]||(e[13]=o("div",{class:"text-body-2 text-medium-emphasis"},"Rata-rata Order",-1))]),_:1,__:[13]})]),_:1})]),_:1})]),_:1}),t(A,{class:"mb-6"},{default:a(()=>[t(u,{cols:"12",md:"8"},{default:a(()=>[t(v,null,{default:a(()=>[t(S,null,{default:a(()=>e[14]||(e[14]=[p("Trend Penjualan Harian")])),_:1,__:[14]}),t(_,null,{default:a(()=>[s.value&&s.value.daily_sales&&s.value.daily_sales.length>0?(m(),g("div",we,[o("canvas",{ref_key:"dailySalesChart",ref:R,class:"w-100",style:{"max-height":"300px"}},null,512)])):(m(),g("div",Te,[t(T,{icon:"mdi-chart-line",size:"48",class:"text-medium-emphasis mb-2"}),e[15]||(e[15]=o("p",{class:"text-body-2 text-medium-emphasis"},"Tidak ada data penjualan harian",-1))]))]),_:1})]),_:1})]),_:1}),t(u,{cols:"12",md:"4"},{default:a(()=>[t(v,null,{default:a(()=>[t(S,null,{default:a(()=>e[16]||(e[16]=[p("Top 5 Produk")])),_:1,__:[16]}),t(_,null,{default:a(()=>[o("div",Ve,[(m(!0),g(ie,null,ue(s.value.top_products,(r,n)=>(m(),g("div",{key:r.id,class:"mb-3"},[o("div",De,[o("div",Pe,[t(z,{color:W(n),size:"small",class:"me-2"},{default:a(()=>[p(c(n+1),1)]),_:2},1032,["color"]),o("div",null,[o("div",Ce,c(r.name),1),o("div",Se,c(r.quantity)+" terjual ",1)])]),o("div",Ae,[o("div",Ne,c(k(r.revenue)),1)])]),n<s.value.top_products.length-1?(m(),C(pe,{key:0,class:"mt-3"})):M("",!0)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),t(A,null,{default:a(()=>[t(u,{cols:"12",md:"6"},{default:a(()=>[t(v,null,{default:a(()=>[t(S,null,{default:a(()=>e[17]||(e[17]=[p("Top Customer")])),_:1,__:[17]}),t(_,null,{default:a(()=>[t(U,{headers:q,items:s.value.top_customers,"items-per-page":5,class:"elevation-0","no-data-text":"Tidak ada data customer"},{"item.orders":a(({item:r})=>[t(z,{size:"small",color:"primary",variant:"tonal"},{default:a(()=>[p(c(r.orders),1)]),_:2},1024)]),"item.revenue":a(({item:r})=>[o("span",Re,c(k(r.revenue)),1)]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),t(u,{cols:"12",md:"6"},{default:a(()=>[t(v,null,{default:a(()=>[t(S,null,{default:a(()=>e[18]||(e[18]=[p("Penjualan per Hari")])),_:1,__:[18]}),t(_,null,{default:a(()=>[t(U,{headers:G,items:s.value.daily_sales,"items-per-page":7,class:"elevation-0","no-data-text":"Tidak ada data penjualan"},{"item.date":a(({item:r})=>[p(c(F(r.date)),1)]),"item.total":a(({item:r})=>[o("span",$e,c(k(r.total)),1)]),_:1},8,["items"])]),_:1})]),_:1})]),_:1})]),_:1})])):(m(),g("div",Ie,[t(T,{icon:"mdi-chart-line-variant",size:"64",class:"text-medium-emphasis mb-4"}),e[19]||(e[19]=o("h3",{class:"text-h6 mb-2"},"Tidak ada data laporan",-1)),e[20]||(e[20]=o("p",{class:"text-body-2 text-medium-emphasis"}," Silakan pilih periode yang berbeda atau periksa kembali filter Anda ",-1))]))]))}});typeof J=="function"&&J(H);const st=me(H,[["__scopeId","data-v-58175be5"]]);export{st as default};
